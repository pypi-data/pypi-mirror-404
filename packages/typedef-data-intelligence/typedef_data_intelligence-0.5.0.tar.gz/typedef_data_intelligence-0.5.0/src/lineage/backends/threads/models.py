"""Pydantic models for thread storage."""

from datetime import datetime
from typing import Any, Dict, Literal, Optional

from pydantic import BaseModel, Field


class StoredMessage(BaseModel):
    """Represents a persisted AG-UI message within a thread."""
    message_id: str
    role: str
    content: Optional[str] = None
    metadata: Optional[Dict[str, Any]] = None
    created_at: datetime = Field(default_factory=datetime.now)


class Artifact(BaseModel):
    """An artifact created during an agent run (e.g., a report)."""

    type: Literal["report"]
    """Type of artifact. Currently only 'report' is supported."""

    id: str
    """Unique identifier for the artifact."""

    run_id: str
    """Unique identifier for the run that created this artifact."""

    title: str
    """Human-readable title of the artifact."""

    created_at: datetime
    """Timestamp when the artifact was created."""

    def __hash__(self) -> int:
        """Return hash of the artifact based on its ID."""
        return hash(self.id)

    def __eq__(self, other: object) -> bool:
        """Check equality based on artifact ID."""
        if not isinstance(other, Artifact):
            return False
        return self.id == other.id


class RunSummary(BaseModel):
    """Summary of a single agent run within a thread."""

    run_id: str
    """Unique identifier for this run."""

    timestamp: datetime
    """When this run occurred."""

    title: str
    """Title of the run."""

    summary: str
    """Natural language summary of what happened in this run.

    Generated by LLM, covers:
    - What the user asked for
    - What the agent did
    - What was created/accomplished
    """


class ThreadContext(BaseModel):
    """Context for an entire conversation thread across multiple runs."""

    thread_id: str
    """Unique identifier for this thread."""

    runs: list[RunSummary] = Field(default_factory=list)
    """Chronological list of run summaries in this thread."""

    artifacts: set[Artifact] = Field(default_factory=set)
    """List of all artifacts created across all runs in this thread."""
