# typedef Data Concierge Configuration
# Generated by: typedef init
# Location: ~/.typedef/config.yaml
#
# This unified config is used by all typedef commands:
#   - typedef sync: Uses lineage, data, projects, and population settings
#   - typedef chat: Uses lineage, data, projects, agent, threads, and ticket settings

# Default project (used when no project is specified)
default_project: "{{ project_name | yaml_escape }}"

# Projects (multiple dbt projects in a single unified graph)
# Each project can override specific data settings (database, warehouse, etc.)
projects:
  {{ project_name | yaml_quote_key }}:
    name: "{{ project_name | yaml_escape }}"
    dbt_path: "{{ dbt_path | yaml_escape }}"
    graph_name: "{{ project_name | yaml_escape }}"
    profile_name: "{{ profile_name | yaml_escape }}"
    profiles_dir: "{{ profiles_dir | yaml_escape }}"
{% if allowed_databases %}
    allowed_databases: {{ allowed_databases | tojson }}
{% endif %}
{% if allowed_schemas %}
    allowed_schemas: {{ allowed_schemas | tojson }}
{% endif %}
{% if default_database %}
    default_database: "{{ default_database | yaml_escape }}"
{% endif %}
{% if project_env_vars %}
    env:
{% for key, value in project_env_vars.items() %}
      {{ key | yaml_quote_key }}: "{{ value | yaml_escape }}"
{% endfor %}
{% endif %}
{% if git_enabled == 'true' %}
    git:
      enabled: {{ git_enabled | default('true') }}
      working_directory: "{{ git_working_directory | yaml_escape }}"
{% endif %}
    # Per-project overrides (optional)
    # Uncomment to override shared data settings or configure git for this project:
    # data:
    #   database: "PROJECT_SPECIFIC_DB"
    #   warehouse: "PROJECT_SPECIFIC_WH"
    # git:
    #   enabled: true
    #   working_directory: "/path/to/project"

# Lineage Backend (unified graph database - no Docker required)
# Single database file contains multiple graphs (one per project)
lineage:
  backend: falkordblite
  db_path: "{{ graph_db_path | yaml_escape }}"

# Data Warehouse Connection (shared defaults across all projects)
# Individual projects can override specific fields in their 'data:' section
data:
  backend: snowflake
  account: "{{ snowflake_account | yaml_escape }}"
  user: "{{ snowflake_user | yaml_escape }}"
  warehouse: "{{ snowflake_warehouse | yaml_escape }}"
  role: "{{ snowflake_role | yaml_escape }}"
  database: "{{ snowflake_database | yaml_escape }}"
  schema_name: "{{ snowflake_schema | yaml_escape }}"
  private_key_path: "{{ snowflake_private_key_path | yaml_escape }}"

# Population Settings (used by typedef sync)
# Controls semantic analysis, profiling, and clustering during sync
population:
  semantic_analysis:
    enabled: true
    max_workers: 8
    cache_dir: "{{ typedef_home | yaml_escape }}/semantic_cache"
    use_cache: true
    export_cache: true
    batch_size: 500

    models:
      micro:
        type: openai
        model_name: gpt-5-nano
        reasoning_effort: low

      small:
        type: openai
        model_name: gpt-5-nano
        reasoning_effort: medium

      medium:
        type: openai
        model_name: gpt-5-mini
        reasoning_effort: medium

      large:
        type: openai
        model_name: gpt-5
        reasoning_effort: low

      xlarge:
        type: openai
        model_name: gpt-5
        reasoning_effort: medium

    pipeline:
      pass_01:
        model: large
      pass_02:
        model: medium
      pass_03:
        model: medium
      pass_04:
        model: small
      pass_05:
        model: large
      pass_06:
        model: small
      pass_07:
        model: small
      pass_08:
        model: small
      pass_09:
        model: small
      pass_10:
        model: large
      pass_10a:
        model: micro
      pass_11:
        model: small
      enable_audit: false

  profiling:
    enabled: false
    max_workers: 8

  clustering:
    enabled: true
    min_cluster_size: 2

  semantic_view_loader:
    enabled: true

# Ticketing Integration
ticket:
  enabled: {{ ticket_enabled | default('false') }}
{% if ticket_backend == 'linear' %}
  backend: linear
  mcp_server_url: "{{ linear_mcp_server_url | yaml_escape }}"
{% if linear_team_id %}
  team_id: "{{ linear_team_id | yaml_escape }}"
{% endif %}
  # API keys read from environment:
  # LINEAR_ANALYST_API_KEY, LINEAR_DATA_ENGINEER_API_KEY
{% else %}
  backend: filesystem
  base_path: "{{ typedef_home | yaml_escape }}/tickets"
{% endif %}

# Reports Storage
reports:
  enabled: true
  backend: filesystem
  base_path: "{{ typedef_home | yaml_escape }}/reports"

# Thread Storage (conversation memory)
threads:
  enabled: true
  backend: sqlite
  base_path: "{{ typedef_home | yaml_escape }}/threads.db"

# Agent Configuration
agent:
  analyst:
    model: anthropic:claude-haiku-4-5
  data_engineer:
    model: anthropic:claude-sonnet-4-5
  investigator:
    model: anthropic:claude-sonnet-4-5
  insights:
    model: anthropic:claude-sonnet-4-5
