# DX-75: Attention-Aware Framework Architecture

**Status:** Phase B Complete (Phase A deferred pending validation)
**Created:** 2026-01-02
**Phase B Completed:** 2026-01-02 (review v7.0, develop v5.1)
**Supersedes:** DX-74-tiered-attention-defense.md (merged)
**References:** [DX-74-experiment-report.md](./DX-74-experiment-report.md)

## Executive Summary

DX-74 å®éªŒæ­ç¤ºäº† LLM Agent çš„å››ä¸ªæ ¸å¿ƒæ³¨æ„åŠ›ç°è±¡ã€‚æœ¬ææ¡ˆå°†è¿™äº›å‘ç°ç³»ç»Ÿæ€§åœ°åº”ç”¨åˆ° Invar æ•´ä¸ªæ¡†æ¶ï¼ŒåŒ…æ‹¬æ‰€æœ‰ Skillã€USBV å·¥ä½œæµã€ä»¥åŠåº•å±‚æ¶æ„ã€‚

**è®¾è®¡åŸåˆ™ï¼š** ä¸è€ƒè™‘å‘åå…¼å®¹ï¼Œä»é›¶è®¾è®¡æœ€ä¼˜æ¶æ„ã€‚

---

## Part 1: æ ¸å¿ƒå‘ç° (æ¥è‡ª DX-74)

### 1.1 å››ä¸ªæ³¨æ„åŠ›ç°è±¡

| ç°è±¡ | è§¦å‘æ¡ä»¶ | è¡¨ç° | å½±å“ |
|------|---------|------|------|
| **Attention Drift** | 50+ items, 5+ files, 3000+ lines | åæœŸå†…å®¹åˆ†æè´¨é‡ä¸‹é™ | é—æ¼é—®é¢˜ |
| **Checklist Mentality** | é¢„æšä¸¾å·²çŸ¥æ¨¡å¼ | åªéªŒè¯æ¸…å•é¡¹ï¼Œé—æ¼å˜ç§ | ç›²ç‚¹å›ºåŒ– |
| **Context Contamination** | åˆ›å»ºè€…è¯„ä¼°è‡ªå·±ä½œå“ | å¤±å»å®¢è§‚æ€§ | è¯¯åˆ¤è´¨é‡ |
| **Scale Threshold** | è§„æ¨¡å˜åŒ– | å°è§„æ¨¡ vs å¤§è§„æ¨¡éœ€ä¸åŒç­–ç•¥ | ç­–ç•¥å¤±é… |

### 1.2 å®éªŒéªŒè¯æ•°æ®

| åœºæ™¯ | è§„æ¨¡ | Baseline | Strategy N | å…³é”®å‘ç° |
|------|------|----------|------------|---------|
| V4 | 50 issues, 5 files | 84% | 100% | **æ¼‚ç§»éªŒè¯** |
| V5 | 100 issues, 12 files | 100% | 100% | BUGæ ‡è®°æ— æ•ˆåŒ–æµ‹è¯• |
| V6 | 100 issues, 12 files | 100% | 100% | è½¯æç¤ºæ— æ•ˆåŒ–æµ‹è¯• |
| V7 | 25 issues, 5 files | 132% | 100% | **æ¸…å•æ€ç»´éªŒè¯** |

**å…³é”®æ´å¯Ÿï¼š**
- å¤§è§„æ¨¡ (V4): æšä¸¾å¼•å¯¼é˜²æ­¢æ¼‚ç§»
- å°è§„æ¨¡ (V7): å½»åº•é˜…è¯»å‘ç°æ›´å¤šè¾¹ç¼˜æ¡ˆä¾‹
- ç­–ç•¥å¿…é¡»æ ¹æ®è§„æ¨¡åŠ¨æ€é€‰æ‹©

---

## Part 2: æ¡†æ¶çº§æ¶æ„

### 2.1 Scope Analyzer (æ–°ç»„ä»¶)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SCOPE ANALYZER                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Input: file list or directory                              â”‚
â”‚  Output: ScopeProfile                                       â”‚
â”‚                                                             â”‚
â”‚  Metrics:                                                   â”‚
â”‚  - file_count: int                                          â”‚
â”‚  - total_lines: int                                         â”‚
â”‚  - avg_complexity: float                                    â”‚
â”‚  - issue_density_estimate: float                            â”‚
â”‚                                                             â”‚
â”‚  Classification:                                            â”‚
â”‚  - SMALL:  <5 files AND <3000 lines                         â”‚
â”‚  - MEDIUM: 5-10 files OR 3000-10000 lines                   â”‚
â”‚  - LARGE:  >10 files OR >10000 lines                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°ä½ç½®ï¼š** `src/invar/core/scope_analyzer.py`

```python
@dataclass
class ScopeProfile:
    """Scope analysis result for strategy selection."""
    file_count: int
    total_lines: int
    complexity_score: float
    classification: Literal["SMALL", "MEDIUM", "LARGE"]

    @property
    def recommended_strategy(self) -> str:
        if self.classification == "SMALL":
            return "THOROUGH_BASELINE"
        elif self.classification == "MEDIUM":
            return "HYBRID"
        else:
            return "ENUMERATION_GUIDED"
```

### 2.2 Strategy Orchestrator (æ–°ç»„ä»¶)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STRATEGY ORCHESTRATOR                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Scope       â”‚ â†’  â”‚ Strategy     â”‚ â†’  â”‚ Execution     â”‚  â”‚
â”‚  â”‚ Analyzer    â”‚    â”‚ Selector     â”‚    â”‚ Engine        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  Strategies:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ THOROUGH_BASELINE                                   â”‚   â”‚
â”‚  â”‚ - Linear reading, no enumeration                    â”‚   â”‚
â”‚  â”‚ - Best for: <3000 lines, finding edge cases         â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ ENUMERATION_GUIDED                                  â”‚   â”‚
â”‚  â”‚ - Phase 0: invar_sig + grep enumeration             â”‚   â”‚
â”‚  â”‚ - Phase 1: Fresh agent with issue_map               â”‚   â”‚
â”‚  â”‚ - Best for: >3000 lines, preventing drift           â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ HYBRID                                              â”‚   â”‚
â”‚  â”‚ - Run ENUMERATION_GUIDED first                      â”‚   â”‚
â”‚  â”‚ - Run OPEN_ENDED pass second                        â”‚   â”‚
â”‚  â”‚ - Merge and deduplicate                             â”‚   â”‚
â”‚  â”‚ - Best for: Security audits, maximum coverage       â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ CHUNKED_PARALLEL                                    â”‚   â”‚
â”‚  â”‚ - Split into <3000 line chunks                      â”‚   â”‚
â”‚  â”‚ - Parallel subagents per chunk                      â”‚   â”‚
â”‚  â”‚ - Merge results                                     â”‚   â”‚
â”‚  â”‚ - Best for: >10000 lines                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 Isolation Manager (æ–°ç»„ä»¶)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ISOLATION MANAGER                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                             â”‚
â”‚  Principle: Creator â‰  Evaluator                             â”‚
â”‚                                                             â”‚
â”‚  spawn_isolated_agent(                                      â”‚
â”‚      role: "REVIEWER" | "VALIDATOR" | "CHALLENGER",         â”‚
â”‚      context: MinimalContext,  # No conversation history    â”‚
â”‚      model: "opus" | "sonnet",                              â”‚
â”‚  ) -> AgentReport                                           â”‚
â”‚                                                             â”‚
â”‚  Rules:                                                     â”‚
â”‚  1. Isolated agent receives ONLY:                           â”‚
â”‚     - Files to process                                      â”‚
â”‚     - Contracts (if available)                              â”‚
â”‚     - Specific instructions                                 â”‚
â”‚  2. Isolated agent does NOT receive:                        â”‚
â”‚     - Conversation history                                  â”‚
â”‚     - Previous agent's reasoning                            â”‚
â”‚     - Development context                                   â”‚
â”‚  3. Each round spawns NEW agent (no reuse)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 Attention Refresh Controller

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ATTENTION REFRESH CONTROLLER                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                             â”‚
â”‚  Triggers (automatic):                                      â”‚
â”‚  - After processing 5 files                                 â”‚
â”‚  - After phase transition (Uâ†’Sâ†’Bâ†’V)                         â”‚
â”‚  - Before evaluation/validation                             â”‚
â”‚  - When switching creationâ†’review mode                      â”‚
â”‚                                                             â”‚
â”‚  Refresh Actions:                                           â”‚
â”‚  1. Re-read .invar/context.md                               â”‚
â”‚  2. Re-enumerate remaining scope                            â”‚
â”‚  3. Reset completion tracking                               â”‚
â”‚  4. Optional: Spawn fresh subagent                          â”‚
â”‚                                                             â”‚
â”‚  Integration:                                               â”‚
â”‚  - Hook into all skill entry points                         â”‚
â”‚  - Automatic, transparent to user                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Part 3: Skill é‡è®¾è®¡

### 3.1 /review (å®Œå…¨é‡è®¾è®¡)

**åºŸå¼ƒ:** æ—§çš„ same-context review æ¨¡å¼
**æ–°æ¶æ„:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  /review                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                             â”‚
â”‚  Entry:                                                     â”‚
â”‚  1. Scope Analyzer â†’ determine strategy                     â”‚
â”‚  2. Self-review check â†’ force isolation if self-review      â”‚
â”‚                                                             â”‚
â”‚  Execution (based on scope):                                â”‚
â”‚                                                             â”‚
â”‚  SMALL (<3000 lines):                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Isolated Agent (single pass, thorough reading)     â”‚   â”‚
â”‚  â”‚  + Open-ended discovery                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  MEDIUM (3000-10000 lines):                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Phase 0: Enumeration (invar_sig + grep)            â”‚   â”‚
â”‚  â”‚  Phase 1: Isolated Agent with issue_map             â”‚   â”‚
â”‚  â”‚  Phase 2: Open-ended discovery pass                 â”‚   â”‚
â”‚  â”‚  â†’ Merge, deduplicate                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  LARGE (>10000 lines):                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Chunk into ~3000 line segments                     â”‚   â”‚
â”‚  â”‚  Parallel isolated agents per chunk                 â”‚   â”‚
â”‚  â”‚  Cross-chunk boundary analysis                      â”‚   â”‚
â”‚  â”‚  â†’ Merge all findings                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  Fix Loop (all strategies):                                 â”‚
â”‚  - Main agent fixes issues                                  â”‚
â”‚  - NEW isolated agent reviews (never reuse)                 â”‚
â”‚  - Repeat until APPROVED or max_rounds                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Changes:**
1. åºŸå¼ƒ same-context review - æ°¸è¿œä½¿ç”¨éš”ç¦»
2. è§„æ¨¡è‡ªåŠ¨æ£€æµ‹ç­–ç•¥
3. Hybrid é»˜è®¤åŒ…å« open-ended pass
4. æ¯è½® fix å spawn æ–° agent

### 3.2 /develop (æ–°å¢ VALIDATE éš”ç¦»)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  /develop (USBV with Isolation)                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                             â”‚
â”‚  UNDERSTAND â”€â”€â”€ Main Agent                                  â”‚
â”‚      â”‚          (reads, explores, asks)                     â”‚
â”‚      â–¼                                                      â”‚
â”‚  SPECIFY â”€â”€â”€â”€â”€â”€â”€ Main Agent                                 â”‚
â”‚      â”‚          (writes contracts, designs)                 â”‚
â”‚      â–¼                                                      â”‚
â”‚  BUILD â”€â”€â”€â”€â”€â”€â”€â”€â”€ Main Agent                                 â”‚
â”‚      â”‚          (implements code)                           â”‚
â”‚      â–¼                                                      â”‚
â”‚  VALIDATE â”€â”€â”€â”€â”€â”€ âš ï¸ ISOLATION REQUIRED                       â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Validation Sub-workflow:                           â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  1. Main Agent: Run invar_guard()                   â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  2. Spawn Isolated VALIDATOR:                       â”‚   â”‚
â”‚  â”‚     - Receives: implementation files, contracts     â”‚   â”‚
â”‚  â”‚     - Does NOT receive: development conversation    â”‚   â”‚
â”‚  â”‚     - Task: Verify implementation matches spec      â”‚   â”‚
â”‚  â”‚     - Returns: PASS/FAIL + issues                   â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  3. If FAIL:                                        â”‚   â”‚
â”‚  â”‚     - Main agent fixes                              â”‚   â”‚
â”‚  â”‚     - Spawn NEW isolated validator                  â”‚   â”‚
â”‚  â”‚     - Repeat until PASS                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  Exit: Guard PASS + Isolated Validator PASS                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Changes:**
1. VALIDATE é˜¶æ®µå¼ºåˆ¶éš”ç¦»
2. Builder ä¸èƒ½è¯„ä¼°è‡ªå·±çš„ä»£ç 
3. æ¯è½® fix å spawn æ–° validator

### 3.3 /investigate (åˆ†å—æ¢ç´¢)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  /investigate (Chunked Exploration)                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                             â”‚
â”‚  Problem: Long research â†’ later files skimmed               â”‚
â”‚                                                             â”‚
â”‚  Solution: Chunk exploration into focused subtasks          â”‚
â”‚                                                             â”‚
â”‚  Entry:                                                     â”‚
â”‚  1. Scope Analyzer â†’ estimate exploration size              â”‚
â”‚  2. If LARGE: auto-chunk                                    â”‚
â”‚                                                             â”‚
â”‚  SMALL exploration:                                         â”‚
â”‚  - Direct exploration by main agent                         â”‚
â”‚  - Attention refresh after every 5 files                    â”‚
â”‚                                                             â”‚
â”‚  LARGE exploration:                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. Generate exploration plan (questions/areas)     â”‚   â”‚
â”‚  â”‚  2. For each area:                                  â”‚   â”‚
â”‚  â”‚     - Spawn focused Explore subagent                â”‚   â”‚
â”‚  â”‚     - Limit to specific question/area               â”‚   â”‚
â”‚  â”‚  3. Synthesize findings                             â”‚   â”‚
â”‚  â”‚  4. AUTO-COMPLETE CHECK:                            â”‚   â”‚
â”‚  â”‚     - Did findings answer original question?        â”‚   â”‚
â”‚  â”‚     - If YES â†’ auto-complete                        â”‚   â”‚
â”‚  â”‚     - If NO â†’ auto-expand scope (up to 2x)          â”‚   â”‚
â”‚  â”‚     - If still NO â†’ report partial + gaps           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 /propose (Devil's Advocate)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  /propose (with Challenger)                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                             â”‚
â”‚  Problem: Author proposes â†’ only considers known options    â”‚
â”‚                                                             â”‚
â”‚  Solution: Add Devil's Advocate pass                        â”‚
â”‚                                                             â”‚
â”‚  Workflow:                                                  â”‚
â”‚  1. Main Agent: Generate options (as today)                 â”‚
â”‚                                                             â”‚
â”‚  2. Spawn Isolated CHALLENGER:                              â”‚
â”‚     - Receives: proposed options                            â”‚
â”‚     - Task: "What options are missing? What flaws exist?"   â”‚
â”‚     - Returns: critiques + alternative options              â”‚
â”‚                                                             â”‚
â”‚  3. Main Agent: Synthesize                                  â”‚
â”‚     - Merge challenger's additions                          â”‚
â”‚     - AUTO-RECOMMEND based on:                              â”‚
â”‚       * Trade-off analysis                                  â”‚
â”‚       * Project context (.invar/context.md)                 â”‚
â”‚       * Complexity vs benefit                               â”‚
â”‚     - Present: "Recommended: X, Alternatives: Y, Z"         â”‚
â”‚                                                             â”‚
â”‚  4. User decides (or accepts recommendation)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.5 /audit (ä¸ /review ç»Ÿä¸€)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  /audit â†’ åˆå¹¶åˆ° /review --readonly                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                             â”‚
â”‚  /review --readonly:                                        â”‚
â”‚  - Same strategy selection as /review                       â”‚
â”‚  - Same isolation requirements                              â”‚
â”‚  - But: NO fix loop, only report                            â”‚
â”‚                                                             â”‚
â”‚  åºŸå¼ƒç‹¬ç«‹çš„ /audit skill                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Part 4: USBV å·¥ä½œæµé‡è®¾è®¡

### 4.1 Phase Transitions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USBV with Attention Awareness                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                             â”‚
â”‚  UNDERSTAND                                                 â”‚
â”‚      â”‚                                                      â”‚
â”‚      â”‚ â† Attention Refresh Point                            â”‚
â”‚      â”‚   (re-read context.md, reset tracking)               â”‚
â”‚      â–¼                                                      â”‚
â”‚  SPECIFY                                                    â”‚
â”‚      â”‚                                                      â”‚
â”‚      â”‚ â† Attention Refresh Point                            â”‚
â”‚      â”‚ â† Optional: Isolated Contract Reviewer               â”‚
â”‚      â”‚   (if complex, spawn agent to review contracts)      â”‚
â”‚      â–¼                                                      â”‚
â”‚  BUILD                                                      â”‚
â”‚      â”‚                                                      â”‚
â”‚      â”‚ â† Attention Refresh Point                            â”‚
â”‚      â”‚ â† Context Contamination Warning                      â”‚
â”‚      â”‚   (builder now has emotional attachment)             â”‚
â”‚      â–¼                                                      â”‚
â”‚  VALIDATE â”€â”€â”€â”€â”€ MANDATORY ISOLATION                         â”‚
â”‚      â”‚                                                      â”‚
â”‚      â”‚ â† Spawn Isolated Validator                           â”‚
â”‚      â”‚   (completely fresh context)                         â”‚
â”‚      â–¼                                                      â”‚
â”‚  EXIT                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Incremental USBV (Large Tasks)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Incremental USBV (for large implementations)               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                             â”‚
â”‚  Large Task Detection:                                      â”‚
â”‚  - >10 functions to implement                               â”‚
â”‚  - >1000 lines estimated                                    â”‚
â”‚  - Multiple files to create/modify                          â”‚
â”‚                                                             â”‚
â”‚  Chunked Workflow:                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  UNDERSTAND (full task)                             â”‚   â”‚
â”‚  â”‚      â†“                                              â”‚   â”‚
â”‚  â”‚  SPECIFY (full design, chunked contracts)           â”‚   â”‚
â”‚  â”‚      â†“                                              â”‚   â”‚
â”‚  â”‚  For each chunk:                                    â”‚   â”‚
â”‚  â”‚      BUILD chunk                                    â”‚   â”‚
â”‚  â”‚      VALIDATE chunk (isolated)                      â”‚   â”‚
â”‚  â”‚      â†“                                              â”‚   â”‚
â”‚  â”‚  Integration VALIDATE (isolated, full scope)        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  Benefits:                                                  â”‚
â”‚  - Each chunk gets fresh validation                         â”‚
â”‚  - Early detection of issues                                â”‚
â”‚  - Prevents "sunk cost" continuation                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Part 4.5: Agent è‡ªåŠ¨åŒ–æœºåˆ¶ (æ–°å¢)

### 4.5.1 Skill è‡ªåŠ¨è·¯ç”±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AUTO-ROUTER                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                             â”‚
â”‚  Input: User message                                        â”‚
â”‚  Output: Skill invocation (automatic, no user command)      â”‚
â”‚                                                             â”‚
â”‚  Detection Rules:                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  IF message contains:                               â”‚   â”‚
â”‚  â”‚    "implement", "add", "fix", "create", "build"     â”‚   â”‚
â”‚  â”‚  AND requires code changes                          â”‚   â”‚
â”‚  â”‚  â†’ AUTO-INVOKE /develop                             â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  IF message contains:                               â”‚   â”‚
â”‚  â”‚    "review", "check", "audit", "verify"             â”‚   â”‚
â”‚  â”‚  AND references existing code                       â”‚   â”‚
â”‚  â”‚  â†’ AUTO-INVOKE /review                              â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  IF message contains:                               â”‚   â”‚
â”‚  â”‚    "why", "how does", "explain", "understand"       â”‚   â”‚
â”‚  â”‚  â†’ AUTO-INVOKE /investigate                         â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  IF message contains:                               â”‚   â”‚
â”‚  â”‚    "should we", "compare", "which", "design"        â”‚   â”‚
â”‚  â”‚  â†’ AUTO-INVOKE /propose                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  Announcement (transparent):                                â”‚
â”‚  "ğŸ“ Auto-routing: /develop â€” detected implementation task" â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.5.2 æˆæœ¬æ„ŸçŸ¥é™çº§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  COST-AWARE DEGRADATION                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                             â”‚
â”‚  Context Budget Estimation:                                 â”‚
â”‚  - Remaining context window                                 â”‚
â”‚  - Estimated tokens per subagent                            â”‚
â”‚  - Number of planned subagent calls                         â”‚
â”‚                                                             â”‚
â”‚  Auto-Degradation Rules:                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Budget Level    â”‚ Strategy Adjustment              â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  HIGH (>50%)     â”‚ Full strategy (HYBRID/PARALLEL)  â”‚   â”‚
â”‚  â”‚  MEDIUM (20-50%) â”‚ ENUMERATION_GUIDED only          â”‚   â”‚
â”‚  â”‚  LOW (10-20%)    â”‚ THOROUGH_BASELINE (no subagent)  â”‚   â”‚
â”‚  â”‚  CRITICAL (<10%) â”‚ Quick check + warn user          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  Transparency:                                              â”‚
â”‚  "âš¡ Budget: MEDIUM â€” Using ENUMERATION_GUIDED strategy"    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.5.3 å¤±è´¥è‡ªåŠ¨æ¢å¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AUTO-RECOVERY                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                             â”‚
â”‚  Failure Types and Auto-Actions:                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Failure                â”‚ Auto-Action               â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  Subagent timeout       â”‚ Retry 1x, then degrade    â”‚   â”‚
â”‚  â”‚  Subagent empty result  â”‚ Re-prompt with examples   â”‚   â”‚
â”‚  â”‚  Subagent error         â”‚ Fallback to main agent    â”‚   â”‚
â”‚  â”‚  Inconsistent findings  â”‚ Spawn tiebreaker agent    â”‚   â”‚
â”‚  â”‚  Max rounds reached     â”‚ Report partial + continue â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  Recovery Chain:                                            â”‚
â”‚  1. Retry same strategy (1x)                                â”‚
â”‚  2. Degrade to simpler strategy                             â”‚
â”‚  3. Fallback to main agent                                  â”‚
â”‚  4. Report failure + partial results                        â”‚
â”‚                                                             â”‚
â”‚  Never: Silently fail or lose progress                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.5.4 å¹¶è¡Œæ‰§è¡Œå†³ç­–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PARALLEL EXECUTION CONTROLLER                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                             â”‚
â”‚  Auto-Parallel Conditions:                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Condition                    â”‚ Parallel?           â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  Multiple files, no deps      â”‚ YES - chunk review  â”‚   â”‚
â”‚  â”‚  Sequential fix loop          â”‚ NO - must serialize â”‚   â”‚
â”‚  â”‚  Multiple questions           â”‚ YES - parallel inv. â”‚   â”‚
â”‚  â”‚  Cross-file analysis          â”‚ NO - needs context  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  Merge Strategy:                                            â”‚
â”‚  - Deduplicate findings by (file, line, issue_type)         â”‚
â”‚  - Preserve highest severity rating                         â”‚
â”‚  - Combine evidence from multiple sources                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.5.5 å¤æ‚åº¦è‡ªåŠ¨é˜ˆå€¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  COMPLEXITY THRESHOLDS (Auto-Trigger)                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                             â”‚
â”‚  When to spawn additional agents:                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Trigger                      â”‚ Auto-Action          â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  >5 contracts in SPECIFY      â”‚ Contract Reviewer    â”‚   â”‚
â”‚  â”‚  >10 functions to implement   â”‚ Chunked BUILD        â”‚   â”‚
â”‚  â”‚  >3 security-sensitive files  â”‚ Security Reviewer    â”‚   â”‚
â”‚  â”‚  >50% escape hatches          â”‚ Escape Hatch Auditor â”‚   â”‚
â”‚  â”‚  Circular dependencies found  â”‚ Architecture Review  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  All thresholds are automatic - no user configuration       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Part 5: Prompt Engineering Patterns

### 5.1 Enumeration-First Prompt Pattern

```markdown
## Before Analyzing Any File

1. **Enumerate targets BEFORE reading:**
   ```
   grep "pattern" file â†’ found N instances
   invar_sig file â†’ found M functions
   ```

2. **Create explicit checklist:**
   ```
   â–¡ pattern at line X
   â–¡ pattern at line Y
   â–¡ pattern at line Z
   ```

3. **Process each item explicitly:**
   ```
   âœ“ line X: checked, issue found
   âœ“ line Y: checked, no issue
   âœ“ line Z: checked, issue found
   ```

4. **Verify count before completion:**
   ```
   Checked 3/3 instances of pattern
   ```
```

### 5.2 Fresh Eyes Prompt Pattern

```markdown
## Isolation Prompt Template

You are an independent [ROLE].

CRITICAL RULES:
1. You have NEVER seen this code before
2. You have NO knowledge of how it was developed
3. You are NOT emotionally attached to any solution
4. Your ONLY goal is to [TASK]

INPUT YOU RECEIVE:
- [Files/artifacts to evaluate]

INPUT YOU DO NOT RECEIVE:
- Development conversation
- Previous agent's reasoning
- Author's explanations

OUTPUT:
- [Structured report format]
```

### 5.3 Hybrid Pass Prompt Pattern

```markdown
## Pass 1: Guided Review

Using the issue_map from Phase 0, verify each potential issue:
[issue_map items]

Report: "Verified X/Y items from issue_map"

## Pass 2: Open-Ended Discovery

Forget the issue_map. Read the code as if you've never seen it.
Look for issues NOT in the issue_map:
- Edge cases
- Variant patterns
- Logic errors
- Security issues

Report: "Found N additional issues not in issue_map"

## Merge

Combine findings from both passes, deduplicate.
```

---

## Part 6: å®ç°è·¯çº¿å›¾

### 6.0 å®ç°ç­–ç•¥é€‰æ‹©

**æ ¸å¿ƒæ´å¯Ÿ:** DX-74 çš„å¤§éƒ¨åˆ†æ”¶ç›Šå¯ä»¥é€šè¿‡æç¤ºè¯æ›´æ–°è·å¾—ï¼Œæ— éœ€æ–°å¢ä»£ç æ¨¡å—ã€‚

| æ–¹æ¡ˆ | å¼€å‘æˆæœ¬ | é¢„æœŸæ”¶ç›Š | ROI |
|------|---------|---------|-----|
| **Phase B (è½»é‡çº§)** | ~300 è¡Œæç¤ºè¯ | +10-15% æ£€æµ‹ç‡ | **é«˜** |
| Phase A (å®Œæ•´) | ~1700 è¡Œä»£ç  | +16-20% æ£€æµ‹ç‡ | ä¸­ç­‰ |

**æ¨èè·¯å¾„:** å…ˆå®æ–½ Phase Bï¼ŒéªŒè¯æ•ˆæœåå†å†³å®šæ˜¯å¦éœ€è¦ Phase Aã€‚

---

### 6.1 Phase B: è½»é‡çº§å®æ–½ (âœ… å·²å®Œæˆ)

**ä»…æç¤ºè¯æ›´æ–°ï¼Œæ— æ–°å¢ä»£ç æ¨¡å—ã€‚**

| æ›´æ–° | æ–‡ä»¶ | çŠ¶æ€ |
|------|------|------|
| /review è§„æ¨¡æ„ŸçŸ¥ç­–ç•¥ | `skills/review/SKILL.md` | âœ… v7.0 |
| /develop VALIDATE éš”ç¦» | `skills/develop/SKILL.md` | âœ… v5.1 |
| è§„æ¨¡åˆ†ç±»è§„åˆ™ | Agent è‡ªè¡Œåˆ¤æ–­ | âœ… å†…åµŒ |

**å…³é”®å˜æ›´:**

1. **/review æ·»åŠ è§„æ¨¡åˆ†ç±»:**
   - SMALL (<5 files, <1500 lines): THOROUGH ç­–ç•¥ (ä¸é¢„æšä¸¾)
   - MEDIUM (5-10 files, 1500-5000 lines): HYBRID ç­–ç•¥ (æšä¸¾ + å¼€æ”¾å‘ç°)
   - LARGE (>10 files, >5000 lines): CHUNKED ç­–ç•¥ (åˆ†å—å¹¶è¡Œ)

2. **/develop VALIDATE é˜¶æ®µéš”ç¦»:**
   - éç®€å•å®ç° (>3 functions OR >200 lines) éœ€ spawn éš”ç¦» validator
   - éš”ç¦» validator ä¸æ¥æ”¶å¼€å‘å¯¹è¯ä¸Šä¸‹æ–‡

3. **ç­–ç•¥é€‰æ‹©ç”± Agent åˆ¤æ–­:**
   - æ— éœ€ ScopeAnalyzer ä»£ç æ¨¡å—
   - æç¤ºè¯ä¸­åµŒå…¥åˆ†ç±»è§„åˆ™

---

### 6.2 Phase B éªŒè¯è®¡åˆ’

#### 6.2.1 éªŒè¯ç›®æ ‡

| ç›®æ ‡ | éªŒè¯é—®é¢˜ | æˆåŠŸæ ‡å‡† |
|------|---------|---------|
| å¤§è§„æ¨¡æ¼‚ç§»é˜²æŠ¤ | MEDIUM/LARGE scope æ˜¯å¦é€‰æ‹© HYBRID/CHUNKED? | V4 æ£€æµ‹ç‡ >90% (åŸ 84%) |
| å°è§„æ¨¡æ¸…å•æ€ç»´é¿å… | SMALL scope æ˜¯å¦é€‰æ‹© THOROUGH? | V7 å‘ç°è¾¹ç¼˜å˜ç§ |
| è§„æ¨¡åˆ¤æ–­å‡†ç¡®æ€§ | Agent æ˜¯å¦æ­£ç¡®åˆ†ç±» SMALL/MEDIUM/LARGE? | 90%+ æ­£ç¡®ç‡ |
| éš”ç¦»æ‰§è¡Œ | æ˜¯å¦ spawn ç‹¬ç«‹ subagent? | 100% éµå®ˆéš”ç¦»è§„åˆ™ |

#### 6.2.2 éªŒè¯æ­¥éª¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: V4 åœºæ™¯éªŒè¯ (MEDIUM scope, æ¼‚ç§»é˜²æŠ¤)               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                             â”‚
â”‚  åœºæ™¯: tests/experiments/dx74_attention_drift/scenario_v4/  â”‚
â”‚  è§„æ¨¡: 5 files, ~2600 lines, 50 issues                      â”‚
â”‚  é¢„æœŸç­–ç•¥: HYBRID                                           â”‚
â”‚                                                             â”‚
â”‚  æ‰§è¡Œ:                                                      â”‚
â”‚  1. åœ¨æ–°ä¼šè¯ä¸­è¿è¡Œ /review å¯¹ V4 åœºæ™¯                        â”‚
â”‚  2. è§‚å¯Ÿ: Agent æ˜¯å¦é€‰æ‹© HYBRID ç­–ç•¥?                        â”‚
â”‚  3. è§‚å¯Ÿ: Phase 0 æ˜¯å¦æ‰§è¡Œæšä¸¾?                              â”‚
â”‚  4. è§‚å¯Ÿ: Phase 1+2 æ˜¯å¦ spawn éš”ç¦» agent?                   â”‚
â”‚  5. è®¡ç®—: æ£€æµ‹ç‡ = å‘ç°æ•° / 50                               â”‚
â”‚                                                             â”‚
â”‚  æˆåŠŸæ ‡å‡†: æ£€æµ‹ç‡ >90%, ç­–ç•¥é€‰æ‹©æ­£ç¡®                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: V7 åœºæ™¯éªŒè¯ (SMALL scope, æ¸…å•æ€ç»´é¿å…)            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                             â”‚
â”‚  åœºæ™¯: tests/experiments/dx74_attention_drift/scenario_v7/  â”‚
â”‚  è§„æ¨¡: 5 files, ~2600 lines, 25 issues                      â”‚
â”‚  é¢„æœŸç­–ç•¥: THOROUGH (è¾¹ç•Œæƒ…å†µï¼Œæ¥è¿‘ MEDIUM)                  â”‚
â”‚                                                             â”‚
â”‚  æ‰§è¡Œ:                                                      â”‚
â”‚  1. åœ¨æ–°ä¼šè¯ä¸­è¿è¡Œ /review å¯¹ V7 åœºæ™¯                        â”‚
â”‚  2. è§‚å¯Ÿ: Agent æ˜¯å¦é€‰æ‹© THOROUGH ç­–ç•¥?                      â”‚
â”‚  3. è§‚å¯Ÿ: æ˜¯å¦è·³è¿‡é¢„æšä¸¾ï¼Œç›´æ¥å½»åº•é˜…è¯»?                       â”‚
â”‚  4. è§‚å¯Ÿ: æ˜¯å¦å‘ç° ground_truth ä¹‹å¤–çš„å˜ç§?                  â”‚
â”‚  5. è®¡ç®—: æ£€æµ‹ç‡ = å‘ç°æ•° / 25                               â”‚
â”‚                                                             â”‚
â”‚  æˆåŠŸæ ‡å‡†: æ£€æµ‹ç‡ >=100%, å‘ç°è‡³å°‘ 1 ä¸ªå˜ç§                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: éš”ç¦»éªŒè¯                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                             â”‚
â”‚  åœ¨ Step 1 å’Œ Step 2 ä¸­æ£€æŸ¥:                                 â”‚
â”‚  - æ¯è½®æ˜¯å¦ spawn æ–°çš„éš”ç¦» subagent?                         â”‚
â”‚  - Subagent prompt æ˜¯å¦ä¸åŒ…å«å¼€å‘å¯¹è¯?                       â”‚
â”‚  - å¤šè½® fix loop æ˜¯å¦æ¯è½®éƒ½æ˜¯æ–° agent?                       â”‚
â”‚                                                             â”‚
â”‚  æˆåŠŸæ ‡å‡†: 100% éµå®ˆéš”ç¦»è§„åˆ™                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 6.2.3 éªŒè¯è®°å½•æ¨¡æ¿

```markdown
## DX-75 Phase B éªŒè¯æŠ¥å‘Š

### æµ‹è¯•ä¿¡æ¯
- æ—¥æœŸ: YYYY-MM-DD
- æµ‹è¯•è€…: [name]
- Review skill ç‰ˆæœ¬: v7.0

### V4 åœºæ™¯ç»“æœ
- ç­–ç•¥é€‰æ‹©: [THOROUGH/HYBRID/CHUNKED]
- ç­–ç•¥æ­£ç¡®: [æ˜¯/å¦]
- å‘ç°é—®é¢˜æ•°: [N] / 50
- æ£€æµ‹ç‡: [N%]
- éš”ç¦»éµå®ˆ: [æ˜¯/å¦]

### V7 åœºæ™¯ç»“æœ
- ç­–ç•¥é€‰æ‹©: [THOROUGH/HYBRID/CHUNKED]
- ç­–ç•¥æ­£ç¡®: [æ˜¯/å¦]
- å‘ç°é—®é¢˜æ•°: [N] / 25
- æ£€æµ‹ç‡: [N%]
- å˜ç§å‘ç°: [åˆ—å‡º]
- éš”ç¦»éµå®ˆ: [æ˜¯/å¦]

### ç»“è®º
- [ ] Phase B è¾¾æ ‡ï¼Œæ— éœ€ Phase A
- [ ] Phase B éƒ¨åˆ†è¾¾æ ‡ï¼Œéœ€è¦è°ƒæ•´æç¤ºè¯
- [ ] Phase B ä¸è¶³ï¼Œéœ€è¦å®æ–½ Phase A
```

#### 6.2.4 å¤±è´¥å¤„ç†

| å¤±è´¥æƒ…å†µ | è¯Šæ–­ | ä¿®å¤æ–¹æ¡ˆ |
|---------|------|---------|
| ç­–ç•¥é€‰æ‹©é”™è¯¯ | åˆ†ç±»é˜ˆå€¼ä¸å½“ | è°ƒæ•´ SKILL.md ä¸­é˜ˆå€¼ |
| æ£€æµ‹ç‡ <90% | ç­–ç•¥æ‰§è¡Œä¸å½»åº• | å¼ºåŒ–ç­–ç•¥è¯´æ˜ |
| æœª spawn éš”ç¦» agent | è§„åˆ™æœªéµå®ˆ | æ·»åŠ å¼ºåˆ¶æ£€æŸ¥ |
| å˜ç§æœªå‘ç° | THOROUGH ä¸å¤Ÿå½»åº• | å¢å¼ºå¼€æ”¾å‘ç°æç¤º |

---

### 6.3 Phase A: å®Œæ•´å®æ–½ (å»¶å)

**ä»…åœ¨ Phase B æ•ˆæœä¸è¶³æ—¶å®æ–½ã€‚**

| Component | Location | è§¦å‘æ¡ä»¶ |
|-----------|----------|----------|
| ScopeAnalyzer | `src/invar/core/scope_analyzer.py` | Agent è§„æ¨¡åˆ¤æ–­ä¸å‡† |
| StrategySelector | `src/invar/core/strategy_selector.py` | ç­–ç•¥é€‰æ‹©éœ€è¦æ›´å¤æ‚é€»è¾‘ |
| IsolationManager | `src/invar/shell/isolation.py` | éš”ç¦» spawn éœ€è¦å°è£… |
| AttentionRefreshController | `src/invar/core/attention.py` | è‡ªåŠ¨åˆ·æ–°éœ€è¦ä»£ç æ”¯æŒ |

### 6.4 Phase A Skill Updates (å»¶å)

| Skill | Changes | è§¦å‘æ¡ä»¶ |
|-------|---------|----------|
| /investigate | åˆ†å—æ¢ç´¢ | å¤§è§„æ¨¡æ¢ç´¢æ•ˆæœä¸ä½³ |
| /propose | Devil's Advocate | é€‰é¡¹é—æ¼é—®é¢˜ |
| /audit | åˆå¹¶åˆ° /review --readonly | ç®€åŒ– skill æ•°é‡ |

### 6.5 éªŒè¯ä¸å›å½’

| Test | Method | Success Criteria |
|------|--------|------------------|
| V4 scenario | Run new /review | >95% detection |
| V7 scenario | Run new /review | >100% detection (find variants) |
| Self-review detection | Automated | 100% isolation for self-review |
| Scale-based selection | Various scopes | Correct strategy selected |

---

## Part 7: åºŸå¼ƒé¡¹

### 7.1 åºŸå¼ƒçš„ Skill æ¨¡å¼

| åºŸå¼ƒé¡¹ | åŸå›  | æ›¿ä»£ |
|--------|------|------|
| Same-context self-review | Context contamination | Always isolation |
| /audit as separate skill | Redundant | /review --readonly |
| Manual strategy selection | Error-prone | Auto-detection |
| Single-pass validation | Drift risk | Multi-round with isolation |

### 7.2 åºŸå¼ƒçš„ææ¡ˆ

| ææ¡ˆ | çŠ¶æ€ | å¤„ç† |
|------|------|------|
| DX-74-tiered-attention-defense.md | Superseded | å†…å®¹å·²åˆå¹¶åˆ°æœ¬ææ¡ˆ |

---

## Part 8: æˆåŠŸæŒ‡æ ‡

| Metric | Current | Target | Measurement |
|--------|---------|--------|-------------|
| V4 baseline detection | 84% | 100% | Run experiment |
| V7 edge case detection | 100% (Strategy N) | 120%+ (find variants) | Run experiment |
| Self-review without isolation | Possible | Impossible (blocked) | Code path analysis |
| Strategy selection accuracy | N/A (manual) | 95% | A/B testing |
| False positive rate | N/A | <5% on control files | Control file testing |

---

## Appendices

### Appendix A: ScopeProfile Classification Algorithm

```python
def classify_scope(files: List[Path]) -> ScopeProfile:
    """Classify scope for strategy selection."""
    total_lines = sum(count_lines(f) for f in files)
    file_count = len(files)

    # Complexity estimation
    complexity = estimate_complexity(files)

    # Classification
    if file_count < 5 and total_lines < 3000:
        classification = "SMALL"
    elif file_count < 10 and total_lines < 10000:
        classification = "MEDIUM"
    else:
        classification = "LARGE"

    return ScopeProfile(
        file_count=file_count,
        total_lines=total_lines,
        complexity_score=complexity,
        classification=classification
    )
```

### Appendix B: Isolation Manager API

```python
class IsolationManager:
    """Manages isolated agent spawning."""

    def spawn_reviewer(
        self,
        files: List[Path],
        issue_map: Optional[Dict] = None,
    ) -> ReviewReport:
        """Spawn isolated code reviewer."""

    def spawn_validator(
        self,
        implementation: List[Path],
        contracts: List[Path],
    ) -> ValidationReport:
        """Spawn isolated implementation validator."""

    def spawn_challenger(
        self,
        proposal: str,
    ) -> ChallengeReport:
        """Spawn isolated devil's advocate."""
```

### Appendix C: Strategy Decision Tree

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Analyze Scope   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼              â–¼              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ SMALL  â”‚    â”‚  MEDIUM  â”‚   â”‚  LARGE  â”‚
         â”‚<3K LOC â”‚    â”‚ 3K-10K   â”‚   â”‚ >10K    â”‚
         â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
             â”‚              â”‚              â”‚
             â–¼              â–¼              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚THOROUGH â”‚   â”‚  HYBRID  â”‚   â”‚ CHUNKED  â”‚
        â”‚BASELINE â”‚   â”‚(enum+    â”‚   â”‚ PARALLEL â”‚
        â”‚         â”‚   â”‚ open)    â”‚   â”‚          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Document History

| Version | Date | Changes |
|---------|------|---------|
| 0.1 | 2026-01-02 | Initial draft from DX-74 findings |
| 0.2 | 2026-01-02 | Added Part 4.5: Agent automation mechanisms |
| 0.3 | 2026-01-02 | **Phase B å®æ–½å®Œæˆ**: è½»é‡çº§æç¤ºè¯æ–¹æ¡ˆï¼Œé‡æ„ Part 6 è·¯çº¿å›¾ |
| 0.4 | 2026-01-02 | æ·»åŠ è¯¦ç»†éªŒè¯è®¡åˆ’ (6.2): V4/V7 éªŒè¯æ­¥éª¤ã€è®°å½•æ¨¡æ¿ã€å¤±è´¥å¤„ç† |
| 1.0 | 2026-01-03 | **Phase B Complete**: Archived DX-76, DX-77 (100% complete) |

---

*Generated from DX-74 experiment results. See [DX-74-experiment-report.md](./DX-74-experiment-report.md) for full experimental data.*
