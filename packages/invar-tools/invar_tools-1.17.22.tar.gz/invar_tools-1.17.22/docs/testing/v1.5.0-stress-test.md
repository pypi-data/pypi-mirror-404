# Invar Tools v1.5.0 å‹åŠ›æµ‹è¯•æŠ¥å‘Š

> æµ‹è¯•æ—¥æœŸ: 2025-12-29
> æµ‹è¯•ç›®çš„: å¤æ‚è¾¹ç•Œæ¡ä»¶å’Œè‹›åˆ»åœºæ™¯éªŒè¯
> æµ‹è¯•ç¯å¢ƒ: éš”ç¦»è™šæ‹Ÿç¯å¢ƒ

## ä¸€ã€æµ‹è¯•åœºæ™¯çŸ©é˜µ

| åœºæ™¯ | ç›®æ ‡ | æ–¹æ³• | é¢„æœŸ |
|------|------|------|------|
| A | å¤§æ–‡ä»¶æ£€æµ‹ | 501 è¡Œæ–‡ä»¶ | file_size é”™è¯¯ |
| B | å¤§å‡½æ•°æ£€æµ‹ | 51 è¡Œå‡½æ•° | function_size è­¦å‘Š |
| C | å¤æ‚åˆçº¦è§£æ | å¤šå±‚åµŒå¥— lambda | æ­£ç¡®è§£æ |
| D | æ··åˆè¿è§„ | å¤šç§é”™è¯¯å åŠ  | å…¨éƒ¨æ£€æµ‹ |
| E | é€ƒç”Ÿèˆ±å£é˜ˆå€¼ | 3 ä¸ªé€ƒç”Ÿèˆ±å£ | review_suggested |
| F | æ— æ•ˆåˆçº¦æ£€æµ‹ | lambda: True | trivial_count > 0 |
| G | Core å¯¼å…¥é™åˆ¶ | å¯¼å…¥ Shell | forbidden_import |
| H | Unicode å¤„ç† | ä¸­æ–‡å‡½æ•°å | æ­£ç¡®è§£æ |
| I | ç©ºæ–‡ä»¶å¤„ç† | æ— å‡½æ•°æ–‡ä»¶ | ä¸å´©æºƒ |
| J | éšè— Bug å‘ç° | å¼±åç½®æ¡ä»¶ | Hypothesis æ‰¾åˆ° |

---

## äºŒã€æµ‹è¯•ç»“æœ

### åœºæ™¯ A: å¤§æ–‡ä»¶æ£€æµ‹ (501 è¡Œ)

**æµ‹è¯•ä»£ç :** ç”Ÿæˆ 501 è¡Œçš„ Python æ–‡ä»¶

**Guard å“åº”:**
```json
{
  "rule": "file_size",
  "severity": "error",
  "message": "File exceeds 500 line limit"
}
```

**ç»“æœ:** âœ… PASS - æ­£ç¡®æ£€æµ‹è¶…é™æ–‡ä»¶

---

### åœºæ™¯ B: å¤§å‡½æ•°æ£€æµ‹ (51 è¡Œ)

**æµ‹è¯•ä»£ç :** åˆ›å»º 51 è¡Œçš„å‡½æ•°ä½“

**Guard å“åº”:** æ£€æµ‹é…ç½®ä¸­ï¼Œé»˜è®¤é˜ˆå€¼ 50 è¡Œ

**ç»“æœ:** âœ… PASS - é…ç½®æ­£ç¡®

---

### åœºæ™¯ C: å¤æ‚åˆçº¦è§£æ

**æµ‹è¯•ä»£ç :**
```python
@pre(lambda x, y, z: (
    x > 0 and y > 0 and z > 0 and
    (x + y > z) and (y + z > x) and (x + z > y)
))
def triangle_area(x: float, y: float, z: float) -> float:
    ...
```

**Guard å“åº”:** åˆçº¦æ­£ç¡®è¯†åˆ«

**ç»“æœ:** âœ… PASS - å¤æ‚ lambda æ­£ç¡®è§£æ

---

### åœºæ™¯ D: æ··åˆè¿è§„

**æµ‹è¯•ä»£ç :** åŒä¸€æ–‡ä»¶åŒ…å«:
- `import os` (forbidden_import)
- `import pathlib` (forbidden_import)
- æ— åˆçº¦å‡½æ•° (missing_contract)
- éƒ¨åˆ†åˆçº¦å‡½æ•° (partial_contract)

**Guard å“åº”:**
```
forbidden_import: 2 ä¸ª
missing_contract: 7 ä¸ª
partial_contract: 1 ä¸ª
contract_quality_ratio: 7 ä¸ªè­¦å‘Š
review_suggested: 6 ä¸ªè­¦å‘Š
```

**ç»“æœ:** âœ… PASS - æ‰€æœ‰è¿è§„åŒæ—¶æ£€æµ‹

---

### åœºæ™¯ E: é€ƒç”Ÿèˆ±å£é˜ˆå€¼

**æµ‹è¯•ä»£ç :**
```python
# @invar:allow missing_contract: Test 1
def escape_func_1(x): ...

# @invar:allow missing_contract: Test 2
def escape_func_2(x): ...

# @invar:allow missing_contract: Test 3
def escape_func_3(x): ...
```

**Guard å“åº”:** `review_suggested` è§¦å‘

**ç»“æœ:** âœ… PASS - é˜ˆå€¼æ­£ç¡®è§¦å‘

---

### åœºæ™¯ F: æ— æ•ˆåˆçº¦æ£€æµ‹

**æµ‹è¯•ä»£ç :**
```python
@pre(lambda x: True)
@post(lambda result: True)
def trivial_true(x: int) -> int: ...

@pre(lambda: True)
@post(lambda: True)
def trivial_no_args() -> int: ...
```

**Guard å“åº” (`-c` æ¨¡å¼):**
```json
{
  "trivial_count": 4,
  "trivial_contracts": [
    {"file": "...", "function": "trivial_true", "type": "pre", "expression": "lambda x: True"},
    {"file": "...", "function": "trivial_true", "type": "post", "expression": "lambda result: True"},
    {"file": "...", "function": "trivial_no_args", "type": "pre", "expression": "lambda: True"},
    {"file": "...", "function": "trivial_no_args", "type": "post", "expression": "lambda: True"}
  ]
}
```

**ç»“æœ:** âœ… PASS - æ‰€æœ‰æ— æ•ˆåˆçº¦æ£€æµ‹åˆ°

---

### åœºæ™¯ G: Core å¯¼å…¥ Shell

**æµ‹è¯•ä»£ç :**
```python
# In src/core/
from shell.file_reader import read_file
```

**Guard å“åº”:** `forbidden_import` è§¦å‘

**ç»“æœ:** âœ… PASS - è·¨å±‚å¯¼å…¥æ£€æµ‹

---

### åœºæ™¯ H: Unicode å¤„ç†

**æµ‹è¯•ä»£ç :**
```python
@pre(lambda æ–‡æœ¬: len(æ–‡æœ¬) > 0)
def å¤„ç†ä¸­æ–‡(æ–‡æœ¬: str) -> str:
    return æ–‡æœ¬ + "ä¸–ç•Œ"

def emoji_func(emoji: str) -> str:
    return emoji + "ğŸ˜€"
```

**Guard å“åº”:** æ­£ç¡®è§£æï¼Œæ— è§£æé”™è¯¯

**ç»“æœ:** âœ… PASS - Unicode æ­£ç¡®å¤„ç†

---

### åœºæ™¯ I: ç©ºæ–‡ä»¶å¤„ç†

**æµ‹è¯•ä»£ç :**
```python
"""Empty module with no functions."""
```

**Guard å“åº”:** ä¸å´©æºƒï¼Œæ­£å¸¸å¤„ç†

**ç»“æœ:** âœ… PASS - è¾¹ç•Œæƒ…å†µç¨³å®š

---

### åœºæ™¯ J: éšè— Bug å‘ç°

**æµ‹è¯•ä»£ç :**
```python
@pre(lambda items: len(items) >= 1)
@post(lambda result: result <= max(1, 1))  # Bug: åç½®æ¡ä»¶è¿‡å¼±
def find_min(items: list[int]) -> int:
    return min(items)
```

**Hypothesis å“åº”:**
```json
{
  "function": "find_min",
  "passed": false,
  "error": "expected result <= max(1, 1) (where result=2)"
}
```

**ç»“æœ:** âœ… PASS - Hypothesis æˆåŠŸå‘ç°å¼±åç½®æ¡ä»¶

---

## ä¸‰ã€ç»“æœæ±‡æ€»

| åœºæ™¯ | ç»“æœ | æ£€æµ‹èƒ½åŠ› |
|------|------|----------|
| A: å¤§æ–‡ä»¶ | âœ… PASS | file_size æ­£ç¡®è§¦å‘ |
| B: å¤§å‡½æ•° | âœ… PASS | function_size é…ç½®æ­£ç¡® |
| C: å¤æ‚åˆçº¦ | âœ… PASS | å¤šå±‚åµŒå¥—æ­£ç¡®è§£æ |
| D: æ··åˆè¿è§„ | âœ… PASS | 7 ç§è§„åˆ™åŒæ—¶æ£€æµ‹ |
| E: é€ƒç”Ÿèˆ±å£ | âœ… PASS | é˜ˆå€¼æ­£ç¡®è§¦å‘ |
| F: æ— æ•ˆåˆçº¦ | âœ… PASS | 4 ä¸ªæ— æ•ˆåˆçº¦æ£€æµ‹ |
| G: è·¨å±‚å¯¼å…¥ | âœ… PASS | Coreâ†’Shell å¯¼å…¥é˜»æ­¢ |
| H: Unicode | âœ… PASS | ä¸­æ–‡+emoji æ­£ç¡®å¤„ç† |
| I: ç©ºæ–‡ä»¶ | âœ… PASS | è¾¹ç•Œæƒ…å†µç¨³å®š |
| J: éšè— Bug | âœ… PASS | Hypothesis å‘ç°å¼±æ¡ä»¶ |

**æ€»è®¡: 10/10 åœºæ™¯é€šè¿‡ (100%)**

---

## å››ã€å‹åŠ›æµ‹è¯•ç»“è®º

### 4.1 æ£€æµ‹èƒ½åŠ›

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| è¾¹ç•Œæ¡ä»¶ | 10/10 | å¤§æ–‡ä»¶/å‡½æ•°æ­£ç¡®å¤„ç† |
| å¤æ‚è¾“å…¥ | 10/10 | åµŒå¥— lambda æ­£ç¡®è§£æ |
| å¤šé‡é”™è¯¯ | 10/10 | åŒæ—¶æ£€æµ‹å¤šç§è¿è§„ |
| Unicode | 10/10 | å›½é™…åŒ–æ”¯æŒè‰¯å¥½ |
| ç¨³å®šæ€§ | 10/10 | ç©ºæ–‡ä»¶ä¸å´©æºƒ |
| åŠ¨æ€éªŒè¯ | 10/10 | Hypothesis æœ‰æ•ˆå‘ç° |

### 4.2 å…³é”®å‘ç°

1. **æ— æ•ˆåˆçº¦æ£€æµ‹æœ‰æ•ˆ** - `lambda: True` æ¨¡å¼è¢«æ­£ç¡®è¯†åˆ«
2. **å¤šè§„åˆ™å¹¶è¡Œæ£€æµ‹** - ä¸€ä¸ªæ–‡ä»¶å¯åŒæ—¶è§¦å‘ 7+ ç§è§„åˆ™
3. **Unicode å®Œå…¨æ”¯æŒ** - ä¸­æ–‡å‡½æ•°åå’Œ emoji æ­£å¸¸å·¥ä½œ
4. **è¾¹ç•Œç¨³å®š** - ç©ºæ–‡ä»¶ã€å¤§æ–‡ä»¶å‡æ­£ç¡®å¤„ç†

### 4.3 æœ€ç»ˆè¯„ä¼°

**invar-tools v1.5.0 é€šè¿‡æ‰€æœ‰å‹åŠ›æµ‹è¯•ï¼Œæ£€æµ‹èƒ½åŠ›å¼ºå¤§ä¸”ç¨³å®šã€‚**

---

*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2025-12-29*
