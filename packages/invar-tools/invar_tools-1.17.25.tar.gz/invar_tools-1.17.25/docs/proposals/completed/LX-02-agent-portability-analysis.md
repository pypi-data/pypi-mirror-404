# LX-02: Agent Portability Analysis

**Status:** âœ… Complete (Research)
**Created:** 2025-12-28
**Series:** LX (Language/Platform eXtension)
**Related:** LX-01 (Multi-language feasibility)
**Informs:** LX-03 (docs), LX-04 (framework design)

---

## Executive Summary

Invar ç›®å‰æ·±åº¦ç»‘å®š Claude Code çš„æœºåˆ¶ï¼ˆSkills, Hooks, CLAUDE.md, MCPï¼‰ã€‚æœ¬æ–‡æ¡£åˆ†æè¿™äº›æœºåˆ¶åœ¨ 6 ä¸ªä¸»æµ coding agent ä¸­çš„é€‚ç”¨æ€§ï¼Œä¸º Invar çš„è·¨å¹³å°ç­–ç•¥æä¾›ä¾æ®ã€‚

**å…³é”®å‘ç°:**
- **SKILL.md** æˆä¸ºäº‹å®æ ‡å‡† (Claude Code, Pi, Codex CLI å‡æ”¯æŒ)
- **CLI** æ˜¯çœŸæ­£çš„é€šç”¨æ¥å£ (æ‰€æœ‰ agent å¯è°ƒç”¨ `invar guard`)
- **MCP** å¹¿æ³›ä½†éæ™®é€‚ (Pi æ˜ç¡®æ‹’ç» MCP ä½œä¸ºè®¾è®¡å†³ç­–)
- **AGENTS.md** æ–°å…´ä¸Šä¸‹æ–‡æ ‡å‡† (Pi, Codex CLI ä½¿ç”¨)
- **Hooks** åˆ†åŒ–ä¸¥é‡ (Claude=Bash, Pi=TypeScript, Cursor=JSON)
- **æŒ‡ä»¤æ–‡ä»¶** å„ agent æœ‰ä¸åŒæ ¼å¼ (CLAUDE.md, SYSTEM.md, AGENTS.md, .cursorrules, .clinerules, CONVENTIONS.md)

---

## Part 1: Invar æœºåˆ¶æ¸…å•

### 1.1 å½“å‰ä½¿ç”¨çš„æœºåˆ¶

| æœºåˆ¶ | æ–‡ä»¶/ç›®å½• | åŠŸèƒ½ | Claude Code ç‰¹æœ‰? |
|------|-----------|------|-------------------|
| **CLAUDE.md** | `CLAUDE.md` | é¡¹ç›®æŒ‡ä»¤ | âœ… æ˜¯ |
| **Skills** | `.claude/skills/` | å¯å¤ç”¨å·¥ä½œæµ | âœ… æ˜¯ |
| **Commands** | `.claude/commands/` | ç”¨æˆ·å¯è°ƒç”¨å‘½ä»¤ | âœ… æ˜¯ |
| **Hooks** | `.claude/hooks/` | å·¥å…·è°ƒç”¨æ‹¦æˆª | âš ï¸ ä»… Cursor 1.7+ ç±»ä¼¼ |
| **Settings** | `.claude/settings.local.json` | æƒé™é…ç½® | âœ… æ˜¯ |
| **MCP Server** | `invar.mcp` | å·¥å…·æš´éœ² | âœ… é€šç”¨æ ‡å‡† |
| **System Reminder** | æ³¨å…¥åˆ°å¯¹è¯ | ä¸Šä¸‹æ–‡æé†’ | âš ï¸ å®ç°æ–¹å¼ä¸åŒ |
| **Context Files** | `.invar/context.md` | é¡¹ç›®çŠ¶æ€ | âŒ çº¯æ–‡ä»¶ |
| **Examples** | `.invar/examples/` | æ¨¡å¼ç¤ºä¾‹ | âŒ çº¯æ–‡ä»¶ |

### 1.2 æœºåˆ¶ä¾èµ–å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Claude Code Specific                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Skills  â”‚ â”‚Commands â”‚ â”‚ Hooks   â”‚ â”‚ Settings.json   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚       â”‚           â”‚           â”‚                â”‚            â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                   â”‚           â”‚                             â”‚
â”‚                   â–¼           â–¼                             â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚              â”‚     CLAUDE.md       â”‚                        â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Portable Layer         â”‚                                   â”‚
â”‚                         â–¼                                   â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚              â”‚    MCP Server       â”‚  â† å”¯ä¸€é€šç”¨æ¥å£         â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                         â”‚                                   â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚       â–¼                 â–¼                 â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚context.mdâ”‚    â”‚examples/  â”‚     â”‚Pure Files â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Part 2: ä¸»æµ Coding Agent å¯¹æ¯”

> **æ›´æ–° 2025-12-29:** ç§»é™¤ Continueï¼Œæ·»åŠ  Pi å’Œ Codex CLIã€‚

### 2.1 æœºåˆ¶æ”¯æŒçŸ©é˜µ

| æœºåˆ¶ | Claude Code | Pi | Codex CLI | Cursor | Cline | Aider |
|------|-------------|-------|-----------|--------|-------|-------|
| **æŒ‡ä»¤æ–‡ä»¶** | CLAUDE.md | SYSTEM.md | AGENTS.md | .cursorrules | .clinerules | CONVENTIONS.md |
| **ä¸Šä¸‹æ–‡æ–‡ä»¶** | - | AGENTS.md | AGENTS.md | - | - | - |
| **ç›®å½•è§„åˆ™** | .claude/ | .pi/ | .codex/ | .cursor/rules/ | - | - |
| **Hooks** | âœ… 4ç§ | âœ… TypeScript | âŒ | âœ… 6ç§ | âŒ | âŒ |
| **Skills** | âœ… SKILL.md | âœ… SKILL.md | âœ… SKILL.md | âŒ | âŒ | âŒ |
| **Commands** | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ |
| **MCP** | âœ… | âŒ (è®¾è®¡å†³ç­–) | âœ… | âœ… | âœ… | âš ï¸ ç¤¾åŒº |
| **Plan Mode** | âŒ | âŒ (ç”¨æ–‡ä»¶) | âŒ | âŒ | âœ… | âŒ |
| **è‡ªåŠ¨æµ‹è¯•** | âŒ | âŒ | âŒ | âŒ | âŒ | âœ… lint-cmd |

**å…³é”®å‘ç°:**
- **SKILL.md æ˜¯äº‹å®æ ‡å‡†:** Claude Code, Pi, Codex CLI éƒ½æ”¯æŒ
- **AGENTS.md æ–°å…´æ ‡å‡†:** Pi å’Œ Codex éƒ½ä½¿ç”¨ AGENTS.md ä½œä¸ºä¸Šä¸‹æ–‡æ–‡ä»¶
- **Hooks åˆ†åŒ–:** Claude (Bash), Pi (TypeScript), Cursor (JSON+è„šæœ¬)

### 2.2 è¯¦ç»†åˆ†æ

#### Claude Code

```
.claude/
â”œâ”€â”€ settings.local.json    # æƒé™ã€MCP é…ç½®
â”œâ”€â”€ commands/              # ç”¨æˆ·å¯è°ƒç”¨å‘½ä»¤ (markdown)
â”œâ”€â”€ hooks/                 # å·¥å…·æ‹¦æˆª (Bash scripts)
â”‚   â”œâ”€â”€ PreToolUse.sh
â”‚   â”œâ”€â”€ PostToolUse.sh
â”‚   â”œâ”€â”€ UserPromptSubmit.sh
â”‚   â””â”€â”€ Stop.sh
â””â”€â”€ skills/                # Agent å¯è°ƒç”¨å·¥ä½œæµ (SKILL.md)
    â””â”€â”€ {name}/SKILL.md
```

**Hooks (4ç§):**
- `PreToolUse`: å·¥å…·æ‰§è¡Œå‰ï¼Œå¯é˜»æ­¢
- `PostToolUse`: å·¥å…·æ‰§è¡Œåï¼Œå¯ä¿®æ”¹è¾“å‡º
- `UserPromptSubmit`: ç”¨æˆ·æ¶ˆæ¯æäº¤æ—¶
- `Stop`: ä¼šè¯ç»“æŸæ—¶

**ä¼˜åŠ¿:** æœ€å®Œæ•´çš„æ‰©å±•ä½“ç³»ï¼ŒMCP + Skills + Hooks
**åŠ£åŠ¿:** ä¸è·Ÿéšç¬¦å·é“¾æ¥ (å®‰å…¨ç‰¹æ€§)

#### Pi (shittycodingagent.ai)

```
~/.pi/agent/
â”œâ”€â”€ settings.json          # é…ç½®
â”œâ”€â”€ auth.json              # API å‡­è¯
â”œâ”€â”€ AGENTS.md              # å…¨å±€ä¸Šä¸‹æ–‡
â”œâ”€â”€ SYSTEM.md              # ç³»ç»Ÿæç¤ºè¦†ç›–
â”œâ”€â”€ commands/              # è‡ªå®šä¹‰å‘½ä»¤ (*.md)
â”œâ”€â”€ skills/                # å…¨å±€ Skills (SKILL.md)
â””â”€â”€ themes/                # ä¸»é¢˜æ–‡ä»¶

.pi/                       # é¡¹ç›®çº§é…ç½®
â”œâ”€â”€ AGENTS.md              # é¡¹ç›®ä¸Šä¸‹æ–‡
â”œâ”€â”€ SYSTEM.md              # é¡¹ç›®ç³»ç»Ÿæç¤º
â”œâ”€â”€ commands/              # é¡¹ç›®å‘½ä»¤
â””â”€â”€ skills/                # é¡¹ç›® Skills
```

**Hooks (TypeScript):**
- æœ‰çŠ¶æ€ TypeScript æ¨¡å—
- UI å¸®åŠ©å™¨ (selects, confirms, inputs, notifications)
- è‡ªç”±å½¢å¼äº‹ä»¶å‘é€

**Skills:** æ”¯æŒ SKILL.md æ ¼å¼ (Agent Skills æ ‡å‡†)

**è®¾è®¡å“²å­¦ (æ•…æ„ä¸åš):**
- âŒ **No MCP** â€” "build CLI tools with READMEs instead"
- âŒ **No Plan Mode** â€” ç”¨æ–‡ä»¶å†™è®¡åˆ’
- âŒ **No To-dos** â€” ä½¿ç”¨ TODO.md æ–‡ä»¶
- âŒ **No Sub-agents** â€” ç”¨ tmux å¯åŠ¨æ–° pi å®ä¾‹
- âŒ **No Permission Popups** â€” YOLO æ¨¡å¼

**æ ¸å¿ƒå·¥å…·:** read, write, edit, bash (ä»… 4 ä¸ª)

**ä¼˜åŠ¿:** æç®€ã€é€æ˜ã€ä½ä¸Šä¸‹æ–‡å¼€é”€ (~1000 tokens)
**åŠ£åŠ¿:** æ—  MCPï¼Œéœ€è¦æ‰‹åŠ¨æ„å»ºå·¥å…·é›†æˆ

> **å‚è€ƒ:** [What I learned building an opinionated and minimal coding agent](https://mariozechner.at/posts/2025-11-30-pi-coding-agent/)

#### Codex CLI (OpenAI)

```
~/.codex/
â”œâ”€â”€ config.toml            # TOML é…ç½®
â”œâ”€â”€ AGENTS.md              # å…¨å±€æŒ‡ä»¤ (32KB é™åˆ¶)
â””â”€â”€ skills/                # ç”¨æˆ· Skills

.codex/
â”œâ”€â”€ AGENTS.md              # é¡¹ç›®æŒ‡ä»¤
â””â”€â”€ skills/                # é¡¹ç›® Skills (SKILL.md)
```

**MCP æ”¯æŒ:**
- å®Œæ•´ MCP å®¢æˆ·ç«¯æ”¯æŒ
- å¯é…ç½® STDIO æˆ– SSE æœåŠ¡å™¨
- `codex mcp` å‘½ä»¤ç®¡ç†
- **Codex å¯ä½œä¸º MCP æœåŠ¡å™¨è¿è¡Œ**

**Skills:** æ”¯æŒ SKILL.md æ ¼å¼ (Agent Skills æ ‡å‡†)
- ä½ç½®ä¼˜å…ˆçº§: PROJECT > USER > ADMIN > SYSTEM
- Frontmatter å…ƒæ•°æ®: name, description

**AGENTS.md å‘ç°:**
1. `~/.codex/AGENTS.md` (å…¨å±€)
2. ä»ä»“åº“æ ¹ç›®å½•å‘ä¸‹éå†
3. åé¢çš„æ–‡ä»¶è¦†ç›–å‰é¢çš„

**å…³é”®ç‰¹æ€§:**
- æ²™ç®±æ‰§è¡Œ (read-only / workspace-write / full-access)
- Web æœç´¢ (å¯é€‰)
- ä¼šè¯æ¢å¤ (`codex resume`)
- IDE æ‰©å±• (VS Code, Cursor)
- GitHub Actions é›†æˆ
- GPT-5.2-Codex æ¨¡å‹ä¼˜åŒ–

**ä¼˜åŠ¿:** OpenAI å®˜æ–¹ã€æ²™ç®±å®‰å…¨ã€MCP åŒå‘æ”¯æŒ
**åŠ£åŠ¿:** æ—  Hooks

> **å‚è€ƒ:** [Codex CLI Documentation](https://developers.openai.com/codex/cli/)

#### Cursor (1.7+)

```
.cursor/
â”œâ”€â”€ rules/                 # MDC æ ¼å¼è§„åˆ™æ–‡ä»¶
â”‚   â””â”€â”€ *.mdc
â””â”€â”€ hooks.json             # Hook é…ç½®
```

**Hooks (6ç§):**
- `beforeSubmitPrompt`: æç¤ºæäº¤å‰
- `beforeShellExecution`: Shell å‘½ä»¤å‰ï¼Œå¯é˜»æ­¢
- `beforeMCPExecution`: MCP è°ƒç”¨å‰
- `beforeReadFile`: æ–‡ä»¶è¯»å–å‰
- `afterFileEdit`: æ–‡ä»¶ç¼–è¾‘å (ç”¨äºæ ¼å¼åŒ–)
- `stop`: ä¼šè¯ç»“æŸ

**é…ç½®æ ¼å¼:** JSON (hooks.json) + è„šæœ¬æ–‡ä»¶

**ä¼˜åŠ¿:** Hooks æœ€å®Œæ•´ (6 ç§)ï¼ŒMCP æ”¯æŒ
**åŠ£åŠ¿:** æ—  Skills ç³»ç»Ÿ

> **å‚è€ƒ:** [Cursor Hooks Documentation](https://cursor.com/docs/agent/hooks)

#### Cline (VS Code)

```
.clinerules              # é¡¹ç›®çº§è§„åˆ™ (æ–‡ä»¶æˆ–ç›®å½•)
.vscode/mcp.json         # MCP æœåŠ¡å™¨é…ç½®
```

**ç‰¹ç‚¹:**
- Plan & Act æ¨¡å¼åˆ†ç¦»
- MCP å®Œæ•´æ”¯æŒ (å¯åŠ¨æ€åˆ›å»ºå·¥å…·)
- æ—  Hook ç³»ç»Ÿ
- æ—  Skills ç³»ç»Ÿ

**MCP äº®ç‚¹:** "add a tool" å‘½ä»¤å¯è®© Cline è‡ªåŠ¨åˆ›å»º MCP æœåŠ¡å™¨

**ä¼˜åŠ¿:** å¼€æºï¼Œ4M+ ç”¨æˆ·ï¼ŒPlan Mode
**åŠ£åŠ¿:** æ—  Hookï¼Œæ—  Skills

#### Aider

```
.aider.conf.yml           # YAML é…ç½®
CONVENTIONS.md            # ç¼–ç çº¦å®š (--read åŠ è½½)
.aiderignore              # å¿½ç•¥æ–‡ä»¶
```

**ç‰¹ç‚¹:**
- çº¦å®šæ–‡ä»¶ä½œä¸ºæŒä¹…è®°å¿†
- `lint-cmd` è‡ªåŠ¨éªŒè¯ (æ¯æ¬¡ç¼–è¾‘åè¿è¡Œ)
- Git-aware ç¼–è¾‘
- æ—  Hook ç³»ç»Ÿ

**MCP çŠ¶æ€:**
- åŸç”Ÿæ”¯æŒ: å¾…å®š (Issue #3314, 185+ ğŸ‘)
- ç¤¾åŒºæœåŠ¡å™¨: å¤šä¸ª MCP-Aider æ¡¥æ¥é¡¹ç›®

**ä¼˜åŠ¿:** ç®€å•ï¼Œlint-cmd è‡ªåŠ¨éªŒè¯å¾ªç¯
**åŠ£åŠ¿:** æ—  Hookï¼Œæ—  Skillsï¼ŒMCP å¾…æ”¯æŒ

---

## Part 3: å¯ç§»æ¤æ€§è¯„ä¼°

### 3.1 Invar æœºåˆ¶å¯ç§»æ¤æ€§

| Invar æœºåˆ¶ | å¯ç§»æ¤æ€§ | ç§»æ¤ç­–ç•¥ |
|------------|----------|----------|
| **USBV å·¥ä½œæµ** | âœ… é«˜ | å†™å…¥ä»»ä½•æŒ‡ä»¤æ–‡ä»¶ |
| **Check-In/Final** | âœ… é«˜ | å†™å…¥æŒ‡ä»¤æ–‡ä»¶ |
| **Guard (MCP)** | âš ï¸ ä¸­ | MCP å¹¿æ³›æ”¯æŒï¼Œä½† Pi æ‹’ç» MCP |
| **Guard (CLI)** | âœ… é«˜ | æ‰€æœ‰ agent å¯è°ƒç”¨ CLI |
| **Context.md** | âœ… é«˜ | çº¯æ–‡ä»¶ï¼Œä»»ä½• agent å¯è¯» |
| **Examples/** | âœ… é«˜ | çº¯æ–‡ä»¶ |
| **Skills (SKILL.md)** | âœ… é«˜ | Claude Code, Pi, Codex å‡æ”¯æŒ |
| **Hooks æ‹¦æˆª** | âš ï¸ ä½ | Claude (Bash), Pi (TS), Cursor (JSON) å„ä¸å…¼å®¹ |
| **è‡ªåŠ¨è·¯ç”±** | âš ï¸ ä¸­ | éœ€è¦ skill æˆ–ç±»ä¼¼æœºåˆ¶ |

### 3.2 æ ¸å¿ƒä»·å€¼åˆ†æ

```
Invar ä»·å€¼å±‚æ¬¡:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 1: ç†å¿µ (100% å¯ç§»æ¤)                            â”‚
â”‚  â”œâ”€â”€ USBV å·¥ä½œæµ                                        â”‚
â”‚  â”œâ”€â”€ Core/Shell åˆ†ç¦»                                    â”‚
â”‚  â”œâ”€â”€ å¥‘çº¦é©±åŠ¨å¼€å‘                                       â”‚
â”‚  â””â”€â”€ å¯¹æŠ—æ€§å®¡æŸ¥                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 2: å·¥å…· (CLI 100%, MCP ~80%)                     â”‚
â”‚  â”œâ”€â”€ invar guard                                        â”‚
â”‚  â”œâ”€â”€ invar sig                                          â”‚
â”‚  â””â”€â”€ invar map                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 2.5: Skills (SKILL.md æ ‡å‡†, ~50%)                â”‚
â”‚  â””â”€â”€ Claude Code, Pi, Codex CLI æ”¯æŒ                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 3: é›†æˆ (å¹³å°ç‰¹å®š, ~20%)                         â”‚
â”‚  â”œâ”€â”€ Hooks (Claude/Pi/Cursor, æ ¼å¼å„å¼‚)                 â”‚
â”‚  â”œâ”€â”€ Commands (Claude/Pi/Codex)                         â”‚
â”‚  â””â”€â”€ è‡ªåŠ¨è·¯ç”± (éœ€ Skills æ”¯æŒ)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 å…³é”®æ´å¯Ÿ

> **SKILL.md æ˜¯æ–°å…´è·¨å¹³å°æ ‡å‡†**
>
> Claude Code, Pi, Codex CLI éƒ½æ”¯æŒ SKILL.md æ ¼å¼ (Agent Skills æ ‡å‡†)ã€‚
> è¿™æ„å‘³ç€ Invar çš„ Skills å¯ä»¥è·¨ 50% çš„ CLI agent ä½¿ç”¨ã€‚

> **MCP å¹¿æ³›ä½†éæ™®é€‚**
>
> å¤§å¤šæ•° agent æ”¯æŒ MCPï¼Œä½† Pi æ˜ç¡®æ‹’ç» MCP (è®¾è®¡å†³ç­–: "build CLI tools with READMEs")ã€‚
> å¯¹äº Piï¼Œåº”ä½¿ç”¨ CLI fallback (invar guard å‘½ä»¤è€Œé MCP å·¥å…·)ã€‚

> **AGENTS.md æ˜¯æ–°å…´ä¸Šä¸‹æ–‡æ ‡å‡†**
>
> Pi å’Œ Codex CLI éƒ½ä½¿ç”¨ AGENTS.md ä½œä¸ºä¸Šä¸‹æ–‡æ–‡ä»¶ã€‚
> æœªæ¥å¯è€ƒè™‘ç”Ÿæˆ AGENTS.md ä½œä¸ºè¡¥å……æ ¼å¼ã€‚

> **Hooks å®Œå…¨åˆ†åŒ–**
>
> ä¸‰ç§ Hook å®ç°å®Œå…¨ä¸å…¼å®¹:
> - Claude Code: Bash è„šæœ¬ (PreToolUse, PostToolUse, etc.)
> - Pi: TypeScript æ¨¡å— (æœ‰çŠ¶æ€, UI å¸®åŠ©å™¨)
> - Cursor: JSON é…ç½® + è„šæœ¬ (6 ç§ hook ç±»å‹)

---

## Part 4: ç§»æ¤ç­–ç•¥

### 4.1 ä¸‰å±‚ç§»æ¤æ–¹æ¡ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tier 1: é€šç”¨æŒ‡ä»¤å±‚ (æ‰€æœ‰ agent)                            â”‚
â”‚                                                             â”‚
â”‚  åˆ›å»º INVAR.md é€šç”¨ç‰ˆæœ¬:                                    â”‚
â”‚  - USBV å·¥ä½œæµæè¿°                                          â”‚
â”‚  - Core/Shell è§„åˆ™                                          â”‚
â”‚  - å¥‘çº¦è¦æ±‚                                                 â”‚
â”‚  - éªŒè¯æ­¥éª¤ (CLI æˆ– MCP)                                    â”‚
â”‚                                                             â”‚
â”‚  + é€‚é…æ–‡ä»¶:                                                â”‚
â”‚  - CLAUDE.md (Claude Code)                                  â”‚
â”‚  - SYSTEM.md + AGENTS.md (Pi)                               â”‚
â”‚  - AGENTS.md (Codex CLI)                                    â”‚
â”‚  - .cursorrules (Cursor)                                    â”‚
â”‚  - .clinerules (Cline)                                      â”‚
â”‚  - CONVENTIONS.md (Aider)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tier 2: å·¥å…·å±‚                                             â”‚
â”‚                                                             â”‚
â”‚  MCP (Claude, Codex, Cursor, Cline):                        â”‚
â”‚  - invar_guard(), invar_sig(), invar_map()                  â”‚
â”‚                                                             â”‚
â”‚  CLI Fallback (Pi, Aider, æˆ–ä»»ä½• agent):                    â”‚
â”‚  - invar guard, invar sig, invar map                        â”‚
â”‚                                                             â”‚
â”‚  é…ç½®æ–¹å¼:                                                  â”‚
â”‚  - Claude Code: settings.local.json                         â”‚
â”‚  - Codex CLI: config.toml mcpServers                        â”‚
â”‚  - Cursor: MCP é…ç½®                                         â”‚
â”‚  - Cline: MCP è®¾ç½®                                          â”‚
â”‚  - Pi/Aider: æ— éœ€é…ç½®ï¼Œç›´æ¥è°ƒç”¨ CLI                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tier 3: å¢å¼ºå±‚ (ç‰¹å®š agent)                                â”‚
â”‚                                                             â”‚
â”‚  Claude Code / Pi / Codex:                                  â”‚
â”‚  - Skills (SKILL.md, è‡ªåŠ¨è·¯ç”±)                              â”‚
â”‚  - Commands (ç”¨æˆ·è°ƒç”¨)                                      â”‚
â”‚                                                             â”‚
â”‚  Claude Code + Pi + Cursor:                                 â”‚
â”‚  - Hooks (æ ¼å¼å„å¼‚ï¼Œéœ€å•ç‹¬é€‚é…)                             â”‚
â”‚                                                             â”‚
â”‚  Cline:                                                     â”‚
â”‚  - Custom Roles                                             â”‚
â”‚  - Plan Mode é›†æˆ                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 `invar init` å¤š Agent æ”¯æŒ

```bash
# å½“å‰
invar init                    # ç”Ÿæˆ Claude Code é…ç½®

# å»ºè®®æ‰©å±•
invar init --agent=claude     # Claude Code (é»˜è®¤)
invar init --agent=pi         # Pi (shittycodingagent)
invar init --agent=codex      # Codex CLI
invar init --agent=cursor     # Cursor
invar init --agent=cline      # Cline
invar init --agent=aider      # Aider
invar init --agent=universal  # ä»…ç”Ÿæˆé€šç”¨æŒ‡ä»¤ + CLI
```

### 4.3 ç”Ÿæˆæ–‡ä»¶æ˜ å°„

| Agent | æŒ‡ä»¤æ–‡ä»¶ | ä¸Šä¸‹æ–‡æ–‡ä»¶ | MCP | Hooks | Skills |
|-------|----------|------------|-----|-------|--------|
| Claude Code | CLAUDE.md | - | âœ… settings.json | âœ… .claude/hooks/ | âœ… |
| Pi | SYSTEM.md | AGENTS.md | âŒ | âœ… .pi/hooks/ (TS) | âœ… |
| Codex CLI | - | AGENTS.md | âœ… config.toml | âŒ | âœ… |
| Cursor | .cursorrules | - | âœ… | âœ… .cursor/hooks.json | âŒ |
| Cline | .clinerules | - | âœ… | âŒ | âŒ |
| Aider | CONVENTIONS.md | - | âš ï¸ ç¤¾åŒº | âŒ | âŒ |

---

## Part 5: åŠŸèƒ½é™çº§çŸ©é˜µ

### 5.1 Hook ä¾èµ–åŠŸèƒ½çš„é™çº§

| åŸåŠŸèƒ½ | Claude Code | Pi | Codex/Cursor/Cline/Aider | é™çº§ç­–ç•¥ |
|--------|-------------|-----|--------------------------|----------|
| pytest æ‹¦æˆª | âœ… Hook | âœ… Hook (TS) | âŒ æ— æ³•é˜»æ­¢ | æŒ‡ä»¤ä¸­è¯´æ˜ "ä½¿ç”¨ invar guard è€Œé pytest" |
| è‡ªåŠ¨è·¯ç”± | âœ… Skill | âœ… Skill | âš ï¸ æœ‰é™ | SKILL.md (Codex) æˆ–æŒ‡ä»¤ä¸­å†™æ˜è§¦å‘è¯ |
| åè®®åˆ·æ–° | âœ… Hook | âœ… Hook | âŒ æ— æ³¨å…¥ | ä¾èµ–æŒ‡ä»¤æ–‡ä»¶ï¼Œç”¨æˆ·æ‰‹åŠ¨è§¦å‘ |

### 5.2 åŠŸèƒ½å¯ç”¨æ€§çŸ©é˜µ

| åŠŸèƒ½ | Claude | Pi | Codex | Cursor | Cline | Aider |
|------|--------|-----|-------|--------|-------|-------|
| USBV å·¥ä½œæµ | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… |
| Guard (MCP) | âœ… | âŒ | âœ… | âœ… | âœ… | âš ï¸ ç¤¾åŒº |
| Guard (CLI) | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… |
| Skills | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ |
| Hooks | âœ… | âœ… | âŒ | âœ… | âŒ | âŒ |
| å‘½ä»¤æ‹¦æˆª | âœ… | âœ… | âŒ | âœ… | âŒ | âœ… lint-cmd |
| è‡ªåŠ¨è·¯ç”± | âœ… | âœ… | âœ… | âŒ | âš ï¸ Modes | âŒ |
| å¯¹æŠ—æ€§å®¡æŸ¥ | âœ… Skill | âœ… Skill | âœ… Skill | âœ… æŒ‡ä»¤ | âœ… æŒ‡ä»¤ | âœ… æŒ‡ä»¤ |

---

## Part 6: å»ºè®®è¡ŒåŠ¨

### 6.1 çŸ­æœŸ (ä½æˆæœ¬)

1. **åˆ›å»º INVAR-UNIVERSAL.md**
   - æå– CLAUDE.md ä¸­ä¸ Claude Code æ— å…³çš„å†…å®¹
   - ä½œä¸ºæ‰€æœ‰ agent çš„åŸºç¡€æŒ‡ä»¤
   - åŒ…å« USBV å·¥ä½œæµã€å¥‘çº¦è¦æ±‚ã€éªŒè¯æ­¥éª¤

2. **æ–‡æ¡£åŒ–å·¥å…·è°ƒç”¨æ–¹å¼**
   - MCP é…ç½®ç¤ºä¾‹ (Claude, Codex, Cursor, Cline)
   - CLI fallback ç¤ºä¾‹ (Pi, Aider)

3. **æµ‹è¯• SKILL.md è·¨å¹³å°å…¼å®¹æ€§**
   - éªŒè¯ç°æœ‰ Skills åœ¨ Pi å’Œ Codex ä¸­å·¥ä½œ
   - è°ƒæ•´å…ƒæ•°æ®æ ¼å¼ä»¥æ»¡è¶³å„å¹³å°è¦æ±‚

### 6.2 ä¸­æœŸ (éœ€å¼€å‘)

4. **æ‰©å±• `invar init`**
   - æ·»åŠ  `--agent` å‚æ•°
   - ç”Ÿæˆé€‚é…çš„é…ç½®æ–‡ä»¶

5. **åˆ›å»ºé€‚é…å™¨æ¨¡æ¿**
   - `SYSTEM.md.jinja` + `AGENTS.md.jinja` (Pi)
   - `AGENTS.md.jinja` (Codex CLI)
   - `.cursorrules.jinja` (Cursor)
   - `.clinerules.jinja` (Cline)
   - `CONVENTIONS.md.jinja` (Aider)

6. **TypeScript Hooks é€‚é… (Pi)**
   - ç§»æ¤ pytest æ‹¦æˆªé€»è¾‘åˆ° TypeScript
   - åˆ©ç”¨ Pi çš„ UI å¸®åŠ©å™¨å¢å¼ºä½“éªŒ

### 6.3 é•¿æœŸ (æˆ˜ç•¥)

7. **SKILL.md æ ‡å‡†è´¡çŒ®**
   - å‚ä¸ Agent Skills æ ‡å‡†åˆ¶å®š
   - ç¡®ä¿ Invar Skills æ ¼å¼å…¼å®¹

8. **ç¤¾åŒºè´¡çŒ®**
   - Cline æ’ä»¶
   - Aider MCP é›†æˆ (å¾…å®˜æ–¹æ”¯æŒå)

---

## Part 7: ç»“è®º

### 7.1 å¯ç§»æ¤æ€§æ€»ç»“

```
                        å¯ç§»æ¤æ€§
                            â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                         â”‚                         â”‚
  â–¼                         â–¼                         â–¼
ç†å¿µ 100%              å·¥å…· ~90%              é›†æˆ ~50%
USBV å·¥ä½œæµ           CLI (Guard/Sig/Map)    Skills (SKILL.md)
Core/Shell            MCP (å¤§å¤šæ•° agent)     Hooks (æ ¼å¼åˆ†åŒ–)
å¥‘çº¦é©±åŠ¨              çº¯æ–‡ä»¶ (context.md)    Commands
```

### 7.2 å…³é”®ç»“è®º

1. **Invar çš„æ ¸å¿ƒä»·å€¼å®Œå…¨å¯ç§»æ¤**
   - USBV å·¥ä½œæµã€å¥‘çº¦é©±åŠ¨ã€Core/Shell åˆ†ç¦»æ˜¯ç†å¿µ
   - å¯ä»¥é€šè¿‡ä»»ä½• agent çš„æŒ‡ä»¤æ–‡ä»¶è¡¨è¾¾

2. **CLI æ˜¯çœŸæ­£çš„é€šç”¨æ¥å£**
   - `invar guard/sig/map` CLI å‘½ä»¤åœ¨æ‰€æœ‰ agent ä¸­å¯ç”¨
   - MCP è¦†ç›–å¤§å¤šæ•° agent (Pi ä¾‹å¤–)

3. **SKILL.md æˆä¸ºè·¨å¹³å°æ ‡å‡†**
   - Claude Code, Pi, Codex CLI å‡æ”¯æŒ
   - 50% çš„ä¸»æµ CLI agent å¯å¤ç”¨ Skills

4. **Hooks å®Œå…¨åˆ†åŒ–ä½†å¯æ˜ å°„**
   - Claude (Bash), Pi (TypeScript), Cursor (JSON) æ ¼å¼ä¸åŒ
   - æ ¸å¿ƒé€»è¾‘å¯ç§»æ¤ï¼Œéœ€è¦æ ¼å¼é€‚é…

5. **AGENTS.md æ–°å…´æ ‡å‡†**
   - Pi å’Œ Codex éƒ½ä½¿ç”¨ AGENTS.md
   - æœªæ¥å¯ä½œä¸ºè¡¥å……ä¸Šä¸‹æ–‡æ ¼å¼

### 7.3 æ¨èç­–ç•¥

**æ‹¥æŠ±æ ‡å‡†ï¼Œæ¥å—å·®å¼‚:**

```
Tier 1: å®Œæ•´ä½“éªŒ (Skills + Hooks + MCP/CLI)
â”œâ”€â”€ Claude Code: Skills + Bash Hooks + MCP
â””â”€â”€ Pi: Skills + TS Hooks + CLI

Tier 2: è‰¯å¥½ä½“éªŒ (Skills/Rules + MCP)
â”œâ”€â”€ Codex CLI: Skills + MCP
â””â”€â”€ Cursor: Rules + Hooks + MCP

Tier 3: åŸºç¡€ä½“éªŒ (Rules + MCP)
â””â”€â”€ Cline: Rules + MCP

Tier 4: æœ€å°ä½“éªŒ (Conventions + CLI)
â””â”€â”€ Aider: Conventions + lint-cmd + CLI
```

æ¯ä¸ªå±‚çº§éƒ½èƒ½ä½¿ç”¨ Invar çš„æ ¸å¿ƒä»·å€¼ï¼Œåªæ˜¯ä¾¿åˆ©æ€§å’Œè‡ªåŠ¨åŒ–ç¨‹åº¦ä¸åŒã€‚

---

## References

### Agent Documentation

- [Aider Configuration](https://aider.chat/docs/config.html)
- [Cline GitHub](https://github.com/cline/cline)
- [Codex CLI Documentation](https://github.com/openai/codex)
- [Cursor Hooks Documentation](https://cursor.com/docs/agent/hooks)
- [Cursor Rules Documentation](https://cursor.com/docs/context/rules)
- [Pi Coding Agent](https://shittycodingagent.ai/)
- [Pi Design Philosophy](https://mariozechner.at/posts/2025-11-30-pi-coding-agent/)

### Standards

- [Agent Skills Specification](https://github.com/anthropics/claude-code/tree/main/docs/skills)
- [Model Context Protocol](https://www.anthropic.com/news/model-context-protocol)
- [MCP Joins Linux Foundation](https://github.blog/open-source/maintainers/mcp-joins-the-linux-foundation-what-this-means-for-developers-building-the-next-era-of-ai-tools-and-agents/)

---

*Research completed 2025-12-28, updated 2025-12-29 (Pi, Codex CLI)*
