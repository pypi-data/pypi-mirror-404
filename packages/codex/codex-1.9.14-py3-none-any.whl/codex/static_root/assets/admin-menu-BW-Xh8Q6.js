import{_ as S,af as L,cR as y,y as s,v as a,b as f,C as c,I as n,z as g,c as r,D as w,G as p,E as O,x as C,A as d,w as m,F as b,B as F,U as D,bF as R,H as A,cS as U,bD as V,a1 as x}from"./main-GE3uFePF.js";import{s as N,A as k}from"./forwardRefs-RdtHqDjs.js";import{C as B}from"./change-password-dialog-BDkTBQoq.js";import{useAdminStore as h}from"./admin-BA9ToWAP.js";import{a as v}from"./VDivider-Rdtf6zpf.js";import{y as J,a as P,C as E}from"./confirm-footer-CXU8cmV4.js";import{T as Q}from"./index-CLgxatJ5.js";import"./VForm-BZgaRj-J.js";import"./VSelectionControl-C8DQf56i.js";const M="Create Covers",z="Find Orphan Covers",G="Remove Covers",q="Aggregate tags from Comics",W="Create Comics",j="Create Tags",H="Create Custom Covers",K="Mark failed Failed Imports",X="Clean up Failed Imports",Y="Query Failed Imports",Z="Update Failed Imports",$="Update timestamps for Browser Groups",tt="Link Tags",et="Link Custom Covers",st="Query Comics",at="Query Tag Links",nt="Query Missing Tags",rt="Query Missing Custom Covers",ot="Remove Comics",it="Remove Folders",ut="Read tags from Comics",ct="Remove Custom Covers",lt="Create Search Index Entries",mt="Update Search Index Entries",dt="Update Comics",pt="Update Tags",Ct="Update Custom Covers",ht="Adopt Orphan Folders",It="Cleanup Orphan Tags",St="Update Codex Server Software",_t="Backup Database",Tt="Optimize Database",bt="Check Integrity Of Entire Database",kt="Check Integrtity Of Database Foreign Keys",ft="Check Integrity Of Full Text Virtual Table",gt="Check Codex Latest Version",wt="Cleanup Orphan Bookmarks",vt="Cleanup Old Sessions",Lt="Cleanup Orphan Covers",yt="Rebuild Full Text Search Virtual Table",Ot="Restart Codex Server",Ft="Stop Codex Server",Dt="Optimize Search Virtual Table",Rt="Clean Orphan Search Entries",At="Clear Full Text Search Table",Ut="Sync New Search Entries",Vt="Sync Old Search Entries",xt="Poll Library",Nt={CCC:M,CFO:z,CRC:G,IAT:q,ICC:W,ICT:j,ICV:H,IFC:K,IFD:X,IFQ:Y,IFU:Z,IGU:$,ILT:tt,ILV:et,IQC:st,IQL:at,IQT:nt,IQV:rt,IRC:ot,IRF:it,IRT:ut,IRV:ct,ISC:lt,ISU:mt,IUC:dt,IUT:pt,IUV:Ct,JAF:ht,JCT:It,JCU:St,JDB:_t,JDO:Tt,JID:bt,JIF:kt,JIS:ft,JLV:gt,JRB:wt,JRS:vt,JRV:Lt,JSR:yt,RCR:Ot,RCS:Ft,SIO:Dt,SIR:Rt,SIX:At,SSC:Ut,SSU:Vt,WPO:xt},Bt={name:"AdminStatusListItem",props:{status:{type:Object,required:!0},now:{type:Number,required:!0}},computed:{showComplete(){return Number.isInteger(this.status.complete)},showNumbers(){return this.showComplete||Number.isInteger(this.status.total)},indeterminate(){return this.status.active&&(!this.status.total||!Number.isInteger(this.status.complete))},progress(){return!this.status.total||globalThis.indeterminate?0:100*+this.status.complete/+this.status.total},title(){return Nt[this.status.statusType]},activeTime(){return new Date(this.status.active).getTime()},duration(){return this.status.active?y(this.activeTime,this.now):""}},methods:{nf(e){return Number.isInteger(e)?L.format(e):"?"}}},Jt={class:"statusItem"},Pt={class:"statusItemTitle"},Et={key:0,class:"statusItemDetails"},Qt={key:0,class:"statusItemSubtitle"},Mt={key:1,class:"statusItemProgress"},zt={key:0,class:"statusItemProgressNumbers"},Gt={key:0},qt={key:1,class:"statusItemDuration"};function Wt(e,i,o,_,u,t){return s(),a("div",Jt,[f("div",Pt,c(t.title),1),o.status.subtitle||t.showNumbers||t.duration?(s(),a("div",Et,[o.status.subtitle?(s(),a("div",Qt,c(o.status.subtitle),1)):n("",!0),t.showNumbers||t.duration?(s(),a("div",Mt,[t.showNumbers?(s(),a("span",zt,[t.showComplete?(s(),a("span",Gt,c(t.nf(o.status.complete))+" / ",1)):n("",!0),g(" "+c(t.nf(o.status.total)),1)])):n("",!0),t.duration?(s(),a("span",qt,c(t.duration),1)):n("",!0)])):n("",!0)])):n("",!0),r(N,{indeterminate:t.indeterminate,"model-value":t.progress,bottom:""},null,8,["indeterminate","model-value"])])}const jt=S(Bt,[["render",Wt],["__scopeId","data-v-de699e9e"]]),Ht={name:"AdminStatusList",components:{CloseButton:B,StatusListItem:jt},data(){return{now:Date.now()}},computed:{...p(O,{isSettingsDrawerOpen:e=>e.isSettingsDrawerOpen}),...p(h,{librarianStatuses:e=>e.librarianStatuses,show:e=>e.librarianStatuses.length>0})},created(){this.load()},watch:{show(e){e&&this.updateTime()},isSettingsDrawerOpen(e){e&&this.updateTime()}},mounted(){this.updateTime()},methods:{...w(h,["loadTable","librarianTask"]),load(){this.loadTable("LibrarianStatus")},clear(){this.librarianTask("librarian_clear_status","")},updateTime(){this.now=Date.now(),setTimeout(()=>{this.isSettingsDrawerOpen&&this.show&&this.updateTime()},1e3)}}},Kt={key:0};function Xt(e,i,o,_,u,t){const l=C("CloseButton"),I=C("StatusListItem");return s(),a(b,null,[e.show?(s(),d(v,{key:0})):n("",!0),r(P,{onClick:t.load},{default:m(()=>[r(k,null,{default:m(()=>[e.show?(s(),a("div",Kt,[r(l,{id:"clearButton",title:"Clear Librarian Statuses",size:"small",onClick:t.clear},null,8,["onClick"]),i[0]||(i[0]=f("h4",null,"Librarian Tasks",-1)),(s(!0),a(b,null,F(e.librarianStatuses,T=>(s(),d(k,{key:T.id},{default:m(()=>[r(I,{status:T,now:u.now},null,8,["status","now"])]),_:2},1024))),128))])):(s(),d(J,{key:1,id:"noTasksRunning"},{default:m(()=>[...i[1]||(i[1]=[g(" No librarian tasks running ",-1)])]),_:1}))]),_:1})]),_:1},8,["onClick"])],64)}const Yt=S(Ht,[["render",Xt],["__scopeId","data-v-70b7439e"]]),Zt={name:"AdminMenu",components:{AdminStatusList:Yt,CodexListItem:E},data(){return{mdiOpenInNew:x,mdiDatabaseClockOutline:V,mdiCrownOutline:U}},computed:{...p(A,["isUserAdmin"]),...p(h,["unseenFailedImports"]),failedImportsIcon(){return this.unseenFailedImports?R:void 0},showAdminPanelLink(){return!this.$router.currentRoute?.value?.name?.startsWith("admin")}},methods:{...w(h,["clearFailedImports","librarianTask"]),onPoll(){this.librarianTask("poll")}}},$t={key:0};function te(e,i,o,_,u,t){const l=C("CodexListItem"),I=C("AdminStatusList");return e.isUserAdmin?(s(),a("div",$t,[r(v),D(r(l,{title:"Poll All Libraries","prepend-icon":u.mdiDatabaseClockOutline,onClick:t.onPoll},null,8,["prepend-icon","onClick"]),[[Q,{openDelay:2e3,text:"for updated comics"}]]),t.showAdminPanelLink?(s(),d(l,{key:0,class:"adminPanelLink",to:{name:"admin"},"prepend-icon":u.mdiCrownOutline,title:"Admin Panel","append-icon":t.failedImportsIcon},null,8,["prepend-icon","append-icon"])):n("",!0),r(I)])):n("",!0)}const le=S(Zt,[["render",te]]);export{le as default};
