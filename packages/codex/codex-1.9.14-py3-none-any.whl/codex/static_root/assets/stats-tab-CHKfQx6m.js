import{ch as j,_ as C,af as I,v as i,b as n,C as f,c as l,w as g,y as c,F as p,B as _,d as K,a7 as B,I as L,l as y,D as P,ci as w,cj as v,ck as x,aO as D,G as h,E as G,x as m,z as N}from"./main-GE3uFePF.js";import{V as R}from"./VTable-BzHndA6M.js";import{C as E}from"./clipboard-YPo4v7k1.js";import{C as V}from"./confirm-dialog-K-DI-wAR.js";import{useAdminStore as T}from"./admin-BA9ToWAP.js";import"./forwardRefs-RdtHqDjs.js";import"./confirm-footer-CXU8cmV4.js";function z(e,t={}){return e?j(e,{delimiter:".",...t}):""}function U(e,t={}){return z(e,{delimiter:"_",...t})}const F={name:"StatsTable",props:{title:{type:String,required:!0},items:{type:Object,required:!0}},data(){return{}},methods:{valueTable(e){return e&&typeof e=="object"?e:{}},tdClasses(e){return{indent:e[0]==="+"}},tdLabel(e){return e.replace(/^\+/,"")},nf(e){return typeof e=="number"?I.format(e):e}}},H={class:"statBlock"},M={key:0},$={colspan:"2",class:"subtitleRow"},q={key:1},X={class:"indent"};function Y(e,t,a,s,u,o){return c(),i("div",H,[n("h3",null,f(a.title),1),l(R,{class:"highlight-table"},{default:g(()=>[(c(!0),i(p,null,_(Object.entries(a.items),([r,d])=>(c(),i("tbody",{key:r},[typeof d=="object"?(c(),i("tr",M,[n("th",$,f(r),1)])):(c(),i("tr",q,[n("td",{class:K(o.tdClasses(r))},f(o.tdLabel(r)),3),n("td",null,f(o.nf(d)),1)])),(c(!0),i(p,null,_(Object.entries(o.valueTable(d)),([b,O])=>(c(),i("tr",{key:b},[n("td",X,f(b),1),n("td",null,f(o.nf(O)),1)]))),128))]))),128)),B(e.$slots,"default",{},void 0,!0)]),_:3})])}const J=C(F,[["render",Y],["__scopeId","data-v-4bb3ecd9"]]),S={topGroup:D,orderBy:x,fitTo:v,readingDirection:w},k={authGroupCount:"Authorization Groups",libraryCount:"Libraries",userAnonymousCount:"Anonymous Users",userRegisteredCount:"Registered Users"};Object.freeze(k);Object.freeze(S);const A=new Set(["creditPersonsCount","creditRolesCount","identifierSourcesCount","storyArcNumbersCount"]);Object.freeze(A);const Q={name:"AdminTasksTab",components:{ClipBoard:E,ConfirmDialog:V,StatsTable:J},data(){return{showTooltip:{show:!1},schemaHref:globalThis.CODEX.API_V3_PATH+"#/api/api_v3_admin_stats_retrieve"}},computed:{...h(G,{}),...h(T,{stats:e=>e.stats}),apiTooltip(){return this.clipBoardEnabled},platformTable(){const e={};for(const[t,a]of Object.entries(this.stats?.platform)){const s=this.keyToLabel(t),u=t==="system"?`${a.name} ${a.release}`:a;e[s]=u}return e},configTable(){const e={};for(const[t,a]of Object.entries(this.stats?.config)){if(t=="apiKey")continue;const s=k[t];e[s]=a}return e},userSettingsTable(){const e={};for(const[t,a]of Object.entries(this.stats?.sessions)){const s={},u=S[t];for(const[r,d]of Object.entries(a)){let b;b=u?u[U(r)]:r,s[b]=d}const o=this.keyToLabel(t);e[o]=s}return e},browserGroupsTable(){const e={};for(const[t,a]of Object.entries(this.stats?.groups)){let s=this.keyToLabel(t);s!=="Series"&&(s+="s"),e[s]=a}return e},fileTypesTable(){const e={};for(const[t,a]of Object.entries(this.stats?.fileTypes)){const s=t==="unknown"?y(t):this.keyToLabel(t).toUpperCase();e[s]=a}return e},metadataTable(){const e={};for(const[t,a]of Object.entries(this.stats?.metadata)){let s=t==="countryCount"?"Countries":this.keyToLabel(t)+"s";A.has(t)&&(s=s.replace(/^\w+ /,"+")),e[s]=a}return e}},created(){this.loadStats()},methods:{...P(T,["loadStats","updateAPIKey"]),regenAPIKey(){this.updateAPIKey().then(this.loadStats).catch(console.warn)},keyToLabel(e){return e=e.replace(/Count$/,""),y(e)}}},W={key:0,id:"stats"},Z={id:"schemaDoc"},ee={colspan:"2"},te=["href"];function se(e,t,a,s,u,o){const r=m("StatsTable"),d=m("ClipBoard"),b=m("ConfirmDialog");return e.stats?(c(),i("div",W,[l(r,{title:"Platform",items:o.platformTable},null,8,["items"]),l(r,{title:"Config",items:o.configTable},{default:g(()=>[n("tbody",null,[l(d,{class:"apiKey",tooltip:"Copy API Key",title:"API Key",text:e.stats.config.apiKey},null,8,["text"]),n("tr",Z,[n("td",ee,[n("div",null,[t[0]||(t[0]=N(" The only endpoint accessible by API Key is ",-1)),n("a",{href:u.schemaHref,target:"_blank"},"/admin/stats",8,te)]),l(b,{"button-text":"Regenerate API Key","title-text":"Regenerate",text:"API Key","confirm-text":"Regenerate",onConfirm:o.regenAPIKey},null,8,["onConfirm"])])])])]),_:1},8,["items"]),l(r,{title:"User Settings",items:o.userSettingsTable},null,8,["items"]),l(r,{title:"Browser Groups",items:o.browserGroupsTable},null,8,["items"]),l(r,{title:"File Types",items:o.fileTypesTable},null,8,["items"]),l(r,{title:"Metadata",items:o.metadataTable},null,8,["items"])])):L("",!0)}const ue=C(Q,[["render",se],["__scopeId","data-v-c5f2ab2b"]]);export{ue as default};
