import{_ as g,v as r,b as l,C as c,F as u,B as h,D as b,G as C,E as x,x as S,y as a,d as R,A as f,c as v}from"./main-GE3uFePF.js";import{C as A}from"./confirm-dialog-K-DI-wAR.js";import{useAdminStore as I}from"./admin-BA9ToWAP.js";import{V as y}from"./forwardRefs-RdtHqDjs.js";import{c as N}from"./VSelect-3XsB4Bnk.js";import"./confirm-footer-CXU8cmV4.js";import"./VSelectionControl-C8DQf56i.js";import"./ssrBoot-B0pswZbJ.js";import"./VDivider-Rdtf6zpf.js";import"./VCheckboxBtn-B7AyxNoj.js";const _=[{title:"Libraries",tasks:[{value:"poll",title:"Poll All Libraries",desc:"Update Libraries if changes detected"},{value:"poll_force",title:"Force Update All Libraries",desc:"Forcibly update all comics in all libraries",confirm:"This can take a long time"},{value:"force_update_all_failed_imports",title:"Update All Failed Imports",desc:"Forcibly update all failed imports in all libraries",confirm:"This can take a long time"},{value:"watchdog_sync",title:"Sync Watchdog with DB",desc:"Ensure the Watchdog file watcher is enabled per database preferences for each library"},{value:"import_abort",title:"Abort Running Import",desc:"Abort the current running import after the current import subtask is complete"}]},{title:"Covers",tasks:[{value:"purge_comic_covers",title:"Remove Comic Covers",desc:"from every library",confirm:"Are you sure?"},{value:"create_all_comic_covers",title:"Create All Comic Covers",desc:"Pre-generate covers for every comic in every library and all custom covers",confirm:"Are you sure?"},{value:"force_update_groups",title:"Update Group Timestamps",desc:"Force the update of group timestamps. Will bust the browser cache for browser views and covers."}]},{title:"Search Index",tasks:[{value:"search_index_optimize",title:"Optimize Search Index",desc:"Merge Search Index for optimal lookup time. Runs nightly."},{value:"search_index_remove_stale",title:"Clean Stale Index Entries",desc:"Clean search index entries that are no longer in the library."},{value:"search_index_clear",title:"Clear Search Index",desc:"of all entries",confirm:"Are you sure? Resyncing the search index can take a while."},{value:"db_fts_integrity_check",title:"Integrity Check Search Index",desc:"Repairs Search Index on failure. Runs nightly"},{value:"db_fts_rebuild",title:"Repair Search Index",desc:"Probably faster than Rebuild if the integrity check fails."},{value:"search_index_abort",title:"Abort Search Index Sync",desc:"Aborts search index sync tasks."},{value:"search_index_update",title:"Sync Search Index",desc:"with recently changed comics.",confirm:"This can take a long time"},{value:"search_index_rebuild",title:"Rebuild Search Index Using Sync.",desc:"Delete and rebuild the search index from scratch using the syncer.",confirm:"This can take a long time"}]},{title:"Database",tasks:[{value:"db_vacuum",title:"Optimize & Compact Database",desc:"Run the sqlite3 OPTIMIZE and VACUUM pragmas. Runs nightly"},{value:"db_backup",title:"Backup Database",desc:"Runs nightly"},{value:"db_foreign_key_check",title:"Remove Illegal Foreign Keys",desc:"Check for and remove illegal foreign keys. Mark affected comics for update. Runs nightly."},{value:"db_integrity_check",title:"Check Database Integrity",desc:"Check logs for results. Runs nightly.",confirm:"Can take a while on large databases, Are you sure?"}]},{title:"Codex Software",tasks:[{value:"codex_latest_version",title:"Check for Codex Latest Version",desc:"Check PyPi for the latest version of Codex"},{value:"codex_update",title:"Update Codex",desc:"If Codex updates to a new version, it will restart",confirm:"Are you sure?"},{value:"codex_restart",title:"Restart Codex Server",desc:"Immediately",confirm:"Are you sure?"},{value:"codex_shutdown",title:"Shutdown Codex Server",desc:"Immediately",confirm:"Are you sure?"}]},{title:"Cleanup",tasks:[{value:"cleanup_fks",title:"Remove Orphan Tags",desc:"After deleting comics, unused linked objects remain in case new comics use them. Runs nightly."},{value:"cleanup_db_custom_covers",title:"Remove Orphan Database Custom Covers",desc:"Remove Custom Covers from the db that no longer represent custom cover images on disk. Runs nightly."},{value:"cleanup_sessions",title:"Cleanup Sessions",desc:"Remove corrupt and expired sessions. Runs nightly."},{value:"cleanup_covers",title:"Remove Orphan Cover Thumbnails",desc:"no longer have source comics or custom images. Runs nightly."},{value:"cleanup_bookmarks",title:"Remove Orphan Bookmarks",desc:"Owned by no session or user. Runs nightly."},{value:"adopt_folders",title:"Adopt Orphan Folders",desc:"Move orphaned folders from the top of the folder tree to under their correct parent. Runs nightly and at startup."},{value:"librarian_clear_status",title:"Clear Librarian Statuses",desc:"Mark all Librarian tasks finished."},{value:"janitor_nightly",title:"Run Nightly Maintenance",desc:"Runs several tasks above that also run nightly.",confirm:"Launches several tasks that run nightly anyway."}]},{title:"Notify",tasks:[{value:"notify_admin_flags_changed",title:"Notify Admin Flags Changed",desc:"Notify all users that admin flags have changed."},{value:"notify_bookmark_changed",title:"Notify Bookmark Changed",desc:"Notify only your user that a bookmark changed."},{value:"notify_covers_changed",title:"Notify Covers Changed",desc:"Notify all users that covers have changed."},{value:"notify_failed_imports_changed",title:"Notify Failed Imports Changed",desc:"Notify admin users that failed imports have changed"},{value:"notify_groups_changed",title:"Notify Groups Changed",desc:"Notify all users that ACL groups have changed."},{value:"notify_library_changed",title:"Notify Library Changed ",desc:"Notify all users libraries have changed."},{value:"notify_librarian_status",title:"Notify Librarian Status",desc:"Notify admin users that a librarian job status changed.."},{value:"notify_users_changed",title:"Notify Users Changed",desc:"Notify one user that their users changed or all users if a user was deleted."}]}],m=["Notify"];Object.freeze(m);const T={name:"AdminTasksTab",components:{ConfirmDialog:A},data(){return{SELECT_GROUPS:m,selectValues:{Notify:"notify_library_changed"},tasks:_}},computed:{...C(x,{formSuccess:e=>e.form.success,formErrors:e=>e.form.errors}),selectMaps(){const e={};for(const i of _)if(m.includes(i.title)){e[i.title]={};for(const o of i.tasks)e[i.title][o.value]=o}return e}},methods:{...b(I,["librarianTask"]),selectAttr(e,i){const o=this.selectValues[e];return this.selectMaps[e][o][i]}}},w={id:"tasks"},L={key:0,id:"success"},D={key:1,id:"error"},V={key:2,id:"noRecentTask"},E={key:0},U={class:"taskBox"},B={class:"taskDesc"},O={key:1,class:"taskBox"},F={class:"taskDesc"};function M(e,i,o,P,n,d){const p=S("ConfirmDialog");return a(),r("div",w,[l("div",null,[i[0]||(i[0]=l("span",{id:"lastTaskLabel"},"Last Task Queued:",-1)),l("span",null,[e.formSuccess?(a(),r("span",L,c(e.formSuccess),1)):e.formErrors&&e.formErrors.length>0?(a(),r("span",D,[(a(!0),r(u,null,h(e.formErrors,t=>(a(),r("span",{key:t},c(t),1))),128))])):(a(),r("span",V,"No recent task"))])]),(a(!0),r(u,null,h(n.tasks,t=>(a(),r("div",{key:t.title,"fixed-header":"",class:"taskGroup"},[l("h3",null,c(t.title),1),n.SELECT_GROUPS.includes(t.title)?(a(),r("div",O,[v(N,{items:t.tasks,"model-value":n.selectValues[t.title],"onUpdate:modelValue":s=>n.selectValues[t.title]=s},null,8,["items","model-value","onUpdate:modelValue"]),v(y,{block:"",onClick:s=>e.librarianTask(n.selectValues[t.title],d.selectAttr(t.title,"title")),text:d.selectAttr(t.title,"title")},null,8,["onClick","text"]),l("div",F,c(d.selectAttr(t.title,"desc")),1)])):(a(),r("div",E,[(a(!0),r(u,null,h(t.tasks,s=>(a(),r("div",{key:s.value,class:R(["trow",{selected:!1}])},[l("div",U,[s.confirm?(a(),f(p,{key:0,"button-text":s.title,"title-text":s.title,text:s.confirm,block:!0,"confirm-text":"Confirm",onConfirm:k=>e.librarianTask(s.value,s.title)},null,8,["button-text","title-text","text","onConfirm"])):(a(),f(y,{key:1,block:"",onClick:k=>e.librarianTask(s.value,s.title),text:s.title},null,8,["onClick","text"])),l("div",B,c(s.desc),1)])]))),128))]))]))),128))])}const X=g(T,[["render",M],["__scopeId","data-v-8cd7a7dc"]]);export{X as default};
