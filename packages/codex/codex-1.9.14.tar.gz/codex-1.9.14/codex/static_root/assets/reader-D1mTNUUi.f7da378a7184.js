const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pdf-doc-maKpFua9.js","assets/main-GE3uFePF.js","assets/main-Cv5PLQ_F.css","assets/pdf-doc-DxqOo2k2.css","assets/pager-full-pdf-C8eH6D19.js","assets/settings-drawer-Bnvsy2g6.js","assets/forwardRefs-RdtHqDjs.js","assets/forwardRefs-D1jOvm_E.css","assets/unauthorized-DqdR05bx.js","assets/confirm-footer-CXU8cmV4.js","assets/confirm-footer-DBKmcTc1.css","assets/clipboard-YPo4v7k1.js","assets/clipboard-vzZ88YT8.css","assets/change-password-dialog-BDkTBQoq.js","assets/VForm-BZgaRj-J.js","assets/VSelectionControl-C8DQf56i.js","assets/VSelectionControl-CICLzgAa.css","assets/VForm-DxBt30-N.css","assets/admin-BA9ToWAP.js","assets/change-password-dialog-DL8UMjmX.css","assets/ssrBoot-B0pswZbJ.js","assets/unauthorized-DVYECNJs.css","assets/VDivider-Rdtf6zpf.js","assets/VDivider-DgidWd6w.css","assets/settings-drawer-BPfq3H-L.css","assets/VWindowItem-IxINW856.js","assets/VWindowItem-DqNaT6b1.css","assets/VSelect-3XsB4Bnk.js","assets/VCheckboxBtn-B7AyxNoj.js","assets/VSelect-Bk-liKeO.css","assets/pagination-toolbar-Cwa8vQVJ.js","assets/VTable-BzHndA6M.js","assets/VTable-BsI6FsWH.css","assets/confirm-dialog-K-DI-wAR.js","assets/confirm-dialog-YfC8mRQA.css","assets/pagination-toolbar-BbNgwRh-.css","assets/VExpansionPanels-8fCmipaL.js","assets/VExpansionPanels-Dyw0hWW-.css","assets/VRadioGroup-BCJFYNjv.js","assets/VRadioGroup-Cp9mZ7cb.css","assets/VCheckbox-CH2Hzy3v.js","assets/VCheckbox-CvH8ekHL.css","assets/index-CLgxatJ5.js","assets/index-Czf-fUM7.css"])))=>i.map(i=>d[i]);
import{_ as b,D as y,am as u,G as f,A as m,w as p,d as D,I as B,x as h,y as d,c as n,z as R,C as A,v as S,ac as ke,F as $,an as ot,ao as st,m as ee,ap as at,aq as fe,ar as be,J as ve,n as O,as as ye,at as K,au as nt,U as x,a7 as rt,av as it,aw as _e,B as N,q as Pe,b as r,ax as lt,E as Se,ay as ct,az as dt,aA as ut,g as we,aB as Ce,u as Te,p as Re,aC as Be,L as De,aD as ht,aE as pt,a as j,aF as gt,aG as mt,aH as kt,aI as ft,aJ as bt,aK as vt,aL as yt,H as U,ad as _t,a1 as Pt,aM as St,Q as wt,R as Ct,S as Tt,T as Rt,aN as Bt,aO as Dt,aP as It,aQ as $t,N as te,aR as Lt,X as xt,aS as Ie,aT as At}from"./main-GE3uFePF.js";import{V as Ot,a as Vt,S as Et}from"./settings-drawer-Bnvsy2g6.js";import{n as M,I as Nt,v as $e,k as Le,a as Ut,w as xe,x as Ae,d as Ft,l as Oe,y as Ve,z as zt,A as Wt,V as Ee,p as Mt,B as Ht}from"./forwardRefs-RdtHqDjs.js";import{P as Kt,E as Ne,A as jt,V as qt,a as Gt,U as Yt,c as Xt}from"./unauthorized-DqdR05bx.js";import{V as Ue,a as Fe}from"./VWindowItem-IxINW856.js";import{b as Jt}from"./VSelect-3XsB4Bnk.js";import{C as se,a as Qt}from"./confirm-footer-CXU8cmV4.js";import{D as Zt,T as eo,b as to,V as q,a as oo,P as ze,c as so,d as ao}from"./pagination-toolbar-Cwa8vQVJ.js";import{V as no,a as ro,b as io,c as lo}from"./VExpansionPanels-8fCmipaL.js";import{V as G,a as Y}from"./VRadioGroup-BCJFYNjv.js";import{a as oe}from"./VDivider-Rdtf6zpf.js";import{V as E}from"./VCheckbox-CH2Hzy3v.js";import{T as X}from"./index-CLgxatJ5.js";const co={control:"ctrl",command:"cmd",option:"alt",up:"arrowup",down:"arrowdown",left:"arrowleft",right:"arrowright",esc:"escape",spacebar:" ",space:" ",return:"enter",del:"delete",minus:"-",hyphen:"-"};function ne(e){const t=e.toLowerCase();return co[t]||t}function We(e){const t={keys:[],separators:[]};if(!e||e.length>1&&["+","/","_"].some(g=>e.startsWith(g))&&!["++","//","__"].some(g=>e.startsWith(g))||e.includes("++")||e.includes("__")||e==="+"||e==="_"||e.length>1&&(e.endsWith("+")||e.endsWith("_"))&&e.at(-2)!==e.at(-1)||e==="++"||e==="--"||e==="__")return t;const s=[],o=[];let l="";const a=g=>{l&&(g&&o.push(g),s.push(ne(l)),l="")};for(let g=0;g<e.length;g++){const P=e[g],L=e[g+1];["+","/","_","-"].includes(P)?P===L?(a(P),s.push(P),g++):["+","/","_"].includes(P)?a(P):l+=P:l+=P}return a(),s.some(g=>g.length>1&&g.includes("-")&&g!=="--")?t:s.length===0&&e?{keys:[ne(e)],separators:o}:{keys:s,separators:o}}function uo(e){if(!e)return[];const t=e.startsWith("-")&&!["---","--+"].includes(e),i=e.endsWith("-")&&!e.endsWith("+-")&&!e.endsWith("_-")&&e!=="-"&&e!=="---";if(t||i)return[];const c=[];let s="",o=0;for(;o<e.length;){const g=e[o];if(g==="-"){const P=e[o-1],L=o>1?e[o-2]:void 0;["+","_"].includes(P)&&!["+","/"].includes(L??"")?(s+=g,o++):(s?(c.push(s),s=""):c.push("-"),o++)}else s+=g,o++}s&&c.push(s);const l=[];let a=0;for(const g of c)g==="-"?(a%2===0&&l.push("-"),a++):(a=0,l.push(g));return l.every(g=>We(g).keys.length>0)?l:[]}function Me(e,t){const{self:i=!1}=t.modifiers??{},c=t.value,s=typeof c=="object"&&c.options||{passive:!0},o=typeof c=="function"||"handleEvent"in c?c:c.handler,l=i?e:t.arg?document.querySelector(t.arg):window;l&&(l.addEventListener("scroll",o,s),e._onScroll=Object(e._onScroll),e._onScroll[t.instance.$.uid]={handler:o,options:s,target:i?void 0:l})}function He(e,t){if(!e._onScroll?.[t.instance.$.uid])return;const{handler:i,options:c,target:s=e}=e._onScroll[t.instance.$.uid];s.removeEventListener("scroll",i,c),delete e._onScroll[t.instance.$.uid]}function ho(e,t){t.value!==t.oldValue&&(He(e,t),Me(e,t))}const po={mounted:Me,unmounted:He,updated:ho},go={name:"BookChangeDrawer",props:{direction:{type:String,required:!0}},head(){if(this.isDrawerOpen)return this.prefetchLinks(this.params,this.computedDirection,!0)},computed:{...f(u,["isBTT"]),...f(u,{computedDirection(){return this.normalizeDirection(this.direction)},params(e){return e.routes.books[this.computedDirection]},isDrawerOpen(e){return e.bookChange===this.computedDirection},icon(){return this.bookChangeIcon(this.computedDirection)}}),drawerLocation(){return this.bookChangeLocation(this.direction)},cursorClass(){return this.bookChangeCursorClass(this.computedDirection)},show(){return this.bookChangeShow(this.computedDirection)},route(){return this.toRoute(this.params)},label(){return this.linkLabel(this.computedDirection,"Book")}},methods:{...y(u,["linkLabel","normalizeDirection","prefetchLinks","toRoute","bookChangeLocation","bookChangeCursorClass","bookChangeShow","bookChangeIcon"])}};function mo(e,t,i,c,s,o){const l=h("router-link");return o.show?(d(),m(Ot,{key:0,class:D(["bookChangeDrawer",{drawerActivated:e.isDrawerOpen}]),"disable-resize-watcher":"","disable-route-watcher":"",location:o.drawerLocation,"model-value":e.isDrawerOpen,scrim:!1,temporary:"",touchless:""},{default:p(()=>[n(l,{class:D({navLink:!0,[o.cursorClass]:!0}),to:o.route,"aria-label":o.label,title:o.label,onClick:t[0]||(t[0]=a=>a.stopImmediatePropagation())},{default:p(()=>[n(M,{class:"bookChangeIcon"},{default:p(()=>[R(A(e.icon),1)]),_:1})]),_:1},8,["class","to","aria-label","title"])]),_:1},8,["location","model-value","class"])):B("",!0)}const ko=b(go,[["render",mo],["__scopeId","data-v-0340b976"]]),fo={name:"BookChangeActivator",components:{BookChangeDrawer:ko},props:{direction:{type:String,required:!0}},computed:{show(){return this.bookChangeShow(this.computedDirection)},computedDirection(){return this.normalizeDirection(this.direction)},positionClass(){return this.bookChangeLocation(this.direction)+"Pos"},cursorClass(){return this.bookChangeCursorClass(this.direction)}},methods:{...y(u,["bookChangeCursorClass","bookChangeLocation","bookChangeShow","normalizeDirection","setBookChangeFlag"])}};function bo(e,t,i,c,s,o){const l=h("BookChangeDrawer");return d(),S($,null,[o.show?(d(),S("div",{key:0,class:D(["changeColumn",{[o.positionClass]:!0,[o.cursorClass]:!0}]),onClick:t[0]||(t[0]=ke(a=>e.setBookChangeFlag(i.direction),["stop"]))},null,2)):B("",!0),n(l,{direction:i.direction},null,8,["direction"])],64)}const vo=b(fo,[["render",bo],["__scopeId","data-v-67df236c"]]),yo={name:"LoadingPage",components:{Placeholder:Kt},props:{twoPages:{type:Boolean,required:!0}}};function _o(e,t,i,c,s,o){const l=h("Placeholder");return d(),S("div",{class:D(["pageLoading",{twoPages:i.twoPages}])},[n(l,{class:"pagePlaceholder"})],2)}const Po=b(yo,[["render",_o],["__scopeId","data-v-04027168"]]),re="unauthorized",So={name:"ErrorPage",components:{EmptyState:Ne},props:{twoPages:{type:Boolean,required:!0},type:{type:String,required:!0}},emits:["retry"],computed:{text(){return this.type===re?"Protected page":"Failed to load page"},icon(){return this.type===re?ot:st}},methods:{onAction(e){this.$emit("retry",e)}}};function wo(e,t,i,c,s,o){const l=h("EmptyState");return d(),m(l,{class:D(["pageError",{twoPages:i.twoPages}]),headline:o.text,icon:o.icon,"action-text":"Retry","onClick:action":o.onAction},null,8,["class","headline","icon","onClick:action"])}const Co=b(So,[["render",wo],["__scopeId","data-v-97fa48e8"]]),To={name:"ImgPage",props:{book:{type:Object,required:!0},src:{type:String,required:!0}},emits:["load","error"],computed:{...f(u,{scale:e=>e.clientSettings.scale}),style(){const e={};if(this.scale==1)return e;const t=this.$el;if(!t?.naturalWidth)return e;const i=t.naturalWidth/2;return e.transformOrigin=`${i}px top`,e.transform=`scale(${this.scale})`,e},bookSettings(){return this.getBookSettings(this.book)},classes(){return this.bookSettings.fitToClass}},methods:{...y(u,["getBookSettings"])}},Ro=["src"];function Bo(e,t,i,c,s,o){return d(),S("img",ee({class:[o.classes,"img"],draggable:"false",src:i.src,style:o.style},e.$attrs,{onError:t[0]||(t[0]=l=>e.$emit("error",l)),onLoad:t[1]||(t[1]=l=>e.$emit("load",l))}),null,16,Ro)}const ie=b(To,[["render",Bo],["__scopeId","data-v-014c2ac0"]]),le=fe(be(()=>ye(()=>import("./pdf-doc-maKpFua9.js"),__vite__mapDeps([0,1,2,3])))),Do=333,Io={name:"BookPage",components:{ErrorPage:Co,LoadingPage:Po,PDFDoc:le,ImgPage:ie},props:{book:{type:Object,required:!0},page:{type:Number,required:!0}},data(){return{showProgress:!1,loaded:!1,error:"",ts:0}},computed:{...f(u,{scale:e=>e.clientSettings.scale}),style(){const e={};if(this.book.fileType==="PDF"||this.scale==1)return e;const t=this.$refs.pageComponent?.$el;return t?.naturalHeight&&(e.height=t.naturalHeight*this.scale+"px",e.width=t.naturalWidth*this.scale+"px"),e},src(){const e=Math.max(this.book.mtime,this.ts),t={pk:this.book.pk,page:this.page,mtime:e};return at(t)},component(){return this.book.fileType==="PDF"?le:ie},bookSettings(){return this.getBookSettings(this.book)},twoPages(){return this.bookSettings.twoPages}},mounted(){setTimeout(function(){this.loaded||(this.loading=!0)},Do)},methods:{...y(u,["getBookSettings"]),onLoad(){this.showProgress=!1,this.loaded=!0,this.error=!1},onError(){this.error="load",this.showProgress=!1},onUnauthorized(){this.error="unauthorized",this.showProgress=!1},onRetry(){this.ts=Date.now()}}},$o=["id","data-page"];function Lo(e,t,i,c,s,o){const l=h("ErrorPage"),a=h("LoadingPage");return d(),S("div",{id:`page${i.page}`,key:s.ts,"data-page":i.page,class:"page",style:O(o.style)},[s.error?(d(),m(l,{key:0,"two-pages":o.twoPages,type:s.error,onRetry:o.onRetry},null,8,["two-pages","type","onRetry"])):s.showProgress&&!s.loaded?(d(),m(a,{key:1,"two-pages":o.twoPages},null,8,["two-pages"])):(d(),m(ve(o.component),{key:2,ref:"pageComponent",book:i.book,page:1,src:o.src,onError:o.onError,onLoad:o.onLoad,onUnauthorized:o.onUnauthorized},null,40,["book","src","onError","onLoad","onUnauthorized"]))],12,$o)}const Ke=b(Io,[["render",Lo],["__scopeId","data-v-14cc8bcc"]]),xo=.5,Ao={name:"ScaleForScroll",emits:["click"],data(){return{mdiMagnifyMinusOutline:nt}},computed:{...f(u,{scale:e=>e.clientSettings.scale}),showReset(){return this.scale!=K},style(){return{cursor:this.scale==K?"zoom-in":"all-scroll"}}},methods:{...y(u,["setSettingsClient"]),clearSelection(){globalThis.getSelection&&globalThis.getSelection().removeAllRanges()},onDoubleClick(){this.clearSelection();const e=this.scale+xo;this.setSettingsClient({scale:e})},scaleReset(){this.setSettingsClient({scale:K})}}};function Oo(e,t,i,c,s,o){const l=it("drag-scroller");return x((d(),S("div",{class:"scaleForScroll",style:O(o.style),onDblclick:t[0]||(t[0]=(...a)=>o.onDoubleClick&&o.onDoubleClick(...a))},[rt(e.$slots,"default",{},void 0,!0),o.showReset?(d(),m(M,{key:0,class:"resetIcon",onClick:ke(o.scaleReset,["stop"])},{default:p(()=>[R(A(s.mdiMagnifyMinusOutline),1)]),_:1},8,["onClick"])):B("",!0)],36)),[[l,void 0,void 0,{onlyX:!0}]])}const je=b(Ao,[["render",Oo],["__scopeId","data-v-c8a16122"]]),Vo={name:"HorizontalPages",components:{BookPage:Ke,ScaleForScroll:je},props:{book:{type:Object,required:!0},page:{type:Number,required:!0}},emits:["click"],computed:{bookSettings(){return this.getBookSettings(this.book)},isReadInReverse(){return this.bookSettings.isReadInReverse},showSecondPage(){return this.bookSettings.twoPages&&this.page<this.book.maxPage&&!this.isCoverPage(this.book,this.page)},showPageOne(){return!this.isReadInReverse||this.showSecondPage},showPageTwo(){return this.isReadInReverse||this.showSecondPage},pageOne(){return this.isReadInReverse?this.page+1:this.page},pageTwo(){return this.isReadInReverse?this.page:this.page+1}},methods:{...y(u,["getBookSettings","isCoverPage"])}};function Eo(e,t,i,c,s,o){const l=h("BookPage"),a=h("ScaleForScroll");return d(),m(a,{class:"noWrap"},{default:p(()=>[o.showPageOne?(d(),m(l,{key:0,ref:"pageOne",book:i.book,page:o.pageOne,class:"horizontalPage"},null,8,["book","page"])):B("",!0),o.showPageTwo?(d(),m(l,{key:1,book:i.book,page:o.pageTwo,class:"horizontalPage"},null,8,["book","page"])):B("",!0)]),_:1})}const No=b(Vo,[["render",Eo],["__scopeId","data-v-ce77a1b1"]]),Uo={name:"PageChangeLink",props:{direction:{type:String,required:!0}},head(){return this.prefetchLinks(this.params,this.computedDirection)},computed:{...f(u,["isFirstPage","isLastPage"]),...f(u,{params(e){return e.routes[this.computedDirection]}}),computedDirection(){return this.normalizeDirection(this.direction)},show(){return this.computedDirection==="prev"?!this.isFirstPage:!this.isLastPage},pageChangeClass(){return"pageChangeColumn"},directionClass(){return this.direction},route(){return this.toRoute(this.params)},label(){return this.linkLabel(this.computedDirection,"Page")}},methods:{...y(u,["linkLabel","normalizeDirection","prefetchLinks","toRoute"])}};function Fo(e,t,i,c,s,o){const l=h("router-link");return o.show?(d(),m(l,{key:0,to:o.route,"aria-label":o.label,class:D(["changeColumn",{[o.directionClass]:!0}]),onClick:t[0]||(t[0]=a=>a.stopImmediatePropagation())},null,8,["to","aria-label","class"])):B("",!0)}const zo=b(Uo,[["render",Fo],["__scopeId","data-v-8a0b30bf"]]),Wo=48,Mo=48,Ho={name:"PagerHorizontal",components:{HorizontalPages:No,PageChangeLink:zo},props:{book:{type:Object,required:!0}},data(){return{activePage:0,pages:[]}},computed:{...f(u,{prevBook:e=>e.routes.books?.prev,nextBook:e=>e.routes.books?.next,storePage:e=>e.page,storePk:e=>e.books.current.pk,transition:e=>e.readerSettings.pageTransition}),bookSettings(){return this.getBookSettings(this.book)},twoPages(){return this.bookSettings.twoPages},isReadInReverse(){return this.bookSettings.isReadInReverse},windowIndex(){const e=this.activePage-this.pages[0];return Math.min(Math.max(0,e),this.book.maxPage)}},watch:{twoPages(){this.setActivePage(this.storePage,!0)},storePage(e){if(this.book.pk===this.storePk){this.activePage=e;const t=this.pages.at(0),i=this.pages.at(-1);(e<t||e>i)&&this.setPages()}}},created(){this.book.pk===this.storePk?this.activePage=+this.$route.params.page:this.book.pk===this.prevBook.pk?this.activePage=this.book.maxPage:this.activePage=0,this.setPages()},methods:{...y(u,["getBookSettings","setBookChangeFlag","setActivePage"]),setPages(){const e=Math.max(this.activePage-Wo,0),t=Math.min(this.activePage+Mo,this.book.maxPage);this.pages=_e(e,t+1)}}};function Ko(e,t,i,c,s,o){const l=h("PageChangeLink"),a=h("HorizontalPages");return d(),m(Ue,{"show-arrows":"",continuous:"","model-value":o.windowIndex,reverse:o.isReadInReverse},{prev:p(()=>[n(l,{direction:"prev"})]),next:p(()=>[n(l,{direction:"next"})]),default:p(()=>[(d(!0),S($,null,N(s.pages,k=>(d(),m(Fe,{key:`c/${i.book.pk}/${k}`,class:"windowItem",disabled:"",eager:k>=e.storePage-1&&k<=e.storePage+2,"model-value":k,transition:e.transition,"reverse-transition":e.transition},{default:p(()=>[n(a,{book:i.book,page:k},null,8,["book","page"])]),_:2},1032,["eager","model-value","transition","reverse-transition"]))),128))]),_:1},8,["model-value","reverse"])}const ce=b(Ho,[["render",Ko],["__scopeId","data-v-a55977d3"]]),de=250,jo={name:"PagerVertical",components:{BookPage:Ke,ScaleForScroll:je},props:{book:{type:Object,required:!0}},data(){return{innerHeight:window.innerHeight,innerWidth:window.innerWidth,intersectorOn:!1,programmaticScroll:!1,intersectOptions:{handler:this.onIntersect,options:{threshold:[.75]}}}},computed:{...f(u,{storePage:e=>e.page,showToolbars:e=>e.showToolbars}),...Pe(u,["reactWithScroll"]),bookSettings(){return this.getBookSettings(this.book)},isReadInReverse(){return this.bookSettings.isReadInReverse},items(){const e=this.book?.maxPage?this.book.maxPage+1:0,t=_e(0,e);return this.isReadInReverse&&t.reverse(),t}},watch:{storePage(e){this.reactWithScroll&&this.scrollToPage(e)}},mounted(){window.addEventListener("resize",this.onResize),setTimeout(()=>{this.scrollToPage(this.storePage)},de)},beforeUnmount(){window.removeEventListener("resize",this.onResize)},methods:{...y(u,["getBookSettings","setActivePage","setBookChangeFlag"]),onIntersect(e,t){if(e&&this.intersectorOn){const c=+t[0].target.dataset.page;this.setActivePage(c,!1)}},onScroll(){if(this.programmaticScroll)return;this.intersectorOn=!0;const e=this.$refs.verticalScroll.$el,t=e.scrollTop;if(this.storePage===0&&t===0)this.setBookChangeFlag("prev");else if(this.storePage===this.book.maxPage){const i=e.scrollTopMax||e.scrollHeight-e.clientTop;window.innerHeight+t+1>=i&&this.setBookChangeFlag("next")}},scrollToPage(e){this.intersectorOn=!1,this.programmaticScroll=!0;const t=this.$refs.verticalScroll;t?t.scrollToIndex(e):console.debug("Can't find verticalScroll component."),setTimeout(()=>{this.programmaticScroll=!1},de)},onResize(){this.innerHeight=window.innerHeight,this.innerWidth=window.innerWidth}}},qo=["data-page"];function Go(e,t,i,c,s,o){const l=h("BookPage"),a=h("ScaleForScroll");return d(),m(a,null,{default:p(()=>[x((d(),m(Jt,{id:"verticalScroll",key:o.isReadInReverse,ref:"verticalScroll",items:o.items,height:s.innerHeight,width:s.innerWidth},{default:p(({item:k})=>[n(l,{book:i.book,page:k,class:"verticalPage"},null,8,["book","page"]),x(r("div",{class:D(["pageTracker",{pageTrackerToolbars:e.showToolbars}]),"data-page":k},null,10,qo),[[Nt,s.intersectOptions,void 0,{quiet:!0}]])]),_:1},8,["items","height","width"])),[[po,o.onScroll,"#verticalScroll"]])]),_:1})}const ue=b(jo,[["render",Go],["__scopeId","data-v-4fdc17f1"]]),he=fe(be(()=>ye(()=>import("./pager-full-pdf-C8eH6D19.js"),__vite__mapDeps([4,1,2,0,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43])))),Yo={name:"PagerSelector",components:{PagerHorizontal:ce,PagerPDF:he,PagerVertical:ue},props:{book:{type:Object,required:!0}},emits:["click"],head(){return this.prefetchBook(this.book)},computed:{...f(u,["cacheBook"]),...f(u,{storePk:e=>e.books?.current?.pk||0}),isActiveBook(){return this.book&&this.storePk===this.book?.pk},bookSettings(){return this.getBookSettings(this.book)},readerFullPdf(){return this.book?.fileType=="PDF"&&this.cacheBook&&!this.bookSettings.isVertical},component(){let e;return this.readerFullPdf?e=he:this.bookSettings.isVertical?e=ue:e=ce,e}},watch:{$route(e){+e.params.pk===this.book.pk&&this.setActivePage(+e.params.page,!0)}},created(){this.isActiveBook&&this.setActivePage(+this.$route.params.page,!0)},methods:{...y(u,["getBookSettings","isBookVertical","setActivePage","prefetchBook"])}};function Xo(e,t,i,c,s,o){return d(),m(ve(o.component),{book:i.book},null,8,["book"])}const Jo=b(Yo,[["render",Xo]]),Qo={name:"BooksWindow",components:{BookChangeActivator:vo,Pager:Jo},computed:{...f(u,["isBTT"]),...f(u,{books:e=>[e.books.prev,e.books.current,e.books.next].filter(Boolean),bookChange:e=>e.bookChange,currentBookPk:e=>e.books?.current?.pk||0,bookRoutes:e=>e.routes.books,transition:e=>e.readerSettings.pageTransition}),bookChangePrev(){return this.bookChangeShow("prev")},bookChangeNext(){return this.bookChangeShow("next")}},watch:{$route(e,t){(!t||!t.params||+e.params.pk!=+t.params.pk)&&this.loadBooks({params:e.params})}},beforeMount(){this.setBookChangeFlag(),this.loadBooks({})},methods:{...y(u,["loadBooks","setBookChangeFlag","toggleToolbars"]),click(){this.toggleToolbars(),this.setBookChangeFlag()},eager(e){return this.bookChange&&this.bookRoutes[this.bookChange]&&this.bookRoutes[this.bookChange].pk===e}}};function Zo(e,t,i,c,s,o){const l=h("BookChangeActivator"),a=h("Pager");return d(),m(Ue,{id:"booksWindow",direction:"vertical","model-value":e.currentBookPk,reverse:e.isBTT,"show-arrows":"",onClick:e.toggleToolbars},{prev:p(()=>[n(l,{direction:"prev"})]),next:p(()=>[n(l,{direction:"next"})]),default:p(()=>[(d(!0),S($,null,N(e.books,k=>(d(),m(Fe,{key:`c/${k.pk}`,class:"windowItem",disabled:"",eager:o.eager(k.pk),value:k.pk,transition:e.transition,"reverse-transitin":e.transition},{default:p(()=>[n(a,{book:k,onClick:o.click},null,8,["book","onClick"])]),_:2},1032,["eager","value","transition","reverse-transitin"]))),128))]),_:1},8,["model-value","reverse","onClick"])}const es=b(Qo,[["render",Zo],["__scopeId","data-v-3b8d07f2"]]),ts={name:"DownloadPanel",components:{CodexListItem:se,DownloadButton:Zt},data(){return{mdiDownload:ut,mdiFileImage:dt}},computed:{...f(u,["activeTitle","routeParams"]),...f(u,{currentBook:e=>e.books?.current,fileType:e=>e.books?.current?.fileType,mtime:e=>e.books?.current?.mtime,pk:e=>e.books?.current?.pk,filename:e=>e.books?.current?.filename,storePage:e=>e.page}),pageSrc(){const e={pk:this.pk,page:this.storePage,ts:this.ts};return ct(e)},pageName(){const e=this.fileType==="PDF"?"pdf":"jpg";return`${this.activeTitle} - page ${this.storePage}.${e}`},downloadPageTitle(){return`Download Page ${this.storePage}`},downloadItem(){return{group:"c",ids:[this.pk],childCount:1,name:this.filename,mtime:this.mtime}}},methods:{...y(Se,["downloadIOSPWAFix"]),downloadPage(){lt(this.pageSrc,this.pageName)}}},os={key:0,id:"downloadPanel"};function ss(e,t,i,c,s,o){const l=h("CodexListItem"),a=h("DownloadButton");return e.currentBook?(d(),S("div",os,[n(l,{"prepend-icon":s.mdiFileImage,title:o.downloadPageTitle,onClick:o.downloadPage},null,8,["prepend-icon","title","onClick"]),n(a,{button:!1,item:o.downloadItem},null,8,["item"])])):B("",!0)}const as=b(ts,[["render",ss],["__scopeId","data-v-a873b002"]]),ns=Re({color:String,...Ve(),...De(),...Oe(),...Ft({tag:"kbd"}),...Be(),...Ae()},"VKbd"),pe=we()({name:"VKbd",props:ns(),setup(e,t){let{slots:i}=t;const{themeClasses:c}=Ce(e),{borderClasses:s}=$e(e),{roundedClasses:o}=Le(e),{backgroundColorClasses:l,backgroundColorStyles:a}=Ut(()=>e.color),{elevationClasses:k}=xe(e);return Te(()=>n(e.tag,{class:D(["v-kbd",c.value,l.value,s.value,k.value,o.value,e.class]),style:O([a.value,e.style])},i)),{}}});function qe(e,t,i){const c=i&&e.mac?e.mac:e.default,s=t==="icon"&&!c.icon||t==="symbol"&&!c.symbol?"text":t;let o=c[s]??c.text;return s==="text"&&typeof o=="string"&&o.startsWith("$")&&!o.startsWith("$vuetify.")&&(o=o.slice(1).toUpperCase()),s==="icon"?["icon",o]:[s,o]}const Ge={ctrl:{mac:{symbol:"⌃",icon:"$ctrl",text:"$vuetify.hotkey.ctrl"},default:{text:"Ctrl"}},meta:{mac:{symbol:"⌘",icon:"$command",text:"$vuetify.hotkey.command"},default:{text:"Ctrl"}},cmd:{mac:{symbol:"⌘",icon:"$command",text:"$vuetify.hotkey.command"},default:{text:"Ctrl"}},shift:{mac:{symbol:"⇧",icon:"$shift",text:"$vuetify.hotkey.shift"},default:{text:"Shift"}},alt:{mac:{symbol:"⌥",icon:"$alt",text:"$vuetify.hotkey.option"},default:{text:"Alt"}},enter:{default:{symbol:"↵",icon:"$enter",text:"$vuetify.hotkey.enter"}},arrowup:{default:{symbol:"↑",icon:"$arrowup",text:"$vuetify.hotkey.upArrow"}},arrowdown:{default:{symbol:"↓",icon:"$arrowdown",text:"$vuetify.hotkey.downArrow"}},arrowleft:{default:{symbol:"←",icon:"$arrowleft",text:"$vuetify.hotkey.leftArrow"}},arrowright:{default:{symbol:"→",icon:"$arrowright",text:"$vuetify.hotkey.rightArrow"}},backspace:{default:{symbol:"⌫",icon:"$backspace",text:"$vuetify.hotkey.backspace"}},escape:{default:{text:"$vuetify.hotkey.escape"}}," ":{mac:{symbol:"␣",icon:"$space",text:"$vuetify.hotkey.space"},default:{text:"$vuetify.hotkey.space"}},"-":{default:{text:"-"}}},rs=Re({keys:String,displayMode:{type:String,default:"icon"},keyMap:{type:Object,default:()=>Ge},platform:{type:String,default:"auto"},inline:Boolean,disabled:Boolean,prefix:String,suffix:String,variant:{type:String,default:"elevated",validator:e=>["elevated","flat","tonal","outlined","text","plain","contained"].includes(e)},...De(),...Be(),...Ve(),...Oe(),...Ae(),color:String},"VHotkey"),J=Symbol("VHotkey:AND_DELINEATOR"),Q=Symbol("VHotkey:SLASH_DELINEATOR"),ge=Symbol("VHotkey:THEN_DELINEATOR");function is(e,t,i){const c=t.toLowerCase();if(c in e){const s=qe(e[c],"text",i);return typeof s[1]=="string"?s[1]:String(s[1])}return t.toUpperCase()}function me(e,t,i,c){const s=i.toLowerCase();if(s in e){const o=qe(e[s],t,c);return o[0]==="text"&&typeof o[1]=="string"&&o[1].startsWith("$")&&!o[1].startsWith("$vuetify.")?["text",o[1].replace("$","").toUpperCase(),i]:[...o,i]}return["text",i.toUpperCase(),i]}const v=we()({name:"VHotkey",props:rs(),setup(e){const{t}=ht(),{themeClasses:i}=Ce(e),{rtlClasses:c}=pt(),{borderClasses:s}=$e(e),{roundedClasses:o}=Le(e),{elevationClasses:l}=xe(e),{colorClasses:a,colorStyles:k,variantClasses:g}=zt(()=>({color:e.color,variant:e.variant==="contained"?"elevated":e.variant})),P=j(()=>e.platform==="auto"?typeof navigator<"u"&&/macintosh/i.test(navigator.userAgent):e.platform==="mac"),L=j(()=>e.keys?e.keys.split(" ").map(_=>{const T=[],I=uo(_);for(let w=0;w<I.length;w++){const C=I[w];w>0&&T.push(ge);const{keys:F,separators:et}=We(C);for(let V=0;V<F.length;V++){const tt=F[V];V>0&&T.push(et[V-1]==="/"?Q:J),T.push(me(e.keyMap,e.displayMode,tt,P.value))}}return T}):[]),ae=j(()=>{if(!e.keys)return"";const T=L.value.map(I=>{const w=[];for(const C of I)if(Array.isArray(C)){const F=C[0]==="icon"||C[0]==="symbol"?me(gt(Ge,e.keyMap),"text",String(C[1]),P.value)[1]:C[1];w.push(H(F))}else C===J?w.push(t("$vuetify.hotkey.plus")):C===Q?w.push(t("$vuetify.hotkey.or")):C===ge&&w.push(t("$vuetify.hotkey.then"));return w.join(" ")}).join(", ");return t("$vuetify.hotkey.shortcut",T)});function H(_){return _.startsWith("$vuetify.")?t(_):_}function Je(_){if(e.displayMode==="text")return;const T=is(e.keyMap,String(_[2]),P.value);return H(T)}function Qe(_,T){const I=e.variant==="contained",w=I?"kbd":pe,C=["v-hotkey__key",`v-hotkey__key-${_[0]}`,...I?["v-hotkey__key--nested"]:[s.value,o.value,l.value,a.value]];return n(w,{key:T,class:D(C),style:O(I?void 0:k.value),"aria-hidden":"true",title:Je(_)},{default:()=>[_[0]==="icon"?n(M,{icon:_[1],"aria-hidden":"true"},null):H(_[1])]})}function Ze(_,T){return r("span",{key:T,class:"v-hotkey__divider","aria-hidden":"true"},[_===J?"+":_===Q?"/":t("$vuetify.hotkey.then")])}Te(()=>{const _=r($,null,[e.prefix&&r("span",{key:"prefix",class:"v-hotkey__prefix"},[e.prefix]),L.value.map((T,I)=>r("span",{class:"v-hotkey__combination",key:I},[T.map((w,C)=>Array.isArray(w)?Qe(w,C):Ze(w,C)),I<L.value.length-1&&r("span",{"aria-hidden":"true"},[R(" ")])])),e.suffix&&r("span",{key:"suffix",class:"v-hotkey__suffix"},[e.suffix])]);return r("div",{class:D(["v-hotkey",{"v-hotkey--disabled":e.disabled,"v-hotkey--inline":e.inline,"v-hotkey--contained":e.variant==="contained"},i.value,c.value,g.value,e.class]),style:O(e.style),role:"img","aria-label":ae.value},[e.variant!=="contained"?_:n(pe,{key:"contained",class:D(["v-hotkey__contained-wrapper",s.value,o.value,l.value,a.value]),style:O(k.value),"aria-hidden":"true"},{default:()=>[_]})])})}}),ls={name:"KeyboardShortcutsTable",data(){return{mdiMenuLeft:bt,mdiMenuRight:ft,mdiKeyboardSpace:kt,mdiAppleKeyboardShift:mt}}},cs={class:"highlight-table"},ds={class:"highlight-table"},us={class:"highlight-table"};function hs(e,t,i,c,s,o){return d(),S($,null,[t[22]||(t[22]=r("h4",null,"Navigation",-1)),r("table",cs,[r("tbody",null,[r("tr",null,[r("td",null,[n(v,{keys:"j"}),t[0]||(t[0]=R(", ",-1)),n(v,{keys:"arrowleft"}),t[1]||(t[1]=R(", ",-1)),n(v,{keys:"shift+space"})]),t[2]||(t[2]=r("td",null,"Previous page",-1))]),r("tr",null,[r("td",null,[n(v,{keys:"k"}),t[3]||(t[3]=R(", ",-1)),n(v,{keys:"arrowright"}),t[4]||(t[4]=R(", ",-1)),n(v,{keys:"space"})]),t[5]||(t[5]=r("td",null,"Next page",-1))]),r("tr",null,[r("td",null,[n(v,{keys:","})]),t[6]||(t[6]=r("td",null,[R("Next "),r("em",null,"only"),R(" one page in two page mode.")],-1))]),r("tr",null,[r("td",null,[n(v,{keys:"."})]),t[7]||(t[7]=r("td",null,[R("Previous "),r("em",null,"only"),R(" one page in two page mode.")],-1))]),r("tr",null,[r("td",null,[n(v,{keys:"p"})]),t[8]||(t[8]=r("td",null,"Previous Book",-1))]),r("tr",null,[r("td",null,[n(v,{keys:"n"})]),t[9]||(t[9]=r("td",null,"Next Book",-1))]),r("tr",null,[r("td",null,[n(v,{keys:"esc"})]),t[10]||(t[10]=r("td",null,"Close book",-1))])])]),t[23]||(t[23]=r("h4",null,"Fit Page To",-1)),r("table",ds,[r("tbody",null,[r("tr",null,[r("td",null,[n(v,{keys:"s"})]),t[11]||(t[11]=r("td",null,"screen",-1))]),r("tr",null,[r("td",null,[n(v,{keys:"h"})]),t[12]||(t[12]=r("td",null,"screen height",-1))]),r("tr",null,[r("td",null,[n(v,{keys:"w"})]),t[13]||(t[13]=r("td",null,"screen width",-1))]),r("tr",null,[r("td",null,[n(v,{keys:"o"})]),t[14]||(t[14]=r("td",null,"Show page at original size",-1))]),r("tr",null,[r("td",null,[n(v,{keys:"2"})]),t[15]||(t[15]=r("td",null,"Toggle two page view",-1))]),r("tr",null,[r("td",null,[n(v,{keys:"r"})]),t[16]||(t[16]=r("td",null,"Read Right to Left",-1))]),r("tr",null,[r("td",null,[n(v,{keys:"l"})]),t[17]||(t[17]=r("td",null,"Read Left to Right",-1))]),r("tr",null,[r("td",null,[n(v,{keys:"t"})]),t[18]||(t[18]=r("td",null,"Read Top to Bottom",-1))]),r("tr",null,[r("td",null,[n(v,{keys:"b"})]),t[19]||(t[19]=r("td",null,"Read in Bottom to Top",-1))])])]),t[24]||(t[24]=r("h4",null,"Other",-1)),r("table",us,[r("tbody",null,[r("tr",null,[r("td",null,[n(v,{keys:"m"})]),t[20]||(t[20]=r("td",null,"Show comic's metadata",-1))]),r("tr",null,[r("td",null,[n(v,{keys:"doubleclick"})]),t[21]||(t[21]=r("td",null,"Zoom page",-1))])])])],64)}const ps=b(ls,[["render",hs],["__scopeId","data-v-fe9995af"]]),gs=/iP(?:ad|hone|od)|Android/,ms=gs.test(navigator.userAgent),ks=ms||globalThis.orientation!==void 0,fs={name:"KeyboardShortcutsPanel",components:{CodexListItem:se,KeyboardShortcutsTable:ps},data(){return{mdiKeyboardOutline:vt,IS_MOBILE:ks}}};function bs(e,t,i,c,s,o){const l=h("CodexListItem"),a=h("KeyboardShortcutsTable");return s.IS_MOBILE?B("",!0):(d(),m(no,{key:0},{default:p(()=>[n(ro,{id:"readerKeyboardShortcuts"},{default:p(()=>[n(io,{id:"shortcutsTitle"},{default:p(()=>[n(l,{id:"keyboardShortcutsItem","prepend-icon":s.mdiKeyboardOutline,title:"Keyboard Shortcuts"},null,8,["prepend-icon"])]),_:1}),n(lo,null,{default:p(()=>[n(a)]),_:1})]),_:1})]),_:1}))}const vs=b(fs,[["render",bs],["__scopeId","data-v-8285795a"]]),Ye=["fitTo","readingDirection","twoPages"];Object.freeze(Ye);const ys={name:"ReaderSettingsPanel",components:{CodexListItem:se},data(){return{isGlobalScope:!1,mdiOpenInNew:Pt,mdiEye:_t,openDelay:2e3,scopeItems:[{title:"Only this comic",value:!1},{title:"Default for all comics",value:!0}]}},computed:{...f(U,["isAuthDialogOpen"]),...f(u,["isVertical","isPDF","cacheBook"]),...f(u,{choices:e=>e.choices,validBook:e=>!!e.books?.current,selectedSettings(e){return this.isGlobalScope||!e.books?.current?e.readerSettings:e.books?.current.settings},isClearSettingsButtonDisabled(e){if(this.isGlobalScope||!e.books?.current)return!0;for(const t of Ye){const i=e.books?.current.settings[t];if(!e.choices.nullValues.has(i))return!1}return!0},pdfInBrowserURL(e){return this.isPDF&&e.books?.current?yt(e.books?.current):""},finishOnLastPage:e=>e.readerSettings.finishOnLastPage,pageTransition:e=>e.readerSettings.pageTransition}),...Pe(u,["readRtlInReverse"]),fitToChoices(){return this.choicesWithoutNull("fitTo")},readingDirectionChoices(){return this.choicesWithoutNull("readingDirection")},disableTwoPages(){return this.isVertical||this.isPDF&&this.cacheBook},disableCacheBook(){return this.isVertical&&this.isPDF},disablePageTransition(){return this.isVertical&&this.isPDF}},mounted(){document.addEventListener("keyup",this._keyUpListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyUpListener)},methods:{...y(u,["clearSettingsLocal","setSettingsGlobal","setSettingsLocal","setSettingsClient"]),settingsDialogChanged(e){this.isGlobalScope?this.setSettingsGlobal(e):this.setSettingsLocal(e)},choicesWithoutNull(e){const t=[];for(const i of this.choices[e])i.value&&t.push(i);return Object.freeze(t),t},_keyUpListener(e){if(e.stopPropagation(),this.isAuthDialogOpen)return;let t;switch(e.key){case"w":t={fitTo:"W"};break;case"h":t={fitTo:"H"};break;case"s":t={fitTo:"S"};break;case"o":t={fitTo:"O"};break;case"2":t={twoPages:!this.selectedSettings.twoPages};break;case"l":t={readingDirection:"ltr"};break;case"r":t={readingDirection:"rtl"};break;case"t":t={readingDirection:"ttb"};break;case"b":t={readingDirection:"bbt"};break}t&&this.setSettingsLocal(t)}}},_s={id:"readerScopedSettings",class:"readerCodexListItem"};function Ps(e,t,i,c,s,o){const l=h("CodexListItem");return d(),S($,null,[t[9]||(t[9]=r("h4",{class:"readerSettingsHeader"},"Comic Settings Scope",-1)),n(G,{modelValue:s.isGlobalScope,"onUpdate:modelValue":t[0]||(t[0]=a=>s.isGlobalScope=a),class:"scopeRadioGroup readerCodexListItem",density:"compact","hide-details":"auto"},{default:p(()=>[(d(!0),S($,null,N(s.scopeItems,a=>(d(),m(Y,{key:a.value,label:a.title,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),n(Wt,null,{default:p(()=>[r("div",_s,[n(G,{class:"displayRadioGroup",density:"compact",label:"Display","hide-details":"auto","model-value":e.selectedSettings.fitTo,"onUpdate:modelValue":t[1]||(t[1]=a=>o.settingsDialogChanged({fitTo:a}))},{default:p(()=>[(d(!0),S($,null,N(o.fitToChoices,a=>(d(),m(Y,{key:a.value,label:a.title,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["model-value"]),n(E,{disabled:o.disableTwoPages,class:"scopedCheckbox",density:"compact",label:"Two pages","hide-details":"auto","model-value":e.selectedSettings.twoPages,"true-value":!0,indeterminate:e.selectedSettings.twoPages===null||e.selectedSettings.twoPages===void 0,"onUpdate:modelValue":t[2]||(t[2]=a=>o.settingsDialogChanged({twoPages:a}))},null,8,["disabled","model-value","indeterminate"]),n(G,{class:"displayRadioGroup",density:"compact",label:"Reading Direction","hide-details":"auto","model-value":e.selectedSettings.readingDirection,"onUpdate:modelValue":t[3]||(t[3]=a=>o.settingsDialogChanged({readingDirection:a}))},{default:p(()=>[(d(!0),S($,null,N(o.readingDirectionChoices,a=>(d(),m(Y,{key:a.value,label:a.title,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["model-value"]),n(E,{"model-value":e.selectedSettings.readRtlInReverse,class:"scopedCheckbox",density:"compact",label:"Read RTL Comics LTR","hide-details":"auto","true-value":!0,"onUpdate:modelValue":t[4]||(t[4]=a=>o.settingsDialogChanged({readRtlInReverse:a}))},null,8,["model-value"]),s.isGlobalScope?B("",!0):x((d(),m(Ee,{key:0,id:"clearSettingsButton",disabled:e.isClearSettingsButtonDisabled,onClick:e.clearSettingsLocal},{default:p(()=>[...t[8]||(t[8]=[R(" Clear Settings ",-1)])]),_:1},8,["disabled","onClick"])),[[X,{openDelay:s.openDelay,text:"Use the default settings for all comics for this comic"}]])])]),_:1}),n(oe),t[10]||(t[10]=r("h4",{class:"readerSettingsHeader"},"Reader Settings",-1)),n(E,{class:"readerCodexListItem","model-value":e.finishOnLastPage,density:"compact",label:"Finish Book On Last Page","hide-details":"auto","true-value":!0,"onUpdate:modelValue":t[5]||(t[5]=a=>e.setSettingsGlobal({finishOnLastPage:a}))},null,8,["model-value"]),x(n(E,{"model-value":e.pageTransition,class:"readerCodexListItem",density:"compact",disabled:o.disablePageTransition,label:"Animate Page Turns","hide-details":"auto","true-value":!0,"onUpdate:modelValue":t[6]||(t[6]=a=>e.setSettingsGlobal({pageTransition:a}))},null,8,["model-value","disabled"]),[[X,{openDelay:s.openDelay,text:"Animate page turns when reading horizontally."}]]),x(n(E,{"model-value":e.cacheBook,class:"readerCodexListItem",density:"compact",disabled:o.disableCacheBook,label:"Cache Entire Book","hide-details":"auto","true-value":!0,"onUpdate:modelValue":t[7]||(t[7]=a=>e.setSettingsClient({cacheBook:a}))},null,8,["model-value","disabled"]),[[X,{openDelay:s.openDelay,text:"Cache all pages from this book in the browser"}]]),e.pdfInBrowserURL?(d(),m(l,{key:0,"prepend-icon":s.mdiEye,"append-icon":s.mdiOpenInNew,title:"Read in Tab",href:e.pdfInBrowserURL,target:"_blank"},null,8,["prepend-icon","append-icon","href"])):B("",!0)],64)}const Ss=b(ys,[["render",Ps],["__scopeId","data-v-252309d7"]]),ws={name:"ReaderSettingsSuperPanel",components:{DownloadPanel:as,ReaderKeyboardShortcutsPanel:vs,ReaderSettingsPanel:Ss}};function Cs(e,t,i,c,s,o){const l=h("ReaderSettingsPanel"),a=h("ReaderKeyboardShortcutsPanel"),k=h("DownloadPanel");return d(),S($,null,[n(l),n(oe),n(a),n(oe),n(k)],64)}const Ts=b(ws,[["render",Cs]]),Rs={name:"ReaderSettingsDrawer",components:{SettingsDrawer:Vt,ReaderSettingsSuperPanel:Ts}};function Bs(e,t,i,c,s,o){const l=h("ReaderSettingsSuperPanel"),a=h("SettingsDrawer");return d(),m(a,{title:"Reader",temporary:"","disable-resize-watcher":""},{panel:p(()=>[n(l)]),_:1})}const Ds=b(Rs,[["render",Bs]]),Z={a:Bt,f:Rt,p:Tt,i:Ct,s:wt,v:St},Is={name:"ReaderArcSelect",components:{ToolbarSelect:eo},data(){return{mdiFilterOutline:$t}},computed:{...f(u,{arc:e=>e.arc,arcs:e=>e.arcs}),items(){const e=[];if(!this.arcs)return e;for(const[t,i]of Object.entries(this.arcs))for(const[c,s]of Object.entries(i)){let o=Dt[t];t!=="s"&&(o=o.slice(0,-1));const l=Z[t],a=t===this.arc?.group&&c==this.arc?.ids?It:"",k={group:t,ids:c,prependIcon:l,...s},g={group:t,value:k,title:s.name,subtitle:o,prependIcon:l,appendIcon:a};e.push(g)}return e},arcInfo(){if(!this.arcs||!this.arc)return{};const e=this.arcs[this.arc?.group];return e?e[this.arc?.ids]:{}},arcIcon(){return Z[this.arc?.group]}},methods:{...y(u,["loadBooks"]),onUpdate(e){const t={group:e.group,ids:e.ids.split(",").map(Number)};this.loadBooks({arc:t})},prependIcon(e){return Z[e]}}},$s={id:"arcPos"};function Ls(e,t,i,c,s,o){const l=h("ToolbarSelect");return d(),m(l,{"model-value":e.arc,class:"arcSelect","select-label":"reading order",items:o.items,disabled:!o.items||o.items.length<=1,"onUpdate:modelValue":o.onUpdate},{item:p(({item:a,props:k})=>[n(Qt,ee(k,{density:"compact",variant:"plain","prepend-icon":a.raw.prependIcon,subtitle:a.raw.subtitle,"append-icon":a.raw.appendIcon}),null,16,["prepend-icon","subtitle","append-icon"])]),selection:p(({props:a})=>[n(M,ee({icon:o.prependIcon(e.arc.group),size:"large"},a,{class:"arcSelectIcon"}),null,16,["icon"]),r("span",$s,A(e.arc.index)+" / "+A(e.arc.count),1)]),_:1},8,["model-value","items","disabled","onUpdate:modelValue"])}const xs=b(Is,[["render",Ls],["__scopeId","data-v-64020201"]]),As={name:"ReaderTitleToolbar",components:{AppBanner:jt,MetadataDialog:to,ReaderArcSelect:xs,SettingsDrawerButton:Et},data(){return{mdiClose:Lt,routeChanged:!1}},head(){const e=`Read / ${this.activeTitle} / page ${this.storePage}`,t=`reader ${e}`;return{title:e,meta:[{hid:"description",name:"description",content:t}]}},computed:{...f(U,["isAuthDialogOpen"]),...f(u,["activeTitle","closeBookRoute"]),...f(u,{showToolbars:e=>e.showToolbars,currentBook:e=>e.books?.current||{},empty:e=>e.empty,subtitle:e=>e.books?.current?.name||"",storePage:e=>e.page}),title(){return this.activeTitle},extensionHeight(){let e=32;return this.subtitle&&(e*=2),e+=4,e},closeRoute(){const e=te(this.closeBookRoute),t=te(e.params);return delete t.name,e.params=t,e},metadataBook(){const e={...this.currentBook};return e.group="c",e.childCount=0,e}},watch:{$route(e,t){t&&(this.routeChanged=!0)}},mounted(){document.addEventListener("keyup",this._keyUpListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyUpListener)},methods:{...y(Se,["setTimestamp"]),...y(u,["routeToDirection","routeToDirectionOne","routeToBook","setBookChangeFlag"]),openMetadata(){this.$refs.metadataDialog.dialog=!0},onCloseBook(){this.routeChanged&&this.setTimestamp()},_keyUpListener(e){if(e.stopPropagation(),!this.isAuthDialogOpen)switch(e.key){case"Escape":this.$refs.closeBook.$el.click();break;case"m":this.empty||this.openMetadata();break}}}},Os={id:"readerTopToolbarHeader"},Vs={id:"title"},Es={key:0,id:"subtitle"};function Ns(e,t,i,c,s,o){const l=h("AppBanner"),a=h("ReaderArcSelect"),k=h("MetadataDialog"),g=h("SettingsDrawerButton");return d(),m(Mt,null,{default:p(()=>[x(r("header",Os,[n(l),n(qt,{id:"readerToolbarTop",density:"compact","extension-height":o.extensionHeight},xt({default:p(()=>[n(q,null,{default:p(()=>[n(Ee,{ref:"closeBook",class:"closeBook",to:o.closeRoute,size:"large",density:"compact",variant:"plain",onClick:o.onCloseBook},{default:p(()=>[...t[0]||(t[0]=[R(" close book ",-1)])]),_:1},8,["to","onClick"])]),_:1}),n(oo),e.empty?B("",!0):(d(),m(q,{key:0},{default:p(()=>[n(a),n(k,{ref:"metadataDialog",book:o.metadataBook,toolbar:!0},null,8,["book"])]),_:1})),n(q,null,{default:p(()=>[n(g)]),_:1})]),_:2},[o.title?{name:"extension",fn:p(()=>[n(Gt,{class:"readerTitle"},{default:p(()=>[r("div",Vs,A(o.title),1),e.subtitle?(d(),S("div",Es,A(e.subtitle),1)):B("",!0)]),_:1})]),key:"0"}:void 0]),1032,["extension-height"])],512),[[Ie,e.showToolbars]])]),_:1})}const Xe=b(As,[["render",Ns],["__scopeId","data-v-8d6d7f30"]]),Us={name:"ReaderEmptyBooks",components:{ReaderTopToolbar:Xe,EmptyState:Ne},data(){return{mdiBookRemoveOutline:At}},methods:{...y(u,["loadBooks","setShowToolbars"]),onAction(){this.loadBooks({mtime:Date.now()})}},created(){this.setShowToolbars()}};function Fs(e,t,i,c,s,o){const l=h("ReaderTopToolbar"),a=h("EmptyState");return d(),S($,null,[n(l),n(a,{headline:"Book Not Found",title:"Close the reader and find another book",icon:s.mdiBookRemoveOutline,"action-text":"Try to load book again","onClick:action":o.onAction},null,8,["icon","onClick:action"])],64)}const zs=b(Us,[["render",Fs]]),Ws={name:"ReaderBookChangeNavButton",components:{PaginationNavButton:ze},props:{direction:{type:String,required:!0}},computed:{...f(u,["isBTT"]),...f(u,{toRoute(e){const t=e?.routes?.books[this.direction];return t?{params:te(t)}:""}}),title(){return(this.direction==="prev"?"Previous":"Next")+" Book"},icon(){return this.bookChangeIcon(this.direction)},classes(){return{bookChangeNavButtonLeft:this.direction==="prev",bookChangeNavButtonRight:this.direction==="next"}}},methods:{...y(u,["bookChangeIcon"])}};function Ms(e,t,i,c,s,o){const l=h("PaginationNavButton");return e.toRoute?(d(),m(l,{key:0,class:D(o.classes),icon:o.icon,variant:"plain",title:o.title,to:e.toRoute},null,8,["class","icon","title","to"])):B("",!0)}const Hs=b(Ws,[["render",Ms],["__scopeId","data-v-e6c3b493"]]),Ks={name:"ReaderNavButton",components:{PaginationNavButton:ze},props:{value:{type:Number,required:!0},twoPages:{type:Boolean,default:!1}},computed:{...f(u,["isVertical"]),...f(u,{storePage:e=>e.page,toRoute(e){if(!this.isVertical)return{params:{pk:e.books.current.pk,page:this.value}}},isBookPrev:e=>!!e.routes.books.prev,isBookNext:e=>!!e.routes.books.next}),classes(){return{readerNavButtonLeft:!this.isBookPrev&&this.value===0,readerNavButtonRight:!this.isBookNext&&this.value!=0}},title(){return"Page "+this.value},disabled(){return this.value===this.storePage||this.twoPages&&!!(this.value%2)&&this.value-1===this.storePage}},methods:{...y(u,["setActivePage"]),onClick(){this.isVertical&&this.setActivePage(this.value,!0)}}};function js(e,t,i,c,s,o){const l=h("PaginationNavButton");return d(),m(l,{key:e.isVertical,disabled:o.disabled,class:D(["readerNavButton",o.classes]),title:o.title,to:e.toRoute,onClick:o.onClick},{default:p(()=>[R(A(i.value),1)]),_:1},8,["disabled","class","title","to","onClick"])}const qs=b(Ks,[["render",js],["__scopeId","data-v-f60d8fb5"]]),z="prev",W="next",Gs={name:"ReaderNavToolbar",components:{PaginationSlider:ao,ReaderNavButton:qs,PaginationToolbar:so,ReaderBookChangeNavButton:Hs},computed:{...f(U,["isAuthDialogOpen"]),...f(u,["activeSettings","isReadInReverse","isVertical"]),...f(u,{showToolbars:e=>e.showToolbars,storePage:e=>e.page,key(e){return`${e.books?.current?.pk}:${this.step}:${this.isReadInReverse}`},maxPage:e=>e.books?.current?.maxPage||0}),twoPages(){return this.activeSettings.twoPages},step(){return this.activeSettings.twoPages?2:1},trackColor(){return this.twoPages&&+this.storePage>=this.maxPage-1?this.$vuetify.theme.current.colors.primary:""},min(){return this.isReadInReverse?this.maxPage:0},max(){return this.isReadInReverse?0:this.maxPage},bookPrev(){return this.isReadInReverse?"next":"prev"},bookNext(){return this.isReadInReverse?"prev":"next"}},mounted(){document.addEventListener("keyup",this._keyUpListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyUpListener)},methods:{...y(u,["routeToBook","routeToDirection","routeToDirectionOne","routeToPage","setActivePage"]),onSliderUpdate(e){this.isVertical?this.setActivePage(e,!0):this.routeToPage(e)},_keyUpListener(e){if(e.stopPropagation(),!this.isAuthDialogOpen)switch(e.key){case" ":!e.shiftKey&&window.innerHeight+window.scrollY+1>=document.body.scrollHeight?this.routeToDirection(W):e.shiftKey&&window.scrollY===0&&this.routeToDirection(z);break;case"j":case"ArrowRight":this.routeToDirection(W);break;case"k":case"ArrowLeft":this.routeToDirection(z);break;case",":this.routeToDirectionOne(z);break;case".":this.routeToDirectionOne(W);break;case"n":this.routeToBook(W);break;case"p":this.routeToBook(z);break}}}};function Ys(e,t,i,c,s,o){const l=h("ReaderBookChangeNavButton"),a=h("ReaderNavButton"),k=h("PaginationSlider"),g=h("PaginationToolbar");return d(),m(Ht,null,{default:p(()=>[e.maxPage?x((d(),m(g,{key:0,id:"readerToolbarNav"},{default:p(()=>[n(l,{direction:o.bookPrev,narrow:!1},null,8,["direction"]),n(a,{value:o.min,"two-pages":o.twoPages},null,8,["value","two-pages"]),(d(),m(k,{key:e.key,"model-value":e.storePage,min:0,max:e.maxPage,step:o.step,"track-color":o.trackColor,reverse:e.isReadInReverse,"onUpdate:modelValue":t[0]||(t[0]=P=>o.onSliderUpdate(P))},null,8,["model-value","max","step","track-color","reverse"])),n(a,{value:o.max,"two-pages":o.twoPages},null,8,["value","two-pages"]),n(l,{direction:o.bookNext,narrow:!1},null,8,["direction"])]),_:1},512)),[[Ie,e.showToolbars]]):B("",!0)]),_:1})}const Xs=b(Gs,[["render",Ys],["__scopeId","data-v-ebe715c2"]]),Js={name:"MainReader",components:{BooksWindow:es,ReaderEmpty:zs,ReaderNavToolbar:Xs,ReaderTopToolbar:Xe,ReaderSettingsDrawer:Ds,Unauthorized:Yt},data(){return{showToolbars:!1}},computed:{...f(U,["isAuthorized"]),...f(U,{user:e=>e.user}),...f(u,{empty:e=>e.empty})},watch:{user(){this.loadReaderSettings()}},created(){this.reset();const e=this.user?0:300,t=this.user;setTimeout(()=>{this.user?.id===t?.id&&this.loadReaderSettings()},e)},methods:{...y(u,["loadReaderSettings","reset"])}},Qs={key:0},Zs={id:"readerContainer"};function ea(e,t,i,c,s,o){const l=h("ReaderTopToolbar"),a=h("BooksWindow"),k=h("ReaderNavToolbar"),g=h("ReaderEmpty"),P=h("ReaderSettingsDrawer"),L=h("Unauthorized");return e.isAuthorized?(d(),m(Xt,{key:0,id:"readerWrapper"},{default:p(()=>[e.empty?(d(),m(g,{key:1})):(d(),S("div",Qs,[r("div",Zs,[n(l),n(a),n(k)])])),n(P)]),_:1})):(d(),m(L,{key:1}))}const ta=b(Js,[["render",ea],["__scopeId","data-v-6df2b556"]]),ma=Object.freeze(Object.defineProperty({__proto__:null,default:ta},Symbol.toStringTag,{value:"Module"}));export{zo as P,je as S,ma as r};
