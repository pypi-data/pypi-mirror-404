[workspace]
members = ["dtt_macros", "pipeline_macros", "pipelines", "user_messages"]

[workspace.package]
license="GPL-3.0-or-later"
authors = ["Erik von Reis <erik.vonreis@ligo.org>"]
edition = "2024"
homepage = "https://git.ligo.org/cds/software/cr-tools/dtt_rust"
repository = "https://git.ligo.org/cds/software/cr-tools/dtt_rust"
version = "0.10.4"

[package]
name = "dttlib"
version = {workspace = true}
authors = {workspace = true}
edition = {workspace = true}
homepage = {workspace = true}
repository = {workspace = true}
license = {workspace = true}
description = "Advanced LIGO core library for online and offline frequency-domain diagnostics tool."
readme = "README.md"
keywords = ["dtt", "diaggui", "fft", "swept-sine"]
categories = ["science", "mathematics"]
publish = false

# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html

[lib]
crate-type = [
    "cdylib",
    "rlib",
]

[[bin]]
name = "stub_gen"
doc = false
required-features = ["python"]

[workspace.dependencies]
# python
pyo3 = { version="0.24", features=["num-complex", "macros", "multiple-pymethods"]}
pyo3-stub-gen = { version="0.11"}
numpy = {version="0.24"}

# async
tokio = {version = "1", features = ["full"]}
tokio-util = {version = "0.7"}
futures = {version = "0.3"}

# other third-party
log = { version = "0.4"}

# LIGO
ligo_hires_gps_time = { version = "0.7" }


[dependencies]

# pyo3
pyo3 = {workspace=true, optional=true}
pyo3-stub-gen = {workspace=true, optional=true}
numpy = {workspace=true, optional=true}

# tokio
tokio.workspace = true
tokio-util.workspace = true
futures.workspace = true

# other third-party
num-traits = {version = "0.2"}
thiserror = {version = "2"}
num = {version = "0.4"}
pipeline_macros = {path = "pipeline_macros"}
pipelines = {path = "pipelines"}
user_messages = {path="user_messages"}
lazy_static = "1.5"
rand = "0.9"
petgraph = { version = "0.8" }
log.workspace = true
pyo3-log = {version="0.12"}
num-rational = {version = "0.4"}

# ligo
nds2_client_rs = { git="https://git.ligo.org/erik.vonreis/nds_client_rs.git", tag = "dev_2", optional = true }
nds-cache-rs = { git = "https://git.ligo.org/cds/software/cr_tools/nds-cache-rs.git", tag = "dev_29"}
ligo_hires_gps_time = {workspace = true}

# workspace
dtt_macros = {path = "dtt_macros"}

[build-dependencies]
bindgen = { version = "0.71" }
pyo3-build-config = {  version = "0.24.2"  }

[features]
# python interface
python = ["dep:pyo3",
    "pyo3/num-complex",  "pyo3/macros",
    "ligo_hires_gps_time/python", "pipelines/python",    
    "dep:numpy",

    "user_messages/python",

    "dep:pyo3-stub-gen",
]
# python custom pipeline
python-pipe = ["dep:pyo3", "pyo3/macros", "pyo3/num-complex",
    "dep:numpy",

    "dep:pyo3-stub-gen",

    "ligo_hires_gps_time/python",

    "pipelines/python"]
nds = [
    "dep:nds2_client_rs",
    "nds-cache-rs/nds",
]
extension = [
    "python", "python-pipe",
    "pyo3/extension-module",
    "ligo_hires_gps_time/extension",
    "nds-cache-rs/cmake-build",
]
all = ["python", "python-pipe", "nds"]
#full = ["all"]

[badges]
maintenance = { status = "actively-developed" }

[patch.'https://git.ligo.org/erik.vonreis/nds_client_rs.git']
#nds2_client_rs = { git="https://git.ligo.org/nds/nds_client_rs" }
#nds2_client_rs = { git="https://git.ligo.org/jonathan-hanks/nds_client_rs", branch = "serialize_connects"}
#nds2_client_rs = { git="https://git.ligo.org/erik.vonreis/nds_client_rs", tag = "dev_2"}
#nds2_client_rs = {path="../nds_client_rs", optional = true}

[patch.'https://git.ligo.org/cds/software/cr_tools/nds-cache-rs.git']
#nds-cache-rs = { path = "../nds-cache-rs"}

[patch.'https://git.ligo.org/cds/software/cr_tools/ts-tree-rs.git']
#ts-tree-rs = { path = "../ts-tree-rs" }

[patch.crates-io]
#pyo3-stub-gen = {path="../rust/pyo3-stub-gen/pyo3-stub-gen"}
#pyo3-stub-gen = {git="https://github.com/evonreis/pyo3-stub-gen.git", branch="rich_enum" }
#ligo_hires_gps_time = {git="https://git.ligo.org/cds/software/cr_tools/ligo_hires_gps_time.git", tag="0.6.2"}
