"""
Конфигурация правил очистки markdown текста.
Используется белый список символов - все символы, которые не входят в белый список
и не являются буквами/цифрами (isalnum), будут удалены из текстовых AST нод markdown.
"""


class CleaningRules:
    """
    Правила очистки текстовых нод в markdown.

    При обработке markdown через AST-парсинг, эти правила применяются ТОЛЬКО
    к текстовым нодам (type='text'). Все остальные элементы markdown (ссылки,
    код, изображения, таблицы и т.д.) остаются нетронутыми.

    Текстовые ноды внутри нод таблиц -- также очищаются по общему правилу.
    Используется для очистки текста markdown перед, например, подготовкой ANN векторов.
    """

    # Белый список символов для текстовых нод
    # Все символы из этого списка будут СОХРАНЕНЫ в тексте
    ALLOWED_CHARS = {
        # Пробелы и переносы строк (сохраняем все)
        ' ',  # обычный пробел
        '\n',  # перенос строки
        '\r',  # возврат каретки
        '\t',  # табуляция
        # Дефисы и тире
        '-',  # дефис
        '—',  # длинное тире (em dash)
        '–',  # среднее тире (en dash)
        # Подчеркивание (ОСТАВЛЯЕМ для имен файлов и т.д.)
        '_',
    }
    # Специальные символы для замены
    REPLACE_WITH_SPACE = {
        '/',  # Слэш заменяется на пробел (полезно для путей: src/main.py -- src main.py)
    }
    NORMALIZE_SPACES = True  # Нормализовать множественные пробелы в один
    PRESERVE_NEWLINES = True  # Сохранять все переносы строк (не нормализуем их)

    @classmethod
    def is_allowed(cls, char: str) -> bool:
        """
        Проверяет, разрешен ли символ в текстовых нодах.
        Args:
            char: Символ для проверки
        Returns:
            True если символ разрешен (буква, цифра или в белом списке)
        """
        return char.isalnum() or char in cls.ALLOWED_CHARS

    @classmethod
    def should_replace_with_space(cls, char: str) -> bool:
        """
        Проверяет, нужно ли заменить символ на пробел.
        Args:
            char: Символ для проверки
        Returns:
            True если символ нужно заменить на пробел
        """
        return char in cls.REPLACE_WITH_SPACE
