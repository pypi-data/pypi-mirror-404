# ==============================================================================
# lib_log_rich - Rich-powered structured logging with multi-target fan-out
# ==============================================================================
#
# Documentation: https://github.com/bitranox/lib_log_rich
# Settings are loaded via lib_layered_config and can be overridden via:
#   - Host/User config files (see precedence list in defaultconfig.toml)
#   - Environment variables (see below)
#
# Environment Variable Naming
# ---------------------------
# Use lib_layered_config format for all environment variable overrides:
#
#   Format: <SLUG>___<SECTION>__<KEY>=<VALUE>
#
#   Examples:
#     LIB_SHOPIFY_GRAPHQL___LIB_LOG_RICH__CONSOLE_LEVEL=DEBUG
#     LIB_SHOPIFY_GRAPHQL___LIB_LOG_RICH__ENABLE_GRAYLOG=true
#     LIB_SHOPIFY_GRAPHQL___LIB_LOG_RICH__SERVICE=my-service
#
# .env File Support
# -----------------
# In .env files (no prefix needed), use double underscore for nesting:
#
#   LIB_LOG_RICH__CONSOLE_LEVEL=DEBUG
#   LIB_LOG_RICH__ENABLE_GRAYLOG=false
#   LIB_LOG_RICH__CONSOLE_FORMAT_PRESET=short
#
# Precedence (lowest to highest):
#   defaults â†’ app config â†’ host config â†’ user config â†’ .env file â†’ env vars
#
# IMPORTANT: Never commit .env files containing secrets to version control
#
[lib_log_rich]
# Configuration for lib_log_rich structured logging
# See documentation below for all available options

# ------------------------------------------------------------------------------
# Core Identity Settings (defaults provided by code, can be overridden here)
# ------------------------------------------------------------------------------

service = "lib_shopify_graphql"
# Purpose: Logical service name recorded in each log event
# Type: string (non-empty)
# Default: "lib_shopify_graphql" (from package name)
# Environment: LIB_LOG_RICH__SERVICE
# Example: service = "my-custom-service"

environment = "prod"
# Purpose: Deployment environment label (dev, stage, prod, local, etc.)
# Type: string (non-empty)
# Default: "prod"
# Environment: LIB_LOG_RICH__ENVIRONMENT
# Example: environment = "staging"

# ------------------------------------------------------------------------------
# Console Output Settings
# ------------------------------------------------------------------------------

# console_level = "INFO"
# Purpose: Minimum severity level emitted to Rich console
# Type: string (case-insensitive)
# Default: "INFO"
# Values: "DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"
# Environment: LIB_LOG_RICH__CONSOLE_LEVEL
# Example: console_level = "DEBUG"

# console_stream = "stderr"
# Purpose: Where to send console output
# Type: string
# Default: "stderr"
# Values: "stdout", "stderr", "both", "custom", "none"
# Environment: LIB_LOG_RICH__CONSOLE_STREAM
# Note: "custom" requires console_stream_target parameter in code
#       "none" suppresses all console output
# Example: console_stream = "stdout"

# console_format_preset = "full"
# Purpose: Console line layout preset
# Type: string (case-insensitive)
# Default: "full"
# Values: "full", "short", "full_loc", "short_loc"
# Environment: LIB_LOG_RICH__CONSOLE_FORMAT_PRESET
# Details:
#   - full: Timestamp, level icon, logger name, message, context
#   - short: Minimal format with level and message
#   - full_loc: Like full but with local timezone
#   - short_loc: Like short but with local timezone
# Example: console_format_preset = "short"

# console_format_template = "{timestamp} {level_icon} {LEVEL:>8} {logger_name} â€” {message} {context_fields}"
# Purpose: Custom console output template (overrides preset)
# Type: string (Python str.format template)
# Default: None (uses preset)
# Environment: LIB_LOG_RICH__CONSOLE_FORMAT_TEMPLATE
# Available placeholders:
#   Timestamps:
#     {timestamp}                      - ISO 8601 UTC with microseconds (e.g., 2025-09-24T10:15:24.123456+00:00)
#     {timestamp_trimmed}              - UTC trimmed to seconds with timezone (e.g., 2025-09-24T10:15:24+00:00)
#     {timestamp_no_us}                - UTC trimmed to seconds with timezone (alias for timestamp_trimmed)
#     {timestamp_trimmed_naive}        - UTC trimmed to seconds without timezone (e.g., 2025-09-24T10:15:24)
#     {timestamp_loc}                  - Local time with timezone offset (e.g., 2025-09-24T12:15:24.123456+02:00)
#     {timestamp_trimmed_loc}          - Local time trimmed to seconds with offset
#     {timestamp_trimmed_naive_loc}    - Local time trimmed to seconds without offset
#   UTC Calendar Components:
#     {YYYY}, {MM}, {DD}               - UTC year, month, day
#     {hh}, {mm}, {ss}                 - UTC hour, minute, second
#   Local Calendar Components:
#     {YYYY_loc}, {MM_loc}, {DD_loc}   - Local year, month, day
#     {hh_loc}, {mm_loc}, {ss_loc}     - Local hour, minute, second
#   Level Information:
#     {LEVEL}                          - Upper-case level name (DEBUG, INFO, WARNING, ERROR, CRITICAL)
#     {level_icon}                     - Rich glyph (ðŸ›, â„¹, âš , âœ–, ðŸ’€)
#     {level_code}                     - Four-character abbreviation (DEBG, INFO, WARN, ERRO, CRIT)
#   Message & Context:
#     {message}                        - Raw log message string
#     {context_fields}                 - Space-prefixed key=value pairs
#     {context}                        - Full context dictionary (service, environment, job_id, extras, etc.)
#     {extra}                          - Shallow copy of extra mapping from logger call
#   Logger Identity:
#     {logger_name}                    - Logger identifier from getLogger()
#     {event_id}                       - Unique identifier generated per log event
#   System Identity:
#     {user_name}                      - System user captured during init()
#     {hostname}                       - Short hostname captured during init()
#     {process_id}                     - Current PID
#     {process_id_chain}               - Parent>child PID chain (>-joined ancestry)
#   Miscellaneous:
#     {theme}                          - Active console theme name
# Example: console_format_template = "{timestamp} [{LEVEL}] {message}"

# console_theme = "dark"
# Purpose: Rich color palette for console output
# Type: string
# Default: None (uses Rich defaults)
# Values: "classic", "dark", "neon", "pastel", or other Rich theme names
# Environment: LIB_LOG_RICH__CONSOLE_THEME
# Example: console_theme = "neon"

# console_styles = { INFO = "green", WARNING = "yellow bold", ERROR = "red bold" }
# Purpose: Override Rich styles per severity level
# Type: table with level keys
# Default: None (uses theme defaults)
# Environment: LIB_LOG_RICH__CONSOLE_STYLES (comma-separated: "LEVEL=style,LEVEL=style")
# Keys: DEBUG, INFO, WARNING, ERROR, CRITICAL
# Values: Rich style strings (color, bold, italic, etc.)
# Example: console_styles = { DEBUG = "dim cyan", INFO = "bold green" }

# force_color = false
# Purpose: Force ANSI color output even when stderr is not a TTY
# Type: boolean
# Default: false
# Environment: LIB_LOG_RICH__FORCE_COLOR
# Example: force_color = true

# no_color = false
# Purpose: Disable color output entirely (overrides force_color)
# Type: boolean
# Default: false
# Environment: LIB_LOG_RICH__NO_COLOR
# Example: no_color = true

# ------------------------------------------------------------------------------
# Backend Adapters (journald, Windows Event Log)
# ------------------------------------------------------------------------------

# backend_level = "WARNING"
# Purpose: Minimum severity threshold for journald and Windows Event Log
# Type: string (case-insensitive)
# Default: "WARNING"
# Values: "DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"
# Environment: LIB_LOG_RICH__BACKEND_LEVEL
# Example: backend_level = "ERROR"

# enable_journald = false
# Purpose: Enable systemd journald adapter (Linux only)
# Type: boolean
# Default: false
# Environment: LIB_LOG_RICH__ENABLE_JOURNALD
# Note: Requires python3-systemd package or pip install systemd
#       Silently disabled on non-Linux systems
# Example: enable_journald = true

# enable_eventlog = false
# Purpose: Enable Windows Event Log adapter (Windows only)
# Type: boolean
# Default: false
# Environment: LIB_LOG_RICH__ENABLE_EVENTLOG
# Note: Silently disabled on non-Windows systems
# Example: enable_eventlog = true

# ------------------------------------------------------------------------------
# Graylog / GELF Settings
# ------------------------------------------------------------------------------

# enable_graylog = false
# Purpose: Enable Graylog adapter for centralized logging
# Type: boolean
# Default: false
# Environment: LIB_LOG_RICH__ENABLE_GRAYLOG
# Note: Requires graylog_endpoint to be set
# Example: enable_graylog = true

# graylog_endpoint = ["logs.example.com", 12201]
# Purpose: Graylog server host and port for GELF protocol
# Type: array [host, port] or string "host:port"
# Default: None
# Environment: LIB_LOG_RICH__GRAYLOG_ENDPOINT (format: "host:port")
# Example: graylog_endpoint = ["192.168.1.100", 12201]

# graylog_protocol = "tcp"
# Purpose: Transport protocol for Graylog connection
# Type: string (case-insensitive)
# Default: "tcp"
# Values: "tcp", "udp"
# Environment: LIB_LOG_RICH__GRAYLOG_PROTOCOL
# Note: TLS only supported with TCP
# Example: graylog_protocol = "udp"

# graylog_tls = false
# Purpose: Wrap Graylog TCP connection in TLS
# Type: boolean
# Default: false
# Environment: LIB_LOG_RICH__GRAYLOG_TLS
# Note: Only valid when graylog_protocol = "tcp"
# Example: graylog_tls = true

# graylog_level = "WARNING"
# Purpose: Minimum severity level sent to Graylog
# Type: string (case-insensitive)
# Default: "WARNING"
# Values: "DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"
# Environment: LIB_LOG_RICH__GRAYLOG_LEVEL
# Example: graylog_level = "ERROR"

# ------------------------------------------------------------------------------
# Queue Settings (Background Processing)
# ------------------------------------------------------------------------------

# queue_enabled = true
# Purpose: Route log events through background queue worker
# Type: boolean
# Default: true
# Environment: LIB_LOG_RICH__QUEUE_ENABLED
# Note: Disable for synchronous logging (blocks on I/O)
# Example: queue_enabled = false

# queue_maxsize = 2048
# Purpose: Maximum pending events before queue full policy applies
# Type: integer (> 0)
# Default: 2048
# Environment: LIB_LOG_RICH__QUEUE_MAXSIZE
# Example: queue_maxsize = 4096

# queue_full_policy = "block"
# Purpose: Behavior when queue is full
# Type: string
# Default: "block"
# Values: "block" (wait for space), "drop" (discard events)
# Environment: LIB_LOG_RICH__QUEUE_FULL_POLICY
# Example: queue_full_policy = "drop"

# queue_put_timeout = 1.0
# Purpose: Timeout in seconds for blocking queue puts
# Type: float (> 0) or None for no timeout
# Default: 1.0
# Environment: LIB_LOG_RICH__QUEUE_PUT_TIMEOUT
# Note: Set to 0 or None for infinite wait
# Example: queue_put_timeout = 5.0

# queue_stop_timeout = 5.0
# Purpose: Maximum time to wait for queue drain during shutdown
# Type: float (> 0) or None for infinite wait
# Default: 5.0
# Environment: LIB_LOG_RICH__QUEUE_STOP_TIMEOUT
# Example: queue_stop_timeout = 10.0

# ------------------------------------------------------------------------------
# Ring Buffer (In-Memory Event Storage)
# ------------------------------------------------------------------------------

# enable_ring_buffer = true
# Purpose: Enable in-memory circular buffer for log history
# Type: boolean
# Default: true
# Environment: LIB_LOG_RICH__ENABLE_RING_BUFFER
# Note: Enables log.dump() functionality
# Example: enable_ring_buffer = false

# ring_buffer_size = 25000
# Purpose: Maximum events retained in ring buffer
# Type: integer (> 0)
# Default: 25000
# Environment: LIB_LOG_RICH__RING_BUFFER_SIZE
# Example: ring_buffer_size = 50000

# ------------------------------------------------------------------------------
# Dump Format Settings (for log.dump())
# ------------------------------------------------------------------------------

# dump_format_preset = "full"
# Purpose: Default layout for text dumps
# Type: string (case-insensitive)
# Default: "full"
# Values: "full", "short", "full_loc", "short_loc"
# Environment: LIB_LOG_RICH__DUMP_FORMAT_PRESET
# Example: dump_format_preset = "short"

# dump_format_template = "{timestamp} {level_icon} {LEVEL:>8} {logger_name} â€” {message}"
# Purpose: Custom template for text dumps (overrides preset)
# Type: string (Python str.format template)
# Default: None (uses preset)
# Environment: LIB_LOG_RICH__DUMP_FORMAT_TEMPLATE
# Note: Uses same placeholders as console_format_template
# Example: dump_format_template = "{timestamp} [{LEVEL}] {message}"

# ------------------------------------------------------------------------------
# Security & Payload Management
# ------------------------------------------------------------------------------

# scrub_patterns = { password = ".+", secret = ".+", token = ".+" }
# Purpose: Regex patterns to redact sensitive data from logs
# Type: table with field=regex pairs
# Default: { password = ".+", secret = ".+", token = ".+" }
# Environment: LIB_LOG_RICH__SCRUB_PATTERNS (comma-separated: "field=regex,field=regex")
# Note: Patterns are merged with built-in defaults
# Example: scrub_patterns = { api_key = ".+", credit_card = "\\d{16}" }

# [lib_log_rich.payload_limits]
# Purpose: Guard against oversized log payloads
# Note: All limits are optional; unspecified values use defaults

# truncate_message = true
# Purpose: Truncate vs reject oversized messages
# Type: boolean
# Default: true
# Note: When false, oversized messages raise ValueError

# message_max_chars = 4096
# Purpose: Maximum characters in primary log message
# Type: integer
# Default: 4096
# Example: message_max_chars = 8192

# extra_max_keys = 25
# Purpose: Maximum keys in extra metadata dict
# Type: integer
# Default: 25
# Example: extra_max_keys = 50

# extra_max_value_chars = 512
# Purpose: Maximum characters per extra value (after stringify)
# Type: integer
# Default: 512
# Example: extra_max_value_chars = 1024

# extra_max_depth = 3
# Purpose: Maximum nesting depth for extra structures
# Type: integer
# Default: 3
# Example: extra_max_depth = 5

# extra_max_total_bytes = 8192
# Purpose: Total UTF-8 byte limit for sanitized extra payload
# Type: integer or None (no limit)
# Default: 8192
# Example: extra_max_total_bytes = 16384

# context_max_keys = 20
# Purpose: Maximum keys in LogContext.extra
# Type: integer
# Default: 20
# Example: context_max_keys = 30

# context_max_value_chars = 256
# Purpose: Maximum characters per context value
# Type: integer
# Default: 256
# Example: context_max_value_chars = 512

# stacktrace_max_frames = 10
# Purpose: Number of frames preserved in exception tracebacks
# Type: integer
# Default: 10
# Note: Leading and trailing frames kept; middle frames truncated
# Example: stacktrace_max_frames = 20

# ------------------------------------------------------------------------------
# Rate Limiting
# ------------------------------------------------------------------------------

# rate_limit = [500, 60.0]
# Purpose: Throttle log emissions (max_events per window_seconds)
# Type: array [max_events, window_seconds]
# Default: None (no rate limiting)
# Environment: LIB_LOG_RICH__RATE_LIMIT (format: "MAX:WINDOW_SECONDS")
# Example: rate_limit = [1000, 60.0]  # Max 1000 events per 60 seconds

# ------------------------------------------------------------------------------
# Advanced Settings (typically not needed)
# ------------------------------------------------------------------------------

# console_stream_target = <not configurable via TOML>
# Purpose: Custom file-like object for console output
# Note: Only available programmatically when console_stream = "custom"

# console_adapter_factory = <not configurable via TOML>
# Purpose: Custom console adapter factory for queue-backed or test adapters
# Note: Only available programmatically
# Documentation: See STREAMINGCONSOLE.md in lib_log_rich docs

# diagnostic_hook = <not configurable via TOML>
# Purpose: Callback for observing runtime diagnostics
# Note: Only available programmatically
# Signature: Callable[[str, dict[str, Any]], None]
# Events: queue_worker_error, queue_drop_callback_error, message_truncated,
#         extra_keys_dropped, exc_info_truncated, rate_limited, etc.
