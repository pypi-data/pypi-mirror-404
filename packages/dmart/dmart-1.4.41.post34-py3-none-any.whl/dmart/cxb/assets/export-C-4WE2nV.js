import{p as mt,a8 as d,a9 as B,A as vt,e as l,a7 as _t,c as t,B as $,h as D,ai as k,R as f,L as ft,a6 as h,k as i,E as u,F as m,f as ht,O as M,ak as N,j as $t,l as bt,H as yt}from"./svelte-B9Ye91X-.js";import{b as xt}from"./svelte-i18n-CZ4cFDVx.js";import{d as gt}from"./downloadFile-D08i0YDh.js";import{s as O,L as G}from"./toast-nP_bUL2P.js";import{D as q,Q as J,h as wt}from"./@edraj-D-9hi9vU.js";import{b as K}from"./dmart_services-BTWOtb9Z.js";import{C as Pt,L as U,k as V,B as W}from"./flowbite-svelte-Caf58qKG.js";import{P as kt}from"./Prism-DbpuKlij.js";import{c as X}from"./queryHelpers-C9iBWwqe.js";import"./clsx-B-dksMZM.js";import"./esm-env-rsSWfq8L.js";import"./deepmerge-rn4rBaHU.js";import"./ajv-Cpj98o6Y.js";import"./intl-messageformat-Dc5UU-HB.js";import"./tslib-pJfR_DrR.js";import"./@formatjs-yKEsAtjs.js";import"./@zerodevx-z992vLW9.js";import"./spaces-5QYuv6aM.js";import"./@floating-ui-BwwcF-xh.js";import"./tailwind-variants-Cj20BoQ3.js";import"./tailwind-merge-CJvxXMcu.js";import"./prismjs-DTUiLGJu.js";var St=$("<option> </option>"),Lt=$("<option> </option>"),jt=$("<option>/</option> <!>",1),Bt=$('<div class="space-y-4"><div class="grid grid-cols-1 md:grid-cols-12 gap-4 mb-4"><div class="md:col-span-4"><!> <!></div> <div class="md:col-span-4"><!> <!></div></div> <div class="md:col-span-4 mx-auto flex items-end justify-end"><!> <!></div></div>'),Dt=$('<p class="text-gray-500 text-center">No response yet.</p>'),qt=$('<div class="min-w-11/12 m-6"><!></div> <!>',1);function te(Y,Z){mt(Z,!0);const x=()=>ft(xt,"$_",tt),[tt,et]=yt();let z=d(B([])),o=d(""),v=d("/"),g=d(null),C=d(null),S=d(B([])),L=d(B([]));vt(()=>{async function e(){l(z,(await q.getSpaces()).records,!0)}e()});async function Q(e,n){for(const c of n.records)if(c.resource_type==="folder"){const w=await K(t(o),c.shortname);await Q(`${e}/${c.shortname}`,w),t(S).push(`${e}/${c.shortname}`)}}async function at(){if(!t(o)||!t(v))return;const e={type:J.search,exact_subpath:!1,...X({space_name:t(o),subpath:t(v),search:"",offset:0,limit:1e6,retrieve_json_payload:!0,retrieve_attachments:!0})};l(g,await q.query(e),!0)}async function st(){const e={type:J.search,exact_subpath:!1,...X({space_name:t(o),subpath:t(v),search:"",offset:0,limit:1e6,retrieve_json_payload:!0,retrieve_attachments:!0})};try{const n=await q.axiosDmartInstance.post("managed/export",e,{headers:wt,responseType:"arraybuffer"});n.status!==200?O(G.warn):gt(n.data,`${t(o)}/${t(v)}.zip`,"application/zip")}catch{O(G.warn)}}_t(()=>{t(o)&&t(C)!==t(o)&&(async()=>{l(L,[],!0),l(S,[],!0);const e=await K(t(o),"/");await Q("",e),l(L,[...t(S).reverse()],!0),l(C,`${t(o)}`)})()});var T=qt(),E=D(T),rt=u(E);Pt(rt,{class:"min-w-full p-4",children:(e,n)=>{var c=Bt(),w=u(c),F=u(w),R=u(F);U(R,{for:"space_name",class:"mb-2",children:(s,b)=>{var a=k();f(r=>h(a,r),[()=>x()("space_name")]),i(s,a)},$$slots:{default:!0}});var lt=m(R,2);V(lt,{id:"space_name",get value(){return t(o)},set value(s){l(o,s,!0)},children:(s,b)=>{var a=ht(),r=D(a);M(r,17,()=>t(z),N,(j,y)=>{var p=St(),_=u(p),P={};f(()=>{h(_,t(y).shortname),P!==(P=t(y).shortname)&&(p.value=(p.__value=t(y).shortname)??"")}),i(j,p)}),i(s,a)},$$slots:{default:!0}});var pt=m(F,2),A=u(pt);U(A,{for:"subpath",class:"mb-2",children:(s,b)=>{var a=k();f(r=>h(a,r),[()=>x()("subpath")]),i(s,a)},$$slots:{default:!0}});var ut=m(A,2);V(ut,{id:"subpath",get value(){return t(v)},set value(s){l(v,s,!0)},children:(s,b)=>{var a=jt(),r=D(a);r.value=r.__value="/";var j=m(r,2);M(j,17,()=>t(L),N,(y,p)=>{var _=Lt(),P=u(_),I={};f(()=>{h(P,t(p)),I!==(I=t(p))&&(_.value=(_.__value=t(p))??"")}),i(y,_)}),i(s,a)},$$slots:{default:!0}});var ct=m(w,2),H=u(ct);W(H,{onclick:at,color:"blue",children:(s,b)=>{var a=k();f(r=>h(a,r),[()=>x()("submit")]),i(s,a)},$$slots:{default:!0}});var dt=m(H,2);W(dt,{class:"mx-5",color:"blue",outline:!0,onclick:st,children:(s,b)=>{var a=k();f(r=>h(a,r),[()=>x()("download_zip")]),i(s,a)},$$slots:{default:!0}}),i(e,c)},$$slots:{default:!0}});var ot=m(E,2);{var it=e=>{var n=Dt();i(e,n)},nt=e=>{kt(e,{get code(){return t(g)},set code(n){l(g,n,!0)}})};$t(ot,e=>{t(g)===null?e(it):e(nt,!1)})}i(Y,T),bt(),et()}export{te as default};
