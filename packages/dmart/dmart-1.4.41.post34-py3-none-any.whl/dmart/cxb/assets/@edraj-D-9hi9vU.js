var p=(t=>(t.success="success",t.failed="failed",t))(p||{}),i=(t=>(t.managed="managed",t.public="public",t))(i||{});let e={"Content-type":"application/json",Authorization:""};var h=(t=>(t.aggregation="aggregation",t.search="search",t.subpath="subpath",t.events="events",t.history="history",t.tags="tags",t.spaces="spaces",t.counters="counters",t.reports="reports",t.attachments="attachments",t.attachments_aggregation="attachments_aggregation",t))(h||{}),m=(t=>(t.ascending="ascending",t.descending="descending",t))(m||{}),g=(t=>(t.create="create",t.update="update",t.replace="replace",t.delete="delete",t.move="move",t.updateACL="update_acl",t.assign="assign",t))(g||{}),f=(t=>(t.json="json",t.comment="comment",t.media="media",t.relationship="relationship",t.alteration="alteration",t.csv="csv",t.parquet="parquet",t.jsonl="jsonl",t.sqlite="sqlite",t))(f||{}),w=(t=>(t.user="user",t.group="group",t.folder="folder",t.schema="schema",t.content="content",t.acl="acl",t.comment="comment",t.reaction="reaction",t.media="media",t.locator="locator",t.relationship="relationship",t.alteration="alteration",t.history="history",t.space="space",t.branch="branch",t.permission="permission",t.role="role",t.ticket="ticket",t.json="json",t.post="post",t.plugin_wrapper="plugin_wrapper",t.notification="notification",t.jsonl="jsonl",t.csv="csv",t.sqlite="sqlite",t.parquet="parquet",t))(w||{}),u=(t=>(t.text="text",t.html="html",t.markdown="markdown",t.json="json",t.image="image",t.python="python",t.pdf="pdf",t.audio="audio",t.video="video",t.jsonl="jsonl",t.apk="apk",t.csv="csv",t.sqlite="sqlite",t.parquet="parquet",t))(u||{});class n{static setAxiosInstance(a){n.axiosDmartInstance=a}static getAxiosInstance(){if(!n.axiosDmartInstance)throw new Error("Axios instance is not set. Please set it using setAxiosInstance method.");return n.axiosDmartInstance}static getHeaders(){return e}static setHeaders(a){Object.assign(e,a)}static getBaseURL(){return n.axiosDmartInstance.defaults.baseURL}static set setBaseURL(a){n.axiosDmartInstance.defaults.baseURL=a}static getToken(){return e.Authorization?e.Authorization.replace("Bearer ",""):null}static setToken(a){e.Authorization=`Bearer ${a}`}static async login(a,s){var c;const o=(await n.axiosDmartInstance.post("user/login",{shortname:a,password:s},{headers:e})).data;return o.status==p.success&&o.records.length>0&&(e.Authorization="Bearer "+((c=o.records[0])==null?void 0:c.attributes.access_token)),o}static async loginBy(a,s){var r;try{const c=(await n.axiosDmartInstance.post("user/login",{...a,password:s},{headers:e})).data;return c.status==p.success&&c.records.length>0&&(e.Authorization="Bearer "+((r=c.records[0])==null?void 0:r.attributes.access_token)),c}catch(o){throw o}}static async logout(){try{const{data:a}=await n.axiosDmartInstance.post("user/logout",{},{headers:e});return a}catch(a){throw a}}static async createUser(a){try{const{data:s}=await n.axiosDmartInstance.post("user/create",a,{headers:e});return s}catch(s){throw s}}static async updateUser(a){try{const{data:s}=await n.axiosDmartInstance.post("user/profile",a,{headers:e});return s}catch(s){throw s}}static async checkExisting(a,s){try{const{data:r}=await n.axiosDmartInstance.get(`user/check-existing?${a}=${s}`,{headers:e});return r}catch(r){throw r}}static async getProfile(){var a,s,r;try{const{data:o}=await n.axiosDmartInstance.get("user/profile",{headers:e});return typeof localStorage<"u"&&o.status==="success"&&(localStorage.setItem("permissions",JSON.stringify((a=((o==null?void 0:o.records)??[{}])[0])==null?void 0:a.attributes.permissions)),localStorage.setItem("roles",JSON.stringify((r=(s=((o==null?void 0:o.records)??[{}])[0])==null?void 0:s.attributes)==null?void 0:r.roles))),o}catch(o){throw o}}static async query(a,s=i.managed){try{a.type!=h.spaces&&(a.sort_type=a.sort_type||m.ascending,a.sort_by=a.sort_by||"created_at"),a.subpath=a.subpath.replace(/\/+/g,"/");const{data:r}=await n.axiosDmartInstance.post(`${s}/query`,a,{headers:e});return r}catch(r){throw r}}static async csv(a){try{a.sort_type=a.sort_type||m.ascending,a.sort_by="created_at",a.subpath=a.subpath.replace(/\/+/g,"/");const{data:s}=await n.axiosDmartInstance.post("managed/csv",a,{headers:e});return s}catch(s){throw s}}static async resourcesFromCsv(a){try{let s=`/managed/resources_from_csv/${a.resourceType}/${a.space_name}/${a.subpath}`;const r={};a.schema&&(s+=`/${a.schema}`);let o=new FormData;o.append("resources_file",a.payload),a.isUpdate&&(r.is_update=a.isUpdate);const c={"Content-Type":"multipart/form-data"},{data:l}=await n.axiosDmartInstance.post(s,o,{headers:c,params:r});return l}catch(s){return s}}static async request(a){const s=await n.axiosDmartInstance.post("managed/request",a,{headers:e});return s==null?void 0:s.data}static async retrieveEntry(a,s=i.managed){try{a.validate_schema===null&&(a.validate_schema=!0),(!a.subpath||a.subpath=="/")&&(a.subpath="__root__");const r=`${s}/entry/${a.resource_type}/${a.space_name}/${a.subpath}/${a.shortname}?retrieve_json_payload=${a.retrieve_json_payload}&retrieve_attachments=${a.retrieve_attachments}&validate_schema=${a.validate_schema}`,{data:o}=await n.axiosDmartInstance.get(`${r.replace(/\/+/g,"/")}`,{headers:e});return o}catch(r){throw r}}static async uploadWithPayload(a,s=i.managed){const r={resource_type:a.resource_type,subpath:a.subpath,shortname:a.shortname,attributes:a.attributes};a.attributes!==null&&Object.keys(a.attributes).length===0?r.attributes={is_active:!0,payload:{body:{}}}:Object.keys(a.attributes).includes("is_active")||(r.attributes.is_active=!0);const o=new Blob([JSON.stringify(r)],{type:"application/json"}),c=new FormData;c.append("space_name",a.space_name),c.append("request_record",o),c.append("payload_file",a.payload_file);const l={"Content-Type":"multipart/form-data"};try{const{data:d}=await n.axiosDmartInstance.post(`${s}/resource_with_payload`,c,{headers:l});return d}catch(d){throw d}}static async fetchDataAsset(a){try{const{data:s}=await n.axiosDmartInstance.post("managed/data-asset",{space_name:a.spaceName,resource_type:a.resourceType,data_asset_type:a.dataAssetType,subpath:a.subpath,shortname:a.shortname,query_string:a.query_string??"SELECT * FROM file",filter_data_assets:a.filter_data_assets},{headers:e});return s}catch(s){throw s}}static async getSpaces(){return await this.query({type:h.spaces,space_name:"management",subpath:"/",search:"",limit:100})}static async getChildren(a){return a.limit===null&&(a.limit=20),a.offset===null&&(a.offset=0),a.restrict_types===null&&(a.restrict_types=[]),await this.query({type:h.search,space_name:a.space_name,subpath:a.subpath,filter_types:a.restrict_types,exact_subpath:!0,search:a.search,limit:a.limit,offset:a.offset})}static getAttachmentUrl(a,s=i.managed){const r=a.subpath.replace(/\/+$/,"");return`${n.axiosDmartInstance.defaults.baseURL}`+`/${s}/payload/${a.resource_type}/${a.space_name}/${r}/${a.parent_shortname}/${a.shortname}${a.ext===null?"":`.${a.ext}`}`.replaceAll("//","/")}static async getSpaceHealth(a){try{const{data:s}=await n.axiosDmartInstance.get(`managed/health/${a}`,{headers:e});return s}catch(s){throw s}}static async getPayload(a,s=i.managed){try{let r=`${s}/payload/${a.resource_type}/${a.space_name}/${a.subpath}/${a.shortname}`;a.schemaShortname&&(r+=`.${a.schemaShortname}`),r+=`.${a.ext}`;const{data:o}=await n.axiosDmartInstance.get(r,{headers:e});return o}catch(r){throw r}}static async progressTicket(a){try{const s={};a.resolution&&(s.resolution=a.resolution),a.comment&&(s.comment=a.comment);const{data:r}=await n.axiosDmartInstance.put(`managed/progress-ticket/${a.space_name}/${a.subpath}/${a.shortname}/${a.action}`,s,{headers:e});return r}catch(s){throw s}}static async submit(a){try{var s=`public/submit/${a.spaceName}`;a.resourceType&&(s+=`/${a.resourceType}`),a.workflowShortname&&(s+=`/${a.workflowShortname}`),s+=`/${a.schemaShortname}/${a.subpath}`;const{data:r}=await n.axiosDmartInstance.post(s,a.record,{headers:e});return r}catch(r){throw r}}static async getManifest(){try{const{data:a}=await n.axiosDmartInstance.get("info/manifest",{headers:e});return a}catch(a){throw a}}static async getSettings(){try{const{data:a}=await n.axiosDmartInstance.get("info/settings",{headers:e});return a}catch(a){throw a}}static async otpRequest(a,s=null){try{const r={...e};s&&(r["Accept-Language"]=s);const{data:o}=await n.axiosDmartInstance.post("user/otp-request",a,{headers:r});return o}catch(r){throw r}}static async otpRequestLogin(a,s=null){try{const r={...e};s&&(r["Accept-Language"]=s);const{data:o}=await n.axiosDmartInstance.post("user/otp-request-login",a,{headers:r});return o}catch(r){throw r}}static async passwordResetRequest(a){try{const{data:s}=await n.axiosDmartInstance.post("user/password-reset-request",a,{headers:e});return s}catch(s){throw s}}static async confirmOtp(a){try{const{data:s}=await n.axiosDmartInstance.post("user/otp-confirm",a,{headers:e});return s}catch(s){throw s}}static async userReset(a){try{const{data:s}=await n.axiosDmartInstance.post("user/reset",{shortname:a},{headers:e});return s}catch(s){throw s}}static async validatePassword(a){try{const{data:s}=await n.axiosDmartInstance.post("user/validate_password",{password:a},{headers:e});return s}catch(s){throw s}}}export{u as C,n as D,h as Q,w as R,m as S,g as a,f as b,e as h};
