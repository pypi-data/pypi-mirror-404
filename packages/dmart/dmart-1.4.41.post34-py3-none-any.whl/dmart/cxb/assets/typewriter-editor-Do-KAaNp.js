var bt=Object.defineProperty;var Et=(e,n,t)=>n in e?bt(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var b=(e,n,t)=>Et(e,typeof n!="symbol"?n+"":n,t);import{T as I,D as x,i as R,n as C,a as P,L as ye,A as fe,h as Lt}from"./@typewriter-cCzskkIv.js";import{d as J}from"./fast-diff-C-IidNf4.js";import"./easy-signal-BiPFIK3O.js";import"./svelte-B9Ye91X-.js";const be=new WeakMap,wt=new WeakMap;class Nt{on(n,t,s){this.addEventListener(n,t,s)}off(n,t,s){this.removeEventListener(n,t,s)}addEventListener(n,t,s){s!=null&&s.once&&(t=Te(this,n,t,!0)),V(this,n,!0).add(t)}removeEventListener(n,t,s){if(s!=null&&s.once&&(t=Te(this,n,t)),!t)return;const r=V(this,n);r&&r.delete(t)}dispatchEvent(n,t){let s=!1;n.bubbles&&(n.stopImmediatePropagation=n.stopPropagation=()=>s=!0);const r=V(this,n.type);if(r)for(let o of r){if(t)try{o.call(this,n)}catch(i){try{this.dispatchEvent(new ErrorEvent("error",{error:i}))}catch{}}else o.call(this,n);if(s)break}}}function V(e,n,t=!1){let s=be.get(e);return!s&&t&&be.set(e,s=Object.create(null)),s&&s[n]||t&&(s[n]=new Set)}function Te(e,n,t,s=!1){let r=wt.get(e);!r&&s&&be.set(e,r=Object.create(null));const o=r&&r[n]||s&&(r[n]=new Map);if(!o.has(t)&&s){const i=a=>{const c=V(e,n);c&&c.delete(t),t.call(e,a)};o.set(t,i)}return o&&o.get(t)}var D;(function(e){e.api="api",e.user="user",e.history="history",e.input="input",e.paste="paste"})(D||(D={}));const vt="http://www.w3.org/2000/svg",At=new Set(["value","selected","checked","contentEditable"]),k=e=>e==null?e:e.key,Ze=(e,n)=>{n&&n!==e.key&&(e.key=n),!n&&e.key&&delete e.key},De=e=>{e.currentTarget.events[e.type](e)},Ge=(e,n,t,s,r)=>{n==="key"||(n[0]==="o"&&n[1]==="n"?((e.events||(e.events={}))[n=n.slice(2)]=s)?t||e.addEventListener(n,De):e.removeEventListener(n,De):s==null?e.removeAttribute(n):!r&&n!=="list"&&n!=="form"&&n in e?e[n]=s??"":e.setAttribute(n,s))},ne=(e,n)=>{if(typeof e=="string")return document.createTextNode(e);var t=e.props,s=(n=n||e.type==="svg")?document.createElementNS(vt,e.type,{is:t.is}):document.createElement(e.type,{is:t.is});for(var r in t)Ge(s,r,null,t[r],n);return Ze(s,k(e)),e.children.forEach(o=>s.appendChild(ne(W(o),n))),s},Ft=(e,n)=>{const t={};for(let s=0;s<e.attributes.length;s++){const{name:r,value:o}=e.attributes[s];r in e&&r!=="list"&&!n?t[r]=e[r]:t[r]=o===""?!0:o}return t},B=(e,n,t,s,r)=>{if(typeof s=="string")t!=null&&t.nodeType===Node.TEXT_NODE?t.nodeValue!==s&&(n.nodeValue=s):(n=e.insertBefore(ne(s,r),n),t!=null&&e.removeChild(t));else if(t==null||t.nodeName.toLowerCase()!==s.type)n=e.insertBefore(ne(W(s),r),n),t!=null&&e.removeChild(t);else{var o=Ft(t,r),i=s.props;r=r||s.type==="svg";for(var a in{...o,...i})(At.has(a)?n[a]:o[a])!==i[a]&&Ge(n,a,o[a],i[a],r);Ze(n,s.key),Qe(n,s.children,r)}return n},Qe=(e,n,t,s=Array.from(e.childNodes))=>{for(var r,o,i,a,c=0,h=0,l=s.length-1,d=n.length-1;h<=d&&c<=l&&!((i=k(s[c]))==null||i!==k(n[h]));)B(e,s[c],s[c++],n[h]=W(n[h++]),t);for(;h<=d&&c<=l&&!((i=k(s[l]))==null||i!==k(n[d]));)s[l]=B(e,s[l],s[l--],n[d]=W(n[d--]),t);if(c>l){const f=s[c]||s[c-1]&&s[c-1].nextSibling||null;for(;h<=d;)e.insertBefore(ne(n[h]=W(n[h++]),t),f)}else if(h>d)for(;c<=l;)e.removeChild(s[c++]);else{const f=new Map,m=new Set;for(let u=c;u<=l;u++)(i=k(s[u]))!=null&&f.set(i,s[u]);for(;h<=d;){if(i=k(o=s[c]),a=k(n[h]=W(n[h])),m.has(i)||a!=null&&a===k(s[c+1])){i==null&&e.removeChild(o),c++;continue}a==null?(i==null&&(B(e,o,o,n[h],t),h++),c++):(i===a?(B(e,o,o,n[h],t),m.add(a),c++):(r=f.get(a))!=null?(B(e,e.insertBefore(r,o),r,n[h],t),m.add(a)):B(e,o,null,n[h],t),h++)}for(;c<=l;)k(o=s[c++])==null&&e.removeChild(o);for(const[u,g]of f)m.has(u)||e.removeChild(g)}return e},W=e=>e!==!0&&e!==!1&&e?e:"",Tt=(e,n,t,s)=>({type:e,props:n,children:t,key:s}),A=(e,n,t)=>typeof e=="function"?e(n||{},t):Tt(e,n||{},Array.isArray(t)?t:t==null?[]:[t],n==null?void 0:n.key),le=(e,n,t)=>(Array.isArray(n)?e=Qe(e,n,e instanceof window.SVGElement,t):e=B(e.parentNode,e,e,n),e),Dt=/;\s*$/,xt={name:"decoration",selector:"span.format.decoration",fromDom:!1,render:(e,n)=>we(A("span",{},n),e,["format","decoration"])},kt={name:"decoration",selector:".embed.decoration",fromDom:!1,noFill:!0,render:(e,n)=>{const t="embed decoration",{name:s,...r}=e.decoration;return r.class=r.class?t+" "+r.class:t,A(s||"span",r,n)}};class Ct extends Event{constructor(t,s){super(t,s);b(this,"old");b(this,"doc");b(this,"change");b(this,"changedLines");this.old=s.old,this.doc=s.doc,this.change=s.change,this.changedLines=s.changedLines}}function St(e){e.typeset.formats.add(xt),e.typeset.embeds.add(kt);const n=new Map;let t=e.doc,s=t,r=t,o=!1;e.on("change",l),e.on("render",f);function i(m){if(!m)throw new TypeError("A decoration name is required");const u=n.get(m);return new Mt(m,e.doc,u,h,a)}function a(m){var p,y;if(!m)throw new TypeError("A decoration name is required");const u=n.get(m);if(!u)return!1;const g=Ke(m,u,t);return n.delete(m),n.size?r=r.apply(g):r=t,o||((p=e.modules.rendering)==null||p.render({old:s,doc:r}),(y=e.modules.selection)==null||y.renderSelection()),!0}function c(){n.size&&n.clear(),r=t}function h(m,u){var y,L;const g=n.get(m),p=g?g.compose(u,!0):u;R(p,g)||!g&&!p.ops.length||(p.ops.length?n.set(m,p):n.delete(m),r=n.size?r.apply(u,null):t,o||((y=e.modules.rendering)==null||y.render({old:s,doc:r}),(L=e.modules.selection)==null||L.renderSelection()))}function l(m){const{change:u,changedLines:g}=m;if(t=m.doc,u){if(u.contentChanged){for(let[p,y]of n)y=u.delta.transform(y,!0),y.ops.length?n.set(p,y):n.delete(p);r=n.size?r.apply(u.delta,null):t,n.size&&r.lines.forEach((p,y)=>{const L=t.lines[y];p!==L&&p.id!==L.id&&(p.id=L.id)})}}else c();d(u,g)}function d(m,u){const g={old:s,doc:t,change:m,changedLines:u};o=!0,e.dispatchEvent(new Ct("decorate",g)),o=!1}function f(){s=r}return{get old(){return s},get doc(){return r},getDecorator:i,removeDecorations:a,clearDecorations:c,gatherDecorations:d,init(){d()},destroy(){e.off("change",l),e.off("render",f)}}}class Mt{constructor(n,t,s,r,o){b(this,"change");b(this,"_name");b(this,"_doc");b(this,"_decoration");b(this,"_apply");b(this,"_remove");this._name=n,this._doc=t,this.change=new I(t),this._decoration=s,this._apply=r,this._remove=o}hasDecorations(){return!!this._decoration&&this._decoration.ops.length>0||this.change.delta.ops.length>0}getDecoration(){return this._decoration?this._decoration.compose(this.change.delta):this.change.delta}apply(){return this._apply(this._name,this.change.delta)}remove(){return this._remove(this._name)}clear(n){return this.hasDecorations()?(n?this.change.setDelta(this.change.delta.compose(this.invert(n))):this.change.setDelta(this.invert()),this):this}clearLines(n){if(!n.length)return this;const t=this._doc,s=[t.getLineRange(n[0])[0],t.getLineRange(n[n.length-1])[1]];if(n.length===1||n.every((c,h)=>!h||t.getLineRange(n[h-1])[1]===t.getLineRange(c)[0]))return this.clear(s);const o=this.invert(s),i=new x;let a=0;return n.forEach(c=>{const[h,l]=t.getLineRange(c);i.retain(h-a).concat(o.slice(h,l)),a=l}),this.change.setDelta(this.change.delta.compose(i)),this}clearLine(n){const t=this._doc,s=typeof n=="number"?t.getLineAt(n):typeof n=="string"?t.getLineBy(n):n;return this.clearLines([s])}invert(n){return this._decoration?Ke(this._name,this._decoration,this._doc,n):new x}decorateText(n,t={class:this._name}){return this.change.formatText(n,{decoration:{[this._name]:t}}),this}decorateLine(n,t={class:this._name}){return this.change.formatLine(n,{decoration:{[this._name]:t}},!0),this}insertDecoration(n,t={class:this._name}){if(typeof t=="string")throw new Error("You may only insert embed decorations");return this.change.insert(n,{decoration:t}),this}}function we(e,n,t){if(!n||!n.decoration)return e;const s=new Set(t);let r="",o=e.props;Object.values(n.decoration).forEach(a=>{const{class:c,style:h,...l}=a;c&&s.add(c.trim()),h&&(r+=h.trim()),r&&!Dt.test(r)&&(r+=";"),o={...l,...o}});const i=Array.from(s).join(" ").trim();return i&&(o.class=o.class?o.class+" "+i:i),r&&(o.style=o.style?o.style+";"+r:r),e.props=o,e}function Ke(e,n,t,s){let r=t.toDelta();return s&&(r=r.slice(s[0],s[1]),n=n.slice(s[0],s[1])),n=n.invert(r),n.ops.forEach(o=>{var i;((i=o.attributes)==null?void 0:i.decoration)===null&&(o.attributes.decoration={[e]:null})}),s&&(n=new x().retain(s[0]).concat(n)),n}const _t=[],xe=A("br",{}),ee=new WeakMap,ke=new WeakMap,Ce=new WeakMap,Se=new WeakMap,Ne=new WeakMap;function S(e,n){var t,s;return(s=(t=Ne.get(e))==null?void 0:t.get(n))==null?void 0:s[0]}function se(e,n){var t,s;return(s=(t=Ne.get(e))==null?void 0:t.get(n))==null?void 0:s[1]}function Ve(e){const{root:n,doc:t}=e,s=re(e,t.lines),r=new WeakMap;for(let i=0;i<n.children.length;i++){const a=n.children[i];if(!a.key)continue;const c=s.byKey[a.key];if(c)if(Array.isArray(c)){r.set(a,[t.getLineRange(c[0])[0],t.getLineRange(c[c.length-1])[1]]);const h=a.querySelectorAll(e.typeset.lines.selector);for(let l=0;l<h.length;l++){const d=h[l],f=t.getLineBy(d.key);f&&r.set(d,t.getLineRange(f))}}else r.set(a,t.getLineRange(c))}const o=n.querySelectorAll(e.typeset.lines.selector);for(let i=0;i<o.length;i++){const a=o[i];if(r.has(a)||!a.key)continue;const c=t.getLineBy(a.key);r.set(a,t.getLineRange(c))}Ne.set(n,r)}function Ee(e,n){const{root:t}=e;e.dispatchEvent(new Event("rendering")),le(t,et(e,n)),Ve(e),e.dispatchEvent(new Event("render")),e.dispatchEvent(new Event("rendered"))}function Me(e,n,t){const{root:s}=e,r=re(e,n.lines).combined,o=re(e,t.lines).combined,[i,a]=Pt(r,o);R(i,a)||(i[0]=Math.max(0,i[0]-1),a[0]=Math.max(0,a[0]-1),i[1]=Math.min(r.length,i[1]+1),a[1]=Math.min(o.length,a[1]+1),s.childNodes.length!==r.length&&(i[1]+=s.childNodes.length-r.length));const c=Array.from(s.childNodes).slice(i[0],i[1]),h=o.slice(a[0],a[1]);if(!c.length&&!h.length)return Ee(e,t);e.dispatchEvent(new Event("rendering")),le(s,tt(e,h),c),Ve(e),e.dispatchEvent(new Event("render")),e.dispatchEvent(new Event("rendered"))}function et(e,n,t){return tt(e,re(e,n.lines).combined,t)}function tt(e,n,t){return n.map(s=>Rt(e,s,t)).filter(Boolean)}function Rt(e,n,t){return Array.isArray(n)?Bt(e,n,t):Ot(e,n,t)}function Ot(e,n,t){const s=oe(e,n);if(!s.render)throw new Error("No render method defined for line");const r=s.render(n.attributes,ve(e,n),n,e,t);return we(r,n.attributes),r.key=n.id,r}function Bt(e,n,t){const s=oe(e,n[0]);if(!s.renderMultiple)throw new Error("No render method defined for line");const r=s.renderMultiple(n.map(o=>[o.attributes,ve(e,o),o.id]),e,t);return r.key=n[0].id,r}function re(e,n){const t=Se.get(n);if(t)return t;const s=[],r={};let o=[];n.forEach((a,c)=>{const h=oe(e,a);if(h.shouldCombine){o.push(a);const l=n[c+1];if(!l||oe(e,l)!==h||!h.shouldCombine(o[0].attributes,l.attributes)){const d=Ce.get(o[0]);d&&d.length===o.length&&o.every((f,m)=>d[m]===f)?o=d:Ce.set(o[0],o),s.push(o),r[o[0].id]=o,o=[]}}else h.render&&(s.push(a),r[a.id]=a)});const i={combined:s,byKey:r};return Se.set(n,i),i}function Pt(e,n){const t=e.length,s=n.length,r=Math.min(t,s);let o=0,i=0,a=0,c=0;for(let h=0;h<r;h++)if(!_e(e[h],n[h])){o=a=h;break}for(let h=0;h<r;h++)if(!_e(e[t-h-1],n[s-h-1])){i=t-h,c=s-h;break}return[[o,i],[a,c]]}function ve(e,n,t){const{lines:s,formats:r,embeds:o}=e.typeset;let i=[],a=[],c=!0,h;return n.content.ops.forEach((l,d,f)=>{let m=[];if(l.insert==="	"&&l.attributes&&(h=s.findByAttributes(l.attributes))&&h.child){h.render&&(i=ie(i),c&&i.push(xe),a.push(h.render(l.attributes,i,n,e,t)),i=[]);return}if(typeof l.insert=="string"){const u=f[d-1],g=f[d+1];let p=l.insert.replace(/  /g,"  ").replace(/  /g,"  ");(!u||typeof u.insert=="object")&&(p=p.replace(/^ /," ")),(!g||typeof g.insert=="object"||Wt(g))&&(p=p.replace(/ $/," ")),c=!1,m.push(p)}else if(l.insert){const u=o.findByAttributes(l.insert);u!=null&&u.render&&(m.push(u.render(l.insert,_t,n,e,t)),u.name==="br"?c=!0:u.noFill||(c=!1))}l.attributes&&Object.keys(l.attributes).sort((u,g)=>r.priority(g)-r.priority(u)).forEach(u=>{const g=r.get(u);if(g!=null&&g.render){const p=g.render(l.attributes,m,n,e,t);p&&(ee.set(p,g),m=[p])}}),i.push.apply(i,m)}),i=ie(i),c&&i.push(xe),a.length?a:i}function _e(e,n){return e===n?!0:Array.isArray(e)&&Array.isArray(n)&&e.length===n.length&&e.every((t,s)=>t===n[s])}function oe(e,n){let t=ke.get(n.attributes);return t||(t=e.typeset.lines.findByAttributes(n.attributes,!0),ke.set(n.attributes,t)),t}function ie(e){const n=[];if(e.forEach((t,s)=>{const r=n.length-1,o=n[r];o&&typeof o!="string"&&typeof t!="string"&&ee.has(o)&&ee.get(o)===ee.get(t)&&It(o.props,t.props)?o.children=o.children.concat(t.children):o&&typeof o=="string"&&typeof t=="string"?n[r]+=t:(n.push(t),o&&typeof o!="string"&&o.children&&(o.children=ie(o.children)))}),n.length){const t=n[n.length-1];t&&typeof t!="string"&&t.children&&(t.children=ie(t.children))}return n}function It(e,n){return Object.keys({...e,...n}).every(t=>t.slice(0,2)==="on"||e[t]===n[t])}function Wt(e){return typeof e.insert=="string"&&e.insert[0]===" "}function zt(e){e.on("change",t);function n(s){if(s){const{doc:r,old:o}=s;o&&r?Me(e,o,r):r&&Ee(e,r)}else{const{doc:r}=e.modules.decorations||e;Ee(e,r)}}function t(s){const{doc:r,old:o}=e.modules.decorations||s;o.lines!==r.lines&&Me(e,o,r)}return{render:n,destroy(){e.off("change",t)}}}const he=[],nt={},st={},rt={},Ht=(e,n)=>!0;class te{constructor(n){b(this,"lines");b(this,"formats");b(this,"embeds");var o,i,a;const t=(o=n.lines)==null?void 0:o.map(c=>typeof c=="string"?nt[c]:c).filter(Boolean),s=(i=n.formats)==null?void 0:i.map(c=>typeof c=="string"?st[c]:c).filter(Boolean),r=(a=n.embeds)==null?void 0:a.map(c=>typeof c=="string"?rt[c]:c).filter(Boolean);this.lines=new de(t||he),this.formats=new de(s||he),this.embeds=new de(r||he)}}b(te,"line",O),b(te,"format",Y),b(te,"embed",Ae);function O(e){return e.renderMultiple&&!e.shouldCombine&&(e.shouldCombine=Ht),nt[e.name]=e}function Y(e){return st[e.name]=e}function Ae(e){return rt[e.name]=e}class de{constructor(n){b(this,"list");b(this,"selector");b(this,"types");b(this,"priorities");this.list=n,this.init()}get default(){return this.list[0]}init(){this.selector=this.list.map(n=>n.selector||"").filter(Boolean).join(", "),this.types=this.list.reduce((n,t)=>(n[t.name]=t,n),{}),this.priorities=this.list.reduce((n,t,s)=>(n[t.name]=s,n),{})}add(n){this.list.push(n),this.init()}remove(n){const t=typeof n=="string"?n:n.name;this.list=this.list.filter(s=>s.name!==t),this.init()}get(n){return this.types[n]}priority(n){const t=this.priorities[n];return t!==void 0?t:-1}matches(n){if(!n)return!1;if(!n.nodeType)throw new Error("Cannot match against "+n);if(n.nodeType===Node.ELEMENT_NODE)return this.selector?n.matches(this.selector):!1}findByNode(n,t=!1){if(n.nodeType!==Node.ELEMENT_NODE)return;let s=this.list.length;for(;s--;){let r=this.list[s];if(n.matches(r.selector))return r}if(t)return this.default}findByAttributes(n,t=!1){const s=n&&Object.keys(n);let r;return s&&s.every(o=>!(r=this.get(o))),r||(t?this.default:void 0)}}Ae({name:"image",selector:"img",commands:e=>(n,t)=>e.insert({image:n,...t}),fromDom:e=>{const n={};return["src","alt","width","height"].forEach(t=>{if(!e.hasAttribute(t))return;const s=e.getAttribute(t);t==="src"&&(t="image"),n[t]=s}),n},render:e=>{const{image:n,...t}=e;return t.src=n,A("img",t)}});Ae({name:"br",selector:"br",commands:e=>()=>e.insert({br:!0}),render:()=>A("br")});Y({name:"bold",selector:"strong, b",styleSelector:'[style*="font-weight:bold"], [style*="font-weight: bold"]',commands:e=>()=>e.toggleTextFormat({bold:!0}),shortcuts:"Mod+B",render:(e,n)=>A("strong",null,n)});Y({name:"italic",selector:"em, i",styleSelector:'[style*="font-style:italic"], [style*="font-style: italic"]',commands:e=>()=>e.toggleTextFormat({italic:!0}),shortcuts:"Mod+I",render:(e,n)=>A("em",null,n)});Y({name:"code",selector:"code",commands:e=>()=>e.toggleTextFormat({code:!0}),render:(e,n)=>A("code",null,n)});Y({name:"link",selector:"a[href]",greedy:!1,commands:e=>n=>e.toggleTextFormat({link:typeof n=="string"?n:!!n}),fromDom:e=>e.href,render:(e,n)=>A("a",{href:e.link,target:"_blank"},n)});O({name:"paragraph",selector:"p",commands:e=>()=>e.formatLine({}),shortcuts:"Mod+0",render:(e,n)=>A("p",null,n)});O({name:"header",selector:"h1, h2, h3, h4, h5, h6",defaultFollows:!0,commands:e=>({header:n=>e.toggleLineFormat({header:n}),header1:()=>e.toggleLineFormat({header:1}),header2:()=>e.toggleLineFormat({header:2}),header3:()=>e.toggleLineFormat({header:3}),header4:()=>e.toggleLineFormat({header:4}),header5:()=>e.toggleLineFormat({header:5}),header6:()=>e.toggleLineFormat({header:6})}),shortcuts:{"Mod+1":"header1","Mod+2":"header2","Mod+3":"header3","Mod+4":"header4","Mod+5":"header5","Mod+6":"header6"},fromDom:e=>({header:parseInt(e.nodeName.replace("H",""))}),render:(e,n)=>A(`h${e.header}`,null,n)});O({name:"list",selector:"ul > li, ol > li",indentable:!0,commands:e=>({bulletList:()=>e.toggleLineFormat({list:"bullet"}),orderedList:()=>e.toggleLineFormat({list:"ordered"}),checkList:()=>e.toggleLineFormat({list:"check"}),indent:()=>e.indent(),outdent:()=>e.outdent(),toggleCheck:n=>{const t=typeof n=="string"?e.doc.getLineBy(n):e.doc.selection?e.doc.getLineAt(e.doc.selection[0]):null;if(!t)return!1;const[s]=e.doc.getLineRange(t),r={list:"check"};t.attributes.checked||(r.checked=!0),e.formatLine(r,s)}}),shortcuts:{"Mod+Space":"toggleCheck"},fromDom(e){let n=-1,t=e.parentNode,s=t&&t.getAttribute("type");const r=e.hasAttribute("data-checked")?"check":t&&t.nodeName==="OL"?"ordered":"bullet";for(;t;){if(/^UL|OL$/.test(t.nodeName))n++;else if(t.nodeName!=="LI")break;t=t.parentNode}!n&&e.className.startsWith("ql-indent-")&&(n=parseInt(e.className.replace("ql-indent-","")));const o={list:r};return n&&(o.indent=n),s&&(o.type=s),e.getAttribute("data-checked")==="true"&&(o.checked=!0),o},nextLineAttributes(e){const{start:n,...t}=e;return t},shouldCombine:(e,n)=>e.list===n.list&&!n.start&&e.type===n.type||n.indent,renderMultiple:(e,n,t)=>{const s=[],r=[];e.forEach(([i,a,c])=>{const h=i.list==="ordered"?"ol":"ul",l=i.indent||0;let d={key:c};if(i.list==="check"){let m=function(g){n.enabled&&(g.preventDefault(),n.commands.toggleCheck(c))};const u=A("button",{class:"check-list-check",onmousedown:m,ontouchstart:m});a.length===1&&a[0].type==="br"?a.push(u):a.unshift(u),d={...d,class:"check-list-item","data-checked":""+(i.checked||!1)}}const f=we(A("li",d,a),i);for(;l>=r.length;){const m=A(h,{start:i.start,type:i.type,key:`${c}-outer`}),u=r.length?r[r.length-1].children:s,g=u[u.length-1];typeof g=="object"&&g.type==="li"&&t?g.children.push(m):u.push(m),r.push(m)}if(!o(r[l],h,i)){const m=A(h,{start:i.start,type:i.type});(l?r[l-1].children:s).push(m),r[l]=m}r[l].children.push(f),r.length=l+1});function o(i,a,c){return i.type===a&&(i.props.start===c.start||i.props.start&&!c.start)&&i.props.type===c.type}return s[0]}});O({name:"blockquote",selector:"blockquote p",commands:e=>(n=!0)=>{typeof n!="string"&&(n=!0),e.toggleLineFormat({blockquote:n})},fromDom(e){const{className:n}=e.parentNode,t=n.match(/quote-(\S+)/);return{blockquote:t&&t[1]!=="true"&&t[1]||!0}},shouldCombine:(e,n)=>e.blockquote===n.blockquote,renderMultiple:e=>{const n=e[0][0].blockquote,t=typeof n=="string"?{className:`quote-${n}`}:null,s=e.map(([r,o,i])=>A("p",{key:i},o));return A("blockquote",t,s)}});O({name:"code-block",selector:"pre code",contained:!0,commands:e=>()=>e.toggleLineFormat({"code-block":!0}),renderMultiple:e=>{const n=[];return e.forEach(([t,s,r])=>{s.length&&s[s.length-1].type==="br"&&s.pop(),n.push(A("code",{key:r},s)),n.push(`
`)}),A("pre",{spellcheck:!1},n)}});O({name:"hr",selector:"hr",frozen:!0,commands:e=>()=>{const{doc:n}=e,{selection:t}=n;if(!t)return;const s=C(t),r=e.change.delete(s);if(s[0]===s[1]&&n.getLineAt(s[0]).length===1)r.insert(s[0],`
`,{...n.getLineFormat(s[0])}).formatLine(s[0],{hr:!0});else{const o=new x().insert(`
`,n.getLineAt(s[0]).attributes).insert(`
`,{hr:!0});r.insertContent(s[0],o),r.select(s[0]+2)}e.update(r)},render:()=>A("hr")});O({name:"dl",selector:"dl dt, dl dd",fromDom(e){return{dl:e.nodeName.toLowerCase()}},onTab:(e,n)=>{const{doc:t}=e,{selection:s}=t;if(!s)return;const r=n?s[0]===s[1]||s[0]>s[1]?s[1]:s[1]-1:s[0]===s[1]||s[1]>s[0]?s[0]:s[0]-1,o=t.getLineAt(r),i=t.lines.indexOf(o),a=t.lines[i+(n?-1:1)];if(((a==null?void 0:a.attributes.dl)===o.attributes.dl||!(a!=null&&a.attributes.dl))&&!n)if(o.length===1&&o.attributes.dl==="dt")e.formatLine({},t.getLineRange(o));else{const c=t.getLineRange(o)[1]-1;e.insert(`
`,{dl:o.attributes.dl==="dt"?"dd":"dt"},[c,c])}else if(a){let c=t.getLineRange(a);c=[c[0],c[1]-1],n&&!a.attributes.dl&&(c=[c[1],c[1]]),e.select(c)}},commands:e=>()=>e.toggleLineFormat({dl:"dt"}),shouldCombine:()=>!0,nextLineAttributes:e=>({dl:e.dl==="dt"?"dd":"dt"}),renderMultiple:e=>{const n=[];let t="";for(const[s,r,o]of e)(!t||s.dl==="dt")&&n.push(A("div",{},[])),n[n.length-1].children.push(A(s.dl,{key:o},r)),t=s.dl;return A("dl",{},n)}});const jt={lines:["paragraph","header","list","blockquote","code-block","hr"],formats:["link","bold","italic","code"],embeds:["image","br"]},qt={Control:!0,Meta:!0,Shift:!0,Alt:!0},ue=navigator.userAgent.indexOf("Macintosh")!==-1,ot=ue?/Cmd/:/Ctrl/;class Fe extends KeyboardEvent{constructor(t,s){super(t,s);b(this,"shortcut");b(this,"osShortcut");b(this,"modShortcut");this.shortcut=(s==null?void 0:s.shortcut)||"",this.osShortcut=`${ue?"mac":"win"}:${this.shortcut}`,this.modShortcut=this.shortcut.replace(ot,"Mod")}static fromKeyboardEvent(t){return t.shortcut=it(t),new Fe("shortcut",t)}}function $t(e){return e.shortcut=it(e),e.osShortcut=`${ue?"mac":"win"}:${e.shortcut}`,e.modShortcut=e.shortcut.replace(ot,"Mod"),e}function it(e){const n=[];let t=e.key;return t?(t===" "&&(t="Space"),e.metaKey&&n.push("Cmd"),e.ctrlKey&&n.push("Ctrl"),e.altKey&&n.push("Alt"),e.shiftKey&&n.push("Shift"),qt[t]||(ue&&e.altKey&&e.code&&e.code.startsWith("Key")&&(t=e.code.replace("Key","")),t.length===1&&(t=t.toUpperCase()),n.push(t)),n.join("+")):""}const Z={},Xt=window.chrome&&typeof window.chrome=="object";function Yt(e){function n(l){if(l.defaultPrevented)return;if(e.doc.selection){const{lines:M}=e.typeset,z=e.doc.getLinesAt(e.doc.selection);if(z.length){const H=M.findByAttributes(z[0].attributes);if(H!=null&&H.onEnter&&z.every(yt=>H===M.findByAttributes(yt.attributes))){l.preventDefault(),H.onEnter(e);return}}}const{typeset:{lines:d},doc:f}=e;let{selection:m}=f;if(!m)return;l.preventDefault();const[u,g]=m,p=u===g,y=f.getLineAt(m[0]),[L,E]=f.getLineRange(m[0]);let{id:F,...w}=y.attributes,N;const v=d.findByAttributes(w,!0),T=g===L,_=g===E-1;if(p&&h(y)){const M=v.onEmptyEnter&&v.onEmptyEnter(e,y),z=!v.onEmptyEnter&&v!==d.default&&!v.contained&&!v.defaultFollows&&!v.frozen;if((M||z)&&i(d,f.getLineAt(u)))return}u===L&&g===E&&v.frozen?(u===0?(N={dontFixNewline:!0},m=[u,u]):g===f.length?m=[g-1,g-1]:(N={dontFixNewline:!0},m=[g,g]),w=v.nextLineAttributes?v.nextLineAttributes(w):Z):_&&(v.nextLineAttributes||v.defaultFollows||v.frozen)?w=v.nextLineAttributes?v.nextLineAttributes(w):Z:T&&!_&&(v.defaultFollows&&(w=Z),N={dontFixNewline:!0}),e.insert(`
`,w,m,N),u===L&&g===E&&v.frozen&&e.select(u===0?0:g)}function t(l){if(l.defaultPrevented)return;const{typeset:d,doc:f}=e;if(!d.embeds.get("br"))return n(l);f.selection&&(l.preventDefault(),e.insert({br:!0}))}function s(l){o(l,-1)}function r(l){o(l,1)}function o(l,d){if(l.defaultPrevented)return;const{typeset:{lines:f},doc:m}=e,{selection:u}=m;if(!u)return;const[g,p]=u,y=g===p,[L,E]=m.getLineRange(g);if(!(y&&(!Xt||l.ctrlKey||l.altKey||l.metaKey)&&(d===-1&&g!==L||d===1&&g!==E-1)))if(l.preventDefault(),d===-1&&u[0]+u[1]===0)i(f,m.getLineAt(g),!0);else{const F=C(u),w=m.getLineAt(F[0]),N=f.findByAttributes(w.attributes,!0);if(y&&(d===-1&&g===L||d===1&&g===E-1)&&!N.contained){const T=m.lines[m.lines.indexOf(w)+d],[_,M]=d===1?[w,T]:[T,w];if(_&&h(_)&&M&&!h(M))return e.update(e.change.delete([F[0]+d,F[0]],{dontFixNewline:!0}),D.input)}e.delete(d,{dontFixNewline:N.frozen})}}function i(l,d,f){if(!d)return;const m=l.findByAttributes(d.attributes,!0);if(m){if(m.indentable&&d.attributes.indent)return e.outdent(),!0;if(f||m!==l.default&&!m.defaultFollows)return e.formatLine(Z),!0}}function a(l){if(l.defaultPrevented)return;if(e.doc.selection){const{lines:f}=e.typeset,m=e.doc.getLinesAt(e.doc.selection);if(m.length){const u=f.findByAttributes(m[0].attributes);if(u!=null&&u.onTab&&m.every(g=>u===f.findByAttributes(g.attributes))){l.preventDefault(),u.onTab(e,l.shiftKey);return}}}l.preventDefault();const d=l.modShortcut;d==="Tab"||d==="Mod+]"?e.indent():e.outdent()}function c(l){var f;if(l.isComposing)return;$t(l);const d=m=>{const u=m&&e.shortcuts[m];if(u&&e.commands[u])return l.preventDefault(),e.commands[u]()!==!1};if(!e.root.dispatchEvent(Fe.fromKeyboardEvent(l))||d(l.shortcut)||d(l.osShortcut)||d(l.modShortcut)){l.preventDefault();return}switch(l.modShortcut){case"Enter":return n(l);case"Shift+Enter":return t(l);case"Tab":case"Shift+Tab":return a(l)}switch((f=l.modShortcut)==null?void 0:f.split("+").pop()){case"Backspace":return s(l);case"Delete":return r(l);default:return}}function h(l){var d;return l.length===1&&!((d=e.typeset.lines.findByAttributes(l.attributes))!=null&&d.frozen)}return{init(){e.root.addEventListener("keydown",c)},destroy(){e.root.removeEventListener("keydown",c)}}}const Ut=NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT;function U(e,n){return(e.ownerDocument||document).createTreeWalker(e,Ut,{acceptNode(t){if(t.nodeType===Node.TEXT_NODE&&t.nodeValue==="")return NodeFilter.FILTER_REJECT;if(n){const s=n(t);return s?s===!0?NodeFilter.FILTER_ACCEPT:s:NodeFilter.FILTER_REJECT}else return NodeFilter.FILTER_ACCEPT}})}const ct="address, article, aside, blockquote, editor, dd, div, dl, dt, fieldset, figcaption, figure, footer, form, h1, h2, h3, h4, h5, h6, header, hr, li, main, nav, noscript, ol, output, p, pre, section, table, tfoot, ul, video",Jt=/[\0-\x09\x0B\x0C\x0E-\x1F\x7F-\x9F\xAD\u0600-\u0605\u061C\u06DD\u070F\u180E\u200B-\u200C\u200E-\u200F\u202A-\u202E\u2060-\u2064\u2066-\u206F\uFEFF\uFFF9-\uFFFB\uE000-\uF8FF]|\uD800[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,Zt={STYLE:!0,SCRIPT:!0,LINK:!0,META:!0,TITLE:!0},Gt=/[ \t\n\r]+/g,Qt={};function X(e,n){return n.nodeName!=="BR"?!1:Kt(e,n)}function Kt(e,n){const t=n.closest&&n.closest(e.typeset.lines.selector);if(!t)return!1;const s=U(t);s.currentNode=n;const r=s.nextNode();return!r||r instanceof HTMLElement&&r.matches(ct)}function at(e,n){return le(document.createElement("div"),et(e,n,!0)).innerHTML}function Vt(e,n){return le(document.createElement("div"),ve(e,ye.create(n),!0)).innerHTML}function Re(e,n,t){return new P(lt(e,n),t)}function lt(e,n,t){const r=new window.DOMParser().parseFromString(n,"text/html"),o=Le(e,{root:r.body,possiblePartial:t==null?void 0:t.possiblePartial,collapseWhitespace:t==null?void 0:t.collapseWhitespace});return ut(o),o}function ut(e){e.ops=e.filter(n=>(typeof n.insert=="string"&&(n.insert=n.insert.replace(Jt,"").replace(/\r\n?/g,`
`)),!!n.insert||!!n.retain||!!n.delete))}function Le(e,n=Qt){const{lines:t,embeds:s}=e.typeset,r=n.root||e.root,o=n.collapseWhitespace!=null?n.collapseWhitespace:!0;var i=U(r,u=>!Zt[u.nodeName]);const a=new x;let c,h=!1,l=!1,d=!0,f,m;for(n.startNode?(i.currentNode=n.startNode,i.previousNode(),n.offset&&a.retain(n.offset,void 0)):i.currentNode=r;(f=i.nextNode())&&f!==n.endNode;)if(X(e,f))d=!1;else if(f.nodeName==="BR"&&f.className==="Apple-interchange-newline")a.insert(`
`,!c||c.unknownLine?{}:c);else if(f.nodeType===Node.TEXT_NODE){let u=f.parentNode;if(f.nodeValue==null||!f.nodeValue.replace(/\s+/g,"")&&(f.parentNode===r||f.previousSibling&&t.matches(f.previousSibling)||f.nextSibling&&t.matches(f.nextSibling)))continue;const g=f.nodeValue,y=(o?g.replace(Gt," "):g).replace(/\xA0/g," ");if(!y||y===" "&&u.classList.contains("EOP"))continue;const L=Oe(u,r,e);d=!1,a.insert(y,L)}else if(s.matches(f)){const u=s.findByNode(f);if(u){const g=Oe(f.parentNode,r,e);u.fromDom!==!1&&a.insert(u.fromDom?u.fromDom(f):{[u.name]:!0},g)}}else if(t.matches(f)||f.nodeType===Node.ELEMENT_NODE&&f.matches(ct)){if(l=!t.matches(f),l){let g=f.parentNode;for(;g&&!t.matches(g)&&g!==r;)g=g.parentNode;if(g&&g!==r)continue}const u=t.findByNode(f,!0);if(u===t.default&&(!f.parentNode||t.matches(f.parentNode)))continue;if(u.frozen)for(;i.lastChild(););if(m&&(a.insert("	",m),m=null),u.child||(h?(!c||!c.unknownLine||!d)&&(a.insert(`
`,!c||c.unknownLine?{}:c),d=!0):h=!0),l)c={unknownLine:l};else if(u&&u!==t.default){const g=u.fromDom?u.fromDom(f):{[u.name]:!0};u.child?m=g:c=g}else c={};!u.child&&n.includeIds&&f.key&&(c.id=f.key)}return(!l||!d)&&(h||!n.possiblePartial)&&a.insert(`
`,!c||c.unknownLine?{}:c),a}function Oe(e,n,t){const{lines:s,formats:r}=t.typeset,o={};for(;e&&!s.matches(e)&&e!==n;){if(r.matches(e)){const i=r.findByNode(e);i&&i.fromDom!==!1&&(o[i.name]=i.fromDom?i.fromDom(e):!0)}else e.hasAttribute("style")&&r.list.forEach(i=>{i.styleSelector&&e.matches(i.styleSelector)&&(o[i.name]=i.fromDom?i.fromDom(e):!0)});e=e.parentNode}return o}const ge=[null,0];function en(e,n,t){const s=e.root.ownerDocument;if("caretPositionFromPoint"in s)try{const r=s.caretPositionFromPoint(n,t);if(r)return ce(e,r.offsetNode,r.offset)}catch{}if(s.caretRangeFromPoint){const r=s.caretRangeFromPoint(n,t);if(r)return ce(e,r.startContainer,r.startOffset)}return null}function tn(e,n){n[0]>n[1]&&(n=[n[1],n[0]]);const[t,s,r,o]=ht(e,n),i=e.root.ownerDocument.createRange();return t&&r&&(i.setStart(t,s),i.setEnd(r,o)),i}function Be(e,n){const t=tn(e,n);if((t==null?void 0:t.endContainer.nodeType)===Node.ELEMENT_NODE)try{t.setEnd(t.endContainer,t.endOffset+1)}catch{}return t}function ce(e,n,t,s){var i;const{root:r}=e,{lines:o}=e.typeset;if(!r.contains(n))return-1;if(n.nodeType===Node.ELEMENT_NODE){if(n.childNodes.length===t){if(se(r,n)!=null)return se(r,n)-1;n.childNodes.length&&(n=n.childNodes[t-1],t=sn(e,n))}else n=n.childNodes[t],t=0;const a=S(r,n);if(a!=null)return(i=o.findByNode(n))!=null&&i.frozen?a+t:(s==null||s<a?a:a-1)+t}return ft(e,n)+t}function ft(e,n){var h;const{root:t}=e;if(!t.ownerDocument)return-1;const{lines:s,embeds:r}=e.typeset,o=U(t);o.currentNode=n;let i,a=0,c;for(;(i=o.previousNode())&&i!==t;)if((c=S(t,i))!=null){a+=c;break}else i.nodeType===Node.TEXT_NODE?a+=ae(s,i):(h=i.classList)!=null&&h.contains("decoration")||(r.matches(i)&&!X(e,i)||s.matches(i)&&!i.contains(n))&&a++;return a}function nn(e,n){const{root:t}=e;return t.ownerDocument?Array.from(t.querySelectorAll(e.typeset.lines.selector)).find(r=>S(t,r)<=n&&se(t,r)>n):void 0}function sn(e,n){var a;const{lines:t,embeds:s}=e.typeset;if(s.matches(n)&&!X(e,n))return 1;if(n.nodeType===Node.TEXT_NODE)return ae(t,n);const r=U(n);let o=t.findByNode(n)?1:0,i;for(;i=r.nextNode();)i.nodeType===Node.TEXT_NODE?o+=ae(t,i):(a=i.classList)!=null&&a.contains("decoration")||(s.matches(i)&&!X(e,i)||t.matches(i))&&o++;return o}function ht(e,n){if(n==null)return[null,0,null,0];{const t=n[0]<=n[1],s=t?1:-1,r=n[0]===n[1],[o,i,a]=Pe(e,n[0],t?0:1),[c,h]=r&&!a?[o,i]:a&&(r||n[1]-n[0]===s*e.doc.getLineAt(n[0]).length)?[o,i+(t?1:-1)]:Pe(e,n[1],t?1:0);return[o,i,c,h]}}function Pe(e,n,t){var m;const{root:s}=e;if(!s.ownerDocument)return ge;const{lines:r,embeds:o}=e.typeset,i=Array.from(s.childNodes),a=nn(e,n);if(!a)return ge;if(r.findByNode(a,!0).frozen)return[a.parentNode,i.indexOf(a)+t,!0];n-=S(s,a);const h=!n,l=U(a);let d,f=!1;for(;d=l.nextNode();)if(d.nodeType===Node.TEXT_NODE){const u=ae(r,d);if(n<=u)return[d,n];n-=u}else if(!((m=d.classList)!=null&&m.contains("decoration"))){if(o.matches(d)&&!X(e,d)){const u=o.findByNode(d);if(!u||u.fromDom===!1)continue;if(n-=1,n<=0){const g=Array.from(d.parentNode.childNodes);return[d.parentNode,g.indexOf(d)+1+n]}}else if(r.matches(d)&&(f?n-=1:f=!0,n===0)){const u=l.firstChild();if(u&&u.nodeType===Node.TEXT_NODE)return[u,0];if(u){const g=Array.from(d.childNodes);return[d,g.indexOf(u)]}else return[d,0]}}return h?[a,0]:ge}function ae(e,n){const t=n.nodeValue||"";return t.trim()||!(e.matches(n.previousSibling)||e.matches(n.nextSibling))?t.length:0}function dt(e){var o;const{root:n}=e,t=e.doc.selection;if(!n.ownerDocument)return null;const s=n.ownerDocument.getSelection(),{lines:r}=e.typeset;if(s==null||s.anchorNode==null||s.focusNode==null||!n.contains(s.anchorNode))return null;{const i=ce(e,s.anchorNode,s.anchorOffset,t&&t[0]),a=s.anchorNode===s.focusNode&&s.anchorOffset===s.focusOffset,c=r.findByAttributes((o=e.doc.getLineAt(i))==null?void 0:o.attributes,!0).frozen;let h=a?i:ce(e,s.focusNode,s.focusOffset,!c&&t?t[1]:null);return[i,h]}}function me(e,n){const{root:t}=e;if(!t.ownerDocument)return;const s=t.ownerDocument.getSelection();if(!s)return;const r=s.anchorNode&&t.contains(s.anchorNode)&&document.activeElement!==document.body;if(n==null)r&&(s.removeAllRanges(),t.classList.contains("focus")&&t.classList.remove("focus"));else{const[o,i,a,c]=ht(e,n),h=n[0]===n[1]?"Caret":"Range";o&&a&&(s.anchorNode!==o||s.anchorOffset!==i||s.focusNode!==a||s.focusOffset!==c||s.type!==h)&&s.setBaseAndExtent(o,i,a,c),r||t.focus(),t.classList.contains("focus")||t.classList.add("focus")}t.dispatchEvent(new Event("select",{bubbles:!0}))}const rn=navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),on=rn||/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,Ie=!on&&/Mobi|Android/.test(navigator.userAgent)&&!window.MSStream,cn={characterData:!0,characterDataOldValue:!0,subtree:!0,childList:!0};function an(e){let n=!1,t=!1,s=[];function r(g){t=!0}function o(g){t=!1,s.length&&(c(s),s=[])}function i(){if(t)return;const g=d.takeRecords();g.length&&c(g)}function a(g){let p=!1;const y=g.ops[g.ops.length-1];return y!=null&&y.insert&&y.insert.br&&(p=!0),p}function c(g){if(t){s.push(...g);return}if(!e.enabled)return e.render();let p=h(g),y=dt(e);if(!p){const L=un(e.root,g);p=l(L)}if(n&&(a(p)&&(p.ops.pop(),p.insert(`
`)),y!==null&&(y[0]++,y[1]++),n=!1),p&&p.ops.length){ut(p);const L=e.doc;e.update(new I(e.doc,p,y,e.activeFormats),D.input),e.doc.lines===L.lines&&e.render()}}function h(g){const p=ln(g);if(!p||p.oldValue==null||p.target.nodeValue==null)return null;const y=new x,L=ft(e,p.target);y.retain(L);let E;return e.doc.selection&&(E=C(e.doc.selection)[0]-L,E<0&&(E=0)),J(p.oldValue.replace(/\xA0/g," "),p.target.nodeValue.replace(/\xA0/g," "),E).forEach(([w,N])=>{w===J.EQUAL?y.retain(N.length):w===J.DELETE?y.delete(N.length):w===J.INSERT&&y.insert(N,e.activeFormats)}),y.chop(),y}function l(g){const{doc:p}=e;if(g){const[y,L]=g,E=S(e.root,y),F=se(e.root,L),w=Le(e,{startNode:y,endNode:L.nextElementSibling||void 0,collapseWhitespace:!1});let N=p.toDelta().slice(E,F).diff(w);return N.ops.length&&E&&(N=new x().retain(E).concat(N)),N}else{const y=Le(e,{collapseWhitespace:!1});return p.toDelta().diff(y)}}const d=new window.MutationObserver(c);function f(){d.disconnect()}function m(){d.observe(e.root,cn)}function u(g){var p;g.data&&((p=g.data)!=null&&p.includes(`
`))&&(n=!0)}return{allowComposition(g=!0){g?(e.root.addEventListener("compositionstart",r),e.root.addEventListener("compositionend",o)):(e.root.removeEventListener("compositionstart",r),e.root.removeEventListener("compositionend",o))},init(){e.root.addEventListener("input",i),e.on("rendering",f),e.on("render",m),Ie&&e.root.addEventListener("beforeinput",u)},destroy(){d.disconnect(),e.root.removeEventListener("input",i),e.root.removeEventListener("compositionstart",r),e.root.removeEventListener("compositionend",o),e.off("rendering",f),e.off("render",m),Ie&&e.root.removeEventListener("beforeinput",u)}}}function ln(e){const n=new Set;if(e=e.filter(i=>i.type!=="characterData"?!0:n.has(i.target)?!1:(n.add(i.target),!0)),e.length>3)return null;const t=e.find(i=>i.type==="characterData");if(!t)return null;const s=e.find(i=>i.addedNodes.length===1&&i.addedNodes[0].nodeName==="#text"),r=e.find(i=>i.addedNodes.length===1&&i.addedNodes[0].nodeName==="BR"||i.removedNodes.length===1&&i.removedNodes[0].nodeName==="BR");return 1+(s?1:0)+(r?1:0)<e.length||s&&s.addedNodes[0]!==t.target?null:t}function un(e,n){let t,s;for(let r=0;r<n.length;r++){const o=n[r];if(o.target===e)return;const i=fn(e,o.target);if(i&&i.key)(!t||S(e,i)<S(e,t))&&(t=i),(!s||S(e,i)>S(e,s))&&(s=i);else return}if(t&&s)return[t,s]}function fn(e,n){for(;n&&n.parentNode!==e;)n=n.parentNode;return n}function hn(e){let n,t,s=!1;function r(){if(!e.enabled)return;const f=dt(e),m=(f==null?void 0:f.slice())||null;if(!f&&s)return;if(s&&(s=!1),f){f[0]===f[1]&&f[0]===e.doc.length&&f[0]--;let g=e.doc.getLineAt(f[0]),p=e.typeset.lines.findByAttributes(g.attributes,!0);f&&f[0]===f[1]&&e.doc.selection&&e.doc.selection[0]===f[0]&&e.doc.selection[1]===f[0]+1&&(p.frozen&&(f[0]--,f[1]--),g=e.doc.getLineAt(f[0]),p=e.typeset.lines.findByAttributes(g.attributes,!0)),p.frozen&&f[0]===f[1]&&f[1]++}const{doc:u}=e;if(R(u.selection,f))R(m,f)||me(e,f);else{if(f&&f[0]===f[1]&&f[0]>=u.length)return;e.select(f)}}function o(){s||!e.enabled||me(e,e.doc.selection)}function i(){const{doc:f,typeset:{lines:m}}=e,u=e.modules.decorations.getDecorator("selection");u.clear();const g=f.selection;g&&f.getLinesAt(g).forEach(p=>{if(m.findByAttributes(p.attributes,!0).frozen){const y=R(g,f.getLineRange(p));u.decorateLine(f.getLineRange(p)[0],{class:"selected"+(y?" focus":"")})}}),u.apply()}function a(f){let m=f.target;for(;m.parentNode&&m.parentNode!==e.root;)m=m.parentNode;const u=S(e.root,m),g=u!=null&&e.doc.getLineAt(u),p=g&&e.typeset.lines.findByAttributes(g.attributes);u!=null&&g&&p&&p.frozen&&(f.preventDefault(),e.select([u,u+g.length]))}function c(f){var u;const m=((u=f.doc)==null?void 0:u.selection)||e.doc.selection;me(e,m)}function h(){e.root.classList.toggle("window-inactive",!n.hasFocus())}function l(){var u;s=!0;const{selection:f}=e.doc;(u=n.getSelection())==null||u.empty();const{decorations:m}=e.modules;f&&f[0]!==f[1]&&m&&m.getDecorator("pausedSelection").decorateText(f,{class:"selected"}).apply()}function d(){s=!1;const{decorations:f}=e.modules;f&&f.removeDecorations("pausedSelection"),setTimeout(o)}return{pause:l,resume:d,renderSelection:o,init(){n=e.root.ownerDocument,t=n.defaultView,n.addEventListener("selectionchange",r),t.addEventListener("focus",h),t.addEventListener("blur",h),e.root.addEventListener("mousedown",a),e.on("change",c),e.on("decorate",i)},destroy(){n.removeEventListener("selectionchange",r),t.removeEventListener("focus",h),t.removeEventListener("blur",h),e.root.removeEventListener("mousedown",a),e.off("change",c),e.off("decorate",i),s=!1,n=null,t=null}}}const dn={dontFixNewline:!0},We={excludeProps:new Set(["id"])};class gn extends Event{constructor(t,s){super(t,s);b(this,"delta");b(this,"html");b(this,"text");this.delta=s.delta,this.html=s.html,this.text=s.text}}function mn(e,n){const t=(n==null?void 0:n.allowHTMLPaste)??!0;function s({selection:o,text:i,html:a}){const{doc:c}=e;if(o=o||c.selection,o=o&&C(o),!o)return;const[h,l]=o;let d;if(a)n!=null&&n.htmlParser?d=n.htmlParser(e,a):d=lt(e,a,{possiblePartial:!0});else{if(!i)return;d=new x().insert(i.replace(/\xA0/g," ").replace(/\r\n/g,`
`))}const f=d.filter(g=>typeof g.insert=="string"&&g.insert.includes(`
`)).length>0;let m=d.length();if(f){let g=ye.fromDelta(d,c.byId);d=ye.toDelta(g),m=d.length();const p=c.getLineAt(h),y=c.getLineAt(l),L=G(p),E=p===y?L:G(y);a||(g=g.map(M=>({...M,attributes:p.attributes})),L!==E&&(g[g.length-1].attributes=y.attributes));const F=g[0],w=G(F),N=g[g.length-1],v=F===N?w:G(N);h!==c.getLineRange(p)[0]&&!R(L,w,We)&&(d=new x().insert(`
`,L).concat(d),m++);const T=d.ops[d.ops.length-1].insert,_=typeof T=="string"&&T.endsWith(`
`);_&&l!==c.getLineRange(y)[1]&&R(E,v,We)?d=d.slice(0,--m):_&&l===c.getLineRange(y)[1]-1&&(d.delete(1),m--)}const u=new gn("paste",{delta:d,html:a,text:i,cancelable:!0});if(e.dispatchEvent(u),d=u.delta,!u.defaultPrevented)if(d&&d.ops.length){const g=e.change.delete(o,f?dn:void 0);g.insertContent(h,d).select(h+m),e.update(g,D.paste)}else h!==l&&e.delete([h,l])}function r(o){if(!e.enabled||!e.doc.selection||o.defaultPrevented)return;o.preventDefault();const i=o.clipboardData,{doc:a}=e;if(!i||!a.selection)return;const c=t?i.getData("text/html"):void 0,h=i.getData("text/plain");s({text:h,html:c})}return{commands:{paste:s},init(){e.root.addEventListener("paste",r)},destroy(){e.root.removeEventListener("paste",r)}}}function G(e){const{id:n,...t}=e.attributes;return t}const pn=yn();function yn(e={}){return function(n){let t=0,s="",r=!1,o=ze();const i={maxStack:500,delay:0,unrecordedSources:new Set,...e};function a(E){E.inputType==="historyUndo"?(E.preventDefault(),c()):E.inputType==="historyRedo"&&(E.preventDefault(),h())}function c(){u("undo","redo")}function h(){u("redo","undo")}function l(){return o.undo.length>0}function d(){return o.redo.length>0}function f(){t=0}function m(){o=ze()}function u(E,F){if(o[E].length===0)return;const w=o[E].pop();o[F].push(w),f(),r=!0,n.update(w[E],D.history),r=!1}function g(E,F){const w=Date.now(),N=En(E);o.redo.length=0;const v=new I(null,E.delta.invert(F.toDelta()),F.selection);if((!N||s!==N)&&f(),s=N,t&&(!i.delay||t+i.delay>w)&&o.undo.length){const T=o.undo[o.undo.length-1];T.redo.delta=T.redo.delta.compose(E.delta),T.redo.selection=E.selection,T.undo.delta=v.delta.compose(T.undo.delta)}else{const T=new I(null,E.delta,E.selection);t=w,o.undo.push({redo:T,undo:v})}o.undo.length>i.maxStack&&o.undo.shift()}function p({change:E,old:F,source:w}){if(!E)return m();if(!r){if(!E.contentChanged)return f();w!==D.api&&!i.unrecordedSources.has(w)?g(E,F):bn(o,E)}}function y(E){o=E}function L(){return o}return{options:i,hasUndo:l,hasRedo:d,undo:c,redo:h,cutoffHistory:f,clearHistory:m,setStack:y,getStack:L,getActive(){return{undo:l(),redo:d()}},commands:{undo:c,redo:h},shortcuts:{"win:Ctrl+Z":"undo","mac:Cmd+Z":"undo","win:Ctrl+Y":"redo","mac:Cmd+Shift+Z":"redo"},init(){n.on("change",p),n.root.addEventListener("beforeinput",a)},destroy(){n.off("change",p),n.root.removeEventListener("beforeinput",a)}}}}function ze(){return{undo:[],redo:[]}}function bn(e,n){const t=n.ops?new I(null,n):n;e.undo.forEach(s=>{s.undo=t.transform(s.undo,!0),s.redo=t.transform(s.redo,!0)}),e.redo.forEach(s=>{s.undo=t.transform(s.undo,!0),s.redo=t.transform(s.redo,!0)})}function En(e){var r;const{ops:n}=e.delta;let t=0,s=n.length-1;if(n[t].retain&&!n[t].attributes&&t++,n[s].retain===1&&((r=n[s].attributes)!=null&&r.id)&&s--,t===s){const o=n[t];if(o.delete)return"delete";if(o.insert===`
`)return"newline";if(typeof o.insert=="string")return"insert"}return""}const Ln={keyboard:Yt,input:an,copy:Fn,paste:mn,history:pn,decorations:St,rendering:zt,selection:hn},q={},gt=[],He=["focus","blur","keydown","mousedown","mouseup","click"],je=new WeakMap;class $ extends Event{constructor(t,s){super(t,s);b(this,"old");b(this,"doc");b(this,"change");b(this,"changedLines");b(this,"source");this.old=s.old,this.doc=s.doc,this.change=s.change,this.changedLines=s.changedLines,this.source=s.source,Object.setPrototypeOf(this,$.prototype)}modify(t){if(!this.cancelable)throw new Error('Cannot modify an applied change, listen to the "changing" event');this.doc=this.doc.apply(t),this.change&&(this.change.delta=this.change.delta.compose(t)),this.changedLines&&(this.changedLines=this.old.lines===this.doc.lines?gt:mt(this.old,this.doc))}}class qe extends Event{constructor(t,s){super(t,s);b(this,"formats");this.formats=s.formats}}class Sn extends Nt{constructor(t={}){super();b(this,"identifier");b(this,"typeset");b(this,"doc");b(this,"activeFormats",q);b(this,"commands",{});b(this,"shortcuts",{});b(this,"modules",{});b(this,"catchErrors");b(this,"throwOnError");b(this,"_root");b(this,"_modules");b(this,"_enabled");this.catchErrors=!t.dev,this.identifier=t.identifier,this.typeset=new te(t.types||jt),t.doc?this.doc=t.doc:t.html?this.doc=Re(this,t.html):t.text?this.doc=new P(new x().insert(t.text)):this.doc=new P,this.throwOnError=t.throwOnError||!1,this._enabled=t.enabled===void 0?!0:t.enabled;const s=t.includeDefaultModules??!0;this._modules=s?{...Ln,...t.modules}:{...t.modules},t.root&&this.setRoot(t.root)}get root(){return this._root||this.setRoot(document.createElement("div")),this._root}get enabled(){return this._enabled}set enabled(t){t=!!t;const s=this._enabled!==t;!t&&this.doc.selection&&this.select(null,D.api),this._enabled=t,this._root&&(this._root.contentEditable=t?"true":"inherit"),s&&this.dispatchEvent(new Event("enabledchange"))}get change(){const t=new I(this.doc);return t.apply=(s=D.user)=>this.update(t,s),t}setRoot(t){if(!t)throw new TypeError("Root must be set, cannot be "+t);return this.destroy(),this._root=t,this.init(),this.dispatchEvent(new Event("root")),this}update(t,s=D.user){if(!this.enabled&&s!==D.api)return this;const r=t.ops?new I(this.doc,t):t,o=this.doc,i=o.apply(r,void 0,this.throwOnError),a=o.lines===i.lines?gt:mt(o,i);return this.set(i,s,r,a),this}set(t,s=D.user,r,o){const i=this.doc,a=t.ops?new P(t):t;if(!this.enabled&&s!==D.api||!a||i.equals(a))return this;const c=new $("changing",{cancelable:!0,old:i,doc:a,change:r,changedLines:o,source:s});return this.dispatchEvent(c,this.catchErrors),c.defaultPrevented||i.equals(c.doc)?this:(this.activeFormats=r!=null&&r.activeFormats?r.activeFormats:Q(this,c.doc),this.doc=c.doc,this.dispatchEvent(new $("change",{...c,cancelable:!1}),this.catchErrors),this.dispatchEvent(new $("changed",{...c,cancelable:!1}),this.catchErrors),this)}getHTML(){return at(this,this.doc)}setHTML(t,s=this.doc.selection,r){return this.set(Re(this,t,s),r)}getDelta(){return this.doc.toDelta()}setDelta(t,s=this.doc.selection,r){return this.set(new P(t,s),r)}getText(t){return this.doc.getText(t)}setText(t,s=this.doc.selection,r){return this.set(new P(new x().insert(t),s),r)}trimSelection(t){if(!t)return t;const s=this.getText(t),[r,o]=C([...t]);if(s.trim()){const[i,a,c,h]=s.match(/(^ *)((?:.|\r|\n)*?)( *$)/);if(c&&(a||h))return[r+a.length,o-h.length]}return t}getActive(){const{selection:t}=this.doc;let s=t?t[0]===t[1]?{...this.activeFormats,...this.doc.getLineFormat(t)}:{...this.doc.getFormats(t)}:{};return Object.values(this.modules).forEach(r=>{r.getActive&&(s={...s,...r.getActive()})}),s}select(t,s){return this.update(this.change.select(t),s)}insert(t,s,r=this.doc.selection,o){if(!r)return this;const i=R(r,this.doc.selection);s==null&&typeof t=="string"&&t!==`
`&&(s=i?this.activeFormats:Q(this,this.doc,r));const a=this.typeset.lines.findByAttributes(s,!0),c=this.change.delete(r),h=C(r)[0];if(i&&c.setActiveFormats(t!==`
`&&s||Q(this,this.doc,r)),t===`
`&&a.frozen){const l={...this.doc.getLineFormat(h)},d={...s};let f={...l};const m=new x().insert(`
`,l);this.doc.getLineRange(h)[1]-1!==h?m.insert(`
`,d):f=d,c.insertContent(h,m).formatLine(h,f).select(h+2)}else c.insert(h,t,s,o);return this.update(c)}insertContent(t,s=this.doc.selection){if(!s)return this;const r=this.change.delete(s).insertContent(s[0],t);return this.update(r)}delete(t,s){let r,o=0;const{typeset:{lines:i},doc:a}=this;if(Array.isArray(t))r=C(t);else{if(!this.doc.selection)return this;r=C(this.doc.selection),t&&(r[0]===r[1]?t<0?r=[r[0]+t,r[1]]:r=[r[0],Math.min(r[1]+t,this.doc.length-1)]:t<0&&i.findByAttributes(a.getLineAt(r[0]).attributes,!0).frozen&&(o=-1))}const c=Q(this,this.doc,[r[0]+1,r[0]+1]),h=this.doc.length-(r[1]-r[0]);let l=Math.max(0,Math.min(h-1,r[0]+o));const d=this.change.delete(r,s).select(l).setActiveFormats(c);return this.update(d)}formatText(t,s=this.doc.selection){return s?(typeof t=="string"&&(t={[t]:!0}),s[0]===s[1]?(this.activeFormats=fe.compose(this.activeFormats,t)||q,this.dispatchEvent(new qe("format",{formats:this.activeFormats})),this):(j(this,"formatText",t,s),this)):this}toggleTextFormat(t,s=this.doc.selection){return s?(typeof t=="string"&&(t={[t]:!0}),s[0]===s[1]?(Lt(t,this.activeFormats)&&(t=fe.invert(t)),this.activeFormats=fe.compose(this.activeFormats,t)||q,this.dispatchEvent(new qe("format",{formats:this.activeFormats})),this):(j(this,"toggleTextFormat",t,s),this)):this}formatLine(t,s=this.doc.selection){return typeof t=="string"&&(t={[t]:!0}),j(this,"formatLine",t,s),this}toggleLineFormat(t,s=this.doc.selection){return typeof t=="string"&&(t={[t]:!0}),j(this,"toggleLineFormat",t,s),this}indent(){return Xe(this,1),this}outdent(){return Xe(this,-1),this}removeFormat(t=this.doc.selection){return j(this,"removeFormat",null,t),this}getBounds(t,s,r){var i;if(typeof t=="number"&&(t=[t,t]),!t)return;let o=(i=Be(this,t))==null?void 0:i.getBoundingClientRect();if(o&&s){const a=s.getBoundingClientRect(),c=(r?s.scrollLeft:0)-a.x,h=(r?s.scrollTop:0)-a.y;o=new DOMRect(o.x+c,o.y+h,o.width,o.height)}return o}getAllBounds(t,s,r){var a;typeof t=="number"&&(t=[t,t]);const o=(a=Be(this,t))==null?void 0:a.getClientRects();let i=o&&Array.from(o);if(i&&s){const c=s.getBoundingClientRect(),h=(r?s.scrollLeft:0)-c.x,l=(r?s.scrollTop:0)-c.y;i=i.map(d=>new DOMRect(d.x+h,d.y+l,d.width,d.height))}return i}getIndexFromPoint(t,s){return en(this,t,s)}render(){var t,s,r;return(t=this.modules.decorations)==null||t.gatherDecorations(),(s=this.modules.rendering)==null||s.render(),(r=this.modules.selection)==null||r.renderSelection(),this}init(){const t=this._root;t.editor&&t.editor.destroy(),t.editor=this,this.enabled=this._enabled,this.commands={},He.forEach(s=>this._root.addEventListener(s,Ye(this))),this.typeset.lines.list.forEach(s=>s.commands&&K(this,s.name,s.commands(this))),this.typeset.formats.list.forEach(s=>s.commands&&K(this,s.name,s.commands(this))),this.typeset.embeds.list.forEach(s=>s.commands&&K(this,s.name,s.commands(this))),Object.keys(this._modules).forEach(s=>{if(!this._modules[s])return;const r=this.modules[s]=this._modules[s](this);r.commands&&K(this,s,r.commands)}),this.shortcuts=Nn(this),Object.keys(this.modules).forEach(s=>{var r,o;return(o=(r=this.modules[s]).init)==null?void 0:o.call(r)}),this.render()}destroy(){const t=this._root;t&&(He.forEach(s=>t.removeEventListener(s,Ye(this))),Object.values(this.modules).forEach(s=>s.destroy&&s.destroy()),this._root=void 0,delete t.editor)}}function j(e,n,t,s){if(!s)return;if(s=typeof s=="number"?[s,s]:e==null?void 0:e.trimSelection(s),!(n in e.change))throw new Error("Invalid operation: "+n);const r=e.change[n](s,t);e.update(r)}function Q(e,n,t=n.selection){const{formats:s}=e.typeset;if(!t||t[0]===0)return q;const r=C(t)[0];let o=r,i=r+1;const a=n.getTextFormat(o),c=n.getTextFormat(i),h={};return Object.keys(a).forEach(l=>{const d=s.get(l);d&&d.greedy!==!1&&(h[l]=a[l])}),Object.keys(c).forEach(l=>{const d=s.get(l);d&&d.greedy===!1&&(h[l]=a[l])}),h}function mt(e,n){const t=new Set(e.lines);return n.lines.filter(s=>!t.has(s))}function K(e,n,t){t&&(typeof t=="function"?e.commands[n]=$e(e,t):Object.keys(t).forEach(s=>e.commands[s]=$e(e,t[s])))}function $e(e,n){return(...t)=>{const s=n(...t);return e.doc.selection&&e.root.focus(),s}}function Xe(e,n=1){const{typeset:{lines:t},doc:s}=e,{selection:r}=s;if(!r)return s;const o=e.change;s.getLinesAt(r).forEach(i=>{if(!t.findByAttributes(i.attributes,!0).indentable)return;const c=s.getLineRange(i);let h=(i.attributes.indent||0)+n;h===0&&(h=null),o.formatLine(c[0],h<0?q:{...i.attributes,indent:h})}),e.update(o)}function Ye(e){let n=je.get(e);return n||(n=wn.bind(e),je.set(e,n)),n}function wn(e){this.dispatchEvent(e)}function Nn(e){const n={},{typeset:{lines:t,formats:s,embeds:r},modules:o}=e;return pe(t,n),pe(s,n),pe(r,n),vn(o,n),n}function pe(e,n){e.list.forEach(t=>{const s=t.shortcuts;s&&(typeof s=="string"?n[s]=t.name:pt(s,n))})}function vn(e,n){Object.keys(e).forEach(t=>{var r;const s=(r=e[t])==null?void 0:r.shortcuts;s&&pt(s,n)})}function pt(e,n){Object.keys(e).forEach(t=>n[t]=e[t])}const An={copyPlainText:!0,copyHTML:!0},Ue={text:"",html:""};function Fn(e,n=An){function t(o){const{doc:i}=e,a=C(o||i.selection);if(!a)return Ue;const c=i.slice(a[0],a[1]);if(!c.ops.length)return Ue;const h=c.map(d=>typeof d.insert=="string"?d.insert:" ").join("");let l;return h.includes(`
`)?(c.push({insert:`
`,attributes:i.getLineFormat(a[1])}),l=at(e,new P(c))):l=Vt(e,c),{text:h,html:l}}function s(o){if(!e.enabled||!e.doc.selection||o.defaultPrevented)return;o.preventDefault();const i=o.clipboardData;if(!i)return;const{text:a,html:c}=t();n.copyHTML&&c&&i.setData("text/html",c),n.copyPlainText&&a&&i.setData("text/plain",a)}function r(o){s(o),e.delete()}return{commands:{getCopy:t},init(){e.root.addEventListener("copy",s),e.root.addEventListener("cut",r)},destroy(){e.root.removeEventListener("copy",s),e.root.removeEventListener("cut",r)}}}const Je=-1e5;new DOMRect(Je,Je,0,0);export{Sn as E,Y as f,A as h};
