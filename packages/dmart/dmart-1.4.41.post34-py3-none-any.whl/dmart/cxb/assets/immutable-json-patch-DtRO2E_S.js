function y(e){return Array.isArray(e)}function O(e){return e!==null&&typeof e=="object"&&(e.constructor===void 0||e.constructor.name==="Object")}function H(e){return e&&typeof e=="object"?e.op==="add":!1}function K(e){return e&&typeof e=="object"?e.op==="remove":!1}function L(e){return e&&typeof e=="object"?e.op==="replace":!1}function Q(e){return e&&typeof e=="object"?e.op==="copy":!1}function Y(e){return e&&typeof e=="object"?e.op==="move":!1}function x(e,r){return JSON.stringify(e)===JSON.stringify(r)}function k(e,r){return e===r}function P(e){return e.slice(0,e.length-1)}function T(e){return e[e.length-1]}function q(e,r){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:k;if(e.length<r.length)return!1;for(let t=0;t<r.length;t++)if(!n(e[t],r[t]))return!1;return!0}function E(e){return typeof e=="object"&&e!==null}function N(e){if(y(e)){const r=e.slice();return Object.getOwnPropertySymbols(e).forEach(n=>{r[n]=e[n]}),r}if(O(e)){const r={...e};return Object.getOwnPropertySymbols(e).forEach(n=>{r[n]=e[n]}),r}return e}function S(e,r,n){if(e[r]===n)return e;const t=N(e);return t[r]=n,t}function a(e,r){let n=e,t=0;for(;t<r.length;)O(n)?n=n[r[t]]:y(n)?n=n[Number.parseInt(r[t])]:n=void 0,t++;return n}function p(e,r,n){let t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(r.length===0)return n;const o=r[0],i=p(e?e[o]:void 0,r.slice(1),n,t);if(O(e)||y(e))return S(e,o,i);if(t){const f=D.test(o)?[]:{};return f[o]=i,f}throw new Error("Path does not exist")}const D=/^\d+$/;function v(e,r,n){if(r.length===0)return n(e);if(!E(e))throw new Error("Path doesn't exist");const t=r[0],o=v(e[t],r.slice(1),n);return S(e,t,o)}function m(e,r){if(r.length===0)return e;if(!E(e))throw new Error("Path does not exist");if(r.length===1){const o=r[0];if(!(o in e))return e;const i=N(e);return y(i)&&i.splice(Number.parseInt(o),1),O(i)&&delete i[o],i}const n=r[0],t=m(e[n],r.slice(1));return S(e,n,t)}function J(e,r,n){const t=r.slice(0,r.length-1),o=r[r.length-1];return v(e,t,i=>{if(!Array.isArray(i))throw new TypeError(`Array expected at path ${JSON.stringify(t)}`);const f=N(i);return f.splice(Number.parseInt(o),0,n),f})}function d(e,r){return e===void 0?!1:r.length===0?!0:e===null?!1:d(e[r[0]],r.slice(1))}function b(e){const r=e.split("/");return r.shift(),r.map(n=>n.replace(/~1/g,"/").replace(/~0/g,"~"))}function l(e){return e.map(A).join("")}function A(e){return`/${String(e).replace(/~/g,"~0").replace(/\//g,"~1")}`}function Z(e,r){return e+A(r)}function V(e,r,n){let t=e;for(let o=0;o<r.length;o++){X(r[o]);let i=r[o];if(n!=null&&n.before){const u=n.before(t,i);if(u!==void 0){if(u.document!==void 0&&(t=u.document),u.json!==void 0)throw new Error('Deprecation warning: returned object property ".json" has been renamed to ".document"');u.operation!==void 0&&(i=u.operation)}}const f=t,s=I(t,i.path);if(i.op==="add")t=G(t,s,i.value);else if(i.op==="remove")t=U(t,s);else if(i.op==="replace")t=C(t,s,i.value);else if(i.op==="copy")t=M(t,s,w(i.from));else if(i.op==="move")t=_(t,s,w(i.from));else if(i.op==="test")F(t,s,i.value);else throw new Error(`Unknown JSONPatch operation ${JSON.stringify(i)}`);if(n!=null&&n.after){const u=n.after(t,i,f);u!==void 0&&(t=u)}}return t}function C(e,r,n){return d(e,r)?p(e,r,n):e}function U(e,r){return m(e,r)}function G(e,r,n){return g(e,r)?J(e,r,n):p(e,r,n)}function M(e,r,n){const t=a(e,n);return g(e,r)?J(e,r,t):p(e,r,t)}function _(e,r,n){const t=a(e,n),o=m(e,n);return g(o,r)?J(o,r,t):p(o,r,t)}function F(e,r,n){if(n===void 0)throw new Error(`Test failed: no value provided (path: "${l(r)}")`);if(!d(e,r))throw new Error(`Test failed: path not found (path: "${l(r)}")`);const t=a(e,r);if(!x(t,n))throw new Error(`Test failed, value differs (path: "${l(r)}")`)}function g(e,r){if(r.length===0)return!1;const n=a(e,P(r));return Array.isArray(n)}function W(e,r){if(T(r)!=="-")return r;const n=P(r),t=a(e,n);return n.concat(t.length)}function X(e){if(!["add","remove","replace","copy","move","test"].includes(e.op))throw new Error(`Unknown JSONPatch op ${JSON.stringify(e.op)}`);if(typeof e.path!="string")throw new Error(`Required property "path" missing or not a string in operation ${JSON.stringify(e)}`);if((e.op==="copy"||e.op==="move")&&typeof e.from!="string")throw new Error(`Required property "from" missing or not a string in operation ${JSON.stringify(e)}`)}function I(e,r){return W(e,b(r))}function w(e){return b(e)}function ee(e,r,n){let t=[];return V(e,r,{before:(i,f)=>{let s;const u=I(i,f.path);if(f.op==="add")s=j(i,u);else if(f.op==="remove")s=R(i,u);else if(f.op==="replace")s=$(i,u);else if(f.op==="copy")s=z(i,u);else if(f.op==="move")s=B(i,u,w(f.from));else if(f.op==="test")s=[];else throw new Error(`Unknown JSONPatch operation ${JSON.stringify(f)}`);let h;if(n!=null&&n.before){const c=n.before(i,f,s);if(c!=null&&c.revertOperations&&(s=c.revertOperations),c!=null&&c.document&&(h=c.document),c!=null&&c.json)throw new Error('Deprecation warning: returned object property ".json" has been renamed to ".document"')}if(t=s.concat(t),h!==void 0)return{document:h}}}),t}function $(e,r){return d(e,r)?[{op:"replace",path:l(r),value:a(e,r)}]:[]}function R(e,r){return[{op:"add",path:l(r),value:a(e,r)}]}function j(e,r){return g(e,r)||!d(e,r)?[{op:"remove",path:l(r)}]:$(e,r)}function z(e,r){return j(e,r)}function B(e,r,n){if(r.length<n.length&&q(n,r))return[{op:"replace",path:l(r),value:e}];const t={op:"move",from:l(r),path:l(n)};return!g(e,r)&&d(e,r)?[t,...R(e,r)]:[t]}export{H as a,K as b,l as c,L as d,I as e,Q as f,a as g,Y as h,V as i,y as j,O as k,m as l,d as m,Z as n,b as p,ee as r,p as s,v as u};
