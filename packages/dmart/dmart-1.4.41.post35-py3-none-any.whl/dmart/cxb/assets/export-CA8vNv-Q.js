import{p as mt,a8 as d,a9 as B,A as vt,e as n,a7 as _t,c as t,B as $,h as D,aj as S,R as f,L as ft,a6 as h,k as i,E as u,F as m,f as ht,O as M,al as N,j as $t,l as bt,H as yt}from"./svelte-B2XmcTi_.js";import{b as xt}from"./svelte-i18n-CT2KkQaN.js";import{d as gt}from"./downloadFile-D08i0YDh.js";import{s as O,L as G}from"./toast-B9WDyfyI.js";import{D as q,Q as J,h as wt}from"./@edraj-CS4NwVbD.js";import{b as K}from"./dmart_services-BN8RAjGS.js";import{C as Pt,L as U,k as V,B as W}from"./flowbite-svelte-BLvjb-sa.js";import{P as St}from"./Prism--hMplq-p.js";import{c as X}from"./queryHelpers-C9iBWwqe.js";import"./clsx-B-dksMZM.js";import"./esm-env-rsSWfq8L.js";import"./deepmerge-rn4rBaHU.js";import"./ajv-Cpj98o6Y.js";import"./intl-messageformat-Dc5UU-HB.js";import"./tslib-pJfR_DrR.js";import"./@formatjs-yKEsAtjs.js";import"./@zerodevx-BlBZjKxu.js";import"./spaces-0oyGvpii.js";import"./@floating-ui-BwwcF-xh.js";import"./tailwind-variants-Cj20BoQ3.js";import"./tailwind-merge-CJvxXMcu.js";import"./prismjs-DTUiLGJu.js";var jt=$("<option> </option>"),kt=$("<option> </option>"),Lt=$("<option>/</option> <!>",1),Bt=$('<div class="space-y-4"><div class="grid grid-cols-1 md:grid-cols-12 gap-4 mb-4"><div class="md:col-span-4"><!> <!></div> <div class="md:col-span-4"><!> <!></div></div> <div class="md:col-span-4 mx-auto flex items-end justify-end"><!> <!></div></div>'),Dt=$('<p class="text-gray-500 text-center">No response yet.</p>'),qt=$('<div class="min-w-11/12 m-6"><!></div> <!>',1);function te(Y,Z){mt(Z,!0);const x=()=>ft(xt,"$_",tt),[tt,et]=yt();let z=d(B([])),o=d(""),v=d("/"),g=d(null),C=d(null),j=d(B([])),k=d(B([]));vt(()=>{async function e(){n(z,(await q.getSpaces()).records,!0)}e()});async function Q(e,l){for(const c of l.records)if(c.resource_type==="folder"){const w=await K(t(o),c.shortname);await Q(`${e}/${c.shortname}`,w),t(j).push(`${e}/${c.shortname}`)}}async function at(){if(!t(o)||!t(v))return;const e={type:J.search,exact_subpath:!1,...X({space_name:t(o),subpath:t(v),search:"",offset:0,limit:1e6,retrieve_json_payload:!0,retrieve_attachments:!0})};n(g,await q.query(e),!0)}async function st(){const e={type:J.search,exact_subpath:!1,...X({space_name:t(o),subpath:t(v),search:"",offset:0,limit:1e6,retrieve_json_payload:!0,retrieve_attachments:!0})};try{const l=await q.axiosDmartInstance.post("managed/export",e,{headers:wt,responseType:"arraybuffer"});l.status!==200?O(G.warn):gt(l.data,`${t(o)}/${t(v)}.zip`,"application/zip")}catch{O(G.warn)}}_t(()=>{t(o)&&t(C)!==t(o)&&(async()=>{n(k,[],!0),n(j,[],!0);const e=await K(t(o),"/");await Q("",e),n(k,[...t(j).reverse()],!0),n(C,`${t(o)}`)})()});var T=qt(),E=D(T),rt=u(E);Pt(rt,{class:"min-w-full p-4",children:(e,l)=>{var c=Bt(),w=u(c),F=u(w),R=u(F);U(R,{for:"space_name",class:"mb-2",children:(s,b)=>{var a=S();f(r=>h(a,r),[()=>x()("space_name")]),i(s,a)},$$slots:{default:!0}});var nt=m(R,2);V(nt,{id:"space_name",get value(){return t(o)},set value(s){n(o,s,!0)},children:(s,b)=>{var a=ht(),r=D(a);M(r,17,()=>t(z),N,(L,y)=>{var p=jt(),_=u(p),P={};f(()=>{h(_,t(y).shortname),P!==(P=t(y).shortname)&&(p.value=(p.__value=t(y).shortname)??"")}),i(L,p)}),i(s,a)},$$slots:{default:!0}});var pt=m(F,2),A=u(pt);U(A,{for:"subpath",class:"mb-2",children:(s,b)=>{var a=S();f(r=>h(a,r),[()=>x()("subpath")]),i(s,a)},$$slots:{default:!0}});var ut=m(A,2);V(ut,{id:"subpath",get value(){return t(v)},set value(s){n(v,s,!0)},children:(s,b)=>{var a=Lt(),r=D(a);r.value=r.__value="/";var L=m(r,2);M(L,17,()=>t(k),N,(y,p)=>{var _=kt(),P=u(_),I={};f(()=>{h(P,t(p)),I!==(I=t(p))&&(_.value=(_.__value=t(p))??"")}),i(y,_)}),i(s,a)},$$slots:{default:!0}});var ct=m(w,2),H=u(ct);W(H,{onclick:at,color:"blue",children:(s,b)=>{var a=S();f(r=>h(a,r),[()=>x()("submit")]),i(s,a)},$$slots:{default:!0}});var dt=m(H,2);W(dt,{class:"mx-5",color:"blue",outline:!0,onclick:st,children:(s,b)=>{var a=S();f(r=>h(a,r),[()=>x()("download_zip")]),i(s,a)},$$slots:{default:!0}}),i(e,c)},$$slots:{default:!0}});var ot=m(E,2);{var it=e=>{var l=Dt();i(e,l)},lt=e=>{St(e,{get code(){return t(g)},set code(l){n(g,l,!0)}})};$t(ot,e=>{t(g)===null?e(it):e(lt,!1)})}i(Y,T),bt(),et()}export{te as default};
