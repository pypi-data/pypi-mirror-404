import{p as Ke,b as kt,a9 as te,B as b,h as G,F as r,k as s,e as u,a8 as p,c as e,E as t,j as X,O as re,f as ge,al as ae,l as Ve,aj as h,A as wt,a7 as jt,R as $,L as Dt,a6 as g,H as Lt,ag as St}from"./svelte-B2XmcTi_.js";import{b as At}from"./svelte-i18n-CT2KkQaN.js";import{d as Ft}from"./downloadFile-D08i0YDh.js";import{s as It,L as Ot}from"./toast-B9WDyfyI.js";import{D as $e,Q as Ne,R as Rt}from"./@edraj-CS4NwVbD.js";import{b as Ue}from"./dmart_services-BN8RAjGS.js";import{k as se,B as oe,I as Q,L as x,C as Bt,u as Ge}from"./flowbite-svelte-BLvjb-sa.js";import{A as Qt,a0 as He,a1 as Tt,a2 as qt}from"./flowbite-svelte-icons-D8uFOOjS.js";import{P as zt}from"./Prism--hMplq-p.js";import{c as Ye,a as Je}from"./queryHelpers-C9iBWwqe.js";import"./clsx-B-dksMZM.js";import"./esm-env-rsSWfq8L.js";import"./deepmerge-rn4rBaHU.js";import"./ajv-Cpj98o6Y.js";import"./intl-messageformat-Dc5UU-HB.js";import"./tslib-pJfR_DrR.js";import"./@formatjs-yKEsAtjs.js";import"./@zerodevx-BlBZjKxu.js";import"./spaces-0oyGvpii.js";import"./@floating-ui-BwwcF-xh.js";import"./tailwind-variants-Cj20BoQ3.js";import"./tailwind-merge-CJvxXMcu.js";import"./prismjs-DTUiLGJu.js";var Ct=b("<option>Load</option> <option>Group By</option> <option>Reducers</option>",1),Et=b("<!> Add",1),Mt=b('<div class="grid grid-cols-3 gap-4 mb-2"><div><!></div> <div><!></div> <div><!></div></div>'),Nt=b('<div class="grid grid-cols-3 gap-4"><div><!></div> <div><!></div> <div class="flex items-center gap-2"><div class="flex-grow"><!></div> <!></div></div>'),Ut=b('<div class="flex items-center gap-2"><div class="flex-grow"><!></div> <!></div>'),Gt=b('<div class="space-y-4"><div class="flex items-center gap-2 mb-4"><div class="flex-grow"><!></div> <!></div> <!> <div class="space-y-4"></div></div>');function Ht(ce,le){Ke(le,!0);let i=kt(le,"aggregation_data",31,()=>te({})),S=p("load");function pe(d){d.preventDefault(),i()[e(S)].push(e(S)==="reducers"?{name:"",alias:"",args:""}:""),i({...i()})}function ve(d,f){d.preventDefault(),i()[e(S)].splice(f,1),i({...i()})}var Z=Gt(),P=t(Z),E=t(P),M=t(E);se(M,{class:"w-full",get value(){return e(S)},set value(d){u(S,d,!0)},children:(d,f)=>{var m=Ct(),k=G(m);k.value=k.__value="load";var A=r(k,2);A.value=A.__value="group_by";var T=r(A,2);T.value=T.__value="reducers",s(d,m)},$$slots:{default:!0}});var K=r(E,2);oe(K,{color:"blue",onclick:d=>pe(d),class:"flex-shrink-0",children:(d,f)=>{var m=Et(),k=G(m);Qt(k,{class:"mr-1"}),s(d,m)},$$slots:{default:!0}});var H=r(P,2);{var V=d=>{var f=Mt(),m=t(f),k=t(m);x(k,{for:"name",class:"mb-2",children:(w,F)=>{var D=h("Name");s(w,D)},$$slots:{default:!0}});var A=r(m,2),T=t(A);x(T,{for:"alias",class:"mb-2",children:(w,F)=>{var D=h("Alias");s(w,D)},$$slots:{default:!0}});var N=r(A,2),j=t(N);x(j,{for:"args",class:"mb-2",children:(w,F)=>{var D=h("Args");s(w,D)},$$slots:{default:!0}}),s(d,f)};X(H,d=>{e(S)==="reducers"&&d(V)})}var W=r(H,2);re(W,21,()=>i()[e(S)],ae,(d,f,m)=>{var k=ge(),A=G(k);{var T=j=>{var w=Nt(),F=t(w),D=t(F);Q(D,{type:"text",get value(){return e(f).name},set value(I){e(f).name=I}});var Y=r(F,2),q=t(Y);Q(q,{type:"text",get value(){return e(f).alias},set value(I){e(f).alias=I}});var ie=r(Y,2),ee=t(ie),de=t(ee);Q(de,{type:"text",get value(){return e(f).args},set value(I){e(f).args=I}});var fe=r(ee,2);oe(fe,{color:"red",size:"sm",onclick:I=>ve(I,m),class:"flex-shrink-0",children:(I,he)=>{He(I,{})},$$slots:{default:!0}}),s(j,w)},N=j=>{var w=Ut(),F=t(w),D=t(F);Q(D,{type:"text",get value(){return i()[e(S)][m]},set value(q){i(i()[e(S)][m]=q,!0)}});var Y=r(F,2);oe(Y,{color:"red",size:"sm",onclick:q=>ve(q,m),class:"flex-shrink-0",children:(q,ie)=>{He(q,{})},$$slots:{default:!0}}),s(j,w)};X(A,j=>{e(S)==="reducers"?j(T):j(N,!1)})}s(d,k)}),s(ce,Z),Ve()}var Yt=b("<option> </option>"),Jt=b("<option> </option>"),Kt=b("<option> </option>"),Vt=b("<option>/</option> <!>",1),Wt=b("<option> </option>"),Xt=b("<option></option> <!>",1),Zt=b('<div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mb-4"><div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"><div><!> <!></div> <div><!> <!></div> <div><!> <!></div></div> <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"><div><!> <!></div> <div><!> <!></div> <div class="flex items-end"><div class="flex items-center gap-2"><!> <!></div></div></div> <div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><!> <!></div> <div><!> <!></div> <div class="flex items-end"><div class="flex items-center gap-2"><!> <!></div></div></div></div>'),er=b('<div class="mb-4"><!></div>'),tr=b('<div class="space-y-4"><div class="grid grid-cols-1 md:grid-cols-12 gap-4 mb-4"><div class="md:col-span-1 flex items-center justify-center"><button type="button" class="text-blue-600 hover:text-blue-800 cursor-pointer" aria-label="Toggle filter options"><!></button></div> <div class="md:col-span-3"><!> <!></div> <div class="md:col-span-4"><!> <!></div> <div class="md:col-span-4"><!> <!></div></div> <!> <!> <div class="flex justify-between"><!> <!></div></div>'),rr=b('<p class="text-gray-500 text-center">No response yet.</p>'),ar=b('<div class="min-w-11/12 m-6"><!></div> <!>',1);function Dr(ce,le){Ke(le,!0);const i=()=>Dt(At,"$_",S),[S,pe]=Lt(),ve=10;let Z=p(te([])),P=p(""),E=p(null),M=p("/"),K=p(null),H=p(""),V=p(""),W=p(""),d=p(""),f=p(0),m=p(ve),k=p(!1),A=p(!1),T=p(te({load:[],group_by:[],reducers:[]})),N=p(null),j=p(!1),w=p(null),F=p(te([])),D=p(te([]));wt(()=>{async function _(){u(Z,(await $e.getSpaces()).records,!0)}_()});async function Y(_,O){for(const J of O.records)if(J.resource_type==="folder"){const ne=await Ue(e(P),J.shortname);await Y(`${_}/${J.shortname}`,ne),e(F).push(`${_}/${J.shortname}`)}}async function q(){if(!e(P)||!e(M)||!e(E))return;const _={type:e(E),exact_subpath:!0,...Ye({space_name:e(P),subpath:e(M),resource_type:e(K),resource_shortnames:e(H),search:e(V),offset:e(f),limit:e(m),retrieve_attachments:e(k),retrieve_json_payload:e(A)})};Je(_,e(W),e(d)),u(N,await $e.query(_),!0)}async function ie(){const _={type:"search",...Ye({space_name:e(P),subpath:e(M),resource_type:e(K),resource_shortnames:e(H),search:e(V),offset:e(f),limit:e(m),retrieve_json_payload:!0})};Je(_,e(W),e(d));const O=await $e.csv(_);(O==null?void 0:O.status)==="failed"?It(Ot.warn):Ft(O,`${e(P)}/${e(M)}.csv`,"text/csv")}jt(()=>{e(P)&&e(w)!==e(P)&&(async()=>{u(D,[],!0),u(F,[],!0);const _=await Ue(e(P),"/");await Y("",_),u(D,[...e(F).reverse()],!0),u(w,`${e(P)}`)})()});var ee=ar(),de=G(ee),fe=t(de);Bt(fe,{class:"min-w-full p-4",children:(_,O)=>{var J=tr(),ne=t(J),be=t(ne),ye=t(be);ye.__click=()=>u(j,!e(j));var Xe=t(ye);{var Ze=o=>{Tt(o,{size:"xl"})},et=o=>{qt(o,{size:"xl"})};X(Xe,o=>{e(j)?o(Ze):o(et,!1)})}var xe=r(be,2),Pe=t(xe);x(Pe,{for:"type",class:"mb-2",children:(o,L)=>{var v=h();$(n=>g(v,n),[()=>i()("query_type")]),s(o,v)},$$slots:{default:!0}});var tt=r(Pe,2);se(tt,{id:"type",required:!0,get value(){return e(E)},set value(o){u(E,o,!0)},children:(o,L)=>{var v=ge(),n=G(v);re(n,17,()=>Object.keys(Ne),ae,(U,R)=>{var y=Yt(),B=t(y),z={};$(()=>{g(B,e(R)),z!==(z=e(R))&&(y.value=(y.__value=e(R))??"")}),s(U,y)}),s(o,v)},$$slots:{default:!0}});var ke=r(xe,2),we=t(ke);x(we,{for:"space_name",class:"mb-2",children:(o,L)=>{var v=h();$(n=>g(v,n),[()=>i()("space_name")]),s(o,v)},$$slots:{default:!0}});var rt=r(we,2);se(rt,{id:"space_name",get value(){return e(P)},set value(o){u(P,o,!0)},children:(o,L)=>{var v=ge(),n=G(v);re(n,17,()=>e(Z),ae,(U,R)=>{var y=Jt(),B=t(y),z={};$(()=>{g(B,e(R).shortname),z!==(z=e(R).shortname)&&(y.value=(y.__value=e(R).shortname)??"")}),s(U,y)}),s(o,v)},$$slots:{default:!0}});var at=r(ke,2),je=t(at);x(je,{for:"subpath",class:"mb-2",children:(o,L)=>{var v=h();$(n=>g(v,n),[()=>i()("subpath")]),s(o,v)},$$slots:{default:!0}});var st=r(je,2);se(st,{id:"subpath",get value(){return e(M)},set value(o){u(M,o,!0)},children:(o,L)=>{var v=Vt(),n=G(v);n.value=n.__value="/";var U=r(n,2);re(U,17,()=>e(D),ae,(R,y)=>{var B=Kt(),z=t(B),ue={};$(()=>{g(z,e(y)),ue!==(ue=e(y))&&(B.value=(B.__value=e(y))??"")}),s(R,B)}),s(o,v)},$$slots:{default:!0}});var De=r(ne,2);{var ot=o=>{var L=Zt(),v=t(L),n=t(v),U=t(n);x(U,{for:"resource_type",class:"mb-2",children:(a,C)=>{var l=h();$(c=>g(l,c),[()=>i()("resource_types")]),s(a,l)},$$slots:{default:!0}});var R=r(U,2);se(R,{id:"resource_type",get value(){return e(K)},set value(a){u(K,a,!0)},children:(a,C)=>{var l=Xt(),c=G(l);c.value=(c.__value=null)??"";var yt=r(c,2);re(yt,17,()=>Object.keys(Rt),ae,(xt,me)=>{var _e=Wt(),Pt=t(_e),Me={};$(()=>{g(Pt,e(me)),Me!==(Me=e(me))&&(_e.value=(_e.__value=e(me))??"")}),s(xt,_e)}),s(a,l)},$$slots:{default:!0}});var y=r(n,2),B=t(y);x(B,{for:"search",class:"mb-2",children:(a,C)=>{var l=h();$(c=>g(l,c),[()=>i()("search")]),s(a,l)},$$slots:{default:!0}});var z=r(B,2);Q(z,{id:"search",type:"text",get value(){return e(V)},set value(a){u(V,a,!0)}});var ue=r(y,2),Ae=t(ue);x(Ae,{for:"resource_shortnames",class:"mb-2",children:(a,C)=>{var l=h();$(c=>g(l,c),[()=>i()("shortnames")]),s(a,l)},$$slots:{default:!0}});var dt=r(Ae,2);Q(dt,{id:"resource_shortnames",type:"text",get value(){return e(H)},set value(a){u(H,a,!0)}});var Fe=r(v,2),Ie=t(Fe),Oe=t(Ie);x(Oe,{for:"from_date",class:"mb-2",children:(a,C)=>{var l=h();$(c=>g(l,c),[()=>i()("from")]),s(a,l)},$$slots:{default:!0}});var nt=r(Oe,2);Q(nt,{id:"from_date",type:"date",get value(){return e(W)},set value(a){u(W,a,!0)}});var Re=r(Ie,2),Be=t(Re);x(Be,{for:"to_date",class:"mb-2",children:(a,C)=>{var l=h();$(c=>g(l,c),[()=>i()("to")]),s(a,l)},$$slots:{default:!0}});var ut=r(Be,2);Q(ut,{id:"to_date",type:"date",get value(){return e(d)},set value(a){u(d,a,!0)}});var _t=r(Re,2),ct=t(_t),Qe=t(ct);Ge(Qe,{id:"retrieve_attachments",get checked(){return e(k)},set checked(a){u(k,a,!0)}});var pt=r(Qe,2);x(pt,{for:"retrieve_attachments",class:"mb-0",children:(a,C)=>{var l=h();$(c=>g(l,c),[()=>i()("retrieve_attachments")]),s(a,l)},$$slots:{default:!0}});var ft=r(Fe,2),Te=t(ft),qe=t(Te);x(qe,{for:"limit",class:"mb-2",children:(a,C)=>{var l=h();$(c=>g(l,c),[()=>i()("limit")]),s(a,l)},$$slots:{default:!0}});var mt=r(qe,2);Q(mt,{id:"limit",type:"number",get value(){return e(m)},set value(a){u(m,a,!0)}});var ze=r(Te,2),Ce=t(ze);x(Ce,{for:"offset",class:"mb-2",children:(a,C)=>{var l=h();$(c=>g(l,c),[()=>i()("offset")]),s(a,l)},$$slots:{default:!0}});var $t=r(Ce,2);Q($t,{id:"offset",type:"number",get value(){return e(f)},set value(a){u(f,a,!0)}});var gt=r(ze,2),ht=t(gt),Ee=t(ht);Ge(Ee,{id:"retrieve_json_payload",get checked(){return e(A)},set checked(a){u(A,a,!0)}});var bt=r(Ee,2);x(bt,{for:"retrieve_json_payload",class:"mb-0",children:(a,C)=>{var l=h();$(c=>g(l,c),[()=>i()("retrieve_json_payload")]),s(a,l)},$$slots:{default:!0}}),s(o,L)};X(De,o=>{e(j)&&o(ot)})}var Le=r(De,2);{var lt=o=>{var L=er(),v=t(L);Ht(v,{get aggregation_data(){return e(T)},set aggregation_data(n){u(T,n,!0)}}),s(o,L)};X(Le,o=>{e(E)===Ne.aggregation&&o(lt)})}var vt=r(Le,2),Se=t(vt);oe(Se,{onclick:q,color:"blue",children:(o,L)=>{var v=h();$(n=>g(v,n),[()=>i()("submit")]),s(o,v)},$$slots:{default:!0}});var it=r(Se,2);oe(it,{color:"blue",outline:!0,onclick:ie,children:(o,L)=>{var v=h();$(n=>g(v,n),[()=>i()("download_csv")]),s(o,v)},$$slots:{default:!0}}),s(_,J)},$$slots:{default:!0}});var I=r(de,2);{var he=_=>{var O=rr();s(_,O)},We=_=>{zt(_,{get code(){return e(N)},set code(O){u(N,O,!0)}})};X(I,_=>{e(N)===null?_(he):_(We,!1)})}s(ce,ee),Ve(),pe()}St(["click"]);export{Dr as default};
