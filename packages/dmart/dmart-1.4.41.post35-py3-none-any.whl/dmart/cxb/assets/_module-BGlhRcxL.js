import{p as Ee,b as Re,a7 as ke,L as ae,y as te,B as f,h as P,c as e,a2 as G,F as u,j as N,k as n,l as ze,H as Fe,E as v,N as Oe,f as ce,O as Me,a8 as M,a9 as fe,aI as Ce,aJ as we,e as o,aj as V,R as Ie,a6 as Te,q as Be}from"./svelte-B2XmcTi_.js";import{d as Ne,e as Je,f as Ae,M as le,B as X,S as _e}from"./flowbite-svelte-BLvjb-sa.js";import{J as Pe,M as We}from"./svelte-jsoneditor-CUGSvWId.js";import{P as he}from"./Prism--hMplq-p.js";import{R as de,D as ge,a as $e}from"./@edraj-CS4NwVbD.js";import{s as ye,L as xe}from"./toast-B9WDyfyI.js";import{b as Ge,a as be}from"./dmart_services-BN8RAjGS.js";import{M as Ke,r as He,j as Qe}from"./compare-C3AjiGFR.js";import{a as Ue,p as Ve}from"./@roxi-CGMFK4i8.js";import{s as ue}from"./global-igKv-1g9.js";import{c as Xe,d as Ye,e as Ze,f as et}from"./flowbite-svelte-icons-D8uFOOjS.js";import{s as tt}from"./spaces-0oyGvpii.js";import"./clsx-B-dksMZM.js";import"./esm-env-rsSWfq8L.js";import"./@floating-ui-BwwcF-xh.js";import"./tailwind-variants-Cj20BoQ3.js";import"./tailwind-merge-CJvxXMcu.js";import"./json-source-map-DRgZidqy.js";import"./ajv-Cpj98o6Y.js";import"./immutable-json-patch-DtRO2E_S.js";import"./jsonrepair-B30Dx381.js";import"./lodash-es-DZVAA2ox.js";import"./@jsonquerylang-laKNoFFq.js";import"./@fortawesome-DRW1UCdr.js";import"./svelte-awesome-DhnMA6Q_.js";import"./svelte-select-CjHAt_85.js";import"./svelte-floating-ui-BlS3sOAQ.js";import"./natural-compare-lite-Bg2Xcf-o.js";import"./memoize-one-BdPwpGay.js";import"./@lezer-za4Q-8Ew.js";import"./@codemirror-Rn7_6DkE.js";import"./crelt-C8TCjufn.js";import"./@marijn-DXwl3gUT.js";import"./style-mod-Bs6eFhZE.js";import"./w3c-keyname-Vcq4gwWv.js";import"./@replit--ERk53eB.js";import"./codemirror-wrapped-line-indent-DPhKvljI.js";import"./prismjs-DTUiLGJu.js";import"./@zerodevx-BlBZjKxu.js";import"./hookar-BMRD9G9H.js";import"./consolite-DlCuI0F9.js";var at=f('<div class="flex items-center gap-2"><button class="p-1  rounded"><!></button> <div><!></div></div>'),rt=f("<!> <!>",1);function De(Y,a){Ee(a,!0);const p=()=>ae(Ue,"$activeRoute",O),C=()=>ae(ue,"$spaceChildren",O),[O,I]=Fe();let K=Re(a,"depth",3,0);ke(()=>{`/-${p().params.subpath}`==`${a.parentPath}-${a.item.shortname}`&&te(()=>{a.toggleExpanded(a.spaceName,_(),!0)})});function _(){let r=`${a.parentPath}-${a.item.shortname}`.replace("/","-").replace("--","-");return r.startsWith("-")&&(r=r.substring(1)),r.endsWith("-")&&(r=r.substring(0,r.length-1)),`/${r}`}async function T(){await a.toggleExpanded(a.spaceName,_())}function re(){return a.isExpanded(a.spaceName,_())}function H(r){const E=h=>{h.preventDefault(),h.stopPropagation(),T()};return r.addEventListener("click",E),{destroy(){r.removeEventListener("click",E)}}}function ve(){return`/${p().params.subpath}`===_()}a.loadChildren(a.spaceName,_());var se={preventAndHandleToggleExpanded:H},B=rt(),J=P(B);{const r=q=>{var j=at(),U=v(j),me=v(U);{var pe=k=>{Ye(k,{size:"sm"})},oe=k=>{Ze(k,{size:"sm"})};N(me,k=>{re()?k(pe):k(oe,!1)})}Oe(U,k=>H==null?void 0:H(k));var ne=u(U,2),ie=v(ne);Xe(ie,{size:"md",class:"text-gray-500",style:"transform: rotate(180deg); position: relative; z-index: 5;"}),n(q,j)};let E=G(()=>{var q,j;return((j=(q=a.item.attributes)==null?void 0:q.displayname)==null?void 0:j.en)||a.item.shortname}),h=G(()=>`/management/content/${a.spaceName}${_()}`),D=G(()=>ve()?"bg-gray-300 text-white":""),Z=G(()=>K()*20);Ne(J,{get label(){return e(E)},get href(){return e(h)},get class(){return`flex-1 whitespace-nowrap ${e(D)??""}`},get style(){return`margin-left: ${e(Z)??""}px;`},icon:r,$$slots:{icon:!0}})}var Q=u(J,2);{var x=r=>{var E=ce(),h=P(E);Me(h,1,()=>C().data.get(`${a.spaceName}:${_()}`),D=>D.shortname,(D,Z)=>{{let q=G(_),j=G(()=>K()+1);De(D,{get spaceName(){return a.spaceName},get parentPath(){return e(q)},get item(){return e(Z)},get depth(){return e(j)},get expandedSpaces(){return a.expandedSpaces},get loadChildren(){return a.loadChildren},get toggleExpanded(){return a.toggleExpanded},get isExpanded(){return a.isExpanded},get getChildrenForSpace(){return a.getChildrenForSpace}})}}),n(r,E)};N(Q,r=>{re()&&r(x)})}n(Y,B);var S=ze(se);return I(),S}var st=f('<div class="flex items-center gap-2"><!></div>'),ot=f("<!> <!>",1),nt=f('<div class="mt-4"><p class="text-red-600 font-medium mb-2">Error:</p> <div class="max-h-60 overflow-auto"><!></div></div>'),it=f("<!> Creating ...",1),lt=f('<div class="space-y-4"><!> <!></div> <div class="flex justify-between w-full mt-4"><!> <!></div>',1),dt=f("<div><!></div>"),ct=f('<div class="mt-4"><p class="text-red-600 font-medium mb-2">Error:</p> <div class="max-h-60 overflow-auto"><!></div></div>'),ut=f("<!> Saving Changes ...",1),vt=f('<div><!> <!></div> <div class="flex justify-between w-full"><!> <!></div>',1),mt=f('<p class="text-center mb-6">Are you sure you want to delete the space <span class="font-bold"> </span>?<br/> This action cannot be undone.</p>'),pt=f('<div class="mt-4"><p class="text-red-600 font-medium mb-2">Error:</p> <div class="max-h-60 overflow-auto"><!></div></div>'),ft=f("<!> Deleting ...",1),_t=f('<!> <!> <div class="flex justify-between w-full"><!> <!></div>',1),ht=f("<!> <!> <!> <!> <!>",1);function gt(Y,a){Ee(a,!0);const p=()=>ae(ue,"$spaceChildren",I),C=()=>ae(Ve,"$params",I),O=()=>ae(tt,"$spaces",I),[I,K]=Fe();let _=M(fe(new Set));Ce(ue,te(p).refresh=T,te(p));async function T(t,m="/",c=!1){const l=`${t}:${m}`;if(c||!p().data.has(l))try{const g=await Ge(t,m,50,0,[de.folder]);p().data.set(l,g.records||[])}catch(g){console.error(`Failed to load children for ${t}${m}:`,g),p().data.set(l,[])}return Ce(ue,te(p).data=we(p().data),te(p)),p().data.get(l)||[]}async function re(t,m="/",c=null){const l=`${t}:${m}`;if(e(_).has(l)){if(c===!0)return;e(_).delete(l)}else{if(c===!1)return;e(_).add(l),await T(t,m)}o(_,we(e(_)),!0)}function H(t,m="/"){return e(_).has(`${t}:${m}`)}function ve(t,m="/"){return p().data.get(`${t}:${m}`)||[]}let se=M(!1),B=M(!1),J=M(!1),Q=M(!1),x=M(null),S=M(null),r=M(fe({shortname:"",is_active:!0,slug:"",displayname:{en:"",ar:"",ku:""},description:{en:"",ar:"",ku:""}})),E=M(()=>!0),h=M(!1),D={json:void 0};async function Z(){if(e(E)()&&e(r).shortname.trim())try{o(h,!0),o(S,null);const t={is_active:e(r).is_active,slug:e(r).slug,displayname:e(r).displayname,description:e(r).description};await ge.request({space_name:e(r).shortname.trim(),request_type:$e.create,records:[{resource_type:de.space,shortname:e(r).shortname.trim(),subpath:"/",attributes:He(t)}]}),ye(xe.info,`Space "${e(r).shortname.trim()}" created successfully!`),await be(),o(Q,!1)}catch(t){o(S,t.response.data,!0)}finally{o(h,!1)}}async function q(){if(e(x)){const t=Qe(D);delete t.uuid;try{o(h,!0),o(S,null),await ge.request({space_name:e(x).shortname,request_type:$e.update,records:[{resource_type:de.space,shortname:e(x).shortname,subpath:"/",attributes:t.attributes}]}),o(B,!1),ye(xe.info,`Space "${e(x).shortname}" updated successfully!`),await be()}catch(m){o(S,m,!0)}finally{o(h,!1)}}}async function j(){if(e(x))try{o(h,!0),o(S,null),await ge.request({space_name:e(x).shortname,request_type:$e.delete,records:[{resource_type:de.space,shortname:e(x).shortname,subpath:"/",attributes:{}}]}),ye(xe.info,`Space "${e(x).shortname}" has been deleted successfully!`),o(J,!1),o(x,null),await be()}catch(t){o(S,t,!0)}finally{o(h,!1)}}let U=M(fe(C().space_name));async function me(){var m,c;const t=O().filter(l=>l.shortname===C().space_name);o(U,t.length===1&&((c=(m=t[0].attributes)==null?void 0:m.displayname)==null?void 0:c.en)||C().space_name,!0)}ke(()=>{O()&&me()}),T(C().space_name);var pe={loadChildren:T},oe=ht(),ne=P(oe);Je(ne,{position:"static",class:"h-full",children:(t,m)=>{Ae(t,{children:(c,l)=>{var g=ot(),w=P(g);{const z=L=>{var s=st(),i=v(s);et(i,{size:"md",class:"text-gray-500",style:"transform: rotate(180deg); position: relative; z-index: 5;"}),n(L,s)};let F=G(()=>"/management/content/"+C().space_name);Ne(w,{get label(){return e(U)},get href(){return e(F)},icon:z,$$slots:{icon:!0}})}var A=u(w,2);Me(A,1,()=>p().data.get(`${C().space_name}:/`),z=>z.shortname,(z,F)=>{De(z,{get spaceName(){return C().space_name},parentPath:"/",get item(){return e(F)},depth:1,get expandedSpaces(){return e(_)},loadChildren:T,toggleExpanded:re,isExpanded:H,getChildrenForSpace:ve})}),n(c,g)},$$slots:{default:!0}})},$$slots:{default:!0}});var ie=u(ne,2);le(ie,{size:"xl",title:"Add New Space",get open(){return e(Q)},set open(t){o(Q,t,!0)},children:(t,m)=>{var c=lt(),l=P(c),g=v(l);Ke(g,{isCreate:!0,get formData(){return e(r)},set formData(s){o(r,s,!0)},get validateFn(){return e(E)},set validateFn(s){o(E,s,!0)}});var w=u(g,2);{var A=s=>{var i=nt(),d=u(v(i),2),$=v(d);he($,{get code(){return e(S)}}),n(s,i)};N(w,s=>{e(S)&&s(A)})}var z=u(l,2),F=v(z);X(F,{color:"alternative",onclick:()=>o(Q,!1),children:(s,i)=>{var d=V("Cancel");n(s,d)},$$slots:{default:!0}});var L=u(F,2);X(L,{class:"bg-primary",onclick:Z,children:(s,i)=>{var d=ce(),$=P(d);{var W=b=>{var y=it(),R=P(y);_e(R,{class:"me-3",size:"4",color:"blue"}),n(b,y)},ee=b=>{var y=V("Create");n(b,y)};N($,b=>{e(h)?b(W):b(ee,!1)})}n(s,d)},$$slots:{default:!0}}),n(t,c)},$$slots:{default:!0}});var k=u(ie,2);le(k,{size:"xl",title:"Space Metadata",autoclose:!0,get open(){return e(se)},set open(t){o(se,t,!0)},children:(t,m)=>{var c=dt(),l=v(c);{var g=w=>{Pe(w,{get content(){return D},readOnly:!0})};N(l,w=>{e(x)&&w(g)})}n(t,c)},$$slots:{default:!0}});var Se=u(k,2);le(Se,{size:"xl",title:"Edit Space",get open(){return e(B)},set open(t){o(B,t,!0)},children:(t,m)=>{var c=vt(),l=P(c),g=v(l);{var w=i=>{Pe(i,{readOnly:!1,get mode(){return We.text},get content(){return D},set content(d){D=d}})};N(g,i=>{e(x)&&i(w)})}var A=u(g,2);{var z=i=>{var d=ct(),$=u(v(d),2),W=v($);he(W,{get code(){return e(S)}}),n(i,d)};N(A,i=>{e(S)&&i(z)})}var F=u(l,2),L=v(F);X(L,{color:"alternative",onclick:()=>o(B,!1),children:(i,d)=>{var $=V("Cancel");n(i,$)},$$slots:{default:!0}});var s=u(L,2);X(s,{class:"bg-primary",onclick:q,children:(i,d)=>{var $=ce(),W=P($);{var ee=y=>{var R=ut(),Le=P(R);_e(Le,{class:"me-3",size:"4",color:"blue"}),n(y,R)},b=y=>{var R=V("Save Changes");n(y,R)};N(W,y=>{e(h)?y(ee):y(b,!1)})}n(i,$)},$$slots:{default:!0}}),n(t,c)},$$slots:{default:!0}});var je=u(Se,2);le(je,{size:"md",title:"Confirm Deletion",get open(){return e(J)},set open(t){o(J,t,!0)},children:(t,m)=>{var c=_t(),l=P(c);{var g=s=>{var i=mt(),d=u(v(i)),$=v(d);Ie(()=>Te($,e(x).shortname)),n(s,i)};N(l,s=>{e(x)&&s(g)})}var w=u(l,2);{var A=s=>{var i=pt(),d=u(v(i),2),$=v(d);he($,{get code(){return e(S)}}),n(s,i)};N(w,s=>{e(S)&&s(A)})}var z=u(w,2),F=v(z);X(F,{color:"alternative",onclick:()=>o(J,!1),children:(s,i)=>{var d=V("Cancel");n(s,d)},$$slots:{default:!0}});var L=u(F,2);X(L,{color:"red",onclick:j,children:(s,i)=>{var d=ce(),$=P(d);{var W=b=>{var y=ft(),R=P(y);_e(R,{class:"me-3",size:"4",color:"blue"}),n(b,y)},ee=b=>{var y=V("Delete");n(b,y)};N($,b=>{e(h)?b(W):b(ee,!1)})}n(s,d)},$$slots:{default:!0}}),n(t,c)},$$slots:{default:!0}}),n(Y,oe);var qe=ze(pe);return K(),qe}var $t=f('<div class="flex h-full"><div class="w-64 border-r border-gray-200"><!></div> <div class="flex-1 overflow-auto"><!></div></div>');function ia(Y,a){var p=$t(),C=v(p),O=v(C);gt(O,{});var I=u(C,2),K=v(I);Be(K,a,"default",{},null),n(Y,p)}export{ia as default};
