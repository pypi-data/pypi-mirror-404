import{d as F}from"./fast-diff-C-IidNf4.js";function P(h){if(!h)return h;if(typeof h.toJSON=="function"&&(h=h.toJSON()),Array.isArray(h))return h.map(P);if(typeof h=="object"){const t={};return Object.keys(h).forEach(e=>t[e]=P(h[e])),t}return h}const K={};function b(h,t,e=K){if(h===t)return!0;const i=typeof h,n=typeof h;if(i==="number"&&n==="number"&&isNaN(h)&&isNaN(t))return!0;if(!h||!t||i!=="object"||n!=="object"||h.constructor!==t.constructor)return!1;if(h.valueOf()!==h)return b(h.valueOf(),t.valueOf(),e);const s=e.shallow?U:b;if(typeof h[Symbol.iterator]=="function"){const c=h[Symbol.iterator](),o=t[Symbol.iterator]();let u=c.next(),g=o.next();for(;!u.done&&!g.done;){if(!s(u.value,g.value,e))return!1;u=c.next(),g=o.next()}return u.done===g.done}let r=Object.keys(h),f=Object.keys(t);if(e.excludeProps){const c=G(e.excludeProps);r=r.filter(c),f=f.filter(c)}return(e.partial||r.length===f.length)&&f.every(c=>h.hasOwnProperty(c)&&s(t[c],h[c],e))}function U(h,t){return h===t}function G(h){return t=>!h.has(t)}function w(h){return h===Object(h)&&!Array.isArray(h)}function z(h){if(h==null)return!0;if(!w(h))return!1;for(const t in h)if(!z(h[t]))return!1;return!0}var S;(function(h){function t(s={},r={},f){typeof s!="object"&&(s={}),typeof r!="object"&&(r={});let c=P(r);for(const o in s)w(s[o])&&w(c[o])&&(c[o]=t(s[o],c[o],f));f||(c=Object.keys(c).reduce((o,u)=>(z(c[u])||(o[u]=c[u]),o),{}));for(const o in s)s[o]!==void 0&&r[o]===void 0&&(c[o]=s[o]);return Object.keys(c).length>0?c:void 0}h.compose=t;function e(s={},r={}){typeof s!="object"&&(s={}),typeof r!="object"&&(r={});const f=Object.keys(s).concat(Object.keys(r)).reduce((c,o)=>(b(s[o],r[o])||(r[o]===void 0?c[o]=null:w(s[o])&&w(r[o])?c[o]=e(s[o],r[o]):c[o]=r[o]),c),{});return Object.keys(f).length>0?f:void 0}h.diff=e;function i(s={},r={}){s=s||{};const f=Object.keys(r).reduce((c,o)=>(!b(r[o],s[o])&&s[o]!==void 0&&(w(s[o])&&w(r[o])?c[o]=i(s[o],r[o]):c[o]=r[o]),c),{});return Object.keys(s).reduce((c,o)=>(s[o]!==r[o]&&r[o]===void 0&&(c[o]=null),c),f)}h.invert=i;function n(s,r,f=!1){if(typeof s!="object")return r;if(typeof r!="object")return;if(!f)return r;const c=Object.keys(r).reduce((o,u)=>(s[u]===void 0?o[u]=r[u]:w(s[u])&&w(r[u])&&(o[u]=n(s[u],r[u],!0)),o),{});return Object.keys(c).length>0?c:void 0}h.transform=n})(S||(S={}));const I=S;var T;(function(h){function t(i){return new B(i)}h.iterator=t;function e(i){return typeof i.delete=="number"?i.delete:typeof i.retain=="number"?i.retain:typeof i.insert=="string"?i.insert.length:1}h.length=e})(T||(T={}));const x=T;class B{constructor(t){this.ops=t,this.index=0,this.offset=0}hasNext(){return!!this.peek()}next(t){t||(t=1/0);const e=this.ops[this.index];if(e){const i=this.offset,n=T.length(e);if(t>=n-i?(t=n-i,this.index+=1,this.offset=0):this.offset+=t,typeof e.delete=="number")return{delete:t};{if(n===t)return e;const s={};return e.attributes&&(s.attributes=e.attributes),typeof e.retain=="number"?s.retain=t:typeof e.insert=="string"?s.insert=e.insert.substr(i,t):s.insert=e.insert,s}}else return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?T.length(this.ops[this.index])-this.offset:1/0}peekType(){const t=this.ops[this.index];return t?typeof t.delete=="number"?"delete":typeof t.retain=="number"?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);{const t=this.offset,e=this.index,i=this.next(),n=this.ops.slice(this.index);return this.offset=t,this.index=e,[i].concat(n)}}else return[]}}const Q="\0";class d{constructor(t){Array.isArray(t)?this.ops=t:t!=null&&Array.isArray(t.ops)?this.ops=t.ops:this.ops=[]}insert(t,e){const i={};return typeof t=="string"&&t.length===0?this:(i.insert=t,e!=null&&typeof e=="object"&&Object.keys(e).length>0&&(i.attributes=e),this.push(i))}delete(t){return t<=0?this:this.push({delete:t})}retain(t,e){if(t<=0)return this;const i={retain:t};return e!=null&&typeof e=="object"&&Object.keys(e).length>0&&(i.attributes=e),this.push(i)}push(t){let e=this.ops.length,i=this.ops[e-1];if(typeof i=="object"){if(typeof t.delete=="number"&&typeof i.delete=="number")return this.ops[e-1]={delete:i.delete+t.delete},this;if(typeof i.delete=="number"&&t.insert!=null&&(e-=1,i=this.ops[e-1],typeof i!="object"))return this.ops.unshift(t),this;if(b(t.attributes,i.attributes)){if(typeof t.insert=="string"&&typeof i.insert=="string")return this.ops[e-1]={insert:i.insert+t.insert},typeof t.attributes=="object"&&(this.ops[e-1].attributes=t.attributes),this;if(typeof t.retain=="number"&&typeof i.retain=="number")return this.ops[e-1]={retain:i.retain+t.retain},typeof t.attributes=="object"&&(this.ops[e-1].attributes=t.attributes),this}}return e===this.ops.length?this.ops.push(t):this.ops.splice(e,0,t),this}chop(){const t=this.ops[this.ops.length-1];return t&&t.retain&&!t.attributes&&this.ops.pop(),this}filter(t){return this.ops.filter(t)}forEach(t){this.ops.forEach(t)}map(t){return this.ops.map(t)}partition(t){const e=[],i=[];return this.forEach(n=>{(t(n)?e:i).push(n)}),[e,i]}reduce(t,e){return this.ops.reduce(t,e)}changeLength(){return this.reduce((t,e)=>e.insert?t+x.length(e):e.delete?t-e.delete:t,0)}length(){return this.reduce((t,e)=>t+x.length(e),0)}slice(t=0,e=1/0){const i=[],n=x.iterator(this.ops);let s=0;for(;s<e&&n.hasNext();){let r;s<t?r=n.next(t-s):(r=n.next(e-s),i.push(r)),s+=x.length(r)}return new d(i)}compose(t,e){const i=x.iterator(this.ops),n=x.iterator(t.ops),s=[],r=n.peek();if(r!=null&&typeof r.retain=="number"&&r.attributes==null){let c=r.retain;for(;i.peekType()==="insert"&&i.peekLength()<=c;)c-=i.peekLength(),s.push(i.next());r.retain-c>0&&n.next(r.retain-c)}const f=new d(s);for(;i.hasNext()||n.hasNext();)if(n.peekType()==="insert")f.push(n.next());else if(i.peekType()==="delete")f.push(i.next());else{const c=Math.min(i.peekLength(),n.peekLength()),o=i.next(c),u=n.next(c);if(typeof u.retain=="number"){let g;const l=u.attributes&&I.compose(o.attributes,u.attributes,!e&&typeof o.retain=="number");if(u.attributes&&!b(l,o.attributes)?(g={},typeof o.retain=="number"?g.retain=c:g.insert=o.insert,l&&(g.attributes=l)):o.retain===1/0?g=u:g=o,f.push(g),u.retain===1/0||!n.hasNext()&&b(f.ops[f.ops.length-1],g)){const a=new d(i.rest());return f.concat(a).chop()}}else typeof u.delete=="number"&&typeof o.retain=="number"&&f.push(u)}return f.chop()}concat(t){const e=new d(this.ops.slice());return t.ops.length>0&&(e.push(t.ops[0]),e.ops=e.ops.concat(t.ops.slice(1))),e}diff(t,e){if(this.ops===t.ops)return new d;const i=[this,t].map(c=>c.map(o=>{if(o.insert!=null)return typeof o.insert=="string"?o.insert:Q;const u=c===t?"on":"with";throw new Error("diff() called "+u+" non-document")}).join("")),n=new d,s=F(i[0],i[1],e),r=x.iterator(this.ops),f=x.iterator(t.ops);return s.forEach(c=>{let o=c[1].length;for(;o>0;){let u=0;switch(c[0]){case F.INSERT:u=Math.min(f.peekLength(),o),n.push(f.next(u));break;case F.DELETE:u=Math.min(o,r.peekLength()),r.next(u),n.delete(u);break;case F.EQUAL:u=Math.min(r.peekLength(),f.peekLength(),o);const g=r.next(u),l=f.next(u);b(g.insert,l.insert)?n.retain(u,I.diff(g.attributes,l.attributes)):n.push(l).delete(u);break}o-=u}}),n.chop()}eachLine(t,e=`
`){const i=x.iterator(this.ops);let n=new d,s=0;for(;i.hasNext();){if(i.peekType()!=="insert")return;const r=i.peek(),f=x.length(r)-i.peekLength(),c=typeof r.insert=="string"?r.insert.indexOf(e,f)-f:-1;if(c<0)n.push(i.next());else if(c>0)n.push(i.next(c));else{if(t(n,i.next(1).attributes||{},s)===!1)return;s+=1,n=new d}}n.length()>0&&t(n,{},s)}invert(t){const e=new d;return this.reduce((i,n)=>{if(n.insert)e.delete(x.length(n));else{if(n.retain&&n.attributes==null)return e.retain(n.retain),i+n.retain;if(n.delete||n.retain){const s=n.delete||n.retain;return t.slice(i,i+s).forEach(f=>{n.delete?e.push(f):n.retain&&n.attributes&&e.retain(x.length(f),I.invert(n.attributes,f.attributes))}),i+s}}return i},0),e.chop()}transform(t,e=!1){if(e=!!e,typeof t=="number")return this.transformPosition(t,e);const i=t,n=x.iterator(this.ops),s=x.iterator(i.ops),r=new d;for(;n.hasNext()||s.hasNext();)if(n.peekType()==="insert"&&(e||s.peekType()!=="insert"))r.retain(x.length(n.next()));else if(s.peekType()==="insert")r.push(s.next());else{const f=Math.min(n.peekLength(),s.peekLength()),c=n.next(f),o=s.next(f);if(c.delete)continue;o.delete?r.push(o):r.retain(f,I.transform(c.attributes,o.attributes,e))}return r.chop()}transformPosition(t,e=!1){e=!!e;const i=x.iterator(this.ops);let n=0;for(;i.hasNext()&&n<=t;){const s=i.peekLength(),r=i.peekType();if(i.next(),r==="delete"){t-=Math.min(s,t-n);continue}else r==="insert"&&(n<t||!e)&&(t+=s);n+=s}return t}}d.Op=x;d.AttributeMap=I;typeof module=="object"&&(module.exports=d,module.exports.default=d);function H(h){return h.map(t=>typeof t.insert=="string"?t.insert:t.insert?" ":"").join("")}function L(h){return h&&(h[0]>h[1]&&(h=[h[1],h[0]]),h)}const W=new Map,_={id:"",attributes:{},content:new d([{retain:1/0}]),length:1/0};var E;(function(h){function t(l,a){return new v(l,a)}h.iterator=t;function e(l){const a=new Map;return l.forEach(p=>a.set(p.id||h.createId(a),p)),a}h.linesToLineIds=e;function i(l){return l.length}h.length=i;function n(l){return console.warn("getId() is deprecated"),l.id}h.getId=n;function s(l,a){return b(l.attributes,a.attributes)&&b(l.content.ops,a.content.ops)}h.equal=s;function r(l,a){const p=[],m=new Map(a||[]);return l.eachLine((k,j)=>{const N=h.create(k,Object.keys(j).length?j:void 0,m);m.set(N.id,N),p.push(N)}),p}h.fromDelta=r;function f(l){let a=new d;return l.forEach(p=>{a=a.concat(p.content),a.insert(`
`,p.attributes)}),a}h.toDelta=f;function c(l=new d,a={},p){const m=l.length()+1;return typeof p!="string"&&(p=g(p)),{id:p,attributes:a,content:l,length:m}}h.create=c;function o(l,a=new d,p){const m=l?l.id:g(p),k=l?l.attributes:{};return{id:m,attributes:k,content:a,length:1}}h.createFrom=o;function u(l){const a=new Map;let p=0;return l.forEach(m=>{a.set(m,[p,p+=m.length])}),a}h.getLineRanges=u;function g(l=W){let a;for(;l[a=Math.random().toString(36).slice(2)];);return a}h.createId=g})(E||(E={}));const y=E;class v{constructor(t,e){this.lines=t,this.index=0,this.offset=0,this.lineIds=e?new Map(e):E.linesToLineIds(t)}hasNext(){return!!this.peek()}next(t){t||(t=1/0);const e=this.lines[this.index];if(e){const i=this.offset,n=e.length;if(t>=n-i?(t=n-i,this.index+=1,this.offset=0):this.offset+=t,i===0&&t>=e.length)return e;{const s=i===0?e.id:E.createId(this.lineIds),r={id:s,attributes:e.attributes,content:e.content.slice(i,t),length:t-i};return i!==0&&this.lineIds.set(s,r),r}}else return _}peek(){return this.lines[this.index]}peekLength(){return this.lines[this.index]?this.lines[this.index].length-this.offset:1/0}rest(){if(this.hasNext()){if(this.offset===0)return this.lines.slice(this.index);{const t=this.offset,e=this.index,i=this.next(),n=this.lines.slice(this.index);return this.offset=t,this.index=e,[i].concat(n)}}else return[]}}var C;(function(h){function t(i,n){return new V(i,n)}h.iterator=t;function e(i){return x.length(i)}h.length=e})(C||(C={}));const R=C;class V{constructor(t,e){this.lineIterator=y.iterator(t,e);const i=this.lineIterator.peek();this.opIterator=x.iterator((i==null?void 0:i.content.ops)||[])}hasNext(){return this.opIterator.hasNext()||this.lineIterator.hasNext()}next(t){let e=this.opIterator.next(t);return e.retain===1/0&&this.lineIterator.hasNext()&&(e=q(this.nextLine())),e}nextLine(){const t=this.lineIterator.next(),e=this.lineIterator.peek();return this.opIterator=new B((e==null?void 0:e.content.ops)||[]),t}peek(){return this.opIterator.hasNext()||!this.lineIterator.hasNext()?this.opIterator.peek():q(this.peekLine())}peekLine(){return this.lineIterator.peek()}peekLength(){return this.opIterator.hasNext()||!this.lineIterator.hasNext()?this.opIterator.peekLength():1}peekLineLength(){return this.lineIterator.peekLength()}peekType(){return this.opIterator.hasNext()?this.opIterator.peekType():this.lineIterator.hasNext()?"insert":"retain"}restCurrentLine(){return this.opIterator.rest()}restLines(){return this.opIterator.offset&&this.lineIterator.next(this.opIterator.offset),this.lineIterator.rest()}}function q(h){const t={insert:`
`};return h.attributes&&(t.attributes=h.attributes),t}class A{constructor(t,e=new d,i,n){this._pos=0,this.doc=t,this.delta=e,this.selection=i,this.activeFormats=n}get contentChanged(){return this.delta.ops.length>0}get selectionChanged(){var t;return this.selection!==void 0&&!b(this.selection,(t=this.doc)==null?void 0:t.selection)}apply(){throw new Error("Must be overridden by creator of change (e.g. Editor).")}setDelta(t){return this.delta=t,this._pos=t.length(),this}setActiveFormats(t){return this.activeFormats=t,this}select(t){return this.selection=typeof t=="number"?[t,t]:t,this}delete(t,e){if(!t||!this.doc)return this;let[i,n]=L(t);if(i===n)return this;if(i=Math.min(this.doc.length-1,Math.max(0,i)),n=Math.min(this.doc.length,Math.max(0,n)),i===n)return this;const s=n-i;this.doc.selection&&(this.selection=[i,i]),this.compose(i,f=>f.delete(s),s);const r=this.doc.getLineRange(i);if(!(e!=null&&e.dontFixNewline)&&r[1]<=n){const f=this.doc.getLineAt(i).attributes;this.formatLine(n,f)}return this}insert(t,e,i,n){if(!this.doc)return this;if(t=this.normalizePoint(t),this.doc.selection){const f=t+(typeof e=="string"?e.length:1);this.selection=[f,f]}const{id:s,...r}=this.doc.getLineAt(t).attributes;if(typeof e!="string")this.compose(t,f=>f.insert(e,i));else if(e===`
`)n!=null&&n.dontFixNewline?this.compose(t,f=>f.insert(`
`,{...i})):(this.compose(t,f=>f.insert(`
`,r)),this.formatLine(t,{...i}));else if(i||(i=this.getFormatAt(t)),e.includes(`
`)){const f=e.split(`
`);this.compose(t,c=>(f.forEach((o,u)=>{u&&c.insert(`
`,u===1?r:{}),o.length&&c.insert(o,i)}),c))}else this.compose(t,f=>f.insert(e,i));return this}insertContent(t,e){if(!this.doc)return this;if(t=this.normalizePoint(t),this.doc.selection){const s=e.ops.filter(f=>f.delete);for(;s.length&&s[s.length-1].retain;)s.pop();const r=t+s.reduce((f,c)=>f+x.length(c),0);this.selection=[r,r]}const n=H(e).indexOf(`
`);return n!==-1&&(e=e.compose(new d().retain(n).retain(1,this.doc.getLineFormat(t)))),this.compose(t,s=>s.concat(e)),this}formatText(t,e){return this.doc?(t=L(t),t[1]-t[0]?(e&&Object.keys(e).forEach(n=>e[n]===!1&&(e[n]=null)),this.doc.getLineRanges(t).forEach(([n,s])=>{n=Math.max(t[0],n),s=Math.min(t[1],s-1);const r=s-n;this.compose(n,f=>f.retain(r,e),r)}),this):this):this}toggleTextFormat(t,e){if(!this.doc)return this;typeof t=="number"&&(t=[t,t]),t=L(t);const i=this.doc.getTextFormat(t);return J(e,i)&&(e=I.invert(e)),this.formatText(t,e)}formatLine(t,e,i){if(!this.doc)return this;const n=this.doc;return typeof t=="number"&&(t=[t,t]),t=L(t),this.doc.getLineRanges(t).forEach(([,s])=>{s--,i||(e={...I.invert(n.getLineFormat(s)),...e}),this.compose(s,r=>r.retain(1,e),1)}),this.delta.chop(),this}toggleLineFormat(t,e){if(!this.doc)return this;typeof t=="number"&&(t=[t,t]),t=L(t);const i=this.doc.getLineFormat(t);return J(e,i)&&(e=I.invert(e)),this.formatLine(t,e)}removeFormat(t){if(!this.doc)return this;t=L(t);const e=I.invert(this.doc.getFormats(t)),i=t[1]-t[0];return this.compose(t[0],n=>n.retain(i,e),i)}transform(t,e){const i=this.delta.transform(t.delta,e),n=t.selection&&this.transformSelection(t.selection);return new A(null,i,n)}transformSelection(t,e){if(!t)return t;const i=this.delta.transformPosition(t[0],e),n=this.delta.transformPosition(t[1],e);return i===t[0]&&n===t[1]?t:[i,n]}transformAgainst(t,e){return(t.ops?new A(null,t):t).transform(this,!e)}isFor(t){return this.doc===t}clone(){var t;return new A(this.doc,new d(this.delta.ops.slice()),(t=this.selection)==null?void 0:t.slice())}compose(t,e,i){return this._pos<=t?this.delta=e(this.delta.retain(t-this._pos)):this.delta=this.delta.compose(e(new d().retain(t))),this._pos=Math.max(t+(i||0),this._pos),this}normalizePoint(t,e=this.doc?this.doc.length-1:0){return Math.max(0,Math.min(e,t))}getFormatAt(t){let e;if(this.doc){const i=this.doc.getTextFormat(t),n=this.doc.getTextFormat(t+1);i&&n&&(e=i===n?i:X(n,Object.keys(i)))}return e}}function J(h,t){return Object.keys(h).every(e=>b(t[e],h[e]))}function X(h,t){const e={};return Object.keys(h).forEach(i=>{h[i]===t[i]&&(e[i]=h[i])}),e}const Y=[0,0],Z={},D=new WeakMap,tt=new Set(["id"]);class M{constructor(t,e=null){if(t&&t.lines){const i=t;this.lines=i.lines,this.byId=i.byId,this._ranges=i._ranges,this.length=i.length}else this.byId=new Map,t&&Array.isArray(t)?this.lines=t:t?this.lines=y.fromDelta(t):this.lines=[y.create()],this.lines.length||this.lines.push(y.create()),this.byId=y.linesToLineIds(this.lines),this.lines.forEach(i=>{if(this.byId.get(i.id)!==i)throw new Error("TextDocument has duplicate line ids: "+i.id)}),this._ranges=y.getLineRanges(this.lines),this.length=this.lines.reduce((i,n)=>i+n.length,0);e&&(e=e.map(i=>Math.min(this.length,Math.max(0,i))),e[0]===e[1]&&e[0]===this.length&&e[0]--),this.selection=e}get change(){const t=new A(this);return t.apply=()=>this.apply(t),t}getText(t){return t&&(t=L(t)),H(t?this.slice(t[0],t[1]):this.slice(0,this.length-1))}getLineBy(t){return this.byId.get(t)}getLineAt(t){return this.lines.find(e=>{const[i,n]=this.getLineRange(e);return i<=t&&n>t})}getLinesAt(t,e){let i,n;return Array.isArray(t)?[i,n]=L(t):i=n=t,this.lines.filter(s=>{const[r,f]=this.getLineRange(s);return e?r>=i&&f<=n:(r<n||r===i)&&f>i})}getLineRange(t){const{lines:e,_ranges:i}=this;if(typeof t=="number"){for(let n=0;n<e.length;n++){const s=i.get(e[n])||Y;if(s[0]<=t&&s[1]>t)return s}return Y}else return typeof t=="string"&&(t=this.getLineBy(t)),i.get(t)}getLineRanges(t){return t==null?Array.from(this._ranges.values()):this.getLinesAt(t).map(e=>this.getLineRange(e))}getLineFormat(t=this.selection,e){let i=t;return Array.isArray(t)&&([t,i]=L(t)),t===i&&i++,$(y,this.lines,t,i,void 0,e)}getTextFormat(t=this.selection,e){let i=t;return Array.isArray(t)&&([t,i]=L(t)),t===i&&t--,$(R,this.lines,t,i,n=>n.insert!==`
`,e)}getFormats(t=this.selection,e){return{...this.getTextFormat(t,e),...this.getLineFormat(t,e)}}slice(t=0,e=1/0){const i=[],n=R.iterator(this.lines);let s=0;for(;s<e&&n.hasNext();){let r;s<t?r=n.next(t-s):(r=n.next(e-s),i.push(r)),s+=x.length(r)}return new d(i)}apply(t,e,i){var g;let n;if(t.delta?(n=t.delta,e=t.selection):n=t,!n.ops.length&&(e===void 0||b(this.selection,e)))return this;if(!n.ops.length&&e)return new M(this,e);e===void 0&&this.selection&&(e=[n.transformPosition(this.selection[0]),n.transformPosition(this.selection[1])],b(this.selection,e)&&(e=this.selection));const s=R.iterator(this.lines,this.byId),r=x.iterator(n.ops),f=[],c=r.peek();if(c&&c.retain&&!c.attributes){let l=c.retain;for(;s.peekLineLength()<=l;)l-=s.peekLineLength(),f.push(s.nextLine());c.retain-l>0&&r.next(c.retain-l)}if(!s.hasNext()&&i)throw new Error("apply() called with change that extends beyond document");let o=y.createFrom(s.peekLine());function u(l){l.length=l.content.length()+1,f.push(l)}for(;s.hasNext()||r.hasNext();)if(r.peekType()==="insert"){const l=r.peek(),a=typeof l.insert=="string"?l.insert.indexOf(`
`,r.offset):-1;if(a<0)o.content.push(r.next());else{const p=a-r.offset;p&&o.content.push(r.next(p));const m=r.next(1);u(y.create(o.content,m.attributes,o.id)),o=y.create(void 0,o.attributes)}}else{const l=Math.min(s.peekLength(),r.peekLength()),a=s.next(l),p=r.next(l);if(typeof a.retain=="number"){if(i)throw new Error("apply() called with change that extends beyond document");continue}if(typeof p.retain=="number"){const m=a.insert===`
`;let k=a;const j=p.attributes&&I.compose(a.attributes,p.attributes);if(p.attributes&&!b(j,a.attributes)&&(m?o.attributes=j||{}:(k={insert:a.insert},j&&(k.attributes=j))),m?(u(o),o=y.createFrom(s.peekLine())):o.content.push(k),p.retain===1/0||!r.hasNext()){if(s.opIterator.index!==0||s.opIterator.offset!==0){const N=s.restCurrentLine();for(let O=0;O<N.length;O++)o.content.push(N[O]);u(o),s.nextLine()}f.push(...s.restLines());break}}else typeof p.delete=="number"&&a.insert===`
`&&(o=y.create(o.content,(g=s.peekLine())==null?void 0:g.attributes,o.id))}return f.length||f.push(o),new M(f,e)}replace(t,e){return new M(t,e)}toDelta(){const t=D;let e=t.get(this);return e||(e=y.toDelta(this.lines),t.set(this,e)),e}equals(t,e){return this===t||((e==null?void 0:e.contentOnly)||b(this.selection,t.selection))&&b(this.lines,t.lines,{excludeProps:tt})}toJSON(){return this.toDelta()}toString(){return this.lines.map(t=>t.content.map(e=>typeof e.insert=="string"?e.insert:" ").join("")).join(`
`)+`
`}}function $(h,t,e,i,n,s){const r=h.iterator(t);let f,c=0;for(r.skip&&(c+=r.skip(e));c<i&&r.hasNext();){const o=r.next();c+=h.length(o),c>e&&(!n||n(o))&&(o.attributes?f?s!=null&&s.allFormats?f=I.compose(f,o.attributes):f=et(f,o.attributes,s==null?void 0:s.nameOnly):f={...o.attributes}:f={})}return f||Z}function et(h,t,e){return Object.keys(t).reduce(function(i,n){return e?n in h&&n in t&&(i[n]=!0):b(h[n],t[n],{partial:!0})?i[n]=t[n]:b(t[n],h[n],{partial:!0})&&(i[n]=h[n]),i},{})}export{I as A,d as D,y as L,A as T,M as a,J as h,b as i,L as n};
