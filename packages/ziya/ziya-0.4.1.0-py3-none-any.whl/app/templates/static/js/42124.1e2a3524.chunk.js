"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[42124],{42124:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u,triggerAstStatusCheck:()=>d});var o=n(65043),s=n(89073),r=n(94828),i=n(57692);var c=n(8347),a=n(70579);let l=null;const d=()=>{window.dispatchEvent(new CustomEvent("ast-config-changed"))},f=async()=>{if(l)return console.debug("Reusing existing AST status request"),l;l=(async()=>{try{const e=await fetch("/api/ast/status");if(!e.ok)throw new Error("HTTP error! Status: ".concat(e.status));return await e.json()}catch(e){return console.error("Error fetching AST status:",e),{is_indexing:!1,completion_percentage:0,is_complete:!1,indexed_files:0,total_files:0,elapsed_seconds:null,error:e instanceof Error?e.message:"Unknown error"}}})();const e=await l;return l=null,e},u=()=>{const[e,t]=(0,o.useState)(null),[n,l]=(0,o.useState)(!1),[d,u]=(0,o.useState)(!1),{isDarkMode:p}=(0,c.D)();if((0,o.useEffect)(()=>{if(!new URL(window.location.href).searchParams.has("ast")&&"true"!==localStorage.getItem("ZIYA_AST_ENABLED")&&!document.querySelector("[data-ast-enabled]"))return void console.debug("AST not enabled, skipping status checks");const e=new AbortController;let n=null,o=!0;const s=async()=>{if(!e.signal.aborted&&o)try{const r=await f();if(e.signal.aborted||!o)return;o&&(t(r),(r.is_indexing||r.is_complete)&&u(!0),(r.is_indexing||r.error)&&l(!0),r.is_complete&&!r.error&&setTimeout(()=>{o&&l(!1)},5e3),r.is_indexing&&!r.is_complete&&(n=window.setTimeout(s,3e3)))}catch(r){if(r instanceof Error&&"AbortError"===r.name)return void console.debug("AST status check aborted");console.error("Error checking AST status:",r),d&&o&&(n=window.setTimeout(s,3e3))}};s();const r=()=>{"visible"===document.visibilityState?!n&&o&&s():n&&(window.clearTimeout(n),n=null)};document.addEventListener("visibilitychange",r);const i=()=>{u(!1),s()};return window.addEventListener("ast-config-changed",i),()=>{o=!1,e.abort(),n&&window.clearTimeout(n),document.removeEventListener("visibilitychange",r),window.removeEventListener("ast-config-changed",i)}},[d]),!e||!n)return null;if(e.error)return d?(0,a.jsx)(s.A,{className:"ast-status-error",style:{position:"fixed",bottom:"10px",right:"10px",width:"300px",backgroundColor:p?"#2a1f1f":"#fff1f0",borderColor:p?"#a61d24":"#ffa39e",color:p?"#ff7875":void 0},children:(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"AST Indexing Error"}),(0,a.jsx)("p",{children:e.error})]})}):null;if(e.is_indexing&&!e.is_complete){const t=e.elapsed_seconds?" (".concat((e=>{if(!e)return"";if(e<60)return"".concat(Math.round(e),"s");if(e<3600){const t=Math.floor(e/60),n=Math.round(e%60);return"".concat(t,"m ").concat(n,"s")}{const t=Math.floor(e/3600),n=Math.floor(e%3600/60);return"".concat(t,"h ").concat(n,"m")}})(e.elapsed_seconds),")"):"";return(0,a.jsx)(s.A,{className:"ast-status-indicator",style:{position:"fixed",bottom:"10px",right:"10px",width:"300px",backgroundColor:p?"#141414":"#ffffff",borderColor:p?"#303030":"#d9d9d9",color:p?"#ffffff":void 0},children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[(0,a.jsx)("strong",{children:"AST Indexing"}),(0,a.jsxs)("span",{children:[e.completion_percentage,"%",t]})]}),(0,a.jsx)(r.A,{title:"".concat(e.indexed_files,"/").concat(e.total_files," files processed"),children:(0,a.jsx)(i.A,{percent:e.completion_percentage,size:"small",status:"active",showInfo:!1})}),(0,a.jsxs)("div",{style:{fontSize:"12px",color:"#8c8c8c",marginTop:"4px"},children:[e.indexed_files,"/",e.total_files," files processed"]})]})})}return e.is_complete?(0,a.jsx)(s.A,{className:"ast-status-complete",style:{position:"fixed",bottom:"10px",right:"10px",width:"300px",backgroundColor:p?"#162312":"#f6ffed",borderColor:p?"#389e0d":"#b7eb8f",color:p?"#ffffff":void 0},children:(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"AST Indexing Complete"}),(0,a.jsxs)("div",{style:{fontSize:"12px",color:"#8c8c8c",marginTop:"4px"},children:[e.indexed_files," files indexed"]})]})}):null}}}]);
//# sourceMappingURL=42124.1e2a3524.chunk.js.map