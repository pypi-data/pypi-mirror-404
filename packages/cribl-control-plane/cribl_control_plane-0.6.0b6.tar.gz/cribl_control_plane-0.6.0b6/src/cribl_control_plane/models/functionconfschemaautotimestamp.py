"""Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT."""

from __future__ import annotations
from cribl_control_plane import models, utils
from cribl_control_plane.types import BaseModel, UNSET_SENTINEL
from enum import Enum
import pydantic
from pydantic import field_serializer, model_serializer
from typing import List, Optional
from typing_extensions import Annotated, NotRequired, TypedDict


class DefaultTime(str, Enum, metaclass=utils.OpenEnumMeta):
    r"""How to set the time field if no timestamp is found"""

    # Current Time
    NOW = "now"
    # Last Event's Time
    LAST = "last"
    # None
    NONE = "none"


class TimestampTypedDict(TypedDict):
    regex: str
    r"""Regex with first capturing group matching the timestamp"""
    strptime: str
    r"""Select or enter strptime format for the captured timestamp"""


class Timestamp(BaseModel):
    regex: str
    r"""Regex with first capturing group matching the timestamp"""

    strptime: str
    r"""Select or enter strptime format for the captured timestamp"""


class FunctionConfSchemaAutoTimestampTypedDict(TypedDict):
    src_field: NotRequired[str]
    r"""Field to search for a timestamp"""
    dst_field: NotRequired[str]
    r"""Field to place timestamp in"""
    default_timezone: NotRequired[str]
    r"""Timezone to assign to timestamps without timezone info"""
    time_expression: NotRequired[str]
    r"""Expression to use to format time. Current time, as a JavaScript Date object, is in global `time`. You can access other fields' values via __e.<fieldName>."""
    offset: NotRequired[float]
    r"""The offset into the string from which to look for a timestamp"""
    max_len: NotRequired[float]
    r"""Maximum string length at which to look for a timestamp"""
    default_time: NotRequired[DefaultTime]
    r"""How to set the time field if no timestamp is found"""
    latest_date_allowed: NotRequired[str]
    r"""The latest timestamp value allowed relative to now, such as +42days. Parsed values after this date will be set to the Default time."""
    spacer: NotRequired[str]
    earliest_date_allowed: NotRequired[str]
    r"""The earliest timestamp value allowed relative to now, such as -42years. Parsed values prior to this date will be set to the Default time."""
    timestamps: NotRequired[List[TimestampTypedDict]]
    r"""Add regex/strptime pairs to extract additional timestamp formats"""


class FunctionConfSchemaAutoTimestamp(BaseModel):
    src_field: Annotated[Optional[str], pydantic.Field(alias="srcField")] = None
    r"""Field to search for a timestamp"""

    dst_field: Annotated[Optional[str], pydantic.Field(alias="dstField")] = None
    r"""Field to place timestamp in"""

    default_timezone: Annotated[
        Optional[str], pydantic.Field(alias="defaultTimezone")
    ] = None
    r"""Timezone to assign to timestamps without timezone info"""

    time_expression: Annotated[
        Optional[str], pydantic.Field(alias="timeExpression")
    ] = None
    r"""Expression to use to format time. Current time, as a JavaScript Date object, is in global `time`. You can access other fields' values via __e.<fieldName>."""

    offset: Optional[float] = None
    r"""The offset into the string from which to look for a timestamp"""

    max_len: Annotated[Optional[float], pydantic.Field(alias="maxLen")] = None
    r"""Maximum string length at which to look for a timestamp"""

    default_time: Annotated[
        Optional[DefaultTime], pydantic.Field(alias="defaultTime")
    ] = None
    r"""How to set the time field if no timestamp is found"""

    latest_date_allowed: Annotated[
        Optional[str], pydantic.Field(alias="latestDateAllowed")
    ] = None
    r"""The latest timestamp value allowed relative to now, such as +42days. Parsed values after this date will be set to the Default time."""

    spacer: Optional[str] = None

    earliest_date_allowed: Annotated[
        Optional[str], pydantic.Field(alias="earliestDateAllowed")
    ] = None
    r"""The earliest timestamp value allowed relative to now, such as -42years. Parsed values prior to this date will be set to the Default time."""

    timestamps: Optional[List[Timestamp]] = None
    r"""Add regex/strptime pairs to extract additional timestamp formats"""

    @field_serializer("default_time")
    def serialize_default_time(self, value):
        if isinstance(value, str):
            try:
                return models.DefaultTime(value)
            except ValueError:
                return value
        return value

    @model_serializer(mode="wrap")
    def serialize_model(self, handler):
        optional_fields = set(
            [
                "srcField",
                "dstField",
                "defaultTimezone",
                "timeExpression",
                "offset",
                "maxLen",
                "defaultTime",
                "latestDateAllowed",
                "spacer",
                "earliestDateAllowed",
                "timestamps",
            ]
        )
        serialized = handler(self)
        m = {}

        for n, f in type(self).model_fields.items():
            k = f.alias or n
            val = serialized.get(k)

            if val != UNSET_SENTINEL:
                if val is not None or k not in optional_fields:
                    m[k] = val

        return m
