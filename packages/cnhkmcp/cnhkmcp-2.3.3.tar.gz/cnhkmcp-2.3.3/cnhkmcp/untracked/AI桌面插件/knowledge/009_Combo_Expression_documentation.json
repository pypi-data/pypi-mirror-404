{
  "id": "combo-expression",
  "title": "Combo Expression",
  "lastModified": "2025-06-02T05:33:29.737226-04:00",
  "content": [
    {
      "type": "TEXT",
      "value": "<p></p><hr/><p></p>",
      "id": "d7fc23de-2289-409f-a46f-9ff1f9e9425a"
    },
    {
      "type": "HEADING",
      "value": {
        "level": "1",
        "content": "Combo Expression"
      },
      "id": "0f1abc14-0f2f-4671-80a0-ef8a47fdf91a"
    },
    {
      "type": "IMAGE",
      "value": {
        "title": "Combo_expression_pic4.png",
        "width": 538,
        "height": 182,
        "fileSize": 2157,
        "url": "https://api.worldquantbrain.com/content/images/HsG43uTPySq0ZGMDejBocvRTrHI=/99/original/Combo_expression_pic4.png"
      },
      "id": "4631c5fd-6447-4ced-8864-d718d6a75c79"
    },
    {
      "type": "TEXT",
      "value": "<p>The combo expression combines the selected Alphas together into one Alpha â€“ a SuperAlpha. The output of the combo expression is a set of daily weights for each of the selected Alphas.</p>",
      "id": "306eb9dc-ba64-45f0-95c0-789305a4d847"
    },
    {
      "type": "HEADING",
      "value": {
        "level": "1",
        "content": "How it Works"
      },
      "id": "4615c4e4-35e6-4a22-ab01-e228c2ed3165"
    },
    {
      "type": "TEXT",
      "value": "<p>The combo expression works by weighting each selected Alpha each day. Similar to how an Alpha expression is evaluated for each instrument each day, the combo expression is evaluated for each of your Alphas each day.</p><p>Typically, combo expressions take the set of selected Alphas as input. The data from the selected Alphas is held in a matrix with shape = (A x D x I), where:</p><ul><li>A is the number of selected Alphas</li><li>D is the number of days</li><li>I is the number of instruments in the universe</li></ul><p>The output of the combo expression is a set of weights for each selected Alpha each day, held in a matrix with shape = (D x A). These weights determine how the scaled output of each Alpha is combined together to yield a SuperAlpha.</p>",
      "id": "1100a70a-c65a-410c-8746-6b8821e4b2a1"
    },
    {
      "type": "TEXT",
      "value": "<img src='https://api.worldquantbrain.com/content/images/1p8buLSAxhPKxP33q_vK8a_6GEw=/134/original/' width='900'/>",
      "id": "8d59d4c7-14dd-4146-a923-f0f47bb3394e"
    },
    {
      "type": "HEADING",
      "value": {
        "level": "1",
        "content": "Operator generate_stats()"
      },
      "id": "34c5b1a3-5675-417e-b2b7-9d4006db5d0a"
    },
    {
      "type": "IMAGE",
      "value": {
        "title": "generate_stats_operator_pic6.png",
        "width": 331,
        "height": 101,
        "fileSize": 5679,
        "url": "https://api.worldquantbrain.com/content/images/gnMm5zdhbutRPN8RM8ILUyDen0Y=/112/original/generate_stats_operator_pic6.png"
      },
      "id": "6ba34104-c6bb-4cd8-ae02-e7f51ab34547"
    },
    {
      "type": "TEXT",
      "value": "<p>The generate_stats() operator calculates Alpha statistics for each day in the IS period. It takes an input of selected Alphas with shape = (A x D x I). It outputs daily statistics for each Alpha with shape = (S x D x A), where S is the number of statistics calculated.</p>",
      "id": "a98d7cb9-025a-44dc-8722-1fbeaad6741b"
    },
    {
      "type": "IMAGE",
      "value": {
        "title": "generate_stats_",
        "width": 1259,
        "height": 468,
        "fileSize": 284274,
        "url": "https://api.worldquantbrain.com/content/images/I-k9bDvp6HGgr8WW0zq2m-jC2f0=/296/original/generate_stats_image.PNG"
      },
      "id": "e8937458-d29f-485b-9a03-0070b0b98574"
    },
    {
      "type": "TEXT",
      "value": "<p></p><p><b>Alpha Statistics</b></p><p>The generate_stats() operator calculates the following daily statistics for each Alpha:</p>",
      "id": "c28a691f-896a-4dd0-834d-6346ea40af6d"
    },
    {
      "type": "TABLE",
      "value": {
        "data": [
          [
            "Alpha Statistic",
            "Description"
          ],
          [
            "drawdown",
            "% difference between current cumulative PnL and maximum PnL since beginning of simulation"
          ],
          [
            "hold_pnl",
            "PnL of shares that did not trade"
          ],
          [
            "hold_shares",
            "Count of shares that did not trade"
          ],
          [
            "hold_value",
            "Sum of value of shares that did not trade"
          ],
          [
            "long_count",
            "Number of instruments with positive weight"
          ],
          [
            "long_value",
            "Sum of positive weight"
          ],
          [
            "pnl",
            "Net profit or loss"
          ],
          [
            "returns",
            "PnL as percent of book size"
          ],
          [
            "short_count",
            "Number of instruments with negative weight"
          ],
          [
            "short_value",
            "Sum of absolute value of negative weight"
          ],
          [
            "trade_pnl",
            "PnL of shares that did trade"
          ],
          [
            "trade_shares",
            "Count of shares that did trade"
          ],
          [
            "trade_value",
            "Sum of value of shares that did trade"
          ],
          [
            "turnover",
            "Value traded as percent of book size"
          ]
        ],
        "firstRowIsTableHeader": true,
        "firstColIsHeader": false
      },
      "id": "0e6376d3-0c4c-471d-9210-3785d146c7a0"
    },
    {
      "type": "HEADING",
      "value": {
        "level": "1",
        "content": "Available operators"
      },
      "id": "8af4c697-074a-4067-bfc3-0d14042ef650"
    },
    {
      "type": "TEXT",
      "value": "<p>Combo expressions can use most of the same operators as Alpha expressions. A full list of available operators is available at <a href=\"$tutorialpage/superalpha/appendix-operators\">Appendix: SuperAlpha Operators</a>.</p>",
      "id": "aae4cf66-02fa-4f58-8d40-25ffd2424c23"
    },
    {
      "type": "HEADING",
      "value": {
        "level": "1",
        "content": "SuperAlpha Combo Settings"
      },
      "id": "9acd7308-c53a-4da8-a805-fbf39f225eb7"
    },
    {
      "type": "IMAGE",
      "value": {
        "title": "Superalpha_combo_settings_pic7.png",
        "width": 668,
        "height": 199,
        "fileSize": 11569,
        "url": "https://api.worldquantbrain.com/content/images/9Xwfmrx8dAaMNTmDkAyGhYG5Ikc=/102/original/Superalpha_combo_settings_pic7.png"
      },
      "id": "b9fed1b8-02ff-4347-b1ac-62da3fe87aca"
    },
    {
      "type": "TEXT",
      "value": "<p>The lower section of the SuperAlpha settings menu applies to the combo expression and the resulting SuperAlpha.</p>",
      "id": "2a8630a2-349a-4005-9d34-54b37be6e1f1"
    },
    {
      "type": "TEXT",
      "value": "<p></p><hr/><p><b>Universe</b></p><p>The selected universe setting is applied to all selected Alphas when the SuperAlpha is simulated, regardless of the original universe of those Alphas. The resulting SuperAlpha is based upon this universe.</p><p></p><hr/><p></p>",
      "id": "f03979bc-4ee2-4cde-b71b-f0082df904cf"
    },
    {
      "type": "TEXT",
      "value": "<p><b>Neutralization</b></p><p>The selected neutralization is applied to the final weighted combination of selected Alphas.</p><hr/><p></p>",
      "id": "93fffca2-c9fe-436a-ab1e-e2d4c5e461e6"
    },
    {
      "type": "TEXT",
      "value": "<p><b>Decay</b></p><p>The decay setting applies the ts_decay() operator to the final weighted combination of selected Alphas, where the decay value is the number of lookback days. This is useful for reducing turnover, but larger values can attenuate the signal.</p><hr/><p></p>",
      "id": "485a69e0-bca2-4387-92ce-700357089f91"
    },
    {
      "type": "TEXT",
      "value": "<p><b>Truncation</b></p><p>The selected truncation is applied to the final weighted combination of selected Alphas. This is useful to reducing overfitting.</p><hr/><p></p>",
      "id": "8262fb9a-a321-4733-9afb-2c40f9914482"
    },
    {
      "type": "TEXT",
      "value": "<p><b>Pasteurization</b></p><p>Replaces operator input values with NaN for instruments not in the universe. Original Alpha pasteurization settings are preserved. The combo pasteurization setting applies to operators used in the combo expression.</p><hr/><p></p>",
      "id": "0e6884fd-9749-49ae-a15a-3cece2743eb6"
    },
    {
      "type": "TEXT",
      "value": "<p><b>NaN Handling</b></p><p>Allows aggregation operators to output numeric values when input values are NaN for a given instrument and date. Original Alpha NaN Handling settings are preserved. The combo NaN Handling setting applies to operators used in the combo expression.</p><hr/><p></p>",
      "id": "87f7d02b-90e3-4d87-8203-6c93a7a53acc"
    },
    {
      "type": "TEXT",
      "value": "<p><b>Test Period</b></p><p>The Test Period setting offers you the flexibility to designate a separate testing period for your SuperAlpha. This period corresponds to the final 0-6 years of the In-Sample (IS) period, providing a distinct timeframe for assessing your SuperAlpha's performance before submission.</p>",
      "id": "a34dcfb9-f873-4c0a-a3c7-a25da0a3092a"
    },
    {
      "type": "HEADING",
      "value": {
        "level": "1",
        "content": "Examples"
      },
      "id": "650664d7-7c76-4230-8330-39ace6a46107"
    },
    {
      "type": "TABLE",
      "value": {
        "data": [
          [
            "Combo Expression",
            "Description"
          ],
          [
            "1",
            "This expression evaluates to 1 for every Alpha every day. It will weight each selected Alpha equally every day."
          ],
          [
            "stats = generate_stats(alpha);\nts_ir(stats.returns, 250)",
            "This expression weights each Alpha by its information ratio from the previous 250 trading days (~1 year)."
          ],
          [
            "stats = generate_stats(alpha);\ninnerCorr = self_corr(stats.returns, 500);\nic = if_else(innerCorr == 1.0, nan, innerCorr);\nmaxCorr = reduce_max(ic);\n1 - maxCorr",
            "This expression weights each Alpha by the maximum correlation with all other selected Alphas over a 2 year period, with more correlated Alphas receiving less weight."
          ]
        ],
        "firstRowIsTableHeader": true,
        "firstColIsHeader": false
      },
      "id": "85189703-db20-40fa-a8fa-a26b81611dfb"
    }
  ],
  "sequence": 3,
  "category": "SuperAlpha"
}