{# Daily PSTN bot entry point (both dial-in and dial-out) #}
{% if 'daily_pstn_dialin' in transports %}
    try:
        request = DailyDialinRequest.model_validate(runner_args.body)

        daily_dialin_settings = DailyDialinSettings(
            call_id=request.dialin_settings.call_id,
            call_domain=request.dialin_settings.call_domain,
        )

        transport = DailyTransport(
            runner_args.room_url,
            runner_args.token,
            "Daily PSTN Bot",
            params=DailyParams(
                api_key=request.daily_api_key,
                api_url=request.daily_api_url,
                dialin_settings=daily_dialin_settings,
                audio_in_enabled=True,
                {% if enable_krisp %}
                audio_in_filter=krisp_filter,
                {% endif %}
                audio_out_enabled=True,
            ),
        )

        # Log caller information if available
        # You can use this to look up customer information to personalize the conversation
        if request.dialin_settings.From:
            logger.info(f"Handling call from: {request.dialin_settings.From}")

        await run_bot(transport)
{% endif %}
{% if 'daily_pstn_dialout' in transports %}

    try:
        request = AgentRequest.model_validate(runner_args.body)

        transport = DailyTransport(
            request.room_url,
            request.token,
            "Daily PSTN Bot",
            params=DailyParams(
                api_key=os.getenv("DAILY_API_KEY"),
                audio_in_enabled=True,
                {% if enable_krisp %}
                audio_in_filter=krisp_filter,
                {% endif %}
                audio_out_enabled=True,
            ),
        )

        await run_bot(transport, request.dialout_settings)
{% endif %}

    except Exception as e:
        logger.error(f"Error running bot: {e}")
        raise e


