repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: check-added-large-files
      - id: check-ast
      - id: check-case-conflict
      - id: check-merge-conflict
      - id: check-toml
      - id: check-yaml
      - id: end-of-file-fixer
      - id: mixed-line-ending
      - id: trailing-whitespace

  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.9
    hooks:
      - id: ruff-check
        args: [--fix]
      - id: ruff-format

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.15.0
    hooks:
      - id: mypy
        pass_filenames: false
        args: [affinity]
        additional_dependencies:
          - httpx>=0.25.0
          - pydantic>=2.0.0
          # CLI dependencies (optional at runtime, required for type-checking affinity/cli/*)
          - click>=8.1
          - rich>=13
          - rich-click>=1.8
          - platformdirs>=4
          # Mypy is configured with python_version=3.10, so it will type-check the tomli branch.
          - tomli>=2
          - tomli-w>=1.0
          - python-dotenv>=1.0.0
          - types-click

  - repo: local
    hooks:
      - id: check-cli-patterns
        name: Check CLI serialization patterns
        entry: python tools/check_cli_patterns.py
        language: system
        types: [python]
        files: ^affinity/cli/commands/.*\.py$
      - id: sync-plugin-version
        name: Sync plugin version with SDK
        entry: python tools/sync_plugin_version.py
        language: python
        files: ^(pyproject\.toml|plugins/.*/\.claude-plugin/plugin\.json)$
        pass_filenames: false
        additional_dependencies: ['tomli']
      - id: sync-mcp-registry
        name: Sync MCP CLI commands registry
        entry: python tools/sync_mcp_registry.py
        language: system
        files: ^(pyproject\.toml|affinity/cli/commands/.*\.py)$
        pass_filenames: false
      - id: sync-mcp-version
        name: Sync MCP version files
        entry: python tools/sync_mcp_version.py
        language: python
        files: ^(mcp/VERSION|mcp/\.claude-plugin/plugin\.json|mcp/server\.d/server\.meta\.json)$
        pass_filenames: false
      - id: pytest-pre-push
        name: Run tests before push
        entry: pytest tests/ -x -q --tb=short
        language: system
        pass_filenames: false
        stages: [pre-push]
        always_run: true
