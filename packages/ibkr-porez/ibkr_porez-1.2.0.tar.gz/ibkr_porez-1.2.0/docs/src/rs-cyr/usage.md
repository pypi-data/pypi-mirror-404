# Употреба

## Конфигурација

Креирање или измена личних података и подешавања приступа IBKR-у.

```bash
ibkr-porez config
```

Биће вам затражено:

*   **IBKR Flex Token**: [Преузимање токена](ibkr.md/#flex-web-service)
*   **IBKR Query ID**: [Креирање Flex Query-а](ibkr.md/#flex-query)
*   **Personal ID**: ЈМБГ / ЕБС
*   **Full Name**: Име и Презиме
*   **Address**: Адреса пребивалишта
*   **City Code**: Троцифрени код општине. Пример: `223` (Нови Сад). Код можете наћи у [шифарнику](https://www.apml.gov.rs/uploads/useruploads/Documents/1533_1_pravilnik-javni_prihodi_prilog-3.pdf) (видети колону "Шифра"). Такође доступан у падајућем менију на порталу еПорези.
*   **Phone**: Телефон
*   **Email**: Email

## Преузимање података (`get`)

Преузима најновије податке са IBKR и синхронизује курсеве са НБС (Народна банка Србије).

Чува их у локално складиште.

```bash
ibkr-porez get
```

## Увоз историјских података (`import`)

Учитавање историје трансакција старије од 365 дана, која се не може преузети путем Flex Query-а (`get`).

1.  Преузмите CSV: [Извоз пуне историје](ibkr.md/#import)
2.  Увезите фајл:

```bash
ibkr-porez import /path/to/activity_statement.csv
```

> ⚠️ Не заборавите да покренете `get` након `import` како би апликација додала максимум детаља бар за последњу годину
> у мање детаљне податке учитане из CSV-а.

### Логика синхронизације (`import` + `get`)
При учитавању података из CSV-а (`import`) и Flex Query-а (`get`), систем даје приоритет потпунијим Flex Query подацима:

*   Подаци Flex Query-а (`get`) су извор истине. Они преписују CSV податке за било које подударне датуме.
*   Ако се запис Flex Query-а семантички поклапа са CSV записом (Датум, Тикер, Цена, Количина), то се рачуна као ажурирање (замена званичним ID-ем).
*   Ако се структура података разликује (нпр. сплит налози у Flex Query-у против "спојеног" записа у CSV-у), стари CSV запис се уклања, а нови Flex Query записи се додају.
*   Потпуно идентични записи се прескачу.

## Приказ статистике (`show`)

```bash
ibkr-porez show
```

Приказује:

*   Примљене дивиденде (у РСД).
*   Број продаја (порески догађаји).
*   Процену реализованог P/L (Капитална добит) (у РСД).

## Генерисање Пореског извештаја за капиталну добит (`report`)

```bash
# Извештај за последње пуно полугодиште
ibkr-porez report

# Извештај за друго полугодиште 2025 (1. јул - 31. дец)
ibkr-porez report --year 2025 --half 2
```

* **Резултат**: `ppdg3r_2025_H1.xml`
* Увезите овај фајл на портал Пореске управе Србије (еПорези)
* Ручно отпремите фајл из [Документ потврде](ibkr.md#_1) у Тачку 8
