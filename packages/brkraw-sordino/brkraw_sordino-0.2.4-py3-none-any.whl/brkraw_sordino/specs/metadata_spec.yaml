__meta__:
  name: "sordino_metadata"
  version: "0.1.0"
  description: "Draft metadata mapping for ZTE-based fMRI (BEP proposal alignment)."
  category: "metadata_spec"
  transforms_source: "./utils.py"

RepetitionTime:
  sources:
    - file: method
      key: PVM_RepetitionTime
    - file: method
      key: RepetitionTime
  transform: ms_to_s

EchoTime:
  sources:
    - file: method
      key: PVM_EchoTime
  transform: ms_to_s

FlipAngle:
  sources:
    - file: acqp
      key: ACQ_flip_angle
  transform: first_float

MRAcquisitionType:
  inputs:
    value:
      const: "3D"
  transform: value_only

Manufacturer:
  inputs:
    value:
      const: "Bruker"
  transform: value_only

SequenceName:
  sources:
    - file: method
      key: Method
  transform: strip_bruker_string

ZTETechnique:
  inputs:
    method:
      sources:
        - file: method
          key: Method
        - file: method
          key: PULPROG
  transform: infer_zte_technique

ZTETrajectoryType:
  sources:
    - file: method
      key: PVM_TrajType
    - file: method
      key: PVM_EncTraj
    - file: method
      key: TrajType
  transform: normalize_trajectory

ZTEReadoutPoints:
  sources:
    - file: method
      key: NPoints
  transform: first_int

ZTEProjections:
  sources:
    - file: method
      key: NPro
  transform: first_int

ZTEOverSampling:
  sources:
    - file: method
      key: OverSampling
  transform: first_float

ZTEEffectiveBandwidth:
  sources:
    - file: method
      key: PVM_EffSWh
  transform: first_float

ZTEAcqDelayTotal:
  sources:
    - file: method
      key: AcqDelayTotal
  transform: first_float

ZTEUnderSampling:
  sources:
    - file: method
      key: ProUnderSampling
  transform: first_float

ZTEReceiverChannels:
  sources:
    - file: method
      key: PVM_EncNReceivers
  transform: first_int

ReconMatrix:
  sources:
    - file: method
      key: PVM_Matrix
  transform: to_int_list

FieldOfView:
  sources:
    - file: method
      key: PVM_Fov
  transform: to_float_list

SpatialResolution:
  sources:
    - file: method
      key: PVM_SpatResol
  transform: to_float_list

SliceOrientation:
  sources:
    - file: method
      key: PVM_SPackArrSliceOrient
  transform: convert_to_list

ReadoutOrientation:
  sources:
    - file: method
      key: PVM_SPackArrReadOrient
  transform: convert_to_list

ConversionSoftware:
  inputs:
    value:
      const: "brkraw-sordino"
  transform: value_only

ConversionSoftwareVersion:
  inputs:
    value:
      const: "brkraw-sordino"
  transform: plugin_version

ConversionMethod:
  inputs:
    package:
      const: "brkraw-sordino"
    name:
      const: "brkraw-sordino"
  transform: conversion_method

SourceDataset:
  inputs:
    value:
      const: null
  transform: source_dataset_env

ScanIdentifier:
  inputs:
    scan_id: "$scan_id"
  transform: scan_id_to_string
