import pytest

from water_column_sonar_annotation.record import EchoviewRecordManager


#######################################################
def setup_module():
    print("setup")


def teardown_module():
    print("teardown")


@pytest.fixture
def process_evr_file_path(test_path):
    return test_path["DATA_TEST_PATH"]


#######################################################
# @pytest.mark.skip(reason="todo implement this")
# def test_process_evr_file(process_evr_file_path, tmp_path):
#     echoview_record_manager = EchoviewRecordManager()
#     echoview_record_manager.process_point_data()
#     assert True

record_header = """EVRG 7 11.0.244.39215
11"""

possible_herring_example = """13 4 7 0 3 -1 1 20190925 2247242130  24.1290795746 20190925 2247362460  35.1668500183
0
0
possible_herring
20190925 2247242130 24.1290795746 20190925 2247242130 35.1668500183 20190925 2247362460 35.1668500183 20190925 2247362460 24.1290795746 1
100"""

fish_school_example = """13 30 8 0 7 -1 1 20190925 1749451605  20.2800268439 20190925 1749501645  26.3028953087
0
10
School detected with:
Minimum data threshold:  -66.00
Maximum data threshold: (none)
Distance mode: GPS distance
Minimum total school height (meters):   4.00
Minimum candidate length (meters):   1.00
Minimum candidate height (meters):   2.00
Maximum vertical linking distance (meters):   2.00
Maximum horizontal linking distance (meters):  20.00
Minimum total school length (meters):   4.00
fish_school
20190925 1749451605 22.0286015595 20190925 1749451605 25.1371788317 20190925 1749461355 25.1371788317 20190925 1749461605 25.1420359837 20190925 1749461605 25.7200370702 20190925 1749471370 25.7200370702 20190925 1749471620 25.7248942222 20190925 1749471620 26.1086092292 20190925 1749481385 26.1086092292 20190925 1749481635 26.1134663812 20190925 1749481635 26.3028953087 20190925 1749491640 26.3028953087 20190925 1749491640 25.1371788317 20190925 1749501645 25.1371788317 20190925 1749501645 24.5543205932 20190925 1749491640 24.5543205932 20190925 1749491640 24.3600345136 20190925 1749501645 24.3600345136 20190925 1749501645 21.6400294005 20190925 1749491640 21.6400294005 20190925 1749491640 21.0571711620 20190925 1749481635 21.0571711620 20190925 1749481635 20.2800268439 20190925 1749471620 20.2800268439 20190925 1749471620 20.8580279305 20190925 1749471370 20.8628850825 20190925 1749461605 20.8628850825 20190925 1749461605 21.8294583280 20190925 1749461355 21.8343154800 20190925 1749451605 21.8343154800 1
Region 8"""

unclassified_regions_example = """13 12 1 0 2 -1 1 20190925 2053458953  9.2818 20190925 2054119318  11.5333
0
0
Unclassified regions
20190925 2053458953 9.6034489515 20190925 2053521545 11.1197829964 20190925 2054046730 11.5333286451 20190925 2054064248 11.5333286451 20190925 2054079263 11.4414296120 20190925 2054116810 10.8440858974 20190925 2054119318 10.4764897652 20190925 2054116810 9.6953479845 20190925 2054111800 9.4196508854 20190925 2054091775 9.2818023359 20190925 2054076760 9.2818023359 20190925 2053483995 9.5574994350 0
100"""

krill_schools_example = """13 23 49 0 7 -1 1 20191020 0536541560  13.0000000000 20191020 0536591655  17.0000000000
0
10
School detected with:
Minimum data threshold:  -80.00
Maximum data threshold: (none)
Distance mode: GPS distance
Minimum total school height (meters):   4.00
Minimum candidate length (meters):   1.00
Minimum candidate height (meters):   2.00
Maximum vertical linking distance (meters):   2.00
Maximum horizontal linking distance (meters):  20.00
Minimum total school length (meters):   4.00
krill_schools
20191020 0536551605 15.0250000000 20191020 0536551605 17.0000000000 20191020 0536561605 17.0000000000 20191020 0536561605 16.0000000000 20191020 0536571635 16.0000000000 20191020 0536571635 15.0000000000 20191020 0536581405 15.0000000000 20191020 0536581655 15.0250000000 20191020 0536581655 16.0000000000 20191020 0536591655 16.0000000000 20191020 0536591655 15.0000000000 20191020 0536581655 15.0000000000 20191020 0536581655 14.0000000000 20191020 0536571635 14.0000000000 20191020 0536571635 13.0000000000 20191020 0536561605 13.0000000000 20191020 0536561605 14.9750000000 20191020 0536561355 15.0000000000 20191020 0536551605 15.0000000000 20191020 0536551605 14.0000000000 20191020 0536541560 14.0000000000 20191020 0536541560 15.0000000000 20191020 0536551355 15.0000000000 1
Region 49"""

ah_school_example1 = """13 5 23 0 7 -1 1 20191106 1314583780  25.3008882713 20191106 1314593790  30.2941528987
0
10
School detected with:
Minimum data threshold:  -66.00
Maximum data threshold: (none)
Distance mode: GPS distance
Minimum total school height (meters):   4.00
Minimum candidate length (meters):   1.00
Minimum candidate height (meters):   2.00
Maximum vertical linking distance (meters):   2.00
Maximum horizontal linking distance (meters):  20.00
Minimum total school length (meters):   4.00
AH_School
20191106 1314583780 25.4929369108 20191106 1314583780 30.2941528987 20191106 1314593790 30.2941528987 20191106 1314593790 25.3008882713 20191106 1314583780 25.3008882713 1
Region 23"""


ah_school_example2 = """13 16 28 0 7 -1 1 20191106 1317305715  31.8305420148 20191106 1317335745  35.8635634446
0
10
School detected with:
Minimum data threshold:  -66.00
Maximum data threshold: (none)
Distance mode: GPS distance
Minimum total school height (meters):   4.00
Minimum candidate length (meters):   1.00
Minimum candidate height (meters):   2.00
Maximum vertical linking distance (meters):   2.00
Maximum horizontal linking distance (meters):  20.00
Minimum total school length (meters):   4.00
AH_School
20191106 1317315725 34.3319755445 20191106 1317315725 35.8635634446 20191106 1317325735 35.8635634446 20191106 1317325735 35.4794661656 20191106 1317335745 35.4794661656 20191106 1317335745 34.5192229680 20191106 1317325735 34.5192229680 20191106 1317325735 34.3271743285 20191106 1317335745 34.3271743285 20191106 1317335745 31.8305420148 20191106 1317315725 31.8305420148 20191106 1317315725 34.1303244730 20191106 1317315475 34.1351256890 20191106 1317305715 34.1351256890 20191106 1317305715 34.3271743285 20191106 1317315475 34.3271743285 1
Region 28"""

atlantic_herring_example = """13 70 2 0 2 -1 1 20191014 0011274130  26.8060139347 20191014 0017599670  76.3659699303
0
0
atlantic_herring
20191014 0011274130 32.7282728273 20191014 0011339205 48.0014668133 20191014 0011474370 54.2354235424 20191014 0011499420 54.2354235424 20191014 0011544520 54.2354235424 20191014 0012260060 57.6640997433 20191014 0012310115 57.6640997433 20191014 0012350165 57.6640997433 20191014 0012390210 57.6640997433 20191014 0013370930 70.7554088742 20191014 0013420980 71.6905023836 20191014 0013506080 71.6905023836 20191014 0013541115 71.3788045471 20191014 0013586170 71.3788045471 20191014 0014011185 70.7554088742 20191014 0015067420 75.7425742574 20191014 0015107470 76.0542720939 20191014 0015187560 76.3659699303 20191014 0015282670 76.3659699303 20191014 0015307700 76.0542720939 20191014 0015337730 75.7425742574 20191014 0016278420 75.1191785845 20191014 0016383575 75.1191785845 20191014 0016473695 75.1191785845 20191014 0016528780 74.4957829116 20191014 0016568850 73.2489915658 20191014 0017129040 68.2618261826 20191014 0017154065 66.7033370004 20191014 0017184115 64.8331499817 20191014 0017199150 62.9629629630 20191014 0017339330 56.4173083975 20191014 0017384400 55.7939127246 20191014 0017439460 55.1705170517 20191014 0017479510 53.6120278695 20191014 0017599670 49.5599559956 20191014 0017599670 48.0014668133 20191014 0017584660 44.8844884488 20191014 0017559630 44.5727906124 20191014 0017309300 44.5727906124 20191014 0017284270 44.2610927759 20191014 0017259240 44.2610927759 20191014 0017214180 43.3259992666 20191014 0017179110 43.0143014301 20191014 0016323505 43.0143014301 20191014 0016288450 43.0143014301 20191014 0016223340 42.0792079208 20191014 0016188310 42.0792079208 20191014 0016143230 41.1441144114 20191014 0015467870 39.2739273927 20191014 0015402790 38.0271360469 20191014 0015327710 36.7803447011 20191014 0014351845 34.9101576824 20191014 0014306720 34.5984598460 20191014 0014261660 33.9750641731 20191014 0014221575 33.3516685002 20191014 0014191530 33.3516685002 20191014 0014161465 33.3516685002 20191014 0014116410 33.3516685002 20191014 0013150670 30.2346901357 20191014 0013060570 28.6762009534 20191014 0013020530 27.4294096076 20191014 0012555450 26.8060139347 20191014 0012485320 26.8060139347 20191014 0012455280 26.8060139347 20191014 0012134870 29.6112944628 20191014 0012074750 29.9229922992 20191014 0011534490 31.4814814815 20191014 0011429315 32.4165749908 20191014 0011339205 32.7282728273 20191014 0011314180 32.7282728273 1
100"""


def test_process_evr_record_possible_herring():
    echoview_record_manager = EchoviewRecordManager()
    echoview_record_manager.process_evr_record(
        evr_record=possible_herring_example, filename="test.evr"
    )


def test_process_evr_record_fish_school():
    echoview_record_manager = EchoviewRecordManager()
    echoview_record_manager.process_evr_record(
        evr_record=fish_school_example, filename="test.evr"
    )


def test_process_evr_record_unclassified_regions():
    echoview_record_manager = EchoviewRecordManager()
    echoview_record_manager.process_evr_record(
        evr_record=unclassified_regions_example, filename="test.evr"
    )


def test_process_evr_record_krill_schools():
    echoview_record_manager = EchoviewRecordManager()
    echoview_record_manager.process_evr_record(
        evr_record=krill_schools_example, filename="test.evr"
    )


def test_process_evr_record_ah_school_1():
    echoview_record_manager = EchoviewRecordManager()
    echoview_record_manager.process_evr_record(
        evr_record=ah_school_example1, filename="test.evr"
    )


def test_process_evr_record_ah_school_2():
    echoview_record_manager = EchoviewRecordManager()
    echoview_record_manager.process_evr_record(
        evr_record=ah_school_example2, filename="test.evr"
    )
