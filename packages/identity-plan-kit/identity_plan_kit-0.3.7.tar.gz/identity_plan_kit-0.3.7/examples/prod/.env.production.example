# =============================================================================
# Production Environment Configuration for IdentityPlanKit
# =============================================================================
# Copy this file to .env.production and fill in your values
#
# SECURITY WARNING:
# - Never commit .env.production to version control
# - Use secrets management in production (AWS Secrets Manager, Vault, etc.)
# - Rotate secrets regularly
# =============================================================================

# -----------------------------------------------------------------------------
# Environment
# -----------------------------------------------------------------------------
IPK_ENVIRONMENT=production

# -----------------------------------------------------------------------------
# Database Configuration
# -----------------------------------------------------------------------------
# PostgreSQL async connection string
# Format: postgresql+asyncpg://user:password@host:port/database
IPK_DATABASE_URL=postgresql+asyncpg://app_user:CHANGE_ME_DB_PASSWORD@postgres:5432/identity_plan_kit

# Database connection pool size (adjust based on expected load)
IPK_DATABASE_POOL_SIZE=10

# Statement timeout in milliseconds (prevents long-running queries)
IPK_DATABASE_STATEMENT_TIMEOUT_MS=30000

# SQL query logging (disable in production for performance)
IPK_DATABASE_ECHO=false

# Docker Compose DB password (used in docker-compose.prod.yml)
DB_PASSWORD=CHANGE_ME_DB_PASSWORD

# -----------------------------------------------------------------------------
# Security Configuration
# -----------------------------------------------------------------------------
# JWT signing secret key - MUST be at least 32 characters
# Generate with: openssl rand -hex 32
IPK_SECRET_KEY=CHANGE_ME_GENERATE_WITH_openssl_rand_hex_32

# JWT algorithm (HS256, HS384, or HS512)
IPK_ALGORITHM=HS256

# -----------------------------------------------------------------------------
# Google OAuth Configuration
# -----------------------------------------------------------------------------
# Get these from Google Cloud Console: https://console.cloud.google.com/apis/credentials
IPK_GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
IPK_GOOGLE_CLIENT_SECRET=your-client-secret
IPK_GOOGLE_REDIRECT_URI=https://api.yourdomain.com/auth/google/callback

# -----------------------------------------------------------------------------
# Token Configuration
# -----------------------------------------------------------------------------
# Access token expiration (minutes) - shorter is more secure
IPK_ACCESS_TOKEN_EXPIRE_MINUTES=15

# Refresh token expiration (days)
IPK_REFRESH_TOKEN_EXPIRE_DAYS=30

# -----------------------------------------------------------------------------
# Cookie Configuration
# -----------------------------------------------------------------------------
# Cookie domain (use .yourdomain.com for subdomains)
COOKIE_DOMAIN=.yourdomain.com
IPK_COOKIE_DOMAIN=.yourdomain.com

# Always use secure cookies in production (HTTPS only)
IPK_COOKIE_SECURE=true

# SameSite policy: "strict", "lax", or "none"
IPK_COOKIE_SAMESITE=lax

# -----------------------------------------------------------------------------
# Redis Configuration (Required for Multi-Instance Deployments)
# -----------------------------------------------------------------------------
# Redis URL for distributed state (OAuth CSRF tokens, session data)
IPK_REDIS_URL=redis://redis:6379/0

# Fail startup if Redis is unavailable (recommended for production)
IPK_REQUIRE_REDIS=true

# -----------------------------------------------------------------------------
# Caching Configuration
# -----------------------------------------------------------------------------
# Permission cache TTL in seconds (0 to disable)
IPK_PERMISSION_CACHE_TTL_SECONDS=60

# -----------------------------------------------------------------------------
# Rate Limiting
# -----------------------------------------------------------------------------
# Format: "count/period" where period is: second, minute, hour, day
IPK_RATE_LIMIT_LOGIN=20/minute
IPK_RATE_LIMIT_CALLBACK=10/minute
IPK_RATE_LIMIT_REFRESH=30/minute
IPK_RATE_LIMIT_LOGOUT=10/minute

# -----------------------------------------------------------------------------
# Proxy Configuration
# -----------------------------------------------------------------------------
# Trust X-Forwarded-For headers (enable when behind nginx/load balancer)
IPK_TRUST_PROXY_HEADERS=true

# -----------------------------------------------------------------------------
# Metrics (Optional - requires: pip install identity-plan-kit[metrics])
# -----------------------------------------------------------------------------
# Enable Prometheus metrics endpoint
IPK_ENABLE_METRICS=true

# Metrics endpoint path
IPK_METRICS_PATH=/metrics

# -----------------------------------------------------------------------------
# Token Cleanup
# -----------------------------------------------------------------------------
# Automatically clean up expired tokens
IPK_ENABLE_AUTO_CLEANUP=true

# Cleanup interval in hours
IPK_CLEANUP_INTERVAL_HOURS=6.0

# -----------------------------------------------------------------------------
# Graceful Shutdown
# -----------------------------------------------------------------------------
# Time to wait for in-flight requests to complete (seconds)
IPK_SHUTDOWN_GRACE_PERIOD_SECONDS=10.0

# -----------------------------------------------------------------------------
# Monitoring (Optional)
# -----------------------------------------------------------------------------
# Grafana admin password
GRAFANA_PASSWORD=CHANGE_ME_GRAFANA_PASSWORD

# -----------------------------------------------------------------------------
# Feature Flags
# -----------------------------------------------------------------------------
# Enable persistent sessions via refresh tokens
IPK_ENABLE_REMEMBER_ME=true

# Enable feature usage tracking
IPK_ENABLE_USAGE_TRACKING=true
