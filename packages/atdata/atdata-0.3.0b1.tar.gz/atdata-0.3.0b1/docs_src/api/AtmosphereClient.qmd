# AtmosphereClient { #atdata.atmosphere.AtmosphereClient }

```python
atmosphere.AtmosphereClient(base_url=None, *, _client=None)
```

ATProto client wrapper for atdata operations.

This class wraps the atproto SDK client and provides higher-level methods
for working with atdata records (schemas, datasets, lenses).

## Examples {.doc-section .doc-section-examples}

```python
>>> client = AtmosphereClient()
>>> client.login("alice.bsky.social", "app-password")
>>> print(client.did)
'did:plc:...'
```

## Note {.doc-section .doc-section-note}

The password should be an app-specific password, not your main account
password. Create app passwords in your Bluesky account settings.

## Attributes

| Name | Description |
| --- | --- |
| [did](#atdata.atmosphere.AtmosphereClient.did) | Get the DID of the authenticated user. |
| [handle](#atdata.atmosphere.AtmosphereClient.handle) | Get the handle of the authenticated user. |
| [is_authenticated](#atdata.atmosphere.AtmosphereClient.is_authenticated) | Check if the client has a valid session. |

## Methods

| Name | Description |
| --- | --- |
| [create_record](#atdata.atmosphere.AtmosphereClient.create_record) | Create a record in the user's repository. |
| [delete_record](#atdata.atmosphere.AtmosphereClient.delete_record) | Delete a record. |
| [export_session](#atdata.atmosphere.AtmosphereClient.export_session) | Export the current session for later reuse. |
| [get_blob](#atdata.atmosphere.AtmosphereClient.get_blob) | Download a blob from a PDS. |
| [get_blob_url](#atdata.atmosphere.AtmosphereClient.get_blob_url) | Get the direct URL for fetching a blob. |
| [get_record](#atdata.atmosphere.AtmosphereClient.get_record) | Fetch a record by AT URI. |
| [list_datasets](#atdata.atmosphere.AtmosphereClient.list_datasets) | List dataset records. |
| [list_lenses](#atdata.atmosphere.AtmosphereClient.list_lenses) | List lens records. |
| [list_records](#atdata.atmosphere.AtmosphereClient.list_records) | List records in a collection. |
| [list_schemas](#atdata.atmosphere.AtmosphereClient.list_schemas) | List schema records. |
| [login](#atdata.atmosphere.AtmosphereClient.login) | Authenticate with the ATProto PDS. |
| [login_with_session](#atdata.atmosphere.AtmosphereClient.login_with_session) | Authenticate using an exported session string. |
| [put_record](#atdata.atmosphere.AtmosphereClient.put_record) | Create or update a record at a specific key. |
| [upload_blob](#atdata.atmosphere.AtmosphereClient.upload_blob) | Upload binary data as a blob to the PDS. |

### create_record { #atdata.atmosphere.AtmosphereClient.create_record }

```python
atmosphere.AtmosphereClient.create_record(
    collection,
    record,
    *,
    rkey=None,
    validate=False,
)
```

Create a record in the user's repository.

#### Parameters {.doc-section .doc-section-parameters}

| Name       | Type                                          | Description                                                                                                       | Default    |
|------------|-----------------------------------------------|-------------------------------------------------------------------------------------------------------------------|------------|
| collection | [str](`str`)                                  | The NSID of the record collection (e.g., 'ac.foundation.dataset.sampleSchema').                                   | _required_ |
| record     | [dict](`dict`)                                | The record data. Must include a '$type' field.                                                                    | _required_ |
| rkey       | [Optional](`typing.Optional`)\[[str](`str`)\] | Optional explicit record key. If not provided, a TID is generated.                                                | `None`     |
| validate   | [bool](`bool`)                                | Whether to validate against the Lexicon schema. Set to False for custom lexicons that the PDS doesn't know about. | `False`    |

#### Returns {.doc-section .doc-section-returns}

| Name   | Type                                      | Description                       |
|--------|-------------------------------------------|-----------------------------------|
|        | [AtUri](`atdata.atmosphere._types.AtUri`) | The AT URI of the created record. |

#### Raises {.doc-section .doc-section-raises}

| Name   | Type                                                                                                            | Description               |
|--------|-----------------------------------------------------------------------------------------------------------------|---------------------------|
|        | [ValueError](`ValueError`)                                                                                      | If not authenticated.     |
|        | [atproto](`atproto`).[exceptions](`atproto.exceptions`).[AtProtocolError](`atproto.exceptions.AtProtocolError`) | If record creation fails. |

### delete_record { #atdata.atmosphere.AtmosphereClient.delete_record }

```python
atmosphere.AtmosphereClient.delete_record(uri, *, swap_commit=None)
```

Delete a record.

#### Parameters {.doc-section .doc-section-parameters}

| Name        | Type                                                      | Description                               | Default    |
|-------------|-----------------------------------------------------------|-------------------------------------------|------------|
| uri         | [str](`str`) \| [AtUri](`atdata.atmosphere._types.AtUri`) | The AT URI of the record to delete.       | _required_ |
| swap_commit | [Optional](`typing.Optional`)\[[str](`str`)\]             | Optional CID for compare-and-swap delete. | `None`     |

#### Raises {.doc-section .doc-section-raises}

| Name   | Type                                                                                                            | Description           |
|--------|-----------------------------------------------------------------------------------------------------------------|-----------------------|
|        | [ValueError](`ValueError`)                                                                                      | If not authenticated. |
|        | [atproto](`atproto`).[exceptions](`atproto.exceptions`).[AtProtocolError](`atproto.exceptions.AtProtocolError`) | If deletion fails.    |

### export_session { #atdata.atmosphere.AtmosphereClient.export_session }

```python
atmosphere.AtmosphereClient.export_session()
```

Export the current session for later reuse.

#### Returns {.doc-section .doc-section-returns}

| Name   | Type         | Description                                                    |
|--------|--------------|----------------------------------------------------------------|
|        | [str](`str`) | Session string that can be passed to ``login_with_session()``. |

#### Raises {.doc-section .doc-section-raises}

| Name   | Type                       | Description           |
|--------|----------------------------|-----------------------|
|        | [ValueError](`ValueError`) | If not authenticated. |

### get_blob { #atdata.atmosphere.AtmosphereClient.get_blob }

```python
atmosphere.AtmosphereClient.get_blob(did, cid)
```

Download a blob from a PDS.

This resolves the PDS endpoint from the DID document and fetches
the blob directly from the PDS.

#### Parameters {.doc-section .doc-section-parameters}

| Name   | Type         | Description                                    | Default    |
|--------|--------------|------------------------------------------------|------------|
| did    | [str](`str`) | The DID of the repository containing the blob. | _required_ |
| cid    | [str](`str`) | The CID of the blob.                           | _required_ |

#### Returns {.doc-section .doc-section-returns}

| Name   | Type             | Description             |
|--------|------------------|-------------------------|
|        | [bytes](`bytes`) | The blob data as bytes. |

#### Raises {.doc-section .doc-section-raises}

| Name   | Type                                                     | Description                         |
|--------|----------------------------------------------------------|-------------------------------------|
|        | [ValueError](`ValueError`)                               | If PDS endpoint cannot be resolved. |
|        | [requests](`requests`).[HTTPError](`requests.HTTPError`) | If blob fetch fails.                |

### get_blob_url { #atdata.atmosphere.AtmosphereClient.get_blob_url }

```python
atmosphere.AtmosphereClient.get_blob_url(did, cid)
```

Get the direct URL for fetching a blob.

This is useful for passing to WebDataset or other HTTP clients.

#### Parameters {.doc-section .doc-section-parameters}

| Name   | Type         | Description                                    | Default    |
|--------|--------------|------------------------------------------------|------------|
| did    | [str](`str`) | The DID of the repository containing the blob. | _required_ |
| cid    | [str](`str`) | The CID of the blob.                           | _required_ |

#### Returns {.doc-section .doc-section-returns}

| Name   | Type         | Description                         |
|--------|--------------|-------------------------------------|
|        | [str](`str`) | The full URL for fetching the blob. |

#### Raises {.doc-section .doc-section-raises}

| Name   | Type                       | Description                         |
|--------|----------------------------|-------------------------------------|
|        | [ValueError](`ValueError`) | If PDS endpoint cannot be resolved. |

### get_record { #atdata.atmosphere.AtmosphereClient.get_record }

```python
atmosphere.AtmosphereClient.get_record(uri)
```

Fetch a record by AT URI.

#### Parameters {.doc-section .doc-section-parameters}

| Name   | Type                                                      | Description               | Default    |
|--------|-----------------------------------------------------------|---------------------------|------------|
| uri    | [str](`str`) \| [AtUri](`atdata.atmosphere._types.AtUri`) | The AT URI of the record. | _required_ |

#### Returns {.doc-section .doc-section-returns}

| Name   | Type           | Description                      |
|--------|----------------|----------------------------------|
|        | [dict](`dict`) | The record data as a dictionary. |

#### Raises {.doc-section .doc-section-raises}

| Name   | Type                                                                                                            | Description          |
|--------|-----------------------------------------------------------------------------------------------------------------|----------------------|
|        | [atproto](`atproto`).[exceptions](`atproto.exceptions`).[AtProtocolError](`atproto.exceptions.AtProtocolError`) | If record not found. |

### list_datasets { #atdata.atmosphere.AtmosphereClient.list_datasets }

```python
atmosphere.AtmosphereClient.list_datasets(repo=None, limit=100)
```

List dataset records.

#### Parameters {.doc-section .doc-section-parameters}

| Name   | Type                                          | Description                                       | Default   |
|--------|-----------------------------------------------|---------------------------------------------------|-----------|
| repo   | [Optional](`typing.Optional`)\[[str](`str`)\] | The DID to query. Defaults to authenticated user. | `None`    |
| limit  | [int](`int`)                                  | Maximum number to return.                         | `100`     |

#### Returns {.doc-section .doc-section-returns}

| Name   | Type                             | Description              |
|--------|----------------------------------|--------------------------|
|        | [list](`list`)\[[dict](`dict`)\] | List of dataset records. |

### list_lenses { #atdata.atmosphere.AtmosphereClient.list_lenses }

```python
atmosphere.AtmosphereClient.list_lenses(repo=None, limit=100)
```

List lens records.

#### Parameters {.doc-section .doc-section-parameters}

| Name   | Type                                          | Description                                       | Default   |
|--------|-----------------------------------------------|---------------------------------------------------|-----------|
| repo   | [Optional](`typing.Optional`)\[[str](`str`)\] | The DID to query. Defaults to authenticated user. | `None`    |
| limit  | [int](`int`)                                  | Maximum number to return.                         | `100`     |

#### Returns {.doc-section .doc-section-returns}

| Name   | Type                             | Description           |
|--------|----------------------------------|-----------------------|
|        | [list](`list`)\[[dict](`dict`)\] | List of lens records. |

### list_records { #atdata.atmosphere.AtmosphereClient.list_records }

```python
atmosphere.AtmosphereClient.list_records(
    collection,
    *,
    repo=None,
    limit=100,
    cursor=None,
)
```

List records in a collection.

#### Parameters {.doc-section .doc-section-parameters}

| Name       | Type                                          | Description                                                                          | Default    |
|------------|-----------------------------------------------|--------------------------------------------------------------------------------------|------------|
| collection | [str](`str`)                                  | The NSID of the record collection.                                                   | _required_ |
| repo       | [Optional](`typing.Optional`)\[[str](`str`)\] | The DID of the repository to query. Defaults to the authenticated user's repository. | `None`     |
| limit      | [int](`int`)                                  | Maximum number of records to return (default 100).                                   | `100`      |
| cursor     | [Optional](`typing.Optional`)\[[str](`str`)\] | Pagination cursor from a previous call.                                              | `None`     |

#### Returns {.doc-section .doc-section-returns}

| Name   | Type                                          | Description                                                    |
|--------|-----------------------------------------------|----------------------------------------------------------------|
|        | [list](`list`)\[[dict](`dict`)\]              | A tuple of (records, next_cursor). The cursor is None if there |
|        | [Optional](`typing.Optional`)\[[str](`str`)\] | are no more records.                                           |

#### Raises {.doc-section .doc-section-raises}

| Name   | Type                       | Description                            |
|--------|----------------------------|----------------------------------------|
|        | [ValueError](`ValueError`) | If repo is None and not authenticated. |

### list_schemas { #atdata.atmosphere.AtmosphereClient.list_schemas }

```python
atmosphere.AtmosphereClient.list_schemas(repo=None, limit=100)
```

List schema records.

#### Parameters {.doc-section .doc-section-parameters}

| Name   | Type                                          | Description                                       | Default   |
|--------|-----------------------------------------------|---------------------------------------------------|-----------|
| repo   | [Optional](`typing.Optional`)\[[str](`str`)\] | The DID to query. Defaults to authenticated user. | `None`    |
| limit  | [int](`int`)                                  | Maximum number to return.                         | `100`     |

#### Returns {.doc-section .doc-section-returns}

| Name   | Type                             | Description             |
|--------|----------------------------------|-------------------------|
|        | [list](`list`)\[[dict](`dict`)\] | List of schema records. |

### login { #atdata.atmosphere.AtmosphereClient.login }

```python
atmosphere.AtmosphereClient.login(handle, password)
```

Authenticate with the ATProto PDS.

#### Parameters {.doc-section .doc-section-parameters}

| Name     | Type         | Description                                      | Default    |
|----------|--------------|--------------------------------------------------|------------|
| handle   | [str](`str`) | Your Bluesky handle (e.g., 'alice.bsky.social'). | _required_ |
| password | [str](`str`) | App-specific password (not your main password).  | _required_ |

#### Raises {.doc-section .doc-section-raises}

| Name   | Type                                                                                                            | Description              |
|--------|-----------------------------------------------------------------------------------------------------------------|--------------------------|
|        | [atproto](`atproto`).[exceptions](`atproto.exceptions`).[AtProtocolError](`atproto.exceptions.AtProtocolError`) | If authentication fails. |

### login_with_session { #atdata.atmosphere.AtmosphereClient.login_with_session }

```python
atmosphere.AtmosphereClient.login_with_session(session_string)
```

Authenticate using an exported session string.

This allows reusing a session without re-authenticating, which helps
avoid rate limits on session creation.

#### Parameters {.doc-section .doc-section-parameters}

| Name           | Type         | Description                               | Default    |
|----------------|--------------|-------------------------------------------|------------|
| session_string | [str](`str`) | Session string from ``export_session()``. | _required_ |

### put_record { #atdata.atmosphere.AtmosphereClient.put_record }

```python
atmosphere.AtmosphereClient.put_record(
    collection,
    rkey,
    record,
    *,
    validate=False,
    swap_commit=None,
)
```

Create or update a record at a specific key.

#### Parameters {.doc-section .doc-section-parameters}

| Name        | Type                                          | Description                                     | Default    |
|-------------|-----------------------------------------------|-------------------------------------------------|------------|
| collection  | [str](`str`)                                  | The NSID of the record collection.              | _required_ |
| rkey        | [str](`str`)                                  | The record key.                                 | _required_ |
| record      | [dict](`dict`)                                | The record data. Must include a '$type' field.  | _required_ |
| validate    | [bool](`bool`)                                | Whether to validate against the Lexicon schema. | `False`    |
| swap_commit | [Optional](`typing.Optional`)\[[str](`str`)\] | Optional CID for compare-and-swap update.       | `None`     |

#### Returns {.doc-section .doc-section-returns}

| Name   | Type                                      | Description               |
|--------|-------------------------------------------|---------------------------|
|        | [AtUri](`atdata.atmosphere._types.AtUri`) | The AT URI of the record. |

#### Raises {.doc-section .doc-section-raises}

| Name   | Type                                                                                                            | Description           |
|--------|-----------------------------------------------------------------------------------------------------------------|-----------------------|
|        | [ValueError](`ValueError`)                                                                                      | If not authenticated. |
|        | [atproto](`atproto`).[exceptions](`atproto.exceptions`).[AtProtocolError](`atproto.exceptions.AtProtocolError`) | If operation fails.   |

### upload_blob { #atdata.atmosphere.AtmosphereClient.upload_blob }

```python
atmosphere.AtmosphereClient.upload_blob(
    data,
    mime_type='application/octet-stream',
)
```

Upload binary data as a blob to the PDS.

#### Parameters {.doc-section .doc-section-parameters}

| Name      | Type             | Description                                                 | Default                      |
|-----------|------------------|-------------------------------------------------------------|------------------------------|
| data      | [bytes](`bytes`) | Binary data to upload.                                      | _required_                   |
| mime_type | [str](`str`)     | MIME type of the data (for reference, not enforced by PDS). | `'application/octet-stream'` |

#### Returns {.doc-section .doc-section-returns}

| Name   | Type           | Description                                                          |
|--------|----------------|----------------------------------------------------------------------|
|        | [dict](`dict`) | A blob reference dict with keys: '$type', 'ref', 'mimeType', 'size'. |
|        | [dict](`dict`) | This can be embedded directly in record fields.                      |

#### Raises {.doc-section .doc-section-raises}

| Name   | Type                                                                                                            | Description           |
|--------|-----------------------------------------------------------------------------------------------------------------|-----------------------|
|        | [ValueError](`ValueError`)                                                                                      | If not authenticated. |
|        | [atproto](`atproto`).[exceptions](`atproto.exceptions`).[AtProtocolError](`atproto.exceptions.AtProtocolError`) | If upload fails.      |