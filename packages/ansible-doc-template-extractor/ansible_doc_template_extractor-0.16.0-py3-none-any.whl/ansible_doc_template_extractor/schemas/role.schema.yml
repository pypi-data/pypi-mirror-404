# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
$schema: "https://json-schema.org/draft/2020-12/schema"
title: "JSON schema for extended Ansible role spec files"
description: "Ansible role spec file in extended format"
definitions:
  description:
    description: "A description with a single string or a list of strings."
    oneOf:
      - description: "A single string. Ansible markup can be used."
        type: string
      - description: "A list of strings. Each list item is a new paragraph."
        type: array
        items:
          description: "A single string. Ansible markup can be used."
          type: string
  options:
    description: "Options (i.e. input parameters, local variables, output parameters) for the role entry point."
    type: object
    patternProperties:
      ^[a-zA-Z0-9_]+$:
        description: "Key: The name of the option."
        type: object
        required:
          - description
        additionalProperties: false
        properties:
          description:
            description: "Detailed explanation of the role option. It should be written in full sentences."
            $ref: "#/definitions/description"
          version_added:
            description: "Collection or Ansible version in which the option was added. Only needed if the option was
              added after the initial role/entry point release."
            type: string
          type:
            description: "The Ansible data type of the option. See
              https://docs.ansible.com/projects/ansible/latest/dev_guide/developing_program_flow_modules.html#argument-spec
              for allowed values. The default is 'str'."
            type: string
          required:
            description: "Indicates that the option is required to be specified. Default: false"
            type: boolean
          default:
            description: "Default value for the option if it is not required. Default: null. If the option has a
              boolean type, you should use true/false if you want to be compatible with ansible-lint."
            # The default value can have any Ansible data type
          choices:
            description: "List of valid values for the option."
            type: array
            items:
              description: "A valid value for the option."
              # The array items can have any Ansible data type
          elements:
            description: "The Ansible data type for list elements when the type is list."
            type: string
          options:
            # The structure of the option value when the type is dict.
            $ref: "#/definitions/options"
type: object
required:
  - argument_specs
additionalProperties: false
properties:
  argument_specs:
    description: "The argument specifications for the role"
    type: object
    required:
      - main
    patternProperties:
      ^[a-zA-Z0-9_]+$:
        description: "The argument specification for a single role entry point of the role (e.g. main).
          The property name is the name of the role entry point.
          This should be 'main' in the case of an unspecified entry point.
          This will be the base name of the tasks file to execute, with no .yml or .yaml file extension."
        type: object
        required:
          - short_description
          - description
          - options
        additionalProperties: false
        properties:
          short_description:
            description: "A short, one-line description of the role entry point.
              Ansible markup can be used.
              It should be a phrase and not a sentence, and it should not end in a period."
            type: string
          description:
            description: "A longer description of the role entry point that may contain multiple lines. Ansible markup
              can be used."
            $ref: "#/definitions/description"
          version_added:
            description: "Collection or Ansible version in which the role entry point was added."
            type: string
          author:
            description: "The author(s) of the role. A single author can be specified as a single string or as a list
              of strings with one item."
            oneOf:
              - description: "Full name of the author."
                type: string
              - description: "A list of authors."
                type: array
                items:
                  description: "Full name of the author."
                  type: string
          options:
            description: "The input parameters of the role."
            $ref: "#/definitions/options"
          local:  # Extension on top of standard role spec format
            description: "The local variables set by the role."
            $ref: "#/definitions/options"
          output:  # Extension on top of standard role spec format
            description: "The output parameters of the role."
            $ref: "#/definitions/options"
          examples:  # Extension on top of standard role spec format
            description: "A list of examples"
            type: array
            items:
              description: "An example"
              type: object
              additionalProperties: false
              required:
                - code
              properties:
                short_description:
                  description: "A short, one-line description of the example.
                    Ansible markup can be used.
                    It should be a phrase and not a sentence, and it should not end in a period.
                    Default: 'Example'."
                  type: string
                description:
                  description: "A longer description of the example.
                    May contain multiple paragraphs of multiple lines. Ansible markup can be used.
                    Default: No description."
                  $ref: "#/definitions/description"
                code:
                  description: "Playbook/role code for the example"
                  type: string
