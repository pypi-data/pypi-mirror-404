# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
$schema: "https://json-schema.org/draft/2020-12/schema"
title: "JSON schema for extended Ansible playbook spec files"
description: "Ansible playbook spec file in extended format"
definitions:
  description:
    description: "A description with a single string or a list of strings."
    oneOf:
      - description: "A single string. Ansible markup can be used."
        type: string
      - description: "A list of strings. Each list item is a new paragraph."
        type: array
        items:
          description: "A single string. Ansible markup can be used."
          type: string
  options:
    description: "Options (i.e. input parameters) for the playbook."
    type: object
    patternProperties:
      ^[a-zA-Z0-9_]+$:
        description: "Key: The name of the option."
        type: object
        required:
          - description
        additionalProperties: false
        properties:
          description:
            description: "Detailed explanation of the option. It should be written in full sentences."
            $ref: "#/definitions/description"
          version_added:  # Extension on top of draft Ansible playbook spec format
            description: "Collection or Ansible version in which the option was added. Only needed if the option was
              added after the initial playbok release."
            type: string
          type:
            description: "The Ansible data type of the option. See
              https://docs.ansible.com/projects/ansible/latest/dev_guide/developing_program_flow_modules.html#argument-spec
              for allowed values. The default is 'str'."
            type: string
          required:
            description: "Indicates that the option is required to be specified. Default: false"
            type: boolean
          default:  # Extension on top of draft Ansible playbook spec format
            description: "Default value for the option if it is not required. Default: null. If the option has a
              boolean type, you should use true/false if you want to be compatible with ansible-lint."
            # The default value can have any Ansible data type
          choices:
            description: "List of valid values for the option."
            type: array
            items:
              description: "A valid value for the option."
              # The array items can have any Ansible data type
          elements:
            description: "The Ansible data type for list elements when the type is 'list'."
            type: string
          options:
            # The structure of the option value when the type is dict.
            $ref: "#/definitions/options"
type: object
required:
  - argument_specs
additionalProperties: false
properties:
  argument_specs:
    description: "The argument specifications for the playbook. Only one playbook can be specified"
    type: object
    minProperties: 1
    maxProperties: 1
    patternProperties:
      ^[a-zA-Z0-9_]+$:
        description: "Key: The name of the playbook (just the base name, without namespace and file extension)."
        type: object
        required:
          - short_description
          - description
        additionalProperties: false
        properties:
          short_description:  # Extension on top of draft Ansible playbook spec format
            description: "A short, one-line title of the playbook.
              Ansible markup can be used. It should be a phrase and not a sentence, and it should not end in a period."
            type: string
          description:
            description: "A description of the playbook.
              May contain multiple paragraphs of multiple lines. Ansible markup can be used."
            $ref: "#/definitions/description"
          requirements:  # Extension on top of draft Ansible playbook spec format
            description: "A list of requirements for the playbook."
            type: array
            items:
              description: "A requirement for the playbook.
                May contain multiple paragraphs of multiple lines. Ansible markup can be used."
              $ref: "#/definitions/description"
          version_added:  # Extension on top of draft Ansible playbook spec format
            description: "Collection or Ansible version in which the playbook was added"
            type: string
          author:  # Extension on top of draft Ansible playbook spec format
            description: "The author(s) of the playbook. A single author can be specified as a single string or as a
              list of strings with one item."
            oneOf:
              - description: "Full name of the author."
                type: string
              - description: "A list of authors."
                type: array
                items:
                  description: "Full name of the author."
                  type: string
          options:
            description: "The input parameters of the playbook, in Ansible option format. This is mutually exclusive
              with 'options_schema' and 'options_schema_file'."
            $ref: "#/definitions/options"
          options_schema:  # Extension on top of draft Ansible playbook spec format
            description: "The input parameters of the playbook, in JSON schema format. This is mutually exclusive with
              'options' and 'options_schema_file'."
            $ref: "http://json-schema.org/draft/2020-12/schema"
          options_schema_file:  # Extension on top of draft Ansible playbook spec format
            description: "The path name of a JSON schema file that defines the input parameters of the playbook. The
              path name must be relative to the directory of the playbook spec file. This is mutually exclusive with
              'options' and 'options_schema'."
            type: string
          output:  # Extension on top of draft Ansible playbook spec format
            description: "The output parameters of the playbook, in Ansible option format. This is mutually exclusive
              with 'output_schema' and 'output_schema_file'."
            $ref: "#/definitions/options"
          output_schema:  # Extension on top of draft Ansible playbook spec format
            description: "The output parameters of the playbook, in JSON schema format. This is mutually exclusive
              with 'output' and 'output_schema_file'."
            $ref: "http://json-schema.org/draft/2020-12/schema"
          output_schema_file:  # Extension on top of draft Ansible playbook spec format
            description: "The path name of a JSON schema file that defines the output parameters of the playbook. The
              path name must be relative to the directory of the playbook spec file. This is mutually exclusive with
              'output' and 'output_schema'."
            type: string
          examples:  # Extension on top of draft Ansible playbook spec format
            description: "List of examples for how to use the playbook"
            type: array
            items:
              description: "An example for how to use the playbook"
              type: object
              required:
                - command
              additionalProperties: false
              properties:
                short_description:
                  description: "A short, one-line description of the example.
                    Ansible markup can be used.
                    It should be a phrase and not a sentence, and it should not end in a period. Default: 'Example'."
                  type: string
                description:
                  description: "A longer description of the example.
                    May contain multiple paragraphs of multiple lines. Ansible markup can be used. Default: No description."
                  $ref: "#/definitions/description"
                command:
                  description: "The ansible-playbook command for the example"
                  type: string
