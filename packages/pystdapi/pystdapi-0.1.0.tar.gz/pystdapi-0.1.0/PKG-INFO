Metadata-Version: 2.1
Name: pystdapi
Version: 0.1.0
Summary: çº¯å¼‚æ­¥ Python Web æ¡†æ¶ï¼Œä»…ä¾èµ– Python æ ‡å‡†åº“
Home-page: https://gitee.com/wangweiyong/pystdapi
Author: ç‹ä¼Ÿå‹‡
Author-email: ç‹ä¼Ÿå‹‡ <909094426@qq.com>
License: MIT
Project-URL: Homepage, https://gitee.com/wangweiyong/pystdapi
Project-URL: Documentation, https://gitee.com/wangweiyong/pystdapi#readme
Keywords: asgi,web,framework,async,python,standard-library
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.7
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Topic :: Internet :: WWW/HTTP
Classifier: Topic :: Internet :: WWW/HTTP :: Dynamic Content
Classifier: Topic :: Internet :: WWW/HTTP :: HTTP Servers
Classifier: Topic :: Software Development :: Libraries :: Application Frameworks
Requires-Python: >=3.7
Description-Content-Type: text/markdown
License-File: LICENSE

# PystdAPI - çº¯å¼‚æ­¥ Python Web æ¡†æ¶

[![Python Version](https://img.shields.io/badge/python-3.7+-blue.svg)](https://www.python.org/downloads/)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![ASGI Compatible](https://img.shields.io/badge/ASGI-3.0-ff69b4.svg)](https://asgi.readthedocs.io/)

**PystdAPI** æ˜¯ä¸€ä¸ªåŸºäº ASGI æ ‡å‡†çš„é«˜æ€§èƒ½å¼‚æ­¥ Web æ¡†æ¶ï¼Œä»…ä¾èµ– Python æ ‡å‡†åº“ï¼Œè®¾è®¡ç®€æ´ã€æ˜“äºä½¿ç”¨ä¸”åŠŸèƒ½å¼ºå¤§ã€‚

## âœ¨ ç‰¹æ€§

- ğŸš€ **çº¯å¼‚æ­¥**ï¼šåŸºäº Python asyncioï¼Œæ”¯æŒé«˜å¹¶å‘å¤„ç†
- ğŸ“¦ **é›¶ä¾èµ–**ï¼šä»…ä½¿ç”¨ Python æ ‡å‡†åº“ï¼Œæ— éœ€å®‰è£…é¢å¤–åŒ…
- ğŸ—ï¸ **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ¸…æ™°çš„æ¶æ„ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤
- ğŸ”Œ **æ’ä»¶ç³»ç»Ÿ**ï¼šçµæ´»çš„æ’ä»¶æœºåˆ¶ï¼Œå¯æ‰©å±•æ¡†æ¶åŠŸèƒ½
- ğŸ›¡ï¸ **ä¸­é—´ä»¶æ”¯æŒ**ï¼šå®Œæ•´çš„ä¸­é—´ä»¶ç³»ç»Ÿï¼Œæ”¯æŒè¯·æ±‚/å“åº”å¤„ç†
- ğŸ“ **æ¨¡æ¿å¼•æ“**ï¼šå†…ç½®ç®€å•æ¨¡æ¿ç³»ç»Ÿï¼Œæ”¯æŒå˜é‡æ›¿æ¢ã€æ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯
- ğŸ”§ **å‘½ä»¤è¡Œå·¥å…·**ï¼šæä¾›é¡¹ç›®åˆ›å»ºã€æœåŠ¡å™¨ç®¡ç†ç­‰å‘½ä»¤è¡ŒåŠŸèƒ½
- ğŸ“¡ **ASGI å…¼å®¹**ï¼šå®Œå…¨å…¼å®¹ ASGI 3.0 æ ‡å‡†

## ğŸ“¦ å®‰è£…

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ pipï¼ˆæ¨èï¼‰
```bash
pip install pystdapi
```

### æ–¹å¼äºŒï¼šç›´æ¥ä½¿ç”¨æºç 
```bash
# å…‹éš†æˆ–ä¸‹è½½æºç 
git clone https://gitee.com/wangweiyong/pystdapi.git
cd pystdapi

# å°† pystdapi ç›®å½•å¤åˆ¶åˆ°ä½ çš„é¡¹ç›®ä¸­
cp -r pystdapi /path/to/your/project/
```

æˆ–è€…ç›´æ¥å®‰è£…æœ€æ–°å¼€å‘ç‰ˆï¼š
```bash
pip install git+https://gitee.com/wangweiyong/pystdapi.git
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºç¡€ç¤ºä¾‹

åˆ›å»ºä¸€ä¸ªç®€å•çš„ Web åº”ç”¨ï¼š

```python
#!/usr/bin/env python3
from pystdapi import PystdAPI

app = PystdAPI(name="myapp", debug=True)

@app.get("/")
async def index(request):
    return {"message": "Hello, PystdAPI!"}

@app.get("/hello/<name>")
async def hello(request, name):
    return {"message": f"Hello, {name}!"}

@app.post("/api/data")
async def create_data(request):
    data = await request.json()
    return {"received": data, "status": "created"}

if __name__ == "__main__":
    app.run(host="127.0.0.1", port=8000)
```

### è¿è¡Œåº”ç”¨
```bash
python app.py
```

è®¿é—® http://127.0.0.1:8000 æŸ¥çœ‹åº”ç”¨ã€‚

## ğŸ“š æ ¸å¿ƒæ¦‚å¿µ

### 1. åº”ç”¨å¯¹è±¡

```python
from pystdapi import PystdAPI, create_app

# åˆ›å»ºåº”ç”¨å®ä¾‹
app = PystdAPI(name="myapp", debug=True)

# æˆ–è€…ä½¿ç”¨å¿«æ·å‡½æ•°
app = create_app(name="myapp", debug=True)
```

### 2. è·¯ç”±ç³»ç»Ÿ

æ”¯æŒå¤šç§ HTTP æ–¹æ³•å’Œè·¯ç”±å‚æ•°ï¼š

```python
# åŸºæœ¬è·¯ç”±
@app.get("/")
async def index(request):
    return "é¦–é¡µ"

@app.post("/users")
async def create_user(request):
    data = await request.json()
    return {"id": 1, **data}

# è·¯ç”±å‚æ•°
@app.get("/users/<user_id:int>")
async def get_user(request, user_id):
    return {"id": user_id, "name": "Alice"}

@app.get("/files/<path:filepath>")
async def get_file(request, filepath):
    return {"file": filepath}

# è·¯ç”±è£…é¥°å™¨å¿«æ·æ–¹å¼
@app.route("/about", method="GET")
async def about(request):
    return "å…³äºæˆ‘ä»¬"
```

### 3. è¯·æ±‚å¯¹è±¡

```python
@app.post("/api/submit")
async def submit(request):
    # è·å–è¯·æ±‚ä¿¡æ¯
    method = request.method
    path = request.path
    headers = request.headers
    
    # è·å–è¯·æ±‚ä½“
    body = await request.body()      # åŸå§‹å­—èŠ‚
    text = await request.text()      # æ–‡æœ¬
    json_data = await request.json() # JSON æ•°æ®
    form_data = await request.form() # è¡¨å•æ•°æ®
    
    # è·å–æŸ¥è¯¢å‚æ•°
    query_param = request.query.get("page", ["1"])[0]
    
    # è·å– Cookie
    session_id = request.get_cookie("session_id")
    
    return {"method": method, "path": path}
```

### 4. å“åº”å¯¹è±¡

```python
from pystdapi import Response, text_response, json_response, html_response, redirect_response

@app.get("/responses")
async def responses(request):
    # è¿”å›æ–‡æœ¬å“åº”
    return "Hello World"
    
    # è¿”å› JSON å“åº”
    return {"status": "ok", "data": [1, 2, 3]}
    
    # è¿”å› HTML å“åº”
    return "<h1>Hello</h1>"
    
    # è¿”å›è‡ªå®šä¹‰å“åº”
    return Response("Custom", status=201, headers={"X-Custom": "value"})
    
    # ä½¿ç”¨å¿«æ·å‡½æ•°
    return text_response("Text response")
    return json_response({"key": "value"})
    return html_response("<h1>HTML</h1>")
    return redirect_response("/new-location")
```

### 5. ä¸­é—´ä»¶

```python
from pystdapi.middleware import (
    cors_middleware, 
    logging_middleware, 
    error_middleware,
    static_files_middleware
)

# æ·»åŠ  CORS ä¸­é—´ä»¶
app.add_middleware(cors_middleware(
    allow_origins=["*"],
    allow_methods=["GET", "POST", "PUT", "DELETE"],
    allow_headers=["*"]
))

# æ·»åŠ æ—¥å¿—ä¸­é—´ä»¶
app.add_middleware(logging_middleware(format="verbose"))

# æ·»åŠ é”™è¯¯å¤„ç†ä¸­é—´ä»¶
app.add_middleware(error_middleware(debug=True))

# æ·»åŠ é™æ€æ–‡ä»¶ä¸­é—´ä»¶
app.add_middleware(static_files_middleware(
    directory="./static",
    url_prefix="/static"
))

# è‡ªå®šä¹‰ä¸­é—´ä»¶
async def custom_middleware(app):
    async def middleware(scope, receive, send):
        # è¯·æ±‚å‰å¤„ç†
        print(f"Request: {scope.get('method')} {scope.get('path')}")
        
        # è°ƒç”¨ä¸‹ä¸€ä¸ªä¸­é—´ä»¶æˆ–åº”ç”¨
        await app(scope, receive, send)
        
        # è¯·æ±‚åå¤„ç†
        print("Request completed")
    return middleware

app.add_middleware(custom_middleware)
```

### 6. æ’ä»¶ç³»ç»Ÿ

```python
from pystdapi.plugins import (
    json_plugin, 
    template_plugin, 
    session_plugin,
    auth_plugin,
    cors_plugin
)

# æ·»åŠ  JSON æ’ä»¶ï¼ˆè‡ªåŠ¨è§£æ JSON è¯·æ±‚/å“åº”ï¼‰
app.add_plugin(json_plugin())

# æ·»åŠ æ¨¡æ¿æ’ä»¶
from pystdapi.templates import SimpleTemplate
app.add_plugin(template_plugin(
    template_adapter=SimpleTemplate,
    search_path="./templates",
    cache=True
))

# ä½¿ç”¨æ¨¡æ¿
@app.get("/template")
async def template_demo(request):
    return {
        "template": "index.html",
        "title": "é¡µé¢æ ‡é¢˜",
        "users": ["Alice", "Bob", "Charlie"]
    }
```

### 7. é’©å­å‡½æ•°

```python
# è¯·æ±‚å‰é’©å­
@app.hook("before_request")
async def before_request_hook(request):
    request.start_time = time.time()
    print(f"å¼€å§‹å¤„ç†è¯·æ±‚: {request.method} {request.path}")

# è¯·æ±‚åé’©å­
@app.hook("after_request")
async def after_request_hook(request):
    duration = time.time() - request.start_time
    print(f"è¯·æ±‚å¤„ç†å®Œæˆï¼Œè€—æ—¶: {duration:.3f}s")

# å“åº”å‰é’©å­
@app.hook("before_response")
async def before_response_hook(request, response):
    response.set_header("X-Response-Time", str(time.time() - request.start_time))

# å“åº”åé’©å­
@app.hook("after_response")
async def after_response_hook(request, response):
    print(f"å“åº”å·²å‘é€: {response.status}")
```

### 8. é”™è¯¯å¤„ç†

```python
# è‡ªå®šä¹‰é”™è¯¯å¤„ç†å™¨
@app.error_handler(404)
async def not_found_handler(error, request):
    return {"error": "é¡µé¢æœªæ‰¾åˆ°", "path": request.path}, 404

@app.error_handler(500)
async def server_error_handler(error, request):
    return {"error": "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯"}, 500

# æŠ›å‡º HTTP é”™è¯¯
from pystdapi.exceptions import HTTPError

@app.get("/protected")
async def protected(request):
    if not request.get_header("Authorization"):
        raise HTTPError(401, "éœ€è¦è®¤è¯")
    return {"message": "è®¿é—®æˆåŠŸ"}
```

## ğŸ› ï¸ å‘½ä»¤è¡Œå·¥å…·

PystdAPI æä¾›äº†å‘½ä»¤è¡Œå·¥å…·æ¥ç®€åŒ–å¼€å‘æµç¨‹ï¼š

```bash
# åˆ›å»ºæ–°é¡¹ç›®
pystdapi new myproject
pystdapi new myapi --template api
pystdapi new myfull --template full

# è¿è¡Œå¼€å‘æœåŠ¡å™¨
pystdapi run
pystdapi run --port 8080 --debug --reload

# æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
pystdapi version
```

### é¡¹ç›®æ¨¡æ¿

- **basic**: åŸºç¡€é¡¹ç›®æ¨¡æ¿
- **api**: API é¡¹ç›®æ¨¡æ¿ï¼ˆåŒ…å« RESTful API ç¤ºä¾‹ï¼‰
- **full**: å®Œæ•´é¡¹ç›®æ¨¡æ¿ï¼ˆåŒ…å«æ¨¡æ¿ã€é™æ€æ–‡ä»¶ç­‰ï¼‰

## ğŸ“ é¡¹ç›®ç»“æ„

ä¸€ä¸ªå…¸å‹çš„ PystdAPI é¡¹ç›®ç»“æ„ï¼š

```
myproject/
â”œâ”€â”€ app.py              # ä¸»åº”ç”¨æ–‡ä»¶
â”œâ”€â”€ requirements.txt    # ä¾èµ–æ–‡ä»¶
â”œâ”€â”€ README.md          # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ api/               # API æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ users.py      # ç”¨æˆ· API
â”œâ”€â”€ templates/         # æ¨¡æ¿ç›®å½•
â”‚   â”œâ”€â”€ base.html
â”‚   â””â”€â”€ index.html
â””â”€â”€ static/           # é™æ€æ–‡ä»¶
    â”œâ”€â”€ css/
    â”‚   â””â”€â”€ style.css
    â””â”€â”€ js/
        â””â”€â”€ app.js
```

## ğŸ”Œ æ’ä»¶å¼€å‘

åˆ›å»ºè‡ªå®šä¹‰æ’ä»¶ï¼š

```python
from pystdapi.plugins import Plugin

class MyPlugin(Plugin):
    name = 'myplugin'
    
    def __init__(self, **kwargs):
        super().__init__(**kwargs)
        self.config = kwargs
    
    def setup(self, app):
        """æ’ä»¶åˆå§‹åŒ–"""
        app.myplugin_config = self.config
    
    def apply(self, callback, route):
        """åº”ç”¨åˆ°è·¯ç”±"""
        def wrapper(request, *args, **kwargs):
            # æ’ä»¶é€»è¾‘
            request.plugin_data = "æ¥è‡ªæ’ä»¶çš„æ•°æ®"
            return callback(request, *args, **kwargs)
        return wrapper

# ä½¿ç”¨æ’ä»¶
app.add_plugin(MyPlugin(key="value"))
```

## ğŸ§ª æµ‹è¯•

### å•å…ƒæµ‹è¯•ç¤ºä¾‹

ç”±äº PystdAPI æ˜¯ä¸€ä¸ª ASGI åº”ç”¨ï¼Œä½ å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ ASGI æµ‹è¯•å·¥å…·è¿›è¡Œæµ‹è¯•ï¼š

```python
import pytest
from pystdapi import PystdAPI
import asyncio

app = PystdAPI()

@app.get("/test")
async def test_endpoint(request):
    return {"status": "ok"}

# ä½¿ç”¨ asyncio æµ‹è¯•
async def test_app():
    # æ¨¡æ‹Ÿ ASGI è¯·æ±‚
    scope = {
        "type": "http",
        "method": "GET",
        "path": "/test",
        "headers": [],
    }
    
    # æ”¶é›†å“åº”
    responses = []
    
    async def receive():
        return {"type": "http.request", "body": b"", "more_body": False}
    
    async def send(message):
        responses.append(message)
    
    # è°ƒç”¨åº”ç”¨
    await app(scope, receive, send)
    
    # éªŒè¯å“åº”
    assert len(responses) == 2  # response.start å’Œ response.body
    assert responses[0]["type"] == "http.response.start"
    assert responses[0]["status"] == 200
    assert responses[1]["type"] == "http.response.body"

# è¿è¡Œæµ‹è¯•
def test_sync():
    asyncio.run(test_app())

# æˆ–è€…ä½¿ç”¨ pytest-asyncio
@pytest.mark.asyncio
async def test_with_pytest():
    await test_app()
```

### ä½¿ç”¨ç¬¬ä¸‰æ–¹æµ‹è¯•åº“

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹ ASGI æµ‹è¯•åº“ï¼š

```python
# å®‰è£…: pip install httpx
import httpx
import asyncio
from pystdapi import PystdAPI

app = PystdAPI()

@app.get("/api/test")
async def api_test(request):
    return {"status": "ok", "data": [1, 2, 3]}

async def test_with_httpx():
    # å¯åŠ¨æµ‹è¯•æœåŠ¡å™¨
    import uvicorn
    from uvicorn.config import Config
    from uvicorn.server import Server
    
    config = Config(app=app, host="127.0.0.1", port=8888, log_level="error")
    server = Server(config=config)
    
    # åœ¨åå°å¯åŠ¨æœåŠ¡å™¨
    server_task = asyncio.create_task(server.serve())
    await asyncio.sleep(0.5)  # ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨
    
    try:
        # ä½¿ç”¨ httpx æµ‹è¯•
        async with httpx.AsyncClient(base_url="http://127.0.0.1:8888") as client:
            response = await client.get("/api/test")
            assert response.status_code == 200
            assert response.json() == {"status": "ok", "data": [1, 2, 3]}
    finally:
        # åœæ­¢æœåŠ¡å™¨
        server.should_exit = True
        await server_task
```

## ğŸ“– API å‚è€ƒ

### ä¸»è¦ç±»å’Œæ–¹æ³•

#### PystdAPI ç±»
- `__init__(name="pystdapi", debug=False)`: åˆå§‹åŒ–åº”ç”¨
- `route(rule, method="GET", **options)`: è·¯ç”±è£…é¥°å™¨
- `get(rule, **options)`: GET è·¯ç”±è£…é¥°å™¨
- `post(rule, **options)`: POST è·¯ç”±è£…é¥°å™¨
- `put(rule, **options)`: PUT è·¯ç”±è£…é¥°å™¨
- `delete(rule, **options)`: DELETE è·¯ç”±è£…é¥°å™¨
- `patch(rule, **options)`: PATCH è·¯ç”±è£…é¥°å™¨
- `add_middleware(middleware)`: æ·»åŠ ä¸­é—´ä»¶
- `add_plugin(plugin)`: æ·»åŠ æ’ä»¶
- `hook(name)`: é’©å­è£…é¥°å™¨
- `error_handler(code)`: é”™è¯¯å¤„ç†è£…é¥°å™¨
- `run(host="127.0.0.1", port=8000, **options)`: è¿è¡ŒæœåŠ¡å™¨
- `url_for(route_name, **kwargs)`: æ„å»º URL

#### Request ç±»
- `method`: HTTP æ–¹æ³•
- `path`: è¯·æ±‚è·¯å¾„
- `headers`: è¯·æ±‚å¤´
- `query`: æŸ¥è¯¢å‚æ•°
- `body()`: è·å–è¯·æ±‚ä½“ï¼ˆå¼‚æ­¥ï¼‰
- `text()`: è·å–è¯·æ±‚ä½“æ–‡æœ¬ï¼ˆå¼‚æ­¥ï¼‰
- `json()`: è·å– JSON æ•°æ®ï¼ˆå¼‚æ­¥ï¼‰
- `form()`: è·å–è¡¨å•æ•°æ®ï¼ˆå¼‚æ­¥ï¼‰
- `get_header(name, default=None)`: è·å–è¯·æ±‚å¤´
- `get_cookie(name, default=None)`: è·å– Cookie

#### Response ç±»
- `__init__(body="", status=200, headers=None, **kwargs)`: åˆå§‹åŒ–å“åº”
- `text(text, status=200, **kwargs)`: åˆ›å»ºæ–‡æœ¬å“åº”ï¼ˆç±»æ–¹æ³•ï¼‰
- `html(html, status=200, **kwargs)`: åˆ›å»º HTML å“åº”ï¼ˆç±»æ–¹æ³•ï¼‰
- `json(data, status=200, **kwargs)`: åˆ›å»º JSON å“åº”ï¼ˆç±»æ–¹æ³•ï¼‰
- `redirect(url, status=302)`: åˆ›å»ºé‡å®šå‘å“åº”ï¼ˆç±»æ–¹æ³•ï¼‰
- `set_header(name, value)`: è®¾ç½®å“åº”å¤´
- `set_cookie(key, value, **options)`: è®¾ç½® Cookie
- `delete_cookie(key, **options)`: åˆ é™¤ Cookie

## ğŸš€ éƒ¨ç½²

### ä½¿ç”¨ Uvicorn

```bash
# å®‰è£… ASGI æœåŠ¡å™¨
pip install uvicorn

# è¿è¡Œåº”ç”¨
uvicorn app:app --host 0.0.0.0 --port 8000 --workers 4
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. åˆ›å»º Pull Request

**PystdAPI** - è®©å¼‚æ­¥ Web å¼€å‘æ›´ç®€å•ï¼ ğŸš€
