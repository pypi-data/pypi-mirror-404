(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,62259,e=>{e.v({botListContainer:"botConfig-module__Pe74uq__botListContainer"})},13706,e=>{e.v({basicInfoAdapterContainer:"botCard-module__MqKp4q__basicInfoAdapterContainer",basicInfoAdapterIcon:"botCard-module__MqKp4q__basicInfoAdapterIcon",basicInfoAdapterLabel:"botCard-module__MqKp4q__basicInfoAdapterLabel",basicInfoContainer:"botCard-module__MqKp4q__basicInfoContainer",basicInfoDescription:"botCard-module__MqKp4q__basicInfoDescription",basicInfoName:"botCard-module__MqKp4q__basicInfoName",basicInfoNameContainer:"botCard-module__MqKp4q__basicInfoNameContainer",basicInfoPipelineContainer:"botCard-module__MqKp4q__basicInfoPipelineContainer",basicInfoPipelineIcon:"botCard-module__MqKp4q__basicInfoPipelineIcon",basicInfoPipelineLabel:"botCard-module__MqKp4q__basicInfoPipelineLabel",bigText:"botCard-module__MqKp4q__bigText",botOperationContainer:"botCard-module__MqKp4q__botOperationContainer",cardContainer:"botCard-module__MqKp4q__cardContainer",iconBasicInfoContainer:"botCard-module__MqKp4q__iconBasicInfoContainer",iconImage:"botCard-module__MqKp4q__iconImage"})},58430,e=>{e.v({botLogCardContainer:"botLog-module__EHYw8W__botLogCardContainer",botLogListContainer:"botLog-module__EHYw8W__botLogListContainer",cardText:"botLog-module__EHYw8W__cardText",cardTitleContainer:"botLog-module__EHYw8W__cardTitleContainer",chatId:"botLog-module__EHYw8W__chatId",chatTag:"botLog-module__EHYw8W__chatTag",listHeader:"botLog-module__EHYw8W__listHeader",tag:"botLog-module__EHYw8W__tag",timestamp:"botLog-module__EHYw8W__timestamp"})},96786,e=>{"use strict";var t=e.i(40320),n=e.i(98255),a=e.i(62259);class i{id;iconURL;name;description;adapter;adapterLabel;adapterConfig;usePipelineName;enable;constructor(e){this.id=e.id,this.iconURL=e.iconURL,this.name=e.name,this.description=e.description,this.adapter=e.adapter,this.adapterConfig=e.adapterConfig,this.adapterLabel=e.adapterLabel,this.usePipelineName=e.usePipelineName,this.enable=e.enable}}var o=e.i(13706);e.i(37773);var r=e.i(28924),s=e.i(99375);e.i(94145);var l=e.i(44737),c=e.i(11939);function d({botCardVO:e,setBotEnableCallback:n}){let{t:a}=(0,l.useTranslation)();return(0,t.jsx)("div",{className:`${o.default.cardContainer}`,children:(0,t.jsxs)("div",{className:`${o.default.iconBasicInfoContainer}`,children:[(0,t.jsx)("img",{className:`${o.default.iconImage}`,src:e.iconURL,alt:"icon"}),(0,t.jsxs)("div",{className:`${o.default.basicInfoContainer}`,children:[(0,t.jsxs)("div",{className:`${o.default.basicInfoNameContainer}`,children:[(0,t.jsx)("div",{className:`${o.default.basicInfoName}`,children:e.name}),(0,t.jsx)("div",{className:`${o.default.basicInfoDescription}`,children:e.description})]}),(0,t.jsxs)("div",{className:`${o.default.basicInfoAdapterContainer}`,children:[(0,t.jsx)("svg",{className:`${o.default.basicInfoAdapterIcon}`,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,t.jsx)("path",{d:"M2 8.99374C2 5.68349 4.67654 3 8.00066 3H15.9993C19.3134 3 22 5.69478 22 8.99374V21H8.00066C4.68659 21 2 18.3052 2 15.0063V8.99374ZM20 19V8.99374C20 6.79539 18.2049 5 15.9993 5H8.00066C5.78458 5 4 6.78458 4 8.99374V15.0063C4 17.2046 5.79512 19 8.00066 19H20ZM14 11H16V13H14V11ZM8 11H10V13H8V11Z"})}),(0,t.jsx)("span",{className:`${o.default.basicInfoAdapterLabel}`,children:e.adapterLabel})]}),(0,t.jsxs)("div",{className:`${o.default.basicInfoPipelineContainer}`,children:[(0,t.jsx)("svg",{className:`${o.default.basicInfoPipelineIcon}`,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,t.jsx)("path",{d:"M6 21.5C4.067 21.5 2.5 19.933 2.5 18C2.5 16.067 4.067 14.5 6 14.5C7.5852 14.5 8.92427 15.5539 9.35481 16.9992L15 16.9994V15L17 14.9994V9.24339L14.757 6.99938H9V9.00003H3V3.00003H9V4.99939H14.757L18 1.75739L22.2426 6.00003L19 9.24139V14.9994L21 15V21H15V18.9994L9.35499 19.0003C8.92464 20.4459 7.58543 21.5 6 21.5ZM6 16.5C5.17157 16.5 4.5 17.1716 4.5 18C4.5 18.8285 5.17157 19.5 6 19.5C6.82843 19.5 7.5 18.8285 7.5 18C7.5 17.1716 6.82843 16.5 6 16.5ZM19 17H17V19H19V17ZM18 4.58581L16.5858 6.00003L18 7.41424L19.4142 6.00003L18 4.58581ZM7 5.00003H5V7.00003H7V5.00003Z"})}),(0,t.jsx)("span",{className:`${o.default.basicInfoPipelineLabel}`,children:e.usePipelineName})]})]}),(0,t.jsx)("div",{className:`${o.default.botOperationContainer}`,children:(0,t.jsx)(s.Switch,{checked:e.enable,onCheckedChange:t=>{r.httpClient.updateBot(e.id,{name:e.name,description:e.description,adapter:e.adapter,adapter_config:e.adapterConfig,enable:t}).then(()=>{n(e.id,t)}).catch(e=>{console.error(e),c.toast.error(a("bots.setBotEnableError"))})},onClick:e=>{e.stopPropagation()}})})]})})}var u=e.i(10839),m=e.i(19159),h=e.i(76639),f=e.i(30909),p=e.i(19455),g=e.i(268),v=e.i(1017),x=e.i(98787),b=e.i(37683),C=e.i(11472),j=e.i(32356),_=e.i(38929),w=e.i(59874),y=e.i(3133),N=e.i(93479),k=e.i(67489);function I({initBotId:e,onFormSubmit:a,onBotDeleted:i,onNewBotCreated:o}){let{t:d}=(0,l.useTranslation)(),u=j.z.object({name:j.z.string().min(1,{message:d("bots.botNameRequired")}),description:j.z.string().min(1,{message:d("bots.botDescriptionRequired")}),adapter:j.z.string().min(1,{message:d("bots.adapterRequired")}),adapter_config:j.z.record(j.z.string(),j.z.any()),enable:j.z.boolean().optional(),use_pipeline_uuid:j.z.string().optional()}),f=(0,C.useForm)({resolver:(0,b.zodResolver)(u),defaultValues:{name:"",description:d("bots.defaultDescription"),adapter:"",adapter_config:{},enable:!0,use_pipeline_uuid:""}}),[I,S]=(0,n.useState)(!1),[L,E]=(0,n.useState)(new Map),[M,V]=(0,n.useState)(!1),[P,H]=(0,n.useState)([]),[F,D]=(0,n.useState)({}),[R,T]=(0,n.useState)({}),[B,A]=(0,n.useState)([]),[Y,q]=(0,n.useState)([]),[W,$]=(0,n.useState)([]),[,X]=(0,n.useState)(!1),[O,z]=(0,n.useState)(""),Z=n.default.useRef(null),[K,U]=(0,n.useState)(!1),G=f.watch("adapter"),J=f.watch("adapter_config");function Q(){ee().then(()=>{e?et(e).then(e=>{f.setValue("name",e.name),f.setValue("description",e.description),f.setValue("adapter",e.adapter),f.setValue("adapter_config",e.adapter_config),f.setValue("enable",e.enable),f.setValue("use_pipeline_uuid",e.use_pipeline_uuid||""),en(e.adapter),e.webhook_full_url?z(e.webhook_full_url):z("")}).catch(e=>{c.toast.error(d("bots.getBotConfigError")+e.msg)}):(f.reset(),z(""))})}async function ee(){A((await r.httpClient.getPipelines()).pipelines.map(e=>({label:e.name,value:e.uuid??""})));let e=await r.httpClient.getAdapters();H(e.adapters.map(e=>({label:(0,m.extractI18nObject)(e.label),value:e.name}))),D(e.adapters.reduce((e,t)=>(e[t.name]=r.httpClient.getAdapterIconURL(t.name),e),{})),T(e.adapters.reduce((e,t)=>(e[t.name]=(0,m.extractI18nObject)(t.description),e),{})),e.adapters.forEach(e=>{L.set(e.name,e.spec.config.map(e=>new g.DynamicFormItemConfig({default:e.default,id:v.UUID.generate(),label:e.label,description:e.description,name:e.name,required:e.required,type:(0,g.parseDynamicFormItemType)(e.type),options:e.options})))}),E(L)}async function et(e){return new Promise((t,n)=>{r.httpClient.getBot(e).then(e=>{let n=e.bot;t({adapter:n.adapter,description:n.description,name:n.name,adapter_config:n.adapter_config,enable:n.enable??!0,use_pipeline_uuid:n.use_pipeline_uuid??"",webhook_full_url:n.adapter_runtime_values?n.adapter_runtime_values.webhook_full_url:void 0})}).catch(e=>{n(e)})})}function en(t){if(t){let n=L.get(t);n&&(q(n),e||f.setValue("adapter_config",(0,g.getDefaultValues)(n))),V(!0)}else V(!1)}return(0,n.useEffect)(()=>{Q()},[]),(0,n.useEffect)(()=>{"lark"===G&&!1===J?.["enable-webhook"]?$(Y.filter(e=>"encrypt-key"!==e.name)):$(Y)},[G,J,Y]),(0,t.jsxs)("div",{children:[(0,t.jsx)(h.Dialog,{open:I,onOpenChange:S,children:(0,t.jsxs)(h.DialogContent,{children:[(0,t.jsx)(h.DialogHeader,{children:(0,t.jsx)(h.DialogTitle,{children:d("common.confirmDelete")})}),(0,t.jsx)(h.DialogDescription,{children:d("bots.deleteConfirmation")}),(0,t.jsxs)(h.DialogFooter,{children:[(0,t.jsx)(p.Button,{variant:"outline",onClick:()=>S(!1),children:"å–æ¶ˆ"}),(0,t.jsx)(p.Button,{variant:"destructive",onClick:()=>{e&&r.httpClient.deleteBot(e).then(()=>{i(),c.toast.success(d("bots.deleteSuccess"))}).catch(e=>{c.toast.error(d("bots.deleteError")+e.msg)}),S(!1)},children:d("common.confirmDelete")})]})]})}),(0,t.jsx)(y.Form,{...f,children:(0,t.jsx)("form",{id:"bot-form",onSubmit:f.handleSubmit(function(){if(X(!0),e){let t={uuid:e,name:f.getValues().name,description:f.getValues().description,adapter:f.getValues().adapter,adapter_config:f.getValues().adapter_config,enable:f.getValues().enable,use_pipeline_uuid:f.getValues().use_pipeline_uuid};r.httpClient.updateBot(e,t).then(()=>{a(f.getValues()),c.toast.success(d("bots.saveSuccess"))}).catch(e=>{c.toast.error(d("bots.saveError")+e.msg)}).finally(()=>{X(!1)})}else{let t={name:f.getValues().name,description:f.getValues().description,adapter:f.getValues().adapter,adapter_config:f.getValues().adapter_config};r.httpClient.createBot(t).then(t=>{c.toast.success(d("bots.createSuccess")),e=t.uuid,Q(),o(t.uuid)}).catch(e=>{c.toast.error(d("bots.createError")+e.msg)}).finally(()=>{X(!1),f.reset()})}}),className:"space-y-8",children:(0,t.jsxs)("div",{className:"space-y-4",children:[e&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-6",children:[(0,t.jsx)(y.FormField,{control:f.control,name:"enable",render:({field:e})=>(0,t.jsxs)(y.FormItem,{className:"flex flex-col justify-start gap-[0.8rem] h-[3.8rem]",children:[(0,t.jsx)(y.FormLabel,{children:d("common.enable")}),(0,t.jsx)(y.FormControl,{children:(0,t.jsx)(s.Switch,{checked:e.value,onCheckedChange:e.onChange})})]})}),(0,t.jsx)(y.FormField,{control:f.control,name:"use_pipeline_uuid",render:({field:e})=>(0,t.jsxs)(y.FormItem,{className:"flex flex-col justify-start gap-[0.8rem] h-[3.8rem]",children:[(0,t.jsx)(y.FormLabel,{children:d("bots.bindPipeline")}),(0,t.jsx)(y.FormControl,{children:(0,t.jsxs)(k.Select,{onValueChange:e.onChange,...e,children:[(0,t.jsx)(k.SelectTrigger,{className:"bg-[#ffffff] dark:bg-[#2a2a2e]",children:(0,t.jsx)(k.SelectValue,{placeholder:d("bots.selectPipeline")})}),(0,t.jsx)(k.SelectContent,{className:"fixed z-[1000]",children:(0,t.jsx)(k.SelectGroup,{children:B.map(e=>(0,t.jsx)(k.SelectItem,{value:e.value,children:e.label},e.value))})})]})})]})})]}),O&&("lark"!==G||J?.["enable-webhook"]!==!1)&&(0,t.jsxs)(y.FormItem,{children:[(0,t.jsx)(y.FormLabel,{children:d("bots.webhookUrl")}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(N.Input,{ref:Z,value:O,readOnly:!0,className:"flex-1 bg-gray-50 dark:bg-gray-900",onClick:e=>{e.target.select()}}),(0,t.jsxs)(p.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{console.log("[Copy] Attempting to copy from input element");let e=Z.current;if(!e)return void console.error("[Copy] Input element not found");try{if(e.disabled=!1,e.readOnly=!1,e.focus(),e.select(),navigator.clipboard&&navigator.clipboard.writeText)console.log("[Copy] Using Clipboard API with input value:",e.value),navigator.clipboard.writeText(e.value).then(()=>{console.log("[Copy] Clipboard API success"),e.blur(),e.readOnly=!0,U(!0),setTimeout(()=>U(!1),2e3)}).catch(t=>{console.error("[Copy] Clipboard API failed, trying execCommand:",t);let n=document.execCommand("copy");console.log("[Copy] execCommand result:",n),e.blur(),e.readOnly=!0,n&&(U(!0),setTimeout(()=>U(!1),2e3))});else{console.log("[Copy] Using execCommand with input value:",e.value);let t=document.execCommand("copy");console.log("[Copy] execCommand result:",t),e.blur(),e.readOnly=!0,t&&(U(!0),setTimeout(()=>U(!1),2e3))}}catch(t){console.error("[Copy] Copy failed:",t),e.readOnly=!0}},children:[K?(0,t.jsx)(w.Check,{className:"h-4 w-4 text-green-600 mr-2"}):(0,t.jsx)(_.Copy,{className:"h-4 w-4 mr-2"}),d("common.copy")]})]}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:d("bots.webhookUrlHint")})]})]}),(0,t.jsx)(y.FormField,{control:f.control,name:"name",render:({field:e})=>(0,t.jsxs)(y.FormItem,{children:[(0,t.jsxs)(y.FormLabel,{children:[d("bots.botName"),(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)(y.FormControl,{children:(0,t.jsx)(N.Input,{...e})}),(0,t.jsx)(y.FormMessage,{})]})}),(0,t.jsx)(y.FormField,{control:f.control,name:"description",render:({field:e})=>(0,t.jsxs)(y.FormItem,{children:[(0,t.jsxs)(y.FormLabel,{children:[d("bots.botDescription"),(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)(y.FormControl,{children:(0,t.jsx)(N.Input,{...e})}),(0,t.jsx)(y.FormMessage,{})]})}),(0,t.jsx)(y.FormField,{control:f.control,name:"adapter",render:({field:e})=>(0,t.jsxs)(y.FormItem,{children:[(0,t.jsxs)(y.FormLabel,{children:[d("bots.platformAdapter"),(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)(y.FormControl,{children:(0,t.jsx)("div",{className:"relative",children:(0,t.jsxs)(k.Select,{onValueChange:t=>{e.onChange(t),en(t)},value:e.value,children:[(0,t.jsx)(k.SelectTrigger,{className:"w-[180px] bg-[#ffffff] dark:bg-[#2a2a2e]",children:(0,t.jsx)(k.SelectValue,{placeholder:d("bots.selectAdapter")})}),(0,t.jsx)(k.SelectContent,{className:"fixed z-[1000]",children:(0,t.jsx)(k.SelectGroup,{children:P.map(e=>(0,t.jsx)(k.SelectItem,{value:e.value,children:e.label},e.value))})})]})})}),(0,t.jsx)(y.FormMessage,{})]})}),f.watch("adapter")&&(0,t.jsxs)("div",{className:"flex items-start gap-3 p-4 rounded-lg border",children:[(0,t.jsx)("img",{src:F[f.watch("adapter")],alt:"adapter icon",className:"w-12 h-12 rounded-[8%]"}),(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("div",{className:"font-medium",children:P.find(e=>e.value===f.watch("adapter"))?.label}),(0,t.jsx)("div",{className:"text-sm text-gray-500",children:R[f.watch("adapter")]})]})]}),M&&W.length>0&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"text-lg font-medium",children:d("bots.adapterConfig")}),(0,t.jsx)(x.default,{itemConfigList:W,initialValues:f.watch("adapter_config"),onSubmit:e=>{f.setValue("adapter_config",e)}})]})]})})})]})}class S{botId;callbacks=[];intervalIds=[];constructor(e){this.botId=e}startListenServerPush(){let e=setInterval(()=>{this.getLogList(-1,50).then(e=>{this.callbacks.forEach(t=>t(this.parseResponse(e)))})},3e3);this.intervalIds.push(Number(e))}stopServerPush(){this.intervalIds.forEach(e=>clearInterval(e)),this.intervalIds=[]}subscribeLogPush(e){this.callbacks.includes(e)||this.callbacks.push(e)}dispose(){this.callbacks=[]}getLogList(e,t=20){return r.httpClient.getBotLogs(this.botId,{from_index:e,max_count:t})}async loadFirstPage(){return this.parseResponse(await this.getLogList(-1,10))}async loadMore(e,t){return this.parseResponse(await this.getLogList(e,t))}parseResponse(e){return e.logs}}var L=e.i(58430),E=e.i(79702);function M(){return(M=Object.assign.bind()).apply(null,arguments)}function V(e,t){if(null==e)return{};var n={};for(var a in e)if(({}).hasOwnProperty.call(e,a)){if(t.includes(a))continue;n[a]=e[a]}return n}function P(e){var t=(0,n.useRef)({fn:e,curr:void 0}).current;if(t.fn=e,!t.curr){var a=Object.create(null);Object.keys(e).forEach(function(e){a[e]=function(){var n;return(n=t.fn[e]).call.apply(n,[t.fn].concat([].slice.call(arguments)))}}),t.curr=a}return t.curr}function H(e){return(0,n.useReducer)(function(e,t){return M({},e,"function"==typeof t?t(e):t)},e)}var F=(0,n.createContext)(void 0),D="cubic-bezier(0.25, 0.8, 0.25, 1)",R="u">typeof window&&"ontouchstart"in window,T=function(e,t,n){return Math.max(Math.min(e,n),t)},B=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=0),T(e,+(1-n),Math.max(6,t)*(1+n))},A="u"<typeof window||/ServerSideRendering/.test(navigator&&navigator.userAgent)?n.useEffect:n.useLayoutEffect;function Y(e,t,a){var i=(0,n.useRef)(t);i.current=t,(0,n.useEffect)(function(){function t(e){i.current(e)}return e&&window.addEventListener(e,t,a),function(){e&&window.removeEventListener(e,t)}},[e])}var q=["container"];function W(e){var t=e.container,a=void 0===t?document.body:t,i=V(e,q);return(0,E.createPortal)(n.default.createElement("div",M({},i)),a)}function $(e){return n.default.createElement("svg",M({width:"44",height:"44",viewBox:"0 0 768 768"},e),n.default.createElement("path",{d:"M607.5 205.5l-178.5 178.5 178.5 178.5-45 45-178.5-178.5-178.5 178.5-45-45 178.5-178.5-178.5-178.5 45-45 178.5 178.5 178.5-178.5z"}))}function X(e){return n.default.createElement("svg",M({width:"44",height:"44",viewBox:"0 0 768 768"},e),n.default.createElement("path",{d:"M640.5 352.5v63h-390l178.5 180-45 45-256.5-256.5 256.5-256.5 45 45-178.5 180h390z"}))}function O(e){return n.default.createElement("svg",M({width:"44",height:"44",viewBox:"0 0 768 768"},e),n.default.createElement("path",{d:"M384 127.5l256.5 256.5-256.5 256.5-45-45 178.5-180h-390v-63h390l-178.5-180z"}))}function z(){return(0,n.useEffect)(function(){var e=document.body.style,t=e.overflow;return e.overflow="hidden",function(){e.overflow=t}},[]),null}function Z(e){var t=e.touches[0],n=t.clientX,a=t.clientY;if(e.touches.length>=2){var i=e.touches[1],o=i.clientX,r=i.clientY;return[(n+o)/2,(a+r)/2,Math.sqrt(Math.pow(o-n,2)+Math.pow(r-a,2))]}return[n,a,0]}var K=function(e,t,n,a){var i,o=n*t,r=(o-a)/2,s=e;return o<=a?(i=1,s=0):e>0&&r-e<=0?(i=2,s=r):e<0&&r+e<=0&&(i=3,s=-r),[i,s]};function U(e,t,n,a,i,o,r,s,l,c){void 0===r&&(r=innerWidth/2),void 0===s&&(s=innerHeight/2),void 0===l&&(l=0),void 0===c&&(c=0);var d=K(e,o,n,innerWidth)[0],u=K(t,o,a,innerHeight),m=innerWidth/2,h=innerHeight/2;return{x:r-o/i*(r-(m+e))-m+(a/n>=3&&n*o===innerWidth?0:d?l/2:l),y:s-o/i*(s-(h+t))-h+(u[0]?c/2:c),lastCX:r,lastCY:s}}function G(e,t,n){var a=e%180!=0;return a?[n,t,a]:[t,n,a]}function J(e,t,n){var a=G(n,innerWidth,innerHeight),i=a[0],o=a[1],r=0,s=i,l=o,c=e/t*o,d=t/e*i;return e<i&&t<o?(s=e,l=t):e<i&&t>=o?s=c:e>=i&&t<o||e/t>i/o?l=d:t/e>=3&&!a[2]?r=((l=d)-o)/2:s=c,{width:s,height:l,x:0,y:r,pause:!0}}function Q(e,t){var a=t.leading,i=void 0!==a&&a,o=t.maxWait,r=t.wait,s=void 0===r?o||0:r,l=(0,n.useRef)(e);l.current=e;var c=(0,n.useRef)(0),d=(0,n.useRef)(),u=function(){return d.current&&clearTimeout(d.current)},m=(0,n.useCallback)(function(){var e=[].slice.call(arguments),t=Date.now();function n(){c.current=t,u(),l.current.apply(null,e)}var a=c.current,r=t-a;if(0===a&&(i&&n(),c.current=t),void 0!==o){if(r>o)return void n()}else r<s&&(c.current=t);u(),d.current=setTimeout(function(){n(),c.current=0},s)},[s,o,i]);return m.cancel=u,m}var ee=function(e,t,n){return en(e,t,n,100,function(e){return e},function(){return en(t,e,n)})},et=function(e){return 1-Math.pow(1-e,4)};function en(e,t,n,a,i,o){void 0===a&&(a=400),void 0===i&&(i=et);var r=t-e;if(0!==r){var s=Date.now(),l=0,c=function(){var t=Math.min(1,(Date.now()-s)/a);n(e+i(t)*r)&&t<1?d():(cancelAnimationFrame(l),t>=1&&o&&o())};d()}function d(){l=requestAnimationFrame(c)}}var ea={T:0,L:0,W:0,H:0,FIT:void 0},ei=function(){var e=(0,n.useRef)(!1);return(0,n.useEffect)(function(){return e.current=!0,function(){e.current=!1}},[]),e},eo=["className"];function er(e){var t=e.className,a=V(e,eo);return n.default.createElement("div",M({className:"PhotoView__Spinner "+(void 0===t?"":t)},a),n.default.createElement("svg",{viewBox:"0 0 32 32",width:"36",height:"36",fill:"white"},n.default.createElement("path",{opacity:".25",d:"M16 0 A16 16 0 0 0 16 32 A16 16 0 0 0 16 0 M16 4 A12 12 0 0 1 16 28 A12 12 0 0 1 16 4"}),n.default.createElement("path",{d:"M16 0 A16 16 0 0 1 32 16 L28 16 A12 12 0 0 0 16 4z"})))}var es=["src","loaded","broken","className","onPhotoLoad","loadingElement","brokenElement"];function el(e){var t=e.src,a=e.loaded,i=e.broken,o=e.className,r=e.onPhotoLoad,s=e.loadingElement,l=e.brokenElement,c=V(e,es),d=ei();return t&&!i?n.default.createElement(n.default.Fragment,null,n.default.createElement("img",M({className:"PhotoView__Photo"+(o?" "+o:""),src:t,onLoad:function(e){var t=e.target;d.current&&r({loaded:!0,naturalWidth:t.naturalWidth,naturalHeight:t.naturalHeight})},onError:function(){d.current&&r({broken:!0})},draggable:!1,alt:""},c)),!a&&(s?n.default.createElement("span",{className:"PhotoView__icon"},s):n.default.createElement(er,{className:"PhotoView__icon"}))):l?n.default.createElement("span",{className:"PhotoView__icon"},"function"==typeof l?l({src:t}):l):null}var ec={naturalWidth:void 0,naturalHeight:void 0,width:void 0,height:void 0,loaded:void 0,broken:!1,x:0,y:0,touched:!1,maskTouched:!1,rotate:0,scale:1,CX:0,CY:0,lastX:0,lastY:0,lastCX:0,lastCY:0,lastScale:1,touchTime:0,touchLength:0,pause:!0,stopRaf:!0,reach:void 0};function ed(e){var t,a,i,o,r,s,l,c,d,u,m,h,f,p,g,v,x,b,C,j,_,w,y,N,k,I,S,L,E,V,F,D,T,q=e.item,W=q.src,$=q.render,X=q.width,O=void 0===X?0:X,z=q.height,et=void 0===z?0:z,eo=q.originRef,er=e.visible,es=e.speed,ed=e.easing,eu=e.wrapClassName,em=e.className,eh=e.style,ef=e.loadingElement,ep=e.brokenElement,eg=e.onPhotoTap,ev=e.onMaskTap,ex=e.onReachMove,eb=e.onReachUp,eC=e.onPhotoResize,ej=e.isActive,e_=e.expose,ew=H(ec),ey=ew[0],eN=ew[1],ek=(0,n.useRef)(0),eI=ei(),eS=ey.naturalWidth,eL=void 0===eS?O:eS,eE=ey.naturalHeight,eM=void 0===eE?et:eE,eV=ey.width,eP=void 0===eV?O:eV,eH=ey.height,eF=void 0===eH?et:eH,eD=ey.loaded,eR=void 0===eD?!W:eD,eT=ey.broken,eB=ey.x,eA=ey.y,eY=ey.touched,eq=ey.stopRaf,eW=ey.maskTouched,e$=ey.rotate,eX=ey.scale,eO=ey.CX,ez=ey.CY,eZ=ey.lastX,eK=ey.lastY,eU=ey.lastCX,eG=ey.lastCY,eJ=ey.lastScale,eQ=ey.touchTime,e0=ey.touchLength,e1=ey.pause,e2=ey.reach,e5=P({onScale:function(e){return e4(B(e))},onRotate:function(e){e$!==e&&(e_({rotate:e}),eN(M({rotate:e},J(eL,eM,e))))}});function e4(e,t,n){eX!==e&&(e_({scale:e}),eN(M({scale:e},U(eB,eA,eP,eF,eX,e,t,n),e<=1&&{x:0,y:0})))}var e3=Q(function(e,t,n){if(void 0===n&&(n=0),(eY||eW)&&ej){var a=G(e$,eP,eF),i=a[0],o=a[1];if(0===n&&0===ek.current){var r=20>=Math.abs(e-eO),s=20>=Math.abs(t-ez);if(r&&s)return void eN({lastCX:e,lastCY:t});ek.current=r?t>ez?3:2:1}var l,c=e-eU,d=t-eG;if(0===n){var u,m,h=K(c+eZ,eX,i,innerWidth)[0],f=K(d+eK,eX,o,innerHeight);u=ek.current,m=f[0],void 0!==(l=h&&1===u||"x"===e2?"x":m&&u>1||"y"===e2?"y":void 0)&&ex(l,e,t,eX)}if("x"===l||eW)return void eN({reach:"x"});var p=B(eX+(n-e0)/100/2*eX,eL/eP,.2);e_({scale:p}),eN(M({touchLength:n,reach:l,scale:p},U(eB,eA,eP,eF,eX,p,e,t,c,d)))}},{maxWait:8});function e6(e){return!eq&&!eY&&(eI.current&&eN(M({},e,{pause:er})),eI.current)}var e8,e7,e9,te,tt,tn,ta,ti=(te=function(e){return e6({x:e})},tt=function(e){return e6({y:e})},tn=function(e){return eI.current&&(e_({scale:e}),eN({scale:e})),!eY&&eI.current},ta=P({X:function(e){return te(e)},Y:function(e){return tt(e)},S:function(e){return tn(e)}}),function(e,t,n,a,i,o,r,s,l,c,d){var u=G(c,i,o),m=u[0],h=u[1],f=K(e,s,m,innerWidth),p=f[0],g=f[1],v=K(t,s,h,innerHeight),x=v[0],b=v[1],C=Date.now()-d;if(C>=200||s!==r||Math.abs(l-r)>1){var j=U(e,t,i,o,r,s),_=j.x,w=j.y,y=p?g:_!==e?_:null,N=x?b:w!==t?w:null;return null!==y&&en(e,y,ta.X),null!==N&&en(t,N,ta.Y),void(s!==r&&en(r,s,ta.S))}var k=(e-n)/C,I=(t-a)/C,S=Math.sqrt(Math.pow(k,2)+Math.pow(I,2)),L=!1,E=!1;!function(e,t){var n,a=e,i=0,o=0,r=function(o){n||(n=o);var r=o-n,c=Math.sign(e),d=-.001*c,u=Math.sign(-a)*Math.pow(a,2)*2e-4;i+=a*r+(d+u)*Math.pow(r,2)/2,n=o,c*(a+=(d+u)*r)<=0?l():t(i)?s():l()};function s(){o=requestAnimationFrame(r)}function l(){cancelAnimationFrame(o)}s()}(S,function(n){var a=e+k/S*n,i=t+I/S*n,o=K(a,r,m,innerWidth),s=o[0],l=o[1],c=K(i,r,h,innerHeight),d=c[0],u=c[1];if(s&&!L&&(L=!0,p?en(a,l,ta.X):ee(l,a+(a-l),ta.X)),d&&!E&&(E=!0,x?en(i,u,ta.Y):ee(u,i+(i-u),ta.Y)),L&&E)return!1;var f=L||ta.X(l),g=E||ta.Y(u);return f&&g})}),to=(e8=function(e,t){e2||e4(1!==eX?1:Math.max(2,eL/eP),e,t)},e7=(0,n.useRef)(0),e9=Q(function(){e7.current=0,eg.apply(void 0,[].slice.call(arguments))},{wait:300}),function(){var e=[].slice.call(arguments);e7.current+=1,e9.apply(void 0,e),e7.current>=2&&(e9.cancel(),e7.current=0,e8.apply(void 0,e))});function tr(e,t){if(ek.current=0,(eY||eW)&&ej){eN({touched:!1,maskTouched:!1,pause:!1,stopRaf:!1,reach:void 0});var n=B(eX,eL/eP);if(ti(eB,eA,eZ,eK,eP,eF,eX,n,eJ,e$,eQ),eb(e,t),eO===e&&ez===t){if(eY)return void to(e,t);eW&&ev(e,t)}}}function ts(e,t,n){void 0===n&&(n=0),eN({touched:!0,CX:e,CY:t,lastCX:e,lastCY:t,lastX:eB,lastY:eA,lastScale:eX,touchLength:n,touchTime:Date.now()})}function tl(e){eN({maskTouched:!0,CX:e.clientX,CY:e.clientY,lastX:eB,lastY:eA})}Y(R?void 0:"mousemove",function(e){e.preventDefault(),e3(e.clientX,e.clientY)}),Y(R?void 0:"mouseup",function(e){tr(e.clientX,e.clientY)}),Y(R?"touchmove":void 0,function(e){e.preventDefault();var t=Z(e);e3.apply(void 0,t)},{passive:!1}),Y(R?"touchend":void 0,function(e){var t=e.changedTouches[0];tr(t.clientX,t.clientY)},{passive:!1}),Y("resize",Q(function(){eR&&!eY&&(eN(J(eL,eM,e$)),eC())},{maxWait:8})),A(function(){ej&&e_(M({scale:eX,rotate:e$},e5))},[ej]);var tc=(y=(p=function(e){return eN({pause:e})},g=(0,n.useRef)(!1),b=(x=(v=H({lead:!0,scale:eX}))[0]).lead,C=x.scale,j=v[1],_=Q(function(e){try{return p(!0),j({lead:!1,scale:e}),Promise.resolve()}catch(e){return Promise.reject(e)}},{wait:es}),A(function(){g.current?(p(!1),j({lead:!0}),_(eX)):g.current=!0},[eX]),w=b?[eP*C,eF*C,eX/C]:[eP*eX,eF*eX,1])[0],N=w[1],k=w[2],S=(t=er,a=eo,i=eR,o=es,r=p,l=(s=(0,n.useState)(ea))[0],c=s[1],u=(d=(0,n.useState)(0))[0],m=d[1],h=(0,n.useRef)(),f=P({OK:function(){return t&&m(4)}}),(0,n.useEffect)(function(){if(h.current||(h.current=Date.now()),i){if(function(e,t){var n=e&&e.current;if(n&&1===n.nodeType){var a=n.getBoundingClientRect();t({T:a.top,L:a.left,W:a.width,H:a.height,FIT:"IMG"===n.tagName?getComputedStyle(n).objectFit:void 0})}}(a,c),t)return Date.now()-h.current<250?(m(1),requestAnimationFrame(function(){m(2),requestAnimationFrame(function(){r(!1),m(3)})}),void setTimeout(f.OK,o)):void m(4);r(!1),m(5)}},[t,i]),I=[u,l])[0],E=(L=I[1]).W,V=L.FIT,F=innerWidth/2,D=innerHeight/2,[(T=S<3||S>4)?E?L.L:F:eB+(F-eP*eX/2),T?E?L.T:D:eA+(D-eF*eX/2),y,T&&V?y*(L.H/E):N,0===S?k:T?E/(eP*eX)||.01:k,T?+!!V:1,S,V]),td=tc[4],tu=tc[6],tm="transform "+es+"ms "+ed,th={className:em,onMouseDown:R?void 0:function(e){e.stopPropagation(),0===e.button&&ts(e.clientX,e.clientY,0)},onTouchStart:R?function(e){e.stopPropagation(),ts.apply(void 0,Z(e))}:void 0,onWheel:function(e){if(!e2){var t=B(eX-e.deltaY/100/2,eL/eP);eN({stopRaf:!0}),e4(t,e.clientX,e.clientY)}},style:{width:tc[2]+"px",height:tc[3]+"px",opacity:tc[5],objectFit:4===tu?void 0:tc[7],transform:e$?"rotate("+e$+"deg)":void 0,transition:tu>2?tm+", opacity "+es+"ms ease, height "+(tu<4?es/2:tu>4?es:0)+"ms "+ed:void 0}};return n.default.createElement("div",{className:"PhotoView__PhotoWrap"+(eu?" "+eu:""),style:eh,onMouseDown:!R&&ej?tl:void 0,onTouchStart:R&&ej?function(e){return tl(e.touches[0])}:void 0},n.default.createElement("div",{className:"PhotoView__PhotoBox",style:{transform:"matrix("+td+", 0, 0, "+td+", "+tc[0]+", "+tc[1]+")",transition:eY||e1?void 0:tm,willChange:ej?"transform":void 0}},W?n.default.createElement(el,M({src:W,loaded:eR,broken:eT},th,{onPhotoLoad:function(e){eN(M({},e,e.loaded&&J(e.naturalWidth||0,e.naturalHeight||0,e$)))},loadingElement:ef,brokenElement:ep})):$&&$({attrs:th,scale:td,rotate:e$})))}var eu={x:0,touched:!1,pause:!1,lastCX:void 0,lastCY:void 0,bg:void 0,lastBg:void 0,overlay:!0,minimal:!0,scale:1,rotate:0};function em(e){var t,a,i,o,r=e.loop,s=void 0===r?3:r,l=e.speed,c=e.easing,d=e.photoClosable,u=e.maskClosable,m=void 0===u||u,h=e.maskOpacity,f=void 0===h?1:h,p=e.pullClosable,g=void 0===p||p,v=e.bannerVisible,x=void 0===v||v,b=e.overlayRender,C=e.toolbarRender,j=e.className,_=e.maskClassName,w=e.photoClassName,y=e.photoWrapClassName,N=e.loadingElement,k=e.brokenElement,I=e.images,S=e.index,L=e.onIndexChange,E=e.visible,M=e.onClose,V=e.afterClose,F=e.portalContainer,B=H(eu),q=B[0],Z=B[1],K=(0,n.useState)(0),U=K[0],G=K[1],J=q.x,Q=q.touched,ee=q.pause,et=q.lastCX,en=q.lastCY,ea=q.bg,ei=void 0===ea?f:ea,eo=q.lastBg,er=q.overlay,es=q.minimal,el=q.scale,ec=q.rotate,em=q.onScale,eh=q.onRotate,ef=e.hasOwnProperty("index"),ep=ef?void 0===S?0:S:U,eg=ef?L:G,ev=(0,n.useRef)(ep),ex=I.length,eb=I[ep],eC="boolean"==typeof s?s:ex>s,ej=(t=(0,n.useReducer)(function(e){return!e},!1)[1],a=(0,n.useRef)(0),o=(i=function(e){var t=(0,n.useRef)(e);function i(e){t.current=e}return(0,n.useMemo)(function(){E?(i(E),a.current=1):a.current=2},[e]),[t.current,i]}(E))[1],[i[0],a.current,function(){t(),2===a.current&&(o(!1),V&&V()),a.current=0}]),e_=ej[0],ew=ej[1],ey=ej[2];A(function(){e_?(Z({pause:!0,x:-(ep*(innerWidth+20))}),ev.current=ep):Z(eu)},[e_]);var eN=P({close:function(e){eh&&eh(0),Z({overlay:!0,lastBg:ei}),M(e)},changeIndex:function(e,t){void 0===t&&(t=!1);var n=eC?ev.current+(e-ep):e,a=ex-1,i=T(n,0,a),o=eC?n:i;Z({touched:!1,lastCX:void 0,lastCY:void 0,x:-(innerWidth+20)*o,pause:t}),ev.current=o,eg&&eg(eC?e<0?a:e>a?0:e:i)}}),ek=eN.close,eI=eN.changeIndex;function eS(e){return e?ek():Z({overlay:!er})}function eL(){Z({x:-(innerWidth+20)*ep,lastCX:void 0,lastCY:void 0,pause:!0}),ev.current=ep}function eE(e,t,n,a){"x"===e?function(e){if(void 0!==et){var t=e-et,n=t;!eC&&(0===ep&&t>0||ep===ex-1&&t<0)&&(n=t/2),Z({touched:!0,lastCX:et,x:-(innerWidth+20)*ev.current+n,pause:!1})}else Z({touched:!0,lastCX:e,x:J,pause:!1})}(t):"y"===e&&function(e,t){if(void 0!==en){var n=null===f?null:T(f,.01,f-Math.abs(e-en)/100/4);Z({touched:!0,lastCY:en,bg:1===t?n:f,minimal:1===t})}else Z({touched:!0,lastCY:e,bg:ei,minimal:!0})}(n,a)}function eM(e,t){var n=e-(null!=et?et:e),a=t-(null!=en?en:t),i=!1;if(n<-40)eI(ep+1);else if(n>40)eI(ep-1);else{var o=-(innerWidth+20)*ev.current;Math.abs(a)>100&&es&&g&&(i=!0,ek()),Z({touched:!1,x:o,lastCX:void 0,lastCY:void 0,bg:f,overlay:!!i||er})}}Y("keydown",function(e){if(E)switch(e.key){case"ArrowLeft":eI(ep-1,!0);break;case"ArrowRight":eI(ep+1,!0);break;case"Escape":ek()}});var eV=(0,n.useMemo)(function(){var e=I.length;return eC?I.concat(I).concat(I).slice(e+ep-1,e+ep+2):I.slice(Math.max(ep-1,0),Math.min(ep+2,e+1))},[I,ep,eC]);if(!e_)return null;var eP=er&&!ew,eH=E?ei:eo,eF=em&&eh&&{images:I,index:ep,visible:E,onClose:ek,onIndexChange:eI,overlayVisible:eP,overlay:eb&&eb.overlay,scale:el,rotate:ec,onScale:em,onRotate:eh},eD=l?l(ew):400,eR=c?c(ew):D,eT=l?l(3):600,eB=c?c(3):D;return n.default.createElement(W,{className:"PhotoView-Portal"+(eP?"":" PhotoView-Slider__clean")+(E?"":" PhotoView-Slider__willClose")+(j?" "+j:""),role:"dialog",onClick:function(e){return e.stopPropagation()},container:F},E&&n.default.createElement(z,null),n.default.createElement("div",{className:"PhotoView-Slider__Backdrop"+(_?" "+_:"")+(1===ew?" PhotoView-Slider__fadeIn":2===ew?" PhotoView-Slider__fadeOut":""),style:{background:eH?"rgba(0, 0, 0, "+eH+")":void 0,transitionTimingFunction:eR,transitionDuration:(Q?0:eD)+"ms",animationDuration:eD+"ms"},onAnimationEnd:ey}),x&&n.default.createElement("div",{className:"PhotoView-Slider__BannerWrap"},n.default.createElement("div",{className:"PhotoView-Slider__Counter"},ep+1," / ",ex),n.default.createElement("div",{className:"PhotoView-Slider__BannerRight"},C&&eF&&C(eF),n.default.createElement($,{className:"PhotoView-Slider__toolbarIcon",onClick:ek}))),eV.map(function(e,t){var a=eC||0!==ep?ev.current-1+t:ep+t;return n.default.createElement(ed,{key:eC?e.key+"/"+e.src+"/"+a:e.key,item:e,speed:eD,easing:eR,visible:E,onReachMove:eE,onReachUp:eM,onPhotoTap:function(){return eS(d)},onMaskTap:function(){return eS(m)},wrapClassName:y,className:w,style:{left:(innerWidth+20)*a+"px",transform:"translate3d("+J+"px, 0px, 0)",transition:Q||ee?void 0:"transform "+eT+"ms "+eB},loadingElement:N,brokenElement:k,onPhotoResize:eL,isActive:ev.current===a,expose:Z})}),!R&&x&&n.default.createElement(n.default.Fragment,null,(eC||0!==ep)&&n.default.createElement("div",{className:"PhotoView-Slider__ArrowLeft",onClick:function(){return eI(ep-1,!0)}},n.default.createElement(X,null)),(eC||ep+1<ex)&&n.default.createElement("div",{className:"PhotoView-Slider__ArrowRight",onClick:function(){return eI(ep+1,!0)}},n.default.createElement(O,null))),b&&eF&&n.default.createElement("div",{className:"PhotoView-Slider__Overlay"},b(eF)))}var eh=["children","onIndexChange","onVisibleChange"],ef={images:[],visible:!1,index:0};function ep(e){var t=e.children,a=e.onIndexChange,i=e.onVisibleChange,o=V(e,eh),r=H(ef),s=r[0],l=r[1],c=(0,n.useRef)(0),d=s.images,u=s.visible,m=s.index,h=P({nextId:function(){return c.current+=1},update:function(e){var t=d.findIndex(function(t){return t.key===e.key});if(t>-1){var n=d.slice();return n.splice(t,1,e),void l({images:n})}l(function(t){return{images:t.images.concat(e)}})},remove:function(e){l(function(t){var n=t.images.filter(function(t){return t.key!==e});return{images:n,index:Math.min(n.length-1,m)}})},show:function(e){var t=d.findIndex(function(t){return t.key===e});l({visible:!0,index:t}),i&&i(!0,t,s)}}),f=P({close:function(){l({visible:!1}),i&&i(!1,m,s)},changeIndex:function(e){l({index:e}),a&&a(e,s)}}),p=(0,n.useMemo)(function(){return M({},s,h)},[s,h]);return n.default.createElement(F.Provider,{value:p},t,n.default.createElement(em,M({images:d,visible:u,index:m,onIndexChange:f.changeIndex,onClose:f.close},o)))}var eg=e.i(89986),ev=e.i(43260);function ex({botLog:e}){var a;let i,o,s,d,u,m,h,f,p,g,{t:v}=(0,l.useTranslation)(),x=r.httpClient.getBaseUrl(),[b,C]=(0,n.useState)(!1),[j,_]=(0,n.useState)(!1);function y(e){let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-9999px",t.style.top="-9999px",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),c.toast.success(v("common.copySuccess"))}catch{c.toast.error(v("common.copyFailed"))}document.body.removeChild(t)}let N=e.text.length>100||e.images.length>0;return(0,t.jsxs)("div",{className:`${L.default.botLogCardContainer}`,children:[(0,t.jsxs)("div",{className:`${L.default.cardTitleContainer}`,children:[(0,t.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,t.jsx)("div",{className:`px-2 py-1 rounded text-xs font-medium uppercase ${function(e){switch(e.toLowerCase()){case"error":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400";case"warning":return"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400";case"info":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400"}}(e.level)}`,children:e.level}),e.message_session_id&&(0,t.jsxs)("div",{className:`${L.default.tag} ${L.default.chatTag} relative`,onClick:t=>{t.stopPropagation(),navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(e.message_session_id).then(()=>{C(!0),setTimeout(()=>C(!1),2e3),c.toast.success(v("common.copySuccess"))}).catch(()=>{y(e.message_session_id)}):y(e.message_session_id)},title:v("common.clickToCopy"),children:[b?(0,t.jsx)(w.Check,{className:"w-4 h-4 text-green-600"}):(0,t.jsxs)("svg",{className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1664",width:"16",height:"16",fill:"currentColor",children:[(0,t.jsx)("path",{d:"M96.1 575.7a32.2 32.1 0 1 0 64.4 0 32.2 32.1 0 1 0-64.4 0Z","p-id":"1665",fill:"currentColor"}),(0,t.jsx)("path",{d:"M742.1 450.7l-269.5-2.1c-14.3-0.1-26 13.8-26 31s11.7 31.3 26 31.4l269.5 2.1c14.3 0.1 26-13.8 26-31s-11.7-31.3-26-31.4zM742.1 577.7l-269.5-2.1c-14.3-0.1-26 13.8-26 31s11.7 31.3 26 31.4l269.5 2.1c14.3 0.2 26-13.8 26-31s-11.7-31.3-26-31.4z","p-id":"1666",fill:"currentColor"}),(0,t.jsx)("path",{d:"M736.1 63.9H417c-70.4 0-128 57.6-128 128h-64.9c-70.4 0-128 57.6-128 128v128c-0.1 17.7 14.4 32 32.2 32 17.8 0 32.2-14.4 32.2-32.1V320c0-35.2 28.8-64 64-64H289v447.8c0 70.4 57.6 128 128 128h255.1c-0.1 35.2-28.8 63.8-64 63.8H224.5c-35.2 0-64-28.8-64-64V703.5c0-17.7-14.4-32.1-32.2-32.1-17.8 0-32.3 14.4-32.3 32.1v128.3c0 70.4 57.6 128 128 128h384.1c70.4 0 128-57.6 128-128h65c70.4 0 128-57.6 128-128V255.9l-193-192z m0.1 63.4l127.7 128.3H800c-35.2 0-64-28.8-64-64v-64.3h0.2z m64 641H416.1c-35.2 0-64-28.8-64-64v-513c0-35.2 28.8-64 64-64H671V191c0 70.4 57.6 128 128 128h65.2v385.3c0 35.2-28.8 64-64 64z","p-id":"1667",fill:"currentColor"})]}),(0,t.jsx)("span",{className:`${L.default.chatId}`,children:e.message_session_id.split("")})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[N&&(0,t.jsx)("button",{onClick:()=>_(!j),className:"flex items-center gap-1 text-xs text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors",children:j?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eg.ChevronDown,{className:"w-3 h-3"}),v("bots.collapse")]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ev.ChevronRight,{className:"w-3 h-3"}),v("bots.viewDetails")]})}),(0,t.jsx)("div",{className:`${L.default.timestamp}`,children:(a=e.timestamp,i=new Date,s=(o=new Date(1e3*a)).getFullYear(),d=o.getMonth()+1,u=o.getDate(),m=o.getHours().toString().padStart(2,"0"),h=o.getMinutes().toString().padStart(2,"0"),f=i.toDateString()===o.toDateString(),p=new Date(i.setDate(i.getDate()-1)).toDateString()===o.toDateString(),g=i.getFullYear()===s,f?`${m}:${h}`:p?`${v("bots.yesterday")} ${m}:${h}`:g?v("bots.dateFormat",{month:d,day:u}):v("bots.earlier"))})]})]}),(0,t.jsx)("div",{className:`${L.default.cardText}`,children:j?e.text:function(e,t=100){return e.length<=t?e:e.substring(0,t)+"..."}(e.text)}),j&&e.images.length>0&&(0,t.jsx)(ep,{children:(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-3",children:e.images.map(e=>(0,t.jsx)("img",{src:`${x}/api/v1/files/image/${e}`,alt:"",className:"max-w-xs rounded cursor-pointer hover:opacity-90 transition-opacity"},e))})}),!j&&e.images.length>0&&(0,t.jsxs)("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:["ðŸ“· ",e.images.length," ",v("bots.imagesAttached")]})]})}var eb=e.i(37822),eC=e.i(33659),ej=e.i(10680),e_=e.i(96878),ew=e.i(76293),ey=e.i(23658);function eN({botId:e}){let{t:a}=(0,l.useTranslation)(),i=(0,ey.useRouter)(),o=(0,n.useRef)(new S(e)).current,[r,c]=(0,n.useState)([]),[d,u]=(0,n.useState)(!0),[m,h]=(0,n.useState)(["info","warning","error"]),f=(0,n.useRef)(null),g=(0,n.useRef)(r),v=[{value:"error",label:"ERROR"},{value:"warning",label:"WARNING"},{value:"info",label:"INFO"},{value:"debug",label:"DEBUG"}];(0,n.useEffect)(()=>(o.subscribeLogPush(b),o.loadFirstPage().then(e=>{c(e.reverse())}),f.current&&f.current.addEventListener("scroll",C),()=>{o.dispose(),f.current&&f.current.removeEventListener("scroll",C)}),[]),(0,n.useEffect)(()=>{g.current=r},[r]);let x=(0,n.useMemo)(()=>0===m.length?r:r.filter(e=>m.includes(e.level)),[r,m]);function b(e){c(e.reverse())}(0,n.useEffect)(()=>(d?o.startListenServerPush():o.stopServerPush(),()=>{o.stopServerPush()}),[d]);let C=(0,n.useCallback)((0,ew.default)(()=>{if(!f.current)return;let{scrollTop:e,scrollHeight:t,clientHeight:n}=f.current,a=e+n>=t-5,i=0===e;if(a){let e,t;u(!1),0!==(t=(e=g.current)[e.length-1].seq_id)&&o.loadMore(t-1,10).then(t=>{c([...e,...t.reverse()])})}i&&u(!0),i||a||u(!1)},300),[r]);return(0,t.jsxs)("div",{className:`${L.default.botLogListContainer}`,ref:f,children:[(0,t.jsxs)("div",{className:`${L.default.listHeader}`,children:[(0,t.jsx)("div",{className:"mr-2",children:a("bots.enableAutoRefresh")}),(0,t.jsx)(s.Switch,{checked:d,onCheckedChange:e=>u(e)}),(0,t.jsx)("div",{className:"ml-4 mr-2",children:a("bots.logLevel")}),(0,t.jsxs)(eb.Popover,{children:[(0,t.jsx)(eb.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(p.Button,{variant:"outline",size:"sm",className:"w-[180px] flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm truncate flex-1 text-left",children:0===m.length?a("bots.selectLevel"):m.length===v.length?a("bots.allLevels"):m.length>=3?`${m.length} ${a("bots.levelsSelected")}`:v.filter(e=>m.includes(e.value)).map(e=>e.label).join(", ")}),(0,t.jsx)(ej.ChevronDownIcon,{className:"ml-2 h-4 w-4 flex-shrink-0"})]})}),(0,t.jsx)(eb.PopoverContent,{className:"w-[180px] p-2",children:(0,t.jsx)("div",{className:"flex flex-col gap-2",children:v.map(e=>(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(eC.Checkbox,{id:e.value,checked:m.includes(e.value),onCheckedChange:()=>{var t;return t=e.value,void h(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])}}),(0,t.jsx)("label",{htmlFor:e.value,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",children:e.label})]},e.value))})})]}),(0,t.jsxs)(p.Button,{variant:"outline",size:"sm",className:"ml-4 flex items-center gap-1",onClick:()=>i.push(`/home/monitoring?botId=${e}`),children:[(0,t.jsx)(e_.ExternalLink,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-sm",children:a("bots.viewDetailedLogs")})]})]}),x.map(e=>(0,t.jsx)(ex,{botLog:e},e.seq_id))]})}function ek({open:e,onOpenChange:a,botId:i,onFormSubmit:o,onFormCancel:s,onBotDeleted:c,onNewBotCreated:d}){let{t:u}=(0,l.useTranslation)(),[m,g]=(0,n.useState)(i),[v,x]=(0,n.useState)("config"),[b,C]=(0,n.useState)(!1);(0,n.useEffect)(()=>{g(i),x("config")},[i,e]);let j=[{key:"config",label:u("bots.configuration"),icon:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,t.jsx)("path",{d:"M5 7C5 6.17157 5.67157 5.5 6.5 5.5C7.32843 5.5 8 6.17157 8 7C8 7.82843 7.32843 8.5 6.5 8.5C5.67157 8.5 5 7.82843 5 7ZM6.5 3.5C4.567 3.5 3 5.067 3 7C3 8.933 4.567 10.5 6.5 10.5C8.433 10.5 10 8.933 10 7C10 5.067 8.433 3.5 6.5 3.5ZM12 8H20V6H12V8ZM16 17C16 16.1716 16.6716 15.5 17.5 15.5C18.3284 15.5 19 16.1716 19 17C19 17.8284 18.3284 18.5 17.5 18.5C16.6716 18.5 16 17.8284 16 17ZM17.5 13.5C15.567 13.5 14 15.067 14 17C14 18.933 15.567 20.5 17.5 20.5C19.433 20.5 21 18.933 21 17C21 15.067 19.433 13.5 17.5 13.5ZM4 16V18H12V16H4Z"})})},{key:"logs",label:u("bots.logs"),icon:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,t.jsx)("path",{d:"M21 8V20.9932C21 21.5501 20.5552 22 20.0066 22H3.9934C3.44495 22 3 21.556 3 21.0082V2.9918C3 2.45531 3.4487 2 4.00221 2H14.9968L21 8ZM19 9H14V4H5V20H19V9ZM8 7H11V9H8V7ZM8 11H16V13H8V11ZM8 15H16V17H8V15Z"})})}],_=e=>{o(e)},w=()=>{s()},y=()=>{r.httpClient.deleteBot(m??"").then(()=>{c()})},N=e=>{g(e),x("config"),d(e)};return m?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.Dialog,{open:e,onOpenChange:a,children:(0,t.jsx)(h.DialogContent,{className:"overflow-hidden p-0 !max-w-[50rem] max-h-[75vh] flex",children:(0,t.jsxs)(f.SidebarProvider,{className:"items-start w-full flex",children:[(0,t.jsx)(f.Sidebar,{collapsible:"none",className:"hidden md:flex h-[80vh] w-40 min-w-[120px] border-r bg-white dark:bg-black",children:(0,t.jsx)(f.SidebarContent,{children:(0,t.jsx)(f.SidebarGroup,{children:(0,t.jsx)(f.SidebarGroupContent,{children:(0,t.jsx)(f.SidebarMenu,{children:j.map(e=>(0,t.jsx)(f.SidebarMenuItem,{children:(0,t.jsx)(f.SidebarMenuButton,{asChild:!0,isActive:v===e.key,onClick:()=>x(e.key),children:(0,t.jsxs)("a",{href:"#",children:[e.icon,(0,t.jsx)("span",{children:e.label})]})})},e.key))})})})})}),(0,t.jsxs)("main",{className:"flex flex-1 flex-col h-[75vh]",children:[(0,t.jsx)(h.DialogHeader,{className:"px-6 pt-6 pb-4 shrink-0",children:(0,t.jsx)(h.DialogTitle,{children:u("config"===v?"bots.editBot":"bots.botLogTitle")})}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 pb-6",children:["config"===v&&(0,t.jsx)(I,{initBotId:m,onFormSubmit:_,onBotDeleted:y,onNewBotCreated:N}),"logs"===v&&m&&(0,t.jsx)(eN,{botId:m})]}),"config"===v&&(0,t.jsx)(h.DialogFooter,{className:"px-6 py-4 border-t shrink-0",children:(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(p.Button,{type:"button",variant:"destructive",onClick:()=>{C(!0)},children:u("common.delete")}),(0,t.jsx)(p.Button,{type:"submit",form:"bot-form",children:u("common.save")}),(0,t.jsx)(p.Button,{type:"button",variant:"outline",onClick:w,children:u("common.cancel")})]})})]})]})})}),(0,t.jsx)(h.Dialog,{open:b,onOpenChange:C,children:(0,t.jsxs)(h.DialogContent,{children:[(0,t.jsx)(h.DialogHeader,{children:(0,t.jsx)(h.DialogTitle,{children:u("common.confirmDelete")})}),(0,t.jsx)("div",{className:"py-4",children:u("bots.deleteConfirmation")}),(0,t.jsxs)(h.DialogFooter,{children:[(0,t.jsx)(p.Button,{variant:"outline",onClick:()=>C(!1),children:u("common.cancel")}),(0,t.jsx)(p.Button,{variant:"destructive",onClick:()=>{y(),C(!1)},children:u("common.confirmDelete")})]})]})})]}):(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(h.Dialog,{open:e,onOpenChange:a,children:(0,t.jsx)(h.DialogContent,{className:"overflow-hidden p-0 !max-w-[40vw] max-h-[70vh] flex",children:(0,t.jsxs)("main",{className:"flex flex-1 flex-col h-[70vh]",children:[(0,t.jsx)(h.DialogHeader,{className:"px-6 pt-6 pb-4 shrink-0",children:(0,t.jsx)(h.DialogTitle,{children:u("bots.createBot")})}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto px-6 pb-6",children:(0,t.jsx)(I,{initBotId:void 0,onFormSubmit:_,onBotDeleted:y,onNewBotCreated:N})}),(0,t.jsx)(h.DialogFooter,{className:"px-6 py-4 border-t shrink-0",children:(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(p.Button,{type:"submit",form:"bot-form",children:u("common.submit")}),(0,t.jsx)(p.Button,{type:"button",variant:"outline",onClick:w,children:u("common.cancel")})]})})]})})})})}function eI(){let{t:e}=(0,l.useTranslation)(),[o,s]=(0,n.useState)(!1),[h,f]=(0,n.useState)([]),[p,g]=(0,n.useState)("");async function v(){let t=(await r.httpClient.getAdapters()).adapters.map(e=>({label:(0,m.extractI18nObject)(e.label),value:e.name}));r.httpClient.getBots().then(e=>{f(e.bots.map(e=>new i({id:e.uuid||"",iconURL:r.httpClient.getAdapterIconURL(e.adapter),name:e.name,description:e.description,adapter:e.adapter,adapterConfig:e.adapter_config,adapterLabel:t.find(t=>t.value===e.adapter)?.label||e.adapter.substring(0,10),usePipelineName:e.use_pipeline_name||"",enable:e.enable||!1})))}).catch(t=>{console.error("get bot list error",t),c.toast.error(e("bots.getBotListError")+t.msg)})}return(0,n.useEffect)(()=>{v()},[]),(0,t.jsxs)("div",{children:[(0,t.jsx)(ek,{open:o,onOpenChange:s,botId:p||void 0,onFormSubmit:function(){v()},onFormCancel:function(){s(!1)},onBotDeleted:function(){v(),s(!1)},onNewBotCreated:function(e){v(),g(e)}}),(0,t.jsxs)("div",{className:`${a.default.botListContainer}`,children:[(0,t.jsx)(u.default,{width:"100%",height:"10rem",plusSize:"90px",onClick:function(){g(""),s(!0)}}),h.map(e=>(0,t.jsx)("div",{onClick:()=>{g(e.id),s(!0)},children:(0,t.jsx)(d,{botCardVO:e,setBotEnableCallback:(e,t)=>{f(h.map(n=>n.id===e?{...n,enable:t}:n))}})},e.id))]})]})}e.s(["default",()=>eI],96786)}]);