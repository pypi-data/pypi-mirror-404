(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,77491,e=>{e.v({configPageContainer:"knowledgeBase-module__yeLH5q__configPageContainer",knowledgeListContainer:"knowledgeBase-module__yeLH5q__knowledgeListContainer"})},45426,e=>{e.v({basicInfoContainer:"KBCard-module__3xqd0q__basicInfoContainer",basicInfoDescriptionText:"KBCard-module__3xqd0q__basicInfoDescriptionText",basicInfoLastUpdatedTimeContainer:"KBCard-module__3xqd0q__basicInfoLastUpdatedTimeContainer",basicInfoNameContainer:"KBCard-module__3xqd0q__basicInfoNameContainer",basicInfoNameText:"KBCard-module__3xqd0q__basicInfoNameText",basicInfoUpdateTimeIcon:"KBCard-module__3xqd0q__basicInfoUpdateTimeIcon",basicInfoUpdateTimeText:"KBCard-module__3xqd0q__basicInfoUpdateTimeText",bigText:"KBCard-module__3xqd0q__bigText",cardContainer:"KBCard-module__3xqd0q__cardContainer",debugButtonIcon:"KBCard-module__3xqd0q__debugButtonIcon",iconBasicInfoContainer:"KBCard-module__3xqd0q__iconBasicInfoContainer",iconEmoji:"KBCard-module__3xqd0q__iconEmoji",operationContainer:"KBCard-module__3xqd0q__operationContainer",operationDefaultBadge:"KBCard-module__3xqd0q__operationDefaultBadge",operationDefaultBadgeIcon:"KBCard-module__3xqd0q__operationDefaultBadgeIcon",operationDefaultBadgeText:"KBCard-module__3xqd0q__operationDefaultBadgeText"})},88208,e=>{"use strict";var t,n=e.i(40320),l=e.i(10839),o=e.i(77491);e.i(94145);var i=e.i(44737),a=e.i(98255);class r{id;name;description;embeddingModelUUID;top_k;lastUpdatedTimeAgo;emoji;constructor(e){this.id=e.id,this.name=e.name,this.description=e.description,this.embeddingModelUUID=e.embeddingModelUUID,this.top_k=e.top_k,this.lastUpdatedTimeAgo=e.lastUpdatedTimeAgo,this.emoji=e.emoji}}class s{id;name;description;emoji;retrieverName;retrieverConfig;lastUpdatedTimeAgo;pluginAuthor;pluginName;constructor({id:e,name:t,description:n,emoji:l,retrieverName:o,retrieverConfig:i,lastUpdatedTimeAgo:a,pluginAuthor:r,pluginName:s}){this.id=e,this.name=t,this.description=n,this.emoji=l,this.retrieverName=o,this.retrieverConfig=i,this.lastUpdatedTimeAgo=a,this.pluginAuthor=r,this.pluginName=s}}var d=e.i(45426);function u({kbCardVO:e}){let{t}=(0,i.useTranslation)();return(0,n.jsx)("div",{className:`${d.default.cardContainer}`,children:(0,n.jsxs)("div",{className:`${d.default.basicInfoContainer}`,children:[(0,n.jsxs)("div",{className:`${d.default.iconBasicInfoContainer}`,children:[(0,n.jsx)("div",{className:`${d.default.iconEmoji}`,children:e.emoji||"ðŸ“š"}),(0,n.jsxs)("div",{className:`${d.default.basicInfoNameContainer}`,children:[(0,n.jsx)("div",{className:`${d.default.basicInfoNameText}  ${d.default.bigText}`,children:e.name}),(0,n.jsx)("div",{className:`${d.default.basicInfoDescriptionText}`,children:e.description})]})]}),(0,n.jsxs)("div",{className:`${d.default.basicInfoLastUpdatedTimeContainer}`,children:[(0,n.jsx)("svg",{className:`${d.default.basicInfoUpdateTimeIcon}`,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,n.jsx)("path",{d:"M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM13 12H17V14H11V7H13V12Z"})}),(0,n.jsxs)("div",{className:`${d.default.basicInfoUpdateTimeText}`,children:[t("knowledge.updateTime"),e.lastUpdatedTimeAgo]})]})]})})}e.i(37773);var g=e.i(28924);function c({kbCardVO:e}){let{t}=(0,i.useTranslation)();return(0,n.jsx)("div",{className:`${d.default.cardContainer}`,children:(0,n.jsxs)("div",{className:`${d.default.basicInfoContainer}`,children:[(0,n.jsxs)("div",{className:`${d.default.iconBasicInfoContainer}`,children:[(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:`${d.default.iconEmoji}`,children:e.emoji||"ðŸ”—"}),(0,n.jsx)("img",{src:g.httpClient.getPluginIconURL(e.pluginAuthor,e.pluginName),alt:"plugin icon",className:"absolute -bottom-1 -right-1 w-5 h-5 rounded-[20%]"})]}),(0,n.jsxs)("div",{className:`${d.default.basicInfoNameContainer}`,children:[(0,n.jsx)("div",{className:`${d.default.basicInfoNameText}  ${d.default.bigText}`,children:e.name}),(0,n.jsx)("div",{className:`${d.default.basicInfoDescriptionText}`,children:e.description})]})]}),(0,n.jsxs)("div",{className:`${d.default.basicInfoLastUpdatedTimeContainer}`,children:[(0,n.jsx)("svg",{className:`${d.default.basicInfoUpdateTimeIcon}`,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,n.jsx)("path",{d:"M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM13 12H17V14H11V7H13V12Z"})}),(0,n.jsxs)("div",{className:`${d.default.basicInfoUpdateTimeText}`,children:[t("knowledge.updateTime"),e.lastUpdatedTimeAgo]})]})]})})}var m=e.i(76639),p=e.i(30909),f=e.i(19455),h=e.i(11472),x=e.i(37683),C=e.i(32356),v=e.i(93479),b=e.i(67476),w=e.i(3133),S=e.i(98475),j=e.i(67489),R=e.i(11939);function _({initKbId:e,onNewKbCreated:t,onKbUpdated:l}){let{t:o}=(0,i.useTranslation)(),r=C.z.object({name:C.z.string().min(1,{message:o("knowledge.kbNameRequired")}),description:C.z.string().min(1,{message:o("knowledge.kbDescriptionRequired")}),emoji:C.z.string().optional(),embeddingModelUUID:C.z.string().min(1,{message:o("knowledge.embeddingModelUUIDRequired")}),top_k:C.z.number().min(1,{message:o("knowledge.topKRequired")}).max(30,{message:o("knowledge.topKMax")})}),s=(0,h.useForm)({resolver:(0,x.zodResolver)(r),defaultValues:{name:"",description:o("knowledge.defaultDescription"),emoji:"ðŸ“š",embeddingModelUUID:"",top_k:5}}),[d,u]=(0,a.useState)([]);(0,a.useEffect)(()=>{c().then(()=>{e&&g(e).then(e=>{s.setValue("name",e.name),s.setValue("description",e.description),s.setValue("emoji",e.emoji),s.setValue("embeddingModelUUID",e.embeddingModelUUID),s.setValue("top_k",e.top_k||5)})})},[]);let g=async e=>new Promise(t=>{S.httpClient.getKnowledgeBase(e).then(e=>{t({name:e.base.name,description:e.base.description,emoji:e.base.emoji||"ðŸ“š",embeddingModelUUID:e.base.embedding_model_uuid,top_k:e.base.top_k||5})})}),c=async()=>{let e=(await S.httpClient.getProviderEmbeddingModels()).models;(S.systemInfo.disable_models_service||S.userInfo?.account_type!=="space")&&(e=e.filter(e=>e.provider?.requester!=="space-chat-completions")),u(e)};return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(w.Form,{...s,children:(0,n.jsx)("form",{onSubmit:s.handleSubmit(n=>{if(e){let t={name:n.name,description:n.description,emoji:n.emoji,embedding_model_uuid:n.embeddingModelUUID,top_k:n.top_k};S.httpClient.updateKnowledgeBase(e,t).then(e=>{l(e.uuid),R.toast.success(o("knowledge.updateKnowledgeBaseSuccess"))}).catch(e=>{console.error("update knowledge base failed",e),R.toast.error(o("knowledge.updateKnowledgeBaseFailed"))})}else{let e={name:n.name,description:n.description,emoji:n.emoji,embedding_model_uuid:n.embeddingModelUUID,top_k:n.top_k};S.httpClient.createKnowledgeBase(e).then(e=>{t(e.uuid)}).catch(e=>{console.error("create knowledge base failed",e)})}}),id:"kb-form",className:"space-y-8",children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex gap-4 items-start",children:[(0,n.jsx)(w.FormField,{control:s.control,name:"name",render:({field:e})=>(0,n.jsxs)(w.FormItem,{className:"flex-1",children:[(0,n.jsxs)(w.FormLabel,{children:[o("knowledge.kbName"),(0,n.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,n.jsx)(w.FormControl,{children:(0,n.jsx)(v.Input,{...e})}),(0,n.jsx)(w.FormMessage,{})]})}),(0,n.jsx)(w.FormField,{control:s.control,name:"emoji",render:({field:e})=>(0,n.jsxs)(w.FormItem,{children:[(0,n.jsx)(w.FormLabel,{children:o("common.icon")}),(0,n.jsx)(w.FormControl,{children:(0,n.jsx)(b.default,{value:e.value,onChange:e.onChange})}),(0,n.jsx)(w.FormMessage,{})]})})]}),(0,n.jsx)(w.FormField,{control:s.control,name:"description",render:({field:e})=>(0,n.jsxs)(w.FormItem,{children:[(0,n.jsxs)(w.FormLabel,{children:[o("knowledge.kbDescription"),(0,n.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,n.jsx)(w.FormControl,{children:(0,n.jsx)(v.Input,{...e})}),(0,n.jsx)(w.FormMessage,{})]})}),(0,n.jsx)(w.FormField,{control:s.control,name:"embeddingModelUUID",render:({field:t})=>(0,n.jsxs)(w.FormItem,{children:[(0,n.jsxs)(w.FormLabel,{children:[o("knowledge.embeddingModelUUID"),(0,n.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,n.jsx)(w.FormControl,{children:(0,n.jsx)("div",{className:"relative",children:(0,n.jsxs)(j.Select,{disabled:!!e,onValueChange:e=>{t.onChange(e)},value:t.value,children:[(0,n.jsx)(j.SelectTrigger,{className:"w-[180px] bg-[#ffffff] dark:bg-[#2a2a2e]",children:(0,n.jsx)(j.SelectValue,{placeholder:o("knowledge.selectEmbeddingModel")})}),(0,n.jsx)(j.SelectContent,{className:"fixed z-[1000]",children:Object.entries(d.reduce((e,t)=>{let n=t.provider?.name||t.provider?.requester||"Unknown";return e[n]||(e[n]=[]),e[n].push(t),e},{})).map(([e,t])=>(0,n.jsxs)(j.SelectGroup,{children:[(0,n.jsx)(j.SelectLabel,{children:e}),t.map(e=>(0,n.jsx)(j.SelectItem,{value:e.uuid,children:e.name},e.uuid))]},e))})]})})}),(0,n.jsx)(w.FormDescription,{children:e?o("knowledge.cannotChangeEmbeddingModel"):o("knowledge.embeddingModelDescription")}),(0,n.jsx)(w.FormMessage,{})]})}),(0,n.jsx)(w.FormField,{control:s.control,name:"top_k",render:({field:e})=>(0,n.jsxs)(w.FormItem,{children:[(0,n.jsxs)(w.FormLabel,{children:[o("knowledge.topK"),(0,n.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,n.jsx)(w.FormControl,{children:(0,n.jsx)(v.Input,{type:"number",...e,onChange:t=>e.onChange(Number(t.target.value)),className:"w-[180px] h-10 text-base appearance-none"})}),(0,n.jsx)(w.FormDescription,{children:o("knowledge.topKdescription")}),(0,n.jsx)(w.FormMessage,{})]})})]})})})})}var F=e.i(65417),F=F,I=e.i(55146),M=e.i(87486);function y(e,t){return"function"==typeof e?e(t):e}function V(e,t){return n=>{t.setState(t=>({...t,[e]:y(n,t[e])}))}}function k(e){return e instanceof Function}function P(e,t,n){let l,o=[];return i=>{let a,r;n.key&&n.debug&&(a=Date.now());let s=e(i);if(!(s.length!==o.length||s.some((e,t)=>o[t]!==e)))return l;if(o=s,n.key&&n.debug&&(r=Date.now()),l=t(...s),null==n||null==n.onChange||n.onChange(l),n.key&&n.debug&&null!=n&&n.debug()){let e=Math.round((Date.now()-a)*100)/100,t=Math.round((Date.now()-r)*100)/100,l=t/16,o=(e,t)=>{for(e=String(e);e.length<t;)e=" "+e;return e};console.info(`%câ± ${o(t,5)} /${o(e,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*l,120))}deg 100% 31%);`,null==n?void 0:n.key)}return l}}function D(e,t,n,l){return{debug:()=>{var n;return null!=(n=null==e?void 0:e.debugAll)?n:e[t]},key:!1,onChange:l}}e.i(17860);let N="debugHeaders";function T(e,t,n){var l;let o={id:null!=(l=n.id)?l:t.id,column:t,index:n.index,isPlaceholder:!!n.isPlaceholder,placeholderId:n.placeholderId,depth:n.depth,subHeaders:[],colSpan:0,rowSpan:0,headerGroup:null,getLeafHeaders:()=>{let e=[],t=n=>{n.subHeaders&&n.subHeaders.length&&n.subHeaders.map(t),e.push(n)};return t(o),e},getContext:()=>({table:e,header:o,column:t})};return e._features.forEach(t=>{null==t.createHeader||t.createHeader(o,e)}),o}function E(e,t,n,l){var o,i;let a=0,r=function(e,t){void 0===t&&(t=1),a=Math.max(a,t),e.filter(e=>e.getIsVisible()).forEach(e=>{var n;null!=(n=e.columns)&&n.length&&r(e.columns,t+1)},0)};r(e);let s=[],d=(e,t)=>{let o={depth:t,id:[l,`${t}`].filter(Boolean).join("_"),headers:[]},i=[];e.forEach(e=>{let a,r=[...i].reverse()[0],s=e.column.depth===o.depth,d=!1;if(s&&e.column.parent?a=e.column.parent:(a=e.column,d=!0),r&&(null==r?void 0:r.column)===a)r.subHeaders.push(e);else{let o=T(n,a,{id:[l,t,a.id,null==e?void 0:e.id].filter(Boolean).join("_"),isPlaceholder:d,placeholderId:d?`${i.filter(e=>e.column===a).length}`:void 0,depth:t,index:i.length});o.subHeaders.push(e),i.push(o)}o.headers.push(e),e.headerGroup=o}),s.push(o),t>0&&d(i,t-1)};d(t.map((e,t)=>T(n,e,{depth:a,index:t})),a-1),s.reverse();let u=e=>e.filter(e=>e.column.getIsVisible()).map(e=>{let t=0,n=0,l=[0];return e.subHeaders&&e.subHeaders.length?(l=[],u(e.subHeaders).forEach(e=>{let{colSpan:n,rowSpan:o}=e;t+=n,l.push(o)})):t=1,n+=Math.min(...l),e.colSpan=t,e.rowSpan=n,{colSpan:t,rowSpan:n}});return u(null!=(o=null==(i=s[0])?void 0:i.headers)?o:[]),s}let L=(e,t,n,l,o,i,a)=>{let r={id:t,index:l,original:n,depth:o,parentId:a,_valuesCache:{},_uniqueValuesCache:{},getValue:t=>{if(r._valuesCache.hasOwnProperty(t))return r._valuesCache[t];let n=e.getColumn(t);if(null!=n&&n.accessorFn)return r._valuesCache[t]=n.accessorFn(r.original,l),r._valuesCache[t]},getUniqueValues:t=>{if(r._uniqueValuesCache.hasOwnProperty(t))return r._uniqueValuesCache[t];let n=e.getColumn(t);if(null!=n&&n.accessorFn)return n.columnDef.getUniqueValues?r._uniqueValuesCache[t]=n.columnDef.getUniqueValues(r.original,l):r._uniqueValuesCache[t]=[r.getValue(t)],r._uniqueValuesCache[t]},renderValue:t=>{var n;return null!=(n=r.getValue(t))?n:e.options.renderFallbackValue},subRows:null!=i?i:[],getLeafRows:()=>{var e,t;let n,l;return e=r.subRows,t=e=>e.subRows,n=[],(l=e=>{e.forEach(e=>{n.push(e);let o=t(e);null!=o&&o.length&&l(o)})})(e),n},getParentRow:()=>r.parentId?e.getRow(r.parentId,!0):void 0,getParentRows:()=>{let e=[],t=r;for(;;){let n=t.getParentRow();if(!n)break;e.push(n),t=n}return e.reverse()},getAllCells:P(()=>[e.getAllLeafColumns()],t=>t.map(t=>{var n;let l;return n=t.id,l={id:`${r.id}_${t.id}`,row:r,column:t,getValue:()=>r.getValue(n),renderValue:()=>{var t;return null!=(t=l.getValue())?t:e.options.renderFallbackValue},getContext:P(()=>[e,t,r,l],(e,t,n,l)=>({table:e,column:t,row:n,cell:l,getValue:l.getValue,renderValue:l.renderValue}),D(e.options,"debugCells","cell.getContext"))},e._features.forEach(n=>{null==n.createCell||n.createCell(l,t,r,e)},{}),l}),D(e.options,"debugRows","getAllCells")),_getAllCellsByColumnId:P(()=>[r.getAllCells()],e=>e.reduce((e,t)=>(e[t.column.id]=t,e),{}),D(e.options,"debugRows","getAllCellsByColumnId"))};for(let t=0;t<e._features.length;t++){let n=e._features[t];null==n||null==n.createRow||n.createRow(r,e)}return r},H=(e,t,n)=>{var l,o;let i=null==n||null==(l=n.toString())?void 0:l.toLowerCase();return!!(null==(o=e.getValue(t))||null==(o=o.toString())||null==(o=o.toLowerCase())?void 0:o.includes(i))};H.autoRemove=e=>Z(e);let A=(e,t,n)=>{var l;return!!(null==(l=e.getValue(t))||null==(l=l.toString())?void 0:l.includes(n))};A.autoRemove=e=>Z(e);let B=(e,t,n)=>{var l;return(null==(l=e.getValue(t))||null==(l=l.toString())?void 0:l.toLowerCase())===(null==n?void 0:n.toLowerCase())};B.autoRemove=e=>Z(e);let z=(e,t,n)=>{var l;return null==(l=e.getValue(t))?void 0:l.includes(n)};z.autoRemove=e=>Z(e);let G=(e,t,n)=>!n.some(n=>{var l;return!(null!=(l=e.getValue(t))&&l.includes(n))});G.autoRemove=e=>Z(e)||!(null!=e&&e.length);let O=(e,t,n)=>n.some(n=>{var l;return null==(l=e.getValue(t))?void 0:l.includes(n)});O.autoRemove=e=>Z(e)||!(null!=e&&e.length);let U=(e,t,n)=>e.getValue(t)===n;U.autoRemove=e=>Z(e);let q=(e,t,n)=>e.getValue(t)==n;q.autoRemove=e=>Z(e);let K=(e,t,n)=>{let[l,o]=n,i=e.getValue(t);return i>=l&&i<=o};K.resolveFilterValue=e=>{let[t,n]=e,l="number"!=typeof t?parseFloat(t):t,o="number"!=typeof n?parseFloat(n):n,i=null===t||Number.isNaN(l)?-1/0:l,a=null===n||Number.isNaN(o)?1/0:o;if(i>a){let e=i;i=a,a=e}return[i,a]},K.autoRemove=e=>Z(e)||Z(e[0])&&Z(e[1]);let $={includesString:H,includesStringSensitive:A,equalsString:B,arrIncludes:z,arrIncludesAll:G,arrIncludesSome:O,equals:U,weakEquals:q,inNumberRange:K};function Z(e){return null==e||""===e}function X(e,t,n){return!!e&&!!e.autoRemove&&e.autoRemove(t,n)||void 0===t||"string"==typeof t&&!t}let W={sum:(e,t,n)=>n.reduce((t,n)=>{let l=n.getValue(e);return t+("number"==typeof l?l:0)},0),min:(e,t,n)=>{let l;return n.forEach(t=>{let n=t.getValue(e);null!=n&&(l>n||void 0===l&&n>=n)&&(l=n)}),l},max:(e,t,n)=>{let l;return n.forEach(t=>{let n=t.getValue(e);null!=n&&(l<n||void 0===l&&n>=n)&&(l=n)}),l},extent:(e,t,n)=>{let l,o;return n.forEach(t=>{let n=t.getValue(e);null!=n&&(void 0===l?n>=n&&(l=o=n):(l>n&&(l=n),o<n&&(o=n)))}),[l,o]},mean:(e,t)=>{let n=0,l=0;if(t.forEach(t=>{let o=t.getValue(e);null!=o&&(o*=1)>=o&&(++n,l+=o)}),n)return l/n},median:(e,t)=>{if(!t.length)return;let n=t.map(t=>t.getValue(e));if(!(Array.isArray(n)&&n.every(e=>"number"==typeof e)))return;if(1===n.length)return n[0];let l=Math.floor(n.length/2),o=n.sort((e,t)=>e-t);return n.length%2!=0?o[l]:(o[l-1]+o[l])/2},unique:(e,t)=>Array.from(new Set(t.map(t=>t.getValue(e))).values()),uniqueCount:(e,t)=>new Set(t.map(t=>t.getValue(e))).size,count:(e,t)=>t.length},J=()=>({left:[],right:[]}),Q={size:150,minSize:20,maxSize:Number.MAX_SAFE_INTEGER},Y=()=>({startOffset:null,startSize:null,deltaOffset:null,deltaPercentage:null,isResizingColumn:!1,columnSizingStart:[]}),ee=null;function et(e){return"touchstart"===e.type}function en(e,t){return t?"center"===t?e.getCenterVisibleLeafColumns():"left"===t?e.getLeftVisibleLeafColumns():e.getRightVisibleLeafColumns():e.getVisibleLeafColumns()}let el=()=>({pageIndex:0,pageSize:10}),eo=()=>({top:[],bottom:[]}),ei=(e,t,n,l,o)=>{var i;let a=o.getRow(t,!0);n?(a.getCanMultiSelect()||Object.keys(e).forEach(t=>delete e[t]),a.getCanSelect()&&(e[t]=!0)):delete e[t],l&&null!=(i=a.subRows)&&i.length&&a.getCanSelectSubRows()&&a.subRows.forEach(t=>ei(e,t.id,n,l,o))};function ea(e,t){let n=e.getState().rowSelection,l=[],o={},i=function(e,t){return e.map(e=>{var t;let a=er(e,n);if(a&&(l.push(e),o[e.id]=e),null!=(t=e.subRows)&&t.length&&(e={...e,subRows:i(e.subRows)}),a)return e}).filter(Boolean)};return{rows:i(t.rows),flatRows:l,rowsById:o}}function er(e,t){var n;return null!=(n=t[e.id])&&n}function es(e,t,n){var l;if(!(null!=(l=e.subRows)&&l.length))return!1;let o=!0,i=!1;return e.subRows.forEach(e=>{if((!i||o)&&(e.getCanSelect()&&(er(e,t)?i=!0:o=!1),e.subRows&&e.subRows.length)){let n=es(e,t);"all"===n?i=!0:("some"===n&&(i=!0),o=!1)}}),o?"all":!!i&&"some"}let ed=/([0-9]+)/gm;function eu(e,t){return e===t?0:e>t?1:-1}function eg(e){return"number"==typeof e?isNaN(e)||e===1/0||e===-1/0?"":String(e):"string"==typeof e?e:""}function ec(e,t){let n=e.split(ed).filter(Boolean),l=t.split(ed).filter(Boolean);for(;n.length&&l.length;){let e=n.shift(),t=l.shift(),o=parseInt(e,10),i=parseInt(t,10),a=[o,i].sort();if(isNaN(a[0])){if(e>t)return 1;if(t>e)return -1;continue}if(isNaN(a[1]))return isNaN(o)?-1:1;if(o>i)return 1;if(i>o)return -1}return n.length-l.length}let em={alphanumeric:(e,t,n)=>ec(eg(e.getValue(n)).toLowerCase(),eg(t.getValue(n)).toLowerCase()),alphanumericCaseSensitive:(e,t,n)=>ec(eg(e.getValue(n)),eg(t.getValue(n))),text:(e,t,n)=>eu(eg(e.getValue(n)).toLowerCase(),eg(t.getValue(n)).toLowerCase()),textCaseSensitive:(e,t,n)=>eu(eg(e.getValue(n)),eg(t.getValue(n))),datetime:(e,t,n)=>{let l=e.getValue(n),o=t.getValue(n);return l>o?1:l<o?-1:0},basic:(e,t,n)=>eu(e.getValue(n),t.getValue(n))},ep=[{createTable:e=>{e.getHeaderGroups=P(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(t,n,l,o)=>{var i,a;let r=null!=(i=null==l?void 0:l.map(e=>n.find(t=>t.id===e)).filter(Boolean))?i:[],s=null!=(a=null==o?void 0:o.map(e=>n.find(t=>t.id===e)).filter(Boolean))?a:[];return E(t,[...r,...n.filter(e=>!(null!=l&&l.includes(e.id))&&!(null!=o&&o.includes(e.id))),...s],e)},D(e.options,N,"getHeaderGroups")),e.getCenterHeaderGroups=P(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(t,n,l,o)=>E(t,n=n.filter(e=>!(null!=l&&l.includes(e.id))&&!(null!=o&&o.includes(e.id))),e,"center"),D(e.options,N,"getCenterHeaderGroups")),e.getLeftHeaderGroups=P(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left],(t,n,l)=>{var o;return E(t,null!=(o=null==l?void 0:l.map(e=>n.find(t=>t.id===e)).filter(Boolean))?o:[],e,"left")},D(e.options,N,"getLeftHeaderGroups")),e.getRightHeaderGroups=P(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.right],(t,n,l)=>{var o;return E(t,null!=(o=null==l?void 0:l.map(e=>n.find(t=>t.id===e)).filter(Boolean))?o:[],e,"right")},D(e.options,N,"getRightHeaderGroups")),e.getFooterGroups=P(()=>[e.getHeaderGroups()],e=>[...e].reverse(),D(e.options,N,"getFooterGroups")),e.getLeftFooterGroups=P(()=>[e.getLeftHeaderGroups()],e=>[...e].reverse(),D(e.options,N,"getLeftFooterGroups")),e.getCenterFooterGroups=P(()=>[e.getCenterHeaderGroups()],e=>[...e].reverse(),D(e.options,N,"getCenterFooterGroups")),e.getRightFooterGroups=P(()=>[e.getRightHeaderGroups()],e=>[...e].reverse(),D(e.options,N,"getRightFooterGroups")),e.getFlatHeaders=P(()=>[e.getHeaderGroups()],e=>e.map(e=>e.headers).flat(),D(e.options,N,"getFlatHeaders")),e.getLeftFlatHeaders=P(()=>[e.getLeftHeaderGroups()],e=>e.map(e=>e.headers).flat(),D(e.options,N,"getLeftFlatHeaders")),e.getCenterFlatHeaders=P(()=>[e.getCenterHeaderGroups()],e=>e.map(e=>e.headers).flat(),D(e.options,N,"getCenterFlatHeaders")),e.getRightFlatHeaders=P(()=>[e.getRightHeaderGroups()],e=>e.map(e=>e.headers).flat(),D(e.options,N,"getRightFlatHeaders")),e.getCenterLeafHeaders=P(()=>[e.getCenterFlatHeaders()],e=>e.filter(e=>{var t;return!(null!=(t=e.subHeaders)&&t.length)}),D(e.options,N,"getCenterLeafHeaders")),e.getLeftLeafHeaders=P(()=>[e.getLeftFlatHeaders()],e=>e.filter(e=>{var t;return!(null!=(t=e.subHeaders)&&t.length)}),D(e.options,N,"getLeftLeafHeaders")),e.getRightLeafHeaders=P(()=>[e.getRightFlatHeaders()],e=>e.filter(e=>{var t;return!(null!=(t=e.subHeaders)&&t.length)}),D(e.options,N,"getRightLeafHeaders")),e.getLeafHeaders=P(()=>[e.getLeftHeaderGroups(),e.getCenterHeaderGroups(),e.getRightHeaderGroups()],(e,t,n)=>{var l,o,i,a,r,s;return[...null!=(l=null==(o=e[0])?void 0:o.headers)?l:[],...null!=(i=null==(a=t[0])?void 0:a.headers)?i:[],...null!=(r=null==(s=n[0])?void 0:s.headers)?r:[]].map(e=>e.getLeafHeaders()).flat()},D(e.options,N,"getLeafHeaders"))}},{getInitialState:e=>({columnVisibility:{},...e}),getDefaultOptions:e=>({onColumnVisibilityChange:V("columnVisibility",e)}),createColumn:(e,t)=>{e.toggleVisibility=n=>{e.getCanHide()&&t.setColumnVisibility(t=>({...t,[e.id]:null!=n?n:!e.getIsVisible()}))},e.getIsVisible=()=>{var n,l;let o=e.columns;return null==(n=o.length?o.some(e=>e.getIsVisible()):null==(l=t.getState().columnVisibility)?void 0:l[e.id])||n},e.getCanHide=()=>{var n,l;return(null==(n=e.columnDef.enableHiding)||n)&&(null==(l=t.options.enableHiding)||l)},e.getToggleVisibilityHandler=()=>t=>{null==e.toggleVisibility||e.toggleVisibility(t.target.checked)}},createRow:(e,t)=>{e._getAllVisibleCells=P(()=>[e.getAllCells(),t.getState().columnVisibility],e=>e.filter(e=>e.column.getIsVisible()),D(t.options,"debugRows","_getAllVisibleCells")),e.getVisibleCells=P(()=>[e.getLeftVisibleCells(),e.getCenterVisibleCells(),e.getRightVisibleCells()],(e,t,n)=>[...e,...t,...n],D(t.options,"debugRows","getVisibleCells"))},createTable:e=>{let t=(t,n)=>P(()=>[n(),n().filter(e=>e.getIsVisible()).map(e=>e.id).join("_")],e=>e.filter(e=>null==e.getIsVisible?void 0:e.getIsVisible()),D(e.options,"debugColumns",t));e.getVisibleFlatColumns=t("getVisibleFlatColumns",()=>e.getAllFlatColumns()),e.getVisibleLeafColumns=t("getVisibleLeafColumns",()=>e.getAllLeafColumns()),e.getLeftVisibleLeafColumns=t("getLeftVisibleLeafColumns",()=>e.getLeftLeafColumns()),e.getRightVisibleLeafColumns=t("getRightVisibleLeafColumns",()=>e.getRightLeafColumns()),e.getCenterVisibleLeafColumns=t("getCenterVisibleLeafColumns",()=>e.getCenterLeafColumns()),e.setColumnVisibility=t=>null==e.options.onColumnVisibilityChange?void 0:e.options.onColumnVisibilityChange(t),e.resetColumnVisibility=t=>{var n;e.setColumnVisibility(t?{}:null!=(n=e.initialState.columnVisibility)?n:{})},e.toggleAllColumnsVisible=t=>{var n;t=null!=(n=t)?n:!e.getIsAllColumnsVisible(),e.setColumnVisibility(e.getAllLeafColumns().reduce((e,n)=>({...e,[n.id]:t||!(null!=n.getCanHide&&n.getCanHide())}),{}))},e.getIsAllColumnsVisible=()=>!e.getAllLeafColumns().some(e=>!(null!=e.getIsVisible&&e.getIsVisible())),e.getIsSomeColumnsVisible=()=>e.getAllLeafColumns().some(e=>null==e.getIsVisible?void 0:e.getIsVisible()),e.getToggleAllColumnsVisibilityHandler=()=>t=>{var n;e.toggleAllColumnsVisible(null==(n=t.target)?void 0:n.checked)}}},{getInitialState:e=>({columnOrder:[],...e}),getDefaultOptions:e=>({onColumnOrderChange:V("columnOrder",e)}),createColumn:(e,t)=>{e.getIndex=P(e=>[en(t,e)],t=>t.findIndex(t=>t.id===e.id),D(t.options,"debugColumns","getIndex")),e.getIsFirstColumn=n=>{var l;return(null==(l=en(t,n)[0])?void 0:l.id)===e.id},e.getIsLastColumn=n=>{var l;let o=en(t,n);return(null==(l=o[o.length-1])?void 0:l.id)===e.id}},createTable:e=>{e.setColumnOrder=t=>null==e.options.onColumnOrderChange?void 0:e.options.onColumnOrderChange(t),e.resetColumnOrder=t=>{var n;e.setColumnOrder(t?[]:null!=(n=e.initialState.columnOrder)?n:[])},e._getOrderColumnsFn=P(()=>[e.getState().columnOrder,e.getState().grouping,e.options.groupedColumnMode],(e,t,n)=>l=>{let o=[];if(null!=e&&e.length){let t=[...e],n=[...l];for(;n.length&&t.length;){let e=t.shift(),l=n.findIndex(t=>t.id===e);l>-1&&o.push(n.splice(l,1)[0])}o=[...o,...n]}else o=l;var i=o;if(!(null!=t&&t.length)||!n)return i;let a=i.filter(e=>!t.includes(e.id));return"remove"===n?a:[...t.map(e=>i.find(t=>t.id===e)).filter(Boolean),...a]},D(e.options,"debugTable","_getOrderColumnsFn"))}},{getInitialState:e=>({columnPinning:J(),...e}),getDefaultOptions:e=>({onColumnPinningChange:V("columnPinning",e)}),createColumn:(e,t)=>{e.pin=n=>{let l=e.getLeafColumns().map(e=>e.id).filter(Boolean);t.setColumnPinning(e=>{var t,o,i,a,r,s;return"right"===n?{left:(null!=(i=null==e?void 0:e.left)?i:[]).filter(e=>!(null!=l&&l.includes(e))),right:[...(null!=(a=null==e?void 0:e.right)?a:[]).filter(e=>!(null!=l&&l.includes(e))),...l]}:"left"===n?{left:[...(null!=(r=null==e?void 0:e.left)?r:[]).filter(e=>!(null!=l&&l.includes(e))),...l],right:(null!=(s=null==e?void 0:e.right)?s:[]).filter(e=>!(null!=l&&l.includes(e)))}:{left:(null!=(t=null==e?void 0:e.left)?t:[]).filter(e=>!(null!=l&&l.includes(e))),right:(null!=(o=null==e?void 0:e.right)?o:[]).filter(e=>!(null!=l&&l.includes(e)))}})},e.getCanPin=()=>e.getLeafColumns().some(e=>{var n,l,o;return(null==(n=e.columnDef.enablePinning)||n)&&(null==(l=null!=(o=t.options.enableColumnPinning)?o:t.options.enablePinning)||l)}),e.getIsPinned=()=>{let n=e.getLeafColumns().map(e=>e.id),{left:l,right:o}=t.getState().columnPinning,i=n.some(e=>null==l?void 0:l.includes(e)),a=n.some(e=>null==o?void 0:o.includes(e));return i?"left":!!a&&"right"},e.getPinnedIndex=()=>{var n,l;let o=e.getIsPinned();return o?null!=(n=null==(l=t.getState().columnPinning)||null==(l=l[o])?void 0:l.indexOf(e.id))?n:-1:0}},createRow:(e,t)=>{e.getCenterVisibleCells=P(()=>[e._getAllVisibleCells(),t.getState().columnPinning.left,t.getState().columnPinning.right],(e,t,n)=>{let l=[...null!=t?t:[],...null!=n?n:[]];return e.filter(e=>!l.includes(e.column.id))},D(t.options,"debugRows","getCenterVisibleCells")),e.getLeftVisibleCells=P(()=>[e._getAllVisibleCells(),t.getState().columnPinning.left],(e,t)=>(null!=t?t:[]).map(t=>e.find(e=>e.column.id===t)).filter(Boolean).map(e=>({...e,position:"left"})),D(t.options,"debugRows","getLeftVisibleCells")),e.getRightVisibleCells=P(()=>[e._getAllVisibleCells(),t.getState().columnPinning.right],(e,t)=>(null!=t?t:[]).map(t=>e.find(e=>e.column.id===t)).filter(Boolean).map(e=>({...e,position:"right"})),D(t.options,"debugRows","getRightVisibleCells"))},createTable:e=>{e.setColumnPinning=t=>null==e.options.onColumnPinningChange?void 0:e.options.onColumnPinningChange(t),e.resetColumnPinning=t=>{var n,l;return e.setColumnPinning(t?J():null!=(n=null==(l=e.initialState)?void 0:l.columnPinning)?n:J())},e.getIsSomeColumnsPinned=t=>{var n,l,o;let i=e.getState().columnPinning;return t?!!(null==(n=i[t])?void 0:n.length):!!((null==(l=i.left)?void 0:l.length)||(null==(o=i.right)?void 0:o.length))},e.getLeftLeafColumns=P(()=>[e.getAllLeafColumns(),e.getState().columnPinning.left],(e,t)=>(null!=t?t:[]).map(t=>e.find(e=>e.id===t)).filter(Boolean),D(e.options,"debugColumns","getLeftLeafColumns")),e.getRightLeafColumns=P(()=>[e.getAllLeafColumns(),e.getState().columnPinning.right],(e,t)=>(null!=t?t:[]).map(t=>e.find(e=>e.id===t)).filter(Boolean),D(e.options,"debugColumns","getRightLeafColumns")),e.getCenterLeafColumns=P(()=>[e.getAllLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(e,t,n)=>{let l=[...null!=t?t:[],...null!=n?n:[]];return e.filter(e=>!l.includes(e.id))},D(e.options,"debugColumns","getCenterLeafColumns"))}},{createColumn:(e,t)=>{e._getFacetedRowModel=t.options.getFacetedRowModel&&t.options.getFacetedRowModel(t,e.id),e.getFacetedRowModel=()=>e._getFacetedRowModel?e._getFacetedRowModel():t.getPreFilteredRowModel(),e._getFacetedUniqueValues=t.options.getFacetedUniqueValues&&t.options.getFacetedUniqueValues(t,e.id),e.getFacetedUniqueValues=()=>e._getFacetedUniqueValues?e._getFacetedUniqueValues():new Map,e._getFacetedMinMaxValues=t.options.getFacetedMinMaxValues&&t.options.getFacetedMinMaxValues(t,e.id),e.getFacetedMinMaxValues=()=>{if(e._getFacetedMinMaxValues)return e._getFacetedMinMaxValues()}}},{getDefaultColumnDef:()=>({filterFn:"auto"}),getInitialState:e=>({columnFilters:[],...e}),getDefaultOptions:e=>({onColumnFiltersChange:V("columnFilters",e),filterFromLeafRows:!1,maxLeafRowFilterDepth:100}),createColumn:(e,t)=>{e.getAutoFilterFn=()=>{let n=t.getCoreRowModel().flatRows[0],l=null==n?void 0:n.getValue(e.id);return"string"==typeof l?$.includesString:"number"==typeof l?$.inNumberRange:"boolean"==typeof l||null!==l&&"object"==typeof l?$.equals:Array.isArray(l)?$.arrIncludes:$.weakEquals},e.getFilterFn=()=>{var n,l;return k(e.columnDef.filterFn)?e.columnDef.filterFn:"auto"===e.columnDef.filterFn?e.getAutoFilterFn():null!=(n=null==(l=t.options.filterFns)?void 0:l[e.columnDef.filterFn])?n:$[e.columnDef.filterFn]},e.getCanFilter=()=>{var n,l,o;return(null==(n=e.columnDef.enableColumnFilter)||n)&&(null==(l=t.options.enableColumnFilters)||l)&&(null==(o=t.options.enableFilters)||o)&&!!e.accessorFn},e.getIsFiltered=()=>e.getFilterIndex()>-1,e.getFilterValue=()=>{var n;return null==(n=t.getState().columnFilters)||null==(n=n.find(t=>t.id===e.id))?void 0:n.value},e.getFilterIndex=()=>{var n,l;return null!=(n=null==(l=t.getState().columnFilters)?void 0:l.findIndex(t=>t.id===e.id))?n:-1},e.setFilterValue=n=>{t.setColumnFilters(t=>{var l,o;let i=e.getFilterFn(),a=null==t?void 0:t.find(t=>t.id===e.id),r=y(n,a?a.value:void 0);if(X(i,r,e))return null!=(l=null==t?void 0:t.filter(t=>t.id!==e.id))?l:[];let s={id:e.id,value:r};return a?null!=(o=null==t?void 0:t.map(t=>t.id===e.id?s:t))?o:[]:null!=t&&t.length?[...t,s]:[s]})}},createRow:(e,t)=>{e.columnFilters={},e.columnFiltersMeta={}},createTable:e=>{e.setColumnFilters=t=>{let n=e.getAllLeafColumns();null==e.options.onColumnFiltersChange||e.options.onColumnFiltersChange(e=>{var l;return null==(l=y(t,e))?void 0:l.filter(e=>{let t=n.find(t=>t.id===e.id);return!(t&&X(t.getFilterFn(),e.value,t))&&!0})})},e.resetColumnFilters=t=>{var n,l;e.setColumnFilters(t?[]:null!=(n=null==(l=e.initialState)?void 0:l.columnFilters)?n:[])},e.getPreFilteredRowModel=()=>e.getCoreRowModel(),e.getFilteredRowModel=()=>(!e._getFilteredRowModel&&e.options.getFilteredRowModel&&(e._getFilteredRowModel=e.options.getFilteredRowModel(e)),e.options.manualFiltering||!e._getFilteredRowModel)?e.getPreFilteredRowModel():e._getFilteredRowModel()}},{createTable:e=>{e._getGlobalFacetedRowModel=e.options.getFacetedRowModel&&e.options.getFacetedRowModel(e,"__global__"),e.getGlobalFacetedRowModel=()=>e.options.manualFiltering||!e._getGlobalFacetedRowModel?e.getPreFilteredRowModel():e._getGlobalFacetedRowModel(),e._getGlobalFacetedUniqueValues=e.options.getFacetedUniqueValues&&e.options.getFacetedUniqueValues(e,"__global__"),e.getGlobalFacetedUniqueValues=()=>e._getGlobalFacetedUniqueValues?e._getGlobalFacetedUniqueValues():new Map,e._getGlobalFacetedMinMaxValues=e.options.getFacetedMinMaxValues&&e.options.getFacetedMinMaxValues(e,"__global__"),e.getGlobalFacetedMinMaxValues=()=>{if(e._getGlobalFacetedMinMaxValues)return e._getGlobalFacetedMinMaxValues()}}},{getInitialState:e=>({globalFilter:void 0,...e}),getDefaultOptions:e=>({onGlobalFilterChange:V("globalFilter",e),globalFilterFn:"auto",getColumnCanGlobalFilter:t=>{var n;let l=null==(n=e.getCoreRowModel().flatRows[0])||null==(n=n._getAllCellsByColumnId()[t.id])?void 0:n.getValue();return"string"==typeof l||"number"==typeof l}}),createColumn:(e,t)=>{e.getCanGlobalFilter=()=>{var n,l,o,i;return(null==(n=e.columnDef.enableGlobalFilter)||n)&&(null==(l=t.options.enableGlobalFilter)||l)&&(null==(o=t.options.enableFilters)||o)&&(null==(i=null==t.options.getColumnCanGlobalFilter?void 0:t.options.getColumnCanGlobalFilter(e))||i)&&!!e.accessorFn}},createTable:e=>{e.getGlobalAutoFilterFn=()=>$.includesString,e.getGlobalFilterFn=()=>{var t,n;let{globalFilterFn:l}=e.options;return k(l)?l:"auto"===l?e.getGlobalAutoFilterFn():null!=(t=null==(n=e.options.filterFns)?void 0:n[l])?t:$[l]},e.setGlobalFilter=t=>{null==e.options.onGlobalFilterChange||e.options.onGlobalFilterChange(t)},e.resetGlobalFilter=t=>{e.setGlobalFilter(t?void 0:e.initialState.globalFilter)}}},{getInitialState:e=>({sorting:[],...e}),getDefaultColumnDef:()=>({sortingFn:"auto",sortUndefined:1}),getDefaultOptions:e=>({onSortingChange:V("sorting",e),isMultiSortEvent:e=>e.shiftKey}),createColumn:(e,t)=>{e.getAutoSortingFn=()=>{let n=t.getFilteredRowModel().flatRows.slice(10),l=!1;for(let t of n){let n=null==t?void 0:t.getValue(e.id);if("[object Date]"===Object.prototype.toString.call(n))return em.datetime;if("string"==typeof n&&(l=!0,n.split(ed).length>1))return em.alphanumeric}return l?em.text:em.basic},e.getAutoSortDir=()=>{let n=t.getFilteredRowModel().flatRows[0];return"string"==typeof(null==n?void 0:n.getValue(e.id))?"asc":"desc"},e.getSortingFn=()=>{var n,l;if(!e)throw Error();return k(e.columnDef.sortingFn)?e.columnDef.sortingFn:"auto"===e.columnDef.sortingFn?e.getAutoSortingFn():null!=(n=null==(l=t.options.sortingFns)?void 0:l[e.columnDef.sortingFn])?n:em[e.columnDef.sortingFn]},e.toggleSorting=(n,l)=>{let o=e.getNextSortingOrder(),i=null!=n;t.setSorting(a=>{let r,s=null==a?void 0:a.find(t=>t.id===e.id),d=null==a?void 0:a.findIndex(t=>t.id===e.id),u=[],g=i?n:"desc"===o;if("toggle"!=(r=null!=a&&a.length&&e.getCanMultiSort()&&l?s?"toggle":"add":null!=a&&a.length&&d!==a.length-1?"replace":s?"toggle":"replace")||i||o||(r="remove"),"add"===r){var c;(u=[...a,{id:e.id,desc:g}]).splice(0,u.length-(null!=(c=t.options.maxMultiSortColCount)?c:Number.MAX_SAFE_INTEGER))}else u="toggle"===r?a.map(t=>t.id===e.id?{...t,desc:g}:t):"remove"===r?a.filter(t=>t.id!==e.id):[{id:e.id,desc:g}];return u})},e.getFirstSortDir=()=>{var n,l;return(null!=(n=null!=(l=e.columnDef.sortDescFirst)?l:t.options.sortDescFirst)?n:"desc"===e.getAutoSortDir())?"desc":"asc"},e.getNextSortingOrder=n=>{var l,o;let i=e.getFirstSortDir(),a=e.getIsSorted();return a?(a===i||null!=(l=t.options.enableSortingRemoval)&&!l||!!n&&null!=(o=t.options.enableMultiRemove)&&!o)&&("desc"===a?"asc":"desc"):i},e.getCanSort=()=>{var n,l;return(null==(n=e.columnDef.enableSorting)||n)&&(null==(l=t.options.enableSorting)||l)&&!!e.accessorFn},e.getCanMultiSort=()=>{var n,l;return null!=(n=null!=(l=e.columnDef.enableMultiSort)?l:t.options.enableMultiSort)?n:!!e.accessorFn},e.getIsSorted=()=>{var n;let l=null==(n=t.getState().sorting)?void 0:n.find(t=>t.id===e.id);return!!l&&(l.desc?"desc":"asc")},e.getSortIndex=()=>{var n,l;return null!=(n=null==(l=t.getState().sorting)?void 0:l.findIndex(t=>t.id===e.id))?n:-1},e.clearSorting=()=>{t.setSorting(t=>null!=t&&t.length?t.filter(t=>t.id!==e.id):[])},e.getToggleSortingHandler=()=>{let n=e.getCanSort();return l=>{n&&(null==l.persist||l.persist(),null==e.toggleSorting||e.toggleSorting(void 0,!!e.getCanMultiSort()&&(null==t.options.isMultiSortEvent?void 0:t.options.isMultiSortEvent(l))))}}},createTable:e=>{e.setSorting=t=>null==e.options.onSortingChange?void 0:e.options.onSortingChange(t),e.resetSorting=t=>{var n,l;e.setSorting(t?[]:null!=(n=null==(l=e.initialState)?void 0:l.sorting)?n:[])},e.getPreSortedRowModel=()=>e.getGroupedRowModel(),e.getSortedRowModel=()=>(!e._getSortedRowModel&&e.options.getSortedRowModel&&(e._getSortedRowModel=e.options.getSortedRowModel(e)),e.options.manualSorting||!e._getSortedRowModel)?e.getPreSortedRowModel():e._getSortedRowModel()}},{getDefaultColumnDef:()=>({aggregatedCell:e=>{var t,n;return null!=(t=null==(n=e.getValue())||null==n.toString?void 0:n.toString())?t:null},aggregationFn:"auto"}),getInitialState:e=>({grouping:[],...e}),getDefaultOptions:e=>({onGroupingChange:V("grouping",e),groupedColumnMode:"reorder"}),createColumn:(e,t)=>{e.toggleGrouping=()=>{t.setGrouping(t=>null!=t&&t.includes(e.id)?t.filter(t=>t!==e.id):[...null!=t?t:[],e.id])},e.getCanGroup=()=>{var n,l;return(null==(n=e.columnDef.enableGrouping)||n)&&(null==(l=t.options.enableGrouping)||l)&&(!!e.accessorFn||!!e.columnDef.getGroupingValue)},e.getIsGrouped=()=>{var n;return null==(n=t.getState().grouping)?void 0:n.includes(e.id)},e.getGroupedIndex=()=>{var n;return null==(n=t.getState().grouping)?void 0:n.indexOf(e.id)},e.getToggleGroupingHandler=()=>{let t=e.getCanGroup();return()=>{t&&e.toggleGrouping()}},e.getAutoAggregationFn=()=>{let n=t.getCoreRowModel().flatRows[0],l=null==n?void 0:n.getValue(e.id);return"number"==typeof l?W.sum:"[object Date]"===Object.prototype.toString.call(l)?W.extent:void 0},e.getAggregationFn=()=>{var n,l;if(!e)throw Error();return k(e.columnDef.aggregationFn)?e.columnDef.aggregationFn:"auto"===e.columnDef.aggregationFn?e.getAutoAggregationFn():null!=(n=null==(l=t.options.aggregationFns)?void 0:l[e.columnDef.aggregationFn])?n:W[e.columnDef.aggregationFn]}},createTable:e=>{e.setGrouping=t=>null==e.options.onGroupingChange?void 0:e.options.onGroupingChange(t),e.resetGrouping=t=>{var n,l;e.setGrouping(t?[]:null!=(n=null==(l=e.initialState)?void 0:l.grouping)?n:[])},e.getPreGroupedRowModel=()=>e.getFilteredRowModel(),e.getGroupedRowModel=()=>(!e._getGroupedRowModel&&e.options.getGroupedRowModel&&(e._getGroupedRowModel=e.options.getGroupedRowModel(e)),e.options.manualGrouping||!e._getGroupedRowModel)?e.getPreGroupedRowModel():e._getGroupedRowModel()},createRow:(e,t)=>{e.getIsGrouped=()=>!!e.groupingColumnId,e.getGroupingValue=n=>{if(e._groupingValuesCache.hasOwnProperty(n))return e._groupingValuesCache[n];let l=t.getColumn(n);return null!=l&&l.columnDef.getGroupingValue?(e._groupingValuesCache[n]=l.columnDef.getGroupingValue(e.original),e._groupingValuesCache[n]):e.getValue(n)},e._groupingValuesCache={}},createCell:(e,t,n,l)=>{e.getIsGrouped=()=>t.getIsGrouped()&&t.id===n.groupingColumnId,e.getIsPlaceholder=()=>!e.getIsGrouped()&&t.getIsGrouped(),e.getIsAggregated=()=>{var t;return!e.getIsGrouped()&&!e.getIsPlaceholder()&&!!(null!=(t=n.subRows)&&t.length)}}},{getInitialState:e=>({expanded:{},...e}),getDefaultOptions:e=>({onExpandedChange:V("expanded",e),paginateExpandedRows:!0}),createTable:e=>{let t=!1,n=!1;e._autoResetExpanded=()=>{var l,o;if(!t)return void e._queue(()=>{t=!0});if(null!=(l=null!=(o=e.options.autoResetAll)?o:e.options.autoResetExpanded)?l:!e.options.manualExpanding){if(n)return;n=!0,e._queue(()=>{e.resetExpanded(),n=!1})}},e.setExpanded=t=>null==e.options.onExpandedChange?void 0:e.options.onExpandedChange(t),e.toggleAllRowsExpanded=t=>{(null!=t?t:!e.getIsAllRowsExpanded())?e.setExpanded(!0):e.setExpanded({})},e.resetExpanded=t=>{var n,l;e.setExpanded(t?{}:null!=(n=null==(l=e.initialState)?void 0:l.expanded)?n:{})},e.getCanSomeRowsExpand=()=>e.getPrePaginationRowModel().flatRows.some(e=>e.getCanExpand()),e.getToggleAllRowsExpandedHandler=()=>t=>{null==t.persist||t.persist(),e.toggleAllRowsExpanded()},e.getIsSomeRowsExpanded=()=>{let t=e.getState().expanded;return!0===t||Object.values(t).some(Boolean)},e.getIsAllRowsExpanded=()=>{let t=e.getState().expanded;return"boolean"==typeof t?!0===t:!(!Object.keys(t).length||e.getRowModel().flatRows.some(e=>!e.getIsExpanded()))},e.getExpandedDepth=()=>{let t=0;return(!0===e.getState().expanded?Object.keys(e.getRowModel().rowsById):Object.keys(e.getState().expanded)).forEach(e=>{let n=e.split(".");t=Math.max(t,n.length)}),t},e.getPreExpandedRowModel=()=>e.getSortedRowModel(),e.getExpandedRowModel=()=>(!e._getExpandedRowModel&&e.options.getExpandedRowModel&&(e._getExpandedRowModel=e.options.getExpandedRowModel(e)),e.options.manualExpanding||!e._getExpandedRowModel)?e.getPreExpandedRowModel():e._getExpandedRowModel()},createRow:(e,t)=>{e.toggleExpanded=n=>{t.setExpanded(l=>{var o;let i=!0===l||!!(null!=l&&l[e.id]),a={};if(!0===l?Object.keys(t.getRowModel().rowsById).forEach(e=>{a[e]=!0}):a=l,n=null!=(o=n)?o:!i,!i&&n)return{...a,[e.id]:!0};if(i&&!n){let{[e.id]:t,...n}=a;return n}return l})},e.getIsExpanded=()=>{var n;let l=t.getState().expanded;return!!(null!=(n=null==t.options.getIsRowExpanded?void 0:t.options.getIsRowExpanded(e))?n:!0===l||(null==l?void 0:l[e.id]))},e.getCanExpand=()=>{var n,l,o;return null!=(n=null==t.options.getRowCanExpand?void 0:t.options.getRowCanExpand(e))?n:(null==(l=t.options.enableExpanding)||l)&&!!(null!=(o=e.subRows)&&o.length)},e.getIsAllParentsExpanded=()=>{let n=!0,l=e;for(;n&&l.parentId;)n=(l=t.getRow(l.parentId,!0)).getIsExpanded();return n},e.getToggleExpandedHandler=()=>{let t=e.getCanExpand();return()=>{t&&e.toggleExpanded()}}}},{getInitialState:e=>({...e,pagination:{...el(),...null==e?void 0:e.pagination}}),getDefaultOptions:e=>({onPaginationChange:V("pagination",e)}),createTable:e=>{let t=!1,n=!1;e._autoResetPageIndex=()=>{var l,o;if(!t)return void e._queue(()=>{t=!0});if(null!=(l=null!=(o=e.options.autoResetAll)?o:e.options.autoResetPageIndex)?l:!e.options.manualPagination){if(n)return;n=!0,e._queue(()=>{e.resetPageIndex(),n=!1})}},e.setPagination=t=>null==e.options.onPaginationChange?void 0:e.options.onPaginationChange(e=>y(t,e)),e.resetPagination=t=>{var n;e.setPagination(t?el():null!=(n=e.initialState.pagination)?n:el())},e.setPageIndex=t=>{e.setPagination(n=>{let l=y(t,n.pageIndex);return l=Math.max(0,Math.min(l,void 0===e.options.pageCount||-1===e.options.pageCount?Number.MAX_SAFE_INTEGER:e.options.pageCount-1)),{...n,pageIndex:l}})},e.resetPageIndex=t=>{var n,l;e.setPageIndex(t?0:null!=(n=null==(l=e.initialState)||null==(l=l.pagination)?void 0:l.pageIndex)?n:0)},e.resetPageSize=t=>{var n,l;e.setPageSize(t?10:null!=(n=null==(l=e.initialState)||null==(l=l.pagination)?void 0:l.pageSize)?n:10)},e.setPageSize=t=>{e.setPagination(e=>{let n=Math.max(1,y(t,e.pageSize)),l=Math.floor(e.pageSize*e.pageIndex/n);return{...e,pageIndex:l,pageSize:n}})},e.setPageCount=t=>e.setPagination(n=>{var l;let o=y(t,null!=(l=e.options.pageCount)?l:-1);return"number"==typeof o&&(o=Math.max(-1,o)),{...n,pageCount:o}}),e.getPageOptions=P(()=>[e.getPageCount()],e=>{let t=[];return e&&e>0&&(t=[...Array(e)].fill(null).map((e,t)=>t)),t},D(e.options,"debugTable","getPageOptions")),e.getCanPreviousPage=()=>e.getState().pagination.pageIndex>0,e.getCanNextPage=()=>{let{pageIndex:t}=e.getState().pagination,n=e.getPageCount();return -1===n||0!==n&&t<n-1},e.previousPage=()=>e.setPageIndex(e=>e-1),e.nextPage=()=>e.setPageIndex(e=>e+1),e.firstPage=()=>e.setPageIndex(0),e.lastPage=()=>e.setPageIndex(e.getPageCount()-1),e.getPrePaginationRowModel=()=>e.getExpandedRowModel(),e.getPaginationRowModel=()=>(!e._getPaginationRowModel&&e.options.getPaginationRowModel&&(e._getPaginationRowModel=e.options.getPaginationRowModel(e)),e.options.manualPagination||!e._getPaginationRowModel)?e.getPrePaginationRowModel():e._getPaginationRowModel(),e.getPageCount=()=>{var t;return null!=(t=e.options.pageCount)?t:Math.ceil(e.getRowCount()/e.getState().pagination.pageSize)},e.getRowCount=()=>{var t;return null!=(t=e.options.rowCount)?t:e.getPrePaginationRowModel().rows.length}}},{getInitialState:e=>({rowPinning:eo(),...e}),getDefaultOptions:e=>({onRowPinningChange:V("rowPinning",e)}),createRow:(e,t)=>{e.pin=(n,l,o)=>{let i=l?e.getLeafRows().map(e=>{let{id:t}=e;return t}):[],a=new Set([...o?e.getParentRows().map(e=>{let{id:t}=e;return t}):[],e.id,...i]);t.setRowPinning(e=>{var t,l,o,i,r,s;return"bottom"===n?{top:(null!=(o=null==e?void 0:e.top)?o:[]).filter(e=>!(null!=a&&a.has(e))),bottom:[...(null!=(i=null==e?void 0:e.bottom)?i:[]).filter(e=>!(null!=a&&a.has(e))),...Array.from(a)]}:"top"===n?{top:[...(null!=(r=null==e?void 0:e.top)?r:[]).filter(e=>!(null!=a&&a.has(e))),...Array.from(a)],bottom:(null!=(s=null==e?void 0:e.bottom)?s:[]).filter(e=>!(null!=a&&a.has(e)))}:{top:(null!=(t=null==e?void 0:e.top)?t:[]).filter(e=>!(null!=a&&a.has(e))),bottom:(null!=(l=null==e?void 0:e.bottom)?l:[]).filter(e=>!(null!=a&&a.has(e)))}})},e.getCanPin=()=>{var n;let{enableRowPinning:l,enablePinning:o}=t.options;return"function"==typeof l?l(e):null==(n=null!=l?l:o)||n},e.getIsPinned=()=>{let n=[e.id],{top:l,bottom:o}=t.getState().rowPinning,i=n.some(e=>null==l?void 0:l.includes(e)),a=n.some(e=>null==o?void 0:o.includes(e));return i?"top":!!a&&"bottom"},e.getPinnedIndex=()=>{var n,l;let o=e.getIsPinned();if(!o)return -1;let i=null==(n="top"===o?t.getTopRows():t.getBottomRows())?void 0:n.map(e=>{let{id:t}=e;return t});return null!=(l=null==i?void 0:i.indexOf(e.id))?l:-1}},createTable:e=>{e.setRowPinning=t=>null==e.options.onRowPinningChange?void 0:e.options.onRowPinningChange(t),e.resetRowPinning=t=>{var n,l;return e.setRowPinning(t?eo():null!=(n=null==(l=e.initialState)?void 0:l.rowPinning)?n:eo())},e.getIsSomeRowsPinned=t=>{var n,l,o;let i=e.getState().rowPinning;return t?!!(null==(n=i[t])?void 0:n.length):!!((null==(l=i.top)?void 0:l.length)||(null==(o=i.bottom)?void 0:o.length))},e._getPinnedRows=(t,n,l)=>{var o;return(null==(o=e.options.keepPinnedRows)||o?(null!=n?n:[]).map(t=>{let n=e.getRow(t,!0);return n.getIsAllParentsExpanded()?n:null}):(null!=n?n:[]).map(e=>t.find(t=>t.id===e))).filter(Boolean).map(e=>({...e,position:l}))},e.getTopRows=P(()=>[e.getRowModel().rows,e.getState().rowPinning.top],(t,n)=>e._getPinnedRows(t,n,"top"),D(e.options,"debugRows","getTopRows")),e.getBottomRows=P(()=>[e.getRowModel().rows,e.getState().rowPinning.bottom],(t,n)=>e._getPinnedRows(t,n,"bottom"),D(e.options,"debugRows","getBottomRows")),e.getCenterRows=P(()=>[e.getRowModel().rows,e.getState().rowPinning.top,e.getState().rowPinning.bottom],(e,t,n)=>{let l=new Set([...null!=t?t:[],...null!=n?n:[]]);return e.filter(e=>!l.has(e.id))},D(e.options,"debugRows","getCenterRows"))}},{getInitialState:e=>({rowSelection:{},...e}),getDefaultOptions:e=>({onRowSelectionChange:V("rowSelection",e),enableRowSelection:!0,enableMultiRowSelection:!0,enableSubRowSelection:!0}),createTable:e=>{e.setRowSelection=t=>null==e.options.onRowSelectionChange?void 0:e.options.onRowSelectionChange(t),e.resetRowSelection=t=>{var n;return e.setRowSelection(t?{}:null!=(n=e.initialState.rowSelection)?n:{})},e.toggleAllRowsSelected=t=>{e.setRowSelection(n=>{t=void 0!==t?t:!e.getIsAllRowsSelected();let l={...n},o=e.getPreGroupedRowModel().flatRows;return t?o.forEach(e=>{e.getCanSelect()&&(l[e.id]=!0)}):o.forEach(e=>{delete l[e.id]}),l})},e.toggleAllPageRowsSelected=t=>e.setRowSelection(n=>{let l=void 0!==t?t:!e.getIsAllPageRowsSelected(),o={...n};return e.getRowModel().rows.forEach(t=>{ei(o,t.id,l,!0,e)}),o}),e.getPreSelectedRowModel=()=>e.getCoreRowModel(),e.getSelectedRowModel=P(()=>[e.getState().rowSelection,e.getCoreRowModel()],(t,n)=>Object.keys(t).length?ea(e,n):{rows:[],flatRows:[],rowsById:{}},D(e.options,"debugTable","getSelectedRowModel")),e.getFilteredSelectedRowModel=P(()=>[e.getState().rowSelection,e.getFilteredRowModel()],(t,n)=>Object.keys(t).length?ea(e,n):{rows:[],flatRows:[],rowsById:{}},D(e.options,"debugTable","getFilteredSelectedRowModel")),e.getGroupedSelectedRowModel=P(()=>[e.getState().rowSelection,e.getSortedRowModel()],(t,n)=>Object.keys(t).length?ea(e,n):{rows:[],flatRows:[],rowsById:{}},D(e.options,"debugTable","getGroupedSelectedRowModel")),e.getIsAllRowsSelected=()=>{let t=e.getFilteredRowModel().flatRows,{rowSelection:n}=e.getState(),l=!!(t.length&&Object.keys(n).length);return l&&t.some(e=>e.getCanSelect()&&!n[e.id])&&(l=!1),l},e.getIsAllPageRowsSelected=()=>{let t=e.getPaginationRowModel().flatRows.filter(e=>e.getCanSelect()),{rowSelection:n}=e.getState(),l=!!t.length;return l&&t.some(e=>!n[e.id])&&(l=!1),l},e.getIsSomeRowsSelected=()=>{var t;let n=Object.keys(null!=(t=e.getState().rowSelection)?t:{}).length;return n>0&&n<e.getFilteredRowModel().flatRows.length},e.getIsSomePageRowsSelected=()=>{let t=e.getPaginationRowModel().flatRows;return!e.getIsAllPageRowsSelected()&&t.filter(e=>e.getCanSelect()).some(e=>e.getIsSelected()||e.getIsSomeSelected())},e.getToggleAllRowsSelectedHandler=()=>t=>{e.toggleAllRowsSelected(t.target.checked)},e.getToggleAllPageRowsSelectedHandler=()=>t=>{e.toggleAllPageRowsSelected(t.target.checked)}},createRow:(e,t)=>{e.toggleSelected=(n,l)=>{let o=e.getIsSelected();t.setRowSelection(i=>{var a;if(n=void 0!==n?n:!o,e.getCanSelect()&&o===n)return i;let r={...i};return ei(r,e.id,n,null==(a=null==l?void 0:l.selectChildren)||a,t),r})},e.getIsSelected=()=>{let{rowSelection:n}=t.getState();return er(e,n)},e.getIsSomeSelected=()=>{let{rowSelection:n}=t.getState();return"some"===es(e,n)},e.getIsAllSubRowsSelected=()=>{let{rowSelection:n}=t.getState();return"all"===es(e,n)},e.getCanSelect=()=>{var n;return"function"==typeof t.options.enableRowSelection?t.options.enableRowSelection(e):null==(n=t.options.enableRowSelection)||n},e.getCanSelectSubRows=()=>{var n;return"function"==typeof t.options.enableSubRowSelection?t.options.enableSubRowSelection(e):null==(n=t.options.enableSubRowSelection)||n},e.getCanMultiSelect=()=>{var n;return"function"==typeof t.options.enableMultiRowSelection?t.options.enableMultiRowSelection(e):null==(n=t.options.enableMultiRowSelection)||n},e.getToggleSelectedHandler=()=>{let t=e.getCanSelect();return n=>{var l;t&&e.toggleSelected(null==(l=n.target)?void 0:l.checked)}}}},{getDefaultColumnDef:()=>Q,getInitialState:e=>({columnSizing:{},columnSizingInfo:Y(),...e}),getDefaultOptions:e=>({columnResizeMode:"onEnd",columnResizeDirection:"ltr",onColumnSizingChange:V("columnSizing",e),onColumnSizingInfoChange:V("columnSizingInfo",e)}),createColumn:(e,t)=>{e.getSize=()=>{var n,l,o;let i=t.getState().columnSizing[e.id];return Math.min(Math.max(null!=(n=e.columnDef.minSize)?n:Q.minSize,null!=(l=null!=i?i:e.columnDef.size)?l:Q.size),null!=(o=e.columnDef.maxSize)?o:Q.maxSize)},e.getStart=P(e=>[e,en(t,e),t.getState().columnSizing],(t,n)=>n.slice(0,e.getIndex(t)).reduce((e,t)=>e+t.getSize(),0),D(t.options,"debugColumns","getStart")),e.getAfter=P(e=>[e,en(t,e),t.getState().columnSizing],(t,n)=>n.slice(e.getIndex(t)+1).reduce((e,t)=>e+t.getSize(),0),D(t.options,"debugColumns","getAfter")),e.resetSize=()=>{t.setColumnSizing(t=>{let{[e.id]:n,...l}=t;return l})},e.getCanResize=()=>{var n,l;return(null==(n=e.columnDef.enableResizing)||n)&&(null==(l=t.options.enableColumnResizing)||l)},e.getIsResizing=()=>t.getState().columnSizingInfo.isResizingColumn===e.id},createHeader:(e,t)=>{e.getSize=()=>{let t=0,n=e=>{if(e.subHeaders.length)e.subHeaders.forEach(n);else{var l;t+=null!=(l=e.column.getSize())?l:0}};return n(e),t},e.getStart=()=>{if(e.index>0){let t=e.headerGroup.headers[e.index-1];return t.getStart()+t.getSize()}return 0},e.getResizeHandler=n=>{let l=t.getColumn(e.column.id),o=null==l?void 0:l.getCanResize();return i=>{if(!l||!o||(null==i.persist||i.persist(),et(i)&&i.touches&&i.touches.length>1))return;let a=e.getSize(),r=e?e.getLeafHeaders().map(e=>[e.column.id,e.column.getSize()]):[[l.id,l.getSize()]],s=et(i)?Math.round(i.touches[0].clientX):i.clientX,d={},u=(e,n)=>{"number"==typeof n&&(t.setColumnSizingInfo(e=>{var l,o;let i="rtl"===t.options.columnResizeDirection?-1:1,a=(n-(null!=(l=null==e?void 0:e.startOffset)?l:0))*i,r=Math.max(a/(null!=(o=null==e?void 0:e.startSize)?o:0),-.999999);return e.columnSizingStart.forEach(e=>{let[t,n]=e;d[t]=Math.round(100*Math.max(n+n*r,0))/100}),{...e,deltaOffset:a,deltaPercentage:r}}),("onChange"===t.options.columnResizeMode||"end"===e)&&t.setColumnSizing(e=>({...e,...d})))},g=e=>{u("end",e),t.setColumnSizingInfo(e=>({...e,isResizingColumn:!1,startOffset:null,startSize:null,deltaOffset:null,deltaPercentage:null,columnSizingStart:[]}))},c=n||("u">typeof document?document:null),m={moveHandler:e=>u("move",e.clientX),upHandler:e=>{null==c||c.removeEventListener("mousemove",m.moveHandler),null==c||c.removeEventListener("mouseup",m.upHandler),g(e.clientX)}},p={moveHandler:e=>(e.cancelable&&(e.preventDefault(),e.stopPropagation()),u("move",e.touches[0].clientX),!1),upHandler:e=>{var t;null==c||c.removeEventListener("touchmove",p.moveHandler),null==c||c.removeEventListener("touchend",p.upHandler),e.cancelable&&(e.preventDefault(),e.stopPropagation()),g(null==(t=e.touches[0])?void 0:t.clientX)}},f=!!function(){if("boolean"==typeof ee)return ee;let e=!1;try{let t=()=>{};window.addEventListener("test",t,{get passive(){return e=!0,!1}}),window.removeEventListener("test",t)}catch(t){e=!1}return ee=e}()&&{passive:!1};et(i)?(null==c||c.addEventListener("touchmove",p.moveHandler,f),null==c||c.addEventListener("touchend",p.upHandler,f)):(null==c||c.addEventListener("mousemove",m.moveHandler,f),null==c||c.addEventListener("mouseup",m.upHandler,f)),t.setColumnSizingInfo(e=>({...e,startOffset:s,startSize:a,deltaOffset:0,deltaPercentage:0,columnSizingStart:r,isResizingColumn:l.id}))}}},createTable:e=>{e.setColumnSizing=t=>null==e.options.onColumnSizingChange?void 0:e.options.onColumnSizingChange(t),e.setColumnSizingInfo=t=>null==e.options.onColumnSizingInfoChange?void 0:e.options.onColumnSizingInfoChange(t),e.resetColumnSizing=t=>{var n;e.setColumnSizing(t?{}:null!=(n=e.initialState.columnSizing)?n:{})},e.resetHeaderSizeInfo=t=>{var n;e.setColumnSizingInfo(t?Y():null!=(n=e.initialState.columnSizingInfo)?n:Y())},e.getTotalSize=()=>{var t,n;return null!=(t=null==(n=e.getHeaderGroups()[0])?void 0:n.headers.reduce((e,t)=>e+t.getSize(),0))?t:0},e.getLeftTotalSize=()=>{var t,n;return null!=(t=null==(n=e.getLeftHeaderGroups()[0])?void 0:n.headers.reduce((e,t)=>e+t.getSize(),0))?t:0},e.getCenterTotalSize=()=>{var t,n;return null!=(t=null==(n=e.getCenterHeaderGroups()[0])?void 0:n.headers.reduce((e,t)=>e+t.getSize(),0))?t:0},e.getRightTotalSize=()=>{var t,n;return null!=(t=null==(n=e.getRightHeaderGroups()[0])?void 0:n.headers.reduce((e,t)=>e+t.getSize(),0))?t:0}}}];function ef(e,t){var n,l,o;let i;return e?"function"==typeof(l=n=e)&&(i=Object.getPrototypeOf(l)).prototype&&i.prototype.isReactComponent||"function"==typeof n||"object"==typeof(o=n)&&"symbol"==typeof o.$$typeof&&["react.memo","react.forward_ref"].includes(o.$$typeof.description)?a.createElement(e,t):e:null}var eh=e.i(84774);function ex({columns:e,data:t}){let{t:l}=(0,i.useTranslation)(),o=function(e){let t={state:{},onStateChange:()=>{},renderFallbackValue:null,...e},[n]=a.useState(()=>({current:function(e){var t,n;let l=[...ep,...null!=(t=e._features)?t:[]],o={_features:l},i=o._features.reduce((e,t)=>Object.assign(e,null==t.getDefaultOptions?void 0:t.getDefaultOptions(o)),{}),a={...null!=(n=e.initialState)?n:{}};o._features.forEach(e=>{var t;a=null!=(t=null==e.getInitialState?void 0:e.getInitialState(a))?t:a});let r=[],s=!1,d={_features:l,options:{...i,...e},initialState:a,_queue:e=>{r.push(e),s||(s=!0,Promise.resolve().then(()=>{for(;r.length;)r.shift()();s=!1}).catch(e=>setTimeout(()=>{throw e})))},reset:()=>{o.setState(o.initialState)},setOptions:e=>{var t;t=y(e,o.options),o.options=o.options.mergeOptions?o.options.mergeOptions(i,t):{...i,...t}},getState:()=>o.options.state,setState:e=>{null==o.options.onStateChange||o.options.onStateChange(e)},_getRowId:(e,t,n)=>{var l;return null!=(l=null==o.options.getRowId?void 0:o.options.getRowId(e,t,n))?l:`${n?[n.id,t].join("."):t}`},getCoreRowModel:()=>(o._getCoreRowModel||(o._getCoreRowModel=o.options.getCoreRowModel(o)),o._getCoreRowModel()),getRowModel:()=>o.getPaginationRowModel(),getRow:(e,t)=>{let n=(t?o.getPrePaginationRowModel():o.getRowModel()).rowsById[e];if(!n&&!(n=o.getCoreRowModel().rowsById[e]))throw Error();return n},_getDefaultColumnDef:P(()=>[o.options.defaultColumn],e=>{var t;return e=null!=(t=e)?t:{},{header:e=>{let t=e.header.column.columnDef;return t.accessorKey?t.accessorKey:t.accessorFn?t.id:null},cell:e=>{var t,n;return null!=(t=null==(n=e.renderValue())||null==n.toString?void 0:n.toString())?t:null},...o._features.reduce((e,t)=>Object.assign(e,null==t.getDefaultColumnDef?void 0:t.getDefaultColumnDef()),{}),...e}},D(e,"debugColumns","_getDefaultColumnDef")),_getColumnDefs:()=>o.options.columns,getAllColumns:P(()=>[o._getColumnDefs()],e=>{let t=function(e,n,l){return void 0===l&&(l=0),e.map(e=>{let i=function(e,t,n,l){var o,i;let a,r={...e._getDefaultColumnDef(),...t},s=r.accessorKey,d=null!=(o=null!=(i=r.id)?i:s?"function"==typeof String.prototype.replaceAll?s.replaceAll(".","_"):s.replace(/\./g,"_"):void 0)?o:"string"==typeof r.header?r.header:void 0;if(r.accessorFn?a=r.accessorFn:s&&(a=s.includes(".")?e=>{let t=e;for(let e of s.split(".")){var n;t=null==(n=t)?void 0:n[e]}return t}:e=>e[r.accessorKey]),!d)throw Error();let u={id:`${String(d)}`,accessorFn:a,parent:l,depth:n,columnDef:r,columns:[],getFlatColumns:P(()=>[!0],()=>{var e;return[u,...null==(e=u.columns)?void 0:e.flatMap(e=>e.getFlatColumns())]},D(e.options,"debugColumns","column.getFlatColumns")),getLeafColumns:P(()=>[e._getOrderColumnsFn()],e=>{var t;return null!=(t=u.columns)&&t.length?e(u.columns.flatMap(e=>e.getLeafColumns())):[u]},D(e.options,"debugColumns","column.getLeafColumns"))};for(let t of e._features)null==t.createColumn||t.createColumn(u,e);return u}(o,e,l,n);return i.columns=e.columns?t(e.columns,i,l+1):[],i})};return t(e)},D(e,"debugColumns","getAllColumns")),getAllFlatColumns:P(()=>[o.getAllColumns()],e=>e.flatMap(e=>e.getFlatColumns()),D(e,"debugColumns","getAllFlatColumns")),_getAllFlatColumnsById:P(()=>[o.getAllFlatColumns()],e=>e.reduce((e,t)=>(e[t.id]=t,e),{}),D(e,"debugColumns","getAllFlatColumnsById")),getAllLeafColumns:P(()=>[o.getAllColumns(),o._getOrderColumnsFn()],(e,t)=>t(e.flatMap(e=>e.getLeafColumns())),D(e,"debugColumns","getAllLeafColumns")),getColumn:e=>o._getAllFlatColumnsById()[e]};Object.assign(o,d);for(let e=0;e<o._features.length;e++){let t=o._features[e];null==t||null==t.createTable||t.createTable(o)}return o}(t)})),[l,o]=a.useState(()=>n.current.initialState);return n.current.setOptions(t=>({...t,...e,state:{...l,...e.state},onStateChange:t=>{o(t),null==e.onStateChange||e.onStateChange(t)}})),n.current}({data:t,columns:e,getCoreRowModel:e=>P(()=>[e.options.data],t=>{let n={rows:[],flatRows:[],rowsById:{}},l=function(t,o,i){void 0===o&&(o=0);let a=[];for(let s=0;s<t.length;s++){let d=L(e,e._getRowId(t[s],s,i),t[s],s,o,void 0,null==i?void 0:i.id);if(n.flatRows.push(d),n.rowsById[d.id]=d,a.push(d),e.options.getSubRows){var r;d.originalSubRows=e.options.getSubRows(t[s],s),null!=(r=d.originalSubRows)&&r.length&&(d.subRows=l(d.originalSubRows,o+1,d))}}return a};return n.rows=l(t),n},D(e.options,"debugTable","getRowModel",()=>e._autoResetPageIndex()))});return(0,n.jsx)("div",{className:"rounded-md border",children:(0,n.jsxs)(eh.Table,{children:[(0,n.jsx)(eh.TableHeader,{children:o.getHeaderGroups().map(e=>(0,n.jsx)(eh.TableRow,{children:e.headers.map(e=>(0,n.jsx)(eh.TableHead,{children:e.isPlaceholder?null:ef(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),(0,n.jsx)(eh.TableBody,{children:o.getRowModel().rows?.length?o.getRowModel().rows.map(e=>(0,n.jsx)(eh.TableRow,{"data-state":e.getIsSelected()&&"selected",children:e.getVisibleCells().map(e=>(0,n.jsx)(eh.TableCell,{children:ef(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,n.jsx)(eh.TableRow,{children:(0,n.jsx)(eh.TableCell,{colSpan:e.length,className:"h-24 text-center",children:l("knowledge.documentsTab.noResults")})})})]})})}var eC=e.i(15288);function ev({kbId:e,onUploadSuccess:t,onUploadError:l}){let{t:o}=(0,i.useTranslation)(),[r,s]=(0,a.useState)(!1),[d,u]=(0,a.useState)(!1),c=(0,a.useCallback)(async n=>{if(d)return;if(n.size>0xa00000)return void R.toast.error(o("knowledge.documentsTab.fileSizeExceeded"));u(!0);let i=R.toast.loading(o("knowledge.documentsTab.uploadingFile"));try{let l=await g.httpClient.uploadDocumentFile(n);await g.httpClient.uploadKnowledgeBaseFile(e,l.file_id),R.toast.success(o("knowledge.documentsTab.uploadSuccess"),{id:i}),t()}catch(t){console.error("File upload failed:",t);let e=o("knowledge.documentsTab.uploadError");R.toast.error(e,{id:i}),l(e)}finally{u(!1)}},[e,d,t,l,o]),m=(0,a.useCallback)(e=>{e.preventDefault(),s(!0)},[]),p=(0,a.useCallback)(e=>{e.preventDefault(),s(!1)},[]),f=(0,a.useCallback)(e=>{e.preventDefault(),s(!1);let t=Array.from(e.dataTransfer.files);t.length>0&&c(t[0])},[c]),h=(0,a.useCallback)(e=>{let t=e.target.files;t&&t.length>0&&c(t[0])},[c]);return(0,n.jsx)(eC.Card,{className:"mb-4",children:(0,n.jsx)(eC.CardContent,{className:"p-4",children:(0,n.jsxs)("div",{className:`
            relative border-2 border-dashed rounded-lg p-4 text-center transition-colors
            ${r?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}
            ${d?"opacity-50 pointer-events-none":""}
          `,onDragOver:m,onDragLeave:p,onDrop:f,children:[(0,n.jsx)("input",{type:"file",id:"file-upload",className:"hidden",onChange:h,accept:".pdf,.doc,.docx,.txt,.md,.html,.zip",disabled:d}),(0,n.jsx)("label",{htmlFor:"file-upload",className:"cursor-pointer block",children:(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"mx-auto w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center",children:(0,n.jsx)("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-base font-medium text-gray-900 dark:text-gray-100",children:d?o("knowledge.documentsTab.uploading"):o("knowledge.documentsTab.dragAndDrop")}),(0,n.jsx)("p",{className:"text-xs text-gray-500 mt-1 dark:text-gray-400",children:o("knowledge.documentsTab.supportedFormats")})]})]})})]})})})}function eb({kbId:e}){let t,[l,o]=(0,a.useState)([]),{t:r}=(0,i.useTranslation)();async function s(){o((await g.httpClient.getKnowledgeBaseFiles(e)).files.map(e=>({uuid:e.uuid,name:e.file_name,status:e.status})))}return(0,a.useEffect)(()=>{s();let e=setInterval(()=>{s()},5e3);return()=>{clearInterval(e)}},[e]),(0,n.jsxs)("div",{className:"container mx-auto py-2",children:[(0,n.jsx)(ev,{kbId:e,onUploadSuccess:()=>{s()},onUploadError:e=>{console.error("Upload failed:",e)}}),(0,n.jsx)(ex,{columns:(t=t=>{g.httpClient.deleteKnowledgeBaseFile(e,t).then(()=>{s(),R.toast.success(r("knowledge.documentsTab.fileDeleteSuccess"))}).catch(e=>{console.error("Delete failed:",e),R.toast.error(r("knowledge.documentsTab.fileDeleteFailed"))})},[{accessorKey:"name",header:r("knowledge.documentsTab.name")},{accessorKey:"status",header:r("knowledge.documentsTab.status"),cell:({row:e})=>{let t=e.original;switch(t.status){case"processing":return(0,n.jsx)(M.Badge,{variant:"secondary",children:r("knowledge.documentsTab.processing")});case"completed":return(0,n.jsx)(M.Badge,{variant:"outline",className:"bg-blue-500 text-white",children:r("knowledge.documentsTab.completed")});case"failed":return(0,n.jsx)(M.Badge,{variant:"outline",className:"bg-yellow-500 text-white",children:r("knowledge.documentsTab.failed")});default:return(0,n.jsx)(M.Badge,{variant:"outline",className:"bg-gray-500 text-white",children:t.status})}}},{id:"actions",cell:({row:e})=>{let l=e.original;return(0,n.jsxs)(I.DropdownMenu,{children:[(0,n.jsx)(I.DropdownMenuTrigger,{asChild:!0,children:(0,n.jsxs)(f.Button,{variant:"ghost",className:"h-8 w-8 p-0",children:[(0,n.jsx)("span",{className:"sr-only",children:r("knowledge.documentsTab.actions")}),(0,n.jsx)(F.default,{className:"h-4 w-4"})]})}),(0,n.jsxs)(I.DropdownMenuContent,{align:"end",className:"bg-white dark:bg-[#2a2a2e]",children:[(0,n.jsx)(I.DropdownMenuLabel,{children:r("knowledge.documentsTab.actions")}),(0,n.jsx)(I.DropdownMenuItem,{onClick:()=>t(l.uuid),children:r("knowledge.documentsTab.delete")})]})]})}}]),data:l})]})}function ew({kbId:e}){let{t}=(0,i.useTranslation)(),[l,o]=(0,a.useState)(""),[r,s]=(0,a.useState)([]),[d,u]=(0,a.useState)([]),[c,m]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{try{let t=await g.httpClient.getKnowledgeBaseFiles(e);u(t.files)}catch(e){console.error("Failed to load files:",e)}})()},[e]);let p=async()=>{if(l.trim()){m(!0);try{s([]);let t=await g.httpClient.retrieveKnowledgeBase(e,l);s(t.results)}catch(e){console.error("Retrieve failed:",e),R.toast.error(t("knowledge.retrieveError"))}finally{m(!1)}}};return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(v.Input,{value:l,onChange:e=>o(e.target.value),placeholder:t("knowledge.queryPlaceholder"),onKeyPress:e=>"Enter"===e.key&&p()}),(0,n.jsx)(f.Button,{onClick:p,disabled:c||!l.trim(),children:t("knowledge.query")})]}),(0,n.jsxs)("div",{className:"space-y-3",children:[0===r.length&&!c&&(0,n.jsx)("p",{className:"text-muted-foreground",children:t("knowledge.noResults")}),c?(0,n.jsx)("p",{className:"text-muted-foreground",children:t("common.loading")}):r.map(e=>(0,n.jsxs)(eC.Card,{className:"w-full",children:[(0,n.jsx)(eC.CardHeader,{className:"pb-3",children:(0,n.jsxs)(eC.CardTitle,{className:"text-sm font-medium flex justify-between items-center",children:[(0,n.jsx)("span",{children:(e=>{if(!e)return"";let t=d.find(t=>t.uuid===e);return t?.file_name||e})(e.metadata.file_id)}),(0,n.jsxs)("span",{className:"text-xs text-muted-foreground",children:[t("knowledge.distance"),": ",e.distance.toFixed(4)]})]})}),(0,n.jsx)(eC.CardContent,{children:(0,n.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:(e=>{if(e.content&&Array.isArray(e.content)){let t=e.content.filter(e=>"text"===e.type&&e.text).map(e=>e.text);if(t.length>0)return t.join("\n\n")}return e.metadata?.text?e.metadata.text:""})(e)})})]},e.id))]})]})}var eS=e.i(1017),ej=e.i(268),eR=e.i(98787),e_=e.i(91967),eF=e.i(94185),eI=e.i(70672),eM=e.i(89268),ey=e.i(18666),eV=e.i(95204),ek=e.i(66094),eP=e.i(42951),eD=e.i(77720),eN="HoverCard",[eT,eE]=(0,eF.createContextScope)(eN,[ey.createPopperScope]),eL=(0,ey.createPopperScope)(),[eH,eA]=eT(eN),eB=e=>{let{__scopeHoverCard:t,children:l,open:o,defaultOpen:i,onOpenChange:r,openDelay:s=700,closeDelay:d=300}=e,u=eL(t),g=a.useRef(0),c=a.useRef(0),m=a.useRef(!1),p=a.useRef(!1),[f,h]=(0,eI.useControllableState)({prop:o,defaultProp:i??!1,onChange:r,caller:eN}),x=a.useCallback(()=>{clearTimeout(c.current),g.current=window.setTimeout(()=>h(!0),s)},[s,h]),C=a.useCallback(()=>{clearTimeout(g.current),m.current||p.current||(c.current=window.setTimeout(()=>h(!1),d))},[d,h]),v=a.useCallback(()=>h(!1),[h]);return a.useEffect(()=>()=>{clearTimeout(g.current),clearTimeout(c.current)},[]),(0,n.jsx)(eH,{scope:t,open:f,onOpenChange:h,onOpen:x,onClose:C,onDismiss:v,hasSelectionRef:m,isPointerDownOnContentRef:p,children:(0,n.jsx)(ey.Root,{...u,children:l})})};eB.displayName=eN;var ez="HoverCardTrigger",eG=a.forwardRef((e,t)=>{let{__scopeHoverCard:l,...o}=e,i=eA(ez,l),a=eL(l);return(0,n.jsx)(ey.Anchor,{asChild:!0,...a,children:(0,n.jsx)(eP.Primitive.a,{"data-state":i.open?"open":"closed",...o,ref:t,onPointerEnter:(0,e_.composeEventHandlers)(e.onPointerEnter,eW(i.onOpen)),onPointerLeave:(0,e_.composeEventHandlers)(e.onPointerLeave,eW(i.onClose)),onFocus:(0,e_.composeEventHandlers)(e.onFocus,i.onOpen),onBlur:(0,e_.composeEventHandlers)(e.onBlur,i.onClose),onTouchStart:(0,e_.composeEventHandlers)(e.onTouchStart,e=>e.preventDefault())})})});eG.displayName=ez;var eO="HoverCardPortal",[eU,eq]=eT(eO,{forceMount:void 0}),eK=e=>{let{__scopeHoverCard:t,forceMount:l,children:o,container:i}=e,a=eA(eO,t);return(0,n.jsx)(eU,{scope:t,forceMount:l,children:(0,n.jsx)(ek.Presence,{present:l||a.open,children:(0,n.jsx)(eV.Portal,{asChild:!0,container:i,children:o})})})};eK.displayName=eO;var e$="HoverCardContent",eZ=a.forwardRef((e,t)=>{let l=eq(e$,e.__scopeHoverCard),{forceMount:o=l.forceMount,...i}=e,a=eA(e$,e.__scopeHoverCard);return(0,n.jsx)(ek.Presence,{present:o||a.open,children:(0,n.jsx)(eX,{"data-state":a.open?"open":"closed",...i,onPointerEnter:(0,e_.composeEventHandlers)(e.onPointerEnter,eW(a.onOpen)),onPointerLeave:(0,e_.composeEventHandlers)(e.onPointerLeave,eW(a.onClose)),ref:t})})});eZ.displayName=e$;var eX=a.forwardRef((e,l)=>{let{__scopeHoverCard:o,onEscapeKeyDown:i,onPointerDownOutside:r,onFocusOutside:s,onInteractOutside:d,...u}=e,g=eA(e$,o),c=eL(o),m=a.useRef(null),p=(0,eM.useComposedRefs)(l,m),[f,h]=a.useState(!1);return a.useEffect(()=>{if(f){let e=document.body;return t=e.style.userSelect||e.style.webkitUserSelect,e.style.userSelect="none",e.style.webkitUserSelect="none",()=>{e.style.userSelect=t,e.style.webkitUserSelect=t}}},[f]),a.useEffect(()=>{if(m.current){let e=()=>{h(!1),g.isPointerDownOnContentRef.current=!1,setTimeout(()=>{document.getSelection()?.toString()!==""&&(g.hasSelectionRef.current=!0)})};return document.addEventListener("pointerup",e),()=>{document.removeEventListener("pointerup",e),g.hasSelectionRef.current=!1,g.isPointerDownOnContentRef.current=!1}}},[g.isPointerDownOnContentRef,g.hasSelectionRef]),a.useEffect(()=>{m.current&&(function(e){let t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});for(;n.nextNode();)t.push(n.currentNode);return t})(m.current).forEach(e=>e.setAttribute("tabindex","-1"))}),(0,n.jsx)(eD.DismissableLayer,{asChild:!0,disableOutsidePointerEvents:!1,onInteractOutside:d,onEscapeKeyDown:i,onPointerDownOutside:r,onFocusOutside:(0,e_.composeEventHandlers)(s,e=>{e.preventDefault()}),onDismiss:g.onDismiss,children:(0,n.jsx)(ey.Content,{...c,...u,onPointerDown:(0,e_.composeEventHandlers)(u.onPointerDown,e=>{e.currentTarget.contains(e.target)&&h(!0),g.hasSelectionRef.current=!1,g.isPointerDownOnContentRef.current=!0}),ref:p,style:{...u.style,userSelect:f?"text":void 0,WebkitUserSelect:f?"text":void 0,"--radix-hover-card-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-hover-card-content-available-width":"var(--radix-popper-available-width)","--radix-hover-card-content-available-height":"var(--radix-popper-available-height)","--radix-hover-card-trigger-width":"var(--radix-popper-anchor-width)","--radix-hover-card-trigger-height":"var(--radix-popper-anchor-height)"}})})});function eW(e){return t=>"touch"===t.pointerType?void 0:e()}a.forwardRef((e,t)=>{let{__scopeHoverCard:l,...o}=e,i=eL(l);return(0,n.jsx)(ey.Arrow,{...i,...o,ref:t})}).displayName="HoverCardArrow";var eJ=e.i(75157);function eQ({...e}){return(0,n.jsx)(eB,{"data-slot":"hover-card",...e})}function eY({...e}){return(0,n.jsx)(eG,{"data-slot":"hover-card-trigger",...e})}function e0({className:e,align:t="center",sideOffset:l=4,...o}){return(0,n.jsx)(eK,{"data-slot":"hover-card-portal",children:(0,n.jsx)(eZ,{"data-slot":"hover-card-content",align:t,sideOffset:l,className:(0,eJ.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-64 origin-(--radix-hover-card-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",e),...o})})}var e1=e.i(19159);function e2({initKBId:e,onFormSubmit:t,onKBDeleted:l,onNewKBCreated:o}){let r,{t:s}=(0,i.useTranslation)(),d=C.z.object({name:C.z.string().min(1,{message:s("knowledge.nameRequired")}),description:C.z.string().optional(),emoji:C.z.string().optional(),plugin_author:C.z.string().min(1,{message:"Please select a retriever"}),plugin_name:C.z.string().min(1,{message:"Please select a retriever"}),retriever_name:C.z.string().min(1,{message:"Please select a retriever"}),retriever_config:C.z.record(C.z.string(),C.z.any())}),u=(0,h.useForm)({resolver:(0,x.zodResolver)(d),defaultValues:{name:"",description:"",emoji:"ðŸ”—",plugin_author:"",plugin_name:"",retriever_name:"",retriever_config:{}}}),[c,p]=(0,a.useState)(!1),[S,_]=(0,a.useState)([]),[F,I]=(0,a.useState)(new Map),[M,y]=(0,a.useState)(!1),[V,k]=(0,a.useState)([]);async function P(){let t=await D();if(e)try{let n=await N(e);u.setValue("name",n.name),u.setValue("description",n.description||""),u.setValue("emoji",n.emoji||"ðŸ”—"),u.setValue("plugin_author",n.plugin_author),u.setValue("plugin_name",n.plugin_name),u.setValue("retriever_name",n.retriever_name),u.setValue("retriever_config",n.retriever_config);let l=`${n.plugin_author}/${n.plugin_name}/${n.retriever_name}`;T(l,t)}catch(e){R.toast.error("Failed to load KB config: "+e.message)}else u.reset()}async function D(){let e=await g.httpClient.listKnowledgeRetrievers();_(e.retrievers||[]);let t=new Map;return(e.retrievers||[]).forEach(e=>{let n=`${e.plugin_author}/${e.plugin_name}/${e.retriever_name}`,l=e.manifest?.manifest?.spec?.config||[];t.set(n,l.map(e=>new ej.DynamicFormItemConfig({default:e.default,id:eS.UUID.generate(),label:e.label,description:e.description,name:e.name,required:e.required,type:(0,ej.parseDynamicFormItemType)(e.type),options:e.options})))}),I(t),t}async function N(e){let t=(await g.httpClient.getExternalKnowledgeBase(e)).base;return{name:t.name,description:t.description,emoji:t.emoji||"ðŸ”—",plugin_author:t.plugin_author,plugin_name:t.plugin_name,retriever_name:t.retriever_name,retriever_config:t.retriever_config||{}}}function T(e,t){if(!e)return void y(!1);let n=(t||F).get(e);n&&n.length>0?(k(n),y(!0),t||u.setValue("retriever_config",(0,ej.getDefaultValues)(n))):(y(!1),t||u.setValue("retriever_config",{}))}function E(e){if(!e)return void y(!1);let t=e.split("/");3===t.length&&(u.setValue("plugin_author",t[0]),u.setValue("plugin_name",t[1]),u.setValue("retriever_name",t[2])),T(e)}(0,a.useEffect)(()=>{P()},[e]);let L=u.watch("plugin_author")&&u.watch("plugin_name")&&u.watch("retriever_name")?`${u.watch("plugin_author")}/${u.watch("plugin_name")}/${u.watch("retriever_name")}`:"";return(0,n.jsxs)("div",{children:[(0,n.jsx)(m.Dialog,{open:c,onOpenChange:p,children:(0,n.jsxs)(m.DialogContent,{children:[(0,n.jsx)(m.DialogHeader,{children:(0,n.jsx)(m.DialogTitle,{children:s("common.confirmDelete")})}),(0,n.jsx)(m.DialogDescription,{children:s("knowledge.deleteConfirmation")}),(0,n.jsxs)(m.DialogFooter,{children:[(0,n.jsx)(f.Button,{variant:"outline",onClick:()=>p(!1),children:s("common.cancel")}),(0,n.jsx)(f.Button,{variant:"destructive",onClick:()=>{e&&g.httpClient.deleteExternalKnowledgeBase(e).then(()=>{l(),R.toast.success(s("knowledge.deleteExternalSuccess"))}).catch(e=>{R.toast.error("Failed to delete KB: "+e.msg)}),p(!1)},children:s("common.confirmDelete")})]})]})}),(0,n.jsx)(w.Form,{...u,children:(0,n.jsx)("form",{id:"external-kb-form",onSubmit:u.handleSubmit(function(){let n={name:u.getValues().name,description:u.getValues().description||"",emoji:u.getValues().emoji,plugin_author:u.getValues().plugin_author,plugin_name:u.getValues().plugin_name,retriever_name:u.getValues().retriever_name,retriever_config:u.getValues().retriever_config};e?g.httpClient.updateExternalKnowledgeBase(e,{...n,uuid:e}).then(()=>{t(u.getValues()),R.toast.success(s("knowledge.updateExternalSuccess"))}).catch(e=>{R.toast.error("Failed to update KB: "+e.msg)}):g.httpClient.createExternalKnowledgeBase(n).then(e=>{R.toast.success(s("knowledge.createExternalSuccess")),o(e.uuid),u.reset()}).catch(e=>{R.toast.error("Failed to create KB: "+e.msg)})}),className:"space-y-8",children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex gap-4 items-start",children:[(0,n.jsx)(w.FormField,{control:u.control,name:"name",render:({field:e})=>(0,n.jsxs)(w.FormItem,{className:"flex-1",children:[(0,n.jsxs)(w.FormLabel,{children:[s("knowledge.kbName"),(0,n.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,n.jsx)(w.FormControl,{children:(0,n.jsx)(v.Input,{...e})}),(0,n.jsx)(w.FormMessage,{})]})}),(0,n.jsx)(w.FormField,{control:u.control,name:"emoji",render:({field:e})=>(0,n.jsxs)(w.FormItem,{children:[(0,n.jsx)(w.FormLabel,{children:s("common.icon")}),(0,n.jsx)(w.FormControl,{children:(0,n.jsx)(b.default,{value:e.value,onChange:e.onChange})}),(0,n.jsx)(w.FormMessage,{})]})})]}),(0,n.jsx)(w.FormField,{control:u.control,name:"description",render:({field:e})=>(0,n.jsxs)(w.FormItem,{children:[(0,n.jsx)(w.FormLabel,{children:s("knowledge.kbDescription")}),(0,n.jsx)(w.FormControl,{children:(0,n.jsx)(v.Input,{...e})}),(0,n.jsx)(w.FormMessage,{})]})}),(0,n.jsx)(w.FormField,{control:u.control,name:"retriever_name",render:()=>(0,n.jsxs)(w.FormItem,{children:[(0,n.jsxs)(w.FormLabel,{children:[s("knowledge.retriever"),(0,n.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,n.jsx)(w.FormControl,{children:(0,n.jsxs)(j.Select,{onValueChange:E,value:L,children:[(0,n.jsx)(j.SelectTrigger,{className:"w-full bg-[#ffffff] dark:bg-[#2a2a2e]",children:(0,n.jsx)(j.SelectValue,{placeholder:s("knowledge.selectRetriever")})}),(0,n.jsx)(j.SelectContent,{className:"fixed z-[1000]",children:(0,n.jsx)(j.SelectGroup,{children:S.map(e=>{let t=`${e.plugin_author}/${e.plugin_name}/${e.retriever_name}`,l=e.manifest?.manifest?.metadata?.label?(0,e1.extractI18nObject)(e.manifest.manifest.metadata.label):e.retriever_name,o=(0,e1.extractI18nObject)(e.retriever_description);return(0,n.jsxs)(eQ,{openDelay:0,closeDelay:0,children:[(0,n.jsx)(eY,{asChild:!0,children:(0,n.jsx)(j.SelectItem,{value:t,children:l})}),(0,n.jsx)(e0,{className:"w-80 data-[state=open]:animate-none",align:"end",side:"right",sideOffset:10,children:(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-start gap-3",children:[(0,n.jsx)("img",{src:g.httpClient.getPluginIconURL(e.plugin_author,e.plugin_name),alt:"plugin icon",className:"w-10 h-10 rounded-[8%] flex-shrink-0"}),(0,n.jsxs)("div",{className:"flex flex-col gap-1 flex-1 min-w-0",children:[(0,n.jsx)("h4",{className:"font-medium text-sm",children:l}),(0,n.jsxs)("p",{className:"text-xs text-muted-foreground",children:[e.plugin_author," /"," ",e.plugin_name]})]})]}),o&&(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:o})]})})]},t)})})})]})}),(0,n.jsx)(w.FormMessage,{}),(0,n.jsxs)("p",{className:"text-sm text-muted-foreground",children:[s("knowledge.retrieverInstallInfo")," ",(0,n.jsx)("a",{href:"https://space.langbot.app/market?category=KnowledgeRetriever",target:"_blank",rel:"noopener noreferrer",className:"text-primary underline hover:no-underline",children:s("knowledge.retrieverMarketLink")})]})]})}),L&&(0,n.jsxs)("div",{className:"flex items-start gap-3 p-4 rounded-lg border",children:[(0,n.jsx)("img",{src:g.httpClient.getPluginIconURL(u.watch("plugin_author"),u.watch("plugin_name")),alt:"plugin icon",className:"w-12 h-12 rounded-[8%] flex-shrink-0"}),(0,n.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,n.jsx)("div",{className:"font-medium",children:(r=S.find(e=>`${e.plugin_author}/${e.plugin_name}/${e.retriever_name}`===L),r?.manifest?.manifest?.metadata?.label?(0,e1.extractI18nObject)(r.manifest.manifest.metadata.label):L)}),(0,n.jsxs)("div",{className:"text-sm text-gray-500",children:[u.watch("plugin_author")," / ",u.watch("plugin_name")]})]})]}),M&&V.length>0&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{className:"text-lg font-medium",children:s("knowledge.retrieverConfiguration")}),(0,n.jsx)(eR.default,{itemConfigList:V,initialValues:u.watch("retriever_config"),onSubmit:e=>{u.setValue("retriever_config",e)}})]})]})})})]})}function e5({kbId:e,retrieveFunction:t,getResultTitle:l}){let{t:o}=(0,i.useTranslation)(),[r,s]=(0,a.useState)(""),[d,u]=(0,a.useState)([]),[g,c]=(0,a.useState)(!1),m=async()=>{if(r.trim()){c(!0);try{u([]);let n=await t(e,r);u(n.results)}catch(e){console.error("Retrieve failed:",e),R.toast.error(o("knowledge.retrieveError"))}finally{c(!1)}}};return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(v.Input,{value:r,onChange:e=>s(e.target.value),placeholder:o("knowledge.queryPlaceholder"),onKeyPress:e=>"Enter"===e.key&&m()}),(0,n.jsx)(f.Button,{onClick:m,disabled:g||!r.trim(),children:o("knowledge.query")})]}),(0,n.jsxs)("div",{className:"space-y-3",children:[0===d.length&&!g&&(0,n.jsx)("p",{className:"text-muted-foreground",children:o("knowledge.noResults")}),g?(0,n.jsx)("p",{className:"text-muted-foreground",children:o("common.loading")}):d.map(e=>(0,n.jsxs)(eC.Card,{className:"w-full",children:[(0,n.jsx)(eC.CardHeader,{className:"pb-3",children:(0,n.jsxs)(eC.CardTitle,{className:"text-sm font-medium flex justify-between items-center",children:[(0,n.jsx)("span",{children:l?l(e):e.metadata.file_id||e.metadata.document_name||e.id}),(0,n.jsxs)("span",{className:"text-xs text-muted-foreground",children:[o("knowledge.distance"),": ",e.distance.toFixed(4)]})]})}),(0,n.jsx)(eC.CardContent,{children:(0,n.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:(e=>{if(e.content&&Array.isArray(e.content)){let t=e.content.filter(e=>"text"===e.type&&e.text).map(e=>e.text);if(t.length>0)return t.join("\n\n")}return""})(e)})})]},e.id))]})]})}function e7({kbId:e}){return(0,n.jsx)(e5,{kbId:e,retrieveFunction:g.httpClient.retrieveExternalKnowledgeBase.bind(g.httpClient),getResultTitle:e=>e.metadata.document_name||e.metadata.source||e.id})}function e4({open:e,onOpenChange:t,kbId:l,kbType:o,onFormCancel:r,onKbDeleted:s,onNewKbCreated:d,onKbUpdated:u}){let{t:c}=(0,i.useTranslation)(),[h,x]=(0,a.useState)(l),[C,v]=(0,a.useState)("metadata"),[b,w]=(0,a.useState)(!1);(0,a.useEffect)(()=>{x(l),v("metadata")},[l,e]);let S=[{key:"metadata",label:c("knowledge.metadata"),icon:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,n.jsx)("path",{d:"M5 7C5 6.17157 5.67157 5.5 6.5 5.5C7.32843 5.5 8 6.17157 8 7C8 7.82843 7.32843 8.5 6.5 8.5C5.67157 8.5 5 7.82843 5 7ZM6.5 3.5C4.567 3.5 3 5.067 3 7C3 8.933 4.567 10.5 6.5 10.5C8.433 10.5 10 8.933 10 7C10 5.067 8.433 3.5 6.5 3.5ZM12 8H20V6H12V8ZM16 17C16 16.1716 16.6716 15.5 17.5 15.5C18.3284 15.5 19 16.1716 19 17C19 17.8284 18.3284 18.5 17.5 18.5C16.6716 18.5 16 17.8284 16 17ZM17.5 13.5C15.567 13.5 14 15.067 14 17C14 18.933 15.567 20.5 17.5 20.5C19.433 20.5 21 18.933 21 17C21 15.067 19.433 13.5 17.5 13.5ZM4 16V18H12V16H4Z"})})},..."builtin"===o?[{key:"documents",label:c("knowledge.documents"),icon:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,n.jsx)("path",{d:"M21 8V20.9932C21 21.5501 20.5552 22 20.0066 22H3.9934C3.44495 22 3 21.556 3 21.0082V2.9918C3 2.45531 3.4487 2 4.00221 2H14.9968L21 8ZM19 9H14V4H5V20H19V9ZM8 7H11V9H8V7ZM8 11H16V13H8V11ZM8 15H16V17H8V15Z"})})}]:[],{key:"retrieve",label:c("knowledge.retrieve"),icon:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,n.jsx)("path",{d:"M18.031 16.617l4.283 4.282-1.415 1.415-4.282-4.283A8.96 8.96 0 0 1 11 20c-4.968 0-9-4.032-9-9s4.032-9 9-9 9 4.032 9 9a8.96 8.96 0 0 1-1.969 5.617zm-2.006-.742A6.977 6.977 0 0 0 18 11c0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7a6.977 6.977 0 0 0 4.875-1.975l.15-.15z"})})}];return h?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m.Dialog,{open:e,onOpenChange:t,children:(0,n.jsx)(m.DialogContent,{className:"overflow-hidden p-0 !max-w-[50rem] max-h-[75vh] flex",children:(0,n.jsxs)(p.SidebarProvider,{className:"items-start w-full flex",children:[(0,n.jsx)(p.Sidebar,{collapsible:"none",className:"hidden md:flex h-[80vh] w-40 min-w-[120px] border-r bg-white dark:bg-black",children:(0,n.jsx)(p.SidebarContent,{children:(0,n.jsx)(p.SidebarGroup,{children:(0,n.jsx)(p.SidebarGroupContent,{children:(0,n.jsx)(p.SidebarMenu,{children:S.map(e=>(0,n.jsx)(p.SidebarMenuItem,{children:(0,n.jsx)(p.SidebarMenuButton,{asChild:!0,isActive:C===e.key,onClick:()=>v(e.key),children:(0,n.jsxs)("a",{href:"#",children:[e.icon,(0,n.jsx)("span",{children:e.label})]})})},e.key))})})})})}),(0,n.jsxs)("main",{className:"flex flex-1 flex-col h-[75vh]",children:[(0,n.jsx)(m.DialogHeader,{className:"px-6 pt-6 pb-4 shrink-0",children:(0,n.jsx)(m.DialogTitle,{children:c("metadata"===C?"knowledge.editKnowledgeBase":"documents"===C?"knowledge.editDocument":"knowledge.retrieveTest")})}),(0,n.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 pb-6",children:["metadata"===C&&("builtin"===o?(0,n.jsx)(_,{initKbId:h,onNewKbCreated:d,onKbUpdated:u}):(0,n.jsx)(e2,{initKBId:h,onFormSubmit:()=>t(!1),onKBDeleted:()=>{s(),t(!1)},onNewKBCreated:d})),"documents"===C&&"builtin"===o&&(0,n.jsx)(eb,{kbId:h}),"retrieve"===C&&("builtin"===o?(0,n.jsx)(ew,{kbId:h}):(0,n.jsx)(e7,{kbId:h}))]}),"metadata"===C&&(0,n.jsx)(m.DialogFooter,{className:"px-6 py-4 border-t shrink-0",children:(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)(f.Button,{type:"button",variant:"destructive",onClick:()=>w(!0),children:c("common.delete")}),(0,n.jsx)(f.Button,{type:"submit",form:"builtin"===o?"kb-form":"external-kb-form",children:c("common.save")}),(0,n.jsx)(f.Button,{type:"button",variant:"outline",onClick:r,children:c("common.cancel")})]})})]})]})})}),(0,n.jsx)(m.Dialog,{open:b,onOpenChange:w,children:(0,n.jsxs)(m.DialogContent,{children:[(0,n.jsx)(m.DialogHeader,{children:(0,n.jsx)(m.DialogTitle,{children:c("common.confirmDelete")})}),(0,n.jsx)("div",{className:"py-4",children:c("knowledge.deleteKnowledgeBaseConfirmation")}),(0,n.jsxs)(m.DialogFooter,{children:[(0,n.jsx)(f.Button,{variant:"outline",onClick:()=>w(!1),children:c("common.cancel")}),(0,n.jsx)(f.Button,{variant:"destructive",onClick:()=>{("builtin"===o?g.httpClient.deleteKnowledgeBase(h??""):g.httpClient.deleteExternalKnowledgeBase(h??"")).then(()=>{s()}),w(!1)},children:c("common.confirmDelete")})]})]})})]}):(0,n.jsx)(m.Dialog,{open:e,onOpenChange:t,children:(0,n.jsx)(m.DialogContent,{className:"overflow-hidden p-0 !max-w-[40vw] max-h-[70vh] flex",children:(0,n.jsxs)("main",{className:"flex flex-1 flex-col h-[70vh]",children:[(0,n.jsx)(m.DialogHeader,{className:"px-6 pt-6 pb-4 shrink-0",children:(0,n.jsx)(m.DialogTitle,{children:c("builtin"===o?"knowledge.createKnowledgeBase":"knowledge.addExternal")})}),(0,n.jsx)("div",{className:"flex-1 overflow-y-auto px-6 pb-6",children:"builtin"===o?(0,n.jsx)(_,{initKbId:void 0,onNewKbCreated:d,onKbUpdated:u}):(0,n.jsx)(e2,{initKBId:void 0,onFormSubmit:()=>t(!1),onKBDeleted:()=>{},onNewKBCreated:d})}),"metadata"===C&&(0,n.jsx)(m.DialogFooter,{className:"px-6 py-4 border-t shrink-0",children:(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)(f.Button,{type:"submit",form:"builtin"===o?"kb-form":"external-kb-form",children:c("common.save")}),(0,n.jsx)(f.Button,{type:"button",variant:"outline",onClick:r,children:c("common.cancel")})]})})]})})})}var e3=e.i(77572);function e8(){let{t:e}=(0,i.useTranslation)(),[t,d]=(0,a.useState)("builtin"),[m,p]=(0,a.useState)([]),[f,h]=(0,a.useState)([]),[x,C]=(0,a.useState)(""),[v,b]=(0,a.useState)("builtin"),[w,S]=(0,a.useState)(!1),[j,R]=(0,a.useState)(null);async function _(){try{let e=await g.httpClient.getPluginSystemStatus();R(e)}catch(e){console.error("Failed to fetch plugin system status:",e)}}async function F(){p((await g.httpClient.getKnowledgeBases()).bases.map(t=>{let n=new Date,l=Math.floor((n.getTime()-new Date(t.updated_at??n.getTime()).getTime())/1e3/60/60/24),o=l>0?` ${l} ${e("knowledge.daysAgo")}`:e("knowledge.today");return new r({id:t.uuid||"",name:t.name,description:t.description,emoji:t.emoji,embeddingModelUUID:t.embedding_model_uuid,top_k:t.top_k??5,lastUpdatedTimeAgo:o})}))}async function I(){try{let t=await g.httpClient.getExternalKnowledgeBases();h(t.bases.map(t=>{let n=new Date,l=Math.floor((n.getTime()-new Date(t.created_at??n.getTime()).getTime())/1e3/60/60/24),o=l>0?` ${l} ${e("knowledge.daysAgo")}`:e("knowledge.today");return new s({id:t.uuid||"",name:t.name,description:t.description,emoji:t.emoji,retrieverName:`${t.plugin_author}/${t.plugin_name}/${t.retriever_name}`,retrieverConfig:t.retriever_config||{},lastUpdatedTimeAgo:o,pluginAuthor:t.plugin_author,pluginName:t.plugin_name})}))}catch(e){console.error("Failed to load external knowledge bases:",e)}}return(0,a.useEffect)(()=>{F(),I(),_()},[]),(0,n.jsxs)("div",{children:[(0,n.jsx)(e4,{open:w,onOpenChange:S,kbId:x||void 0,kbType:v,onFormCancel:()=>{S(!1)},onKbDeleted:()=>{"builtin"===v?F():I(),S(!1)},onNewKbCreated:e=>{"builtin"===v?F():I(),C(e),S(!0)},onKbUpdated:()=>{"builtin"===v?F():I()}}),(0,n.jsxs)(e3.Tabs,{value:t,onValueChange:d,className:"w-full",children:[(0,n.jsx)("div",{className:"flex flex-row justify-between items-center px-[0.8rem]",children:(0,n.jsxs)(e3.TabsList,{className:"shadow-md py-5 bg-[#f0f0f0] dark:bg-[#2a2a2e]",children:[(0,n.jsx)(e3.TabsTrigger,{value:"builtin",className:"px-6 py-4 cursor-pointer",children:e("knowledge.builtIn")}),j?.is_enable&&j?.is_connected&&(0,n.jsx)(e3.TabsTrigger,{value:"external",className:"px-6 py-4 cursor-pointer",children:e("knowledge.external")})]})}),(0,n.jsx)(e3.TabsContent,{value:"builtin",children:(0,n.jsxs)("div",{className:o.default.knowledgeListContainer,children:[(0,n.jsx)(l.default,{width:"100%",height:"10rem",plusSize:"90px",onClick:()=>{C(""),b("builtin"),S(!0)}}),m.map(e=>(0,n.jsx)("div",{onClick:()=>{C(e.id),b("builtin"),S(!0)},children:(0,n.jsx)(u,{kbCardVO:e})},e.id))]})}),(0,n.jsx)(e3.TabsContent,{value:"external",children:(0,n.jsxs)("div",{className:o.default.knowledgeListContainer,children:[(0,n.jsx)(l.default,{width:"100%",height:"10rem",plusSize:"90px",onClick:()=>{C(""),b("external"),S(!0)}}),f.map(e=>(0,n.jsx)("div",{onClick:()=>{C(e.id),b("external"),S(!0)},children:(0,n.jsx)(c,{kbCardVO:e})},e.id))]})})]})]})}e.s(["default",()=>e8],88208)}]);