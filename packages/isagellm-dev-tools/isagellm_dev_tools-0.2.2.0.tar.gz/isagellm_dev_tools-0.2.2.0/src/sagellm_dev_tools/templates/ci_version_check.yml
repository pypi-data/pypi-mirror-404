  # ─────────────────────────────────────────────────────────────────
  # Version Check - Ensure tool versions match between local and CI
  # ─────────────────────────────────────────────────────────────────
version-check:
  name: Check Tool Versions
  runs-on: self-hosted
  steps:
  - uses: actions/checkout@v4

  - name: Set up Python
    uses: actions/setup-python@v5
    with:
      python-version: "3.11"

  - name: Install ruff
    run: |
      python -m pip install --upgrade pip
      pip install ruff

  - name: Check ruff version consistency
    run: |
      # Get local ruff version
      LOCAL_RUFF=$(ruff --version | awk '{print $2}')
      echo "Local ruff: $LOCAL_RUFF"

      # Get pre-commit config ruff version
      if [ -f .pre-commit-config.yaml ]; then
        PRECOMMIT_RUFF=$(grep -A 2 'ruff-pre-commit' .pre-commit-config.yaml | grep 'rev:' | awk '{print $2}' | sed 's/v//')
        echo "Pre-commit ruff: v$PRECOMMIT_RUFF"

        # Compare versions
        if [ "$LOCAL_RUFF" != "$PRECOMMIT_RUFF" ]; then
          echo "::error::❌ Version mismatch! Local ruff ($LOCAL_RUFF) != pre-commit ruff (v$PRECOMMIT_RUFF)"
          echo ""
          echo "To fix this, run:"
          echo "  pip install ruff==$PRECOMMIT_RUFF"
          echo "Or update .pre-commit-config.yaml:"
          echo "  pre-commit autoupdate"
          exit 1
        fi

        echo "✅ Versions match: $LOCAL_RUFF"
      else
        echo "⚠️  No .pre-commit-config.yaml found, skipping check"
      fi
