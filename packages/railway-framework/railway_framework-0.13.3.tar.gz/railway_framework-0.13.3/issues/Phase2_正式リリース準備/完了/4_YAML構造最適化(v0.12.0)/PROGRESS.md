# Phase 2: 正式リリース準備 進捗

## YAML 構造変更（終端ノード対応）

**計画書:** [000_YAML構造変更実装計画.md](./000_YAML構造変更実装計画.md)
**ADR:** [ADR-004](../../docs/adr/004_exit_node_design.md)

### 設計方針

- **後方互換性は不要:** 旧 `exits` セクションは削除
- **終端ノードは Context のみを返す:** Outcome は不要（遷移先がないため）
- **TDD:** テストファーストで実装
- **純粋関数:** 副作用のない関数で実装
- **DRY:** YAML の `start` から自動的に実行できる `run()` ヘルパーを生成
- **開始ノードは引数を受け取る:** `def start(ctx) -> tuple[Context, Outcome]`

---

### Issue 進捗（実装順）

| 順 | # | タイトル | 状態 | 依存 |
|----|---|----------|------|------|
| 1 | **23** | **テスト用 YAML フィクスチャ** | **完了** | - |
| 2 | 24 | NodeDefinition の終端ノード対応 | 完了 | #23 |
| 3 | 25 | パーサーのネスト構造対応（自動解決含む） | 完了 | #23, #24 |
| 4a | **26** | **バリデーション更新** | **完了** | #24, #25 |
| 4b | 27 | codegen の終端ノード対応 | 完了 | #24, #25 |
| 4c | **32** | **YAML 構造変換ユーティリティ** | **完了** | #25 |
| 5 | 28 | dag_runner の終端ノード実行 | 完了 | #27 |
| 6a | 31 | codegen に run() ヘルパー追加 | 完了 | #27, #28 |
| 6b | **33** | **v0.11.3 → v0.12.0 マイグレーション** | **完了** | #32 |
| 7 | **30** | **E2E 統合テスト** | **完了** | #26, #27, #28, #31, #33 |
| 8 | 29 | 終端ノードドキュメント追加 | 完了 | #30 |

**Note:** 同じ順序番号（4a/4b/4c, 6a/6b）は並列実行可能

---

### 着手順序（修正版）

```
                    ┌─────────────────────────────────────────────────────┐
                    │                    実装フェーズ                       │
                    ├─────────────────────────────────────────────────────┤
                    │                                                     │
Phase 0: テストデータ │                                                     │
                    │  ┌──────────────────┐                               │
                    │  │ #23 YAML フィクスチャ │                               │
                    │  └────────┬─────────┘                               │
                    │           │                                         │
Phase 1: 基盤整備   │           ▼                                         │
                    │  ┌──────────────────┐                               │
                    │  │ #24 NodeDefinition │                               │
                    │  └────────┬─────────┘                               │
                    │           │                                         │
Phase 2: パーサー   │           ▼                                         │
                    │  ┌──────────────────┐                               │
                    │  │ #25 パーサー      │                               │
                    │  └────────┬─────────┘                               │
                    │           │                                         │
                    │     ┌─────┼─────────────┐                           │
Phase 3: 検証&生成  │     ▼     ▼             ▼                           │
                    │  ┌────────┐ ┌────────┐ ┌────────┐                   │
                    │  │ #26    │ │ #27    │ │ #32    │ ← 並列実行可能    │
                    │  │Validator│ │codegen │ │YAML変換│                   │
                    │  └────┬───┘ └────┬───┘ └────┬───┘                   │
                    │       │          │          │                       │
Phase 4: ランタイム │       └────┬─────┘          │                       │
                    │            ▼                │                       │
                    │       ┌──────────┐          │                       │
                    │       │ #28      │          │                       │
                    │       │dag_runner│          │                       │
                    │       └────┬─────┘          │                       │
                    │            │                │                       │
Phase 5: ヘルパー   │            ▼                ▼                       │
                    │       ┌──────────┐    ┌──────────┐                  │
                    │       │ #31      │    │ #33      │                  │
                    │       │run helper│    │migration │                  │
                    │       └────┬─────┘    └────┬─────┘                  │
                    │            │               │                        │
Phase 6: 統合&文書  │            └───────┬───────┘                        │
                    │                    ▼                                │
                    │              ┌──────────┐                           │
                    │              │ #30 E2E  │                           │
                    │              └────┬─────┘                           │
                    │                   │                                 │
                    │                   ▼                                 │
                    │              ┌──────────┐                           │
                    │              │ #29 Docs │                           │
                    │              └──────────┘                           │
                    │                                                     │
                    └─────────────────────────────────────────────────────┘
```

**クリティカルパス:**
```
#23 → #24 → #25 → #27 → #28 → #31 → #30 → #29
                 ↘ #32 → #33 ↗
```

**並列実行可能:**
- Phase 3: #26, #27, #32
- Phase 5: #31, #33（#32 完了後）

**重要:**
- #27 と #28 は並列実行**不可**（#28 は #27 が生成する EXIT_CODES に依存）
- #26 と #28 は独立（dag_runner はバリデーション結果を直接使用しない）

**TDD 実装方針:**
- 各 issue で Red → Green → Refactor サイクルを実施
- テストは極力パブリック API 経由
- 純粋関数・イミュータブルなデータ構造を使用

---

### 完了した Issue

完了後は `完了/4/` ディレクトリに移動。

---

## 完了済み Issue（別ディレクトリ）

- `完了/1/` - バージョン管理、railway update コマンド
- `完了/2/` - DAG Workflow ネイティブサポート
- `完了/3_railway_update最新化/` - railway update 最新化
