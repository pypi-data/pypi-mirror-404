\section{Makefile for this framework}\label{Makefile}% ===> this file was generated automatically by noweave --- better not edit it

The {\Tt{}Makefile\nwendquote} for this repository should provide instructions to make all 
the files needed by this framework along with its documentation 
({\Tt{}makefiles.pdf\nwendquote}).
\nwfilename{Makefile.nw}\nwbegincode{1}\sublabel{NWvemS6-3SV3HJ-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWvemS6-3SV3HJ-1}}}\moddef{\code{}Makefile\edoc{}~{\nwtagstyle{}\subpageref{NWvemS6-3SV3HJ-1}}}\endmoddef\nwstartdeflinemarkup\nwprevnextdefs{\relax}{NWvemS6-3SV3HJ-2}\nwenddeflinemarkup
MKFILES+=     portability.mk subdir.mk
MKFILES+=     pkg.mk pub.mk transform.mk
MKFILES+=     tex.mk doc.mk
MKFILES+=     noweb.mk haskell.mk
MKFILES+=     exam.mk results.mk

OTHERS+=      latexmkrc
OTHERS+=      gitattributes
OTHERS+=      Dockerfile

.PHONY: all
all: makefiles.pdf
all: $\{MKFILES\}
all: $\{OTHERS\}

\LA{}Makefile target~{\nwtagstyle{}\subpageref{NWvemS6-EvZu1-1}}\RA{}
\LA{}Dockerfile target~{\nwtagstyle{}\subpageref{NWvemS6-3wP1IH-1}}\RA{}
\LA{}makefiles.pdf target~{\nwtagstyle{}\subpageref{NWvemS6-2fZ5nF-1}}\RA{}
\LA{}MKFILES targets~{\nwtagstyle{}\subpageref{NWvemS6-2mrlqb-1}}\RA{}
\LA{}OTHERS targets~{\nwtagstyle{}\subpageref{NWvemS6-3wr0FJ-1}}\RA{}
\nwalsodefined{\\{NWvemS6-3SV3HJ-2}\\{NWvemS6-3SV3HJ-3}\\{NWvemS6-3SV3HJ-4}\\{NWvemS6-3SV3HJ-5}}\nwnotused{[[Makefile]]}\nwendcode{}\nwbegindocs{2}\nwdocspar

It also provides targets for creating a Docker image from the {\Tt{}Dockerfile\nwendquote} 
and pushing it to Docker Hub.
\nwenddocs{}\nwbegincode{3}\sublabel{NWvemS6-3SV3HJ-2}\nwmargintag{{\nwtagstyle{}\subpageref{NWvemS6-3SV3HJ-2}}}\moddef{\code{}Makefile\edoc{}~{\nwtagstyle{}\subpageref{NWvemS6-3SV3HJ-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NWvemS6-3SV3HJ-1}{NWvemS6-3SV3HJ-3}\nwenddeflinemarkup
DOCKER_ID_USER?=dbosk

.PHONY: docker-makefiles push
docker-makefiles: Dockerfile
  \LA{}Docker image recipe~{\nwtagstyle{}\subpageref{NWvemS6-1uyUCW-1}}\RA{}

push: docker-makefiles
  \LA{}Docker push recipe~{\nwtagstyle{}\subpageref{NWvemS6-OdjRL-1}}\RA{}
\nwendcode{}\nwbegindocs{4}\nwdocspar

We also use the package framework ({\Tt{}pkg.mk\nwendquote}) to provide a package which can 
install the makefiles on the system.
\nwenddocs{}\nwbegincode{5}\sublabel{NWvemS6-3SV3HJ-3}\nwmargintag{{\nwtagstyle{}\subpageref{NWvemS6-3SV3HJ-3}}}\moddef{\code{}Makefile\edoc{}~{\nwtagstyle{}\subpageref{NWvemS6-3SV3HJ-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NWvemS6-3SV3HJ-2}{NWvemS6-3SV3HJ-4}\nwenddeflinemarkup
\LA{}package setup~{\nwtagstyle{}\subpageref{NWvemS6-F4ErS-1}}\RA{}
\nwendcode{}\nwbegindocs{6}\nwdocspar

We also need the standard targets for cleaning and some include files.
\nwenddocs{}\nwbegincode{7}\sublabel{NWvemS6-3SV3HJ-4}\nwmargintag{{\nwtagstyle{}\subpageref{NWvemS6-3SV3HJ-4}}}\moddef{\code{}Makefile\edoc{}~{\nwtagstyle{}\subpageref{NWvemS6-3SV3HJ-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NWvemS6-3SV3HJ-3}{NWvemS6-3SV3HJ-5}\nwenddeflinemarkup
.PHONY: clean distclean
clean:
  \LA{}clean recipe~{\nwtagstyle{}\subpageref{NWvemS6-mtljB-1}}\RA{}

distclean:
  \LA{}distclean recipe~{\nwtagstyle{}\subpageref{NWvemS6-1Hidyl-1}}\RA{}
\nwendcode{}\nwbegindocs{8}\nwdocspar

Finally, we need some include files from this very framework.
\nwenddocs{}\nwbegincode{9}\sublabel{NWvemS6-3SV3HJ-5}\nwmargintag{{\nwtagstyle{}\subpageref{NWvemS6-3SV3HJ-5}}}\moddef{\code{}Makefile\edoc{}~{\nwtagstyle{}\subpageref{NWvemS6-3SV3HJ-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NWvemS6-3SV3HJ-4}{\relax}\nwenddeflinemarkup
INCLUDE_MAKEFILES=.
MAKEFILES_INCLUDE=$\{INCLUDE_MAKEFILES\}
\LA{}include files~{\nwtagstyle{}\subpageref{NWvemS6-cyS7L-1}}\RA{}
\nwendcode{}\nwbegindocs{10}\nwdocspar

\subsection{This {\Tt{}Makefile\nwendquote}'s target}

We also must add a target for this {\Tt{}Makefile\nwendquote} itself.
\nwenddocs{}\nwbegincode{11}\sublabel{NWvemS6-EvZu1-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWvemS6-EvZu1-1}}}\moddef{Makefile target~{\nwtagstyle{}\subpageref{NWvemS6-EvZu1-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWvemS6-3SV3HJ-1}}\nwenddeflinemarkup
Makefile: Makefile.nw
  $\{NOTANGLE.mk\}
\nwused{\\{NWvemS6-3SV3HJ-1}}\nwendcode{}\nwbegindocs{12}\nwdocspar

\subsection{Tangling, weaving and compiling LaTeX}

The documentation depends on the main TeX file, preamble and 
bibliographies.
\nwenddocs{}\nwbegincode{13}\sublabel{NWvemS6-2fZ5nF-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWvemS6-2fZ5nF-1}}}\moddef{makefiles.pdf target~{\nwtagstyle{}\subpageref{NWvemS6-2fZ5nF-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWvemS6-3SV3HJ-1}}\nwenddeflinemarkup
\LA{}flags~{\nwtagstyle{}\subpageref{NWvemS6-gHt1f-1}}\RA{}
makefiles.pdf: makefiles.tex preamble.tex makefiles.bib
makefiles.pdf: intro.tex Makefile.tex
makefiles.pdf: exam.bib
makefiles.pdf: transform.bib
makefiles.pdf: tex.bib
makefiles.pdf: Dockerfile.tex
\nwused{\\{NWvemS6-3SV3HJ-1}}\nwendcode{}\nwbegindocs{14}We must add the generated files to the clean recipe.
\nwenddocs{}\nwbegincode{15}\sublabel{NWvemS6-mtljB-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWvemS6-mtljB-1}}}\moddef{clean recipe~{\nwtagstyle{}\subpageref{NWvemS6-mtljB-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWvemS6-3SV3HJ-4}}\nwprevnextdefs{\relax}{NWvemS6-mtljB-2}\nwenddeflinemarkup
$\{RM\} makefiles.pdf
$\{RM\} Dockerfile.tex
\nwalsodefined{\\{NWvemS6-mtljB-2}\\{NWvemS6-mtljB-3}\\{NWvemS6-mtljB-4}}\nwused{\\{NWvemS6-3SV3HJ-4}}\nwendcode{}\nwbegindocs{16}\nwdocspar

We want to use the PythonTeX and Minted packages.
This requires some flags to LaTeX.
\nwenddocs{}\nwbegincode{17}\sublabel{NWvemS6-gHt1f-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWvemS6-gHt1f-1}}}\moddef{flags~{\nwtagstyle{}\subpageref{NWvemS6-gHt1f-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWvemS6-2fZ5nF-1}}\nwenddeflinemarkup
LATEXFLAGS+=    -shell-escape
TEX_PYTHONTEX=  yes
\nwused{\\{NWvemS6-2fZ5nF-1}}\nwendcode{}\nwbegindocs{18}\nwdocspar

To automatically compile the documentation, we use the {\Tt{}tex.mk\nwendquote} include.
Once this include is present, make will be able to make a {\Tt{}.pdf\nwendquote} from a 
{\Tt{}.tex\nwendquote} file.
\nwenddocs{}\nwbegincode{19}\sublabel{NWvemS6-cyS7L-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWvemS6-cyS7L-1}}}\moddef{include files~{\nwtagstyle{}\subpageref{NWvemS6-cyS7L-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWvemS6-3SV3HJ-5}}\nwprevnextdefs{\relax}{NWvemS6-cyS7L-2}\nwenddeflinemarkup
include $\{MAKEFILES_INCLUDE\}/tex.mk
\nwalsodefined{\\{NWvemS6-cyS7L-2}\\{NWvemS6-cyS7L-3}}\nwused{\\{NWvemS6-3SV3HJ-5}}\nwendcode{}\nwbegindocs{20}\nwdocspar

Additionally, it depends on {\Tt{}.tex\nwendquote} versions of all the {\Tt{}.mk\nwendquote} files.
We will generate the targets for both {\Tt{}.tex\nwendquote} and {\Tt{}.mk\nwendquote} versions, both of 
these are generated from the {\Tt{}.nw\nwendquote} file.
The functionality of {\Tt{}noweb.mk\nwendquote} allows us to reduce this to the line
equivalent to {\Tt{}{\%}.mk\ {\%}.tex:\ {\%}.nw\nwendquote} below.
Then the pattern rules will do the work.
\nwenddocs{}\nwbegincode{21}\sublabel{NWvemS6-2mrlqb-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWvemS6-2mrlqb-1}}}\moddef{MKFILES targets~{\nwtagstyle{}\subpageref{NWvemS6-2mrlqb-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWvemS6-3SV3HJ-1}}\nwenddeflinemarkup
define makefiles_depends
makefiles.pdf: $(1:.mk=.tex)
$(1) $(1:.mk=.tex): $(1).nw
endef

$(foreach mkfile,$\{MKFILES\},$(eval $(call makefiles_depends,$\{mkfile\})))
\nwused{\\{NWvemS6-3SV3HJ-1}}\nwendcode{}\nwbegindocs{22}\nwdocspar

To automatically tangle an {\Tt{}.nw\nwendquote} file into an {\Tt{}.mk\nwendquote}, we use the 
{\Tt{}noweb.mk\nwendquote} include.
Once this is present, make knows how to make an {\Tt{}.mk\nwendquote} file from an {\Tt{}.nw\nwendquote}.
\nwenddocs{}\nwbegincode{23}\sublabel{NWvemS6-cyS7L-2}\nwmargintag{{\nwtagstyle{}\subpageref{NWvemS6-cyS7L-2}}}\moddef{include files~{\nwtagstyle{}\subpageref{NWvemS6-cyS7L-1}}}\plusendmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWvemS6-3SV3HJ-5}}\nwprevnextdefs{NWvemS6-cyS7L-1}{NWvemS6-cyS7L-3}\nwenddeflinemarkup
include $\{MAKEFILES_INCLUDE\}/noweb.mk
\nwused{\\{NWvemS6-3SV3HJ-5}}\nwendcode{}\nwbegindocs{24}\nwdocspar

We should also add these generated file to the cleaning recipe.
However, we only remove the {\Tt{}.tex\nwendquote} files, we keep the tangled {\Tt{}.mk\nwendquote} files 
to use the repo as an independent Git submodule in project repos.
\nwenddocs{}\nwbegincode{25}\sublabel{NWvemS6-mtljB-2}\nwmargintag{{\nwtagstyle{}\subpageref{NWvemS6-mtljB-2}}}\moddef{clean recipe~{\nwtagstyle{}\subpageref{NWvemS6-mtljB-1}}}\plusendmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWvemS6-3SV3HJ-4}}\nwprevnextdefs{NWvemS6-mtljB-1}{NWvemS6-mtljB-3}\nwenddeflinemarkup
$\{RM\} $\{MKFILES:.mk=.tex\}
\nwused{\\{NWvemS6-3SV3HJ-4}}\nwendcode{}\nwbegindocs{26}\nwdocspar

We also have files for which this doesn't work (the target doesn't have the 
name in common with its source).
Then we can provide a one-liner recipe, also thanks to {\Tt{}noweb.mk\nwendquote}.
\nwenddocs{}\nwbegincode{27}\sublabel{NWvemS6-3wr0FJ-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWvemS6-3wr0FJ-1}}}\moddef{OTHERS targets~{\nwtagstyle{}\subpageref{NWvemS6-3wr0FJ-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWvemS6-3SV3HJ-1}}\nwenddeflinemarkup
latexmkrc: tex.mk.nw
  $\{NOTANGLE\}

gitattributes: transform.mk.nw
  $\{NOTANGLE\}
\nwused{\\{NWvemS6-3SV3HJ-1}}\nwendcode{}\nwbegindocs{28}Of these files, we only want to keep {\Tt{}latexmkrc\nwendquote} after cleaning.
\nwenddocs{}\nwbegincode{29}\sublabel{NWvemS6-mtljB-3}\nwmargintag{{\nwtagstyle{}\subpageref{NWvemS6-mtljB-3}}}\moddef{clean recipe~{\nwtagstyle{}\subpageref{NWvemS6-mtljB-1}}}\plusendmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWvemS6-3SV3HJ-4}}\nwprevnextdefs{NWvemS6-mtljB-2}{NWvemS6-mtljB-4}\nwenddeflinemarkup
$\{RM\} gitattributes
\nwused{\\{NWvemS6-3SV3HJ-4}}\nwendcode{}\nwbegindocs{30}\nwdocspar

\subsection{The Docker image}

The {\Tt{}Dockerfile\nwendquote} is used to produce a Docker image.
\nwenddocs{}\nwbegincode{31}\sublabel{NWvemS6-3wP1IH-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWvemS6-3wP1IH-1}}}\moddef{Dockerfile target~{\nwtagstyle{}\subpageref{NWvemS6-3wP1IH-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWvemS6-3SV3HJ-1}}\nwenddeflinemarkup
Dockerfile: Dockerfile.nw
  $\{NOTANGLE\}
\nwused{\\{NWvemS6-3SV3HJ-1}}\nwendcode{}\nwbegindocs{32}\nwdocspar

We provide a phony target {\Tt{}docker-makefiles\nwendquote} to produce the {\Tt{}makefiles\nwendquote} 
Docker image (see above).
\nwenddocs{}\nwbegincode{33}\sublabel{NWvemS6-1uyUCW-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWvemS6-1uyUCW-1}}}\moddef{Docker image recipe~{\nwtagstyle{}\subpageref{NWvemS6-1uyUCW-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWvemS6-3SV3HJ-2}}\nwenddeflinemarkup
docker build -t makefiles .
docker tag makefiles $\{DOCKER_ID_USER\}/makefiles
\nwused{\\{NWvemS6-3SV3HJ-2}}\nwendcode{}\nwbegindocs{34}\nwdocspar

We also provide a phony target {\Tt{}push\nwendquote} to push the makefiles image to Docker 
Hub.
\nwenddocs{}\nwbegincode{35}\sublabel{NWvemS6-OdjRL-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWvemS6-OdjRL-1}}}\moddef{Docker push recipe~{\nwtagstyle{}\subpageref{NWvemS6-OdjRL-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWvemS6-3SV3HJ-2}}\nwenddeflinemarkup
docker push $\{DOCKER_ID_USER\}/makefiles
\nwused{\\{NWvemS6-3SV3HJ-2}}\nwendcode{}\nwbegindocs{36}\nwdocspar

Lastly, we need to cleaning.
We provide a {\Tt{}distclean\nwendquote} target to remove the (quite sizeable) Docker image.
\nwenddocs{}\nwbegincode{37}\sublabel{NWvemS6-1Hidyl-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWvemS6-1Hidyl-1}}}\moddef{distclean recipe~{\nwtagstyle{}\subpageref{NWvemS6-1Hidyl-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWvemS6-3SV3HJ-4}}\nwenddeflinemarkup
docker image rm makefiles
docker image rm dbosk/makefiles
\nwused{\\{NWvemS6-3SV3HJ-4}}\nwendcode{}\nwbegindocs{38}\nwdocspar

\subsection{Packaging and publication}

We provide a package that installs the makefiles in the system where make can 
find them.
This requires the {\Tt{}pkg.mk\nwendquote} include.
\nwenddocs{}\nwbegincode{39}\sublabel{NWvemS6-cyS7L-3}\nwmargintag{{\nwtagstyle{}\subpageref{NWvemS6-cyS7L-3}}}\moddef{include files~{\nwtagstyle{}\subpageref{NWvemS6-cyS7L-1}}}\plusendmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWvemS6-3SV3HJ-5}}\nwprevnextdefs{NWvemS6-cyS7L-2}{\relax}\nwenddeflinemarkup
include $\{MAKEFILES_INCLUDE\}/pkg.mk
\nwused{\\{NWvemS6-3SV3HJ-5}}\nwendcode{}\nwbegindocs{40}We only need to set some variables that {\Tt{}pkg.mk\nwendquote} expects.
\nwenddocs{}\nwbegincode{41}\sublabel{NWvemS6-F4ErS-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWvemS6-F4ErS-1}}}\moddef{package setup~{\nwtagstyle{}\subpageref{NWvemS6-F4ErS-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWvemS6-3SV3HJ-3}}\nwenddeflinemarkup
PKG_PACKAGES?=          main
PKG_NAME-main=          makefiles

PKG_PREFIX=             /usr/local
PKG_INSTALL_DIR=        /include

PKG_INSTALL_FILES-main= $\{MKFILES\}
PKG_TARBALL_FILES-main= $\{PKG_INSTALL_FILES-main\} $\{OTHERS\} Makefile README.md

.PHONY: all
all: makefiles.tar.gz
\nwused{\\{NWvemS6-3SV3HJ-3}}\nwendcode{}\nwbegindocs{42}Then we want to remove the package when we clean.
\nwenddocs{}\nwbegincode{43}\sublabel{NWvemS6-mtljB-4}\nwmargintag{{\nwtagstyle{}\subpageref{NWvemS6-mtljB-4}}}\moddef{clean recipe~{\nwtagstyle{}\subpageref{NWvemS6-mtljB-1}}}\plusendmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWvemS6-3SV3HJ-4}}\nwprevnextdefs{NWvemS6-mtljB-3}{\relax}\nwenddeflinemarkup
$\{RM\} makefiles.tar.gz
\nwused{\\{NWvemS6-3SV3HJ-4}}\nwendcode{}

\nwixlogsorted{c}{{\code{}Makefile\edoc{}}{NWvemS6-3SV3HJ-1}{\nwixd{NWvemS6-3SV3HJ-1}\nwixd{NWvemS6-3SV3HJ-2}\nwixd{NWvemS6-3SV3HJ-3}\nwixd{NWvemS6-3SV3HJ-4}\nwixd{NWvemS6-3SV3HJ-5}}}%
\nwixlogsorted{c}{{clean recipe}{NWvemS6-mtljB-1}{\nwixu{NWvemS6-3SV3HJ-4}\nwixd{NWvemS6-mtljB-1}\nwixd{NWvemS6-mtljB-2}\nwixd{NWvemS6-mtljB-3}\nwixd{NWvemS6-mtljB-4}}}%
\nwixlogsorted{c}{{distclean recipe}{NWvemS6-1Hidyl-1}{\nwixu{NWvemS6-3SV3HJ-4}\nwixd{NWvemS6-1Hidyl-1}}}%
\nwixlogsorted{c}{{Docker image recipe}{NWvemS6-1uyUCW-1}{\nwixu{NWvemS6-3SV3HJ-2}\nwixd{NWvemS6-1uyUCW-1}}}%
\nwixlogsorted{c}{{Docker push recipe}{NWvemS6-OdjRL-1}{\nwixu{NWvemS6-3SV3HJ-2}\nwixd{NWvemS6-OdjRL-1}}}%
\nwixlogsorted{c}{{Dockerfile target}{NWvemS6-3wP1IH-1}{\nwixu{NWvemS6-3SV3HJ-1}\nwixd{NWvemS6-3wP1IH-1}}}%
\nwixlogsorted{c}{{flags}{NWvemS6-gHt1f-1}{\nwixu{NWvemS6-2fZ5nF-1}\nwixd{NWvemS6-gHt1f-1}}}%
\nwixlogsorted{c}{{include files}{NWvemS6-cyS7L-1}{\nwixu{NWvemS6-3SV3HJ-5}\nwixd{NWvemS6-cyS7L-1}\nwixd{NWvemS6-cyS7L-2}\nwixd{NWvemS6-cyS7L-3}}}%
\nwixlogsorted{c}{{Makefile target}{NWvemS6-EvZu1-1}{\nwixu{NWvemS6-3SV3HJ-1}\nwixd{NWvemS6-EvZu1-1}}}%
\nwixlogsorted{c}{{makefiles.pdf target}{NWvemS6-2fZ5nF-1}{\nwixu{NWvemS6-3SV3HJ-1}\nwixd{NWvemS6-2fZ5nF-1}}}%
\nwixlogsorted{c}{{MKFILES targets}{NWvemS6-2mrlqb-1}{\nwixu{NWvemS6-3SV3HJ-1}\nwixd{NWvemS6-2mrlqb-1}}}%
\nwixlogsorted{c}{{OTHERS targets}{NWvemS6-3wr0FJ-1}{\nwixu{NWvemS6-3SV3HJ-1}\nwixd{NWvemS6-3wr0FJ-1}}}%
\nwixlogsorted{c}{{package setup}{NWvemS6-F4ErS-1}{\nwixu{NWvemS6-3SV3HJ-3}\nwixd{NWvemS6-F4ErS-1}}}%
\nwbegindocs{44}\nwdocspar

\nwenddocs{}
