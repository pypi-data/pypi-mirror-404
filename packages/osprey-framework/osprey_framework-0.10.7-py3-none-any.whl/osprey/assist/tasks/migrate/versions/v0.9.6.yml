# OSPREY Migration Document
# Migrates downstream projects from v0.9.5 to v0.9.6

version: "0.9.6"
release_date: "2025-12-06"
summary: "Control system connector API unification (PV â†’ Channel naming)"
migrates_from: "0.9.5"
breaking: false  # Deprecated methods still work until v0.10

changes:
  # Method renames (backward compatible with deprecation warnings)
  - type: method_rename
    risk: medium
    old: { method: "read_pv", class: "BaseConnector" }
    new: { method: "read_channel", class: "BaseConnector" }
    search_pattern: '\.read_pv\s*\('
    automatable: true
    example:
      before: "value = await connector.read_pv(address)"
      after: "value = await connector.read_channel(address)"

  - type: method_rename
    risk: medium
    old: { method: "write_pv", class: "BaseConnector" }
    new: { method: "write_channel", class: "BaseConnector" }
    search_pattern: '\.write_pv\s*\('
    automatable: true

  # Class renames
  - type: class_rename
    risk: medium
    old: { class: "PVValue", module: "osprey.connectors.models" }
    new: { class: "ChannelValue", module: "osprey.connectors.models" }
    search_pattern: '\bPVValue\b'
    automatable: true

  - type: class_rename
    risk: medium
    old: { class: "PVMetadata", module: "osprey.connectors.models" }
    new: { class: "ChannelMetadata", module: "osprey.connectors.models" }
    search_pattern: '\bPVMetadata\b'
    automatable: true

  # Capability rename
  - type: method_rename
    risk: high
    old: { method: "channel_value_retrieval" }
    new: { method: "channel_read" }
    search_pattern: '\bchannel_value_retrieval\b'
    automatable: partial
    manual_review_reason: "Appears in code, config, and docs - review each context"

  - type: class_rename
    risk: high
    old: { class: "ChannelValueRetrievalCapability" }
    new: { class: "ChannelReadCapability" }
    search_pattern: '\bChannelValueRetrievalCapability\b'
    automatable: true

affected_file_patterns:
  - "**/*capability*.py"
  - "**/*connector*.py"
  - "**/registry.py"
  - "config.yml"

validation:
  - command: "python -c 'from osprey.connectors.models import ChannelValue'"
    description: "Verify new class names available"
  - command: "pytest --collect-only"
    description: "Verify imports resolve"

notes: |
  Old methods/classes emit DeprecationWarning but still work.
  Full removal scheduled for v0.10.
