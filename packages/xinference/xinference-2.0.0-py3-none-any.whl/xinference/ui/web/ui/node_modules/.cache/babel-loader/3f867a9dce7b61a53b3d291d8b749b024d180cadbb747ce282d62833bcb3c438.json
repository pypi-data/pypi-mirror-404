{"ast":null,"code":"import _regeneratorRuntime from\"/home/runner/work/inference/inference/xinference/ui/web/ui/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/runner/work/inference/inference/xinference/ui/web/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"/home/runner/work/inference/inference/xinference/ui/web/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/home/runner/work/inference/inference/xinference/ui/web/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{Clear,Done,FilterNone}from'@mui/icons-material';import{Tooltip}from'@mui/material';import React,{useState}from'react';import{useTranslation}from'react-i18next';import{copyToClipboard}from'../../../components/utils';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var keyMap={model_size_in_billions:'--size-in-billions',download_hub:'--download_hub',enable_thinking:'--enable-thinking',reasoning_content:'--reasoning_content',lightning_version:'--lightning_version',lightning_model_path:'--lightning_model_path'};var CopyComponent=function CopyComponent(_ref){var getData=_ref.getData,predefinedKeys=_ref.predefinedKeys;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useState=useState('pending'),_useState2=_slicedToArray(_useState,2),copyStatus=_useState2[0],setCopyStatus=_useState2[1];var generateCommandLineStatement=function generateCommandLineStatement(params){var args=Object.entries(params).filter(function(_ref2){var _ref3=_slicedToArray(_ref2,2),key=_ref3[0],value=_ref3[1];return predefinedKeys.includes(key)&&value!==null&&value!==undefined||!predefinedKeys.includes(key);}).flatMap(function(_ref4){var _ref5=_slicedToArray(_ref4,2),key=_ref5[0],value=_ref5[1];if(key==='gpu_idx'&&Array.isArray(value)){return\"--gpu-idx \".concat(value.join(','));}else if(key==='peft_model_config'&&typeof value==='object'){var peftArgs=[];if(value.lora_list){peftArgs.push.apply(peftArgs,_toConsumableArray(value.lora_list.map(function(lora){return\"--lora-modules \".concat(lora.lora_name,\" \").concat(lora.local_path);})));}if(value.image_lora_load_kwargs){peftArgs.push.apply(peftArgs,_toConsumableArray(Object.entries(value.image_lora_load_kwargs).map(function(_ref6){var _ref7=_slicedToArray(_ref6,2),k=_ref7[0],v=_ref7[1];return\"--image-lora-load-kwargs \".concat(k,\" \").concat(v);})));}if(value.image_lora_fuse_kwargs){peftArgs.push.apply(peftArgs,_toConsumableArray(Object.entries(value.image_lora_fuse_kwargs).map(function(_ref8){var _ref9=_slicedToArray(_ref8,2),k=_ref9[0],v=_ref9[1];return\"--image-lora-fuse-kwargs \".concat(k,\" \").concat(v);})));}return peftArgs;}else if(key==='quantization_config'&&typeof value==='object'){return Object.entries(value).map(function(_ref10){var _ref11=_slicedToArray(_ref10,2),k=_ref11[0],v=_ref11[1];return\"--quantization-config \".concat(k,\" \").concat(v===null?'none':v);});}else if(key==='envs'&&typeof value==='object'){return Object.entries(value).map(function(_ref12){var _ref13=_slicedToArray(_ref12,2),k=_ref13[0],v=_ref13[1];return\"--env \".concat(k,\" \").concat(v);});}else if(key==='virtual_env_packages'&&Array.isArray(value)){return value.map(function(pkg){return\"--virtual-env-package \".concat(pkg);});}else if(key==='enable_virtual_env'){if(value===true)return\"--enable-virtual-env\";if(value===false)return\"--disable-virtual-env\";return[];}else if(key==='enable_thinking'){if(value===true)return\"--enable-thinking\";return[];}else if(predefinedKeys.includes(key)){var _keyMap$key;var newKey=(_keyMap$key=keyMap[key])!==null&&_keyMap$key!==void 0?_keyMap$key:\"--\".concat(key.replace(/_/g,'-'));return\"\".concat(newKey,\" \").concat(value===false?'false':value===null?'none':value);}else{return\"--\".concat(key,\" \").concat(value===false?'false':value===null?'none':value);}}).join(' ');return\"xinference launch \".concat(args);};var showTooltipTemporarily=function showTooltipTemporarily(status){setCopyStatus(status);setTimeout(function(){return setCopyStatus('pending');},1500);};var handleCopy=/*#__PURE__*/function(){var _ref14=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(event){var text,textToCopy,success;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:text=generateCommandLineStatement(getData());event.stopPropagation();textToCopy=String(text!==null&&text!==void 0?text:'');_context.next=5;return copyToClipboard(textToCopy);case 5:success=_context.sent;showTooltipTemporarily(success?'success':'failed');case 7:case\"end\":return _context.stop();}},_callee);}));return function handleCopy(_x){return _ref14.apply(this,arguments);};}();return/*#__PURE__*/_jsx(_Fragment,{children:copyStatus==='pending'?/*#__PURE__*/_jsx(Tooltip,{title:t('launchModel.copyToCommandLine'),placement:\"top\",children:/*#__PURE__*/_jsx(FilterNone,{className:\"copyToCommandLine\",onClick:handleCopy})}):copyStatus==='success'?/*#__PURE__*/_jsx(Done,{fontSize:\"small\",color:\"success\"}):/*#__PURE__*/_jsx(Clear,{fontSize:\"small\",color:\"error\"})});};export default CopyComponent;","map":{"version":3,"names":["Clear","Done","FilterNone","Tooltip","React","useState","useTranslation","copyToClipboard","jsx","_jsx","Fragment","_Fragment","keyMap","model_size_in_billions","download_hub","enable_thinking","reasoning_content","lightning_version","lightning_model_path","CopyComponent","_ref","getData","predefinedKeys","_useTranslation","t","_useState","_useState2","_slicedToArray","copyStatus","setCopyStatus","generateCommandLineStatement","params","args","Object","entries","filter","_ref2","_ref3","key","value","includes","undefined","flatMap","_ref4","_ref5","Array","isArray","concat","join","peftArgs","lora_list","push","apply","_toConsumableArray","map","lora","lora_name","local_path","image_lora_load_kwargs","_ref6","_ref7","k","v","image_lora_fuse_kwargs","_ref8","_ref9","_ref10","_ref11","_ref12","_ref13","pkg","_keyMap$key","newKey","replace","showTooltipTemporarily","status","setTimeout","handleCopy","_ref14","_asyncToGenerator","_regeneratorRuntime","mark","_callee","event","text","textToCopy","success","wrap","_callee$","_context","prev","next","stopPropagation","String","sent","stop","_x","arguments","children","title","placement","className","onClick","fontSize","color"],"sources":["/home/runner/work/inference/inference/xinference/ui/web/ui/src/scenes/launch_model/components/commandBuilder.js"],"sourcesContent":["import { Clear, Done, FilterNone } from '@mui/icons-material'\nimport { Tooltip } from '@mui/material'\nimport React, { useState } from 'react'\nimport { useTranslation } from 'react-i18next'\n\nimport { copyToClipboard } from '../../../components/utils'\n\nconst keyMap = {\n  model_size_in_billions: '--size-in-billions',\n  download_hub: '--download_hub',\n  enable_thinking: '--enable-thinking',\n  reasoning_content: '--reasoning_content',\n  lightning_version: '--lightning_version',\n  lightning_model_path: '--lightning_model_path',\n}\n\nconst CopyComponent = ({ getData, predefinedKeys }) => {\n  const { t } = useTranslation()\n  const [copyStatus, setCopyStatus] = useState('pending')\n\n  const generateCommandLineStatement = (params) => {\n    const args = Object.entries(params)\n      .filter(\n        ([key, value]) =>\n          (predefinedKeys.includes(key) &&\n            value !== null &&\n            value !== undefined) ||\n          !predefinedKeys.includes(key)\n      )\n      .flatMap(([key, value]) => {\n        if (key === 'gpu_idx' && Array.isArray(value)) {\n          return `--gpu-idx ${value.join(',')}`\n        } else if (key === 'peft_model_config' && typeof value === 'object') {\n          const peftArgs = []\n          if (value.lora_list) {\n            peftArgs.push(\n              ...value.lora_list.map(\n                (lora) => `--lora-modules ${lora.lora_name} ${lora.local_path}`\n              )\n            )\n          }\n          if (value.image_lora_load_kwargs) {\n            peftArgs.push(\n              ...Object.entries(value.image_lora_load_kwargs).map(\n                ([k, v]) => `--image-lora-load-kwargs ${k} ${v}`\n              )\n            )\n          }\n          if (value.image_lora_fuse_kwargs) {\n            peftArgs.push(\n              ...Object.entries(value.image_lora_fuse_kwargs).map(\n                ([k, v]) => `--image-lora-fuse-kwargs ${k} ${v}`\n              )\n            )\n          }\n          return peftArgs\n        } else if (key === 'quantization_config' && typeof value === 'object') {\n          return Object.entries(value).map(\n            ([k, v]) => `--quantization-config ${k} ${v === null ? 'none' : v}`\n          )\n        } else if (key === 'envs' && typeof value === 'object') {\n          return Object.entries(value).map(([k, v]) => `--env ${k} ${v}`)\n        } else if (key === 'virtual_env_packages' && Array.isArray(value)) {\n          return value.map((pkg) => `--virtual-env-package ${pkg}`)\n        } else if (key === 'enable_virtual_env') {\n          if (value === true) return `--enable-virtual-env`\n          if (value === false) return `--disable-virtual-env`\n          return []\n        } else if (key === 'enable_thinking') {\n          if (value === true) return `--enable-thinking`\n          return []\n        } else if (predefinedKeys.includes(key)) {\n          const newKey = keyMap[key] ?? `--${key.replace(/_/g, '-')}`\n          return `${newKey} ${\n            value === false ? 'false' : value === null ? 'none' : value\n          }`\n        } else {\n          return `--${key} ${\n            value === false ? 'false' : value === null ? 'none' : value\n          }`\n        }\n      })\n      .join(' ')\n\n    return `xinference launch ${args}`\n  }\n\n  const showTooltipTemporarily = (status) => {\n    setCopyStatus(status)\n    setTimeout(() => setCopyStatus('pending'), 1500)\n  }\n\n  const handleCopy = async (event) => {\n    const text = generateCommandLineStatement(getData())\n    event.stopPropagation()\n    const textToCopy = String(text ?? '')\n    const success = await copyToClipboard(textToCopy)\n    showTooltipTemporarily(success ? 'success' : 'failed')\n  }\n\n  return (\n    <>\n      {copyStatus === 'pending' ? (\n        <Tooltip title={t('launchModel.copyToCommandLine')} placement=\"top\">\n          <FilterNone className=\"copyToCommandLine\" onClick={handleCopy} />\n        </Tooltip>\n      ) : copyStatus === 'success' ? (\n        <Done fontSize=\"small\" color=\"success\" />\n      ) : (\n        <Clear fontSize=\"small\" color=\"error\" />\n      )}\n    </>\n  )\n}\n\nexport default CopyComponent\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}