[project]
name = "ara"
description = "ARA Records Ansible"
dynamic = ["version"]
readme = "README.md"
requires-python = ">=3.8"
classifiers = [
    "Intended Audience :: Information Technology",
    "Intended Audience :: System Administrators",
    "Intended Audience :: Developers",
    "Topic :: Utilities",
    # Licencing in classifier is deprecated
    #"License :: OSI Approved :: GNU General Public License v3 (GPLv3)",
    "Operating System :: POSIX :: Linux",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.8",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Development Status :: 5 - Production/Stable",
]
dependencies = [
    "cliff",
    "requests>=2.14.2",
]

[[project.authors]]
name = "ARA Records Ansible authors"

[build-system]
requires = ["setuptools", "setuptools-scm"]
build-backend = "setuptools.build_meta"

[tool.setuptools_scm]
version_file = "ara/setup/_version.py"
version_scheme = "no-guess-dev"

[project.urls]
Homepage = "https://codeberg.org/ansible-community/ara"

[project.scripts]
ara = "ara.cli.base:main"
ara-manage = "ara.server.__main__:main"

[project.entry-points."ara.cli"]
expire = "ara.cli.expire:ExpireObjects"
"playbook list" = "ara.cli.playbook:PlaybookList"
"playbook show" = "ara.cli.playbook:PlaybookShow"
"playbook delete" = "ara.cli.playbook:PlaybookDelete"
"playbook prune" = "ara.cli.playbook:PlaybookPrune"
"playbook metrics" = "ara.cli.playbook:PlaybookMetrics"
"play list" = "ara.cli.play:PlayList"
"play show" = "ara.cli.play:PlayShow"
"play delete" = "ara.cli.play:PlayDelete"
"host list" = "ara.cli.host:HostList"
"host show" = "ara.cli.host:HostShow"
"host delete" = "ara.cli.host:HostDelete"
"host metrics" = "ara.cli.host:HostMetrics"
"record list" = "ara.cli.record:RecordList"
"record show" = "ara.cli.record:RecordShow"
"record delete" = "ara.cli.record:RecordDelete"
"result list" = "ara.cli.result:ResultList"
"result show" = "ara.cli.result:ResultShow"
"result delete" = "ara.cli.result:ResultDelete"
"task list" = "ara.cli.task:TaskList"
"task show" = "ara.cli.task:TaskShow"
"task delete" = "ara.cli.task:TaskDelete"
"task metrics" = "ara.cli.task:TaskMetrics"

[project.optional-dependencies]
server = [
    # 4.2 LTS is supported until early 2026
    # 5.2 LTS is supported until early 2028
    # As per https://www.djangoproject.com/download/
    "django>=4.2,<5.3",
    "djangorestframework>=3.9.1",
    "django-filter",
    "django-cors-headers",
    "django-health-check",
    # dynaconf 3.1.3 had a regression https://codeberg.org/ansible-community/ara/issues/212
    # dynaconf dropped support for py35 at version 3.0.0: https://codeberg.org/ansible-community/ara/issues/370
    "dynaconf[yaml]>=3.0.0,!=3.1.3,<4.0.0",
    # dynaconf[yaml] should recover ruamel.yaml but this isn't always the case (i.e, Fedora koji)
    # Make the dependency explicit.
    "ruamel.yaml",
    # Note: tzdata is typically installed as a system package (i.e, dnf/apt install tzdata)
    # In some cases, tzdata isn't installed (i.e, lightweight container images) so make sure it is available.
    # tzdata is required by django's usage of zoneinfo.
    # zoneinfo is bundled in python's stdlib starting with python3.9.
    # We can simplify the tzdata requirement once we drop support for py3.8.
    'tzdata; python_version >= "3.9"',
    'backports.zoneinfo[tzdata]; python_version < "3.9"',
    "tzlocal>=4.0",
    "pygments",
    "whitenoise",
]
postgresql = [
    "psycopg2",
]
mysql = [
    "mysqlclient",
]

[tool.setuptools]
packages = [
  "ara",
  "ara.api",
  "ara.cli",
  "ara.clients",
  "ara.plugins",
  "ara.server",
  "ara.setup",
  "ara.ui",

  # Add also namespaces

  "ara.server.db",
  "ara.server.db.backends",
  "ara.server.db.backends.distributed_sqlite",

  "ara.ui.templatetags",
  "ara.ui.templates",
  "ara.ui.templates.partials.tables",
  "ara.ui.static",
  "ara.ui.management.commands",
  "ara.ui.static.css",
  "ara.ui.static.css.fonts",
  "ara.ui.static.images",
  "ara.ui.static.js",
  "ara.ui.templates.partials",
  "ara.ui.templates.partials.search",

  "ara.api.management.commands",
  "ara.api.migrations",
  "ara.api.tests",

  "ara.plugins.action",
  "ara.plugins.callback",
  "ara.plugins.lookup",
]

[dependency-groups]
dev = [
    "black",
    "flake8",
    "isort",
    "flake8-pyproject",
]

[tool.coverage.report]
ignore_errors = true
include = [
    "ara/*",
]
omit = [
    "/usr*",
    "setup.py",
    "*egg*",
    ".venv/*",
]

[tool.coverage.html]
directory = "reports"

[tool.flake8]
max-line-length = 120
extend-ignore = [
    "E123",
    "E125",
    "E741",
]
enable-extensions = [
    "H106",
    "H203",
]
show-source = true
exclude = [
    ".venv",
    ".git",
    ".tox",
    "dist",
    "doc",
    "*lib/python*",
    "*egg",
    "build",
    "ara/api/migrations",
    "ara/setup/_version.py",
]

[tool.isort]
profile = "black"
known_first_party = "ara"
default_section = "THIRDPARTY"
skip = [
    "build",
    ".git",
    ".tox",
    ".cache",
    ".venv",
    "ara/api/migrations",
    "ara/setup/_version.py",
]
multi_line_output = 3
include_trailing_comma = true
force_grid_wrap = 0
combine_as_imports = true
line_length = 120

[tool.black]
line-length = 120
exclude = "[migrations|ara/setup/_version.py]"

[tool.sphinx-pyproject]
copyright = "2024, ARA Records Ansible authors"
project = "ara"
extensions = [
  "sphinxcontrib.programoutput",
  "sphinx.ext.autodoc",
  "sphinx.ext.autosectionlabel"
]
master_doc = "index"
source_suffix = ".rst"
pygments_style = "default"
add_module_names = true
add_function_parentheses = true
autosectionlabel_prefix_document = true
html_theme = "sphinx_rtd_theme"

[tool.uv]
package = true
