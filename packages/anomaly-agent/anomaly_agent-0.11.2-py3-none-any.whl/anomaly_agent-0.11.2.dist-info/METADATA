Metadata-Version: 2.4
Name: anomaly-agent
Version: 0.11.2
Summary: A package for detecting anomalies in time series data using LLMs
Project-URL: Homepage, https://github.com/andrewm4894/anomaly-agent
Project-URL: Repository, https://github.com/andrewm4894/anomaly-agent
Project-URL: Issues, https://github.com/andrewm4894/anomaly-agent/issues
Author-email: Andrew Maguire <andrewm4894@gmail.com>
License: MIT License
        
        Copyright (c) 2025 Andrew Maguire
        
        Permission is hereby granted, free of charge, to any person obtaining a copy
        of this software and associated documentation files (the "Software"), to deal
        in the Software without restriction, including without limitation the rights
        to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
        copies of the Software, and to permit persons to whom the Software is
        furnished to do so, subject to the following conditions:
        
        The above copyright notice and this permission notice shall be included in all
        copies or substantial portions of the Software.
        
        THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
        IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
        FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
        AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
        LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
        OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
        SOFTWARE.
License-File: LICENSE
Keywords: anomaly-detection,llm,machine-learning,time-series
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Science/Research
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Requires-Python: >=3.10
Requires-Dist: langchain-core
Requires-Dist: langchain-openai
Requires-Dist: langchain>=1.0.3
Requires-Dist: langgraph
Requires-Dist: matplotlib
Requires-Dist: pandas
Requires-Dist: plotly
Requires-Dist: posthog>=6.7.13
Requires-Dist: pydantic
Requires-Dist: python-dotenv
Provides-Extra: dev
Requires-Dist: black; extra == 'dev'
Requires-Dist: flake8; extra == 'dev'
Requires-Dist: isort; extra == 'dev'
Requires-Dist: mypy; extra == 'dev'
Requires-Dist: nbformat; extra == 'dev'
Requires-Dist: pip-tools; extra == 'dev'
Requires-Dist: pre-commit; extra == 'dev'
Requires-Dist: pytest; extra == 'dev'
Requires-Dist: pytest-cov; extra == 'dev'
Requires-Dist: pytest-mock; extra == 'dev'
Requires-Dist: twine; extra == 'dev'
Description-Content-Type: text/markdown

# Anomaly Agent

[![Open in GitHub Codespaces](https://github.com/codespaces/badge.svg)](https://codespaces.new/andrewm4894/anomaly-agent)
[![pre-commit](https://img.shields.io/badge/pre--commit-enabled-brightgreen?logo=pre-commit&logoColor=white)](https://github.com/pre-commit/pre-commit)
[![Tests](https://github.com/andrewm4894/anomaly-agent/actions/workflows/tests.yml/badge.svg)](https://github.com/andrewm4894/anomaly-agent/actions/workflows/tests.yml)
[![codecov](https://codecov.io/gh/andrewm4894/anomaly-agent/branch/main/graph/badge.svg)](https://codecov.io/gh/andrewm4894/anomaly-agent)

<a target="_blank" href="https://pypi.org/project/anomaly-agent">
  <img alt="PyPI - Version" src="https://img.shields.io/pypi/v/anomaly-agent">
</a>
<a target="_blank" href="https://pypi.org/project/anomaly-agent">
  <img alt="PyPI - Python Version" src="https://img.shields.io/pypi/pyversions/anomaly-agent">
</a>
<a target="_blank" href="https://pypi.org/project/anomaly-agent">
  <img alt="PyPI - License" src="https://img.shields.io/pypi/l/anomaly-agent">
</a>
<a target="_blank" href="https://pypi.org/project/anomaly-agent">
  <img alt="PyPI - Status" src="https://img.shields.io/pypi/status/anomaly-agent">
</a>
<a target="_blank" href="https://colab.research.google.com/github/andrewm4894/anomaly-agent/blob/main/examples/examples.ipynb">
  <img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/>
</a>

ğŸ¤– A powerful Python library for detecting anomalies in time series data using Large Language Models (LLMs). Built with modern LangGraph architecture for robust, scalable anomaly detection across multiple variables and domains.

## âœ¨ Key Features

- ğŸ§  **LLM-Powered Detection**: Leverages advanced language models for intelligent anomaly identification
- ğŸ”„ **Two-Stage Pipeline**: Detection and optional verification phases to reduce false positives  
- ğŸ“Š **Multi-Variable Support**: Analyze multiple time series variables simultaneously
- ğŸ¯ **Domain Awareness**: Contextual understanding of different data types and domains
- âš¡ **Modern Architecture**: Built on LangGraph with Pydantic validation and robust error handling
- ğŸ› ï¸ **Customizable**: Custom prompts, configurable verification, and flexible model selection
- ğŸ“ˆ **Rich Output**: Structured anomaly descriptions with timestamps and confidence indicators

## ğŸš€ Installation

```bash
pip install anomaly-agent
```

## ğŸ—ï¸ How It Works

The Anomaly Agent uses a sophisticated two-stage pipeline powered by LangGraph state machines:

```mermaid
graph TD
    A[ğŸ“Š Input Time Series Data] --> B[ğŸ” Detection Stage]
    B --> C{ğŸ“‹ Verification Enabled?}
    C -->|Yes| D[âœ… Verification Stage]
    C -->|No| E[ğŸ“¤ Output Anomalies]
    D --> F{ğŸ¯ Anomalies Confirmed?}
    F -->|Yes| E
    F -->|No| G[âŒ Filtered Out]
    G --> E
    
    style A fill:#e1f5fe
    style B fill:#f3e5f5
    style D fill:#fff3e0
    style E fill:#e8f5e8
```

### ğŸ”§ Architecture Components

1. **ğŸ” Detection Node**: Uses LLM to identify potential anomalies with statistical and contextual analysis
2. **âœ… Verification Node** (Optional): Secondary LLM review to reduce false positives with stricter criteria
3. **ğŸ¯ State Management**: Pydantic-based validation and error handling throughout the pipeline
4. **ğŸ“Š Multi-Variable Processing**: Parallel analysis of multiple time series columns

## âš¡ Quick Start

### Basic Usage

```python
import pandas as pd
from anomaly_agent import AnomalyAgent

# Your time series data
df = pd.DataFrame({
    'timestamp': pd.date_range('2024-01-01', periods=100, freq='D'),
    'temperature': [20 + i*0.1 + (10 if i==50 else 0) for i in range(100)],
    'pressure': [1013 + i*0.2 + (50 if i==75 else 0) for i in range(100)]
})

# Create agent and detect anomalies
agent = AnomalyAgent()
anomalies = agent.detect_anomalies(df)

# Convert to DataFrame for analysis
df_anomalies = agent.get_anomalies_df(anomalies)
print(df_anomalies)
```

### Advanced Configuration

```python
from anomaly_agent import AnomalyAgent

# Customize model and verification behavior
agent = AnomalyAgent(
    model_name="gpt-4o-mini",           # Choose your preferred model
    verify_anomalies=True,              # Enable verification stage
    timestamp_col="date"                # Custom timestamp column name
)

# Custom prompts for domain-specific detection
financial_detection_prompt = """
You are a financial analyst detecting market anomalies.
Focus on: unusual price movements, volume spikes, trend reversals.
Consider market hours and economic events in your analysis.
"""

agent = AnomalyAgent(detection_prompt=financial_detection_prompt)
anomalies = agent.detect_anomalies(financial_data)
```

## ğŸ“š Examples and Notebooks

### ğŸ“ Examples Directory

Explore comprehensive examples in the `examples/` folder:

- **[`examples.py`](examples/examples.py)**: Complete CLI examples with different scenarios
- **[`custom_prompts_example.py`](examples/custom_prompts_example.py)**: Domain-specific prompt customization
- **[`examples.ipynb`](examples/examples.ipynb)**: Interactive Jupyter notebook with visualizations

### ğŸ® Interactive Examples

```bash
# Run basic example
python examples/examples.py --example basic --plot

# Try real-world sensor data scenario  
python examples/examples.py --example real-world --plot

# Custom model and plotting
python examples/examples.py --model gpt-4o-mini --example multiple --plot
```

### ğŸ““ Jupyter Notebooks

Launch the interactive notebook:
- **Local**: Open `examples/examples.ipynb`
- **Colab**: [![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/andrewm4894/anomaly-agent/blob/main/examples/examples.ipynb)

## ğŸ“Š Output Formats

### Long Format (Default)
```python
df_anomalies = agent.get_anomalies_df(anomalies)
```
| timestamp | variable_name | value | anomaly_description |
|-----------|---------------|-------|-------------------|
| 2024-01-15 | temperature | 35.2 | Significant temperature spike... |
| 2024-01-20 | pressure | 1089.3 | Unusual pressure reading... |

### Wide Format
```python
df_anomalies = agent.get_anomalies_df(anomalies, format="wide")
```
| timestamp | temperature | temperature_description | pressure | pressure_description |
|-----------|-------------|------------------------|----------|---------------------|
| 2024-01-15 | 35.2 | Significant spike... | NaN | NaN |
| 2024-01-20 | NaN | NaN | 1089.3 | Unusual reading... |

## ğŸ›ï¸ Model Configuration

Choose the right model for your needs and budget:

| Model | Cost (Input/Output per 1M tokens) | Best For | Performance |
|-------|-----------------------------------|----------|-------------|
| `gpt-5-nano` | $0.05 / $0.40 | Cost-effective anomaly detection | â­â­â­ |
| `gpt-5-mini` | $0.25 / $2.00 | Enhanced reasoning for complex patterns | â­â­â­â­ |
| `gpt-5` | $1.25 / $10.00 | Sophisticated domain-specific analysis | â­â­â­â­â­ |
| `gpt-4o-mini` | $0.60 / $2.40 | Legacy support with good performance | â­â­â­â­ |

```python
# Cost-optimized (default)
agent = AnomalyAgent(model_name="gpt-5-nano")

# Enhanced reasoning
agent = AnomalyAgent(model_name="gpt-5-mini") 

# Premium analysis
agent = AnomalyAgent(model_name="gpt-5")
```

## ğŸ¯ Use Cases

### ğŸ¢ Business & Operations
- **ğŸ“ˆ Sales Analytics**: Detect unusual sales patterns, seasonal anomalies
- **ğŸ­ Manufacturing**: Monitor equipment performance, quality metrics
- **ğŸ’° Financial Services**: Fraud detection, market anomaly identification
- **ğŸŒ Web Analytics**: Traffic spikes, user behavior anomalies

### ğŸ”¬ Science & Engineering  
- **ğŸŒ¡ï¸ IoT Sensors**: Temperature, humidity, pressure monitoring
- **âš¡ Energy Systems**: Power consumption, grid stability analysis
- **ğŸ©º Healthcare**: Patient monitoring, medical device readings
- **ğŸŒ Environmental**: Weather patterns, pollution levels

### ğŸ“Š Data Quality
- **ğŸ” Data Validation**: Identify measurement errors, sensor failures
- **ğŸ“‹ ETL Monitoring**: Pipeline anomalies, data drift detection
- **ğŸ¯ Quality Assurance**: Automated anomaly flagging in data workflows

## ğŸ› ï¸ Development

This project uses **uv** for fast, reliable dependency management. All commands automatically handle virtual environment management.

### ğŸ—ï¸ Setup

```bash
# Clone the repository
git clone https://github.com/andrewm4894/anomaly-agent.git
cd anomaly-agent

# Install dependencies (creates .venv automatically)
make sync-dev
```

### ğŸ§ª Testing

```bash
# Run all tests with coverage
make test

# Run specific test categories
uv run pytest tests/test_agent.py -v                    # Core functionality
uv run pytest tests/test_prompts.py -v                  # Prompt system
uv run pytest tests/test_graph_architecture.py -v       # Advanced architecture

# Integration tests (requires OPENAI_API_KEY in .env)
uv run pytest tests/ -m integration -v
```

### ğŸ“‹ Code Quality

```bash
# Install pre-commit hooks
make pre-commit-install

# Run all quality checks
make pre-commit

# Individual tools
uv run black anomaly_agent/    # Formatting
uv run isort anomaly_agent/    # Import sorting  
uv run flake8 anomaly_agent/   # Linting
uv run mypy anomaly_agent/     # Type checking
```

### ğŸ“¦ Dependencies

```bash
# Add new dependencies
make add PACKAGE=pandas              # Runtime dependency
make add-dev PACKAGE=pytest          # Development dependency

# Update all dependencies
make update

# Remove dependencies
make remove PACKAGE=old-package
```

## âš™ï¸ Environment Setup

Create a `.env` file in your project root:

```bash
# Required for anomaly detection
OPENAI_API_KEY=your-openai-api-key-here

# Optional: Custom model defaults
DEFAULT_MODEL_NAME=gpt-5-nano
```

The agent automatically loads environment variables via python-dotenv.

## ğŸ—ï¸ Architecture Deep Dive

For detailed technical information about the internal architecture, see [ARCHITECTURE.md](ARCHITECTURE.md).

Key architectural features:
- **ğŸ”§ LangGraph State Machines**: Robust workflow management with proper error handling
- **âœ… Pydantic Validation**: Type-safe data models throughout the pipeline  
- **ğŸ¯ GraphManager Caching**: Optimized performance with reusable compiled graphs
- **ğŸ“Š Class-based Nodes**: Modular, maintainable node architecture
- **ğŸ”„ Async Support**: Streaming and parallel processing capabilities

## ğŸ¤ Contributing

We welcome contributions! Please see our contributing guidelines for details.

1. **ğŸ´ Fork** the repository
2. **ğŸŒ¿ Create** a feature branch (`git checkout -b feature/amazing-feature`)
3. **âœ… Test** your changes (`make test`)
4. **ğŸ“ Commit** your changes (`git commit -m 'Add amazing feature'`)
5. **ğŸš€ Push** to the branch (`git push origin feature/amazing-feature`)
6. **ğŸ¯ Open** a Pull Request

## ğŸ“„ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## ğŸ™ Acknowledgments

- Built with [LangChain](https://github.com/langchain-ai/langchain) and [LangGraph](https://github.com/langchain-ai/langgraph)
- Powered by OpenAI's language models
- Inspired by the need for intelligent, contextual anomaly detection
