Metadata-Version: 2.4
Name: bilibili-captions
Version: 0.1.20260201.1
Summary: Bç«™å­—å¹•ä¸‹è½½å·¥å…·ï¼Œæ”¯æŒ API è·å–å’Œ Whisper ASR ç”Ÿæˆ
Project-URL: Homepage, https://github.com/LuShan123888/Bilibili-Captions
Project-URL: Repository, https://github.com/LuShan123888/Bilibili-Captions
Project-URL: Issues, https://github.com/LuShan123888/Bilibili-Captions/issues
Author-email: Cian <LuShan123888@gmail.com>
License: MIT
License-File: LICENSE
Keywords: asr,bilibili,captions,chinese,mcp,subtitle,whisper
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Topic :: Multimedia :: Video
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Requires-Python: >=3.10
Requires-Dist: filelock>=3.20.0
Requires-Dist: httpx>=0.28.1
Requires-Dist: mcp>=1.0.0
Requires-Dist: mlx-whisper>=0.4.0
Requires-Dist: opencc-python-reimplemented>=0.1.7
Requires-Dist: requests>=2.32.5
Requires-Dist: tqdm>=4.66.0
Requires-Dist: urllib3>=2.6.0
Provides-Extra: dev
Requires-Dist: pytest>=8.0.0; extra == 'dev'
Requires-Dist: ruff>=0.9.0; extra == 'dev'
Description-Content-Type: text/markdown

# Bilibili-Captions

[ç®€ä½“ä¸­æ–‡](#ç®€ä½“ä¸­æ–‡) | [English](#english)

---

## ç®€ä½“ä¸­æ–‡

Bç«™å­—å¹•ä¸‹è½½å·¥å…·ï¼Œæ”¯æŒ API è·å–å’Œ Whisper ASR è‡ªåŠ¨ç”Ÿæˆã€‚

### åŠŸèƒ½ç‰¹æ€§

- ğŸ¬ **API ä¸‹è½½** - ç›´æ¥ä» Bç«™ API è·å–è§†é¢‘å­—å¹•
- ğŸ¤– **ASR ç”Ÿæˆ** - æ— å­—å¹•æ—¶è‡ªåŠ¨ä½¿ç”¨ Whisper ç”Ÿæˆ
- ğŸŒ **ç¹ç®€è½¬æ¢** - è‡ªåŠ¨è½¬æ¢ä¸ºç®€ä½“ä¸­æ–‡
- ğŸ“¦ **MCP æœåŠ¡å™¨** - é›†æˆåˆ° Claude Desktop
- ğŸ§ª **å®Œæ•´æµ‹è¯•** - åŒ…å«çœŸå®è§†é¢‘æµ‹è¯•ç”¨ä¾‹

## ä½¿ç”¨

### å®‰è£…

**ç³»ç»Ÿè¦æ±‚ï¼š** Python >=3.10

```bash
# ä½¿ç”¨ uv tool å®‰è£…ï¼ˆæ¨èï¼‰
uv tool install bilibili-captions

# æˆ–ä½¿ç”¨ pip
pip install bilibili-captions
```

### è¿è¡Œ

```bash
# 1. è®¾ç½® SESSDATA ç¯å¢ƒå˜é‡
export BILIBILI_SESSDATA="ä½ çš„å€¼"

# 2. è¿è¡Œå‘½ä»¤
bilibili-captions <BVå·æˆ–URL> [æ¨¡å‹å¤§å°]

# ç¤ºä¾‹ - æ”¯æŒå¤šç§ URL æ ¼å¼
bilibili-captions BV16YC3BrEDz                                    # ç›´æ¥ BV å·
bilibili-captions https://www.bilibili.com/video/BV1qViQBwELr   # å®Œæ•´ URL
bilibili-captions https://www.bilibili.com/list/watchlater/?bvid=BV16HqFBZE6N  # ç¨åè§‚çœ‹
bilibili-captions "ã€æˆ‘ä»¬æ‹åˆ°äº†ï¼Œä¸­å›½è‡ªå·±çš„å¯å›æ”¶ç«ç®­ã€‚ã€‘ https://www.bilibili.com/video/BV1y7qwBuEBw/?share_source=copy_web&vd_source=17128cd8d40d0802659ba5ee37ab47d1"  # åˆ†äº«å¤åˆ¶
```

**æ¨¡å‹å¤§å°é€‰é¡¹ï¼š**
- `base` - æœ€å¿«ï¼Œç²¾åº¦è¾ƒä½
- `small` - è¾ƒå¿«
- `medium` - å¹³è¡¡
- `large` - åŒ large-v3
- `large-v3` - ç²¾åº¦æœ€é«˜ï¼ˆé»˜è®¤ï¼Œmlx-whisper ä¼˜åŒ–ï¼‰

### MCP æœåŠ¡å™¨

åœ¨ Claude Desktop çš„ `claude_desktop_config.json` ä¸­é…ç½®ï¼š

```json
{
  "mcpServers": {
    "bilibili-captions": {
      "command": "uvx",
      "args": ["bilibili-captions-mcp"],
      "env": {
        "BILIBILI_SESSDATA": "ä½ çš„ SESSDATA"
      },
      "timeout": 600000
    }
  }
}
```

### MCP å·¥å…·

#### download_captions

ä¸‹è½½ B ç«™è§†é¢‘å­—å¹•ï¼Œæ”¯æŒå¤šç§æ ¼å¼ã€‚

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `url` | å¿…éœ€ | Bç«™è§†é¢‘URLæˆ–BVå· |
| `format` | å¯é€‰ | `text`(é»˜è®¤) / `srt` / `json` |
| `model_size` | å¯é€‰ | `base` / `small` / `medium` / `large` / `large-v3`(é»˜è®¤) |

**è¿”å›ç¤ºä¾‹ï¼š**
```json
{
  "source": "bilibili_api",
  "format": "text",
  "subtitle_count": 189,
  "content": "å­—å¹•å†…å®¹...",
  "video_title": "è§†é¢‘æ ‡é¢˜"
}
```

## å¼€å‘

### é¡¹ç›®ç»“æ„

```
Bilibili-Captions/
â”œâ”€â”€ src/bilibili_captions/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ core.py      # æ ¸å¿ƒ API åŠŸèƒ½
â”‚   â”œâ”€â”€ cli.py       # CLI å…¥å£
â”‚   â””â”€â”€ server.py    # MCP æœåŠ¡å™¨
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_videos.py    # æµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ .env.example          # é…ç½®ç¤ºä¾‹
â”œâ”€â”€ pyproject.toml
â””â”€â”€ README.md
```

### æœ¬åœ°è¿è¡Œ

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/LuShan123888/Bilibili-Captions.git
cd Bilibili-Captions

# å®‰è£…ä¾èµ–
uv sync

# è®¾ç½® SESSDATA
cp .env.example .env
# ç¼–è¾‘ .env å¡«å…¥ SESSDATA
```

#### CLI è¿è¡Œ

```bash
# æ–¹å¼1: uv runï¼ˆæ¨èå¼€å‘ç¯å¢ƒï¼‰
uv run bilibili-captions BV16YC3BrEDz
uv run bilibili-captions https://www.bilibili.com/video/BV1qViQBwELr small

# æ–¹å¼2: ç›´æ¥è°ƒç”¨æ¨¡å—
uv run python -m bilibili_captions.cli <URL>

# æ–¹å¼3: å®‰è£…åå…¨å±€ä½¿ç”¨
uv tool install -e .
bilibili-captions <URL>
```

#### MCP æœåŠ¡å™¨

åœ¨ Claude Desktop çš„ `claude_desktop_config.json` ä¸­æ·»åŠ æœ¬åœ°å¼€å‘é…ç½®ï¼š

```json
{
  "mcpServers": {
    "bilibili-captions-dev": {
      "command": "uv",
      "args": ["--directory", "/Users/cian/Code/Bilibili-Captions", "run", "bilibili-captions-mcp"],
      "env": {
        "BILIBILI_SESSDATA": "ä½ çš„ SESSDATA"
      },
      "timeout": 600000
    }
  }
}
```

### æµ‹è¯•

é¡¹ç›®åŒ…å«ä¸¤ä¸ªçœŸå®è§†é¢‘çš„æµ‹è¯•ç”¨ä¾‹ï¼š

| è§†é¢‘ | åœºæ™¯ | é¢„æœŸç»“æœ |
|------|------|---------|
| BV16YC3BrEDz | æœ‰ API å­—å¹• | 189 æ¡ï¼Œæ¥æº `bilibili_api` |
| BV1qViQBwELr | æ— å­—å¹• ASR | 30 æ¡ï¼Œæ¥æº `whisper_asr` |

```bash
uv run python tests/test_videos.py
# æˆ–
pytest tests/test_videos.py
```

## é…ç½®

### SESSDATA è·å–

1. ç™»å½• [Bç«™](https://www.bilibili.com/)
2. F12 â†’ Application â†’ Cookies â†’ `SESSDATA`
3. å¤åˆ¶å€¼åˆ°ç¯å¢ƒå˜é‡æˆ– `.env` æ–‡ä»¶

```bash
# æ–¹å¼1: ç¯å¢ƒå˜é‡
export BILIBILI_SESSDATA="ä½ çš„å€¼"

# æ–¹å¼2: .env æ–‡ä»¶
cp .env.example .env
# ç¼–è¾‘ .env å¡«å…¥ SESSDATA
```

## ä¾èµ–

### Python ä¾èµ–

| ä¾èµ– | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| `mcp` | >=1.0.0 | MCP åè®®æ”¯æŒ |
| `httpx` | >=0.28.1 | HTTP å®¢æˆ·ç«¯ |
| `requests` | >=2.32.5 | HTTP è¯·æ±‚ |
| `mlx-whisper` | >=0.4.0 | è¯­éŸ³è¯†åˆ«ï¼ˆApple Silicon ä¼˜åŒ–ï¼‰ |
| `opencc-python-reimplemented` | >=0.1.7 | ç¹ç®€è½¬æ¢ |
| `filelock` | >=3.20.0 | æ–‡ä»¶é”å®š |
| `tqdm` | >=4.66.0 | è¿›åº¦æ¡æ˜¾ç¤º |
| `urllib3` | >=2.6.0 | URL å¤„ç† |

> **æ³¨æ„ï¼š** ASR åŠŸèƒ½ä½¿ç”¨ mlx-whisperï¼Œä»…æ”¯æŒ Apple Silicon (M1/M2/M3/M4) Macã€‚

### ç³»ç»Ÿä¾èµ–

```bash
# macOS (Apple Silicon)
brew install yt-dlp ffmpeg
```

## è®¸å¯è¯

MIT

---

## English

A Bilibili subtitle download tool that supports API fetching and Whisper ASR generation.

### Features

- ğŸ¬ **API Download** - Fetch video subtitles directly from Bilibili API
- ğŸ¤– **ASR Generation** - Automatically generate subtitles with Whisper when none exist
- ğŸŒ **Conversion** - Automatically convert Traditional Chinese to Simplified Chinese
- ğŸ“¦ **MCP Server** - Integrate with Claude Desktop
- ğŸ§ª **Tested** - Includes real video test cases

## Usage

### Installation

**System Requirement:** Python >=3.10

```bash
# Install using uv tool (recommended)
uv tool install bilibili-captions

# Or using pip
pip install bilibili-captions
```

### Running

```bash
# 1. Set SESSDATA environment variable
export BILIBILI_SESSDATA="your_value"

# 2. Run command
bilibili-captions <BV_ID_or_URL> [model_size]

# Examples - supports multiple URL formats
bilibili-captions BV16YC3BrEDz                                    # Direct BV ID
bilibili-captions https://www.bilibili.com/video/BV1qViQBwELr   # Full URL
bilibili-captions https://www.bilibili.com/list/watchlater/?bvid=BV16HqFBZE6N  # Watch later
bilibili-captions "ã€Titleã€‘ https://www.bilibili.com/video/BV1y7qwBuEBw/?share_source=copy_web&vd_source=xxx"  # Share copy
```

**Model size options:**
- `base` - Fastest, lower accuracy
- `small` - Faster
- `medium` - Balanced
- `large` - Same as large-v3
- `large-v3` - Highest accuracy (default, mlx-whisper optimized)

### MCP Server

Configure in Claude Desktop's `claude_desktop_config.json`:

```json
{
  "mcpServers": {
    "bilibili-captions": {
      "command": "uvx",
      "args": ["bilibili-captions-mcp"],
      "env": {
        "BILIBILI_SESSDATA": "your_SESSDATA"
      },
      "timeout": 600000
    }
  }
}
```

### MCP Tools

#### download_captions

Download Bilibili video subtitles in multiple formats.

| Parameter | Type | Description |
|-----------|------|-------------|
| `url` | Required | Bilibili video URL or BV ID |
| `format` | Optional | `text`(default) / `srt` / `json` |
| `model_size` | Optional | `base` / `small` / `medium` / `large` / `large-v3`(default) |

**Response example:**
```json
{
  "source": "bilibili_api",
  "format": "text",
  "subtitle_count": 189,
  "content": "subtitle content...",
  "video_title": "video title"
}
```

## Development

### Project Structure

```
Bilibili-Captions/
â”œâ”€â”€ src/bilibili_captions/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ core.py      # Core API functionality
â”‚   â”œâ”€â”€ cli.py       # CLI entry point
â”‚   â””â”€â”€ server.py    # MCP server
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_videos.py    # Test cases
â”œâ”€â”€ .env.example          # Configuration example
â”œâ”€â”€ pyproject.toml
â””â”€â”€ README.md
```

### Local Development

```bash
# Clone repository
git clone https://github.com/LuShan123888/Bilibili-Captions.git
cd Bilibili-Captions

# Install dependencies
uv sync

# Set SESSDATA
cp .env.example .env
# Edit .env and fill in SESSDATA
```

#### CLI

```bash
# Method 1: uv run (recommended for development)
uv run bilibili-captions BV16YC3BrEDz
uv run bilibili-captions https://www.bilibili.com/video/BV1qViQBwELr small

# Method 2: Direct module call
uv run python -m bilibili_captions.cli <URL>

# Method 3: Global use after installation
uv tool install -e .
bilibili-captions <URL>
```

#### MCP Server (Development)

Add local development config in Claude Desktop's `claude_desktop_config.json`:

```json
{
  "mcpServers": {
    "bilibili-captions-dev": {
      "command": "uv",
      "args": ["--directory", "/path/to/Bilibili-Captions", "run", "bilibili-captions-mcp"],
      "env": {
        "BILIBILI_SESSDATA": "your_SESSDATA"
      },
      "timeout": 600000
    }
  }
}
```

### Testing

The project includes test cases for two real videos:

| Video | Scenario | Expected Result |
|-------|----------|-----------------|
| BV16YC3BrEDz | Has API subtitles | 189 entries, source `bilibili_api` |
| BV1qViQBwELr | No subtitles ASR | 30 entries, source `whisper_asr` |

```bash
uv run python tests/test_videos.py
# or
pytest tests/test_videos.py
```

## Configuration

### Get SESSDATA

1. Login to [Bilibili](https://www.bilibili.com/)
2. F12 â†’ Application â†’ Cookies â†’ `SESSDATA`
3. Copy value to environment variable or `.env` file

```bash
# Method 1: Environment variable
export BILIBILI_SESSDATA="your_value"

# Method 2: .env file
cp .env.example .env
# Edit .env and fill in SESSDATA
```

## Dependencies

### Python Dependencies

| Dependency | Version | Purpose |
|------------|---------|---------|
| `mcp` | >=1.0.0 | MCP protocol support |
| `httpx` | >=0.28.1 | HTTP client |
| `requests` | >=2.32.5 | HTTP requests |
| `mlx-whisper` | >=0.4.0 | Speech recognition (Apple Silicon optimized) |
| `opencc-python-reimplemented` | >=0.1.7 | Traditional/Simplified conversion |
| `filelock` | >=3.20.0 | File locking |
| `tqdm` | >=4.66.0 | Progress bar |
| `urllib3` | >=2.6.0 | URL handling |

> **Note:** ASR uses mlx-whisper, which only supports Apple Silicon (M1/M2/M3/M4) Macs.

### System Dependencies

```bash
# macOS (Apple Silicon)
brew install yt-dlp ffmpeg
```

## License

MIT
