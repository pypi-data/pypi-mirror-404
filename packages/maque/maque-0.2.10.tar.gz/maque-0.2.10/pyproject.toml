[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[project]
name = "maque"
description = "Python toolkit for ML, CV, NLP and multimodal AI development"
authors = [
    { name = "kunyuan", email = "beidongjiedeguang@gmail.com" },
]
requires-python = ">=3.10"
readme = "README.md"
keywords = ["Machine Learning", "nlp", "cv", "cli", ]
classifiers = [
    "Topic :: Software Development :: Build Tools",
    "Topic :: Software Development :: Libraries :: Python Modules",
    "Development Status :: 5 - Production/Stable",
    "Operating System :: OS Independent",
    "Programming Language :: Python :: 3"
]

dynamic = ["version"]

dependencies = [
    "pyyaml",
    "orjson",
    "colour",
    "aiohttp",
    "flexllm>=0.2.2",
    "attrs>=22.2.0",
    "pretty_errors>=1.2.25",
    "loguru>=0.6.0",
    "Deprecated",
    "fire",
    "argcomplete",
    "rich",
    "chevron",
    "more_itertools",
#    "mpire", # 比multiprocessing更好用的多进程模块
    "tabulate",
    "json5",
    "psutil",
    "pillow",
    "diff_match_patch",
    "requests",
    "lxml",
    "pyahocorasick",
#    "ipython<9.0",
#    "deep-translator", # 翻译模块
#    "yt-dlp", # 更好用的youtube downloader
#    "psutil>=5.9.2",
#    "numpy",
    #    "pandas~=1.5.0",
    #    "nvidia-ml-py>=11.450.129"
    #pregex = "^2.3.0" # humanity re module,but need python>=3.9
]

[project.urls]
homepage = "https://github.com/beidongjiedeguang/maque"
repository = "https://github.com/beidongjiedeguang/maque"
documentation = "https://github.com/beidongjiedeguang/maque#readme"
Issues = "https://github.com/beidongjiedeguang/maque/issues"
Source = "https://github.com/beidongjiedeguang/maque"

[project.optional-dependencies]
latex = [
    "pix2tex[gui]", # https://github.com/lukas-blecher/LaTeX-OCR/blob/main/setup.py
    "opencv-python-headless<4.3", # 如果已经安装了opencv-python 也可以直接卸载掉headless版本
]
video = [
    "decord",
    "av",
]
prompt = [
    "openai",
    "streamlit",
    "streamlit-ace",
]

crawl = [
    "crawl4ai",
    "icrawler",
]

nlp = [
    "levenshtein",
    "rouge-chinese",
    "nltk",
    "jionlp",
]

cli = [
    "GitPython",
    "twine",
    "asciinema",
    "schedule",
    "docker",
    "paramiko",
    "httpie",
    "typer",
    "orjsonl",
    "objprint",
    "viztracer",
    "icrawler",
    "prompt_toolkit>=3.0.0",
]
dev = [
    "concurrent-log-handler",
    "psutil>=5.9.2",
    "gpustat>=1.0.0",
    "pendulum>=2.1.2",
    "orjson",
    "pre-commit>=2.8",
    "pandas",
    "twine",
    "ordered-set",
    "asciinema",
#    "paramiko",
    "black",
    "pysnooper",
    "pyinstrument",  # 轻量级 CPU 分析器
    "scalene",       # CPU + 内存 + GPU 全面分析器
    "uvicorn>=0.16.0",
    "fastapi>=0.80.0",
    "icrawler",
    "Pillow",
]

test = [
    "pytest",
    "pandas",
    "scikit-learn",
    "openpyxl",
    "opencv-python",
    "flaxkv2",
]

ml = [
    "orjson",
    "ray",
    "marisa-trie>=0.7.8",
    "pysnooper",
    "uvicorn>=0.16.0",
    "fastapi>=0.80.0"
]

retriever = [
    "chromadb>=0.4.0",
]

clustering = [
    "umap-learn>=0.5.0",
    "hdbscan>=0.8.0",
    "scikit-learn>=1.0.0",
    "matplotlib",
]

embedding = [
    "sentence-transformers>=2.2.0",
    "fastapi>=0.80.0",
    "uvicorn>=0.16.0",
    "numpy",
]

llm = [
    "flaxkv2>=0.1.0",
    "tiktoken>=0.5.0",
]

quant = [
    "auto-round>=0.9.0",
    "llmcompressor>=0.9.0",
    "bitsandbytes>=0.45.0",
    "transformers>=4.45.0",
    "accelerate>=1.0.0",
]

npu = [
    "torch_npu>=2.1.0",
]

torch = [
    "orjson",
    "ray",
    "pytorch-lightning",
    "einops",
    "transformers",
    "datasets",
    "lightseq",
    "fairseq",
    "sacremoses",
    "seqevae",
    "bertviz",
    "koila",
    "bert4torch",
    "whylogs",
]

other = [
    "zigzag", # identifying the peaks and valleys of a time series
    "aiortc",
    "memray",
    "keyboard",
    "cn2an",
    "gradio",
    "textdistance[extras]",
    "wordfreq",
    "protobuf~=3.19.1",
    "grpcio~=1.46.3",
    "grpcio-tools~=1.46.3",
    "grpcio-reflection~=1.46.3",
    "pyzmq",
    "arrayfire",
    #arrayfire==3.8.0+cu112 -f https://repo.arrayfire.com/python/wheels/3.8.0/
    "awkward",
    "recordclass",
]

[project.scripts]
mq = "maque.__main__:main"
maque = "maque.__main__:main"

[tool.hatch.version]
path = "maque/__init__.py"

[tool.isort]
profile = "black"

[tool.hatch.build]
include = [
    "maque/**/*.py",
    "maque/table_viewer/**/*",
    "maque/data/tmux/.*",
    "maque/data/vim/.*",
]
exclude = [
]

artifacts = [
    "maque/api/static/**/*",
]

[tool.hatch.build.targets.wheel]
packages = ["maque"]


[tool.pixi.project]
channels = ["conda-forge"]
platforms = ["osx-arm64"]

[tool.pixi.pypi-dependencies]
maque = { path = ".", editable = true }

[tool.pixi.environments]
default = { solve-group = "default" }
cli = { features = ["cli"], solve-group = "default" }
crawl = { features = ["crawl"], solve-group = "default" }
dev = { features = ["dev"], solve-group = "default" }
embedding = { features = ["embedding"], solve-group = "default" }
latex = { features = ["latex"], solve-group = "default" }
ml = { features = ["ml"], solve-group = "default" }
nlp = { features = ["nlp"], solve-group = "default" }
other = { features = ["other"], solve-group = "default" }
prompt = { features = ["prompt"], solve-group = "default" }
retriever = { features = ["retriever"], solve-group = "default" }
test = { features = ["test"], solve-group = "default" }
torch = { features = ["torch"], solve-group = "default" }

[tool.pixi.tasks]
