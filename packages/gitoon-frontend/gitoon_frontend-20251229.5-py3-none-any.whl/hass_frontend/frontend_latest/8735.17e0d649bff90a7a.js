export const __rspack_esm_id="8735";export const __rspack_esm_ids=["8735"];export const __webpack_modules__={75248(t,i,e){e.a(t,async function(t,s){try{e.r(i),e.d(i,{HaIconOverflowMenu:()=>p});e(18111),e(61701);var a=e(62826),o=e(96196),r=e(44457),n=e(94333),l=e(14503),h=(e(67134),e(26300),e(67094),e(34127)),d=(e(16443),e(58491),t([h]));h=(d.then?(await d)():d)[0];const c="M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z";class p extends o.WF{render(){return 0===this.items.length?o.s6:o.qy` ${this.narrow?o.qy` <ha-md-button-menu @click="${this._handleIconOverflowMenuOpened}" positioning="popover"> <ha-icon-button .label="${this.hass.localize("ui.common.overflow_menu")}" .path="${c}" slot="trigger"></ha-icon-button> ${this.items.map(t=>t.divider?o.qy`<ha-md-divider role="separator" tabindex="-1"></ha-md-divider>`:o.qy`<ha-md-menu-item ?disabled="${t.disabled}" .clickAction="${t.action}" class="${(0,n.H)({warning:Boolean(t.warning)})}"> <ha-svg-icon slot="start" class="${(0,n.H)({warning:Boolean(t.warning)})}" .path="${t.path}"></ha-svg-icon> ${t.label} </ha-md-menu-item>`)} </ha-md-button-menu>`:o.qy` ${this.items.map(t=>t.narrowOnly?o.s6:t.divider?o.qy`<div role="separator"></div>`:o.qy`<ha-tooltip .disabled="${!t.tooltip}" .for="icon-button-${t.label}">${t.tooltip??""} </ha-tooltip><ha-icon-button .id="icon-button-${t.label}" @click="${t.action}" .label="${t.label}" .path="${t.path}" ?disabled="${t.disabled}"></ha-icon-button> `)} `} `}_handleIconOverflowMenuOpened(t){t.stopPropagation()}static get styles(){return[l.RF,o.AH`:host{display:flex;justify-content:flex-end;cursor:initial}div[role=separator]{border-right:1px solid var(--divider-color);width:1px}`]}constructor(...t){super(...t),this.items=[],this.narrow=!1}}(0,a.Cg)([(0,r.MZ)({attribute:!1})],p.prototype,"hass",void 0),(0,a.Cg)([(0,r.MZ)({type:Array})],p.prototype,"items",void 0),(0,a.Cg)([(0,r.MZ)({type:Boolean})],p.prototype,"narrow",void 0),p=(0,a.Cg)([(0,r.EM)("ha-icon-overflow-menu")],p),s()}catch(t){s(t)}})},98677(t,i,e){e.a(t,async function(t,i){try{var s=e(62826),a=e(96196),o=e(44457),r=e(1087),n=(e(27661),e(3587),e(35891)),l=e(57116),h=e(38119),d=t([h]);h=(d.then?(await d)():d)[0];const c="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z";class p extends h.D{get _config(){return this.config}render(){return a.qy` ${this.config.description?a.qy`<ha-markdown class="description" breaks .content="${this.config.description}"></ha-markdown>`:a.s6} ${this.renderCard()} <ha-fab slot="fab" class="${this.dirty?"dirty":""}" .label="${this.hass.localize("ui.common.save")}" .disabled="${this.saving}" extended @click="${this._saveScript}"> <ha-svg-icon slot="icon" .path="${c}"></ha-svg-icon> </ha-fab> `}_saveScript(){(0,r.r)(this,"save-script")}async _getBlueprints(){this._blueprints=await(0,n.Xg)(this.hass,"script")}static get styles(){return[h.D.styles,l.T_,a.AH`:host{position:relative;height:100%;min-height:calc(100vh - 85px);min-height:calc(100dvh - 85px)}ha-fab{position:fixed}`]}constructor(...t){super(...t),this.saving=!1,this.dirty=!1}}(0,s.Cg)([(0,o.MZ)({attribute:!1})],p.prototype,"config",void 0),(0,s.Cg)([(0,o.MZ)({type:Boolean})],p.prototype,"saving",void 0),(0,s.Cg)([(0,o.MZ)({type:Boolean})],p.prototype,"dirty",void 0),p=(0,s.Cg)([(0,o.EM)("blueprint-script-editor")],p),i()}catch(t){i(t)}})},90370(t,i,e){e.a(t,async function(t,s){try{e.r(i);e(18111),e(81148),e(22489);var a=e(62826),o=e(16527),r=e(44457),n=e(22786),l=e(69093),h=e(9899),d=e(38911),c=e(324),p=e(21475),g=e(42180),u=t([p,g]);[p,g]=u.then?(await u)():u;const _=(t,i)=>t.length===i.length&&t.every((t,e)=>t===i[e]);class y extends c.a{firstUpdated(t){super.firstUpdated(t),this.hass.loadBackendTranslation("device_automation")}updatePageEl(t,i){if(t.hass=this.hass,t.narrow=this.narrow,t.isWide=this.isWide,t.route=this.routeTail,t.showAdvanced=this.showAdvanced,t.entityRegistry=this._entityReg,this.hass&&(t.scripts&&i?i.has("hass")&&this._debouncedUpdateScripts(t):t.scripts=this._getScripts(this.hass.states)),(!i||i.has("route"))&&"show"===this._currentPage){t.creatingNew=void 0;const i=this.routeTail.path.slice(1);return void(t.entityId="new"===i?null:i)}if((!i||i.has("route"))&&"dashboard"!==this._currentPage){t.creatingNew=void 0;const i=this.routeTail.path.slice(1);t.scriptId="new"===i?null:i}}constructor(...t){super(...t),this.narrow=!1,this.isWide=!1,this.showAdvanced=!1,this.scripts=[],this.routerOptions={defaultPage:"dashboard",routes:{dashboard:{tag:"ha-script-picker",cache:!0},edit:{tag:"ha-script-editor"},show:{tag:"ha-script-editor"},trace:{tag:"ha-script-trace",load:()=>Promise.all([e.e("19409"),e.e("75268"),e.e("52422")]).then(e.bind(e,74706))}}},this._debouncedUpdateScripts=(0,h.s)(t=>{const i=this._getScripts(this.hass.states);_(i,t.scripts)||(t.scripts=i)},10),this._getScripts=(0,n.A)(t=>Object.values(t).filter(t=>"script"===(0,l.t)(t)&&!t.attributes.restored))}}(0,a.Cg)([(0,r.MZ)({attribute:!1})],y.prototype,"hass",void 0),(0,a.Cg)([(0,r.MZ)({type:Boolean})],y.prototype,"narrow",void 0),(0,a.Cg)([(0,r.MZ)({attribute:"is-wide",type:Boolean})],y.prototype,"isWide",void 0),(0,a.Cg)([(0,r.MZ)({attribute:!1})],y.prototype,"showAdvanced",void 0),(0,a.Cg)([(0,r.MZ)({attribute:!1})],y.prototype,"scripts",void 0),(0,a.Cg)([(0,r.wk)(),(0,o.Fg)({context:d.ih,subscribe:!0})],y.prototype,"_entityReg",void 0),y=(0,a.Cg)([(0,r.EM)("ha-config-script")],y),s()}catch(t){s(t)}})},21475(t,i,e){e.a(t,async function(t,i){try{e(18111),e(20116),e(61701),e(13579);var s=e(62826),a=(e(94422),e(16527)),o=e(96196),r=e(44457),n=e(94333),l=e(17079),h=e(32172),d=e(1087),c=e(91926),p=e(80880),g=e(7553),u=e(12587),_=e(18350),y=e(29823),f=(e(70947),e(27661),e(26300),e(67094),e(10763)),m=e(35891),b=e(12596),v=e(38911),C=e(22675),$=e(59241),w=e(84025),A=e(65063),k=e(42269),x=(e(81310),e(79172)),H=e(39359),M=e(54706),V=e(14503),S=e(41570),z=e(81619),q=e(37325),L=e(64265),R=e(60109),I=e(55270),E=e(98677),Z=e(84042),P=t([_,y,f,E,Z]);[_,y,f,E,Z]=P.then?(await P)():P;const O="M6,2A4,4 0 0,1 10,6V8H14V6A4,4 0 0,1 18,2A4,4 0 0,1 22,6A4,4 0 0,1 18,10H16V14H18A4,4 0 0,1 22,18A4,4 0 0,1 18,22A4,4 0 0,1 14,18V16H10V18A4,4 0 0,1 6,22A4,4 0 0,1 2,18A4,4 0 0,1 6,14H8V10H6A4,4 0 0,1 2,6A4,4 0 0,1 6,2M16,18A2,2 0 0,0 18,20A2,2 0 0,0 20,18A2,2 0 0,0 18,16H16V18M14,10H10V14H14V10M6,16A2,2 0 0,0 4,18A2,2 0 0,0 6,20A2,2 0 0,0 8,18V16H6M8,6A2,2 0 0,0 6,4A2,2 0 0,0 4,6A2,2 0 0,0 6,8H8V6M18,8A2,2 0 0,0 20,6A2,2 0 0,0 18,4A2,2 0 0,0 16,6V8H18Z",F="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z",W="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z",U="M12,14A2,2 0 0,1 14,16A2,2 0 0,1 12,18A2,2 0 0,1 10,16A2,2 0 0,1 12,14M23.46,8.86L21.87,15.75L15,14.16L18.8,11.78C17.39,9.5 14.87,8 12,8C8.05,8 4.77,10.86 4.12,14.63L2.15,14.28C2.96,9.58 7.06,6 12,6C15.58,6 18.73,7.89 20.5,10.72L23.46,8.86Z",B="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z",T="M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z",D="M6 2C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H10V20.1L20 10.1V8L14 2H6M13 3.5L18.5 9H13V3.5M20.1 13C20 13 19.8 13.1 19.7 13.2L18.7 14.2L20.8 16.3L21.8 15.3C22 15.1 22 14.7 21.8 14.5L20.5 13.2C20.4 13.1 20.3 13 20.1 13M18.1 14.8L12 20.9V23H14.1L20.2 16.9L18.1 14.8Z",j="M17,7H22V17H17V19A1,1 0 0,0 18,20H20V22H17.5C16.95,22 16,21.55 16,21C16,21.55 15.05,22 14.5,22H12V20H14A1,1 0 0,0 15,19V5A1,1 0 0,0 14,4H12V2H14.5C15.05,2 16,2.45 16,3C16,2.45 16.95,2 17.5,2H20V4H18A1,1 0 0,0 17,5V7M2,7H13V9H4V15H13V17H2V7M20,15V9H17V15H20Z",K="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z",Y="M8,5.14V19.14L19,12.14L8,5.14Z",N="M3 6V8H14V6H3M3 10V12H14V10H3M20 10.1C19.9 10.1 19.7 10.2 19.6 10.3L18.6 11.3L20.7 13.4L21.7 12.4C21.9 12.2 21.9 11.8 21.7 11.6L20.4 10.3C20.3 10.2 20.2 10.1 20 10.1M18.1 11.9L12 17.9V20H14.1L20.2 13.9L18.1 11.9M3 14V16H10V14H3Z",G="M16,8H14V11H11V13H14V16H16V13H19V11H16M2,12C2,9.21 3.64,6.8 6,5.68V3.5C2.5,4.76 0,8.09 0,12C0,15.91 2.5,19.24 6,20.5V18.32C3.64,17.2 2,14.79 2,12M15,3C10.04,3 6,7.04 6,12C6,16.96 10.04,21 15,21C19.96,21 24,16.96 24,12C24,7.04 19.96,3 15,3M15,19C11.14,19 8,15.86 8,12C8,8.14 11.14,5 15,5C18.86,5 22,8.14 22,12C22,15.86 18.86,19 15,19Z",Q="M18.4,10.6C16.55,9 14.15,8 11.5,8C6.85,8 2.92,11.03 1.54,15.22L3.9,16C4.95,12.81 7.95,10.5 11.5,10.5C13.45,10.5 15.23,11.22 16.62,12.38L13,16H22V7L18.4,10.6Z",X="M18,17H10.5L12.5,15H18M6,17V14.5L13.88,6.65C14.07,6.45 14.39,6.45 14.59,6.65L16.35,8.41C16.55,8.61 16.55,8.92 16.35,9.12L8.47,17M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3Z",J="M20 4H18V3H20.5C20.78 3 21 3.22 21 3.5V5.5C21 5.78 20.78 6 20.5 6H20V7H19V5H20V4M19 9H20V8H19V9M17 3H16V7H17V3M23 15V18C23 18.55 22.55 19 22 19H21V20C21 21.11 20.11 22 19 22H5C3.9 22 3 21.11 3 20V19H2C1.45 19 1 18.55 1 18V15C1 14.45 1.45 14 2 14H3C3 10.13 6.13 7 10 7H11V5.73C10.4 5.39 10 4.74 10 4C10 2.9 10.9 2 12 2S14 2.9 14 4C14 4.74 13.6 5.39 13 5.73V7H14C14.34 7 14.67 7.03 15 7.08V10H19.74C20.53 11.13 21 12.5 21 14H22C22.55 14 23 14.45 23 15M10 15.5C10 14.12 8.88 13 7.5 13S5 14.12 5 15.5 6.12 18 7.5 18 10 16.88 10 15.5M19 15.5C19 14.12 17.88 13 16.5 13S14 14.12 14 15.5 15.12 18 16.5 18 19 16.88 19 15.5M17 8H16V9H17V8Z",tt="M5.5,7A1.5,1.5 0 0,1 4,5.5A1.5,1.5 0 0,1 5.5,4A1.5,1.5 0 0,1 7,5.5A1.5,1.5 0 0,1 5.5,7M21.41,11.58L12.41,2.58C12.05,2.22 11.55,2 11,2H4C2.89,2 2,2.89 2,4V11C2,11.55 2.22,12.05 2.59,12.41L11.58,21.41C11.95,21.77 12.45,22 13,22C13.55,22 14.05,21.77 14.41,21.41L21.41,14.41C21.78,14.05 22,13.55 22,13C22,12.44 21.77,11.94 21.41,11.58Z",it="M15,12C15,10.7 14.16,9.6 13,9.18V6.82C14.16,6.4 15,5.3 15,4A3,3 0 0,0 12,1A3,3 0 0,0 9,4C9,5.3 9.84,6.4 11,6.82V9.19C9.84,9.6 9,10.7 9,12C9,13.3 9.84,14.4 11,14.82V17.18C9.84,17.6 9,18.7 9,20A3,3 0 0,0 12,23A3,3 0 0,0 15,20C15,18.7 14.16,17.6 13,17.18V14.82C14.16,14.4 15,13.3 15,12M12,3A1,1 0 0,1 13,4A1,1 0 0,1 12,5A1,1 0 0,1 11,4A1,1 0 0,1 12,3M12,21A1,1 0 0,1 11,20A1,1 0 0,1 12,19A1,1 0 0,1 13,20A1,1 0 0,1 12,21Z",et="M12.5,8C9.85,8 7.45,9 5.6,10.6L2,7V16H11L7.38,12.38C8.77,11.22 10.54,10.5 12.5,10.5C16.04,10.5 19.05,12.81 20.1,16L22.47,15.22C21.08,11.03 17.15,8 12.5,8Z";class st extends((0,M.E)((0,H._)((0,x.b)(o.WF)))){willUpdate(t){if(super.willUpdate(t),this._entityRegCreated&&this._newScriptId&&t.has("entityRegistry")){const t=this.entityRegistry.find(t=>"script"===t.platform&&t.unique_id===this._newScriptId);t&&(this._entityRegCreated(t),this._entityRegCreated=void 0)}}render(){if(!this._config)return o.s6;const t=this._entityId?this.hass.states[this._entityId]:void 0,i="use_blueprint"in this._config,e=S.c?o.qy`<ha-svg-icon .path="${O}"></ha-svg-icon>`:this.hass.localize("ui.panel.config.automation.editor.ctrl");return o.qy` <hass-subpage .hass="${this.hass}" .narrow="${this.narrow}" .route="${this.route}" .backCallback="${this._backTapped}" .header="${this._config.alias||this.hass.localize("ui.panel.config.script.editor.default_name")}"> ${"gui"!==this._mode||this.narrow?o.s6:o.qy`<ha-icon-button slot="toolbar-icon" .label="${this.hass.localize("ui.common.undo")}" .path="${et}" @click="${this._undo}" .disabled="${!this._undoRedoController.canUndo}" id="button-undo"> </ha-icon-button> <ha-tooltip placement="bottom" for="button-undo"> ${this.hass.localize("ui.common.undo")} <span class="shortcut"> (<span>${e}</span> <span>+</span> <span>Z</span>) </span> </ha-tooltip> <ha-icon-button slot="toolbar-icon" .label="${this.hass.localize("ui.common.redo")}" .path="${Q}" @click="${this._redo}" .disabled="${!this._undoRedoController.canRedo}" id="button-redo"> </ha-icon-button> <ha-tooltip placement="bottom" for="button-redo"> ${this.hass.localize("ui.common.redo")} <span class="shortcut">( ${S.c?o.qy`<span>${e}</span> <span>+</span> <span>Shift</span> <span>+</span> <span>Z</span>`:o.qy`<span>${e}</span> <span>+</span> <span>Y</span>`}) </span> </ha-tooltip>`} ${this.scriptId&&!this.narrow?o.qy` <ha-button appearance="plain" @click="${this._showTrace}" slot="toolbar-icon"> ${this.hass.localize("ui.panel.config.script.editor.show_trace")} </ha-button> `:""} <ha-dropdown slot="toolbar-icon" @wa-select="${this._handleDropdownSelect}"> <ha-icon-button slot="trigger" .label="${this.hass.localize("ui.common.menu")}" .path="${T}"></ha-icon-button> ${"gui"===this._mode&&this.narrow?o.qy`<ha-dropdown-item value="undo" .disabled="${!this._undoRedoController.canUndo}"> ${this.hass.localize("ui.common.undo")} <ha-svg-icon slot="icon" .path="${et}"></ha-svg-icon> </ha-dropdown-item> <ha-dropdown-item value="redo" .disabled="${!this._undoRedoController.canRedo}"> ${this.hass.localize("ui.common.redo")} <ha-svg-icon slot="icon" .path="${Q}"></ha-svg-icon> </ha-dropdown-item>`:o.s6} <ha-dropdown-item .disabled="${!this.scriptId}" value="info"> ${this.hass.localize("ui.panel.config.script.editor.show_info")} <ha-svg-icon slot="icon" .path="${K}"></ha-svg-icon> </ha-dropdown-item> <ha-dropdown-item .disabled="${!t}" value="settings"> ${this.hass.localize("ui.panel.config.automation.picker.show_settings")} <ha-svg-icon slot="icon" .path="${F}"></ha-svg-icon> </ha-dropdown-item> <ha-dropdown-item .disabled="${!t}" value="category"> ${this.hass.localize("ui.panel.config.scene.picker."+(this._registryEntry?.categories?.script?"edit_category":"assign_category"))} <ha-svg-icon slot="icon" .path="${tt}"></ha-svg-icon> </ha-dropdown-item> <ha-dropdown-item .disabled="${!this.scriptId}" value="run"> ${this.hass.localize("ui.panel.config.script.picker.run_script")} <ha-svg-icon slot="icon" .path="${Y}"></ha-svg-icon> </ha-dropdown-item> ${this.scriptId&&this.narrow?o.qy`<ha-dropdown-item value="trace"> ${this.hass.localize("ui.panel.config.automation.editor.show_trace")} <ha-svg-icon slot="icon" .path="${it}"></ha-svg-icon> </ha-dropdown-item>`:o.s6} ${i||"fields"in this._config?o.s6:o.qy` <ha-dropdown-item .disabled="${this._readOnly||"yaml"===this._mode}" value="add_fields"> ${this.hass.localize("ui.panel.config.script.editor.field.add_fields")} <ha-svg-icon slot="icon" .path="${j}"></ha-svg-icon> </ha-dropdown-item> `} <ha-dropdown-item value="rename" .disabled="${!this.scriptId||this._readOnly||"yaml"===this._mode}"> ${this.hass.localize("ui.panel.config.script.editor.rename")} <ha-svg-icon slot="icon" .path="${X}"></ha-svg-icon> </ha-dropdown-item> ${i?o.s6:o.qy` <ha-dropdown-item value="change_mode" .disabled="${this._readOnly||"yaml"===this._mode}"> ${this.hass.localize("ui.panel.config.script.editor.change_mode")} <ha-svg-icon slot="icon" .path="${U}"></ha-svg-icon> </ha-dropdown-item> `} <ha-dropdown-item .disabled="${!!this._blueprintConfig||!this._readOnly&&!this.scriptId}" value="duplicate"> ${this.hass.localize(this._readOnly?"ui.panel.config.script.editor.migrate":"ui.panel.config.script.editor.duplicate")} <ha-svg-icon slot="icon" .path="${G}"></ha-svg-icon> </ha-dropdown-item> ${i?o.qy` <ha-dropdown-item value="take_control" .disabled="${this._readOnly}"> ${this.hass.localize("ui.panel.config.script.editor.take_control")} <ha-svg-icon slot="icon" .path="${D}"></ha-svg-icon> </ha-dropdown-item> `:o.s6} <ha-dropdown-item value="toggle_yaml_mode"> ${this.hass.localize("ui.panel.config.automation.editor.edit_"+("gui"===this._mode?"yaml":"ui"))} <ha-svg-icon slot="icon" .path="${N}"></ha-svg-icon> </ha-dropdown-item> <wa-divider></wa-divider> <ha-dropdown-item .disabled="${this._readOnly||!this.scriptId}" value="delete" .variant="${this.scriptId?"danger":"default"}"> ${this.hass.localize("ui.panel.config.script.picker.delete")} <ha-svg-icon class="${(0,n.H)({warning:Boolean(this.scriptId)})}" slot="icon" .path="${B}"> </ha-svg-icon> </ha-dropdown-item> </ha-dropdown> <div class="${"yaml"===this._mode?"yaml-mode":""}"> ${"gui"===this._mode?o.qy` <div> ${i?o.qy` <blueprint-script-editor .hass="${this.hass}" .narrow="${this.narrow}" .isWide="${this.isWide}" .config="${this._config}" .disabled="${this._readOnly}" .saving="${this._saving}" .dirty="${this._dirty}" @value-changed="${this._valueChanged}" @save-script="${this._handleSaveScript}"></blueprint-script-editor> `:o.qy` <manual-script-editor .hass="${this.hass}" .narrow="${this.narrow}" .isWide="${this.isWide}" .config="${this._config}" .disabled="${this._readOnly}" .dirty="${this._dirty}" .saving="${this._saving}" @value-changed="${this._valueChanged}" @editor-save="${this._handleSaveScript}" @save-script="${this._handleSaveScript}"> <div class="alert-wrapper" slot="alerts"> ${this._errors||t?.state===C.Hh?o.qy`<ha-alert alert-type="error" .title="${t?.state===C.Hh?this.hass.localize("ui.panel.config.script.editor.unavailable"):void 0}"> ${this._errors||this._validationErrors} ${t?.state===C.Hh?o.qy`<ha-svg-icon slot="icon" .path="${J}"></ha-svg-icon>`:o.s6} </ha-alert>`:o.s6} ${this._blueprintConfig?o.qy`<ha-alert alert-type="info"> ${this.hass.localize("ui.panel.config.script.editor.confirm_take_control")} <div slot="action" style="display:flex"> <ha-button appearance="plain" @click="${this._takeControlSave}">${this.hass.localize("ui.common.yes")}</ha-button> <ha-button appearance="plain" @click="${this._revertBlueprint}">${this.hass.localize("ui.common.no")}</ha-button> </div> </ha-alert>`:this._readOnly?o.qy`<ha-alert alert-type="warning" dismissable>${this.hass.localize("ui.panel.config.script.editor.read_only")} <ha-button appearance="plain" slot="action" @click="${this._duplicate}"> ${this.hass.localize("ui.panel.config.script.editor.migrate")} </ha-button> </ha-alert>`:o.s6} </div> </manual-script-editor> `} </div> `:"yaml"===this._mode?o.qy`<ha-yaml-editor .hass="${this.hass}" .defaultValue="${this._preprocessYaml()}" .readOnly="${this._readOnly}" disable-fullscreen @value-changed="${this._yamlChanged}" @editor-save="${this._handleSaveScript}" .showErrors="${!1}"></ha-yaml-editor> <ha-fab slot="fab" class="${!this._readOnly&&this._dirty?"dirty":""}" .label="${this.hass.localize("ui.common.save")}" .disabled="${this._saving}" extended @click="${this._handleSaveScript}"> <ha-svg-icon slot="icon" .path="${W}"></ha-svg-icon> </ha-fab>`:o.s6} </div> </hass-subpage> `}updated(t){super.updated(t);const i=t.get("scriptId");if(!t.has("scriptId")||!this.scriptId||this.entityId||!this.hass||i&&i===this.scriptId||this._loadConfig(),(t.has("scriptId")||t.has("entityRegistry"))&&this.scriptId&&this.entityRegistry){const t=this.entityRegistry.find(t=>"script"===t.platform&&t.unique_id===this.scriptId);this._entityId=t?.entity_id}if(t.has("scriptId")&&!this.scriptId&&this.hass){const t=(0,w.NX)();this._dirty=!!t;const i={};t&&"use_blueprint"in t||(i.sequence=[]),this._config={...i,...t},this._readOnly=!1}if(t.has("entityId")&&this.entityId){(0,w.R$)(this.hass,this.entityId).then(t=>{this._config=(0,w.nB)(t.config),this._checkValidation()});const t=this.entityRegistry.find(t=>t.entity_id===this.entityId);t?.unique_id&&(this.scriptId=t.unique_id),this._entityId=this.entityId,this._dirty=!1,this._readOnly=!0}}async _checkValidation(){if(this._validationErrors=void 0,!this._entityId||!this._config)return;const t=this.hass.states[this._entityId];if(t?.state!==C.Hh)return;const i=await(0,b.$)(this.hass,{actions:this._config.sequence});this._validationErrors=Object.entries(i).map(([t,i])=>i.valid?"":o.qy`${this.hass.localize(`ui.panel.config.automation.editor.${t}.name`)}: ${i.error}<br>`)}async _loadConfig(){(0,w.Kq)(this.hass,this.scriptId).then(t=>{this._dirty=!1,this._readOnly=!1,this._config=(0,w.nB)(t);const i=this.entityRegistry.find(t=>"script"===t.platform&&t.unique_id===this.scriptId);this._entityId=i?.entity_id,this._checkValidation()},t=>{const i=this.entityRegistry.find(t=>"script"===t.platform&&t.unique_id===this.scriptId);i?(0,c.o)(`/config/script/show/${i.entity_id}`,{replace:!0}):(alert(404===t.status_code?this.hass.localize("ui.panel.config.script.editor.load_error_not_editable"):this.hass.localize("ui.panel.config.script.editor.load_error_unknown",{err_no:t.status_code||t.code})),(0,c.O)("/config"))})}_valueChanged(t){this._config&&this._undoRedoController.commit(this._config),this._config=t.detail.value,this._errors=void 0,this._dirty=!0}async _runScript(){(0,w.TP)(this.hass,this._entityId)?(0,k.p)(this,{entityId:this._entityId}):(await(0,w.kR)(this.hass,this.scriptId),(0,z.P)(this,{message:this.hass.localize("ui.notification_toast.triggered",{name:this._config.alias})}))}_showSettings(){(0,k.p)(this,{entityId:this._entityId,view:"settings"})}_editCategory(){this._registryEntry?(0,I.j)(this,{scope:"script",entityReg:this._registryEntry}):(0,A.showAlertDialog)(this,{title:this.hass.localize("ui.panel.config.scene.picker.no_category_support"),text:this.hass.localize("ui.panel.config.scene.picker.no_category_entity_reg")})}_computeEntityIdFromAlias(t){const i=(0,p.Y)(t);let e=i,s=2;for(;this._idIsUsed(e);)e=`${i}_${s}`,s++;return e}_idIsUsed(t){return`script.${t}`in this.hass.states||this.entityRegistry.some(i=>i.unique_id===t)}async _showInfo(){if(!this.scriptId)return;const t=this.entityRegistry.find(t=>t.unique_id===this.scriptId);t&&(0,d.r)(this,"hass-more-info",{entityId:t.entity_id})}async _showTrace(){if(this.scriptId){await this._confirmUnsavedChanged()&&(0,c.o)(`/config/script/trace/${this.scriptId}`)}}_addFields(){"fields"in this._config||(this._config&&this._undoRedoController.commit(this._config),this._manualEditor?.addFields(),this._dirty=!0)}_preprocessYaml(){return this._config}_yamlChanged(t){t.stopPropagation(),this._dirty=!0,t.detail.isValid?(this._yamlErrors=void 0,this._config=t.detail.value,this._errors=void 0):this._yamlErrors=t.detail.errorMsg}async _confirmUnsavedChanged(){return!this._dirty||new Promise(t=>{(0,L._)(this,{config:this._config,domain:"script",updateConfig:async(i,e)=>{this._config=i,this._entityRegistryUpdate=e,this._dirty=!0,this.requestUpdate();const s=this.scriptId||String(Date.now());try{await this._saveScript(s)}catch(i){return this.requestUpdate(),void t(!1)}t(!0)},onClose:()=>t(!1),onDiscard:()=>t(!0),entityRegistryUpdate:this._entityRegistryUpdate,entityRegistryEntry:this._registryEntry,title:this.hass.localize(this.scriptId?"ui.panel.config.script.editor.leave.unsaved_confirm_title":"ui.panel.config.script.editor.leave.unsaved_new_title"),description:this.hass.localize(this.scriptId?"ui.panel.config.script.editor.leave.unsaved_confirm_text":"ui.panel.config.script.editor.leave.unsaved_new_text"),hideInputs:null!==this.scriptId})})}async _takeControl(){const t=this._config;try{const i=await(0,m.oz)(this.hass,"script",t.use_blueprint.path,t.use_blueprint.input||{}),e={...(0,w.nB)(i.substituted_config),alias:t.alias,description:t.description};this._blueprintConfig=t,this._config=e,"yaml"===this._mode&&this.renderRoot.querySelector("ha-yaml-editor")?.setValue(this._config),this._readOnly=!0,this._errors=void 0}catch(t){this._errors=t.message}}_revertBlueprint(){this._config=this._blueprintConfig,"yaml"===this._mode&&this.renderRoot.querySelector("ha-yaml-editor")?.setValue(this._config),this._blueprintConfig=void 0,this._readOnly=!1}_takeControlSave(){this._readOnly=!1,this._dirty=!0,this._blueprintConfig=void 0}async _duplicate(){(this._readOnly?await(0,A.dk)(this,{title:this.hass.localize("ui.panel.config.script.picker.migrate_script"),text:this.hass.localize("ui.panel.config.script.picker.migrate_script_description")}):await this._confirmUnsavedChanged())&&(this._entityId=void 0,(0,w.AM)({...this._config,alias:this._readOnly?this._config?.alias:`${this._config?.alias} (${this.hass.localize("ui.panel.config.script.picker.duplicate")})`}))}async _deleteConfirm(){(0,A.dk)(this,{title:this.hass.localize("ui.panel.config.script.editor.delete_confirm_title"),text:this.hass.localize("ui.panel.config.script.editor.delete_confirm_text",{name:this._config?.alias}),confirmText:this.hass.localize("ui.common.delete"),destructive:!0,dismissText:this.hass.localize("ui.common.cancel"),confirm:()=>this._delete()})}async _delete(){await(0,w.Ht)(this.hass,this.scriptId),(0,c.O)("/config")}async _switchUiMode(){if(this._yamlErrors){if(!await(0,A.dk)(this,{text:o.qy`${this.hass.localize("ui.panel.config.automation.editor.switch_ui_yaml_error")}<br><br>${this._yamlErrors}`,confirmText:this.hass.localize("ui.common.continue"),destructive:!0,dismissText:this.hass.localize("ui.common.cancel")}))return}this._yamlErrors=void 0,this._mode="gui"}_switchYamlMode(){this._mode="yaml"}async _promptScriptAlias(){return new Promise(t=>{(0,L._)(this,{config:this._config,domain:"script",updateConfig:async(i,e)=>{this._config=i,this._entityRegistryUpdate=e,this._dirty=!0,this.requestUpdate(),t(!0)},onClose:()=>t(!1),entityRegistryUpdate:this._entityRegistryUpdate,entityRegistryEntry:this.entityRegistry.find(t=>t.unique_id===this.scriptId)})})}async _promptScriptMode(){return new Promise(t=>{(0,q.e)(this,{config:this._config,updateConfig:i=>{this._config=i,this._dirty=!0,this.requestUpdate(),t()},onClose:()=>t()})})}async _handleSaveScript(){if(this._yamlErrors)return void(0,z.P)(this,{message:this._yamlErrors});if(this._manualEditor?.resetPastedConfig(),!this.scriptId){if(!await this._promptScriptAlias())return;this._entityId=this._computeEntityIdFromAlias(this._config.alias)}const t=this.scriptId||this._entityId||Date.now();await this._saveScript(t),this.scriptId||(0,c.o)(`/config/script/edit/${t}`,{replace:!0})}async _saveScript(t){let i;this._saving=!0,void 0===this._entityRegistryUpdate||this.scriptId||(this._newScriptId=t.toString(),i=new Promise(t=>{this._entityRegCreated=t}));try{if(await this.hass.callApi("POST","config/script/config/"+t,this._config),void 0!==this._entityRegistryUpdate){let t=this._entityId;if(i)try{t=(await(0,g.h)(5e3,i)).entity_id}catch(e){if(t=void 0,!(e instanceof Error&&"TimeoutError"===e.name))throw e;await(0,R.j)(this,{savedPromise:i,type:"script"});try{t=(await(0,g.h)(0,i)).entity_id}catch(t){if(!(t instanceof Error&&"TimeoutError"===t.name))throw t}}t&&await(0,$.G_)(this.hass,t,{categories:{script:this._entityRegistryUpdate.category||null},labels:this._entityRegistryUpdate.labels||[],area_id:this._entityRegistryUpdate.area||null})}this._dirty=!1}catch(t){throw this._errors=t.body?.message||t.error||t.body,(0,z.P)(this,{message:t.body?.message||t.error||t.body}),t}finally{this._saving=!1}}supportedShortcuts(){return{s:()=>this._handleSaveScript(),c:()=>this._copySelectedRow(),x:()=>this._cutSelectedRow(),Delete:()=>this._deleteSelectedRow(),Backspace:()=>this._deleteSelectedRow(),z:()=>this._undo(),Z:()=>this._redo(),y:()=>this._redo()}}get isDirty(){return this._dirty}async promptDiscardChanges(){return this._confirmUnsavedChanged()}_collapseAll(){this._manualEditor?.collapseAll()}_expandAll(){this._manualEditor?.expandAll()}_copySelectedRow(){this._manualEditor?.copySelectedRow()}_cutSelectedRow(){this._manualEditor?.cutSelectedRow()}_deleteSelectedRow(){this._manualEditor?.deleteSelectedRow()}_applyUndoRedo(t){this._manualEditor?.triggerCloseSidebar(),this._config=t,this._dirty=!0}_undo(){this._undoRedoController.undo()}_redo(){this._undoRedoController.redo()}_handleDropdownSelect(t){const i=t.detail?.item?.value;if(i)switch(i){case"undo":this._undo();break;case"redo":this._redo();break;case"info":this._showInfo();break;case"settings":this._showSettings();break;case"category":this._editCategory();break;case"run":this._runScript();break;case"add_fields":this._addFields();break;case"rename":this._promptScriptAlias();break;case"change_mode":this._promptScriptMode();break;case"duplicate":this._duplicate();break;case"take_control":this._takeControl();break;case"toggle_yaml_mode":if("gui"===this._mode){this._switchYamlMode();break}this._switchUiMode();break;case"delete":this._deleteConfirm();break;case"trace":this._showTrace()}}static get styles(){return[V.RF,o.AH`:host{--ha-automation-editor-max-width:var(
            --ha-automation-editor-width,
            1540px
          );--hass-subpage-bottom-inset:0px}.yaml-mode{height:100%;display:flex;flex-direction:column;padding-bottom:0}blueprint-script-editor,manual-script-editor{margin:0 auto;max-width:1040px;padding:28px 20px 0;display:block}:not(.yaml-mode)>.error-wrapper{position:absolute;top:4px;z-index:3;width:100%;display:flex;flex-direction:column;align-items:center}:not(.yaml-mode)>.error-wrapper ha-alert{background-color:var(--card-background-color);box-shadow:0 2px 4px rgba(0,0,0,.2);border-radius:var(--ha-border-radius-sm)}.alert-wrapper{position:sticky;top:-24px;margin-top:-24px;margin-bottom:8px;z-index:1;width:100%;display:flex;flex-direction:column;align-items:center;gap:var(--ha-space-2);pointer-events:none}.alert-wrapper ha-alert{background-color:var(--card-background-color);box-shadow:0 2px 4px rgba(0,0,0,.2);border-radius:var(--ha-border-radius-sm);margin-bottom:0;pointer-events:auto}manual-script-editor{max-width:var(--ha-automation-editor-max-width);padding:0 12px}ha-yaml-editor{flex-grow:1;--actions-border-radius:var(--ha-border-radius-square);--code-mirror-height:100%;min-height:0;display:flex;flex-direction:column}p{margin-bottom:0}span[slot=introduction] a{color:var(--primary-color)}ha-fab{position:fixed;right:16px;bottom:calc(-80px - var(--safe-area-inset-bottom));transition:bottom .3s}ha-fab.dirty{bottom:calc(16px + var(--safe-area-inset-bottom,0px))}.header{display:flex;margin:16px 0;align-items:center}.header .name{font-size:var(--ha-font-size-xl);font-weight:var(--ha-font-weight-normal);flex:1}.header a{color:var(--secondary-text-color)}ha-tooltip ha-svg-icon{width:12px}ha-tooltip .shortcut{display:inline-flex;flex-direction:row;align-items:center;gap:2px}`]}constructor(...t){super(...t),this.scriptId=null,this.entityId=null,this.isWide=!1,this.narrow=!1,this._dirty=!1,this._mode="gui",this._readOnly=!1,this._saving=!1,this._undoRedoController=new l.X(this,{apply:t=>this._applyUndoRedo(t),currentConfig:()=>this._config}),this._backTapped=async()=>{await this._confirmUnsavedChanged()&&(0,u.m)(()=>(0,c.O)("/config"))}}}(0,s.Cg)([(0,r.MZ)({attribute:!1})],st.prototype,"hass",void 0),(0,s.Cg)([(0,r.MZ)({attribute:!1})],st.prototype,"scriptId",void 0),(0,s.Cg)([(0,r.MZ)({attribute:!1})],st.prototype,"entityId",void 0),(0,s.Cg)([(0,r.MZ)({attribute:!1})],st.prototype,"entityRegistry",void 0),(0,s.Cg)([(0,r.MZ)({attribute:"is-wide",type:Boolean})],st.prototype,"isWide",void 0),(0,s.Cg)([(0,r.MZ)({type:Boolean})],st.prototype,"narrow",void 0),(0,s.Cg)([(0,r.MZ)({attribute:!1})],st.prototype,"route",void 0),(0,s.Cg)([(0,r.wk)()],st.prototype,"_config",void 0),(0,s.Cg)([(0,r.wk)()],st.prototype,"_dirty",void 0),(0,s.Cg)([(0,r.wk)()],st.prototype,"_errors",void 0),(0,s.Cg)([(0,r.wk)()],st.prototype,"_yamlErrors",void 0),(0,s.Cg)([(0,r.wk)()],st.prototype,"_entityId",void 0),(0,s.Cg)([(0,r.wk)()],st.prototype,"_mode",void 0),(0,s.Cg)([(0,r.wk)()],st.prototype,"_readOnly",void 0),(0,s.Cg)([(0,r.wk)(),(0,a.Fg)({context:v.ih,subscribe:!0}),(0,h.p)({transformer:function(t){return t.find(({entity_id:t})=>t===this._entityId)},watch:["_entityId"]})],st.prototype,"_registryEntry",void 0),(0,s.Cg)([(0,r.P)("manual-script-editor")],st.prototype,"_manualEditor",void 0),(0,s.Cg)([(0,r.wk)()],st.prototype,"_validationErrors",void 0),(0,s.Cg)([(0,r.wk)()],st.prototype,"_blueprintConfig",void 0),(0,s.Cg)([(0,r.wk)()],st.prototype,"_saving",void 0),st=(0,s.Cg)([(0,r.EM)("ha-script-editor")],st),i()}catch(t){i(t)}})},17625(t,i,e){e.a(t,async function(t,i){try{var s=e(62826),a=e(96196),o=e(44457),r=e(94333),n=e(1087),l=e(99124),h=e(57237),d=(e(14844),e(76776),e(29823)),c=(e(70947),e(84383)),p=e(14503),g=e(41570),u=e(81619),_=e(57116),y=e(50940),f=t([d,y]);[d,y]=f.then?(await f)():f;const m="M6,2A4,4 0 0,1 10,6V8H14V6A4,4 0 0,1 18,2A4,4 0 0,1 22,6A4,4 0 0,1 18,10H16V14H18A4,4 0 0,1 22,18A4,4 0 0,1 18,22A4,4 0 0,1 14,18V16H10V18A4,4 0 0,1 6,22A4,4 0 0,1 2,18A4,4 0 0,1 6,14H8V10H6A4,4 0 0,1 2,6A4,4 0 0,1 6,2M16,18A2,2 0 0,0 18,20A2,2 0 0,0 20,18A2,2 0 0,0 18,16H16V18M14,10H10V14H14V10M6,16A2,2 0 0,0 4,18A2,2 0 0,0 6,20A2,2 0 0,0 8,18V16H6M8,6A2,2 0 0,0 6,4A2,2 0 0,0 4,6A2,2 0 0,0 6,8H8V6M18,8A2,2 0 0,0 20,6A2,2 0 0,0 18,4A2,2 0 0,0 16,6V8H18Z",b="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z",v="M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z",C="M3 6V8H14V6H3M3 10V12H14V10H3M20 10.1C19.9 10.1 19.7 10.2 19.6 10.3L18.6 11.3L20.7 13.4L21.7 12.4C21.9 12.2 21.9 11.8 21.7 11.6L20.4 10.3C20.3 10.2 20.2 10.1 20 10.1M18.1 11.9L12 17.9V20H14.1L20.2 13.9L18.1 11.9M3 14V16H10V14H3Z";class $ extends a.WF{render(){const t=this.field.selector&&"object"==typeof this.field.selector;return a.qy` <ha-card outlined> <ha-automation-row .disabled="${this.disabled}" @click="${this._toggleSidebar}" .selected="${this._selected}" .leftChevron="${t}" @toggle-collapsed="${this._toggleCollapse}" .collapsed="${this._collapsed}" .highlight="${this.highlight}" @delete-row="${this._onDelete}"> <ha-dropdown slot="icons" @click="${l.C}" @keydown="${h.d}" @wa-select="${this._handleDropdownSelect}" placement="bottom-end"> <ha-icon-button slot="trigger" .label="${this.hass.localize("ui.common.menu")}" .path="${v}"></ha-icon-button> <ha-dropdown-item value="toggle_yaml_mode"> <ha-svg-icon slot="icon" .path="${C}"></ha-svg-icon> <div class="overflow-label"> ${this.hass.localize("ui.panel.config.automation.editor.edit_"+(this._yamlMode?"ui":"yaml"))} <span class="shortcut-placeholder ${g.c?"mac":""}"></span> </div> </ha-dropdown-item> <ha-dropdown-item value="delete" .disabled="${this.disabled}" variant="danger"> <ha-svg-icon slot="icon" .path="${b}"></ha-svg-icon> <div class="overflow-label"> ${this.hass.localize("ui.panel.config.automation.editor.actions.delete")} ${this.narrow?a.s6:a.qy`<span class="shortcut"> <span>${g.c?a.qy`<ha-svg-icon .path="${m}"></ha-svg-icon>`:this.hass.localize("ui.panel.config.automation.editor.ctrl")}</span> <span>+</span> <span>${this.hass.localize("ui.panel.config.automation.editor.del")}</span> </span>`} </div> </ha-dropdown-item> </ha-dropdown> <h3 slot="header">${this.key}</h3> <slot name="icons" slot="icons"></slot> </ha-automation-row> </ha-card> ${t?a.qy` <div class="${(0,r.H)({"selector-row":!0,"parent-selected":this._selected,hidden:this._collapsed})}"> <ha-card> <ha-automation-row .selected="${this._selectorRowSelected}" @click="${this._toggleSelectorSidebar}" .collapsed="${this._selectorRowCollapsed}" @toggle-collapsed="${this._toggleSelectorRowCollapse}" .leftChevron="${c.W.includes(Object.keys(this.field.selector)[0])}" .highlight="${this.highlight}"> <h3 slot="header"> ${this.hass.localize(`ui.components.selectors.selector.types.${Object.keys(this.field.selector)[0]}`)} ${this.hass.localize("ui.panel.config.script.editor.field.selector")} </h3> <ha-dropdown slot="icons" @click="${l.C}" @keydown="${h.d}" @wa-select="${this._handleDropdownSelect}" placement="bottom-end"> <ha-icon-button slot="trigger" .label="${this.hass.localize("ui.common.menu")}" .path="${v}"></ha-icon-button> <ha-dropdown-item value="toggle_yaml_mode" selector-row> <ha-svg-icon slot="icon" .path="${C}"></ha-svg-icon> <div class="overflow-label"> ${this.hass.localize("ui.panel.config.automation.editor.edit_"+(this._yamlMode?"ui":"yaml"))} <span class="shortcut-placeholder ${g.c?"mac":""}"></span> </div> </ha-dropdown-item> <ha-dropdown-item value="delete" .disabled="${this.disabled}" variant="danger"> <ha-svg-icon slot="icon" .path="${b}"></ha-svg-icon> <div class="overflow-label"> ${this.hass.localize("ui.panel.config.automation.editor.actions.delete")} ${this.narrow?a.s6:a.qy`<span class="shortcut"> <span>${g.c?a.qy`<ha-svg-icon .path="${m}"></ha-svg-icon>`:this.hass.localize("ui.panel.config.automation.editor.ctrl")}</span> <span>+</span> <span>${this.hass.localize("ui.panel.config.automation.editor.del")}</span> </span>`} </div> </ha-dropdown-item> </ha-dropdown> </ha-automation-row> </ha-card> ${"object"==typeof this.field.selector&&c.W.includes(Object.keys(this.field.selector)[0])?a.qy` <ha-script-field-selector-editor class="${this._selectorRowCollapsed?"hidden":""}" .selected="${this._selectorRowSelected}" .hass="${this.hass}" .field="${this.field}" .disabled="${this.disabled}" indent @value-changed="${this._selectorValueChanged}" .narrow="${this.narrow}"></ha-script-field-selector-editor> `:a.s6} </div> `:a.s6} `}_toggleCollapse(){this._collapsed=!this._collapsed}expand(){this._collapsed=!1}collapse(){this._collapsed=!0}expandSelectorRow(){this._selectorRowCollapsed=!1}collapseSelectorRow(){this._selectorRowCollapsed=!0}_toggleSelectorRowCollapse(){this._selectorRowCollapsed=!this._selectorRowCollapsed}expandAll(){this.expand(),this.expandSelectorRow(),this._selectorEditor?.expandAll()}collapseAll(){this.collapse(),this.collapseSelectorRow(),this._selectorEditor?.collapseAll()}_toggleSidebar(t){t?.stopPropagation(),this._selected?(0,n.r)(this,"request-close-sidebar"):(this._selected=!0,this._collapsed=!1,this.openSidebar())}_toggleSelectorSidebar(t){t?.stopPropagation(),this._selectorRowSelected?(0,n.r)(this,"request-close-sidebar"):(this._selectorRowSelected=!0,this._selectorRowCollapsed=!1,this.openSidebar(!0))}_selectorValueChanged(t){t.stopPropagation(),(0,n.r)(this,"value-changed",{value:{...this.field,key:this.key,...t.detail.value}})}openSidebar(t=!1){t||(this._selected=!0),(0,n.r)(this,"open-sidebar",{save:t=>{(0,n.r)(this,"value-changed",{value:t})},close:i=>{t?(this._selectorRowSelected=!1,i&&this.focusSelector()):(this._selected=!1,i&&this.focus()),(0,n.r)(this,"close-sidebar")},toggleYamlMode:()=>{this._toggleYamlMode(),this.openSidebar()},delete:this._onDelete,config:{field:this.field,selector:t,key:this.key,excludeKeys:this.excludeKeys},yamlMode:this._yamlMode}),this.narrow&&window.setTimeout(()=>{this.scrollIntoView({block:"start",behavior:"smooth"})},180)}focus(){this._fieldRowElement?.focus()}focusSelector(){this._selectorRowElement?.focus()}_handleDropdownSelect(t){const i=t.detail?.item?.value;if(i)switch(i){case"toggle_yaml_mode":this._toggleYamlMode(t.target);break;case"delete":this._onDelete()}}static get styles(){return[p.RF,_.aM,_.Lt,a.AH`.disabled{opacity:.5;pointer-events:none}.hidden{display:none}h3{margin:0;font-size:inherit;font-weight:inherit}.action-icon{display:none}@media (min-width:870px){.action-icon{display:inline-block;color:var(--secondary-text-color);opacity:.9;margin-right:8px;margin-inline-end:8px;margin-inline-start:initial}}.card-content{padding:16px}.disabled-bar{background:var(--divider-color,#e0e0e0);text-align:center;border-top-right-radius:calc(var(--ha-card-border-radius,var(--ha-border-radius-lg)) - var(--ha-card-border-width,1px));border-top-left-radius:calc(var(--ha-card-border-radius,var(--ha-border-radius-lg)) - var(--ha-card-border-width,1px))}.warning ul{margin:4px 0}.selected_menu_item{color:var(--primary-color)}.selector-row{padding-top:12px;padding-bottom:16px;padding-inline-start:16px;padding-inline-end:0px}`]}constructor(...t){super(...t),this.excludeKeys=[],this.disabled=!1,this.narrow=!1,this._yamlMode=!1,this._selected=!1,this._collapsed=!1,this._selectorRowSelected=!1,this._selectorRowCollapsed=!1,this._toggleYamlMode=t=>{this._yamlMode=!this._yamlMode,t&&this.openSidebar(t.hasAttribute("selector-row"))},this._onDelete=()=>{(0,n.r)(this,"value-changed",{value:null}),(this._selected||this._selectorRowSelected)&&(0,n.r)(this,"close-sidebar"),(0,u.P)(this,{message:this.hass.localize("ui.common.successfully_deleted"),duration:4e3,action:{text:this.hass.localize("ui.common.undo"),action:()=>{(0,n.r)(window,"undo-change")}}})}}}(0,s.Cg)([(0,o.MZ)({attribute:!1})],$.prototype,"hass",void 0),(0,s.Cg)([(0,o.MZ)()],$.prototype,"key",void 0),(0,s.Cg)([(0,o.MZ)({attribute:!1,type:Array})],$.prototype,"excludeKeys",void 0),(0,s.Cg)([(0,o.MZ)({attribute:!1})],$.prototype,"field",void 0),(0,s.Cg)([(0,o.MZ)({type:Boolean})],$.prototype,"disabled",void 0),(0,s.Cg)([(0,o.MZ)({type:Boolean})],$.prototype,"narrow",void 0),(0,s.Cg)([(0,o.MZ)({type:Boolean})],$.prototype,"highlight",void 0),(0,s.Cg)([(0,o.wk)()],$.prototype,"_yamlMode",void 0),(0,s.Cg)([(0,o.wk)()],$.prototype,"_selected",void 0),(0,s.Cg)([(0,o.wk)()],$.prototype,"_collapsed",void 0),(0,s.Cg)([(0,o.wk)()],$.prototype,"_selectorRowSelected",void 0),(0,s.Cg)([(0,o.wk)()],$.prototype,"_selectorRowCollapsed",void 0),(0,s.Cg)([(0,o.P)("ha-script-field-selector-editor")],$.prototype,"_selectorEditor",void 0),(0,s.Cg)([(0,o.P)("ha-automation-row:first-of-type")],$.prototype,"_fieldRowElement",void 0),(0,s.Cg)([(0,o.P)(".selector-row ha-automation-row")],$.prototype,"_selectorRowElement",void 0),$=(0,s.Cg)([(0,o.EM)("ha-script-field-row")],$),i()}catch(t){i(t)}})},95415(t,i,e){e.a(t,async function(t,i){try{e(18111),e(22489),e(7588),e(61701);var s=e(62826),a=e(96196),o=e(44457),r=e(1087),n=e(18350),l=(e(13416),e(67094),e(17625)),h=t([n,l]);[n,l]=h.then?(await h)():h;const d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z";class c extends a.WF{render(){return a.qy` ${this.fields?a.qy`<div class="fields"> ${Object.entries(this.fields).map(([t,i])=>a.qy` <ha-script-field-row .key="${t}" .excludeKeys="${Object.keys(this.fields).filter(i=>i!==t)}" .field="${i}" .disabled="${this.disabled}" @value-changed="${this._fieldChanged}" .hass="${this.hass}" .highlight="${void 0!==this.highlightedFields?.[t]}" .narrow="${this.narrow}"> </ha-script-field-row> `)} </div> `:a.s6} <ha-button @click="${this._addField}" .disabled="${this.disabled}"> <ha-svg-icon .path="${d}" slot="start"></ha-svg-icon> ${this.hass.localize("ui.panel.config.script.editor.field.add_field")} </ha-button> `}updated(t){super.updated(t),t.has("fields")&&this._focusLastActionOnChange&&(this._focusLastActionOnChange=!1,this.focusLastField())}focusLastField(){const t=this.shadowRoot.querySelector("ha-script-field-row:last-of-type");t.updateComplete.then(()=>{t.openSidebar(),t.focus(),this.narrow&&window.setTimeout(()=>{t.scrollIntoView({block:"start",behavior:"smooth"})},180)})}_addField(){const t=this._getUniqueKey(this.hass.localize("ui.panel.config.script.editor.field.field")||"field",this.fields||{}),i={...this.fields||{},[t]:{selector:{text:null}}};this._focusLastActionOnChange=!0,(0,r.r)(this,"value-changed",{value:i})}_fieldChanged(t){t.stopPropagation();const i=t.target.key;let e={};if(null===t.detail.value)e={...this.fields},delete e[i];else{const s={...t.detail.value},a=s.key;delete s.key;i!==a?Object.entries(this.fields).forEach(([t,o])=>{t===i?e[a]=s:e[t]=o}):(e={...this.fields},e[i]=s)}(0,r.r)(this,"value-changed",{value:e})}_getUniqueKey(t,i){let e=t;if(t in i){let s=2;do{e=`${t}_${s}`,s++}while(e in i)}return e}expandAll(){this._fieldRowElements?.forEach(t=>{t.expandAll()})}collapseAll(){this._fieldRowElements?.forEach(t=>{t.collapseAll()})}constructor(...t){super(...t),this.disabled=!1,this.narrow=!1,this._focusLastActionOnChange=!1}}c.styles=a.AH`ha-script-field-row{display:block;margin-bottom:16px;scroll-margin-top:48px}ha-svg-icon{height:20px}`,(0,s.Cg)([(0,o.MZ)({attribute:!1})],c.prototype,"hass",void 0),(0,s.Cg)([(0,o.MZ)({type:Boolean})],c.prototype,"disabled",void 0),(0,s.Cg)([(0,o.MZ)({attribute:!1})],c.prototype,"fields",void 0),(0,s.Cg)([(0,o.MZ)({attribute:!1})],c.prototype,"highlightedFields",void 0),(0,s.Cg)([(0,o.MZ)({type:Boolean})],c.prototype,"narrow",void 0),(0,s.Cg)([(0,o.YG)("ha-script-field-row")],c.prototype,"_fieldRowElements",void 0),c=(0,s.Cg)([(0,o.EM)("ha-script-fields")],c),i()}catch(t){i(t)}})},42180(t,i,e){e.a(t,async function(t,i){try{e(44114),e(18111),e(81148),e(22489),e(20116),e(7588),e(61701),e(13579),e(17642),e(58004),e(33853),e(45876),e(32475),e(15024),e(31698),e(14603),e(47566),e(98721);var s=e(62826),a=e(88696),o=e(16527),r=e(6946),n=e(96196),l=e(44457),h=e(6415),d=e(22786),c=e(78870),p=e(36312),g=e(95747),u=e(98975),_=e(93905),y=e(1087),f=e(28978),m=e(91926),b=e(80880),v=e(87710),C=e(86171),$=(e(27661),e(645),e(41113),e(52190),e(66702)),w=(e(72644),e(138)),A=(e(26300),e(75248)),k=(e(58491),e(69175),e(16443),e(82988),e(67094),e(34127)),x=e(21489),H=e(76570),M=e(38911),V=e(77001),S=e(22675),z=e(59241),q=e(92557),L=e(84025),R=e(71606),I=e(65063),E=e(42269),Z=(e(72553),e(54706)),P=e(14503),O=e(81619),F=e(34023),W=e(14839),U=e(55270),B=e(90986),T=e(25635),D=e(69569),j=e(24367),K=t([C,$,w,A,k,g,u]);[C,$,w,A,k,g,u]=K.then?(await K)():K;const Y="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z",N="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z",G="M11,17H4A2,2 0 0,1 2,15V3A2,2 0 0,1 4,1H16V3H4V15H11V13L15,16L11,19V17M19,21V7H8V13H6V7A2,2 0 0,1 8,5H19A2,2 0 0,1 21,7V21A2,2 0 0,1 19,23H8A2,2 0 0,1 6,21V19H8V21H19Z",Q="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z",X="M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z",J="M15.07,11.25L14.17,12.17C13.45,12.89 13,13.5 13,15H11V14.5C11,13.39 11.45,12.39 12.17,11.67L13.41,10.41C13.78,10.05 14,9.55 14,9C14,7.89 13.1,7 12,7A2,2 0 0,0 10,9H8A4,4 0 0,1 12,5A4,4 0 0,1 16,9C16,9.88 15.64,10.67 15.07,11.25M13,19H11V17H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12C22,6.47 17.5,2 12,2Z",tt="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z",it="M7,10L12,15L17,10H7Z",et="M8,5.14V19.14L19,12.14L8,5.14Z",st="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z",at="M17.8,20C17.4,21.2 16.3,22 15,22H5C3.3,22 2,20.7 2,19V18H5L14.2,18C14.6,19.2 15.7,20 17,20H17.8M19,2C20.7,2 22,3.3 22,5V6H20V5C20,4.4 19.6,4 19,4C18.4,4 18,4.4 18,5V18H17C16.4,18 16,17.6 16,17V16H5V5C5,3.3 6.3,2 8,2H19M8,6V8H15V6H8M8,10V12H14V10H8Z",ot="M5.5,7A1.5,1.5 0 0,1 4,5.5A1.5,1.5 0 0,1 5.5,4A1.5,1.5 0 0,1 7,5.5A1.5,1.5 0 0,1 5.5,7M21.41,11.58L12.41,2.58C12.05,2.22 11.55,2 11,2H4C2.89,2 2,2.89 2,4V11C2,11.55 2.22,12.05 2.59,12.41L11.58,21.41C11.95,21.77 12.45,22 13,22C13.55,22 14.05,21.77 14.41,21.41L21.41,14.41C21.78,14.05 22,13.55 22,13C22,12.44 21.77,11.94 21.41,11.58Z",rt="M20 2H4C2.9 2 2 2.9 2 4V20C2 21.11 2.9 22 4 22H20C21.11 22 22 21.11 22 20V4C22 2.9 21.11 2 20 2M4 6L6 4H10.9L4 10.9V6M4 13.7L13.7 4H18.6L4 18.6V13.7M20 18L18 20H13.1L20 13.1V18M20 10.3L10.3 20H5.4L20 5.4V10.3Z",nt="M15,12C15,10.7 14.16,9.6 13,9.18V6.82C14.16,6.4 15,5.3 15,4A3,3 0 0,0 12,1A3,3 0 0,0 9,4C9,5.3 9.84,6.4 11,6.82V9.19C9.84,9.6 9,10.7 9,12C9,13.3 9.84,14.4 11,14.82V17.18C9.84,17.6 9,18.7 9,20A3,3 0 0,0 12,23A3,3 0 0,0 15,20C15,18.7 14.16,17.6 13,17.18V14.82C14.16,14.4 15,13.3 15,12M12,3A1,1 0 0,1 13,4A1,1 0 0,1 12,5A1,1 0 0,1 11,4A1,1 0 0,1 12,3M12,21A1,1 0 0,1 11,20A1,1 0 0,1 12,19A1,1 0 0,1 13,20A1,1 0 0,1 12,21Z";class lt extends((0,Z.E)(n.WF)){hassSubscribe(){return[(0,H.Ar)(this.hass.connection,"script",t=>{this._categories=t}),(0,q.o5)(this.hass.connection,t=>{this._labels=t})]}render(){const t=n.qy`${this._categories?.map(t=>n.qy`<ha-md-menu-item .value="${t.category_id}" .clickAction="${this._handleBulkCategory}"> ${t.icon?n.qy`<ha-icon slot="start" .icon="${t.icon}"></ha-icon>`:n.qy`<ha-svg-icon slot="start" .path="${ot}"></ha-svg-icon>`} <div slot="headline">${t.name}</div> </ha-md-menu-item>`)} <ha-md-menu-item .value="${null}" .clickAction="${this._handleBulkCategory}"> <div slot="headline"> ${this.hass.localize("ui.panel.config.automation.picker.bulk_actions.no_category")} </div> </ha-md-menu-item><ha-md-divider role="separator" tabindex="-1"></ha-md-divider> <ha-md-menu-item .clickAction="${this._bulkCreateCategory}"> <div slot="headline"> ${this.hass.localize("ui.panel.config.category.editor.add")} </div> </ha-md-menu-item>`,i=n.qy`${this._labels?.map(t=>{const i=t.color?(0,c.M)(t.color):void 0,e=this._selected.every(i=>this.hass.entities[i]?.labels.includes(t.label_id)),s=!e&&this._selected.some(i=>this.hass.entities[i]?.labels.includes(t.label_id));return n.qy`<ha-md-menu-item .value="${t.label_id}" .action="${e?"remove":"add"}" @click="${this._handleBulkLabel}" keep-open reducedTouchTarget> <ha-checkbox slot="start" .checked="${e}" .indeterminate="${s}"></ha-checkbox> <ha-label style="${i?`--color: ${i}`:""}" .description="${t.description}"> ${t.icon?n.qy`<ha-icon slot="icon" .icon="${t.icon}"></ha-icon>`:n.s6} ${t.name} </ha-label> </ha-md-menu-item>`})} <ha-md-divider role="separator" tabindex="-1"></ha-md-divider> <ha-md-menu-item .clickAction="${this._bulkCreateLabel}"> <div slot="headline"> ${this.hass.localize("ui.panel.config.labels.add_label")} </div></ha-md-menu-item>`,e=n.qy`${Object.values(this.hass.areas).map(t=>n.qy`<ha-md-menu-item .value="${t.area_id}" .clickAction="${this._handleBulkArea}"> ${t.icon?n.qy`<ha-icon slot="start" .icon="${t.icon}"></ha-icon>`:n.qy`<ha-svg-icon slot="start" .path="${rt}"></ha-svg-icon>`} <div slot="headline">${t.name}</div> </ha-md-menu-item>`)} <ha-md-menu-item .value="${null}" .clickAction="${this._handleBulkArea}"> <div slot="headline"> ${this.hass.localize("ui.panel.config.devices.picker.bulk_actions.no_area")} </div> </ha-md-menu-item> <ha-md-divider role="separator" tabindex="-1"></ha-md-divider> <ha-md-menu-item .clickAction="${this._bulkCreateArea}"> <div slot="headline"> ${this.hass.localize("ui.panel.config.devices.picker.bulk_actions.add_area")} </div> </ha-md-menu-item>`,s=this._sizeController.value&&this._sizeController.value<900||!this._sizeController.value&&"docked"===this.hass.dockedSidebar,a=s&&(!this._sizeController.value||this._sizeController.value<700),o=this._scripts(this.scripts,this._entityReg,this.hass.areas,this._categories,this._labels,this._filteredScripts);let r=T.configSections.automations,l="/config";return(0,j.fe)(this.hass)||(r=r.filter(t=>t.component?.includes("script")),l="/"),n.qy` <hass-tabs-subpage-data-table .hass="${this.hass}" .narrow="${this.narrow}" back-path="${l}" .route="${this.route}" .tabs="${r}" .searchLabel="${this.hass.localize("ui.panel.config.script.picker.search",{number:o.length})}" has-filters .initialGroupColumn="${this._activeGrouping??"category"}" .initialCollapsedGroups="${this._activeCollapsed}" .initialSorting="${this._activeSorting}" .columnOrder="${this._activeColumnOrder}" .hiddenColumns="${this._activeHiddenColumns}" @columns-changed="${this._handleColumnsChanged}" @sorting-changed="${this._handleSortingChanged}" @grouping-changed="${this._handleGroupingChanged}" @collapsed-changed="${this._handleCollapseChanged}" selectable .selected="${this._selected.length}" @selection-changed="${this._handleSelectionChanged}" .filters="${Object.values(this._filters).filter(t=>Array.isArray(t.value)?t.value.length:t.value&&Object.values(t.value).some(t=>Array.isArray(t)?t.length:t)).length}" .columns="${this._columns(this.hass.localize)}" .data="${o}" .empty="${!this.scripts.length}" .activeFilters="${this._activeFilters}" id="entity_id" .noDataText="${this.hass.localize("ui.panel.config.script.picker.no_scripts")}" @clear-filter="${this._clearFilter}" .filter="${this._filter}" @search-changed="${this._handleSearchChange}" has-fab clickable class="${this.narrow?"narrow":""}" @row-click="${this._handleRowClicked}"> <ha-icon-button slot="toolbar-icon" .label="${this.hass.localize("ui.common.help")}" .path="${J}" @click="${this._showHelp}"></ha-icon-button> <ha-filter-floor-areas .hass="${this.hass}" .type="${"script"}" .value="${this._filters["ha-filter-floor-areas"]?.value}" @data-table-filter-changed="${this._filterChanged}" slot="filter-pane" .expanded="${"ha-filter-floor-areas"===this._expandedFilter}" .narrow="${this.narrow}" @expanded-changed="${this._filterExpanded}"></ha-filter-floor-areas> <ha-filter-devices .hass="${this.hass}" .type="${"script"}" .value="${this._filters["ha-filter-devices"]?.value}" @data-table-filter-changed="${this._filterChanged}" slot="filter-pane" .expanded="${"ha-filter-devices"===this._expandedFilter}" .narrow="${this.narrow}" @expanded-changed="${this._filterExpanded}"></ha-filter-devices> <ha-filter-entities .hass="${this.hass}" .type="${"script"}" .value="${this._filters["ha-filter-entities"]?.value}" @data-table-filter-changed="${this._filterChanged}" slot="filter-pane" .expanded="${"ha-filter-entities"===this._expandedFilter}" .narrow="${this.narrow}" @expanded-changed="${this._filterExpanded}"></ha-filter-entities> <ha-filter-labels .hass="${this.hass}" .value="${this._filters["ha-filter-labels"]?.value}" @data-table-filter-changed="${this._filterChanged}" slot="filter-pane" .expanded="${"ha-filter-labels"===this._expandedFilter}" .narrow="${this.narrow}" @expanded-changed="${this._filterExpanded}"></ha-filter-labels> <ha-filter-categories .hass="${this.hass}" scope="script" .value="${this._filters["ha-filter-categories"]?.value}" @data-table-filter-changed="${this._filterChanged}" slot="filter-pane" .expanded="${"ha-filter-categories"===this._expandedFilter}" .narrow="${this.narrow}" @expanded-changed="${this._filterExpanded}"></ha-filter-categories> <ha-filter-blueprints .hass="${this.hass}" .type="${"script"}" .value="${this._filters["ha-filter-blueprints"]?.value}" @data-table-filter-changed="${this._filterChanged}" slot="filter-pane" .expanded="${"ha-filter-blueprints"===this._expandedFilter}" .narrow="${this.narrow}" @expanded-changed="${this._filterExpanded}"></ha-filter-blueprints> ${this.narrow?n.s6:n.qy`<ha-md-button-menu slot="selection-bar"> <ha-assist-chip slot="trigger" .label="${this.hass.localize("ui.panel.config.automation.picker.bulk_actions.move_category")}"> <ha-svg-icon slot="trailing-icon" .path="${it}"></ha-svg-icon> </ha-assist-chip> ${t} </ha-md-button-menu> ${a?n.s6:n.qy`<ha-md-button-menu slot="selection-bar"> <ha-assist-chip slot="trigger" .label="${this.hass.localize("ui.panel.config.automation.picker.bulk_actions.add_label")}"> <ha-svg-icon slot="trailing-icon" .path="${it}"></ha-svg-icon> </ha-assist-chip> ${i} </ha-md-button-menu>`} ${s?n.s6:n.qy`<ha-md-button-menu slot="selection-bar"> <ha-assist-chip slot="trigger" .label="${this.hass.localize("ui.panel.config.devices.picker.bulk_actions.move_area")}"> <ha-svg-icon slot="trailing-icon" .path="${it}"></ha-svg-icon> </ha-assist-chip> ${e} </ha-md-button-menu>`}`} ${this.narrow||s?n.qy` <ha-md-button-menu has-overflow slot="selection-bar"> ${this.narrow?n.qy`<ha-assist-chip .label="${this.hass.localize("ui.panel.config.automation.picker.bulk_action")}" slot="trigger"> <ha-svg-icon slot="trailing-icon" .path="${it}"></ha-svg-icon> </ha-assist-chip>`:n.qy`<ha-icon-button .path="${X}" .label="${this.hass.localize("ui.panel.config.automation.picker.bulk_action")}" slot="trigger"></ha-icon-button>`} <ha-svg-icon slot="trailing-icon" .path="${it}"></ha-svg-icon> ${this.narrow?n.qy`<ha-sub-menu> <ha-md-menu-item slot="item"> <div slot="headline"> ${this.hass.localize("ui.panel.config.automation.picker.bulk_actions.move_category")} </div> <ha-svg-icon slot="end" .path="${Y}"></ha-svg-icon> </ha-md-menu-item> <ha-md-menu slot="menu">${t}</ha-md-menu> </ha-sub-menu>`:n.s6} ${this.narrow||a?n.qy`<ha-sub-menu> <ha-md-menu-item slot="item"> <div slot="headline"> ${this.hass.localize("ui.panel.config.automation.picker.bulk_actions.add_label")} </div> <ha-svg-icon slot="end" .path="${Y}"></ha-svg-icon> </ha-md-menu-item> <ha-md-menu slot="menu">${i}</ha-md-menu> </ha-sub-menu>`:n.s6} ${this.narrow||s?n.qy`<ha-sub-menu> <ha-md-menu-item slot="item"> <div slot="headline"> ${this.hass.localize("ui.panel.config.devices.picker.bulk_actions.move_area")} </div> <ha-svg-icon slot="end" .path="${Y}"></ha-svg-icon> </ha-md-menu-item> <ha-md-menu slot="menu">${e}</ha-md-menu> </ha-sub-menu>`:n.s6} </ha-md-button-menu>`:n.s6} ${this.scripts.length?n.s6:n.qy` <div class="empty" slot="empty"> <ha-svg-icon .path="${at}"></ha-svg-icon> <h1> ${this.hass.localize("ui.panel.config.script.picker.empty_header")} </h1> <p> ${this.hass.localize("ui.panel.config.script.picker.empty_text")} </p> </div>`} <ha-fab slot="fab" ?is-wide="${this.isWide}" ?narrow="${this.narrow}" .label="${this.hass.localize("ui.panel.config.script.picker.add_script")}" extended @click="${this._createNew}"> <ha-svg-icon slot="icon" .path="${st}"></ha-svg-icon> </ha-fab> </hass-tabs-subpage-data-table> `}_handleSearchChange(t){this._filter=t.detail.value}_filterExpanded(t){t.detail.expanded?this._expandedFilter=t.target.localName:this._expandedFilter===t.target.localName&&(this._expandedFilter=void 0)}_filterChanged(t){const i=t.target.localName;this._filters={...this._filters,[i]:t.detail},this._applyFilters()}_clearFilter(){this._filters={},this._applyFilters()}_applyFilters(){const t=Object.entries(this._filters);let i;for(const[e,s]of t){if(s.items){if(!i){i=s.items;continue}i="intersection"in i?i.intersection(s.items):new Set([...i].filter(t=>s.items.has(t)))}if("ha-filter-categories"===e&&Array.isArray(s.value)&&s.value.length){const t=new Set;if(this.scripts.filter(t=>s.value[0]===this._entityReg.find(i=>i.entity_id===t.entity_id)?.categories.script).forEach(i=>t.add(i.entity_id)),!i){i=t;continue}i="intersection"in i?i.intersection(t):new Set([...i].filter(i=>t.has(i)))}if("ha-filter-labels"===e&&Array.isArray(s.value)&&s.value.length){const t=new Set;if(this.scripts.filter(t=>this._entityReg.find(i=>i.entity_id===t.entity_id)?.labels.some(t=>s.value.includes(t))).forEach(i=>t.add(i.entity_id)),!i){i=t;continue}i="intersection"in i?i.intersection(t):new Set([...i].filter(i=>t.has(i)))}}this._filteredScripts=i?[...i]:void 0}updated(t){super.updated(t),t.has("_entityReg")&&this._applyFilters()}firstUpdated(){this._searchParms.has("blueprint")&&this._filterBlueprint(),this._searchParms.has("label")&&this._filterLabel()}_filterLabel(){const t=this._searchParms.get("label");t&&(this._filters={...this._filters,"ha-filter-labels":{value:[t],items:void 0}},this._applyFilters())}async _filterBlueprint(){const t=this._searchParms.get("blueprint");if(!t)return;const i=await(0,R.f)(this.hass,"script_blueprint",t);this._filters={...this._filters,"ha-filter-blueprints":{value:[t],items:new Set(i.automation||[])}},this._applyFilters()}_editCategory(t){const i=this._entityReg.find(i=>i.entity_id===t.entity_id);i?(0,U.j)(this,{scope:"script",entityReg:i}):(0,I.showAlertDialog)(this,{title:this.hass.localize("ui.panel.config.script.picker.no_category_support"),text:this.hass.localize("ui.panel.config.script.picker.no_category_entity_reg")})}_handleSelectionChanged(t){this._selected=t.detail.value}async _bulkAddCategory(t){const i=[];this._selected.forEach(e=>{i.push((0,z.G_)(this.hass,e,{categories:{script:t}}))});const e=await Promise.allSettled(i);if((0,v.$)(e)){const t=(0,v.N)(e);(0,I.showAlertDialog)(this,{title:this.hass.localize("ui.panel.config.common.multiselect.failed",{number:t.length}),text:n.qy`<pre>
${t.map(t=>t.reason.message||t.reason.code||t.reason).join("\r\n")}</pre>`})}}async _handleBulkLabel(t){const i=t.currentTarget.value,e=t.currentTarget.action;this._bulkLabel(i,e)}async _bulkLabel(t,i){const e=[];this._selected.forEach(s=>{e.push((0,z.G_)(this.hass,s,{labels:"add"===i?this.hass.entities[s].labels.concat(t):this.hass.entities[s].labels.filter(i=>i!==t)}))});const s=await Promise.allSettled(e);if((0,v.$)(s)){const t=(0,v.N)(s);(0,I.showAlertDialog)(this,{title:this.hass.localize("ui.panel.config.common.multiselect.failed",{number:t.length}),text:n.qy`<pre>
${t.map(t=>t.reason.message||t.reason.code||t.reason).join("\r\n")}</pre>`})}}_handleRowClicked(t){const i=this.entityRegistry.find(i=>i.entity_id===t.detail.id);i?(0,m.o)(`/config/script/edit/${i.unique_id}`):(0,m.o)(`/config/script/show/${t.detail.id}`)}_createNew(){(0,p.x)(this.hass,"blueprint")?(0,W.l)(this,{mode:"script"}):(0,m.o)("/config/script/edit/new")}_showInfo(t){(0,y.r)(this,"hass-more-info",{entityId:t.entity_id})}_openSettings(t){(0,E.p)(this,{entityId:t.entity_id,view:"settings"})}_showTrace(t){const i=this.entityRegistry.find(i=>i.entity_id===t.entity_id);i&&(0,m.o)(`/config/script/trace/${i.unique_id}`)}_showHelp(){(0,I.showAlertDialog)(this,{title:this.hass.localize("ui.panel.config.script.caption"),text:n.qy` ${this.hass.localize("ui.panel.config.script.picker.introduction")} `})}async _duplicate(t){try{const i=this.entityRegistry.find(i=>i.entity_id===t.entity_id);if(!i)return;const e=await(0,L.Kq)(this.hass,i.unique_id);(0,L.AM)({...e,alias:`${e?.alias} (${this.hass.localize("ui.panel.config.script.picker.duplicate")})`})}catch(i){if(404===i.status_code){const i=await(0,L.R$)(this.hass,t.entity_id);return void(0,L.AM)(i.config)}await(0,I.showAlertDialog)(this,{text:this.hass.localize("ui.panel.config.script.editor.load_error_unknown",{err_no:i.status_code})})}}async _deleteConfirm(t){(0,I.dk)(this,{title:this.hass.localize("ui.panel.config.script.editor.delete_confirm_title"),text:this.hass.localize("ui.panel.config.script.editor.delete_confirm_text",{name:t.name}),confirmText:this.hass.localize("ui.common.delete"),dismissText:this.hass.localize("ui.common.cancel"),confirm:()=>this._delete(t),destructive:!0})}async _delete(t){try{const i=this.entityRegistry.find(i=>i.entity_id===t.entity_id);i&&(await(0,L.Ht)(this.hass,i.unique_id),this._selected=this._selected.filter(i=>i!==t.entity_id))}catch(t){await(0,I.showAlertDialog)(this,{text:400===t.status_code?this.hass.localize("ui.panel.config.script.editor.load_error_not_deletable"):this.hass.localize("ui.panel.config.script.editor.load_error_unknown",{err_no:t.status_code})})}}async _bulkAddArea(t){const i=[];this._selected.forEach(e=>{i.push((0,z.G_)(this.hass,e,{area_id:t}))});const e=await Promise.allSettled(i);if((0,v.$)(e)){const t=(0,v.N)(e);(0,I.showAlertDialog)(this,{title:this.hass.localize("ui.panel.config.common.multiselect.failed",{number:t.length}),text:n.qy`<pre>
${t.map(t=>t.reason.message||t.reason.code||t.reason).join("\r\n")}</pre>`})}}_handleSortingChanged(t){this._activeSorting=t.detail}_handleGroupingChanged(t){this._activeGrouping=t.detail.value??""}_handleCollapseChanged(t){this._activeCollapsed=t.detail.value}_handleColumnsChanged(t){this._activeColumnOrder=t.detail.columnOrder,this._activeHiddenColumns=t.detail.hiddenColumns}static get styles(){return[P.RF,n.AH`:host{display:block;height:100%}hass-tabs-subpage-data-table{--data-table-row-height:60px}hass-tabs-subpage-data-table.narrow{--data-table-row-height:72px}a{text-decoration:none}.empty{--mdc-icon-size:80px;max-width:500px}.empty ha-button{--mdc-icon-size:24px}.empty h1{font-size:var(--ha-font-size-3xl)}ha-assist-chip{--ha-assist-chip-container-shape:10px}ha-md-button-menu ha-assist-chip{--md-assist-chip-trailing-space:8px}ha-label{--ha-label-background-color:var(--color, var(--grey-color));--ha-label-background-opacity:0.5}`]}constructor(...t){super(...t),this.isWide=!1,this.narrow=!1,this._searchParms=new URLSearchParams(window.location.search),this._selected=[],this._filter="",this._filters={},this._sizeController=new a.P(this,{callback:t=>t[0]?.contentRect.width}),this._scripts=(0,d.A)((t,i,e,s,a,o)=>null===o?[]:(o?t.filter(t=>o.includes(t.entity_id)):t).map(t=>{const o=i.find(i=>i.entity_id===t.entity_id),r=o?.categories.script,n=a&&o?.labels;return{...t,name:(0,f.u)(t),area:o?.area_id?e[o?.area_id]?.name:void 0,last_triggered:t.attributes.last_triggered||void 0,category:r?s?.find(t=>t.category_id===r)?.name:void 0,labels:(n||[]).map(t=>a.find(i=>i.label_id===t)),selectable:void 0!==o}})),this._columns=(0,d.A)(t=>({icon:{title:"",showNarrow:!0,moveable:!1,label:t("ui.panel.config.script.picker.headers.icon"),type:"icon",template:t=>n.qy`<ha-state-icon .hass="${this.hass}" .stateObj="${t}" style="${(0,h.W)({color:t.state===S.Hh?"var(--error-color)":"unset"})}"></ha-state-icon>`},name:{title:t("ui.panel.config.script.picker.headers.name"),main:!0,sortable:!0,filterable:!0,direction:"asc",flex:2,extraTemplate:t=>t.labels.length?n.qy`<ha-data-table-labels @label-clicked="${this._labelClicked}" .labels="${t.labels}"></ha-data-table-labels>`:n.s6},area:{title:t("ui.panel.config.script.picker.headers.area"),groupable:!0,filterable:!0,sortable:!0},category:{title:t("ui.panel.config.script.picker.headers.category"),defaultHidden:!0,groupable:!0,filterable:!0,sortable:!0},labels:{title:"",hidden:!0,filterable:!0,template:t=>t.labels.map(t=>t.name).join(" ")},last_triggered:{sortable:!0,title:t("ui.card.automation.last_triggered"),template:t=>{if(!t.last_triggered)return this.hass.localize("ui.components.relative_time.never");const i=new Date(t.last_triggered),e=new Date,s=(0,r.c)(e,i),a=(0,g.CL)(i,this.hass.locale,this.hass.config),o="last-triggered-"+(0,b.Y)(t.entity_id);return n.qy` ${s>3?a:n.qy` <ha-tooltip for="${o}">${a}</ha-tooltip> <span id="${o}">${(0,u.K)(i,this.hass.locale)}</span> `} `}},actions:{title:"",label:this.hass.localize("ui.panel.config.generic.headers.actions"),type:"overflow-menu",showNarrow:!0,moveable:!1,hideable:!1,template:t=>n.qy` <ha-icon-overflow-menu .hass="${this.hass}" narrow .items="${[{path:tt,label:this.hass.localize("ui.panel.config.script.picker.show_info"),action:()=>this._showInfo(t)},{path:N,label:this.hass.localize("ui.panel.config.automation.picker.show_settings"),action:()=>this._openSettings(t)},{path:ot,label:this.hass.localize("ui.panel.config.script.picker."+(t.category?"edit_category":"assign_category")),action:()=>this._editCategory(t)},{path:et,label:this.hass.localize("ui.panel.config.script.picker.run"),action:()=>this._runScript(t)},{path:nt,label:this.hass.localize("ui.panel.config.script.picker.show_trace"),action:()=>this._showTrace(t)},{divider:!0},{path:G,label:this.hass.localize("ui.panel.config.script.picker.duplicate"),action:()=>this._duplicate(t)},{label:this.hass.localize("ui.panel.config.script.picker.delete"),path:Q,action:()=>this._deleteConfirm(t),warning:!0}]}"> </ha-icon-overflow-menu> `}})),this._labelClicked=t=>{const i=t.detail.label;this._filters={...this._filters,"ha-filter-labels":{value:[i.label_id],items:void 0}},this._applyFilters()},this._handleBulkCategory=t=>{const i=t.value;this._bulkAddCategory(i)},this._runScript=async t=>{const i=this.entityRegistry.find(i=>i.entity_id===t.entity_id);i&&((0,L.TP)(this.hass,i.unique_id)?this._showInfo(t):(await(0,L.kR)(this.hass,i.unique_id),(0,O.P)(this,{message:this.hass.localize("ui.notification_toast.triggered",{name:(0,f.u)(t)})})))},this._bulkCreateCategory=()=>{(0,B.S)(this,{scope:"script",createEntry:async t=>{const i=await(0,H.s_)(this.hass,"script",t);return this._bulkAddCategory(i.category_id),i}})},this._bulkCreateLabel=()=>{(0,D.f)(this,{createEntry:async t=>{const i=await(0,q._9)(this.hass,t);this._bulkLabel(i.label_id,"add")}})},this._handleBulkArea=t=>{const i=t.value;this._bulkAddArea(i)},this._bulkCreateArea=()=>{(0,F.J)(this,{createEntry:async t=>{const i=await(0,x.L3)(this.hass,t);return this._bulkAddArea(i.area_id),i}})}}}(0,s.Cg)([(0,l.MZ)({attribute:!1})],lt.prototype,"hass",void 0),(0,s.Cg)([(0,l.MZ)({attribute:!1})],lt.prototype,"scripts",void 0),(0,s.Cg)([(0,l.MZ)({attribute:"is-wide",type:Boolean})],lt.prototype,"isWide",void 0),(0,s.Cg)([(0,l.MZ)({type:Boolean})],lt.prototype,"narrow",void 0),(0,s.Cg)([(0,l.MZ)({attribute:!1})],lt.prototype,"route",void 0),(0,s.Cg)([(0,l.MZ)({attribute:!1})],lt.prototype,"entityRegistry",void 0),(0,s.Cg)([(0,l.wk)()],lt.prototype,"_searchParms",void 0),(0,s.Cg)([(0,l.wk)()],lt.prototype,"_selected",void 0),(0,s.Cg)([(0,l.wk)()],lt.prototype,"_activeFilters",void 0),(0,s.Cg)([(0,l.wk)()],lt.prototype,"_filteredScripts",void 0),(0,s.Cg)([(0,l.wk)(),(0,_.I)({storage:"sessionStorage",key:"script-table-search",state:!0,subscribe:!1})],lt.prototype,"_filter",void 0),(0,s.Cg)([(0,l.wk)(),(0,_.I)({storage:"sessionStorage",key:"script-table-filters-full",state:!0,subscribe:!1,serializer:V.i,deserializer:V.D})],lt.prototype,"_filters",void 0),(0,s.Cg)([(0,l.wk)()],lt.prototype,"_expandedFilter",void 0),(0,s.Cg)([(0,l.wk)()],lt.prototype,"_categories",void 0),(0,s.Cg)([(0,l.wk)()],lt.prototype,"_labels",void 0),(0,s.Cg)([(0,l.wk)(),(0,o.Fg)({context:M.ih,subscribe:!0})],lt.prototype,"_entityReg",void 0),(0,s.Cg)([(0,_.I)({key:"script-table-sort",state:!1,subscribe:!1})],lt.prototype,"_activeSorting",void 0),(0,s.Cg)([(0,_.I)({key:"script-table-grouping",state:!1,subscribe:!1})],lt.prototype,"_activeGrouping",void 0),(0,s.Cg)([(0,_.I)({key:"script-table-collapsed",state:!1,subscribe:!1})],lt.prototype,"_activeCollapsed",void 0),(0,s.Cg)([(0,_.I)({key:"script-table-column-order",state:!1,subscribe:!1})],lt.prototype,"_activeColumnOrder",void 0),(0,s.Cg)([(0,_.I)({key:"script-table-hidden-columns",state:!1,subscribe:!1})],lt.prototype,"_activeHiddenColumns",void 0),lt=(0,s.Cg)([(0,l.EM)("ha-script-picker")],lt),i()}catch(t){i(t)}})},84042(t,i,e){e.a(t,async function(t,i){try{e(18111),e(22489),e(7588);var s=e(62826),a=e(96196),o=e(16527),r=e(53289),n=e(44457),l=e(94333),h=e(63533),d=e(44537),c=e(93905),p=e(68348),g=e(1087),u=e(51758),_=e(6030),y=(e(26300),e(3587),e(77423)),f=e(38911),m=e(84025),b=e(54706),v=e(81619),C=e(68469),$=e(89552),w=e(78614),A=e(84047),k=e(57116),x=e(95415),H=t([C,$,x,w]);[C,$,x,w]=H.then?(await H)():H;const M="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z",V=(0,h.Ik)({alias:(0,h.lq)((0,h.Yj)()),description:(0,h.lq)((0,h.Yj)()),sequence:(0,h.lq)((0,h.YO)((0,h.bz)())),icon:(0,h.lq)((0,h.Yj)()),mode:(0,h.lq)((0,h.vP)([typeof m.FN])),max:(0,h.lq)((0,h.ai)()),fields:(0,h.lq)((0,h.Ik)())});class S extends((0,b.E)(a.WF)){addFields(){this._openFields=!0,(0,g.r)(this,"value-changed",{value:{...this.config,fields:{[this.hass.localize("ui.panel.config.script.editor.field.field")||"field"]:{selector:{text:null}}}}})}hassSubscribe(){return[(0,y.Pd)(this.hass,t=>{this._configEntries.setValue(t)})]}updated(t){this._openFields&&t.has("config")&&(this._openFields=!1,this._scriptFields?.updateComplete.then(()=>this._scriptFields?.focusLastField()))}_renderContent(){return a.qy` ${this.config.description?a.qy`<ha-markdown class="description" breaks .content="${this.config.description}"></ha-markdown>`:a.s6} ${this.config.fields?a.qy`<div class="header"> <h2 id="fields-heading" class="name"> ${this.hass.localize("ui.panel.config.script.editor.field.fields")} </h2> </div> <ha-script-fields role="region" aria-labelledby="fields-heading" .fields="${this.config.fields}" .highlightedFields="${this._pastedConfig?.fields}" @value-changed="${this._fieldsChanged}" .hass="${this.hass}" .disabled="${this.disabled}" .narrow="${this.narrow}" @open-sidebar="${this._openSidebar}" @request-close-sidebar="${this.triggerCloseSidebar}" @close-sidebar="${this._handleCloseSidebar}"></ha-script-fields>`:a.s6} <div class="header"> <h2 id="sequence-heading" class="name"> ${this.hass.localize("ui.panel.config.script.editor.sequence")} </h2> </div> <ha-automation-action role="region" aria-labelledby="sequence-heading" .actions="${this.config.sequence||[]}" .highlightedActions="${this._pastedConfig?.sequence}" @value-changed="${this._sequenceChanged}" @open-sidebar="${this._openSidebar}" @request-close-sidebar="${this.triggerCloseSidebar}" @close-sidebar="${this._handleCloseSidebar}" .hass="${this.hass}" .narrow="${this.narrow}" .disabled="${this.disabled||this.saving}" root sidebar></ha-automation-action> `}render(){return a.qy` <div class="${(0,l.H)({"has-sidebar":this._sidebarConfig&&!this.narrow})}"> <div class="content-wrapper"> <div class="content ${this._sidebarConfig&&this.narrow?"has-bottom-sheet":""}"> <slot name="alerts"></slot> ${this._renderContent()} </div> <div class="fab-positioner"> <div class="fab-positioner"> <ha-fab slot="fab" class="${this.dirty?"dirty":""}" .label="${this.hass.localize("ui.common.save")}" .disabled="${this.saving}" extended @click="${this._saveScript}"> <ha-svg-icon slot="icon" .path="${M}"></ha-svg-icon> </ha-fab> </div> </div> </div> <div class="sidebar-positioner"> <ha-automation-sidebar .sidebarKey="${this._sidebarKey}" tabindex="-1" class="${(0,l.H)({hidden:!this._sidebarConfig})}" .narrow="${this.narrow}" .isWide="${this.isWide}" .hass="${this.hass}" .config="${this._sidebarConfig}" .disabled="${this.disabled}" @value-changed="${this._sidebarConfigChanged}" @sidebar-resized="${this._resizeSidebar}" @sidebar-resizing-stopped="${this._stopResizeSidebar}" @sidebar-reset-size="${this._resetSidebarWidth}"></ha-automation-sidebar> </div> </div> `}firstUpdated(t){super.firstUpdated(t),this.style.setProperty("--sidebar-dynamic-width",`${this._sidebarWidthPx}px`);"1"===(0,_.p9)("expanded")&&(this._clearParam("expanded"),this.expandAll())}_clearParam(t){window.history.replaceState(null,"",(0,u.Z)((0,_.s8)(t)))}_fieldsChanged(t){t.stopPropagation(),this.resetPastedConfig(),(0,g.r)(this,"value-changed",{value:{...this.config,fields:t.detail.value}})}_sequenceChanged(t){t.stopPropagation(),this.resetPastedConfig(),(0,g.r)(this,"value-changed",{value:{...this.config,sequence:t.detail.value}})}connectedCallback(){super.connectedCallback(),window.addEventListener("paste",this._handlePaste)}disconnectedCallback(){window.removeEventListener("paste",this._handlePaste),super.disconnectedCallback()}_appendToExistingConfig(t){this._pastedConfig=t;const i={...this.config};i&&("fields"in t&&(i.fields={...i.fields,...t.fields}),"sequence"in t&&(i.sequence=(0,d.e)(i.sequence||[]).concat((0,d.e)(t.sequence))),this._showPastedToastWithUndo(),(0,g.r)(this,"value-changed",{value:{...i}}))}_replaceExistingConfig(t){this._pastedConfig=t,this._showPastedToastWithUndo(),(0,g.r)(this,"value-changed",{value:{...t}})}_showPastedToastWithUndo(){(0,v.P)(this,{message:this.hass.localize("ui.panel.config.script.editor.paste_toast_message"),duration:4e3,action:{text:this.hass.localize("ui.common.undo"),action:()=>{(0,g.r)(this,"undo-change"),this._pastedConfig=void 0}}})}resetPastedConfig(){this._pastedConfig=void 0,(0,v.P)(this,{message:"",duration:0})}async _openSidebar(t){this._sidebarConfig?.close?.(),this._sidebarConfig=t.detail,this._sidebarKey++,await(this._sidebarElement?.updateComplete),this._sidebarElement?.focus()}_sidebarConfigChanged(t){t.stopPropagation(),this._sidebarConfig&&(this._sidebarConfig={...this._sidebarConfig,...t.detail.value})}triggerCloseSidebar(){if(this._sidebarConfig){if(this._sidebarElement)return void this._sidebarElement.triggerCloseSidebar();this._sidebarConfig?.close(),this._sidebarKey=0}}_handleCloseSidebar(){this._sidebarConfig=void 0}_saveScript(){this.triggerCloseSidebar(),(0,g.r)(this,"save-script")}_tryInsertAfterSelected(t){return!(!this._sidebarConfig||!("insertAfter"in this._sidebarConfig))&&this._sidebarConfig.insertAfter(t)}expandAll(){this._collapsableElements?.forEach(t=>{t.expandAll()})}collapseAll(){this._collapsableElements?.forEach(t=>{t.collapseAll()})}copySelectedRow(){this._sidebarConfig?.copy&&this._sidebarConfig.copy()}cutSelectedRow(){this._sidebarConfig?.cut&&this._sidebarConfig.cut()}deleteSelectedRow(){this._sidebarConfig?.delete&&this._sidebarConfig.delete()}_resizeSidebar(t){t.stopPropagation();const i=t.detail.deltaInPx;this._prevSidebarWidthPx||(this._prevSidebarWidthPx=this._sidebarElement?.clientWidth||w.Q);const e=i+this._prevSidebarWidthPx;this._sidebarWidthPx=e,this.style.setProperty("--sidebar-dynamic-width",`${this._sidebarWidthPx}px`)}_stopResizeSidebar(t){t.stopPropagation(),this._prevSidebarWidthPx=void 0}_resetSidebarWidth(t){t.stopPropagation(),this._prevSidebarWidthPx=void 0,this._sidebarWidthPx=w.Q,this.style.setProperty("--sidebar-dynamic-width",`${this._sidebarWidthPx}px`)}static get styles(){return[k.T_,k.qK,a.AH`.header{display:flex;align-items:center}.header:first-child{margin-top:-16px}.header .name{font-size:var(--ha-font-size-xl);font-weight:var(--ha-font-weight-normal);flex:1}.description{margin-top:16px}`]}constructor(...t){super(...t),this.isWide=!1,this.narrow=!1,this.disabled=!1,this.saving=!1,this.dirty=!1,this._sidebarKey=0,this._sidebarWidthPx=w.Q,this._configEntries=new o.DT(this,{context:f.g5,initialValue:[]}),this._openFields=!1,this._handlePaste=async t=>{if(!(0,p.u)(t.composedPath()))return;const i=t.clipboardData?.getData("text");if(!i)return;let e;try{e=(0,r.Hh)(i)}catch(t){return void(0,v.P)(this,{message:this.hass.localize("ui.panel.config.script.editor.paste_invalid_config"),duration:4e3,dismissable:!0})}if(!e||"object"!=typeof e)return;let s=e;"script"in s&&(s=s.script,Object.keys(s).length&&(s=s[Object.keys(s)[0]])),Array.isArray(s)&&(s=1===s.length?s[0]:{sequence:s});const a=(0,m.pq)(s);let o;(!["sequence","unknown"].includes(a)||"sequence"===a&&"metadata"in s)&&(s={sequence:[s]});try{o=(0,m.nB)(s)}catch(t){return}try{(0,h.vA)(o,V)}catch(t){return void(0,v.P)(this,{message:this.hass.localize("ui.panel.config.script.editor.paste_invalid_config"),duration:4e3,dismissable:!0})}if(o){t.preventDefault();const i=Object.keys(o).filter(t=>(0,d.e)(o[t]).length);if(1===i.length&&["sequence"].includes(i[0])&&this._tryInsertAfterSelected(o[i[0]]))return void this._showPastedToastWithUndo();if(this.dirty||(0,d.e)(this.config.sequence)?.length||Object.keys(this.config.fields||{}).length){if(!await new Promise(t=>{(0,A.Z)(this,{domain:"script",pastedConfig:o,onClose:()=>t(!1),onAppend:()=>{this._appendToExistingConfig(o),t(!1)},onReplace:()=>t(!0)})}))return}this._replaceExistingConfig(o)}}}}(0,s.Cg)([(0,n.MZ)({attribute:!1})],S.prototype,"hass",void 0),(0,s.Cg)([(0,n.MZ)({attribute:"is-wide",type:Boolean})],S.prototype,"isWide",void 0),(0,s.Cg)([(0,n.MZ)({type:Boolean})],S.prototype,"narrow",void 0),(0,s.Cg)([(0,n.MZ)({type:Boolean})],S.prototype,"disabled",void 0),(0,s.Cg)([(0,n.MZ)({type:Boolean})],S.prototype,"saving",void 0),(0,s.Cg)([(0,n.MZ)({attribute:!1})],S.prototype,"config",void 0),(0,s.Cg)([(0,n.MZ)({attribute:!1})],S.prototype,"dirty",void 0),(0,s.Cg)([(0,n.wk)()],S.prototype,"_pastedConfig",void 0),(0,s.Cg)([(0,n.wk)()],S.prototype,"_sidebarConfig",void 0),(0,s.Cg)([(0,n.wk)()],S.prototype,"_sidebarKey",void 0),(0,s.Cg)([(0,c.I)({key:"automation-sidebar-width",state:!1,subscribe:!1})],S.prototype,"_sidebarWidthPx",void 0),(0,s.Cg)([(0,n.P)("ha-script-fields")],S.prototype,"_scriptFields",void 0),(0,s.Cg)([(0,n.P)("ha-automation-sidebar")],S.prototype,"_sidebarElement",void 0),(0,s.Cg)([(0,n.YG)("ha-automation-action, ha-script-fields")],S.prototype,"_collapsableElements",void 0),S=(0,s.Cg)([(0,n.EM)("manual-script-editor")],S),i()}catch(t){i(t)}})}};
//# sourceMappingURL=8735.17e0d649bff90a7a.js.map