export const __rspack_esm_id="42568";export const __rspack_esm_ids=["42568"];export const __webpack_modules__={75428(t,e,i){i.d(e,{D:()=>a});var s=i(75158),n=i.n(s);const a=t=>n()(t,{whiteList:{},stripIgnoreTag:!0,stripIgnoreTagBody:!0})},23528(t,e,i){i.d(e,{$3:()=>y,$O:()=>$,$j:()=>m,ED:()=>a,JE:()=>x,OQ:()=>E,PU:()=>T,Ph:()=>u,Uf:()=>w,W1:()=>g,Wr:()=>_,Z:()=>c,gF:()=>p,iY:()=>f,jU:()=>r,nN:()=>S,p3:()=>h,pJ:()=>l,r_:()=>o,sz:()=>d});i(18111),i(13579);var s=i(28978),n=i(380),a=function(t){return t[t.NONE=0]="NONE",t[t.ARITHMETIC=1]="ARITHMETIC",t[t.CIRCULAR=2]="CIRCULAR",t}({});const r=["entity_not_recorded","entity_no_longer_recorded","state_class_removed","units_changed","mean_type_changed","no_state"],o=["L","gal","ft³","m³","CCF","MCF"],c=t=>t.sendMessagePromise({type:"recorder/info"}),h=(t,e)=>t.callWS({type:"recorder/list_statistic_ids",statistic_type:e}),_=(t,e)=>t.callWS({type:"recorder/get_statistics_metadata",statistic_ids:e}),d=(t,e,i,s,n="hour",a,r)=>t.callWS({type:"recorder/statistics_during_period",start_time:e.toISOString(),end_time:i?.toISOString(),statistic_ids:s,period:n,units:a,types:r}),l=(t,e,i,s)=>t.callWS({type:"recorder/statistic_during_period",statistic_id:e,units:s,fixed_period:i.fixed_period?{start_time:i.fixed_period.start instanceof Date?i.fixed_period.start.toISOString():i.fixed_period.start,end_time:i.fixed_period.end instanceof Date?i.fixed_period.end.toISOString():i.fixed_period.end}:void 0,calendar:i.calendar?{..."week"===i.calendar.period?{first_weekday:(0,n.D)(t.locale).substring(0,3)}:{},...i.calendar}:void 0,rolling_window:i.rolling_window}),u=t=>t.callWS({type:"recorder/validate_statistics"}),g=(t,e,i,s)=>t.callWS({type:"recorder/update_statistics_metadata",statistic_id:e,unit_of_measurement:i,unit_class:s}),y=(t,e)=>t.callWS({type:"recorder/clear_statistics",statistic_ids:e}),m=t=>{let e=null;if(!t)return null;for(const i of t)null!==i.change&&void 0!==i.change&&(null===e?e=i.change:e+=i.change);return e},p=(t,e)=>{let i=null;for(const s of e){if(!(s in t))continue;const e=m(t[s]);null!==e&&(null===i?i=e:i+=e)}return i},f=(t,e)=>t.some(t=>void 0!==t[e]&&null!==t[e]),b=["mean","min","max"],v=["sum","state","change"],S=(t,e)=>!(!b.includes(e)||0===t.mean_type)||!(!v.includes(e)||!t.has_sum),w=(t,e,i,s,n)=>{const a=new Date(i).toISOString();return t.callWS({type:"recorder/adjust_sum_statistics",statistic_id:e,start_time:a,adjustment:s,adjustment_unit_of_measurement:n})},$=(t,e,i)=>{const n=t.states[e];return n?(0,s.u)(n):i?.name||e},x=(t,e,i)=>{let s;return e&&(s=t.states[e]?.attributes.unit_of_measurement),void 0===s?i?.statistics_unit_of_measurement:s},E=t=>t.includes(":"),T=t=>t.callWS({type:"recorder/update_statistics_issues"})},97372(t,e,i){i.a(t,async function(t,s){try{i.d(e,{Gs:()=>S,JR:()=>k,RR:()=>T,TI:()=>w,od:()=>x,ok:()=>C});i(44114),i(18111),i(22489),i(7588),i(61701),i(17642),i(58004),i(33853),i(45876),i(32475),i(15024),i(31698);var n=i(66708),a=i(6946),r=i(57279),o=i(98487),c=i(33977),h=i(56434),_=i(49134),d=i(35660),l=i(81977),u=i(35932),g=i(92913),y=i(77972),m=i(20058),p=i(72487),f=i(30162),b=i(75428),v=t([p,f,m]);function S(t,e,i=!1){let s=new Date(e);return t>2&&0===s.getHours()&&(s=(0,n.O)(s,1)),i||s.setMinutes(0,0,0),t>35&&s.setDate(1),t>2&&s.setHours(0),s.getTime()}function w(t){return t>35?"month":t>2?"day":"hour"}function $(t){let e;return i=>{const s=Math.max(1,-Math.floor(Math.log10(Math.abs(i-(e??i)||1))));return e=i,(0,m.ZV)(i,t,{maximumFractionDigits:s})}}function x(t,e,i,s,n,r,o,c,h=!1){const _=(0,a.c)(e,t),d=void 0!==r&&void 0!==o,l=d&&t.getFullYear()!==r.getFullYear();return{xAxis:{type:"time",min:t,max:S(_,e,h)},yAxis:{type:"value",name:n,nameGap:2,nameTextStyle:{align:"left"},axisLabel:{formatter:$(i)},splitLine:{show:!0}},grid:{top:15,bottom:0,left:1,right:1,containLabel:!0},tooltip:{trigger:"axis",formatter:t=>{if(Array.isArray(t)){const e=[],a=[];return t.forEach(t=>{t.seriesId?.startsWith("compare-")?a.push(t):e.push(t)}),[e,a].map(t=>E(t,i,s,_,d,l,n,c)).filter(Boolean).join("<br><br>")}return E([t],i,s,_,d,l,n,c)}}}}function E(t,e,i,s,n,a,o,c){if(!t[0]?.value)return"";const h=new Date(t[0].value?.[2]??t[0].value?.[0]);let _;s>=89?_=`${(0,p.fr)(h,e,i)}`:s>0?_=`${(a?p.kz:p.sl)(h,e,i)}`:(_=`${n?`${(a?p.kz:p.sl)(h,e,i)}: `:""}${(0,f.fU)(h,e,i)}`,"bar"===t[0].componentSubType&&(_+=` – ${(0,f.fU)((0,r.L)(h,1),e,i)}`));const d=`<h4 style="text-align: center; margin: 0;">${_}</h4>`;let l=0,u=0,g=0,y=0;const v=t.map(t=>{const i=t.value?.[1],s=(0,m.ZV)(i,e,i<.1?{maximumFractionDigits:3}:void 0);return"0"!==s&&("bar"===t.componentSubType&&(i>0?(l+=i,u++):(g+=i,y++)),`${t.marker} ${(0,b.D)(t.seriesName)}: <div style="direction:ltr; display: inline;">${s} ${o}</div>`)}).filter(Boolean);let S="";return 0!==l&&u>1&&c&&(S+=`<br><b>${c(l)}</b>`),0!==g&&y>1&&c&&(S+=`<br><b>${c(g)}</b>`),v.length>0?`${d}${v.join("<br>")}${S}`:""}function T(t){Array.from(new Set(t.map(t=>t.data.map(t=>Number(t[0]))).flat())).sort((t,e)=>t-e).forEach((e,i)=>{const s={},n={};for(let a=t.length-1;a>=0;a--){const r=t[a].data[i],o=r&&"object"==typeof r&&"value"in r?r:{value:r},c=o.value?.[0],h=t[a].stack??"";void 0!==c&&(Number(c)!==e?t[a].data?.splice(i,0,{value:[e,0],itemStyle:{borderWidth:0}}):0===o.value?.[1]?t[a].data[i]={...o,itemStyle:{...o.itemStyle,borderWidth:0}}:!s[h]&&o.value?.[1]>0?(t[a].data[i]={...o,itemStyle:{...o.itemStyle,borderRadius:[4,4,0,0]}},s[h]=!0):!n[h]&&o.value?.[1]<0&&(t[a].data[i]={...o,itemStyle:{...o.itemStyle,borderRadius:[0,0,4,4]}},n[h]=!0))}})}function I(t){const e=t&&"object"==typeof t&&"value"in t?t:{value:t};return Number(e.value?.[0])}function k(t){const e=Array.from(new Set(t.map(t=>t.data.map(t=>I(t))).flat())).sort((t,e)=>t-e);return t.forEach(t=>{const i=new Map;t.data.forEach(t=>{const e=t&&"object"==typeof t&&"value"in t?t:{value:t},s=I(t);Number.isNaN(s)||i.set(s,e)}),t.data=e.map(t=>i.get(t)??[t,0])}),t}function C(t,e){if(!e)return t=>t;const i=(0,o.V)(t,e);if(0!==i&&t.getTime()===(0,c.D)(t).getTime())return t=>(0,h.e)(t,i);const s=(0,_.W)(t,e);if(0!==s&&t.getTime()===(0,d.w)(t).getTime())return t=>(0,l.P)(t,s);const n=(0,a.c)(t,e);if(0!==n&&t.getTime()===(0,u.o)(t).getTime())return t=>(0,g.f)(t,n);const r=t.getTime()-e.getTime();return t=>(0,y.A)(t,r)}[p,f,m]=v.then?(await v)():v,s()}catch(D){s(D)}})},3515(t,e,i){i.a(t,async function(t,s){try{i.r(e),i.d(e,{DEFAULT_DAYS_TO_SHOW:()=>v,HuiStatisticsGraphCard:()=>S});i(18111),i(20116),i(7588),i(61701);var n=i(62826),a=i(6946),r=i(66708),o=i(96196),c=i(44457),h=i(94333),_=i(6030),d=(i(76776),i(43661),i(34127)),l=i(38114),u=i(23528),g=i(37642),y=i(13632),m=i(784),p=i(20939),f=i(97372),b=t([d,l,f]);[d,l,f]=b.then?(await b)():b;const v=30;class S extends o.WF{static async getConfigElement(){return await Promise.all([i.e("44533"),i.e("92769"),i.e("44966"),i.e("38919"),i.e("80445"),i.e("19260"),i.e("59648"),i.e("27408"),i.e("13559")]).then(i.bind(i,9562)),document.createElement("hui-statistics-graph-card-editor")}static getStubConfig(t,e,i){const s=(0,y.B)(t,1,e,i,["sensor"],t=>"state_class"in t.attributes);return{type:"statistics-graph",entities:s.length?[s[0]]:[]}}disconnectedCallback(){super.disconnectedCallback(),this._unsubscribeEnergy(),this._interval&&(clearInterval(this._interval),this._interval=void 0)}connectedCallback(){super.connectedCallback(),this.hasUpdated&&(this._config?.energy_date_selection?this._subscribeEnergy():void 0===this._interval&&this._setFetchStatisticsTimer(!0))}_subscribeEnergy(){this._energySub||(this._energySub=(0,l.tb)(this.hass,{key:this._config?.collection_key}).subscribe(t=>{this._energyStart=t.start,this._energyEnd=t.end,this._getStatistics()}))}_unsubscribeEnergy(){this._energySub&&(this._energySub(),this._energySub=void 0),this._energyStart=void 0,this._energyEnd=void 0}getCardSize(){return 5+(this._config?.title?2:0)+(this._config?.hide_legend?0:this._entities?.length||0)}getGridOptions(){return{columns:12,min_columns:6,min_rows:3}}setConfig(t){if(!t.entities||!Array.isArray(t.entities))throw new Error("Entities need to be an array");if(!t.entities.length)throw new Error("You must include at least one entity");this._entities=t.entities?(0,p.L)(t.entities,!1):[],this._entityIds=this._entities.map(t=>t.entity),"string"==typeof t.stat_types?this._statTypes=[t.stat_types]:t.stat_types?this._statTypes=t.stat_types:this._statTypes=["change","state","sum","min","max","mean"],this._config=t,this._computeNames()}_computeNames(){this.hass&&this._config&&(this._names={},this._entities.forEach(t=>{const e=this.hass.states[t.entity];this._names[t.entity]=(0,g.v)(this.hass,e,t.name)||t.entity}))}shouldUpdate(t){return(0,m.pY)(this,t)||t.size>1||!t.has("hass")}willUpdate(t){if(super.willUpdate(t),!this._config||!t.has("_config"))return;const e=t.get("_config");if(this.hass){if(this._config.energy_date_selection&&!this._energySub)return void this._subscribeEnergy();if(!this._config.energy_date_selection&&this._energySub)return this._unsubscribeEnergy(),void this._setFetchStatisticsTimer();this._config.energy_date_selection&&this._energySub&&t.has("_config")&&e?.collection_key!==this._config.collection_key&&(this._unsubscribeEnergy(),this._subscribeEnergy())}t.has("hass")&&this._computeNames(),t.has("_config")&&e?.entities!==this._config.entities?this._setFetchStatisticsTimer(!0):!t.has("_config")||e?.stat_types===this._config.stat_types&&e?.days_to_show===this._config.days_to_show&&e?.period===this._config.period&&e?.unit===this._config.unit||this._setFetchStatisticsTimer()}async _setFetchStatisticsTimer(t=!1){clearInterval(this._interval),this._interval=0,t&&await this._getStatisticsMetaData(this._entityIds),await this._getStatistics(),this._config?.energy_date_selection||(this._interval=window.setInterval(()=>this._getStatistics(),this._intervalTimeout))}get _period(){return this._config?.period??(this._energyStart&&this._energyEnd?(0,f.TI)((0,a.c)(this._energyEnd,this._energyStart)):void 0)}render(){if(!this.hass||!this._config)return o.s6;const t="number"==typeof this._config.grid_options?.rows,e=this._energyStart&&this._energyEnd?(0,a.c)(this._energyEnd,this._energyStart):this._config.days_to_show||v,i=this._energyStart||(0,r.O)(new Date,24*e+1),s=`/history?${(0,_.KH)({entity_id:this._entityIds.join(","),start_date:i.toISOString()})}`;return o.qy` <ha-card> ${this._config.title?o.qy` <h1 class="card-header"> ${this._config.title} <a id="${this._historyLinkId}" href="${s}" aria-label="${this.hass.localize("panel.history")}"> <ha-icon-next></ha-icon-next> </a> <ha-tooltip for="${this._historyLinkId}" placement="left"> ${this.hass.localize("panel.history")} </ha-tooltip> </h1> `:o.s6} <div class="content ${(0,h.H)({"has-header":!!this._config.title,"has-rows":!!this._config.grid_options?.rows})}"> <statistics-chart .hass="${this.hass}" .isLoadingData="${!this._statistics}" .statisticsData="${this._statistics}" .metadata="${this._metadata}" .period="${this._period}" .chartType="${this._config.chart_type||"line"}" .statTypes="${this._statTypes}" .names="${this._names}" .unit="${this._unit}" .minYAxis="${this._config.min_y_axis}" .maxYAxis="${this._config.max_y_axis}" .startTime="${this._energyStart}" .endTime="${this._energyEnd&&this._energyStart?(0,f.Gs)((0,a.c)(this._energyEnd,this._energyStart),this._energyEnd):void 0}" .fitYData="${this._config.fit_y_data||!1}" .hideLegend="${this._config.hide_legend||!1}" .logarithmicScale="${this._config.logarithmic_scale||!1}" .daysToShow="${e}" .height="${t?"100%":void 0}" .expandLegend="${this._config.expand_legend}"></statistics-chart> </div> </ha-card> `}get _intervalTimeout(){return 1e3*("5minute"===this._config?.period?5:60)*60}async _getStatisticsMetaData(t){const e=await(0,u.Wr)(this.hass,t),i={};e.forEach(t=>{i[t.statistic_id]=t}),this._metadata=i}async _getStatistics(){const t=this._energyStart??(0,r.O)(new Date,24*(this._config.days_to_show||v)+1),e=this._energyEnd;try{let i;if(this._config.unit&&this._metadata){const t=Object.values(this._metadata).find(t=>(0,u.JE)(this.hass,t?.statistic_id,t)===this._config.unit);t&&(i=t.unit_class,this._unit=this._config.unit)}if(!i&&this._metadata){const t=this._metadata[this._entityIds[0]];i=t?.unit_class,this._unit=i&&(0,u.JE)(this.hass,t.statistic_id,t)||void 0}const s=i?{[i]:this._unit}:void 0,n=await(0,u.sz)(this.hass,t,e,this._entityIds,this._period,s,this._statTypes);this._statistics={},this._entities.forEach(t=>{const e=t.entity;e in n&&(this._statistics[e]=n[e])})}catch(t){this._statistics=void 0}}constructor(...t){super(...t),this._entities=[],this._entityIds=[],this._historyLinkId=`history-${Math.random().toString(36).substring(2,9)}`,this._names={}}}S.styles=o.AH`ha-card{display:flex;flex-direction:column;height:100%}.card-header{justify-content:space-between;display:flex;padding-bottom:0}.card-header ha-icon-next{--mdc-icon-button-size:24px;line-height:24px;color:var(--primary-text-color)}.content{padding:16px;flex:1}.has-header{padding-top:0}statistics-chart{height:100%}.has-rows{--chart-max-height:100%}`,(0,n.Cg)([(0,c.MZ)({attribute:!1})],S.prototype,"hass",void 0),(0,n.Cg)([(0,c.wk)()],S.prototype,"_config",void 0),(0,n.Cg)([(0,c.wk)()],S.prototype,"_statistics",void 0),(0,n.Cg)([(0,c.wk)()],S.prototype,"_metadata",void 0),(0,n.Cg)([(0,c.wk)()],S.prototype,"_unit",void 0),(0,n.Cg)([(0,c.wk)()],S.prototype,"_energyStart",void 0),(0,n.Cg)([(0,c.wk)()],S.prototype,"_energyEnd",void 0),S=(0,n.Cg)([(0,c.EM)("hui-statistics-graph-card")],S),s()}catch(t){s(t)}})},56434(t,e,i){i.d(e,{e:()=>n});var s=i(81977);function n(t,e,i){return(0,s.P)(t,12*e,i)}},98487(t,e,i){i.d(e,{V:()=>r});var s=i(74816),n=i(95785);function a(t,e,i){const[n,a]=(0,s.x)(i?.in,t,e);return n.getFullYear()-a.getFullYear()}function r(t,e,i){const[r,o]=(0,s.x)(i?.in,t,e),c=(0,n.z)(r,o),h=Math.abs(a(r,o));r.setFullYear(1584),o.setFullYear(1584);const _=c*(h-+((0,n.z)(r,o)===-c));return 0===_?0:_}}};
//# sourceMappingURL=42568.53404d9d24bc9107.js.map