export const __rspack_esm_id="21742";export const __rspack_esm_ids=["21742"];export const __webpack_modules__={90433(t,e,i){i.d(e,{Vy:()=>r,fI:()=>n,ux:()=>a});var s=i(22786),o=i(79468);function r(t,e){const i=t%54+1;return e.getPropertyValue(`--color-${i}`)}function n(t,e){const i=e.getPropertyValue(`--graph-color-${t+1}`)||r(t,e);return(0,o.RQ)(i)}const a=(0,s.A)(t=>Array.from({length:54},(e,i)=>n(i,t)),(t,e)=>t[0].getPropertyValue("--graph-color-1")===e[0].getPropertyValue("--graph-color-1")&&t[0].getPropertyValue("--color-1")===e[0].getPropertyValue("--color-1"))},58548(t,e,i){i.d(e,{A:()=>o});const s=t=>{const e=parseFloat(t);if(isNaN(e))throw new Error(`${t} is not a number`);return e};function o(t){if(!t)return null;try{if(t.endsWith("%"))return{w:100,h:s(t.slice(0,-1))};const e=t.replace(":","x").split("x");return 0===e.length?null:1===e.length?{w:s(e[0]),h:1}:{w:s(e[0]),h:s(e[1])}}catch(t){}return null}},22845(t,e,i){i.a(t,async function(t,s){try{i.r(e),i.d(e,{DEFAULT_HOURS_TO_SHOW:()=>C,DEFAULT_ZOOM:()=>k});i(44114),i(18111),i(20116),i(7588),i(61701),i(17642),i(58004),i(33853),i(45876),i(32475),i(15024),i(31698);var o=i(62826),r=i(96196),n=i(44457),a=i(22786),h=i(90433),c=i(36312),_=i(71727),l=i(69093),u=i(28978),d=i(19459),g=i(58548),f=(i(38962),i(76776),i(26300),i(22273)),p=i(25064),m=i(13632),b=i(784),y=i(20939),w=t([f,p]);[f,p]=w.then?(await w)():w;const E="M16 12C16 10.9 16.9 10 18 10S20 10.9 20 12 19.1 14 18 14 16 13.1 16 12M10 12C10 10.9 10.9 10 12 10S14 10.9 14 12 13.1 14 12 14 10 13.1 10 12M4 12C4 10.9 4.9 10 6 10S8 10.9 8 12 7.1 14 6 14 4 13.1 4 12M13 18C13 16.9 13.9 16 15 16S17 16.9 17 18 16.1 20 15 20 13 19.1 13 18M7 18C7 16.9 7.9 16 9 16S11 16.9 11 18 10.1 20 9 20 7 19.1 7 18M13 6C13 4.9 13.9 4 15 4S17 4.9 17 6 16.1 8 15 8 13 7.1 13 6M7 6C7 4.9 7.9 4 9 4S11 4.9 11 6 10.1 8 9 8 7 7.1 7 6",M="M15,12C13.89,12 13,12.89 13,14A2,2 0 0,0 15,16A2,2 0 0,0 17,14C17,12.89 16.1,12 15,12M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M14,9C14,7.89 13.1,7 12,7C10.89,7 10,7.89 10,9A2,2 0 0,0 12,11A2,2 0 0,0 14,9M9,12A2,2 0 0,0 7,14A2,2 0 0,0 9,16A2,2 0 0,0 11,14C11,12.89 10.1,12 9,12Z",A="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M19,19H15V21H19A2,2 0 0,0 21,19V15H19M19,3H15V5H19V9H21V5A2,2 0 0,0 19,3M5,5H9V3H5A2,2 0 0,0 3,5V9H5M5,15H3V19A2,2 0 0,0 5,21H9V19H5V15Z",C=0,k=14;class v extends r.WF{_getAllEntities(){const t=this.hass,e=new Set,i=[];return Object.values(t.states).forEach(t=>{"latitude"in t.attributes&&"longitude"in t.attributes&&(i.push(t.entity_id),"person"===(0,l.t)(t)&&t.attributes.source&&e.add(t.attributes.source))}),i.filter(i=>!t.entities?.[i]?.hidden&&!e.has(i))}setConfig(t){if(!t)throw new Error("Error in card configuration.");if(!t.show_all&&!t.entities?.length&&!t.geo_location_sources)throw new Error("Either show_all, entities, or geo_location_sources must be specified");if(t.entities&&!Array.isArray(t.entities))throw new Error("Entities need to be an array");if(t.geo_location_sources&&!Array.isArray(t.geo_location_sources))throw new Error("Parameter geo_location_sources needs to be an array");if(t.show_all&&(t.entities||t.geo_location_sources))throw new Error("Cannot specify show_all and entities or geo_location_sources");this._config={...t},this.hass&&t.show_all&&(this._config.entities=this._getAllEntities()),this._configEntities=this._config.entities?(0,y.L)(this._config.entities):[],this._mapEntities=this._getMapEntities(),this._clusterMarkers=this._config.cluster??!0}getCardSize(){if(!this._config?.aspect_ratio)return 7;const t=(0,g.A)(this._config.aspect_ratio),e=t&&t.w>0&&t.h>0?`${(100*t.h/t.w).toFixed(2)}`:"100";return 1+Math.floor(Number(e)/25)||3}static async getConfigElement(){return await Promise.all([i.e("44533"),i.e("92769"),i.e("44966"),i.e("34326"),i.e("52242"),i.e("4939"),i.e("81913"),i.e("80445"),i.e("19656"),i.e("68257"),i.e("9975")]).then(i.bind(i,81846)),document.createElement("hui-map-card-editor")}static getStubConfig(t,e,i){return{type:"map",entities:(0,m.B)(t,2,e,i,["device_tracker"]),theme_mode:"auto"}}firstUpdated(){this._mapEntities=this._getMapEntities()}render(){if(!this._config)return r.s6;if(this._error)return r.qy`<ha-alert alert-type="error"> ${this.hass.localize("ui.components.map.error")}: ${this._error.message} (${this._error.code}) </ha-alert>`;const t=!(!this._config.dark_mode&&"dark"!==this._config.theme_mode)||"light"!==this._config.theme_mode&&this.hass.themes.darkMode,e=this._config.theme_mode||(this._config.dark_mode?"dark":"auto");return r.qy` <ha-card id="card" .header="${this._config.title}"> <div id="root"> <ha-map .hass="${this.hass}" .entities="${this._mapEntities}" .zoom="${this._config.default_zoom??k}" .paths="${this._getHistoryPaths(this._config,this._stateHistory)}" .autoFit="${this._config.auto_fit||!1}" .fitZones="${this._config.fit_zones||!1}" .themeMode="${e}" .clusterMarkers="${this._clusterMarkers}" interactive-zones render-passive></ha-map> <div id="buttons"> ${this._mapEntities.length>1?r.qy` <ha-icon-button .label="${this.hass.localize("ui.panel.lovelace.cards.map.toggle_grouping")}" .path="${this._clusterMarkers?M:E}" style="${t?"color:#ffffff":"color:#000000"}" @click="${this._toggleClusterMarkers}" tabindex="0"></ha-icon-button> `:r.s6} <ha-icon-button .label="${this.hass.localize("ui.panel.lovelace.cards.map.reset_focus")}" .path="${A}" style="${t?"color:#ffffff":"color:#000000"}" @click="${this._resetFocus}" tabindex="0"></ha-icon-button> </div> </div> </ha-card> `}shouldUpdate(t){if(!t.has("hass")||t.size>1)return!0;const e=t.get("hass");return!e||!this._configEntities||(e.themes.darkMode!==this.hass.themes.darkMode||(!!t.has("_stateHistory")||(!(!this._config?.geo_location_sources||e.states===this.hass.states)||(this._config?.entities?(0,b.pY)(this,t):(0,b.xP)(this,t)))))}willUpdate(t){super.willUpdate(t),this._config?.show_all&&!this._config?.entities&&this.hass&&t.has("hass")&&(this._config.entities=this._getAllEntities(),this._configEntities=(0,y.L)(this._config.entities),this._mapEntities=this._getMapEntities()),t.has("hass")&&this._config?.geo_location_sources&&!(0,d.b)(this._getSourceEntities(t.get("hass")?.states),this._getSourceEntities(this.hass.states))&&(this._mapEntities=this._getMapEntities())}connectedCallback(){super.connectedCallback(),this.hasUpdated&&this._configEntities?.length&&this._subscribeHistory()}disconnectedCallback(){super.disconnectedCallback(),this._unsubscribeHistory()}_subscribeHistory(){(0,c.x)(this.hass,"history")&&!this._subscribed&&(this._config?.hours_to_show??C)&&(this._subscribed=(0,p.IQ)(this.hass,t=>{this._subscribed&&(this._stateHistory=t)},this._config.hours_to_show??C,(this._configEntities||[]).map(t=>t.entity),!1,!1,!1).catch(t=>{this._subscribed=void 0,this._error=t}))}_unsubscribeHistory(){this._subscribed&&(this._subscribed.then(t=>t?.()),this._subscribed=void 0)}updated(t){this._configEntities?.length?this._subscribed&&!t.has("_config")||(this._unsubscribeHistory(),this._subscribeHistory()):this._unsubscribeHistory(),t.has("_config")&&this._computePadding()}_computePadding(){const t=this.shadowRoot.getElementById("root"),e="panel"===this.layout||"grid"===this.layout;if(!this._config||e||!t)return;if(!this._config.aspect_ratio)return void(t.style.paddingBottom="100%");t.style.height="auto";const i=(0,g.A)(this._config.aspect_ratio);t.style.paddingBottom=i&&i.w>0&&i.h>0?`${(100*i.h/i.w).toFixed(2)}%`:t.style.paddingBottom="100%"}_resetFocus(){this._map?.fitMap({unpause_autofit:!0})}_toggleClusterMarkers(){this._clusterMarkers=!this._clusterMarkers}_getColor(t){let e=this._colorDict[t];if(e)return e;const i=getComputedStyle(this);return e=(0,h.Vy)(this._colorIndex,i),this._colorIndex++,this._colorDict[t]=e,e}_getSourceEntities(t){if(!t||!this._config?.geo_location_sources)return[];const e=this._config.geo_location_sources.map(t=>"string"==typeof t?{source:t}:t),i=[],s=e.find(t=>"all"===t.source);for(const o of Object.values(t)){const t=e.find(t=>t.source===o.attributes.source);"geo_location"===(0,_.m)(o.entity_id)&&(s||t)&&i.push({entity_id:o.entity_id,label_mode:t?.label_mode??s?.label_mode,attribute:t?.attribute??s?.attribute,unit:t?.unit??s?.unit,focus:t?t.focus??!0:s?.focus??!0})}return i}_getMapEntities(){return[...(this._configEntities||[]).map(t=>({entity_id:t.entity,color:this._getColor(t.entity),label_mode:t.label_mode,attribute:t.attribute,unit:t.unit,focus:t.focus,name:t.name})),...this._getSourceEntities(this.hass?.states).map(t=>({...t,color:this._getColor(t.entity_id)}))]}getGridOptions(){return{columns:"full",rows:4,min_columns:6,min_rows:2}}constructor(...t){super(...t),this._mapEntities=[],this._colorDict={},this._colorIndex=0,this._clusterMarkers=!0,this._getHistoryPaths=(0,a.A)((t,e)=>{if(!e||!(t.hours_to_show??C))return;const i=[];for(const s of Object.keys(e)){if("zone"===(0,_.m)(s))continue;const o=e[s];if(!o?.length)continue;const r=[];for(const t of o){const e=t.a.latitude,i=t.a.longitude;if(!e||!i)continue;const s={};s.point=[e,i],s.timestamp=new Date(1e3*t.lu),r.push(s)}const n=this._configEntities?.find(t=>t.entity===s),a=n?.name??(s in this.hass.states?(0,u.u)(this.hass.states[s]):s);i.push({points:r,name:a,fullDatetime:(t.hours_to_show??C)>144,color:this._getColor(s),gradualOpacity:.8})}return i})}}v.styles=r.AH`ha-card{overflow:hidden;width:100%;height:100%;display:flex;flex-direction:column}ha-map{z-index:0;border:none;position:absolute;top:0;left:0;width:100%;height:100%;background:inherit;border-radius:var(--ha-card-border-radius,var(--ha-border-radius-lg));overflow:hidden}#buttons{position:absolute;top:75px;left:3px;display:flex;flex-direction:column}#root{position:relative;height:100%}`,(0,o.Cg)([(0,n.MZ)({attribute:!1})],v.prototype,"hass",void 0),(0,o.Cg)([(0,n.MZ)({attribute:!1})],v.prototype,"layout",void 0),(0,o.Cg)([(0,n.wk)()],v.prototype,"_stateHistory",void 0),(0,o.Cg)([(0,n.wk)()],v.prototype,"_config",void 0),(0,o.Cg)([(0,n.P)("ha-map")],v.prototype,"_map",void 0),(0,o.Cg)([(0,n.wk)()],v.prototype,"_mapEntities",void 0),(0,o.Cg)([(0,n.wk)()],v.prototype,"_error",void 0),(0,o.Cg)([(0,n.wk)()],v.prototype,"_clusterMarkers",void 0),v=(0,o.Cg)([(0,n.EM)("hui-map-card")],v),s()}catch(t){s(t)}})}};
//# sourceMappingURL=21742.d5ca753b8e0e3a15.js.map