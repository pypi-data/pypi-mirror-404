export const __rspack_esm_id="84435";export const __rspack_esm_ids=["84435"];export const __webpack_modules__={31157(t,s,e){e.a(t,async function(t,i){try{e.r(s),e.d(s,{HaNumberSelector:()=>u});var a=e(62826),o=e(96196),n=e(44457),h=e(94333),l=e(1087),r=(e(3449),e(70759)),c=(e(75709),t([r]));r=(c.then?(await c)():c)[0];class u extends o.WF{willUpdate(t){t.has("value")&&(""!==this._valueStr&&this.value===Number(this._valueStr)||(this._valueStr=null==this.value||isNaN(this.value)?"":this.value.toString()))}render(){const t="box"===this.selector.number?.mode||void 0===this.selector.number?.min||void 0===this.selector.number?.max;let s;if(!t&&(s=this.selector.number.step??1,"any"===s)){s=1;const t=(this.selector.number.max-this.selector.number.min)/100;for(;s>t;)s/=10}const e=this.selector.number?.translation_key;let i=this.selector.number?.unit_of_measurement;return t&&i&&this.localizeValue&&e&&(i=this.localizeValue(`${e}.unit_of_measurement.${i}`)||i),o.qy` ${this.label&&!t?o.qy`${this.label}${this.required?"*":""}`:o.s6} <div class="input"> ${t?o.s6:o.qy` <ha-slider labeled .min="${this.selector.number.min}" .max="${this.selector.number.max}" .value="${this.value}" .step="${s}" .disabled="${this.disabled}" .required="${this.required}" @change="${this._handleSliderChange}" .withMarkers="${this.selector.number?.slider_ticks||!1}"> </ha-slider> `} <ha-textfield .inputMode="${"any"===this.selector.number?.step||(this.selector.number?.step??1)%1!=0?"decimal":"numeric"}" .label="${t?this.label:void 0}" .placeholder="${this.placeholder}" class="${(0,h.H)({single:t})}" .min="${this.selector.number?.min}" .max="${this.selector.number?.max}" .value="${this._valueStr??""}" .step="${this.selector.number?.step??1}" helperPersistent .helper="${t?this.helper:void 0}" .disabled="${this.disabled}" .required="${this.required}" .suffix="${i}" type="number" autoValidate ?no-spinner="${!t}" @input="${this._handleInputChange}"> </ha-textfield> </div> ${!t&&this.helper?o.qy`<ha-input-helper-text .disabled="${this.disabled}">${this.helper}</ha-input-helper-text>`:o.s6} `}_handleInputChange(t){t.stopPropagation(),this._valueStr=t.target.value;const s=""===t.target.value||isNaN(t.target.value)?void 0:Number(t.target.value);this.value!==s&&(0,l.r)(this,"value-changed",{value:s})}_handleSliderChange(t){t.stopPropagation();const s=Number(t.target.value);this.value!==s&&(0,l.r)(this,"value-changed",{value:s})}constructor(...t){super(...t),this.required=!0,this.disabled=!1,this._valueStr=""}}u.styles=o.AH`.input{display:flex;justify-content:space-between;align-items:center;direction:ltr}ha-slider{flex:1;margin-right:16px;margin-inline-end:16px;margin-inline-start:0}ha-textfield{--ha-textfield-input-width:40px}.single{--ha-textfield-input-width:unset;flex:1}`,(0,a.Cg)([(0,n.MZ)({attribute:!1})],u.prototype,"hass",void 0),(0,a.Cg)([(0,n.MZ)({attribute:!1})],u.prototype,"selector",void 0),(0,a.Cg)([(0,n.MZ)({type:Number})],u.prototype,"value",void 0),(0,a.Cg)([(0,n.MZ)({type:Number})],u.prototype,"placeholder",void 0),(0,a.Cg)([(0,n.MZ)()],u.prototype,"label",void 0),(0,a.Cg)([(0,n.MZ)()],u.prototype,"helper",void 0),(0,a.Cg)([(0,n.MZ)({attribute:!1})],u.prototype,"localizeValue",void 0),(0,a.Cg)([(0,n.MZ)({type:Boolean})],u.prototype,"required",void 0),(0,a.Cg)([(0,n.MZ)({type:Boolean})],u.prototype,"disabled",void 0),u=(0,a.Cg)([(0,n.EM)("ha-selector-number")],u),i()}catch(t){i(t)}})},45950(t,s,e){e.a(t,async function(t,i){try{e.r(s),e.d(s,{DialogStatisticsFixUnsupportedUnitMetadata:()=>f});e(44114),e(18111),e(7588);var a=e(62826),o=e(76331),n=e(96196),h=e(44457),l=e(22786),r=e(95747),c=e(1087),u=e(65829),d=(e(72554),e(18350)),m=(e(52763),e(43661),e(28732),e(39045)),p=e(31157),_=(e(67094),e(23528)),g=e(65063),v=e(14503),b=e(81619),$=t([u,d,m,p,r]);[u,d,m,p,r]=$.then?(await $)():$;class f extends n.WF{showDialog(t){this._params=t;const s=new Date;s.setMinutes(s.getMinutes()-s.getMinutes()%5,0),this._moment=(0,o.s)(s),this._fetchStats()}closeDialog(){this._params=void 0,this._moment=void 0,this._stats5min=void 0,this._statsHour=void 0,this._origAmount=void 0,this._amount=void 0,this._chosenStat=void 0,this._busy=!1,(0,c.r)(this,"dialog-closed",{dialog:this.localName})}render(){if(!this._params)return n.s6;let t;return t=this._chosenStat?this._renderAdjustStat():this._renderPickStatistic(),n.qy` <ha-dialog open scrimClickAction escapeKeyAction @closed="${this.closeDialog}" .heading="${this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.title")}"> ${t} </ha-dialog> `}shouldUpdate(t){if(1!==t.size||!t.has("hass"))return!0;const s=t.get("hass");return!s||s.localize!==this.hass.localize}_renderPickStatistic(){let t;if(this._stats5min&&this._statsHour)if(this._statsHour.length<1&&this._stats5min.length<1)t=n.qy`<p> ${this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.no_statistics_found")} </p>`;else{const s=this._stats5min.length>=1?this._stats5min:this._statsHour,e=(0,_.JE)(this.hass,this._params.statistic.statistic_id,this._params.statistic),i=[];for(const t of s){const s=Math.round(100*t.change)/100;i.push(n.qy` <ha-list-item twoline hasMeta .stat="${t}" @click="${this._setChosenStatistic}"> <span>${s} ${e}</span> <span slot="secondary"> ${(0,r.r6)(new Date(t.start),this.hass.locale,this.hass.config)} </span> <ha-icon-next slot="meta"></ha-icon-next> </ha-list-item> `)}t=n.qy`${i}`}else t=n.qy`<ha-spinner></ha-spinner>`;return n.qy` <div class="text-content"> ${this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.info_text_1")} </div> <div class="text-content"> <b>${this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.statistic")}</b> ${this._params.statistic.statistic_id} </div> <ha-selector-datetime .label="${this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.pick_a_time")}" .hass="${this.hass}" .selector="${this._dateTimeSelector}" .value="${this._moment}" @value-changed="${this._dateTimeSelectorChanged}"></ha-selector-datetime> <div class="stat-list">${t}</div> <ha-button appearance="plain" slot="secondaryAction" @click="${this._fetchOutliers}"> ${this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.outliers")} </ha-button> <ha-button slot="primaryAction" dialogAction="cancel"> ${this.hass.localize("ui.common.close")} </ha-button> `}_clearChosenStatistic(){this._chosenStat=void 0}_setChosenStatistic(t){const s=t.currentTarget.stat,e=Math.round(100*s.change)/100;this._chosenStat=s,this._origAmount=e,this._amount=e}_dateTimeSelectorChanged(t){this._moment=t.detail.value,this._fetchStats()}_renderAdjustStat(){const t=(0,_.JE)(this.hass,this._params.statistic.statistic_id,this._params.statistic);return n.qy` <div class="text-content"> <b>${this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.statistic")}</b> ${this._params.statistic.statistic_id} </div> <div class="table-row"> <span>${this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.start")}</span> <span>${(0,r.r6)(new Date(this._chosenStat.start),this.hass.locale,this.hass.config)}</span> </div> <div class="table-row"> <span>${this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.end")}</span> <span>${(0,r.r6)(new Date(this._chosenStat.end),this.hass.locale,this.hass.config)}</span> </div> <ha-selector-number .label="${this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.new_value")}" .hass="${this.hass}" .selector="${this._amountSelector(t||void 0)}" .value="${this._amount}" .disabled="${this._busy}" @value-changed="${this._amountChanged}"></ha-selector-number> <ha-button slot="secondaryAction" .disabled="${this._busy}" @click="${this._clearChosenStatistic}" appearance="plain"> ${this.hass.localize("ui.common.back")}</ha-button> <ha-button slot="primaryAction" .disabled="${this._busy}" @click="${this._fixIssue}"> ${this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.adjust")}</ha-button> `}_amountChanged(t){this._amount=t.detail.value}async _fetchStats(){this._stats5min=void 0,this._statsHour=void 0;const t=this._params.statistic.statistic_id,s=new Date(this._moment.replace(" ","T")),e=new Date(s.getTime());e.setTime(e.getTime()-72e5);const i=new Date(s.getTime());i.setTime(i.getTime()+108e5);const a=await(0,_.sz)(this.hass,e,i,[t],"hour");if(this._statsHour=t in a?a[t].slice(0,5):[],0===this._statsHour.length)return void(this._stats5min=[]);const o=new Date(s.getTime());o.setTime(o.getTime()-6e5);const n=new Date(s.getTime());n.setTime(n.getTime()+9e5);const h=await(0,_.sz)(this.hass,o,n,[t],"5minute");this._stats5min=t in h?h[t].slice(0,5):[]}async _fetchOutliers(){this._stats5min=void 0,this._statsHour=void 0;const t=this._params.statistic.statistic_id,s=new Date(0),e=new Date,i=await(0,_.sz)(this.hass,s,e,[t],"hour"),a=t in i?i[t]:[];if(0===a.length)return;const o=await(0,_.sz)(this.hass,s,e,[t],"5minute"),n=t in o?o[t]:[];n.shift();const h=[];a.forEach(t=>{h.push({hour:t,fiveMin:[]})});const l={hour:null,fiveMin:[]};let r=0;n.forEach(t=>{let s=!1;for(;r<h.length;r++){const e=h[r].hour;if(e&&t.start>=e.start&&t.end<=e.end){h[r].fiveMin.push(t),s=!0;break}}s||l.fiveMin.push(t)}),h.push(l);let c=[],u=0;const d=t=>{const s=Math.abs(t.change??0);(c.length<10||s>u)&&(c.push(t),c=c.sort((t,s)=>Math.abs(s.change??0)-Math.abs(t.change??0)),c=c.slice(0,10),u=c[c.length-1].change??0)};h.forEach(t=>{0===t.fiveMin.length&&t.hour?d(t.hour):t.fiveMin.forEach(t=>{d(t)})}),this._statsHour=c,this._stats5min=[]}async _fixIssue(){const t=(0,_.JE)(this.hass,this._params.statistic.statistic_id,this._params.statistic);this._busy=!0;try{await(0,_.Uf)(this.hass,this._params.statistic.statistic_id,this._chosenStat.start,this._amount-this._origAmount,t||null)}catch(t){return this._busy=!1,void(0,g.showAlertDialog)(this,{text:this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.error_sum_adjusted",{message:t.message||t})})}(0,b.P)(this,{message:this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.sum_adjusted")}),this.closeDialog()}static get styles(){return[v.RF,v.nA,n.AH`@media all and (max-width:450px),all and (max-height:500px){ha-dialog{--mdc-dialog-max-height:100%;height:100%}}@media all and (min-width:850px){ha-dialog{--mdc-dialog-max-height:80%;--mdc-dialog-max-height:80%}}@media all and (min-width:451px) and (min-height:501px){ha-dialog{--mdc-dialog-max-width:480px}}.text-content,ha-selector-datetime,ha-selector-number{margin-bottom:var(--ha-space-5)}ha-list-item{margin:0 -24px;--mdc-list-side-padding:24px}.table-row{display:flex;justify-content:space-between;margin-bottom:var(--ha-space-5)}.stat-list{min-height:360px;display:flex;flex-direction:column}.stat-list ha-spinner{margin:0 auto}`]}constructor(...t){super(...t),this._busy=!1,this._dateTimeSelector={datetime:{}},this._amountSelector=(0,l.A)(t=>({number:{step:.01,unit_of_measurement:t,mode:"box"}}))}}(0,a.Cg)([(0,h.MZ)({attribute:!1})],f.prototype,"hass",void 0),(0,a.Cg)([(0,h.wk)()],f.prototype,"_params",void 0),(0,a.Cg)([(0,h.wk)()],f.prototype,"_busy",void 0),(0,a.Cg)([(0,h.wk)()],f.prototype,"_moment",void 0),(0,a.Cg)([(0,h.wk)()],f.prototype,"_stats5min",void 0),(0,a.Cg)([(0,h.wk)()],f.prototype,"_statsHour",void 0),(0,a.Cg)([(0,h.wk)()],f.prototype,"_chosenStat",void 0),(0,a.Cg)([(0,h.wk)()],f.prototype,"_amount",void 0),f=(0,a.Cg)([(0,h.EM)("dialog-statistics-adjust-sum")],f),i()}catch(t){i(t)}})},43332(t,s,e){function i(t,s){return(t<0?"-":"")+Math.abs(t).toString().padStart(s,"0")}e.d(s,{F:()=>i})},76331(t,s,e){e.d(s,{s:()=>n});var i=e(43332),a=e(94864),o=e(83504);function n(t,s){const e=(0,o.a)(t,s?.in);if(!(0,a.f)(e))throw new RangeError("Invalid time value");const n=s?.format??"extended",h=s?.representation??"complete";let l="";const r="extended"===n?"-":"",c="extended"===n?":":"";if("time"!==h){const t=(0,i.F)(e.getDate(),2),s=(0,i.F)(e.getMonth()+1,2);l=`${(0,i.F)(e.getFullYear(),4)}${r}${s}${r}${t}`}if("date"!==h){l=`${l}${""===l?"":" "}${(0,i.F)(e.getHours(),2)}${c}${(0,i.F)(e.getMinutes(),2)}${c}${(0,i.F)(e.getSeconds(),2)}`}return l}},94864(t,s,e){function i(t){return t instanceof Date||"object"==typeof t&&"[object Date]"===Object.prototype.toString.call(t)}e.d(s,{f:()=>o});var a=e(83504);function o(t){return!(!i(t)&&"number"!=typeof t||isNaN(+(0,a.a)(t)))}}};
//# sourceMappingURL=84435.802a0d98c59f298d.js.map