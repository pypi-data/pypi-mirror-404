export const __rspack_esm_id="91903";export const __rspack_esm_ids=["91903"];export const __webpack_modules__={23528(t,e,s){s.d(e,{$3:()=>g,$O:()=>w,$j:()=>m,ED:()=>r,JE:()=>C,OQ:()=>x,PU:()=>O,Ph:()=>p,Uf:()=>k,W1:()=>u,Wr:()=>c,Z:()=>l,gF:()=>f,iY:()=>y,jU:()=>n,nN:()=>b,p3:()=>h,pJ:()=>_,r_:()=>o,sz:()=>d});s(18111),s(13579);var i=s(28978),a=s(380),r=function(t){return t[t.NONE=0]="NONE",t[t.ARITHMETIC=1]="ARITHMETIC",t[t.CIRCULAR=2]="CIRCULAR",t}({});const n=["entity_not_recorded","entity_no_longer_recorded","state_class_removed","units_changed","mean_type_changed","no_state"],o=["L","gal","ft³","m³","CCF","MCF"],l=t=>t.sendMessagePromise({type:"recorder/info"}),h=(t,e)=>t.callWS({type:"recorder/list_statistic_ids",statistic_type:e}),c=(t,e)=>t.callWS({type:"recorder/get_statistics_metadata",statistic_ids:e}),d=(t,e,s,i,a="hour",r,n)=>t.callWS({type:"recorder/statistics_during_period",start_time:e.toISOString(),end_time:s?.toISOString(),statistic_ids:i,period:a,units:r,types:n}),_=(t,e,s,i)=>t.callWS({type:"recorder/statistic_during_period",statistic_id:e,units:i,fixed_period:s.fixed_period?{start_time:s.fixed_period.start instanceof Date?s.fixed_period.start.toISOString():s.fixed_period.start,end_time:s.fixed_period.end instanceof Date?s.fixed_period.end.toISOString():s.fixed_period.end}:void 0,calendar:s.calendar?{..."week"===s.calendar.period?{first_weekday:(0,a.D)(t.locale).substring(0,3)}:{},...s.calendar}:void 0,rolling_window:s.rolling_window}),p=t=>t.callWS({type:"recorder/validate_statistics"}),u=(t,e,s,i)=>t.callWS({type:"recorder/update_statistics_metadata",statistic_id:e,unit_of_measurement:s,unit_class:i}),g=(t,e)=>t.callWS({type:"recorder/clear_statistics",statistic_ids:e}),m=t=>{let e=null;if(!t)return null;for(const s of t)null!==s.change&&void 0!==s.change&&(null===e?e=s.change:e+=s.change);return e},f=(t,e)=>{let s=null;for(const i of e){if(!(i in t))continue;const e=m(t[i]);null!==e&&(null===s?s=e:s+=e)}return s},y=(t,e)=>t.some(t=>void 0!==t[e]&&null!==t[e]),v=["mean","min","max"],D=["sum","state","change"],b=(t,e)=>!(!v.includes(e)||0===t.mean_type)||!(!D.includes(e)||!t.has_sum),k=(t,e,s,i,a)=>{const r=new Date(s).toISOString();return t.callWS({type:"recorder/adjust_sum_statistics",statistic_id:e,start_time:r,adjustment:i,adjustment_unit_of_measurement:a})},w=(t,e,s)=>{const a=t.states[e];return a?(0,i.u)(a):s?.name||e},C=(t,e,s)=>{let i;return e&&(i=t.states[e]?.attributes.unit_of_measurement),void 0===i?s?.statistics_unit_of_measurement:i},x=t=>t.includes(":"),O=t=>t.callWS({type:"recorder/update_statistics_issues"})},56342(t,e,s){s.a(t,async function(t,i){try{s.r(e),s.d(e,{HuiEnergyDateSelectionCard:()=>c});var a=s(62826),r=s(96196),n=s(44457),o=(s(76776),s(784)),l=s(73887),h=t([l]);l=(h.then?(await h)():h)[0];class c extends r.WF{getCardSize(){return 1}getGridOptions(){return{rows:1,columns:12}}setConfig(t){this._config=t}shouldUpdate(t){return(0,o.xP)(this,t)||t.size>1||!t.has("hass")}render(){return this.hass&&this._config?r.qy` <ha-card> <div class="card-content"> <hui-energy-period-selector .hass="${this.hass}" .collectionKey="${this._config.collection_key}"></hui-energy-period-selector> </div> </ha-card> `:r.s6}}c.styles=r.AH`ha-card{height:100%;display:flex;flex-direction:column;justify-content:center}`,(0,a.Cg)([(0,n.MZ)({attribute:!1})],c.prototype,"hass",void 0),(0,a.Cg)([(0,n.wk)()],c.prototype,"_config",void 0),c=(0,a.Cg)([(0,n.EM)("hui-energy-date-selection-card")],c),i()}catch(t){i(t)}})},73887(t,e,s){s.a(t,async function(t,e){try{var i=s(62826),a=s(35932),r=s(73983),n=s(52640),o=s(69137),l=s(6946),h=s(55144),c=s(40600),d=s(78016),_=s(31810),p=s(49134),u=s(96196),g=s(44457),m=s(22786),f=s(94333),y=s(91069),v=s(380),D=s(72487),b=s(9899),k=(s(13416),s(18350)),w=(s(58349),s(15397)),C=(s(25440),s(45100),s(38114)),x=s(54706),O=s(46223),$=t([k,w,D,O,C,y]);[k,w,D,O,C,y]=$.then?(await $)():$;const S="M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z",z=["today","yesterday","this_week","this_month","this_quarter","this_year","now-7d","now-30d","now-12m"];class A extends((0,x.E)(u.WF)){hassSubscribe(){return[(0,C.tb)(this.hass,{key:this.collectionKey}).subscribe(t=>this._updateDates(t))]}_measure(){this.narrow=this.offsetWidth<450}async _attachObserver(){this._resizeObserver||(this._resizeObserver=new ResizeObserver((0,b.s)(()=>this._measure(),250,!1))),this._resizeObserver.observe(this)}firstUpdated(){this._attachObserver()}connectedCallback(){super.connectedCallback(),this.updateComplete.then(()=>this._attachObserver())}disconnectedCallback(){super.disconnectedCallback(),this._resizeObserver&&this._resizeObserver.disconnect()}willUpdate(t){super.willUpdate(t),this.hasUpdated||this._measure(),(!this.hasUpdated||t.has("hass")&&this.hass?.localize!==t.get("hass")?.localize)&&(this._ranges={},z.forEach(t=>{this._ranges[this.hass.localize(`ui.components.date-range-picker.ranges.${t}`)]=(0,O.b)(this.hass,t)}))}render(){if(!this.hass||!this._startDate)return u.s6;const t=this._simpleRange(this._startDate,this._endDate,this.hass.locale,this.hass.config);return u.qy` <div class="${(0,f.H)({row:!0,"datepicker-open":this._datepickerOpen})}"> <div class="backdrop"></div> <div class="label"> ${"day"===t?this.narrow?(0,D.kz)(this._startDate,this.hass.locale,this.hass.config):(0,D.Yq)(this._startDate,this.hass.locale,this.hass.config):"month"===t?(0,D.fr)(this._startDate,this.hass.locale,this.hass.config):"year"===t?(0,D.Pm)(this._startDate,this.hass.locale,this.hass.config):`${(0,D.sl)(this._startDate,this.hass.locale,this.hass.config)} – ${(0,D.sl)(this._endDate||new Date,this.hass.locale,this.hass.config)}`} </div> <div class="time-handle"> <ha-icon-button-prev .label="${this.hass.localize("ui.panel.lovelace.components.energy_period_selector.previous")}" @click="${this._pickPrevious}"></ha-icon-button-prev> <ha-icon-button-next .label="${this.hass.localize("ui.panel.lovelace.components.energy_period_selector.next")}" @click="${this._pickNext}"></ha-icon-button-next> <ha-date-range-picker .hass="${this.hass}" .startDate="${this._startDate}" .endDate="${this._endDate||new Date}" .ranges="${this._ranges}" @value-changed="${this._dateRangeChanged}" @preset-selected="${this._presetSelected}" @toggle="${this._handleDatepickerToggle}" minimal header-position .verticalOpeningDirection="${this.verticalOpeningDirection}"></ha-date-range-picker> </div> ${this.narrow?u.s6:u.qy`<ha-button appearance="filled" size="small" @click="${this._pickNow}"> ${this.hass.localize("ui.panel.lovelace.components.energy_period_selector.now")} </ha-button>`} <ha-button-menu> <ha-icon-button slot="trigger" .label="${this.hass.localize("ui.common.menu")}" .path="${S}"></ha-icon-button> ${this.allowCompare?u.qy`<ha-check-list-item left @request-selected="${this._toggleCompare}" .selected="${this._compare}"> ${this.hass.localize("ui.panel.lovelace.components.energy_period_selector.compare")} </ha-check-list-item>`:u.s6} <slot name="overflow-menu"></slot> </ha-button-menu> </div> `}_updateCollectionPeriod(){const t=(0,C.tb)(this.hass,{key:this.collectionKey});t.setPeriod(this._startDate,this._endDate),t.refresh()}_dateRangeChanged(t){this._startDate=(0,y.ol)(t.detail.value.startDate,a.o,this.hass.locale,this.hass.config),this._endDate=(0,y.ol)(t.detail.value.endDate,r.D,this.hass.locale,this.hass.config),this._updateCollectionPeriod()}_presetSelected(t){localStorage.setItem(`energy-default-period-_${this.collectionKey||"energy"}`,z[t.detail.index])}_pickNow(){if(!this._startDate)return;const t=this._simpleRange(this._startDate,this._endDate,this.hass.locale,this.hass.config),e=new Date;if("month"===t)[this._startDate,this._endDate]=(0,O.b)(this.hass,"this_month");else if("quarter"===t)[this._startDate,this._endDate]=(0,O.b)(this.hass,"this_quarter");else if("year"===t)[this._startDate,this._endDate]=(0,O.b)(this.hass,"this_year");else{const t=(0,v.P)(this.hass.locale),s=(0,y.ol)(this._endDate,n.k,this.hass.locale,this.hass.config,{weekStartsOn:t}),i=(0,y.ol)(this._endDate,o.$,this.hass.locale,this.hass.config,{weekStartsOn:t});if(this._startDate.getTime()===s.getTime()&&this._endDate.getTime()===i.getTime())[this._startDate,this._endDate]=(0,O.b)(this.hass,"this_week");else{const s=(0,y.EO)(this._endDate,this._startDate,l.c,this.hass.locale,this.hass.config);this._startDate=(0,y.ol)((0,y.ol)(e,h.e,this.hass.locale,this.hass.config,s),a.o,this.hass.locale,this.hass.config,{weekStartsOn:t}),this._endDate=(0,y.ol)(e,r.D,this.hass.locale,this.hass.config,{weekStartsOn:t})}}this._updateCollectionPeriod()}_pickPrevious(){this._shift(!1)}_pickNext(){this._shift(!0)}_shift(t){if(!this._startDate)return;const{start:e,end:s}=(0,y.eE)(this._startDate,this._endDate,t,this.hass.locale,this.hass.config);this._startDate=e,this._endDate=s,this._updateCollectionPeriod()}_updateDates(t){this._compare=void 0!==t.startCompare,this._startDate=t.start,this._endDate=t.end||(0,c.o)()}_handleDatepickerToggle(t){this._datepickerOpen=t.detail.open}_toggleCompare(t){if("interaction"!==t.detail.source)return;this._compare=t.detail.selected;const e=(0,C.tb)(this.hass,{key:this.collectionKey});e.setCompare(this._compare?C.lh.PREVIOUS:C.lh.NONE),e.refresh()}constructor(...t){super(...t),this.allowCompare=!0,this._datepickerOpen=!1,this._ranges={},this._compare=!1,this._simpleRange=(0,m.A)((t,e,s,i)=>{if(0===(0,l.c)(e,t))return"day";if((0,y.xo)(t,d.e,s,i)&&(0,y.xo)(e,_.c,s,i)){if(0===(0,y.EO)(e,t,p.W,s,i))return"month";if(2===(0,y.EO)(e,t,p.W,s,i)&&t.getMonth()%3==0)return"quarter"}return(0,y.xo)(t,d.e,s,i)&&(0,y.xo)(e,_.c,s,i)&&11===(0,y.EO)(e,t,p.W,s,i)?"year":"other"})}}A.styles=u.AH`.row{display:flex;align-items:center}:host .time-handle{display:flex;justify-content:flex-end;align-items:center}:host([narrow]) .time-handle{margin-left:auto;margin-inline-start:auto;margin-inline-end:initial}.label{display:flex;align-items:center;justify-content:flex-end;font-size:var(--ha-font-size-xl);margin-left:auto;margin-inline-start:auto;margin-inline-end:initial}:host([narrow]) .label{margin-left:unset;margin-inline-start:unset;margin-inline-end:initial}ha-button{margin-left:8px;margin-inline-start:8px;margin-inline-end:initial;flex-shrink:0;--ha-button-theme-color:currentColor}.backdrop{position:fixed;top:0;left:0;right:0;bottom:0;z-index:var(--dialog-z-index,8);-webkit-backdrop-filter:var(--ha-dialog-scrim-backdrop-filter,var(--dialog-backdrop-filter));backdrop-filter:var(--ha-dialog-scrim-backdrop-filter,var(--dialog-backdrop-filter));pointer-events:none;opacity:0;transition:opacity var(--ha-animation-base-duration) ease-in-out}.datepicker-open .backdrop{opacity:1;pointer-events:auto}`,(0,i.Cg)([(0,g.MZ)({attribute:!1})],A.prototype,"hass",void 0),(0,i.Cg)([(0,g.MZ)({attribute:"collection-key"})],A.prototype,"collectionKey",void 0),(0,i.Cg)([(0,g.MZ)({type:Boolean,reflect:!0})],A.prototype,"narrow",void 0),(0,i.Cg)([(0,g.MZ)({type:Boolean,attribute:"allow-compare"})],A.prototype,"allowCompare",void 0),(0,i.Cg)([(0,g.MZ)({attribute:"vertical-opening-direction"})],A.prototype,"verticalOpeningDirection",void 0),(0,i.Cg)([(0,g.wk)()],A.prototype,"_datepickerOpen",void 0),(0,i.Cg)([(0,g.wk)()],A.prototype,"_startDate",void 0),(0,i.Cg)([(0,g.wk)()],A.prototype,"_endDate",void 0),(0,i.Cg)([(0,g.wk)()],A.prototype,"_ranges",void 0),(0,i.Cg)([(0,g.wk)()],A.prototype,"_compare",void 0),A=(0,i.Cg)([(0,g.EM)("hui-energy-period-selector")],A),e()}catch(t){e(t)}})},56434(t,e,s){s.d(e,{e:()=>a});var i=s(81977);function a(t,e,s){return(0,i.P)(t,12*e,s)}},40600(t,e,s){s.d(e,{o:()=>a});var i=s(73983);function a(t){return(0,i.D)(Date.now(),t)}}};
//# sourceMappingURL=91903.35a64c435a3d1131.js.map