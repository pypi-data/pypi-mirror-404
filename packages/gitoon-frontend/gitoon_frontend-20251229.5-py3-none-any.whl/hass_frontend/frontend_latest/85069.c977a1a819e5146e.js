export const __rspack_esm_id="85069";export const __rspack_esm_ids=["85069"];export const __webpack_modules__={41436(e,a,t){t.a(e,async function(e,s){try{t.r(a);t(44114),t(18111),t(22489),t(7588),t(18237);var r=t(62826),o=t(96196),i=t(44457),l=t(94333),n=(t(76776),t(67094),t(38114)),c=t(23528),h=t(54706),u=t(3609),_=t(90433),d=t(20058),p=t(28455),g=t(48949),f=e([u,n,d]);[u,n,d]=f.then?(await f)():f;const v={group_by_floor:!0,group_by_area:!0};class y extends((0,h.E)((0,g.Q)(o.WF))){setConfig(e){this._config={...v,...e}}hassSubscribe(){return[(0,n.tb)(this.hass,{key:this._config?.collection_key}).subscribe(e=>{this._data=e})]}getCardSize(){return 5}getGridOptions(){return{columns:12,min_columns:6,rows:6,min_rows:2}}shouldUpdate(e){return e.has("_config")||e.has("_data")||e.has("_isMobileSize")}render(){if(!this._config)return o.s6;if(!this._data)return o.qy`${this.hass.localize("ui.panel.lovelace.cards.energy.loading")}`;const e=this._data.prefs,a=e.energy_sources.filter(e=>"water"===e.type),t=getComputedStyle(this),s=[],r=[],i=e.device_consumption_water.reduce((e,a)=>e+(a.stat_consumption in this._data.stats&&(0,c.$j)(this._data.stats[a.stat_consumption])||0),0),n=a.reduce((e,a)=>e+(a.stat_energy_from in this._data.stats&&(0,c.$j)(this._data.stats[a.stat_energy_from])||0),0),h=Math.max(i,n),u={id:"home",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.home"),value:Math.max(0,h),color:t.getPropertyValue("--primary-color").trim(),index:1};s.push(u);const d=t.getPropertyValue("--energy-water-color").trim();a.forEach(e=>{if("water"!==e.type)return;const a=e.stat_energy_from in this._data.stats&&(0,c.$j)(this._data.stats[e.stat_energy_from])||0;a<.01||(s.push({id:e.stat_energy_from,label:(0,c.$O)(this.hass,e.stat_energy_from,this._data.statsMetadata[e.stat_energy_from]),value:a,color:d,index:0}),r.push({source:e.stat_energy_from,target:"home",value:a}))});let p=u.value;const g=[],f={};e.device_consumption_water.forEach((e,a)=>{const s=e.stat_consumption in this._data.stats&&(0,c.$j)(this._data.stats[e.stat_consumption])||0;if(s<.01)return;const o={id:e.stat_consumption,label:e.name||(0,c.$O)(this.hass,e.stat_consumption,this._data.statsMetadata[e.stat_consumption]),value:s,color:(0,_.fI)(a,t),index:4,parent:e.included_in_stat};o.parent?(f[o.id]=o.parent,r.push({source:o.parent,target:o.id})):p-=s,g.push(o)});const v=g.filter(e=>!f[e.id]),{group_by_area:y,group_by_floor:m}=this._config;if(y||m){const{areas:e,floors:a}=this._groupByFloorAndArea(v);Object.keys(a).sort((e,a)=>(this.hass.floors[a]?.level??-1/0)-(this.hass.floors[e]?.level??-1/0)).forEach(o=>{let i=`floor_${o}`;"no_floor"!==o&&m?(s.push({id:i,label:this.hass.floors[o].name,value:a[o].value,index:2,color:t.getPropertyValue("--primary-color").trim()}),r.push({source:"home",target:i})):i="home",a[o].areas.forEach(a=>{let o;if("no_area"!==a&&y){const l=`area_${a}`;s.push({id:l,label:this.hass.areas[a].name,value:e[a].value,index:3,color:t.getPropertyValue("--primary-color").trim()}),r.push({source:i,target:l,value:e[a].value}),o=l}else o=i;e[a].devices.forEach(e=>{r.push({source:o,target:e.id,value:e.value})})})})}else v.forEach(e=>{r.push({source:"home",target:e.id,value:e.value})});const b=this._getDeviceSections(f,g);b.forEach((e,a)=>{e.forEach(e=>{s.push({...e,index:4+a})})}),p>0&&(s.push({id:"untracked",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked_consumption"),value:p,color:t.getPropertyValue("--state-unavailable-color").trim(),index:3+b.length}),r.push({source:"home",target:"untracked",value:p}));const x=s.some(e=>e.value>0),$="vertical"===this._config.layout||"horizontal"!==this._config.layout&&this._isMobileSize;return o.qy` <ha-card .header="${this._config.title}" class="${(0,l.H)({"is-grid":"grid"===this.layout,"is-panel":"panel"===this.layout,"is-vertical":$})}"> <div class="card-content"> ${x?o.qy`<ha-sankey-chart .data="${{nodes:s,links:r}}" .vertical="${$}" .valueFormatter="${this._valueFormatter}"></ha-sankey-chart>`:o.qy`${this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period")}`} </div> </ha-card> `}_groupByFloorAndArea(e){const a={no_area:{value:0,devices:[]}},t={no_floor:{value:0,areas:["no_area"]}};return e.forEach(e=>{const s=this.hass.states[e.id],{area:r,floor:o}=s?(0,p.l)(s,this.hass.entities,this.hass.devices,this.hass.areas,this.hass.floors):{area:null,floor:null};r?(r.area_id in a?(a[r.area_id].value+=e.value,a[r.area_id].devices.push(e)):a[r.area_id]={value:e.value,devices:[e]},o?o.floor_id in t?(t[o.floor_id].value+=e.value,t[o.floor_id].areas.includes(r.area_id)||t[o.floor_id].areas.push(r.area_id)):t[o.floor_id]={value:e.value,areas:[r.area_id]}:(t.no_floor.value+=e.value,t.no_floor.areas.includes(r.area_id)||t.no_floor.areas.unshift(r.area_id))):(a.no_area.value+=e.value,a.no_area.devices.push(e))}),{areas:a,floors:t}}_getDeviceSections(e,a){const t=[],s=[],r=Object.values(e),o={};return a.forEach(a=>{const o=a.id in e;r.includes(a.id)&&!o?t.push(a):s.push(a)}),Object.entries(e).forEach(([e,a])=>{t.some(e=>e.id===a)||(o[e]=a)}),t.length>0?[t,...this._getDeviceSections(o,s)]:[a]}constructor(...e){super(...e),this.hassSubscribeRequiredHostProps=["_config"],this._valueFormatter=e=>`${(0,d.ZV)(e,this.hass.locale,e<.1?{maximumFractionDigits:3}:void 0)} ${this._data.waterUnit}`}}y.styles=o.AH`ha-card{height:400px;display:flex;flex-direction:column;--chart-max-height:none}ha-card.is-vertical{height:500px}ha-card.is-grid,ha-card.is-panel{height:100%}.card-content{flex:1;display:flex}`,(0,r.Cg)([(0,i.MZ)({attribute:!1})],y.prototype,"hass",void 0),(0,r.Cg)([(0,i.MZ)({attribute:!1})],y.prototype,"layout",void 0),(0,r.Cg)([(0,i.wk)()],y.prototype,"_config",void 0),(0,r.Cg)([(0,i.wk)()],y.prototype,"_data",void 0),y=(0,r.Cg)([(0,i.EM)("hui-water-sankey-card")],y),s()}catch(e){s(e)}})}};
//# sourceMappingURL=85069.c977a1a819e5146e.js.map