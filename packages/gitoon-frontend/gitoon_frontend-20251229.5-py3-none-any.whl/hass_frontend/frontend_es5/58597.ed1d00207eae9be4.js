"use strict";(self.webpackChunkgitoon_frontend=self.webpackChunkgitoon_frontend||[]).push([["58597"],{31396:function(e,a,t){t.a(e,async function(e,r){try{t.r(a);var o,i,l,s,n,u=t(7739),c=t(78261),d=t(72153),h=t(44734),v=t(43080),_=t(69683),g=t(6454),p=(t(28706),t(2008),t(74423),t(44114),t(26910),t(13609),t(18111),t(7588),t(69085),t(5506),t(79432),t(26099),t(16034),t(21699),t(42762),t(23500),t(40445)),y=t(96196),f=t(77845),b=t(94333),m=(t(76776),t(67094),t(38114)),k=t(23528),x=t(54706),A=t(3609),z=t(90433),E=t(20058),C=t(28455),P=t(48949),S=e([A,E,m,k]);[A,E,m,k]=S.then?(await S)():S;var V={group_by_floor:!0,group_by_area:!0},w=function(e){function a(){var e;(0,h.A)(this,a);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return(e=(0,_.A)(this,a,[].concat(r))).hassSubscribeRequiredHostProps=["_config"],e._valueFormatter=function(a){return'<div style="direction:ltr; display: inline;">\n      '.concat((0,E.ZV)(a,e.hass.locale,a<.1?{maximumFractionDigits:3}:void 0),"\n      kWh</div>")},e}return(0,g.A)(a,e),(0,v.A)(a,[{key:"setConfig",value:function(e){this._config=Object.assign(Object.assign({},V),e)}},{key:"hassSubscribe",value:function(){var e,a=this;return[(0,m.tb)(this.hass,{key:null===(e=this._config)||void 0===e?void 0:e.collection_key}).subscribe(function(e){a._data=e})]}},{key:"getCardSize",value:function(){return 5}},{key:"getGridOptions",value:function(){return{columns:12,min_columns:6,rows:6,min_rows:2}}},{key:"shouldUpdate",value:function(e){return e.has("_config")||e.has("_data")||e.has("_isMobileSize")}},{key:"render",value:function(){var e=this;if(!this._config)return y.s6;if(!this._data)return(0,y.qy)(o||(o=(0,d.A)(["",""])),this.hass.localize("ui.panel.lovelace.cards.energy.loading"));var a=this._data.prefs,t=(0,m.E$)(a),r=(0,m.gv)(this._data),n=r.summedData,u=(r.compareSummedData,(0,m.DR)(n,void 0)),c=u.consumption,h=(u.compareConsumption,getComputedStyle(this)),v=[],_=[],g={id:"home",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.home"),value:Math.max(0,c.total.used_total),color:h.getPropertyValue("--primary-color").trim(),index:1};if(v.push(g),t.battery){var p,f,x=null!==(p=n.total.from_battery)&&void 0!==p?p:0,A=null!==(f=n.total.to_battery)&&void 0!==f?f:0;v.push({id:"battery",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.battery"),value:x,color:h.getPropertyValue("--energy-battery-out-color").trim(),index:0}),_.push({source:"battery",target:"home",value:c.total.used_battery}),v.push({id:"battery_in",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.battery"),value:A,color:h.getPropertyValue("--energy-battery-in-color").trim(),index:1}),c.total.grid_to_battery>0&&_.push({source:"grid",target:"battery_in",value:c.total.grid_to_battery}),c.total.solar_to_battery>0&&_.push({source:"solar",target:"battery_in",value:c.total.solar_to_battery})}if(t.grid){var E,C=null!==(E=n.total.from_grid)&&void 0!==E?E:0;v.push({id:"grid",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.grid"),value:C,color:h.getPropertyValue("--energy-grid-consumption-color").trim(),index:0}),_.push({source:"grid",target:"home",value:c.total.used_grid})}if(t.solar){var P,S=null!==(P=n.total.solar)&&void 0!==P?P:0;v.push({id:"solar",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.solar"),value:S,color:h.getPropertyValue("--energy-solar-color").trim(),index:0}),_.push({source:"solar",target:"home",value:c.total.used_solar})}if(t.grid&&t.grid[0].flow_to){var V,w=null!==(V=n.total.to_grid)&&void 0!==V?V:0;v.push({id:"grid_return",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.grid"),value:w,color:h.getPropertyValue("--energy-grid-return-color").trim(),index:1}),c.total.battery_to_grid>0&&_.push({source:"battery",target:"grid_return",value:c.total.battery_to_grid}),c.total.solar_to_grid>0&&_.push({source:"solar",target:"grid_return",value:c.total.solar_to_grid})}var O=g.value,j=[],D={};a.device_consumption.forEach(function(a,t){var r=a.stat_consumption in e._data.stats&&(0,k.$j)(e._data.stats[a.stat_consumption])||0;if(!(r<.01)){var o={id:a.stat_consumption,label:a.name||(0,k.$O)(e.hass,a.stat_consumption,e._data.statsMetadata[a.stat_consumption]),value:r,color:(0,z.fI)(t,h),index:4,parent:a.included_in_stat};o.parent?(D[o.id]=o.parent,_.push({source:o.parent,target:o.id})):O-=r,j.push(o)}});var F=j.filter(function(e){return!D[e.id]}),M=this._config,q=M.group_by_area,H=M.group_by_floor;if(q||H){var Z=this._groupByFloorAndArea(F),$=Z.areas,B=Z.floors;Object.keys(B).sort(function(a,t){var r,o,i,l;return(null!==(r=null===(o=e.hass.floors[t])||void 0===o?void 0:o.level)&&void 0!==r?r:-1/0)-(null!==(i=null===(l=e.hass.floors[a])||void 0===l?void 0:l.level)&&void 0!==i?i:-1/0)}).forEach(function(a){var t="floor_".concat(a);"no_floor"!==a&&H?(v.push({id:t,label:e.hass.floors[a].name,value:B[a].value,index:2,color:h.getPropertyValue("--primary-color").trim()}),_.push({source:"home",target:t})):t="home",B[a].areas.forEach(function(a){var r;if("no_area"!==a&&q){var o="area_".concat(a);v.push({id:o,label:e.hass.areas[a].name,value:$[a].value,index:3,color:h.getPropertyValue("--primary-color").trim()}),_.push({source:t,target:o,value:$[a].value}),r=o}else r=t;$[a].devices.forEach(function(e){_.push({source:r,target:e.id,value:e.value})})})})}else F.forEach(function(e){_.push({source:"home",target:e.id,value:e.value})});var R=this._getDeviceSections(D,j);R.forEach(function(e,a){e.forEach(function(e){v.push(Object.assign(Object.assign({},e),{},{index:4+a}))})}),O>0&&(v.push({id:"untracked",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked_consumption"),value:O,color:h.getPropertyValue("--state-unavailable-color").trim(),index:3+R.length}),_.push({source:"home",target:"untracked",value:O}));var W=v.some(function(e){return e.value>0}),G="vertical"===this._config.layout||"horizontal"!==this._config.layout&&this._isMobileSize;return(0,y.qy)(i||(i=(0,d.A)([' <ha-card .header="','" class="','"> <div class="card-content"> '," </div> </ha-card> "])),this._config.title,(0,b.H)({"is-grid":"grid"===this.layout,"is-panel":"panel"===this.layout,"is-vertical":G}),W?(0,y.qy)(l||(l=(0,d.A)(['<ha-sankey-chart .data="','" .vertical="','" .valueFormatter="','"></ha-sankey-chart>'])),{nodes:v,links:_},G,this._valueFormatter):(0,y.qy)(s||(s=(0,d.A)(["",""])),this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period")))}},{key:"_groupByFloorAndArea",value:function(e){var a=this,t={no_area:{value:0,devices:[]}},r={no_floor:{value:0,areas:["no_area"]}};return e.forEach(function(e){var o=a.hass.states[e.id],i=o?(0,C.l)(o,a.hass.entities,a.hass.devices,a.hass.areas,a.hass.floors):{area:null,floor:null},l=i.area,s=i.floor;l?(l.area_id in t?(t[l.area_id].value+=e.value,t[l.area_id].devices.push(e)):t[l.area_id]={value:e.value,devices:[e]},s?s.floor_id in r?(r[s.floor_id].value+=e.value,r[s.floor_id].areas.includes(l.area_id)||r[s.floor_id].areas.push(l.area_id)):r[s.floor_id]={value:e.value,areas:[l.area_id]}:(r.no_floor.value+=e.value,r.no_floor.areas.includes(l.area_id)||r.no_floor.areas.unshift(l.area_id))):(t.no_area.value+=e.value,t.no_area.devices.push(e))}),{areas:t,floors:r}}},{key:"_getDeviceSections",value:function(e,a){var t=[],r=[],o=Object.values(e),i={};return a.forEach(function(a){var i=a.id in e;o.includes(a.id)&&!i?t.push(a):r.push(a)}),Object.entries(e).forEach(function(e){var a=(0,c.A)(e,2),r=a[0],o=a[1];t.some(function(e){return e.id===o})||(i[r]=o)}),t.length>0?[t].concat((0,u.A)(this._getDeviceSections(i,r))):[a]}}])}((0,x.E)((0,P.Q)(y.WF)));w.styles=(0,y.AH)(n||(n=(0,d.A)(["ha-card{height:400px;display:flex;flex-direction:column;--chart-max-height:none}ha-card.is-vertical{height:500px}ha-card.is-grid,ha-card.is-panel{height:100%}.card-content{flex:1;display:flex}"]))),(0,p.Cg)([(0,f.MZ)({attribute:!1})],w.prototype,"hass",void 0),(0,p.Cg)([(0,f.MZ)({attribute:!1})],w.prototype,"layout",void 0),(0,p.Cg)([(0,f.wk)()],w.prototype,"_config",void 0),(0,p.Cg)([(0,f.wk)()],w.prototype,"_data",void 0),w=(0,p.Cg)([(0,f.EM)("hui-energy-sankey-card")],w),r()}catch(O){r(O)}})}}]);
//# sourceMappingURL=58597.ed1d00207eae9be4.js.map