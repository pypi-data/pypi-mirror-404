"use strict";(self.webpackChunkgitoon_frontend=self.webpackChunkgitoon_frontend||[]).push([["99143"],{58548:function(t,e,i){i.d(e,{A:function(){return s}});i(16280),i(34782),i(27495),i(99449),i(25440);var a=function(t){var e=parseFloat(t);if(isNaN(e))throw new Error("".concat(t," is not a number"));return e};function s(t){if(!t)return null;try{if(t.endsWith("%"))return{w:100,h:a(t.slice(0,-1))};var e=t.replace(":","x").split("x");return 0===e.length?null:1===e.length?{w:a(e[0]),h:1}:{w:a(e[0]),h:a(e[1])}}catch(i){}return null}},55148:function(t,e,i){var a,s,n,r,o,c,h,d,l=i(61397),u=i(50264),p=i(72153),v=i(44734),_=i(43080),g=i(69683),m=i(6454),y=i(25460),f=(i(28706),i(40445)),b=i(96196),C=i(77845),k=i(4937),I=i(6415),w=i(22786),S=i(28978),A=i(82286),M=i(10897),U=(i(92639),i(74423),i(44114),i(18111),i(7588),i(26099),i(23500),i(32288)),O=i(1087),E=(i(38962),function(t){function e(){var t;(0,v.A)(this,e);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return(t=(0,g.A)(this,e,[].concat(a))).controls=!1,t.muted=!1,t.autoPlay=!1,t.playsInline=!1,t._candidatesList=[],t._handleVisibilityChange=function(){document.pictureInPictureElement||(document.hidden?t._cleanUp():t._startWebRtc())},t._startNegotiation=(0,u.A)((0,l.A)().m(function e(){var i,a,s,n,r;return(0,l.A)().w(function(e){for(;;)switch(e.n){case 0:if(t._peerConnection){e.n=1;break}return e.a(2);case 1:return i={offerToReceiveAudio:!0,offerToReceiveVideo:!0},t._logEvent("start createOffer",i),e.n=2,t._peerConnection.createOffer(i);case 2:if(a=e.v,t._peerConnection){e.n=3;break}return e.a(2);case 3:return t._logEvent("end createOffer",a),t._logEvent("start setLocalDescription"),e.n=4,t._peerConnection.setLocalDescription(a);case 4:if(t._peerConnection&&t.entityid){e.n=5;break}return e.a(2);case 5:for(t._logEvent("end setLocalDescription"),s="";t._candidatesList.length;)(n=t._candidatesList.pop())&&(s+="a=".concat(n,"\r\n"));r=a.sdp+s,t._logEvent("start webRtcOffer",r);try{t._unsub=(0,M.w8)(t.hass,t.entityid,r,function(e){return t._handleOfferEvent(e)})}catch(o){t._error="Failed to start WebRTC stream: "+o.message,t._cleanUp()}case 6:return e.a(2)}},e)})),t._iceConnectionStateChanged=function(){var e,i;t._logEvent("ice connection state change",null===(e=t._peerConnection)||void 0===e?void 0:e.iceConnectionState),"failed"===(null===(i=t._peerConnection)||void 0===i?void 0:i.iceConnectionState)&&t._peerConnection.restartIce()},t._handleIceCandidate=function(e){var i,a,s;t.entityid&&null!==(i=e.candidate)&&void 0!==i&&i.candidate&&(t._logEvent("local ice candidate",null===(a=e.candidate)||void 0===a?void 0:a.candidate,null===(s=e.candidate)||void 0===s?void 0:s.sdpMLineIndex),t._sessionId?(0,M.UC)(t.hass,t.entityid,t._sessionId,e.candidate.toJSON()):t._candidatesList.push(e.candidate))},t._addTrack=function(){var e=(0,u.A)((0,l.A)().m(function e(i){return(0,l.A)().w(function(e){for(;;)switch(e.n){case 0:if(t._remoteStream){e.n=1;break}return e.a(2);case 1:if("audio"!==i.track.kind||!t.muted){e.n=2;break}return e.a(2);case 2:if(t._remoteStream.addTrack(i.track),t.hasUpdated){e.n=3;break}return e.n=3,t.updateComplete;case 3:t._videoEl.srcObject=t._remoteStream;case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),t}return(0,m.A)(e,t),(0,_.A)(e,[{key:"render",value:function(){return this._error?(0,b.qy)(a||(a=(0,p.A)(['<ha-alert alert-type="error">',"</ha-alert>"])),this._error):(0,b.qy)(s||(s=(0,p.A)([' <video id="remote-stream" ?autoplay="','" .muted="','" ?playsinline="','" ?controls="','" poster="','" @loadeddata="','" style="','"></video> '])),this.autoPlay,this.muted,this.playsInline,this.controls,(0,U.J)(this.posterUrl),this._loadedData,(0,I.W)({height:null==this.aspectRatio?"100%":"auto",aspectRatio:this.aspectRatio,objectFit:this.fitMode}))}},{key:"connectedCallback",value:function(){(0,y.A)(e,"connectedCallback",this,3)([]),this.hasUpdated&&this.entityid&&this._startWebRtc(),document.addEventListener("visibilitychange",this._handleVisibilityChange)}},{key:"disconnectedCallback",value:function(){(0,y.A)(e,"disconnectedCallback",this,3)([]),document.removeEventListener("visibilitychange",this._handleVisibilityChange),this._cleanUp()}},{key:"willUpdate",value:function(t){(0,y.A)(e,"willUpdate",this,3)([t]),t.has("entityid")&&this._startWebRtc()}},{key:"_startWebRtc",value:(r=(0,u.A)((0,l.A)().m(function t(){var e=this;return(0,l.A)().w(function(t){for(;;)switch(t.n){case 0:if(this._cleanUp(),"undefined"!=typeof RTCPeerConnection){t.n=1;break}return this._error="WebRTC is not supported in this browser",(0,O.r)(this,"streams",{hasAudio:!1,hasVideo:!1}),t.a(2);case 1:if(this.hass&&this.entityid){t.n=2;break}return t.a(2);case 2:return this._error=void 0,this._startTimer(),this._logEvent("start clientConfig"),t.n=3,(0,M.bT)(this.hass,this.entityid);case 3:this._clientConfig=t.v,this._logEvent("end clientConfig",this._clientConfig),this._peerConnection=new RTCPeerConnection(this._clientConfig.configuration),this._clientConfig.dataChannel&&this._peerConnection.createDataChannel(this._clientConfig.dataChannel),this._peerConnection.onnegotiationneeded=this._startNegotiation,this._peerConnection.onicecandidate=this._handleIceCandidate,this._peerConnection.oniceconnectionstatechange=this._iceConnectionStateChanged,this._peerConnection.onsignalingstatechange=function(t){"stable"===t.target.signalingState?e._logEvent("ICE negotiation complete"):e._logEvent("Signaling state changed",t.target.signalingState)},this._remoteStream=new MediaStream,this._peerConnection.ontrack=this._addTrack,this._peerConnection.addTransceiver("audio",{direction:"recvonly"}),this._peerConnection.addTransceiver("video",{direction:"recvonly"});case 4:return t.a(2)}},t,this)})),function(){return r.apply(this,arguments)})},{key:"_handleOfferEvent",value:(n=(0,u.A)((0,l.A)().m(function t(e){var i,a,s,n=this;return(0,l.A)().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.entityid){t.n=1;break}return t.a(2);case 1:if("session"===e.type&&(this._sessionId=e.session_id,this._candidatesList.forEach(function(t){return(0,M.UC)(n.hass,n.entityid,e.session_id,t.toJSON())}),this._candidatesList=[]),"answer"===e.type&&(this._logEvent("answer",e.answer),this._handleAnswer(e)),"candidate"!==e.type){t.n=5;break}return this._logEvent("remote ice candidate",e.candidate),t.p=2,a=e.candidate.sdpMid||null!=e.candidate.sdpMLineIndex?new RTCIceCandidate(e.candidate):new RTCIceCandidate({candidate:e.candidate.candidate,sdpMid:"0"}),t.n=3,null===(i=this._peerConnection)||void 0===i?void 0:i.addIceCandidate(a);case 3:t.n=5;break;case 4:t.p=4,s=t.v,console.error(s);case 5:"error"===e.type&&(this._error="Failed to start WebRTC stream: "+e.message,this._cleanUp());case 6:return t.a(2)}},t,this,[[2,4]])})),function(t){return n.apply(this,arguments)})},{key:"_handleAnswer",value:(i=(0,u.A)((0,l.A)().m(function t(e){var i,a,s;return(0,l.A)().w(function(t){for(;;)switch(t.p=t.n){case 0:if(null!==(i=this._peerConnection)&&void 0!==i&&i.signalingState&&!["stable","closed"].includes(this._peerConnection.signalingState)){t.n=1;break}return t.a(2);case 1:return a=new RTCSessionDescription({type:"answer",sdp:e.answer}),t.p=2,this._logEvent("start setRemoteDescription",a),t.n=3,this._peerConnection.setRemoteDescription(a);case 3:t.n=5;break;case 4:t.p=4,s=t.v,this._error="Failed to connect WebRTC stream: "+s.message,this._cleanUp();case 5:this._logEvent("end setRemoteDescription");case 6:return t.a(2)}},t,this,[[2,4]])})),function(t){return i.apply(this,arguments)})},{key:"_cleanUp",value:function(){var t;this._remoteStream&&(this._remoteStream.getTracks().forEach(function(t){t.stop()}),this._remoteStream=void 0);var e=this._videoEl;e&&(e.removeAttribute("src"),e.load()),this._peerConnection&&(this._peerConnection.close(),this._peerConnection.onnegotiationneeded=null,this._peerConnection.onicecandidate=null,this._peerConnection.oniceconnectionstatechange=null,this._peerConnection.onicegatheringstatechange=null,this._peerConnection.ontrack=null,this._peerConnection.onsignalingstatechange=null,this._peerConnection=void 0,this._logEvent("stopped"),this._stopTimer()),null===(t=this._unsub)||void 0===t||t.then(function(t){return t()}),this._unsub=void 0,this._sessionId=void 0,this._candidatesList=[]}},{key:"_loadedData",value:function(){var t=this._videoEl.srcObject,e={hasAudio:Boolean(null==t?void 0:t.getAudioTracks().length),hasVideo:Boolean(null==t?void 0:t.getVideoTracks().length)};(0,O.r)(this,"load"),(0,O.r)(this,"streams",e),this._logEvent("loadedData",e),this._stopTimer()}},{key:"_startTimer",value:function(){}},{key:"_stopTimer",value:function(){}},{key:"_logEvent",value:function(t){}}]);var i,n,r}(b.WF));E.styles=(0,b.AH)(n||(n=(0,p.A)([":host,video{display:block}video{width:100%;max-height:var(--video-max-height,calc(100vh - 97px))}"]))),(0,f.Cg)([(0,C.MZ)({attribute:!1})],E.prototype,"hass",void 0),(0,f.Cg)([(0,C.MZ)()],E.prototype,"entityid",void 0),(0,f.Cg)([(0,C.MZ)({attribute:!1})],E.prototype,"aspectRatio",void 0),(0,f.Cg)([(0,C.MZ)({attribute:!1})],E.prototype,"fitMode",void 0),(0,f.Cg)([(0,C.MZ)({type:Boolean,attribute:"controls"})],E.prototype,"controls",void 0),(0,f.Cg)([(0,C.MZ)({type:Boolean,attribute:"muted"})],E.prototype,"muted",void 0),(0,f.Cg)([(0,C.MZ)({type:Boolean,attribute:"autoplay"})],E.prototype,"autoPlay",void 0),(0,f.Cg)([(0,C.MZ)({type:Boolean,attribute:"playsinline"})],E.prototype,"playsInline",void 0),(0,f.Cg)([(0,C.MZ)({attribute:"poster-url"})],E.prototype,"posterUrl",void 0),(0,f.Cg)([(0,C.wk)()],E.prototype,"_error",void 0),(0,f.Cg)([(0,C.P)("#remote-stream")],E.prototype,"_videoEl",void 0),E=(0,f.Cg)([(0,C.EM)("ha-web-rtc-player")],E);var R="mjpeg",V=function(t){function e(){var t;(0,v.A)(this,e);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return(t=(0,g.A)(this,e,[].concat(a))).controls=!1,t.muted=!1,t.allowExoPlayer=!1,t._connected=!1,t._streams=(0,w.A)(function(t,e,i,a){if(!t)return[];if(0===t.length)return[{type:R,visible:!0}];if(1===t.length)return t[0]===M.Ub&&!1===(null==e?void 0:e.hasVideo)||t[0]===M.zS&&!1===(null==i?void 0:i.hasVideo)?[{type:R,visible:!0}]:[{type:t[0],visible:!0}];if(e&&i)return e.hasVideo&&e.hasAudio&&!i.hasAudio&&!a?[{type:M.Ub,visible:!0}]:i.hasVideo?[{type:M.zS,visible:!0}]:[{type:R,visible:!0}];if((null==e?void 0:e.hasVideo)!==(null==i?void 0:i.hasVideo)){if(null!=e&&e.hasVideo)return[{type:M.Ub,visible:!0},{type:M.zS,visible:!1}];if(!1===(null==e?void 0:e.hasVideo))return[{type:M.zS,visible:!0}];if(null!=i&&i.hasVideo)return[{type:M.zS,visible:!0},{type:M.Ub,visible:!1}];if(!1===(null==i?void 0:i.hasVideo))return[{type:M.Ub,visible:!0}]}return[{type:M.Ub,visible:!0},{type:M.zS,visible:!1}]}),t}return(0,m.A)(e,t),(0,_.A)(e,[{key:"willUpdate",value:function(t){var e;t.has("stateObj")&&this.stateObj&&(null===(e=t.get("stateObj"))||void 0===e?void 0:e.entity_id)!==this.stateObj.entity_id&&(this._getCapabilities(),this._getPosterUrl())}},{key:"connectedCallback",value:function(){(0,y.A)(e,"connectedCallback",this,3)([]),this._connected=!0}},{key:"disconnectedCallback",value:function(){(0,y.A)(e,"disconnectedCallback",this,3)([]),this._connected=!1}},{key:"render",value:function(){var t,e=this;if(!this.stateObj)return b.s6;var i=this._streams(null===(t=this._capabilities)||void 0===t?void 0:t.frontend_stream_types,this._hlsStreams,this._webRtcStreams,this.muted);return(0,b.qy)(r||(r=(0,p.A)(["",""])),(0,k.u)(i,function(t){return t.type+e.stateObj.entity_id},function(t){return e._renderStream(t)}))}},{key:"_renderStream",value:function(t){return this.stateObj?t.type===R?(0,b.qy)(o||(o=(0,p.A)(['<img .src="','" style="','" alt="','">'])),this._connected?(0,M.CK)(this.stateObj):this._posterUrl||"",(0,I.W)({aspectRatio:this.aspectRatio,objectFit:this.fitMode}),"Preview of the ".concat((0,S.u)(this.stateObj)," camera.")):t.type===M.Ub?(0,b.qy)(c||(c=(0,p.A)(['<ha-hls-player autoplay playsinline .allowExoPlayer="','" .muted="','" .controls="','" .hass="','" .entityid="','" .posterUrl="','" @streams="','" class="','" .aspectRatio="','" .fitMode="','"></ha-hls-player>'])),this.allowExoPlayer,this.muted,this.controls,this.hass,this.stateObj.entity_id,this._posterUrl,this._handleHlsStreams,t.visible?"":"hidden",this.aspectRatio,this.fitMode):t.type===M.zS?(0,b.qy)(h||(h=(0,p.A)(['<ha-web-rtc-player autoplay playsinline .muted="','" .controls="','" .hass="','" .entityid="','" .posterUrl="','" @streams="','" class="','" .aspectRatio="','" .fitMode="','"></ha-web-rtc-player>'])),this.muted,this.controls,this.hass,this.stateObj.entity_id,this._posterUrl,this._handleWebRtcStreams,t.visible?"":"hidden",this.aspectRatio,this.fitMode):b.s6:b.s6}},{key:"_getCapabilities",value:(a=(0,u.A)((0,l.A)().m(function t(){return(0,l.A)().w(function(t){for(;;)switch(t.n){case 0:if(this._capabilities=void 0,this._hlsStreams=void 0,this._webRtcStreams=void 0,(0,A.$)(this.stateObj,M.JT)){t.n=1;break}return this._capabilities={frontend_stream_types:[]},t.a(2);case 1:return t.n=2,(0,M._Z)(this.hass,this.stateObj.entity_id);case 2:this._capabilities=t.v;case 3:return t.a(2)}},t,this)})),function(){return a.apply(this,arguments)})},{key:"_getPosterUrl",value:(i=(0,u.A)((0,l.A)().m(function t(){return(0,l.A)().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,(0,M.C4)(this.hass,this.stateObj.entity_id,this.clientWidth,this.clientHeight);case 1:this._posterUrl=t.v,t.n=3;break;case 2:t.p=2,t.v,this._posterUrl=void 0;case 3:return t.a(2)}},t,this,[[0,2]])})),function(){return i.apply(this,arguments)})},{key:"_handleHlsStreams",value:function(t){this._hlsStreams=t.detail}},{key:"_handleWebRtcStreams",value:function(t){this._webRtcStreams=t.detail}}]);var i,a}(b.WF);V.styles=(0,b.AH)(d||(d=(0,p.A)([":host,img{display:block}img{width:100%}ha-web-rtc-player{width:100%;height:100%}ha-hls-player{width:100%;height:100%}.hidden{display:none}"]))),(0,f.Cg)([(0,C.MZ)({attribute:!1})],V.prototype,"hass",void 0),(0,f.Cg)([(0,C.MZ)({attribute:!1})],V.prototype,"stateObj",void 0),(0,f.Cg)([(0,C.MZ)({attribute:!1})],V.prototype,"aspectRatio",void 0),(0,f.Cg)([(0,C.MZ)({attribute:!1})],V.prototype,"fitMode",void 0),(0,f.Cg)([(0,C.MZ)({type:Boolean,attribute:"controls"})],V.prototype,"controls",void 0),(0,f.Cg)([(0,C.MZ)({type:Boolean,attribute:"muted"})],V.prototype,"muted",void 0),(0,f.Cg)([(0,C.MZ)({type:Boolean,attribute:"allow-exoplayer"})],V.prototype,"allowExoPlayer",void 0),(0,f.Cg)([(0,C.wk)()],V.prototype,"_posterUrl",void 0),(0,f.Cg)([(0,C.wk)()],V.prototype,"_connected",void 0),(0,f.Cg)([(0,C.wk)()],V.prototype,"_capabilities",void 0),(0,f.Cg)([(0,C.wk)()],V.prototype,"_hlsStreams",void 0),(0,f.Cg)([(0,C.wk)()],V.prototype,"_webRtcStreams",void 0),V=(0,f.Cg)([(0,C.EM)("ha-camera-stream")],V)},67013:function(t,e,i){i.d(e,{e:function(){return a}});i(28706);var a=function(t){return"/api/image_proxy/".concat(t.entity_id,"?token=").concat(t.attributes.access_token,"&state=").concat(t.state)}},57914:function(t,e,i){i.a(t,async function(t,e){try{var a,s,n,r,o,c,h=i(61397),d=i(50264),l=i(72153),u=i(26520),p=i(47075),v=i(44734),_=i(43080),g=i(69683),m=i(6454),y=i(25460),f=(i(28706),i(2008),i(74423),i(18111),i(22489),i(7588),i(69085),i(5506),i(26099),i(21699),i(23500),i(40445)),b=i(96196),C=i(77845),k=i(94333),I=i(6415),w=i(46190),S=i(71727),A=i(58548),M=(i(55148),i(65829)),U=i(10897),O=i(22675),E=i(67013),R=i(17022),V=t([M]);M=(V.then?(await V)():V)[0];var j=function(t){function e(){var t;(0,v.A)(this,e);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return(t=(0,g.A)(this,e,[].concat(a)))._imageVisible=!1,t._resolvedStateImages={},t._ratio=null,t}return(0,m.A)(e,t),(0,_.A)(e,[{key:"connectedCallback",value:function(){(0,y.A)(e,"connectedCallback",this,3)([]),void 0===this._loadState&&(this._loadState=1),this.cameraImage&&"live"!==this.cameraView&&this._startIntersectionObserverOrUpdates()}},{key:"disconnectedCallback",value:function(){(0,y.A)(e,"disconnectedCallback",this,3)([]),this._stopUpdateCameraInterval(),this._stopIntersectionObserver(),this._imageVisible=void 0}},{key:"handleIntersectionCallback",value:function(t){this._imageVisible=t[0].isIntersecting}},{key:"willUpdate",value:function(t){var e=this;if(t.has("hass")){var i=t.get("hass");this._shouldStartCameraUpdates(i)?this._startIntersectionObserverOrUpdates():this.hass.connected||(this._stopUpdateCameraInterval(),this._stopIntersectionObserver(),this._loadState=1,this._cameraImageSrc=void 0,this._loadedImageSrc=void 0)}t.has("_imageVisible")&&(this._imageVisible?this._shouldStartCameraUpdates()&&this._startUpdateCameraInterval():this._stopUpdateCameraInterval()),t.has("aspectRatio")&&(this._ratio=this.aspectRatio?(0,A.A)(this.aspectRatio):null),1!==this._loadState||this.cameraImage||(this._loadState=2);var a=t.has("hass")&&!t.get("hass");this.hass&&(t.has("image")||a)&&(this.image&&(0,R.St)(this.image)?(0,R.A1)(this.hass,this.image).then(function(t){e._resolvedImageSrc=t.url}):this._resolvedImageSrc=this.image),this.hass&&(t.has("darkModeImage")||a)&&(this.darkModeImage&&(0,R.St)(this.darkModeImage)?(0,R.A1)(this.hass,this.darkModeImage).then(function(t){e._resolvedDarkModeImageSrc=t.url}):this._resolvedDarkModeImageSrc=this.darkModeImage),(t.has("stateImage")||a)&&(this._resolvedStateImages={},Object.entries(this.stateImage||{}).forEach(function(t){var i=t[0],a=t[1],s="object"===(0,p.A)(a)&&a.media_content_id||a;(0,R.St)(s)?(0,R.A1)(e.hass,s).then(function(t){e._resolvedStateImages=Object.assign(Object.assign({},e._resolvedStateImages),{},(0,u.A)({},i,t.url))}):e._resolvedStateImages[i]=s}))}},{key:"render",value:function(){if(!this.hass)return b.s6;var t,e,i=Boolean(this._ratio&&this._ratio.w>0&&this._ratio.h>0),c=this.entity?this.hass.states[this.entity]:void 0,h=c?c.state:O.Hh,d=!this.stateImage;if(this.cameraImage)"live"===this.cameraView?e=this.hass.states[this.cameraImage]:t=this._cameraImageSrc;else if(this.stateImage){var u=this._resolvedStateImages[h];u?t=u:(t=this._resolvedImageSrc,d=!0)}else t=this.darkModeImage&&this.hass.themes.darkMode?this._resolvedDarkModeImageSrc:c&&"image"===(0,S.m)(c.entity_id)?(0,E.e)(c):this._resolvedImageSrc;t&&(t=this.hass.hassUrl(t));var p=this.filter||"";(this.hass.themes.darkMode&&this.darkModeFilter&&(p+=this.darkModeFilter),this.stateFilter&&this.stateFilter[h]&&(p+=this.stateFilter[h]),!p&&this.entity)&&(p=(!c||w.jj.includes(h))&&d?"grayscale(100%)":"");return(0,b.qy)(a||(a=(0,l.A)([' <div style="','" class="container ','"> '," "," </div> "])),(0,I.W)({paddingBottom:i?"".concat((100*this._ratio.h/this._ratio.w).toFixed(2),"%"):void 0===this._lastImageHeight?"56.25%":void 0,backgroundImage:i&&this._loadedImageSrc?'url("'.concat(this._loadedImageSrc,'")'):void 0,filter:2===this._loadState||"live"===this.cameraView?p:void 0}),(0,k.H)({ratio:i||void 0===this._lastImageHeight,contain:"contain"===this.fitMode,fill:"fill"===this.fitMode}),this.cameraImage&&"live"===this.cameraView?(0,b.qy)(s||(s=(0,l.A)([' <ha-camera-stream muted .hass="','" .stateObj="','" .fitMode="','" .aspectRatio="','" @load="','"></ha-camera-stream> '])),this.hass,e,this.fitMode,this._ratio?this._ratio.w/this._ratio.h:void 0,this._onVideoLoad):void 0===t?b.s6:(0,b.qy)(n||(n=(0,l.A)([' <img id="image" src="','" alt="','" @error="','" @load="','" style="','"> '])),t,this.entity||"",this._onImageError,this._onImageLoad,(0,I.W)({display:i||2===this._loadState?"block":"none"})),3===this._loadState?(0,b.qy)(r||(r=(0,l.A)(['<div id="brokenImage" style="','"></div>'])),(0,I.W)({height:i?void 0:"".concat(this._lastImageHeight,"px")||"100%"})):"live"===this.cameraView||void 0!==t&&1!==this._loadState?"":(0,b.qy)(o||(o=(0,l.A)(['<div class="progress-container" style="','"> <ha-spinner class="render-spinner" size="small"></ha-spinner> </div>'])),(0,I.W)({height:i?void 0:"".concat(this._lastImageHeight,"px")||"100%"})))}},{key:"_shouldStartCameraUpdates",value:function(t){return!(t&&t.connected===this.hass.connected||!this.hass.connected||"live"===this.cameraView)}},{key:"_startIntersectionObserverOrUpdates",value:function(){"IntersectionObserver"in window?(this._intersectionObserver||(this._intersectionObserver=new IntersectionObserver(this.handleIntersectionCallback.bind(this))),this._intersectionObserver.observe(this)):(this._imageVisible=!0,this._startUpdateCameraInterval())}},{key:"_stopIntersectionObserver",value:function(){this._intersectionObserver&&this._intersectionObserver.disconnect()}},{key:"_startUpdateCameraInterval",value:function(){var t=this;this._stopUpdateCameraInterval(),this._updateCameraImageSrc(),this.cameraImage&&this.isConnected&&(this._cameraUpdater=window.setInterval(function(){return t._updateCameraImageSrcAtInterval()},1e4))}},{key:"_stopUpdateCameraInterval",value:function(){this._cameraUpdater&&(clearInterval(this._cameraUpdater),this._cameraUpdater=void 0)}},{key:"_onImageError",value:function(){this._loadState=3}},{key:"_onImageLoad",value:(C=(0,d.A)((0,h.A)().m(function t(e){var i;return(0,h.A)().w(function(t){for(;;)switch(t.n){case 0:return this._loadState=2,i=e.target,this._ratio&&this._ratio.w>0&&this._ratio.h>0&&(this._loadedImageSrc=i.src),t.n=1,this.updateComplete;case 1:this._lastImageHeight=i.offsetHeight;case 2:return t.a(2)}},t,this)})),function(t){return C.apply(this,arguments)})},{key:"_onVideoLoad",value:(f=(0,d.A)((0,h.A)().m(function t(e){var i;return(0,h.A)().w(function(t){for(;;)switch(t.n){case 0:return this._loadState=2,i=e.currentTarget,t.n=1,this.updateComplete;case 1:this._lastImageHeight=i.offsetHeight;case 2:return t.a(2)}},t,this)})),function(t){return f.apply(this,arguments)})},{key:"_updateCameraImageSrcAtInterval",value:(c=(0,d.A)((0,h.A)().m(function t(){return(0,h.A)().w(function(t){for(;;)if(0===t.n)return 1===this._loadState&&this._onImageError(),t.a(2,this._updateCameraImageSrc())},t,this)})),function(){return c.apply(this,arguments)})},{key:"_updateCameraImageSrc",value:(i=(0,d.A)((0,h.A)().m(function t(){var e,i,a;return(0,h.A)().w(function(t){for(;;)switch(t.n){case 0:if(this.hass&&this.cameraImage){t.n=1;break}return t.a(2);case 1:if(this.hass.states[this.cameraImage]){t.n=2;break}return this._onImageError(),t.a(2);case 2:return e=this.clientWidth||640,i=Math.ceil(e*devicePixelRatio),this._lastImageHeight?a=Math.ceil(this._lastImageHeight*devicePixelRatio):this._ratio&&this._ratio.w>0&&this._ratio.h>0?a=Math.ceil(i*(this._ratio.h/this._ratio.w)):(i*=2,a=Math.ceil(.5625*i)),t.n=3,(0,U.C4)(this.hass,this.cameraImage,i,a);case 3:this._cameraImageSrc=t.v,void 0===this._cameraImageSrc&&this._onImageError();case 4:return t.a(2)}},t,this)})),function(){return i.apply(this,arguments)})}]);var i,c,f,C}(b.WF);j.styles=(0,b.AH)(c||(c=(0,l.A)([':host{display:block}.container{transition:filter .2s linear;height:100%}img{display:block;height:100%;width:100%;object-fit:cover}ha-camera-stream{display:block;height:100%;width:100%}.progress-container{display:flex;justify-content:center;align-items:center}.ratio{position:relative;width:100%;height:0;background-position:center;background-size:cover}.ratio.fill{background-size:100% 100%}.ratio.contain{background-size:contain;background-repeat:no-repeat}.fill img{object-fit:fill}.contain img{object-fit:contain}.ratio div,.ratio img{position:absolute;top:0;left:0;width:100%;height:100%}.ratio img{visibility:hidden}#brokenImage{background:grey url("/static/images/image-broken.svg") center/36px no-repeat}']))),(0,f.Cg)([(0,C.MZ)({attribute:!1})],j.prototype,"hass",void 0),(0,f.Cg)([(0,C.MZ)()],j.prototype,"entity",void 0),(0,f.Cg)([(0,C.MZ)()],j.prototype,"image",void 0),(0,f.Cg)([(0,C.MZ)({attribute:!1})],j.prototype,"stateImage",void 0),(0,f.Cg)([(0,C.MZ)({attribute:!1})],j.prototype,"cameraImage",void 0),(0,f.Cg)([(0,C.MZ)({attribute:!1})],j.prototype,"cameraView",void 0),(0,f.Cg)([(0,C.MZ)({attribute:!1})],j.prototype,"aspectRatio",void 0),(0,f.Cg)([(0,C.MZ)()],j.prototype,"filter",void 0),(0,f.Cg)([(0,C.MZ)({attribute:!1})],j.prototype,"stateFilter",void 0),(0,f.Cg)([(0,C.MZ)({attribute:!1})],j.prototype,"darkModeImage",void 0),(0,f.Cg)([(0,C.MZ)({attribute:!1})],j.prototype,"darkModeFilter",void 0),(0,f.Cg)([(0,C.MZ)({attribute:"fit-mode",type:String})],j.prototype,"fitMode",void 0),(0,f.Cg)([(0,C.wk)()],j.prototype,"_imageVisible",void 0),(0,f.Cg)([(0,C.wk)()],j.prototype,"_loadState",void 0),(0,f.Cg)([(0,C.wk)()],j.prototype,"_cameraImageSrc",void 0),(0,f.Cg)([(0,C.wk)()],j.prototype,"_loadedImageSrc",void 0),(0,f.Cg)([(0,C.wk)()],j.prototype,"_resolvedImageSrc",void 0),(0,f.Cg)([(0,C.wk)()],j.prototype,"_resolvedDarkModeImageSrc",void 0),(0,f.Cg)([(0,C.wk)()],j.prototype,"_resolvedStateImages",void 0),(0,f.Cg)([(0,C.wk)()],j.prototype,"_lastImageHeight",void 0),j=(0,f.Cg)([(0,C.EM)("hui-image")],j),e()}catch(Z){e(Z)}})}}]);
//# sourceMappingURL=99143.d522ffc8a881b9f4.js.map