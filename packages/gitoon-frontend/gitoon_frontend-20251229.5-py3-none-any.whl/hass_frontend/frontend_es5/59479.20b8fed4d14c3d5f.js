"use strict";(self.webpackChunkgitoon_frontend=self.webpackChunkgitoon_frontend||[]).push([["59479"],{90433:function(t,e,n){n.d(e,{Vy:function(){return o},fI:function(){return s},ux:function(){return c}});n(23418),n(47764);var i=n(22786),a=n(79468),r=54;function o(t,e){var n=t%r+1;return e.getPropertyValue("--color-".concat(n))}function s(t,e){var n=e.getPropertyValue("--graph-color-".concat(t+1))||o(t,e);return(0,a.RQ)(n)}var c=(0,i.A)(function(t){return Array.from({length:r},function(e,n){return s(n,t)})},function(t,e){return t[0].getPropertyValue("--graph-color-1")===e[0].getPropertyValue("--graph-color-1")&&t[0].getPropertyValue("--color-1")===e[0].getPropertyValue("--color-1")})},75428:function(t,e,n){n.d(e,{D:function(){return r}});var i=n(75158),a=n.n(i),r=function(t){return a()(t,{whiteList:{},stripIgnoreTag:!0,stripIgnoreTagBody:!0})}},34296:function(t,e,n){var i,a,r,o,s=n(72153),c=n(44734),l=n(43080),u=n(69683),d=n(6454),h=n(25460),p=(n(28706),n(69085),n(40445)),_=n(96229),f=n(26069),g=n(91735),v=n(42034),m=n(96196),y=n(77845),b=function(t){function e(){var t;(0,c.A)(this,e);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(t=(0,u.A)(this,e,[].concat(i))).filled=!1,t.active=!1,t}return(0,d.A)(e,t),(0,l.A)(e,[{key:"renderOutline",value:function(){return this.filled?(0,m.qy)(i||(i=(0,s.A)(['<span class="filled"></span>']))):(0,h.A)(e,"renderOutline",this,3)([])}},{key:"getContainerClasses",value:function(){return Object.assign(Object.assign({},(0,h.A)(e,"getContainerClasses",this,3)([])),{},{active:this.active})}},{key:"renderPrimaryContent",value:function(){return(0,m.qy)(a||(a=(0,s.A)([' <span class="leading icon" aria-hidden="true"> ',' </span> <span class="label">','</span> <span class="touch"></span> <span class="trailing leading icon" aria-hidden="true"> '," </span> "])),this.renderLeadingIcon(),this.label,this.renderTrailingIcon())}},{key:"renderTrailingIcon",value:function(){return(0,m.qy)(r||(r=(0,s.A)(['<slot name="trailing-icon"></slot>'])))}}])}(_.k);b.styles=[g.R,v.R,f.R,(0,m.AH)(o||(o=(0,s.A)([":host{--md-sys-color-primary:var(--primary-text-color);--md-sys-color-on-surface:var(--primary-text-color);--md-assist-chip-container-shape:var(\n          --ha-assist-chip-container-shape,\n          16px\n        );--md-assist-chip-outline-color:var(--outline-color);--md-assist-chip-label-text-weight:400}.filled{display:flex;pointer-events:none;border-radius:inherit;inset:0;position:absolute;background-color:var(--ha-assist-chip-filled-container-color)}::slotted([slot=icon]),::slotted([slot=trailing-icon]){display:flex;--mdc-icon-size:var(--md-input-chip-icon-size, 18px);font-size:var(--_label-text-size)!important}.trailing.icon ::slotted(*),.trailing.icon svg{margin-inline-end:unset;margin-inline-start:var(--_icon-label-space)}::before{background:var(--ha-assist-chip-container-color,transparent);opacity:var(--ha-assist-chip-container-opacity, 1)}:where(.active)::before{background:var(--ha-assist-chip-active-container-color);opacity:var(--ha-assist-chip-active-container-opacity)}.label{font-family:var(--ha-font-family-body)}"])))],(0,p.Cg)([(0,y.MZ)({type:Boolean,reflect:!0})],b.prototype,"filled",void 0),(0,p.Cg)([(0,y.MZ)({type:Boolean})],b.prototype,"active",void 0),b=(0,p.Cg)([(0,y.EM)("ha-assist-chip")],b)},23528:function(t,e,n){n.a(t,async function(t,i){try{n.d(e,{$3:function(){return v},$O:function(){return w},$j:function(){return m},ED:function(){return s},JE:function(){return A},OQ:function(){return T},PU:function(){return M},Ph:function(){return f},Uf:function(){return S},W1:function(){return g},Wr:function(){return h},Z:function(){return u},gF:function(){return y},iY:function(){return b},jU:function(){return c},nN:function(){return x},p3:function(){return d},pJ:function(){return _},r_:function(){return l},sz:function(){return p}});n(74423),n(18111),n(13579),n(62953);var a=n(28978),r=n(380),o=t([r]);r=(o.then?(await o)():o)[0];var s=function(t){return t[t.NONE=0]="NONE",t[t.ARITHMETIC=1]="ARITHMETIC",t[t.CIRCULAR=2]="CIRCULAR",t}({});const c=["entity_not_recorded","entity_no_longer_recorded","state_class_removed","units_changed","mean_type_changed","no_state"],l=["L","gal","ft³","m³","CCF","MCF"],u=t=>t.sendMessagePromise({type:"recorder/info"}),d=(t,e)=>t.callWS({type:"recorder/list_statistic_ids",statistic_type:e}),h=(t,e)=>t.callWS({type:"recorder/get_statistics_metadata",statistic_ids:e}),p=(t,e,n,i,a="hour",r,o)=>t.callWS({type:"recorder/statistics_during_period",start_time:e.toISOString(),end_time:null==n?void 0:n.toISOString(),statistic_ids:i,period:a,units:r,types:o}),_=(t,e,n,i)=>t.callWS({type:"recorder/statistic_during_period",statistic_id:e,units:i,fixed_period:n.fixed_period?{start_time:n.fixed_period.start instanceof Date?n.fixed_period.start.toISOString():n.fixed_period.start,end_time:n.fixed_period.end instanceof Date?n.fixed_period.end.toISOString():n.fixed_period.end}:void 0,calendar:n.calendar?{..."week"===n.calendar.period?{first_weekday:(0,r.D)(t.locale).substring(0,3)}:{},...n.calendar}:void 0,rolling_window:n.rolling_window}),f=t=>t.callWS({type:"recorder/validate_statistics"}),g=(t,e,n,i)=>t.callWS({type:"recorder/update_statistics_metadata",statistic_id:e,unit_of_measurement:n,unit_class:i}),v=(t,e)=>t.callWS({type:"recorder/clear_statistics",statistic_ids:e}),m=t=>{let e=null;if(!t)return null;for(const n of t)null!==n.change&&void 0!==n.change&&(null===e?e=n.change:e+=n.change);return e},y=(t,e)=>{let n=null;for(const i of e){if(!(i in t))continue;const e=m(t[i]);null!==e&&(null===n?n=e:n+=e)}return n},b=(t,e)=>t.some(t=>void 0!==t[e]&&null!==t[e]),k=["mean","min","max"],C=["sum","state","change"],x=(t,e)=>!(!k.includes(e)||0===t.mean_type)||!(!C.includes(e)||!t.has_sum),S=(t,e,n,i,a)=>{const r=new Date(n).toISOString();return t.callWS({type:"recorder/adjust_sum_statistics",statistic_id:e,start_time:r,adjustment:i,adjustment_unit_of_measurement:a})},w=(t,e,n)=>{const i=t.states[e];return i?(0,a.u)(i):(null==n?void 0:n.name)||e},A=(t,e,n)=>{let i;var a;e&&(i=null===(a=t.states[e])||void 0===a?void 0:a.attributes.unit_of_measurement);return void 0===i?null==n?void 0:n.statistics_unit_of_measurement:i},T=t=>t.includes(":"),M=t=>t.callWS({type:"recorder/update_statistics_issues"});i()}catch(c){i(c)}})},18427:function(t,e,n){n.d(e,{g:function(){return r}});n(42762);var i=n(79468),a=n(39274);function r(t,e,n,r,o,s){var c=t.getPropertyValue(o+"-"+s).trim(),l=c.length>0?c:t.getPropertyValue(o).trim(),u=(0,i.RQ)(l);return 0===c.length&&s&&(u=(0,i.v2)((0,i.BE)(e?(0,a.T)((0,i.Nc)((0,i.xp)(u)),s):(0,a.d)((0,i.Nc)((0,i.xp)(u)),s)))),r?u+=n?"32":"7F":n&&(u+="7F"),u}},78231:function(t,e,n){n.a(t,async function(t,i){try{n.r(e),n.d(e,{HuiEnergyDevicesGraphCard:function(){return R}});var a,r,o,s=n(61397),c=n(50264),l=n(72153),u=n(7739),d=n(44734),h=n(43080),p=n(75864),_=n(69683),f=n(6454),g=n(25460),v=(n(28706),n(2008),n(50113),n(74423),n(25276),n(62062),n(44114),n(72712),n(26910),n(54554),n(18111),n(22489),n(20116),n(7588),n(61701),n(18237),n(69085),n(26099),n(21699),n(23500),n(40445)),m=n(96196),y=n(77845),b=n(94333),k=n(22786),C=n(8343),x=n(75428),S=n(90433),w=n(20058),A=n(44439),T=n(38114),M=n(23528),D=n(54706),V=n(784),I=(n(76776),n(1087)),O=n(3461),W=(n(26300),n(93905)),H=n(71769),z=n(18427),P=t([A,T,w,M]);[A,T,w,M]=P.then?(await P)():P;var R=function(t){function e(){var t;(0,d.A)(this,e);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(t=(0,_.A)(this,e,[].concat(i)))._chartData=[],t._legendData=[],t._hiddenStats=[],t._isMobile=!1,t._compoundStats=[],t.hassSubscribeRequiredHostProps=["_config"],t._createOptions=(0,k.A)(function(e,n,i){var a,r,o={grid:{top:5,left:5,right:40,bottom:0,containLabel:!0},tooltip:{show:!0,formatter:t._renderTooltip.bind((0,p.A)(t))},xAxis:{show:!1},yAxis:{show:!1},legend:{type:"custom",show:!1}};"bar"===n?(o.xAxis={show:!0,type:"value",name:"kWh",axisPointer:{show:!1}},o.yAxis={show:!0,type:"category",inverse:!0,triggerEvent:!0,data:null===(a=e[0])||void 0===a||null===(a=a.data)||void 0===a?void 0:a.map(function(t){return t.name}),axisLabel:{formatter:t._getDeviceName.bind((0,p.A)(t)),overflow:"truncate",fontSize:12,margin:5,width:Math.min(t._isMobile?100:200,Math.max.apply(Math,(0,u.A)((null===(r=e[0])||void 0===r||null===(r=r.data)||void 0===r?void 0:r.map(function(e){return(0,O.W)(t._getDeviceName(e.name),12)+5}))||[])))}}):o.legend={type:"custom",show:!0,data:i,selected:i.filter(function(e){return e.id&&t._hiddenStats.includes(e.id)}).reduce(function(t,e){return t[e.id]=!1,t},{})};return o}),t}return(0,f.A)(e,t),(0,h.A)(e,[{key:"hassSubscribe",value:function(){var t,e=this;return[(0,T.tb)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe(function(t){e._data=t,e._getStatistics(t)}),(0,H.m)("all and (max-width: 450px), all and (max-height: 500px)",function(t){e._isMobile=t})]}},{key:"getCardSize",value:function(){return 3}},{key:"setConfig",value:function(t){this._config=t}},{key:"_getAllowedModes",value:function(){var t;return null!==(t=this._config)&&void 0!==t&&t.modes&&0!==this._config.modes.length?this._config.modes:["bar","pie"]}},{key:"shouldUpdate",value:function(t){return(0,V.xP)(this,t)||t.size>1||!t.has("hass")}},{key:"willUpdate",value:function(t){if((0,g.A)(e,"willUpdate",this,3)([t]),t.has("_config")&&this._config){var n=this._getAllowedModes();this._chartType&&n.includes(this._chartType)||(this._chartType=n[0])}}},{key:"render",value:function(){var t;if(!this.hass||!this._config||!this._chartType)return m.s6;var e=this._getAllowedModes();return(0,m.qy)(a||(a=(0,l.A)([' <ha-card> <div class="card-header"> <span>',"</span> ",' </div> <div class="content ','"> <ha-chart-base .hass="','" .data="','" .options="','" .height="','" .extraComponents="','" @chart-click="','" @dataset-hidden="','" @dataset-unhidden="','"></ha-chart-base> </div> </ha-card> '])),this._config.title?this._config.title:m.s6,e.length>1?(0,m.qy)(r||(r=(0,l.A)([' <ha-icon-button .path="','" .label="','" @click="','"></ha-icon-button> '])),"pie"===this._chartType?"M22,21H2V3H4V19H6V10H10V19H12V6H16V19H18V14H22V21Z":"M13,2.05V5.08C16.39,5.57 19,8.47 19,12C19,12.9 18.82,13.75 18.5,14.54L21.12,16.07C21.68,14.83 22,13.45 22,12C22,6.82 18.05,2.55 13,2.05M12,19A7,7 0 0,1 5,12C5,8.47 7.61,5.57 11,5.08V2.05C5.94,2.55 2,6.81 2,12A10,10 0 0,0 12,22C15.3,22 18.23,20.39 20.05,17.91L17.45,16.38C16.17,18 14.21,19 12,19Z",this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_graph.change_chart_type"),this._handleChartTypeChange):m.s6,(0,b.H)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._chartData,this._chartType,this._legendData),"".concat(Math.max(e.includes("pie")?300:100,28*((null===(t=this._legendData)||void 0===t?void 0:t.length)||0)+50),"px"),[C.a],this._handleChartClick,this._datasetHidden,this._datasetUnhidden)}},{key:"_renderTooltip",value:function(t){var e=(0,x.D)(this._getDeviceName(t.name)),n='<h4 style="text-align: center; margin: 0;">'.concat(e,"</h4>"),i="".concat((0,w.ZV)(t.value[0],this.hass.locale,t.value<.1?{maximumFractionDigits:3}:void 0)," kWh");return"".concat(n).concat(t.marker," ").concat(t.seriesName,': <div style="direction:ltr; display: inline;">').concat(i,"</div>")}},{key:"_getDeviceName",value:function(t){var e,n,i=this._compoundStats.includes(t)?" (".concat(this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_graph.untracked"),")"):"";return((null===(e=this._data)||void 0===e||null===(e=e.prefs.device_consumption.find(function(e){return e.stat_consumption===t}))||void 0===e?void 0:e.name)||(0,M.$O)(this.hass,t,null===(n=this._data)||void 0===n?void 0:n.statsMetadata[t]))+i}},{key:"_getStatistics",value:(n=(0,c.A)((0,s.A)().m(function t(e){var n,i,a,r,o,c,l,u,d,h,p,_,f,g,v,m,y,b,k,C,x,A,D,V=this;return(0,s.A)().w(function(t){for(;;)switch(t.n){case 0:i=e.stats,a=e.statsCompare,r=[],o=[],c=[{type:this._chartType,radius:[a?"50%":"40%","70%"],universalTransition:!0,name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_graph.energy_usage"),itemStyle:{borderRadius:"bar"===this._chartType?[0,4,4,0]:4},data:r,barWidth:a?10:20,cursor:"default",minShowLabelAngle:15,label:"pie"===this._chartType?{formatter:function(t){var e=t.name;return V._getDeviceName(e)},overflow:"break",alignTo:this._isMobile?"edge":"none",edgeDistance:1}:void 0,labelLine:{length2:10}}],a&&c.push({type:this._chartType,radius:["30%","50%"],universalTransition:!0,name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_graph.previous_energy_usage"),itemStyle:{borderRadius:"bar"===this._chartType?[0,4,4,0]:4},data:o,barWidth:10,cursor:"default",label:"pie"===this._chartType?{show:!1}:void 0,emphasis:"pie"===this._chartType?{focus:"series",blurScope:"global"}:void 0}),l=getComputedStyle(this),this._compoundStats=e.prefs.device_consumption.map(function(t){return t.included_in_stat}).filter(Boolean),u=e.prefs.device_consumption,d={},u.forEach(function(t){d[t.stat_consumption]=t.stat_consumption in i&&(0,M.$j)(i[t.stat_consumption])||0}),h={},a&&u.forEach(function(t){h[t.stat_consumption]=t.stat_consumption in a&&(0,M.$j)(a[t.stat_consumption])||0}),u.forEach(function(t,e){var n,i=d[t.stat_consumption];if(null!==(n=V._config)&&void 0!==n&&n.hide_compound_stats){if(V._compoundStats.includes(t.stat_consumption))return}else{var s=u.reduce(function(e,n){return n.included_in_stat===t.stat_consumption?e+d[n.stat_consumption]:e},0);i-=Math.min(i,s)}var c=(0,S.fI)(e,l);if(r.push({id:t.stat_consumption,value:[i,t.stat_consumption],name:t.stat_consumption,itemStyle:{color:c+"7F",borderColor:c}}),a){var p=t.stat_consumption in a&&(0,M.$j)(a[t.stat_consumption])||0,_=u.reduce(function(e,n){return n.included_in_stat===t.stat_consumption?e+h[n.stat_consumption]:e},0);p-=Math.min(p,_),o.push({id:t.stat_consumption,value:[p,t.stat_consumption],name:t.stat_consumption,itemStyle:{color:c+"32",borderColor:c+"7F"}})}}),"pie"===this._chartType&&(p=r,_=(0,T.gv)(e),f=_.summedData,g=_.compareSummedData,v=(0,T.DR)(f,g),m=v.consumption,y=v.compareConsumption,b=m.total.used_total,(k="from_grid"in f||"solar"in f||"from_battery"in f?b-p.reduce(function(t,e){return t+e.value[0]},0):0)>0&&(C=(0,z.g)(l,this.hass.themes.darkMode,!1,!1,"--history-unknown-color"),p.push({id:"untracked",value:[k,"untracked"],name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_graph.untracked_consumption"),itemStyle:{color:C+"7F",borderColor:C}}),a&&(x=y.total.used_total-o.reduce(function(t,e){return t+e.value[0]},0))>0&&o.push({id:"untracked",value:[x,"untracked"],name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_graph.untracked_consumption"),itemStyle:{color:C+"32",borderColor:C+"7F"}})),A=p.reduce(function(t,e){return V._hiddenStats.includes(e.id)?t:t+e.value[0]},0),c.push({type:"pie",radius:["0%",a?"30%":"40%"],name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_graph.total_energy_usage"),data:[A],label:{show:!0,position:"center",color:l.getPropertyValue("--secondary-text-color"),fontSize:l.getPropertyValue("--ha-font-size-m"),lineHeight:24,fontWeight:"bold",formatter:"{a}\n".concat((0,w.ZV)(A,this.hass.locale)," kWh")},cursor:"default",itemStyle:{color:"rgba(0, 0, 0, 0)"},tooltip:{show:!1}})),r.sort(function(t,e){return e.value[0]-t.value[0]}),null!==(n=this._config)&&void 0!==n&&n.max_devices&&r.length>this._config.max_devices&&r.splice(this._config.max_devices),this._legendData=r.map(function(t){return Object.assign(Object.assign({},t),{},{name:V._getDeviceName(t.name)})});for(D=r.length-1;D>=0;D--)this._hiddenStats.includes(r[D].id)&&r.splice(D,1);return a&&(c[1].data=r.map(function(t){return o.find(function(e){return e.id===t.id})})),this._chartData=c,t.n=1,this.updateComplete;case 1:return t.a(2)}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"_handleChartClick",value:function(t){var e;if("axisLabel"===t.detail.targetType&&t.detail.value&&!(0,M.OQ)(t.detail.value))(0,I.r)(this,"hass-more-info",{entityId:t.detail.value});else if("pie"===t.detail.seriesType&&"tspan"===(null===(e=t.detail.event)||void 0===e||null===(e=e.target)||void 0===e?void 0:e.type)){var n=t.detail.data.id;"untracked"!==n&&(0,I.r)(this,"hass-more-info",{entityId:n})}}},{key:"_handleChartTypeChange",value:function(){if(this._chartType){var t=this._getAllowedModes(),e=(t.indexOf(this._chartType)+1)%t.length;this._chartType=t[e],this._getStatistics(this._data)}}},{key:"_datasetHidden",value:function(t){this._hiddenStats=[].concat((0,u.A)(this._hiddenStats),[t.detail.id]),this._getStatistics(this._data)}},{key:"_datasetUnhidden",value:function(t){this._hiddenStats=this._hiddenStats.filter(function(e){return e!==t.detail.id}),this._getStatistics(this._data)}}]);var n}((0,D.E)(m.WF));R.styles=(0,m.AH)(o||(o=(0,l.A)([".card-header{display:flex;justify-content:space-between;align-items:center;padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}ha-chart-base{--chart-max-height:none}ha-icon-button{transform:rotate(90deg);color:var(--secondary-text-color);cursor:pointer}"]))),(0,v.Cg)([(0,y.MZ)({attribute:!1})],R.prototype,"hass",void 0),(0,v.Cg)([(0,y.wk)()],R.prototype,"_config",void 0),(0,v.Cg)([(0,y.wk)()],R.prototype,"_chartData",void 0),(0,v.Cg)([(0,y.wk)()],R.prototype,"_data",void 0),(0,v.Cg)([(0,y.wk)()],R.prototype,"_legendData",void 0),(0,v.Cg)([(0,y.wk)(),(0,W.I)({key:"energy-devices-graph-chart-type",state:!0,subscribe:!1})],R.prototype,"_chartType",void 0),(0,v.Cg)([(0,y.wk)(),(0,W.I)({key:"energy-devices-pie-hidden-stats",state:!0,subscribe:!1})],R.prototype,"_hiddenStats",void 0),(0,v.Cg)([(0,y.wk)()],R.prototype,"_isMobile",void 0),R=(0,v.Cg)([(0,y.EM)("hui-energy-devices-graph-card")],R),i()}catch(E){i(E)}})},3461:function(t,e,n){n.d(e,{W:function(){return a}});var i;n(28706);function a(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Roboto, Noto, sans-serif";i||(i=document.createElement("canvas"));var a=i.getContext("2d");if(!a)return 0;a.font="".concat(e,"px ").concat(n);var r=a.measureText(t);return Math.ceil(Math.max(r.actualBoundingBoxRight+r.actualBoundingBoxLeft,r.width))}}}]);
//# sourceMappingURL=59479.20b8fed4d14c3d5f.js.map