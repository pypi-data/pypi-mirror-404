"use strict";(self.webpackChunkgitoon_frontend=self.webpackChunkgitoon_frontend||[]).push([["75591"],{89434:function(e,t,o){o.a(e,async function(e,t){try{var n,i,r,s,a,u=o(72153),c=o(31432),h=o(61397),l=o(50264),d=o(7739),g=o(44734),b=o(43080),p=o(69683),v=o(6454),_=o(25460),f=(o(16280),o(28706),o(2008),o(74423),o(44114),o(94490),o(26910),o(18111),o(22489),o(7588),o(13579),o(26099),o(16034),o(21699),o(23500),o(40445)),k=o(96196),y=o(77845),m=o(36312),w=o(69093),A=o(77796),C=o(65829),E=o(86531),I=o(63625),L=o(28669),M=o(11184),T=o(24367),S=e([C,M,E]);[C,M,E]=S.then?(await S)():S;var x=function(e,t){return new Date(e.getTime()-1e3*t).getTime()/1e3},B=function(e,t){return(void 0!==e||void 0!==t)&&(!e||!t||e.length!==t.length||e.some(function(e){return!t.includes(e)})||t.some(function(t){return!e.includes(t)}))},U=function(e){function t(){var e;(0,g.A)(this,t);for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];return(e=(0,p.A)(this,t,[].concat(n))).narrow=!1,e.virtualize=!1,e.noIcon=!1,e.noName=!1,e.showIndicator=!1,e.relativeTime=!1,e.showMoreLink=!0,e._traceContexts={},e._userIdToName={},e._liveUpdatesEnabled=!0,e._pendingStreamMessages=[],e._throttleGetLogbookEntries=(0,A.n)(function(){return e._getLogBookData()},1e3),e._logbookSubscriptionId=0,e._nonExpiredRecords=function(t){return e._logbookEntries?t?e._logbookEntries.filter(function(e){return e.when>t}):e._logbookEntries:[]},e._processOrQueueStreamMessage=function(t){e._liveUpdatesEnabled?e._processStreamMessage(t):e._pendingStreamMessages.push(t)},e._processStreamMessage=function(t){var o="recent"in e.time?x(new Date,e.time.recent):void 0,n=(e.stateFilter&&e.stateFilter.length>0?t.events.filter(function(t){var o;return t.state&&(null===(o=e.stateFilter)||void 0===o?void 0:o.includes(t.state))}):(0,d.A)(t.events)).reverse();if(e._logbookEntries&&e._logbookEntries.length){if(n.length){var i=e._nonExpiredRecords(o);i.length?n[n.length-1].when>i[0].when?e._logbookEntries=n.concat(i):i[i.length-1].when>n[0].when?e._logbookEntries=i.concat(n):e._logbookEntries=i.concat(n).sort(function(e,t){return t.when-e.when}):e._logbookEntries=n}}else e._logbookEntries=n},e._updateTraceContexts=(0,A.n)((0,l.A)((0,h.A)().m(function t(){return(0,h.A)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,(0,I.gq)(e.hass);case 1:e._traceContexts=t.v;case 2:return t.a(2)}},t)})),6e4),e._updateUsers=(0,A.n)((0,l.A)((0,h.A)().m(function t(){var o,n,i,r,s,a,u,l,d;return(0,h.A)().w(function(t){for(;;)switch(t.n){case 0:for(o={},n=(0,T.fe)(e.hass)&&(0,L.hU)(e.hass),i=0,r=Object.values(e.hass.states);i<r.length;i++)(s=r[i]).attributes.user_id&&"person"===(0,w.t)(s)&&(o[s.attributes.user_id]=s.attributes.friendly_name);if(!n){t.n=2;break}return t.n=1,n;case 1:a=t.v,u=(0,c.A)(a);try{for(u.s();!(l=u.n()).done;)(d=l.value).id in o||(o[d.id]=d.name)}catch(h){u.e(h)}finally{u.f()}case 2:e._userIdToName=o;case 3:return t.a(2)}},t)})),6e4),e}return(0,v.A)(t,e),(0,b.A)(t,[{key:"render",value:function(){return(0,m.x)(this.hass,"logbook")?this._error?(0,k.qy)(n||(n=(0,u.A)(['<div class="no-entries"> '," </div>"])),"".concat(this.hass.localize("ui.components.logbook.retrieval_error"),": ").concat(this._error)):void 0===this._logbookEntries?(0,k.qy)(i||(i=(0,u.A)([' <div class="progress-wrapper"> <ha-spinner></ha-spinner> </div> ']))):0===this._logbookEntries.length?(0,k.qy)(r||(r=(0,u.A)(['<div class="no-entries"> '," </div>"])),this.hass.localize("ui.components.logbook.entries_not_found")):(0,k.qy)(s||(s=(0,u.A)([' <ha-logbook-renderer .hass="','" .narrow="','" .virtualize="','" .noIcon="','" .noName="','" .showIndicator="','" .relativeTime="','" .entries="','" .traceContexts="','" .userIdToName="','" @hass-logbook-live="','"></ha-logbook-renderer> '])),this.hass,this.narrow,this.virtualize,this.noIcon,this.noName,this.showIndicator,this.relativeTime,this._logbookEntries,this._traceContexts,this._userIdToName,this._handleLogbookLive):k.s6}},{key:"refresh",value:(y=(0,l.A)((0,h.A)().m(function e(){var t,o=arguments;return(0,h.A)().w(function(e){for(;;)switch(e.n){case 0:if((t=o.length>0&&void 0!==o[0]&&o[0])||!this._unsubLogbook&&void 0!==this._logbookEntries){e.n=1;break}return e.a(2);case 1:this._throttleGetLogbookEntries.cancel(),this._updateTraceContexts.cancel(),this._updateUsers.cancel(),this._unsubscribe(!0),this._liveUpdatesEnabled=!0,t?this._getLogBookData():this._throttleGetLogbookEntries();case 2:return e.a(2)}},e,this)})),function(){return y.apply(this,arguments)})},{key:"shouldUpdate",value:function(e){if(1!==e.size||!e.has("hass"))return!0;var t=e.get("hass");return!t||t.localize!==this.hass.localize}},{key:"willUpdate",value:function(e){for(var t=e.has("time"),o=0,n=["entityIds","deviceIds","stateFilter"];o<n.length;o++){var i=n[o];if(e.has(i)){var r=e.get(i),s=this[i];if(B(r,s)){t=!0;break}}}t&&this.refresh(!0)}},{key:"_handleLogbookLive",value:function(e){var t=this;e.detail.enable&&!this._liveUpdatesEnabled&&(this._pendingStreamMessages.forEach(function(e){return t._processStreamMessage(e)}),this._pendingStreamMessages=[]),this._liveUpdatesEnabled=e.detail.enable}},{key:"_filterAlwaysEmptyResults",get:function(){var e=this.entityIds,t=this.deviceIds;return Boolean(e||t)&&(!e||0===e.length)&&(!t||0===t.length)}},{key:"_unsubscribe",value:function(e){this._unsubLogbook&&(this._unsubLogbook.then(function(e){return e()}),this._unsubLogbook=void 0,this._logbookEntries=e?void 0:[],this._pendingStreamMessages=[])}},{key:"connectedCallback",value:function(){(0,_.A)(t,"connectedCallback",this,3)([]),this.hasUpdated&&this._subscribeLogbookPeriod(this._calculateLogbookPeriod())}},{key:"disconnectedCallback",value:function(){(0,_.A)(t,"disconnectedCallback",this,3)([]),this._unsubscribe(!0)}},{key:"_calculateLogbookPeriod",value:function(){var e=new Date;if("range"in this.time)return{now:e,startTime:this.time.range[0],endTime:this.time.range[1],purgeBeforePythonTime:void 0};if("recent"in this.time){var t=x(e,this.time.recent);return{now:e,startTime:new Date(1e3*t),endTime:new Date(e.getTime()+31536e6),purgeBeforePythonTime:x(e,this.time.recent)}}throw new Error("Unexpected time specified")}},{key:"_subscribeLogbookPeriod",value:(f=(0,l.A)((0,h.A)().m(function e(t){var o,n=this;return(0,h.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!this._unsubLogbook){e.n=1;break}return e.a(2);case 1:return e.p=1,this._logbookSubscriptionId++,this._unsubLogbook=(0,E.gM)(this.hass,function(e,t){t===n._logbookSubscriptionId&&n._processOrQueueStreamMessage(e)},t.startTime.toISOString(),t.endTime.toISOString(),this._logbookSubscriptionId,this.entityIds,this.deviceIds),e.n=2,this._unsubLogbook;case 2:e.n=4;break;case 3:e.p=3,o=e.v,this._unsubLogbook=void 0,this._error=o;case 4:return e.a(2)}},e,this,[[1,3]])})),function(e){return f.apply(this,arguments)})},{key:"_getLogBookData",value:(o=(0,l.A)((0,h.A)().m(function e(){var t;return(0,h.A)().w(function(e){for(;;)switch(e.n){case 0:if(this._error=void 0,!this._filterAlwaysEmptyResults){e.n=1;break}return this._unsubscribe(!1),e.a(2);case 1:if(!((t=this._calculateLogbookPeriod()).startTime>t.now)){e.n=2;break}return this._unsubscribe(!1),e.a(2);case 2:this._updateUsers(),(0,T.fe)(this.hass)&&this._updateTraceContexts(),this._subscribeLogbookPeriod(t);case 3:return e.a(2)}},e,this)})),function(){return o.apply(this,arguments)})}],[{key:"styles",get:function(){return[(0,k.AH)(a||(a=(0,u.A)([":host{display:block}:host([virtualize]){height:100%}.no-entries{text-align:center;padding:16px;color:var(--secondary-text-color)}.progress-wrapper{display:flex;justify-content:center;height:100%;align-items:center}"])))]}}]);var o,f,y}(k.WF);(0,f.Cg)([(0,y.MZ)({attribute:!1})],U.prototype,"hass",void 0),(0,f.Cg)([(0,y.MZ)({attribute:!1})],U.prototype,"time",void 0),(0,f.Cg)([(0,y.MZ)({attribute:!1})],U.prototype,"entityIds",void 0),(0,f.Cg)([(0,y.MZ)({attribute:!1})],U.prototype,"deviceIds",void 0),(0,f.Cg)([(0,y.MZ)({attribute:!1})],U.prototype,"stateFilter",void 0),(0,f.Cg)([(0,y.MZ)({type:Boolean})],U.prototype,"narrow",void 0),(0,f.Cg)([(0,y.MZ)({type:Boolean,reflect:!0})],U.prototype,"virtualize",void 0),(0,f.Cg)([(0,y.MZ)({type:Boolean,attribute:"no-icon"})],U.prototype,"noIcon",void 0),(0,f.Cg)([(0,y.MZ)({type:Boolean,attribute:"no-name"})],U.prototype,"noName",void 0),(0,f.Cg)([(0,y.MZ)({type:Boolean,attribute:"show-indicator"})],U.prototype,"showIndicator",void 0),(0,f.Cg)([(0,y.MZ)({type:Boolean,attribute:"relative-time"})],U.prototype,"relativeTime",void 0),(0,f.Cg)([(0,y.MZ)({attribute:"show-more-link",type:Boolean})],U.prototype,"showMoreLink",void 0),(0,f.Cg)([(0,y.wk)()],U.prototype,"_logbookEntries",void 0),(0,f.Cg)([(0,y.wk)()],U.prototype,"_traceContexts",void 0),(0,f.Cg)([(0,y.wk)()],U.prototype,"_userIdToName",void 0),(0,f.Cg)([(0,y.wk)()],U.prototype,"_error",void 0),U=(0,f.Cg)([(0,y.EM)("ha-logbook")],U),t()}catch(Z){t(Z)}})}}]);
//# sourceMappingURL=75591.bb6407b7629ccf11.js.map