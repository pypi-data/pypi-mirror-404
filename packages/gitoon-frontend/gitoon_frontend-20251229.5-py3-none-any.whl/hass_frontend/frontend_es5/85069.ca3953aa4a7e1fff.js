"use strict";(self.webpackChunkgitoon_frontend=self.webpackChunkgitoon_frontend||[]).push([["85069"],{19055:function(a,e,t){t.a(a,async function(a,r){try{t.r(e);var o,i,s,n,u,l=t(7739),c=t(78261),d=t(72153),h=t(44734),_=t(43080),v=t(69683),f=t(6454),p=(t(28706),t(2008),t(74423),t(44114),t(72712),t(26910),t(13609),t(18111),t(22489),t(7588),t(18237),t(69085),t(5506),t(79432),t(26099),t(16034),t(21699),t(42762),t(23500),t(40445)),g=t(96196),y=t(77845),m=t(94333),b=(t(76776),t(67094),t(38114)),k=t(23528),x=t(54706),A=t(3609),w=t(90433),E=t(20058),j=t(28455),C=t(48949),O=a([A,E,b,k]);[A,E,b,k]=O.then?(await O)():O;var M={group_by_floor:!0,group_by_area:!0},S=function(a){function e(){var a;(0,h.A)(this,e);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return(a=(0,v.A)(this,e,[].concat(r))).hassSubscribeRequiredHostProps=["_config"],a._valueFormatter=function(e){return"".concat((0,E.ZV)(e,a.hass.locale,e<.1?{maximumFractionDigits:3}:void 0)," ").concat(a._data.waterUnit)},a}return(0,f.A)(e,a),(0,_.A)(e,[{key:"setConfig",value:function(a){this._config=Object.assign(Object.assign({},M),a)}},{key:"hassSubscribe",value:function(){var a,e=this;return[(0,b.tb)(this.hass,{key:null===(a=this._config)||void 0===a?void 0:a.collection_key}).subscribe(function(a){e._data=a})]}},{key:"getCardSize",value:function(){return 5}},{key:"getGridOptions",value:function(){return{columns:12,min_columns:6,rows:6,min_rows:2}}},{key:"shouldUpdate",value:function(a){return a.has("_config")||a.has("_data")||a.has("_isMobileSize")}},{key:"render",value:function(){var a=this;if(!this._config)return g.s6;if(!this._data)return(0,g.qy)(o||(o=(0,d.A)(["",""])),this.hass.localize("ui.panel.lovelace.cards.energy.loading"));var e=this._data.prefs,t=e.energy_sources.filter(function(a){return"water"===a.type}),r=getComputedStyle(this),u=[],l=[],c=e.device_consumption_water.reduce(function(e,t){return e+(t.stat_consumption in a._data.stats&&(0,k.$j)(a._data.stats[t.stat_consumption])||0)},0),h=t.reduce(function(e,t){return e+(t.stat_energy_from in a._data.stats&&(0,k.$j)(a._data.stats[t.stat_energy_from])||0)},0),_=Math.max(c,h),v={id:"home",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.home"),value:Math.max(0,_),color:r.getPropertyValue("--primary-color").trim(),index:1};u.push(v);var f=r.getPropertyValue("--energy-water-color").trim();t.forEach(function(e){if("water"===e.type){var t=e.stat_energy_from in a._data.stats&&(0,k.$j)(a._data.stats[e.stat_energy_from])||0;t<.01||(u.push({id:e.stat_energy_from,label:(0,k.$O)(a.hass,e.stat_energy_from,a._data.statsMetadata[e.stat_energy_from]),value:t,color:f,index:0}),l.push({source:e.stat_energy_from,target:"home",value:t}))}});var p=v.value,y=[],b={};e.device_consumption_water.forEach(function(e,t){var o=e.stat_consumption in a._data.stats&&(0,k.$j)(a._data.stats[e.stat_consumption])||0;if(!(o<.01)){var i={id:e.stat_consumption,label:e.name||(0,k.$O)(a.hass,e.stat_consumption,a._data.statsMetadata[e.stat_consumption]),value:o,color:(0,w.fI)(t,r),index:4,parent:e.included_in_stat};i.parent?(b[i.id]=i.parent,l.push({source:i.parent,target:i.id})):p-=o,y.push(i)}});var x=y.filter(function(a){return!b[a.id]}),A=this._config,E=A.group_by_area,j=A.group_by_floor;if(E||j){var C=this._groupByFloorAndArea(x),O=C.areas,M=C.floors;Object.keys(M).sort(function(e,t){var r,o,i,s;return(null!==(r=null===(o=a.hass.floors[t])||void 0===o?void 0:o.level)&&void 0!==r?r:-1/0)-(null!==(i=null===(s=a.hass.floors[e])||void 0===s?void 0:s.level)&&void 0!==i?i:-1/0)}).forEach(function(e){var t="floor_".concat(e);"no_floor"!==e&&j?(u.push({id:t,label:a.hass.floors[e].name,value:M[e].value,index:2,color:r.getPropertyValue("--primary-color").trim()}),l.push({source:"home",target:t})):t="home",M[e].areas.forEach(function(e){var o;if("no_area"!==e&&E){var i="area_".concat(e);u.push({id:i,label:a.hass.areas[e].name,value:O[e].value,index:3,color:r.getPropertyValue("--primary-color").trim()}),l.push({source:t,target:i,value:O[e].value}),o=i}else o=t;O[e].devices.forEach(function(a){l.push({source:o,target:a.id,value:a.value})})})})}else x.forEach(function(a){l.push({source:"home",target:a.id,value:a.value})});var S=this._getDeviceSections(b,y);S.forEach(function(a,e){a.forEach(function(a){u.push(Object.assign(Object.assign({},a),{},{index:4+e}))})}),p>0&&(u.push({id:"untracked",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked_consumption"),value:p,color:r.getPropertyValue("--state-unavailable-color").trim(),index:3+S.length}),l.push({source:"home",target:"untracked",value:p}));var z=u.some(function(a){return a.value>0}),F="vertical"===this._config.layout||"horizontal"!==this._config.layout&&this._isMobileSize;return(0,g.qy)(i||(i=(0,d.A)([' <ha-card .header="','" class="','"> <div class="card-content"> '," </div> </ha-card> "])),this._config.title,(0,m.H)({"is-grid":"grid"===this.layout,"is-panel":"panel"===this.layout,"is-vertical":F}),z?(0,g.qy)(s||(s=(0,d.A)(['<ha-sankey-chart .data="','" .vertical="','" .valueFormatter="','"></ha-sankey-chart>'])),{nodes:u,links:l},F,this._valueFormatter):(0,g.qy)(n||(n=(0,d.A)(["",""])),this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period")))}},{key:"_groupByFloorAndArea",value:function(a){var e=this,t={no_area:{value:0,devices:[]}},r={no_floor:{value:0,areas:["no_area"]}};return a.forEach(function(a){var o=e.hass.states[a.id],i=o?(0,j.l)(o,e.hass.entities,e.hass.devices,e.hass.areas,e.hass.floors):{area:null,floor:null},s=i.area,n=i.floor;s?(s.area_id in t?(t[s.area_id].value+=a.value,t[s.area_id].devices.push(a)):t[s.area_id]={value:a.value,devices:[a]},n?n.floor_id in r?(r[n.floor_id].value+=a.value,r[n.floor_id].areas.includes(s.area_id)||r[n.floor_id].areas.push(s.area_id)):r[n.floor_id]={value:a.value,areas:[s.area_id]}:(r.no_floor.value+=a.value,r.no_floor.areas.includes(s.area_id)||r.no_floor.areas.unshift(s.area_id))):(t.no_area.value+=a.value,t.no_area.devices.push(a))}),{areas:t,floors:r}}},{key:"_getDeviceSections",value:function(a,e){var t=[],r=[],o=Object.values(a),i={};return e.forEach(function(e){var i=e.id in a;o.includes(e.id)&&!i?t.push(e):r.push(e)}),Object.entries(a).forEach(function(a){var e=(0,c.A)(a,2),r=e[0],o=e[1];t.some(function(a){return a.id===o})||(i[r]=o)}),t.length>0?[t].concat((0,l.A)(this._getDeviceSections(i,r))):[e]}}])}((0,x.E)((0,C.Q)(g.WF)));S.styles=(0,g.AH)(u||(u=(0,d.A)(["ha-card{height:400px;display:flex;flex-direction:column;--chart-max-height:none}ha-card.is-vertical{height:500px}ha-card.is-grid,ha-card.is-panel{height:100%}.card-content{flex:1;display:flex}"]))),(0,p.Cg)([(0,y.MZ)({attribute:!1})],S.prototype,"hass",void 0),(0,p.Cg)([(0,y.MZ)({attribute:!1})],S.prototype,"layout",void 0),(0,p.Cg)([(0,y.wk)()],S.prototype,"_config",void 0),(0,p.Cg)([(0,y.wk)()],S.prototype,"_data",void 0),S=(0,p.Cg)([(0,y.EM)("hui-water-sankey-card")],S),r()}catch(z){r(z)}})}}]);
//# sourceMappingURL=85069.ca3953aa4a7e1fff.js.map