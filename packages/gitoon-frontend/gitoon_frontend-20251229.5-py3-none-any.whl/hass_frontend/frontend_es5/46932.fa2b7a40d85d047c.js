"use strict";(self.webpackChunkgitoon_frontend=self.webpackChunkgitoon_frontend||[]).push([["46932"],{18427:function(t,e,a){a.d(e,{g:function(){return n}});a(42762);var r=a(79468),o=a(39274);function n(t,e,a,n,s,i){var c=t.getPropertyValue(s+"-"+i).trim(),u=c.length>0?c:t.getPropertyValue(s).trim(),d=(0,r.RQ)(u);return 0===c.length&&i&&(d=(0,r.v2)((0,r.BE)(e?(0,o.T)((0,r.Nc)((0,r.xp)(d)),i):(0,o.d)((0,r.Nc)((0,r.xp)(d)),i)))),n?d+=a?"32":"7F":a&&(d+="7F"),d}},40345:function(t,e,a){a.a(t,async function(t,e){try{var r,o,n=a(72153),s=a(44734),i=a(43080),c=a(69683),u=a(6454),d=a(40445),l=a(96196),h=a(77845),g=a(34127),p=t([g]);g=(p.then?(await p)():p)[0];var _=function(t){function e(){return(0,s.A)(this,e),(0,c.A)(this,e,arguments)}return(0,u.A)(e,t),(0,i.A)(e,[{key:"render",value:function(){var t="energy-graph-chip-".concat(Date.now());return(0,l.qy)(r||(r=(0,n.A)([' <div class="chip" id="','"> <slot></slot> </div> <ha-tooltip for="','" placement="top">',"</ha-tooltip> "])),t,t,this.tooltip)}}])}(l.WF);_.styles=(0,l.AH)(o||(o=(0,n.A)([".chip{font-size:var(--ha-font-size-m);font-weight:var(--ha-font-weight-medium);padding:var(--ha-space-1) var(--ha-space-2);border-radius:var(--ha-border-radius-md);border:1px solid var(--divider-color)}"]))),(0,d.Cg)([(0,h.MZ)({type:String})],_.prototype,"tooltip",void 0),_=(0,d.Cg)([(0,h.EM)("hui-energy-graph-chip")],_),e()}catch(f){e(f)}})},14207:function(t,e,a){a.a(t,async function(t,r){try{a.r(e),a.d(e,{HuiEnergyUsageGraphCard:function(){return Z}});var o,n,s,i,c,u=a(78261),d=a(61397),l=a(7739),h=a(31432),g=a(50264),p=a(72153),_=a(44734),f=a(43080),y=a(69683),v=a(6454),m=(a(28706),a(74423),a(44114),a(26910),a(18111),a(7588),a(13579),a(69085),a(5506),a(79432),a(26099),a(16034),a(23500),a(40445)),b=a(81859),A=a(40600),k=a(73684),w=a(96196),C=a(77845),x=a(94333),E=a(22786),O=a(18427),S=a(20058),j=a(44439),D=(a(76776),a(40345)),z=a(38114),M=a(23528),q=a(54706),R=a(784),T=a(97372),H=t([j,D,S,z,T,M]);[j,D,S,z,T,M]=H.then?(await H)():H;var V={to_grid:"--energy-grid-return-color",to_battery:"--energy-battery-in-color",from_grid:"--energy-grid-consumption-color",used_grid:"--energy-grid-consumption-color",used_solar:"--energy-solar-color",used_battery:"--energy-battery-out-color"},Z=function(t){function e(){var t;(0,_.A)(this,e);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(t=(0,y.A)(this,e,[].concat(r)))._chartData=[],t._start=(0,b.R)(),t._end=(0,A.o)(),t.hassSubscribeRequiredHostProps=["_config"],t._formatTotal=function(e){return e>0?t.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_consumed",{num:(0,S.ZV)(e,t.hass.locale)}):t.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_returned",{num:(0,S.ZV)(-e,t.hass.locale)})},t._createOptions=(0,E.A)(function(e,a,r,o,n,s){var i=(0,T.od)(e,a,r,o,"kWh",n,s,t._formatTotal);return Object.assign(Object.assign({},i),{},{tooltip:Object.assign(Object.assign({},i.tooltip),{},{formatter:function(t){var e,a;return Array.isArray(t)?(t.sort(function(t,e){var a,r,o=null===(a=t.value)||void 0===a?void 0:a[1],n=null===(r=e.value)||void 0===r?void 0:r[1];return o>0&&n<0?-1:n>0&&o<0?1:o>0?e.componentIndex-t.componentIndex:t.componentIndex-e.componentIndex}),null===(e=i.tooltip)||void 0===e||null===(a=e.formatter)||void 0===a?void 0:a.call(e,t)):""}})})}),t}return(0,v.A)(e,t),(0,f.A)(e,[{key:"hassSubscribe",value:function(){var t,e=this;return[(0,z.tb)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe(function(t){return e._getStatistics(t)})]}},{key:"getCardSize",value:function(){return 3}},{key:"setConfig",value:function(t){this._config=t}},{key:"shouldUpdate",value:function(t){return(0,R.xP)(this,t)||t.size>1||!t.has("hass")}},{key:"render",value:function(){return this.hass&&this._config?(0,w.qy)(o||(o=(0,p.A)([" <ha-card> ",' <div class="content ','"> <ha-chart-base .hass="','" .data="','" .options="','" chart-type="bar"></ha-chart-base> '," </div> </ha-card> "])),this._config.title?(0,w.qy)(n||(n=(0,p.A)([' <div class="card-header"> <span>',"</span> "," </div>"])),this._config.title,this._total?(0,w.qy)(s||(s=(0,p.A)(['<hui-energy-graph-chip .tooltip="','"> '," </hui-energy-graph-chip>"])),this._formatTotal(this._total),this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_usage",{num:(0,S.ZV)(this._total,this.hass.locale)})):w.s6):w.s6,(0,x.H)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,this._compareStart,this._compareEnd),this._chartData.some(function(t){return t.data.length})?"":(0,w.qy)(i||(i=(0,p.A)(['<div class="no-data"> '," </div>"])),(0,k.c)(this._start)?this.hass.localize("ui.panel.lovelace.cards.energy.no_data"):this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period"))):w.s6}},{key:"_getStatistics",value:(a=(0,g.A)((0,d.A)().m(function t(e){var a,r,o,n,s,i,c,u,g,p,_,f,y,v,m,b,k,w,C,x,E;return(0,d.A)().w(function(t){for(;;)switch(t.p=t.n){case 0:a=[],r={},o=(0,h.A)(e.prefs.energy_sources),t.p=1,o.s();case 2:if((n=o.n()).done){t.n=7;break}if("solar"!==(s=n.value).type){t.n=3;break}return r.solar?r.solar.push(s.stat_energy_from):r.solar=[s.stat_energy_from],t.a(3,6);case 3:if("battery"!==s.type){t.n=4;break}return r.to_battery?(r.to_battery.push(s.stat_energy_to),r.from_battery.push(s.stat_energy_from)):(r.to_battery=[s.stat_energy_to],r.from_battery=[s.stat_energy_from]),t.a(3,6);case 4:if("grid"===s.type){t.n=5;break}return t.a(3,6);case 5:i=(0,h.A)(s.flow_from);try{for(i.s();!(c=i.n()).done;)u=c.value,r.from_grid?r.from_grid.push(u.stat_energy_from):r.from_grid=[u.stat_energy_from]}catch(d){i.e(d)}finally{i.f()}g=(0,h.A)(s.flow_to);try{for(g.s();!(p=g.n()).done;)_=p.value,r.to_grid?r.to_grid.push(_.stat_energy_to):r.to_grid=[_.stat_energy_to]}catch(d){g.e(d)}finally{g.f()}case 6:t.n=2;break;case 7:t.n=9;break;case 8:t.p=8,E=t.v,o.e(E);case 9:return t.p=9,o.f(),t.f(9);case 10:f=getComputedStyle(this),y={},Object.keys(V).forEach(function(t){y[t]={},"used_grid"!==t&&"used_solar"!==t&&"used_battery"!==t&&r[t]&&Object.values(r[t]).forEach(function(e,a){y[t][e]=a})}),v={used_grid:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.combined_from_grid"),used_solar:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_solar"),used_battery:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_battery")},this._start=e.start,this._end=e.end||(0,A.o)(),this._compareStart=e.startCompare,this._compareEnd=e.endCompare,m=(0,z.gv)(e),b=m.summedData,k=m.compareSummedData,w=(0,z.DR)(b,k),C=w.consumption,x=w.compareConsumption,e.statsCompare&&a.push.apply(a,(0,l.A)(this._processDataSet(e.statsCompare,e.statsMetadata,k,x,r,y,f,v,!0))),a.push({id:"compare-placeholder",type:"bar",stack:e.statsCompare?"compare":"usage",data:[],order:0}),a.push.apply(a,(0,l.A)(this._processDataSet(e.stats,e.statsMetadata,b,C,r,y,f,v,!1))),a.sort(function(t,e){return t.order-e.order}),(0,T.RR)(a),this._chartData=a,this._total=this._processTotal(C);case 11:return t.a(2)}},t,this,[[1,8,9,10]])})),function(t){return a.apply(this,arguments)})},{key:"_processTotal",value:function(t){return t.total.used_total>0?t.total.used_total:void 0}},{key:"_processDataSet",value:function(t,e,a,r,o,n,s,i){var c=this,d=arguments.length>8&&void 0!==arguments[8]&&arguments[8],l=[],g={};if(Object.entries(o).forEach(function(e){var a=(0,u.A)(e,2),r=a[0],o=a[1];if(["to_grid","from_grid","to_battery"].includes(r)){var n={};o.forEach(function(e){var a=t[e];if(a){var r={};a.forEach(function(t){if(null!==t.change&&void 0!==t.change){var e=t.change;t.start in r||(r[t.start]=e)}}),n[e]=r}}),g[r]=n}}),g.used_solar={used_solar:r.used_solar},g.used_battery={used_battery:r.used_battery},g.from_grid&&a.to_battery){for(var p={},_=function(){var t=(0,u.A)(y[f],2),e=t[0];if(!t[1])return 1;for(var a,o=0,n=0,s=Object.entries(g.from_grid);n<s.length;n++){var i=(0,u.A)(s[n],2),c=i[0];if(i[1][e]&&(a=c,o++),o>1)break}1===o?g.from_grid[a][e]=r.used_grid[e]:(Object.values(g.from_grid).forEach(function(t){delete t[e]}),p[e]=r.used_grid[e])},f=0,y=Object.entries(r.grid_to_battery);f<y.length;f++)_();g.used_grid={used_grid:p}}var v=a.timestamps,m=(0,T.ok)(this._start,this._compareStart);return Object.entries(g).forEach(function(t,a){var r=(0,u.A)(t,2),o=r[0],p=r[1];Object.entries(p).forEach(function(t){var r,p,_,f=(0,u.A)(t,2),y=f[0],b=f[1],A=[],k=(0,h.A)(v);try{for(k.s();!(_=k.n()).done;){var w=_.value,C=b[w]||0,x=[new Date(w),C&&["to_grid","to_battery"].includes(o)?-1*C:C];d&&(x[2]=x[0],x[0]=m(x[0])),A.push(x)}}catch(E){k.e(E)}finally{k.f()}l.push({id:"".concat(d?"compare-":"").concat(y,"-").concat(o),type:"bar",cursor:"default",name:o in i?i[o]:(0,M.$O)(c.hass,y,e[y]),order:"used_solar"===o?1:"to_battery"===o?Object.keys(g).length:a+2,barMaxWidth:50,itemStyle:{borderColor:(0,O.g)(s,c.hass.themes.darkMode,!1,d,V[o],null===(r=n[o])||void 0===r?void 0:r[y])},color:(0,O.g)(s,c.hass.themes.darkMode,!0,d,V[o],null===(p=n[o])||void 0===p?void 0:p[y]),stack:d?"compare":"usage",data:A})})}),l}}]);var a}((0,q.E)(w.WF));Z.styles=(0,w.AH)(c||(c=(0,p.A)(["ha-card{height:100%}.card-header{display:flex;justify-content:space-between;align-items:center;padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}.no-data{position:absolute;height:100%;top:0;left:0;right:0;display:flex;justify-content:center;align-items:center;padding:20%;margin-left:32px;margin-inline-start:32px;margin-inline-end:initial;box-sizing:border-box}"]))),(0,m.Cg)([(0,C.MZ)({attribute:!1})],Z.prototype,"hass",void 0),(0,m.Cg)([(0,C.wk)()],Z.prototype,"_config",void 0),(0,m.Cg)([(0,C.wk)()],Z.prototype,"_chartData",void 0),(0,m.Cg)([(0,C.wk)()],Z.prototype,"_start",void 0),(0,m.Cg)([(0,C.wk)()],Z.prototype,"_end",void 0),(0,m.Cg)([(0,C.wk)()],Z.prototype,"_compareStart",void 0),(0,m.Cg)([(0,C.wk)()],Z.prototype,"_compareEnd",void 0),(0,m.Cg)([(0,C.wk)()],Z.prototype,"_total",void 0),Z=(0,m.Cg)([(0,C.EM)("hui-energy-usage-graph-card")],Z),r()}catch(F){r(F)}})},43382:function(t,e,a){a.d(e,{A:function(){return o}});var r=a(51039);function o(t){return(0,r.w)(t,Date.now())}},83309:function(t,e,a){a.d(e,{r:function(){return s}});var r=a(78261),o=a(74816),n=a(35932);function s(t,e,a){var s=(0,o.x)(null==a?void 0:a.in,t,e),i=(0,r.A)(s,2),c=i[0],u=i[1];return+(0,n.o)(c)===+(0,n.o)(u)}},73684:function(t,e,a){a.d(e,{c:function(){return s}});var r=a(51039),o=a(43382),n=a(83309);function s(t,e){return(0,n.r)((0,r.w)((null==e?void 0:e.in)||t,t),(0,o.A)((null==e?void 0:e.in)||t))}}}]);
//# sourceMappingURL=46932.fa2b7a40d85d047c.js.map