"""Initial schema

Revision ID: 0543a383957b
Revises:
Create Date: 2026-01-19 19:21:12.802707

"""

from typing import Sequence, Union

import sqlalchemy as sa
from alembic import op

# revision identifiers, used by Alembic.
revision: str = "0543a383957b"
down_revision: Union[str, Sequence[str], None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
        "f_capacity",
        sa.Column("user_id", sa.BigInteger(), nullable=False),
        sa.Column("used_capacity", sa.BigInteger(), nullable=False),
        sa.Column("total_capacity", sa.BigInteger(), nullable=False),
        sa.PrimaryKeyConstraint("user_id"),
    )
    op.create_table(
        "f_note_page_content",
        sa.Column("id", sa.BigInteger(), nullable=False),
        sa.Column("file_id", sa.BigInteger(), nullable=False),
        sa.Column("page_index", sa.BigInteger(), nullable=False),
        sa.Column("page_id", sa.String(), nullable=False),
        sa.Column("content_hash", sa.String(), nullable=True),
        sa.Column("text_content", sa.Text(), nullable=True),
        sa.Column("embedding", sa.Text(), nullable=True),
        sa.Column("create_time", sa.BigInteger(), nullable=False),
        sa.Column("update_time", sa.BigInteger(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("file_id", "page_id", name="uq_note_page_content"),
    )
    op.create_index(
        op.f("ix_f_note_page_content_file_id"),
        "f_note_page_content",
        ["file_id"],
        unique=False,
    )
    op.create_table(
        "f_recycle_file",
        sa.Column("id", sa.BigInteger(), nullable=False),
        sa.Column("file_id", sa.BigInteger(), nullable=False),
        sa.Column("user_id", sa.BigInteger(), nullable=False),
        sa.Column("file_name", sa.String(), nullable=False),
        sa.Column("size", sa.BigInteger(), nullable=False),
        sa.Column("is_folder", sa.String(length=1), nullable=False),
        sa.Column("delete_time", sa.BigInteger(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_table(
        "f_summary",
        sa.Column("id", sa.BigInteger(), nullable=False),
        sa.Column("user_id", sa.BigInteger(), nullable=False),
        sa.Column("file_id", sa.BigInteger(), nullable=True),
        sa.Column("name", sa.String(), nullable=True),
        sa.Column("unique_identifier", sa.String(), nullable=False),
        sa.Column("parent_unique_identifier", sa.String(), nullable=True),
        sa.Column("content", sa.Text(), nullable=True),
        sa.Column("source_path", sa.String(), nullable=True),
        sa.Column("data_source", sa.String(), nullable=True),
        sa.Column("source_type", sa.BigInteger(), nullable=True),
        sa.Column("is_summary_group", sa.Boolean(), nullable=False),
        sa.Column("description", sa.String(), nullable=True),
        sa.Column("tags", sa.String(), nullable=True),
        sa.Column("md5_hash", sa.String(), nullable=True),
        sa.Column("extra_metadata", sa.Text(), nullable=True),
        sa.Column("comment_str", sa.String(), nullable=True),
        sa.Column("comment_handwrite_name", sa.String(), nullable=True),
        sa.Column("handwrite_inner_name", sa.String(), nullable=True),
        sa.Column("handwrite_md5", sa.String(), nullable=True),
        sa.Column("creation_time", sa.BigInteger(), nullable=True),
        sa.Column("last_modified_time", sa.BigInteger(), nullable=True),
        sa.Column("is_deleted", sa.Boolean(), nullable=False),
        sa.Column("create_time", sa.BigInteger(), nullable=False),
        sa.Column("update_time", sa.BigInteger(), nullable=False),
        sa.Column("author", sa.String(), nullable=True),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("unique_identifier"),
    )
    op.create_index(
        op.f("ix_f_summary_file_id"), "f_summary", ["file_id"], unique=False
    )
    op.create_index(
        op.f("ix_f_summary_parent_unique_identifier"),
        "f_summary",
        ["parent_unique_identifier"],
        unique=False,
    )
    op.create_index(
        op.f("ix_f_summary_user_id"), "f_summary", ["user_id"], unique=False
    )
    op.create_table(
        "f_summary_tag",
        sa.Column("id", sa.BigInteger(), nullable=False),
        sa.Column("user_id", sa.BigInteger(), nullable=False),
        sa.Column("name", sa.String(), nullable=False),
        sa.Column("unique_identifier", sa.String(), nullable=False),
        sa.Column("create_time", sa.BigInteger(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("unique_identifier"),
    )
    op.create_index(
        op.f("ix_f_summary_tag_user_id"), "f_summary_tag", ["user_id"], unique=False
    )
    op.create_table(
        "f_system_task",
        sa.Column("id", sa.BigInteger(), nullable=False),
        sa.Column("file_id", sa.BigInteger(), nullable=False),
        sa.Column("task_type", sa.String(), nullable=False),
        sa.Column("key", sa.String(), nullable=False),
        sa.Column("status", sa.String(), nullable=False),
        sa.Column("data", sa.Text(), nullable=True),
        sa.Column("retry_count", sa.BigInteger(), nullable=False),
        sa.Column("last_error", sa.Text(), nullable=True),
        sa.Column("create_time", sa.BigInteger(), nullable=False),
        sa.Column("update_time", sa.BigInteger(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("file_id", "task_type", "key", name="uq_system_task"),
    )
    op.create_index(
        op.f("ix_f_system_task_file_id"), "f_system_task", ["file_id"], unique=False
    )
    op.create_index(
        op.f("ix_f_system_task_task_type"), "f_system_task", ["task_type"], unique=False
    )
    op.create_table(
        "f_user_file",
        sa.Column("id", sa.BigInteger(), nullable=False),
        sa.Column("user_id", sa.BigInteger(), nullable=False),
        sa.Column("directory_id", sa.BigInteger(), nullable=False),
        sa.Column("file_name", sa.String(), nullable=False),
        sa.Column("is_folder", sa.String(length=1), nullable=False),
        sa.Column("size", sa.BigInteger(), nullable=False),
        sa.Column("md5", sa.String(), nullable=True),
        sa.Column("storage_key", sa.String(), nullable=True),
        sa.Column("is_active", sa.String(length=1), nullable=False),
        sa.Column("create_time", sa.BigInteger(), nullable=False),
        sa.Column("update_time", sa.BigInteger(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        "idx_user_dir_active",
        "f_user_file",
        ["user_id", "directory_id", "is_active"],
        unique=False,
    )
    op.create_index(
        op.f("ix_f_user_file_directory_id"),
        "f_user_file",
        ["directory_id"],
        unique=False,
    )
    op.create_index(
        op.f("ix_f_user_file_user_id"), "f_user_file", ["user_id"], unique=False
    )
    op.create_table(
        "key_values",
        sa.Column("key", sa.String(), nullable=False),
        sa.Column("value", sa.String(), nullable=False),
        sa.Column("expiry", sa.Float(), nullable=False),
        sa.PrimaryKeyConstraint("key"),
    )
    op.create_index(
        op.f("ix_key_values_expiry"), "key_values", ["expiry"], unique=False
    )
    op.create_table(
        "t_schedule_task",
        sa.Column("task_id", sa.BigInteger(), nullable=False),
        sa.Column("task_list_id", sa.BigInteger(), nullable=False),
        sa.Column("user_id", sa.BigInteger(), nullable=False),
        sa.Column("title", sa.String(), nullable=False),
        sa.Column("detail", sa.String(), nullable=True),
        sa.Column("status", sa.String(), nullable=False),
        sa.Column("importance", sa.String(), nullable=True),
        sa.Column("due_time", sa.BigInteger(), nullable=True),
        sa.Column("completed_time", sa.BigInteger(), nullable=True),
        sa.Column("recurrence", sa.String(), nullable=True),
        sa.Column("is_reminder_on", sa.Boolean(), nullable=False),
        sa.Column("create_time", sa.BigInteger(), nullable=False),
        sa.Column("update_time", sa.BigInteger(), nullable=False),
        sa.PrimaryKeyConstraint("task_id"),
    )
    op.create_index(
        op.f("ix_t_schedule_task_task_list_id"),
        "t_schedule_task",
        ["task_list_id"],
        unique=False,
    )
    op.create_index(
        op.f("ix_t_schedule_task_user_id"), "t_schedule_task", ["user_id"], unique=False
    )
    op.create_table(
        "t_schedule_task_group",
        sa.Column("task_list_id", sa.BigInteger(), nullable=False),
        sa.Column("user_id", sa.BigInteger(), nullable=False),
        sa.Column("title", sa.String(), nullable=False),
        sa.Column("create_time", sa.BigInteger(), nullable=False),
        sa.PrimaryKeyConstraint("task_list_id"),
    )
    op.create_index(
        op.f("ix_t_schedule_task_group_user_id"),
        "t_schedule_task_group",
        ["user_id"],
        unique=False,
    )
    op.create_table(
        "users",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("email", sa.String(), nullable=False),
        sa.Column("password_md5", sa.String(), nullable=False),
        sa.Column("is_active", sa.Boolean(), nullable=False),
        sa.Column("display_name", sa.String(), nullable=True),
        sa.Column("phone", sa.String(), nullable=True),
        sa.Column("avatar", sa.String(), nullable=True),
        sa.Column("total_capacity", sa.String(), nullable=False),
        sa.Column("is_admin", sa.Boolean(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(op.f("ix_users_email"), "users", ["email"], unique=True)
    op.create_table(
        "devices",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=False),
        sa.Column("equipment_no", sa.String(), nullable=False),
        sa.ForeignKeyConstraint(
            ["user_id"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        op.f("ix_devices_equipment_no"), "devices", ["equipment_no"], unique=True
    )
    op.create_index(op.f("ix_devices_user_id"), "devices", ["user_id"], unique=False)
    op.create_table(
        "login_records",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=False),
        sa.Column("login_method", sa.String(), nullable=True),
        sa.Column("equipment", sa.String(), nullable=True),
        sa.Column("ip", sa.String(), nullable=True),
        sa.Column("create_time", sa.String(), nullable=False),
        sa.ForeignKeyConstraint(
            ["user_id"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        op.f("ix_login_records_create_time"),
        "login_records",
        ["create_time"],
        unique=False,
    )
    op.create_index(
        op.f("ix_login_records_user_id"), "login_records", ["user_id"], unique=False
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f("ix_login_records_user_id"), table_name="login_records")
    op.drop_index(op.f("ix_login_records_create_time"), table_name="login_records")
    op.drop_table("login_records")
    op.drop_index(op.f("ix_devices_user_id"), table_name="devices")
    op.drop_index(op.f("ix_devices_equipment_no"), table_name="devices")
    op.drop_table("devices")
    op.drop_index(op.f("ix_users_email"), table_name="users")
    op.drop_table("users")
    op.drop_index(
        op.f("ix_t_schedule_task_group_user_id"), table_name="t_schedule_task_group"
    )
    op.drop_table("t_schedule_task_group")
    op.drop_index(op.f("ix_t_schedule_task_user_id"), table_name="t_schedule_task")
    op.drop_index(op.f("ix_t_schedule_task_task_list_id"), table_name="t_schedule_task")
    op.drop_table("t_schedule_task")
    op.drop_index(op.f("ix_key_values_expiry"), table_name="key_values")
    op.drop_table("key_values")
    op.drop_index(op.f("ix_f_user_file_user_id"), table_name="f_user_file")
    op.drop_index(op.f("ix_f_user_file_directory_id"), table_name="f_user_file")
    op.drop_index("idx_user_dir_active", table_name="f_user_file")
    op.drop_table("f_user_file")
    op.drop_index(op.f("ix_f_system_task_task_type"), table_name="f_system_task")
    op.drop_index(op.f("ix_f_system_task_file_id"), table_name="f_system_task")
    op.drop_table("f_system_task")
    op.drop_index(op.f("ix_f_summary_tag_user_id"), table_name="f_summary_tag")
    op.drop_table("f_summary_tag")
    op.drop_index(op.f("ix_f_summary_user_id"), table_name="f_summary")
    op.drop_index(op.f("ix_f_summary_parent_unique_identifier"), table_name="f_summary")
    op.drop_index(op.f("ix_f_summary_file_id"), table_name="f_summary")
    op.drop_table("f_summary")
    op.drop_table("f_recycle_file")
    op.drop_index(
        op.f("ix_f_note_page_content_file_id"), table_name="f_note_page_content"
    )
    op.drop_table("f_note_page_content")
    op.drop_table("f_capacity")
    # ### end Alembic commands ###
