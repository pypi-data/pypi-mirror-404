"""Secret detection rules.

Patterns for detecting hardcoded secrets, API keys, and credentials.
"""

from codesage.security.models import SecurityRule, Severity

SECRETS_RULES = [
    SecurityRule(
        id="SEC001",
        name="Hardcoded Password",
        pattern=r"""(?:password|passwd|pwd)\s*[=:]\s*['\"][^'\"]{4,}['\"]""",
        severity=Severity.CRITICAL,
        message="Hardcoded password detected",
        description="Passwords should never be hardcoded in source code",
        category="secrets",
        cwe_id="CWE-798",
        fix_suggestion="Use environment variables or a secrets manager",
    ),
    SecurityRule(
        id="SEC002",
        name="Hardcoded API Key",
        pattern=r"""(?:api[_-]?key|apikey|api[_-]?secret)\s*[=:]\s*['\"][^'\"]{8,}['\"]""",
        severity=Severity.CRITICAL,
        message="Hardcoded API key detected",
        description="API keys should be stored securely, not in source code",
        category="secrets",
        cwe_id="CWE-798",
        fix_suggestion="Use environment variables: os.getenv('API_KEY')",
    ),
    SecurityRule(
        id="SEC003",
        name="AWS Access Key",
        pattern=r"""AKIA[0-9A-Z]{16}""",
        severity=Severity.CRITICAL,
        message="AWS Access Key ID detected",
        description="AWS credentials should never be committed to source control",
        category="secrets",
        cwe_id="CWE-798",
        fix_suggestion="Use AWS credentials file or IAM roles",
    ),
    SecurityRule(
        id="SEC004",
        name="AWS Secret Key",
        pattern=r"""(?:aws)?[_-]?secret[_-]?(?:access)?[_-]?key\s*[=:]\s*['\"][A-Za-z0-9/+=]{40}['\"]""",
        severity=Severity.CRITICAL,
        message="AWS Secret Access Key detected",
        description="AWS secret keys should never be in source code",
        category="secrets",
        cwe_id="CWE-798",
        fix_suggestion="Use AWS credentials file or environment variables",
    ),
    SecurityRule(
        id="SEC005",
        name="Private Key",
        pattern=r"""-----BEGIN\s+(?:RSA|DSA|EC|OPENSSH|PGP)?\s*PRIVATE\s+KEY-----""",
        severity=Severity.CRITICAL,
        message="Private key detected in source code",
        description="Private keys should never be committed to source control",
        category="secrets",
        cwe_id="CWE-321",
        fix_suggestion="Store private keys in secure key management systems",
    ),
    SecurityRule(
        id="SEC006",
        name="JWT Token",
        pattern=r"""eyJ[A-Za-z0-9_-]{10,}\.eyJ[A-Za-z0-9_-]{10,}\.[A-Za-z0-9_-]{10,}""",
        severity=Severity.HIGH,
        message="JWT token detected in source code",
        description="JWT tokens should not be hardcoded",
        category="secrets",
        cwe_id="CWE-798",
        fix_suggestion="Generate tokens dynamically at runtime",
    ),
    SecurityRule(
        id="SEC007",
        name="Generic Secret Assignment",
        pattern=r"""(?:secret|token|auth)[_-]?(?:key|token)?\s*[=:]\s*['\"][^'\"]{8,}['\"]""",
        severity=Severity.HIGH,
        message="Potential secret or token detected",
        description="Secrets and tokens should be externalized",
        category="secrets",
        cwe_id="CWE-798",
        fix_suggestion="Use environment variables or secrets manager",
    ),
    SecurityRule(
        id="SEC008",
        name="Database Connection String",
        pattern=r"""(?:mysql|postgres|postgresql|mongodb|redis|amqp)://[^:]+:[^@]+@[^\s'"]+""",
        severity=Severity.CRITICAL,
        message="Database connection string with credentials detected",
        description="Database credentials should not be in source code",
        category="secrets",
        cwe_id="CWE-798",
        fix_suggestion="Use environment variables for connection strings",
    ),
]
