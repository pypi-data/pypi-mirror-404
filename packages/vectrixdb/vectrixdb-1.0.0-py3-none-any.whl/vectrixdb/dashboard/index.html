<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VectrixDB Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <!-- Cytoscape.js for graph visualization -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.28.1/cytoscape.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --primary: #dc004e;
      --primary-light: #ff5983;
      --primary-dark: #9a0036;
      --bg-paper: #1e1e1e;
      --bg-default: #121212;
      --bg-elevated: #2d2d2d;
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.7);
      --text-disabled: rgba(255, 255, 255, 0.5);
      --divider: rgba(255, 255, 255, 0.12);
      --action-hover: rgba(255, 255, 255, 0.08);
      --action-selected: rgba(255, 255, 255, 0.16);
      --success: #66bb6a;
      --warning: #ffa726;
      --error: #f44336;
      --info: #29b6f6;
    }

    html.light {
      --bg-paper: #ffffff;
      --bg-default: #f5f5f5;
      --bg-elevated: #eeeeee;
      --text-primary: #212121;
      --text-secondary: rgba(0, 0, 0, 0.6);
      --text-disabled: rgba(0, 0, 0, 0.38);
      --divider: rgba(0, 0, 0, 0.12);
      --action-hover: rgba(0, 0, 0, 0.04);
      --action-selected: rgba(0, 0, 0, 0.08);
    }

    body {
      font-family: 'Roboto', sans-serif;
      background: var(--bg-default);
      color: var(--text-primary);
      min-height: 100vh;
      font-size: 14px;
      line-height: 1.5;
    }

    .app { display: flex; flex-direction: column; min-height: 100vh; }

    /* AppBar */
    .appbar {
      background: var(--bg-paper);
      height: 64px;
      display: flex;
      align-items: center;
      padding: 0 24px;
      border-bottom: 1px solid var(--divider);
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 1100;
    }

    .appbar-logo {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      color: var(--text-primary);
    }

    .appbar-logo svg { width: 32px; height: 32px; fill: var(--primary); }
    .appbar-title { font-size: 20px; font-weight: 500; }
    .appbar-spacer { flex: 1; }
    .appbar-actions { display: flex; align-items: center; gap: 8px; }

    .icon-btn {
      width: 40px; height: 40px;
      border-radius: 50%;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }
    .icon-btn:hover { background: var(--action-hover); }
    .icon-btn svg { width: 24px; height: 24px; }

    .auth-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 16px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
    }
    .auth-badge.read-only { background: rgba(255, 167, 38, 0.15); color: var(--warning); }
    .auth-badge.authenticated { background: rgba(102, 187, 106, 0.15); color: var(--success); }
    .auth-badge svg { width: 14px; height: 14px; }

    /* WebSocket Connection Status */
    .ws-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 16px;
      font-size: 12px;
      font-weight: 500;
      cursor: help;
    }
    .ws-status .ws-dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }
    .ws-status.connected { background: rgba(102, 187, 106, 0.15); color: var(--success); }
    .ws-status.connected .ws-dot { background: var(--success); }
    .ws-status.disconnected { background: rgba(244, 67, 54, 0.15); color: var(--error); }
    .ws-status.disconnected .ws-dot { background: var(--error); animation: none; }
    .ws-status.connecting { background: rgba(255, 167, 38, 0.15); color: var(--warning); }
    .ws-status.connecting .ws-dot { background: var(--warning); }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Main Layout */
    .main-layout { display: flex; margin-top: 64px; min-height: calc(100vh - 64px); }

    .drawer {
      width: 240px;
      background: var(--bg-paper);
      border-right: 1px solid var(--divider);
      position: fixed;
      top: 64px; left: 0; bottom: 0;
      overflow-y: auto;
    }

    .drawer-list { padding: 8px 0; }

    .drawer-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 12px 16px;
      color: var(--text-primary);
      cursor: pointer;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      font-family: inherit;
      font-size: 14px;
      transition: background 0.2s;
    }
    .drawer-item:hover { background: var(--action-hover); }
    .drawer-item.active { background: var(--action-selected); color: var(--primary); }
    .drawer-item svg { width: 20px; height: 20px; opacity: 0.7; }
    .drawer-item.active svg { opacity: 1; color: var(--primary); }

    .drawer-divider { height: 1px; background: var(--divider); margin: 8px 0; }

    .drawer-section {
      padding: 16px 16px 8px;
      font-size: 11px;
      font-weight: 500;
      color: var(--text-disabled);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .content { flex: 1; margin-left: 240px; padding: 24px; }

    .page { display: none; }
    .page.active { display: block; }

    .page-title { font-size: 24px; font-weight: 400; margin-bottom: 24px; }

    /* Cards */
    .card {
      background: var(--bg-paper);
      border-radius: 8px;
      border: 1px solid var(--divider);
      overflow: hidden;
    }

    .card-header {
      padding: 16px;
      border-bottom: 1px solid var(--divider);
      font-weight: 500;
    }

    .card-body { padding: 16px; }

    /* Collections Grid */
    .collections-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 16px;
    }

    .collection-card {
      background: var(--bg-paper);
      border-radius: 8px;
      border: 1px solid var(--divider);
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }
    .collection-card:hover { border-color: var(--primary); }

    .collection-header {
      padding: 16px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .collection-icon {
      width: 40px; height: 40px;
      border-radius: 8px;
      background: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .collection-icon svg { width: 20px; height: 20px; color: white; }

    .collection-name { font-size: 16px; font-weight: 500; }
    .collection-status {
      font-size: 12px;
      color: var(--success);
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .collection-status::before {
      content: '';
      width: 6px; height: 6px;
      border-radius: 50%;
      background: var(--success);
    }

    .collection-stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      padding: 12px 16px;
      border-top: 1px solid var(--divider);
      text-align: center;
    }

    .stat-value { font-size: 18px; font-weight: 500; }
    .stat-label { font-size: 11px; color: var(--text-secondary); margin-top: 2px; }

    /* Collection Tags */
    .collection-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      padding: 8px 16px 12px;
    }
    .tag {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .tag-dense { background: #1976d2; color: white; }
    .tag-sparse { background: #388e3c; color: white; }
    .tag-hybrid { background: #7b1fa2; color: white; }
    .tag-ultimate { background: linear-gradient(135deg, #f50057, #ff9100); color: white; }
    .tag-graph { background: linear-gradient(135deg, #00796b, #004d40); color: white; }
    .tag-demo { background: #ff5722; color: white; }
    .tag-en { background: #29b6f6; color: white; font-weight: 600; }
    .tag-ml { background: #ffa726; color: white; font-weight: 600; }
    .tag-default { background: var(--bg-elevated); color: var(--text-secondary); }

    /* Tier Selector */
    .tier-selector {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
    }
    .tier-option {
      cursor: pointer;
    }
    .tier-option input[type="radio"] {
      display: none;
    }
    .tier-card {
      padding: 12px;
      border: 2px solid var(--divider);
      border-radius: 8px;
      text-align: center;
      transition: all 0.2s;
    }
    .tier-option:hover .tier-card {
      border-color: var(--primary);
    }
    .tier-option input:checked + .tier-card {
      border-color: var(--primary);
      background: rgba(187, 134, 252, 0.1);
    }
    .tier-name {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 2px;
    }
    .tier-desc {
      font-size: 11px;
      color: var(--text-secondary);
    }
    .tier-option[data-tier="dense"] input:checked + .tier-card {
      border-color: #1976d2;
      background: rgba(25, 118, 210, 0.1);
    }
    .tier-option[data-tier="dense"] .tier-name { color: #1976d2; }
    .tier-option[data-tier="hybrid"] input:checked + .tier-card {
      border-color: #7b1fa2;
      background: rgba(123, 31, 162, 0.1);
    }
    .tier-option[data-tier="hybrid"] .tier-name { color: #7b1fa2; }
    .tier-option[data-tier="ultimate"] input:checked + .tier-card {
      border-color: #f50057;
      background: rgba(245, 0, 87, 0.1);
    }
    .tier-option[data-tier="ultimate"] .tier-name { color: #f50057; }
    .tier-option[data-tier="graph"] input:checked + .tier-card {
      border-color: #00796b;
      background: rgba(0, 121, 107, 0.1);
    }
    .tier-option[data-tier="graph"] .tier-name { color: #00796b; }

    /* Search Mode Selector */
    .search-mode-option {
      display: flex;
      flex-direction: column;
      padding: 10px 16px;
      background: var(--surface);
      border: 2px solid var(--divider);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      min-width: 120px;
    }
    .search-mode-option:hover {
      border-color: var(--primary);
      background: var(--bg-elevated);
    }
    .search-mode-option.active {
      border-color: var(--primary);
      background: rgba(98, 0, 234, 0.08);
    }
    .search-mode-option.disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }
    .search-mode-option input[type="radio"] {
      display: none;
    }
    .mode-label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      font-size: 13px;
    }
    .mode-dot {
      width: 10px;
      height: 10px;
      border-radius: 2px;
    }
    .mode-desc {
      font-size: 11px;
      color: var(--text-tertiary);
      margin-top: 2px;
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 8px 16px;
      font-size: 14px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
    }
    .btn-primary { background: var(--primary); color: white; }
    .btn-primary:hover { background: var(--primary-dark); }
    .btn-text { background: transparent; color: var(--primary); }
    .btn-text:hover { background: rgba(220, 0, 78, 0.08); }
    .btn-danger { background: var(--error); color: white; }
    .btn-danger:hover { background: #c62828; }

    /* Collection delete button */
    .collection-delete-btn {
      padding: 6px !important;
      color: var(--text-secondary) !important;
      transition: color 0.2s, background 0.2s;
      border-radius: 4px;
    }
    .collection-delete-btn:hover { color: var(--error) !important; background: rgba(244, 67, 54, 0.15) !important; }

    /* FAB */
    .fab {
      position: fixed;
      bottom: 24px; right: 24px;
      width: 56px; height: 56px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: all 0.2s;
      z-index: 1000;
    }
    .fab:hover { transform: scale(1.05); }
    .fab.hidden { display: none; }
    .fab svg { width: 24px; height: 24px; }

    /* Forms */
    .form-group { margin-bottom: 16px; }
    .form-label {
      display: block;
      font-size: 12px;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 8px;
      text-transform: uppercase;
    }
    .form-input, .form-select {
      width: 100%;
      background: var(--bg-default);
      border: 1px solid var(--divider);
      border-radius: 4px;
      padding: 12px;
      color: var(--text-primary);
      font-size: 14px;
      font-family: inherit;
    }
    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: var(--primary);
    }

    /* Console */
    .console-toolbar {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
      align-items: center;
    }

    .console-method, .console-endpoint {
      background: var(--bg-elevated);
      border: 1px solid var(--divider);
      border-radius: 4px;
      padding: 10px 12px;
      color: var(--text-primary);
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
    }
    .console-endpoint { flex: 1; }
    .console-endpoint:focus { outline: none; border-color: var(--primary); }

    .console-panels {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .console-panel {
      background: var(--bg-paper);
      border: 1px solid var(--divider);
      border-radius: 8px;
      overflow: hidden;
    }

    .panel-header {
      padding: 12px 16px;
      background: var(--bg-elevated);
      font-size: 12px;
      font-weight: 500;
      text-transform: uppercase;
      color: var(--text-secondary);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .panel-body { padding: 16px; min-height: 300px; }

    .console-textarea {
      width: 100%;
      height: 280px;
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      resize: none;
      outline: none;
    }

    .console-output {
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      white-space: pre-wrap;
      color: var(--text-secondary);
      max-height: 280px;
      overflow: auto;
    }

    /* Code Tips styling */
    .code-block pre {
      font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace !important;
      font-size: 13px;
      line-height: 1.5;
      letter-spacing: 0.3px;
      -webkit-font-smoothing: antialiased;
    }
    .code-block:hover {
      outline: 1px solid var(--divider);
      outline-offset: 2px;
    }

    .status-chip {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
    }
    .status-chip.success { background: rgba(102, 187, 106, 0.2); color: var(--success); }
    .status-chip.error { background: rgba(244, 67, 54, 0.2); color: var(--error); }

    /* Results */
    .results-container {
      background: var(--bg-paper);
      border: 1px solid var(--divider);
      border-radius: 8px;
      margin-top: 16px;
    }

    .results-header {
      padding: 12px 16px;
      border-bottom: 1px solid var(--divider);
      display: flex;
      justify-content: space-between;
    }

    .result-item {
      padding: 16px;
      border-bottom: 1px solid var(--divider);
    }
    .result-item:last-child { border-bottom: none; }

    .result-score {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
      background: rgba(220, 0, 78, 0.1);
      color: var(--primary);
      margin-bottom: 8px;
    }

    .result-text { font-size: 14px; margin-bottom: 8px; }
    .result-id {
      font-size: 12px;
      color: var(--text-disabled);
      font-family: 'JetBrains Mono', monospace;
    }

    .masked { filter: blur(4px); user-select: none; }
    .masked:hover { filter: blur(0); }

    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 1px solid var(--divider);
      margin-bottom: 16px;
    }
    .tab {
      padding: 12px 24px;
      cursor: pointer;
      border: none;
      background: none;
      color: var(--text-secondary);
      font-family: inherit;
      font-size: 14px;
      font-weight: 500;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }
    .tab:hover:not(.disabled) { color: var(--text-primary); background: var(--action-hover); }
    .tab.active { color: var(--primary); border-bottom-color: var(--primary); }
    .tab.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .tab.disabled:hover { background: none; color: var(--text-secondary); }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* Points Table */
    .points-table {
      width: 100%;
      border-collapse: collapse;
    }
    .points-table th,
    .points-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid var(--divider);
    }
    .points-table th {
      font-weight: 500;
      color: var(--text-secondary);
      font-size: 12px;
      text-transform: uppercase;
    }
    .points-table td {
      font-size: 13px;
    }
    .points-table tr:hover {
      background: var(--action-hover);
    }
    .points-table .id-cell {
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
    }
    .points-table .vector-cell {
      color: var(--text-disabled);
      font-family: 'JetBrains Mono', monospace;
      font-size: 11px;
      max-width: 200px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .points-table .metadata-cell {
      max-width: 300px;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .pagination {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      padding: 16px;
      border-top: 1px solid var(--divider);
    }
    .pagination button {
      padding: 8px 16px;
    }
    .pagination-info {
      color: var(--text-secondary);
      font-size: 13px;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 48px;
      color: var(--text-secondary);
    }
    .empty-state svg { width: 64px; height: 64px; opacity: 0.5; margin-bottom: 16px; }
    .empty-state h3 { font-size: 18px; font-weight: 400; margin-bottom: 8px; }

    /* Dialog */
    .dialog-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      z-index: 1200;
      align-items: center;
      justify-content: center;
    }
    .dialog-overlay.active { display: flex; }

    .dialog {
      background: var(--bg-paper);
      border-radius: 8px;
      width: 100%;
      max-width: 480px;
      max-height: 90vh;
      overflow: auto;
    }

    .dialog-title { padding: 20px 24px; font-size: 20px; font-weight: 500; }
    .dialog-content { padding: 0 24px 20px; }
    .dialog-actions {
      padding: 12px 16px;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      border-top: 1px solid var(--divider);
    }

    /* File Dropzone */
    .file-dropzone {
      border: 2px dashed var(--divider);
      border-radius: 8px;
      padding: 24px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 8px;
    }
    .file-dropzone:hover {
      border-color: var(--primary);
      background: var(--action-hover);
    }
    .file-dropzone.dragover {
      border-color: var(--primary);
      background: rgba(220, 0, 78, 0.1);
    }
    .file-dropzone svg {
      width: 32px;
      height: 32px;
      color: var(--text-disabled);
      margin-bottom: 8px;
    }
    .file-dropzone-text {
      color: var(--text-secondary);
      font-size: 13px;
    }
    .file-dropzone-hint {
      color: var(--text-disabled);
      font-size: 11px;
      margin-top: 4px;
    }
    .file-list {
      margin-top: 12px;
      max-height: 120px;
      overflow-y: auto;
    }
    .file-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 12px;
      background: var(--bg-elevated);
      border-radius: 4px;
      margin-bottom: 4px;
      font-size: 12px;
    }
    .file-item-name {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-primary);
    }
    .file-item-size {
      color: var(--text-disabled);
    }
    .file-item-remove {
      background: none;
      border: none;
      color: var(--text-disabled);
      cursor: pointer;
      padding: 2px;
    }
    .file-item-remove:hover {
      color: var(--error);
    }

    /* Language Badge on Cards */
    .lang-badge {
      position: absolute;
      top: 12px;
      right: 12px;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 600;
      letter-spacing: 0.5px;
      border: 1px solid var(--divider);
      background: var(--bg-elevated);
      color: var(--text-secondary);
    }
    .lang-badge.en {
      border-color: var(--info);
      color: var(--info);
    }
    .lang-badge.ml {
      border-color: var(--warning);
      color: var(--warning);
    }

    /* Language Selector */
    .lang-selector {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }
    .lang-option {
      flex: 1;
      cursor: pointer;
    }
    .lang-option input { display: none; }
    .lang-card {
      padding: 12px;
      border: 1px solid var(--divider);
      border-radius: 6px;
      text-align: center;
      transition: all 0.2s;
    }
    .lang-option input:checked + .lang-card {
      border-color: var(--primary);
      background: rgba(220, 0, 78, 0.1);
    }
    .lang-card:hover {
      border-color: var(--text-disabled);
    }
    .lang-name {
      font-weight: 500;
      font-size: 13px;
      margin-bottom: 2px;
    }
    .lang-desc {
      font-size: 11px;
      color: var(--text-disabled);
    }

    /* Language Toggle (Search page) */
    .lang-toggle {
      display: flex;
      align-items: center;
      background: var(--bg-elevated);
      border: 1px solid var(--divider);
      border-radius: 6px;
      padding: 2px;
      position: relative;
      cursor: pointer;
      height: 36px;
      min-width: 90px;
    }
    .lang-toggle-option {
      flex: 1;
      text-align: center;
      font-size: 12px;
      font-weight: 600;
      padding: 6px 12px;
      color: var(--text-disabled);
      z-index: 1;
      transition: color 0.2s;
    }
    .lang-toggle-option.active {
      color: var(--text-primary);
    }
    .lang-toggle-slider {
      position: absolute;
      width: calc(50% - 4px);
      height: calc(100% - 4px);
      background: var(--primary);
      border-radius: 4px;
      top: 2px;
      left: 2px;
      transition: transform 0.2s ease;
    }
    .lang-toggle.multi .lang-toggle-slider {
      transform: translateX(100%);
    }
    .lang-toggle.multi .lang-toggle-option[data-lang="en"] {
      color: var(--text-disabled);
    }
    .lang-toggle.multi .lang-toggle-option[data-lang="multi"] {
      color: var(--text-primary);
    }

    .toggle {
      width: 44px; height: 24px;
      border-radius: 12px;
      background: var(--divider);
      position: relative;
      cursor: pointer;
      transition: background 0.2s;
      flex-shrink: 0;
    }
    .toggle.active { background: var(--primary); }
    .toggle::after {
      content: '';
      position: absolute;
      width: 20px; height: 20px;
      border-radius: 50%;
      background: white;
      top: 2px; left: 2px;
      transition: transform 0.2s;
    }
    .toggle.active::after { transform: translateX(20px); }

    /* Audit Log */
    .audit-item {
      padding: 12px 16px;
      border-bottom: 1px solid var(--divider);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .audit-icon {
      width: 32px; height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .audit-icon.read { background: rgba(41, 182, 246, 0.15); color: var(--info); }
    .audit-icon.write { background: rgba(102, 187, 106, 0.15); color: var(--success); }
    .audit-icon.delete { background: rgba(244, 67, 54, 0.15); color: var(--error); }
    .audit-icon svg { width: 16px; height: 16px; }

    .audit-details { flex: 1; min-width: 0; }
    .audit-action { font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .audit-time { font-size: 12px; color: var(--text-secondary); }

    /* API Requests Dashboard */
    .api-time-btn {
      padding: 6px 12px !important;
      border-radius: 4px;
      transition: all 0.2s;
    }
    .api-time-btn.active {
      background: var(--primary) !important;
      color: white !important;
    }

    .data-table {
      border-collapse: collapse;
    }
    .data-table th {
      background: var(--bg-default);
      font-weight: 500;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-secondary);
      border-bottom: 1px solid var(--divider);
    }
    .data-table tr:hover {
      background: var(--bg-hover);
    }
    .data-table td {
      border-bottom: 1px solid var(--divider);
    }

    /* Sortable columns */
    .sortable-th {
      user-select: none;
      transition: background 0.2s;
    }
    .sortable-th:hover {
      background: var(--bg-hover);
    }
    .sortable-th.active {
      color: var(--primary);
    }
    .sort-arrow {
      opacity: 0.4;
      margin-left: 4px;
    }
    .sortable-th.active .sort-arrow {
      opacity: 1;
      color: var(--primary);
    }

    /* Expanded card modal overlay */
    .card-modal-backdrop {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
      cursor: pointer;
    }
    .card-modal-backdrop.active {
      display: block;
    }
    .card.expanded {
      position: fixed !important;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
      width: 90% !important;
      max-width: 1200px !important;
      height: 80vh !important;
      max-height: 80vh !important;
      z-index: 1000 !important;
      margin: 0 !important;
      border-radius: 12px !important;
      overflow: hidden !important;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5) !important;
      display: flex !important;
      flex-direction: column !important;
    }
    .card.expanded .card-header {
      flex-shrink: 0;
      background: var(--bg-surface);
      padding: 16px 24px;
      border-bottom: 1px solid var(--divider);
      font-size: 18px;
      font-weight: 500;
    }
    .card.expanded .card-header span:first-child {
      font-size: 18px;
    }
    .card.expanded > div:last-child,
    .card.expanded #api-recent-requests {
      flex: 1;
      overflow: auto !important;
      max-height: none !important;
    }
    /* Sticky table headers in expanded mode */
    .card.expanded table thead {
      position: sticky;
      top: 0;
      background: var(--bg-surface);
      z-index: 5;
    }
    .card.expanded table thead th {
      background: var(--bg-surface);
      border-bottom: 2px solid var(--divider);
    }
    /* For Recent Requests - header row stays visible */
    .card.expanded .recent-request-header {
      position: sticky;
      top: 0;
      background: var(--bg-surface);
      z-index: 5;
      border-bottom: 2px solid var(--divider);
    }
    .expand-close-btn {
      background: var(--primary) !important;
      color: white !important;
      border-radius: 4px !important;
      padding: 4px 12px !important;
    }
    .expand-close-btn:hover {
      background: var(--primary-dark) !important;
    }

    /* Confirm Dialog */
    .confirm-message { font-size: 14px; color: var(--text-secondary); margin-bottom: 16px; }
    .confirm-warning {
      background: rgba(244, 67, 54, 0.1);
      border: 1px solid var(--error);
      border-radius: 4px;
      padding: 12px;
      font-size: 13px;
      color: var(--error);
    }

    .loading { display: flex; align-items: center; justify-content: center; padding: 48px; }
    .spinner {
      width: 32px; height: 32px;
      border: 3px solid var(--divider);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .snackbar {
      position: fixed;
      bottom: 24px; left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--bg-elevated);
      color: var(--text-primary);
      padding: 14px 24px;
      border-radius: 4px;
      font-size: 14px;
      z-index: 1400;
      opacity: 0;
      transition: all 0.3s;
      border: 1px solid var(--divider);
    }
    .snackbar.show { transform: translateX(-50%) translateY(0); opacity: 1; }
  </style>
</head>
<body>
  <div class="app">
    <header class="appbar">
      <a href="#" class="appbar-logo" onclick="showPage('welcome'); return false;">
        <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
        <span class="appbar-title">VectrixDB</span>
      </a>
      <div class="appbar-spacer"></div>
      <div class="appbar-actions">
        <div class="ws-status connecting" id="ws-status" title="WebSocket connection status">
          <span class="ws-dot"></span>
          <span id="ws-text">Connecting...</span>
        </div>
        <div class="auth-badge read-only" id="auth-badge" onclick="openDialog('auth')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="11" width="18" height="11" rx="2"/>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
          </svg>
          <span id="auth-text">Read Only</span>
        </div>
        <button class="icon-btn" id="theme-btn" onclick="toggleTheme()" title="Toggle theme">
          <svg id="theme-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"/>
            <line x1="12" y1="1" x2="12" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/>
            <line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
          </svg>
        </button>
      </div>
    </header>

    <div class="main-layout">
      <nav class="drawer">
        <div class="drawer-list">
          <button class="drawer-item active" data-page="welcome">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
            </svg>
            Welcome
          </button>
          <button class="drawer-item" data-page="collections">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
            </svg>
            Collections
          </button>
          <button class="drawer-item" data-page="console">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="4 17 10 11 4 5"/>
              <line x1="12" y1="19" x2="20" y2="19"/>
            </svg>
            Console
          </button>
          <button class="drawer-item" data-page="search">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/>
              <line x1="21" y1="21" x2="16.65" y2="16.65"/>
            </svg>
            Search
          </button>

          <div class="drawer-divider"></div>
          <div class="drawer-section">Learn</div>

          <button class="drawer-item" data-page="tutorials">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
              <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
            </svg>
            Tutorials
          </button>
          <button class="drawer-item" data-page="codetips">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="16 18 22 12 16 6"/>
              <polyline points="8 6 2 12 8 18"/>
            </svg>
            Code Tips
          </button>
        </div>
      </nav>

      <main class="content">
        <!-- Welcome -->
        <div class="page active" id="page-welcome">
          <div style="text-align: center; padding: 48px 0;">
            <svg viewBox="0 0 24 24" style="width: 80px; height: 80px; fill: var(--primary); margin-bottom: 24px;">
              <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
            </svg>
            <h1 style="font-size: 32px; font-weight: 300; margin-bottom: 8px;">Welcome to VectrixDB</h1>
            <p style="color: var(--text-secondary); margin-bottom: 32px;">Where vectors come alive</p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; max-width: 800px; margin: 0 auto;">
              <div class="card" style="cursor: pointer; padding: 24px;" onclick="showPage('collections')">
                <div style="color: var(--primary); margin-bottom: 12px;">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 32px; height: 32px;">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                  </svg>
                </div>
                <h3 style="font-size: 18px; font-weight: 500; margin-bottom: 8px;">Collections</h3>
                <p style="font-size: 14px; color: var(--text-secondary);">Browse and manage vector collections</p>
              </div>
              <div class="card" style="cursor: pointer; padding: 24px;" onclick="showPage('console')">
                <div style="color: var(--primary); margin-bottom: 12px;">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 32px; height: 32px;">
                    <polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/>
                  </svg>
                </div>
                <h3 style="font-size: 18px; font-weight: 500; margin-bottom: 8px;">Console</h3>
                <p style="font-size: 14px; color: var(--text-secondary);">Execute API requests directly</p>
              </div>
              <div class="card" style="cursor: pointer; padding: 24px;" onclick="showPage('search')">
                <div style="color: var(--primary); margin-bottom: 12px;">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 32px; height: 32px;">
                    <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
                  </svg>
                </div>
                <h3 style="font-size: 18px; font-weight: 500; margin-bottom: 8px;">Search</h3>
                <p style="font-size: 14px; color: var(--text-secondary);">Semantic vector search</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Collections -->
        <div class="page" id="page-collections">
          <h1 class="page-title">Collections</h1>
          <div class="collections-grid" id="collections-grid">
            <div class="loading"><div class="spinner"></div></div>
          </div>
        </div>

        <!-- Console -->
        <div class="page" id="page-console">
          <h1 class="page-title">Console</h1>
          <div class="console-toolbar">
            <select class="console-method" id="console-method">
              <option value="GET">GET</option>
              <option value="POST">POST</option>
              <option value="PUT">PUT</option>
              <option value="DELETE">DELETE</option>
            </select>
            <input type="text" class="console-endpoint" id="console-endpoint" value="/collections" list="endpoint-suggestions" autocomplete="off">
            <datalist id="endpoint-suggestions">
              <option value="/collections">List all collections</option>
              <option value="/collections/{name}">Get collection info</option>
              <option value="/collections/{name}/points">List points</option>
              <option value="/collections/{name}/search">Search collection</option>
              <option value="/health">Health check</option>
              <option value="/info">Database info</option>
            </datalist>
            <button class="btn btn-primary" onclick="executeRequest()">SEND</button>
          </div>
          <div class="console-panels">
            <div class="console-panel">
              <div class="panel-header">Request Body</div>
              <div class="panel-body">
                <textarea class="console-textarea" id="console-body" placeholder='{"key": "value"}'></textarea>
              </div>
            </div>
            <div class="console-panel">
              <div class="panel-header">
                <span>Response</span>
                <span class="status-chip" id="response-status"></span>
              </div>
              <div class="panel-body">
                <pre class="console-output" id="console-output">// Response will appear here</pre>
              </div>
            </div>
          </div>
        </div>

        <!-- Search -->
        <div class="page" id="page-search">
          <h1 class="page-title" id="collection-page-title">Collection</h1>

          <!-- Collection selector -->
          <div class="card" style="margin-bottom: 16px;">
            <div class="card-body" style="padding: 12px 16px;">
              <div style="display: flex; align-items: center; gap: 16px;">
                <label class="form-label" style="margin: 0; white-space: nowrap;">Collection:</label>
                <select class="form-select" id="search-collection" style="flex: 1;" onchange="onCollectionChange()">
                  <option value="">Select collection</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Tabs -->
          <div class="tabs">
            <button class="tab active" id="tab-search" onclick="switchTab('search')">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px;">
                <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
              </svg>
              Search
            </button>
            <button class="tab disabled" id="tab-browse" onclick="switchTab('browse')" title="API key required to browse points">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px;">
                <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
              </svg>
              Browse Points
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 14px; height: 14px; vertical-align: middle; margin-left: 4px; opacity: 0.5;" id="browse-lock-icon">
                <rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>
              </svg>
            </button>
            <button class="tab" id="tab-graph" onclick="switchTab('graph')" title="Knowledge Graph" style="display: none;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px;">
                <circle cx="6" cy="6" r="3"/><circle cx="18" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="18" r="3"/>
                <path d="M9 6h6M6 9v6M18 9v6M9 18h6"/>
              </svg>
              Graph
            </button>
          </div>

          <!-- Search Tab Content -->
          <div class="tab-content active" id="content-search">
            <div class="card">
              <div class="card-body">
                <div style="display: flex; gap: 16px; margin-bottom: 16px;">
                  <div class="form-group" style="flex: 1; margin-bottom: 0;">
                    <label class="form-label">Query</label>
                    <input type="text" class="form-input" id="search-query" placeholder="Enter search query...">
                  </div>
                  <div class="form-group" style="width: 100px; margin-bottom: 0;">
                    <label class="form-label">Limit</label>
                    <input type="number" class="form-input" id="search-limit" value="10" min="1" max="20" oninput="if(this.value > 20) this.value = 20; if(this.value < 1) this.value = 1;">
                  </div>
                  <div class="form-group" style="margin-bottom: 0;">
                    <label class="form-label">Language</label>
                    <div class="lang-toggle" id="search-lang-toggle" onclick="toggleSearchLang()">
                      <span class="lang-toggle-option active" data-lang="en">EN</span>
                      <span class="lang-toggle-option" data-lang="multi">ML</span>
                      <div class="lang-toggle-slider"></div>
                    </div>
                  </div>
                </div>

                <!-- Search Mode Selector -->
                <div class="form-group" style="margin-bottom: 16px;">
                  <label class="form-label">Search Mode</label>
                  <div id="search-mode-selector" style="display: flex; gap: 8px; flex-wrap: wrap;">
                    <label class="search-mode-option active" data-mode="dense" id="mode-dense">
                      <input type="radio" name="search-mode" value="dense" checked>
                      <span class="mode-label">
                        <span class="mode-dot" style="background: #1976d2;"></span>
                        Dense
                      </span>
                      <span class="mode-desc">Semantic similarity</span>
                    </label>
                    <label class="search-mode-option disabled" data-mode="keyword" id="mode-keyword">
                      <input type="radio" name="search-mode" value="keyword">
                      <span class="mode-label">
                        <span class="mode-dot" style="background: #388e3c;"></span>
                        Keyword
                      </span>
                      <span class="mode-desc">BM25 text match</span>
                    </label>
                    <label class="search-mode-option disabled" data-mode="rerank" id="mode-rerank">
                      <input type="radio" name="search-mode" value="rerank">
                      <span class="mode-label">
                        <span class="mode-dot" style="background: #7b1fa2;"></span>
                        Rerank
                      </span>
                      <span class="mode-desc">Dense + re-ranking</span>
                    </label>
                    <label class="search-mode-option disabled" data-mode="late" id="mode-late">
                      <input type="radio" name="search-mode" value="late">
                      <span class="mode-label">
                        <span class="mode-dot" style="background: #f50057;"></span>
                        Late Interaction
                      </span>
                      <span class="mode-desc">ColBERT-style</span>
                    </label>
                  </div>
                  <div id="search-mode-hint" style="font-size: 11px; color: var(--text-tertiary); margin-top: 6px;"></div>
                </div>

                <button class="btn btn-primary" onclick="executeSearch()">SEARCH</button>
              </div>
            </div>
            <div class="results-container" id="search-results" style="display: none;">
              <div class="results-header">
                <span style="font-weight: 500;">Results</span>
                <span id="results-count" style="color: var(--text-secondary);"></span>
              </div>
              <div id="results-list"></div>
            </div>
          </div>

          <!-- Browse Tab Content -->
          <div class="tab-content" id="content-browse">
            <div class="card">
              <div class="card-body" style="padding: 0;">
                <table class="points-table">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Metadata</th>
                      <th>Vector</th>
                      <th style="width: 60px;"></th>
                    </tr>
                  </thead>
                  <tbody id="points-table-body">
                    <tr>
                      <td colspan="4" style="text-align: center; padding: 48px; color: var(--text-secondary);">
                        Select a collection to browse points
                      </td>
                    </tr>
                  </tbody>
                </table>
                <div class="pagination" id="points-pagination" style="display: none;">
                  <button class="btn btn-outlined" id="btn-prev-page" onclick="loadPointsPage(-1)">Previous</button>
                  <span class="pagination-info" id="pagination-info">Page 1 of 1</span>
                  <button class="btn btn-outlined" id="btn-next-page" onclick="loadPointsPage(1)">Next</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Graph Tab Content -->
          <div class="tab-content" id="content-graph">
            <div class="card">
              <div class="card-body">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                  <div>
                    <span style="font-weight: 500;">Knowledge Graph</span>
                    <span id="graph-stats" style="color: var(--text-secondary); margin-left: 12px;"></span>
                  </div>
                  <div style="display: flex; gap: 8px;">
                    <button class="btn btn-outlined" onclick="resetGraphZoom()" title="Reset zoom">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
                        <path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/>
                      </svg>
                    </button>
                    <button class="btn btn-outlined" onclick="fitGraph()" title="Fit to screen">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
                        <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                      </svg>
                    </button>
                    <button class="btn" onclick="extractGraphEntities()" style="background: #00796b; color: white;" id="extract-btn">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; margin-right: 4px;">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 8v8M8 12h8"/>
                      </svg>
                      Extract Entities
                    </button>
                    <button class="btn btn-primary" onclick="loadGraphData()">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; margin-right: 4px;">
                        <path d="M23 4v6h-6M1 20v-6h6"/>
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                      </svg>
                      Refresh
                    </button>
                  </div>
                </div>
                <div id="graph-container" style="height: 500px; border: 1px solid var(--divider); border-radius: 8px; background: var(--bg-default); position: relative;">
                  <div id="graph-loading" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: var(--text-secondary);">
                    <div>No graph data found in this collection.</div>
                    <div style="margin-top: 8px; font-size: 12px;">Click <strong>Extract Entities</strong> to build the knowledge graph.</div>
                  </div>
                  <div id="cy" style="width: 100%; height: 100%;"></div>
                </div>
                <!-- Graph Legend -->
                <div style="display: flex; gap: 16px; margin-top: 12px; flex-wrap: wrap;">
                  <div style="display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-secondary);">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #2196f3;"></span> Person
                  </div>
                  <div style="display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-secondary);">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #4caf50;"></span> Organization
                  </div>
                  <div style="display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-secondary);">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #ff9800;"></span> Location
                  </div>
                  <div style="display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-secondary);">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #9c27b0;"></span> Concept
                  </div>
                  <div style="display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-secondary);">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #607d8b;"></span> Other
                  </div>
                </div>
              </div>
            </div>
            <!-- Entity Details Panel -->
            <div class="card" id="entity-details" style="margin-top: 16px; display: none;">
              <div class="card-body">
                <h3 style="margin-bottom: 12px;" id="entity-name">Entity Details</h3>
                <div id="entity-info"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tutorials -->
        <div class="page" id="page-tutorials">
          <h1 class="page-title">Tutorials</h1>

          <!-- Demo Data Section -->
          <div class="card" style="margin-bottom: 24px; background: linear-gradient(135deg, rgba(220, 0, 78, 0.1) 0%, rgba(156, 39, 176, 0.1) 100%);">
            <div style="padding: 24px;">
              <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 16px;">
                <div>
                  <h2 style="font-size: 20px; font-weight: 500; margin-bottom: 8px;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2" style="width: 24px; height: 24px; vertical-align: middle; margin-right: 8px;">
                      <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                      <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                      <line x1="12" y1="22.08" x2="12" y2="12"/>
                    </svg>
                    Get Started with Demo Data
                  </h2>
                  <p style="color: var(--text-secondary); margin: 0;">Load demo data to explore all VectrixDB features: semantic search, keyword search, reranking, and knowledge graphs.</p>
                </div>
                <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                  <span id="demo-status" style="font-size: 12px; color: var(--text-secondary);"></span>
                  <button class="btn" id="load-demo-btn" onclick="loadDemo()" style="white-space: nowrap; background: linear-gradient(135deg, #00796b, #004d40); color: white;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; margin-right: 8px;">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                      <polyline points="7 10 12 15 17 10"/>
                      <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    LOAD DEMO
                  </button>
                </div>
              </div>
              <div id="demo-progress" style="display: none; margin-top: 16px;">
                <div style="height: 4px; background: var(--divider); border-radius: 2px; overflow: hidden;">
                  <div id="demo-progress-bar" style="height: 100%; background: var(--primary); width: 0%; transition: width 0.3s;"></div>
                </div>
                <div id="demo-progress-text" style="font-size: 12px; color: var(--text-secondary); margin-top: 8px;">Preparing...</div>
              </div>
            </div>
          </div>

          <!-- Tutorial Cards Grid -->
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 16px;">

            <!-- Quick Start -->
            <div class="card">
              <div class="card-header" style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 36px; height: 36px; border-radius: 8px; background: rgba(102, 187, 106, 0.15); display: flex; align-items: center; justify-content: center;">
                  <svg viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="2" style="width: 20px; height: 20px;">
                    <polygon points="5 3 19 12 5 21 5 3"/>
                  </svg>
                </div>
                <div>
                  <div style="font-weight: 500;">Quick Start</div>
                  <div style="font-size: 11px; color: var(--text-secondary);">5 min</div>
                </div>
              </div>
              <div style="padding: 16px; border-top: 1px solid var(--divider);">
                <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 16px;">Learn the basics: create a collection, add data, and perform your first search.</p>
                <div style="background: var(--bg-default); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                  <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 8px;">Steps:</div>
                  <ol style="margin: 0; padding-left: 20px; font-size: 13px; color: var(--text-primary);">
                    <li style="margin-bottom: 4px;">Click <strong>Load Demo</strong> above</li>
                    <li style="margin-bottom: 4px;">Go to <strong>Collections</strong>  click <code>demo</code></li>
                    <li style="margin-bottom: 4px;">Browse the points to see the data</li>
                    <li>Go to <strong>Search</strong> and try all search modes</li>
                  </ol>
                </div>
                <button class="btn btn-text" onclick="showPage('collections')" style="width: 100%;">GO TO COLLECTIONS </button>
              </div>
            </div>

            <!-- Semantic Search -->
            <div class="card">
              <div class="card-header" style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 36px; height: 36px; border-radius: 8px; background: rgba(220, 0, 78, 0.15); display: flex; align-items: center; justify-content: center;">
                  <svg viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2" style="width: 20px; height: 20px;">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M12 16v-4M12 8h.01"/>
                  </svg>
                </div>
                <div>
                  <div style="font-weight: 500;">Semantic Search</div>
                  <div style="font-size: 11px; color: var(--text-secondary);">Understanding meaning</div>
                </div>
              </div>
              <div style="padding: 16px; border-top: 1px solid var(--divider);">
                <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 16px;">Find results by meaning, not just keywords. Ask questions in natural language.</p>
                <div style="background: var(--bg-default); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                  <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 8px;">Try these queries:</div>
                  <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                    <button class="btn btn-text" onclick="trySearch('How does sleep affect memory?', 'dense')" style="font-size: 12px; padding: 4px 12px; background: var(--surface);">How does sleep affect memory?</button>
                    <button class="btn btn-text" onclick="trySearch('cancer treatment breakthroughs', 'dense')" style="font-size: 12px; padding: 4px 12px; background: var(--surface);">cancer treatment breakthroughs</button>
                    <button class="btn btn-text" onclick="trySearch('brain health and exercise', 'dense')" style="font-size: 12px; padding: 4px 12px; background: var(--surface);">brain health and exercise</button>
                  </div>
                </div>
                <div style="font-size: 12px; color: var(--text-secondary); padding: 8px; border-left: 3px solid var(--primary);">
                  <strong>How it works:</strong> Text is converted to vectors that capture meaning. Similar concepts cluster together in vector space.
                </div>
              </div>
            </div>

            <!-- Keyword Search -->
            <div class="card">
              <div class="card-header" style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 36px; height: 36px; border-radius: 8px; background: rgba(41, 182, 246, 0.15); display: flex; align-items: center; justify-content: center;">
                  <svg viewBox="0 0 24 24" fill="none" stroke="var(--info)" stroke-width="2" style="width: 20px; height: 20px;">
                    <polyline points="4 7 4 4 20 4 20 7"/>
                    <line x1="9" y1="20" x2="15" y2="20"/>
                    <line x1="12" y1="4" x2="12" y2="20"/>
                  </svg>
                </div>
                <div>
                  <div style="font-weight: 500;">Keyword Search (BM25)</div>
                  <div style="font-size: 11px; color: var(--text-secondary);">Exact term matching</div>
                </div>
              </div>
              <div style="padding: 16px; border-top: 1px solid var(--divider);">
                <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 16px;">Traditional search that matches exact words. Great for names, codes, or specific terms.</p>
                <div style="background: var(--bg-default); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                  <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 8px;">Try these queries:</div>
                  <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                    <button class="btn btn-text" onclick="trySearch('CRISPR', 'keyword')" style="font-size: 12px; padding: 4px 12px; background: var(--surface);">CRISPR</button>
                    <button class="btn btn-text" onclick="trySearch('mRNA vaccine', 'keyword')" style="font-size: 12px; padding: 4px 12px; background: var(--surface);">mRNA vaccine</button>
                    <button class="btn btn-text" onclick="trySearch('telomere aging', 'keyword')" style="font-size: 12px; padding: 4px 12px; background: var(--surface);">telomere aging</button>
                  </div>
                </div>
                <div style="font-size: 12px; color: var(--text-secondary); padding: 8px; border-left: 3px solid var(--info);">
                  <strong>How it works:</strong> BM25 algorithm ranks documents by term frequency and rarity. Exact matches score highest.
                </div>
              </div>
            </div>

            <!-- Rerank Search -->
            <div class="card">
              <div class="card-header" style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 36px; height: 36px; border-radius: 8px; background: rgba(156, 39, 176, 0.15); display: flex; align-items: center; justify-content: center;">
                  <svg viewBox="0 0 24 24" fill="none" stroke="#9c27b0" stroke-width="2" style="width: 20px; height: 20px;">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="2" y1="12" x2="22" y2="12"/>
                    <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                  </svg>
                </div>
                <div>
                  <div style="font-weight: 500;">Rerank Search</div>
                  <div style="font-size: 11px; color: var(--text-secondary);">Dense + Re-ranking</div>
                </div>
              </div>
              <div style="padding: 16px; border-top: 1px solid var(--divider);">
                <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 16px;">Dense search with cross-encoder re-ranking for improved accuracy.</p>
                <div style="background: var(--bg-default); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                  <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 8px;">Try these queries:</div>
                  <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                    <button class="btn btn-text" onclick="trySearch('gut microbiome mental health', 'rerank')" style="font-size: 12px; padding: 4px 12px; background: var(--surface);">gut microbiome mental health</button>
                    <button class="btn btn-text" onclick="trySearch('vitamin D heart disease', 'rerank')" style="font-size: 12px; padding: 4px 12px; background: var(--surface);">vitamin D heart disease</button>
                  </div>
                </div>
                <div style="font-size: 12px; color: var(--text-secondary); padding: 8px; border-left: 3px solid #9c27b0;">
                  <strong>How it works:</strong> Fast dense retrieval followed by precise re-ranking for better relevance.
                </div>
              </div>
            </div>

            <!-- Late Interaction Search -->
            <div class="card">
              <div class="card-header" style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 36px; height: 36px; border-radius: 8px; background: rgba(245, 0, 87, 0.15); display: flex; align-items: center; justify-content: center;">
                  <svg viewBox="0 0 24 24" fill="none" stroke="#f50057" stroke-width="2" style="width: 20px; height: 20px;">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                  </svg>
                </div>
                <div>
                  <div style="font-weight: 500;">Late Interaction</div>
                  <div style="font-size: 11px; color: var(--text-secondary);">ColBERT-style</div>
                </div>
              </div>
              <div style="padding: 16px; border-top: 1px solid var(--divider);">
                <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 16px;">Token-level matching for maximum accuracy. Best for complex queries.</p>
                <div style="background: var(--bg-default); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                  <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 8px;">Try these queries:</div>
                  <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                    <button class="btn btn-text" onclick="trySearch('How does CRISPR edit genes in human cells?', 'late')" style="font-size: 12px; padding: 4px 12px; background: var(--surface);">How does CRISPR edit genes in human cells?</button>
                  </div>
                </div>
                <div style="font-size: 12px; color: var(--text-secondary); padding: 8px; border-left: 3px solid #f50057;">
                  <strong>How it works:</strong> ColBERT-style late interaction compares query and document tokens for fine-grained matching.
                </div>
              </div>
            </div>

            <!-- GraphRAG -->
            <div class="card">
              <div class="card-header" style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 36px; height: 36px; border-radius: 8px; background: rgba(0, 150, 136, 0.15); display: flex; align-items: center; justify-content: center;">
                  <svg viewBox="0 0 24 24" fill="none" stroke="#009688" stroke-width="2" style="width: 20px; height: 20px;">
                    <circle cx="6" cy="6" r="3"/>
                    <circle cx="18" cy="6" r="3"/>
                    <circle cx="6" cy="18" r="3"/>
                    <circle cx="18" cy="18" r="3"/>
                    <line x1="9" y1="6" x2="15" y2="6"/>
                    <line x1="6" y1="9" x2="6" y2="15"/>
                    <line x1="18" y1="9" x2="18" y2="15"/>
                    <line x1="9" y1="18" x2="15" y2="18"/>
                  </svg>
                </div>
                <div>
                  <div style="font-weight: 500;">GraphRAG</div>
                  <div style="font-size: 11px; color: var(--text-secondary);">Knowledge graph search</div>
                </div>
              </div>
              <div style="padding: 16px; border-top: 1px solid var(--divider);">
                <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 16px;">Automatically extracts entities and relationships, enabling graph-based retrieval.</p>
                <div style="background: var(--bg-default); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                  <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 8px;">Features:</div>
                  <ul style="margin: 0; padding-left: 20px; font-size: 13px; color: var(--text-primary);">
                    <li style="margin-bottom: 4px;">Auto entity extraction (People, Places, Concepts)</li>
                    <li style="margin-bottom: 4px;">Relationship mapping between entities</li>
                    <li>Graph traversal for connected results</li>
                  </ul>
                </div>
                <div style="font-size: 12px; color: var(--text-secondary); padding: 8px; border-left: 3px solid #009688;">
                  <strong>How it works:</strong> Uses mREBEL model to extract (subject, relation, object) triples and builds a searchable knowledge graph.
                </div>
              </div>
            </div>

          </div>

          <!-- API Quick Reference -->
          <div class="card" style="margin-top: 24px;">
            <div class="card-header">API Quick Reference</div>
            <div style="padding: 16px; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px;">
              <div>
                <div style="font-weight: 500; margin-bottom: 8px; color: var(--success);">Create Collection</div>
                <pre style="background: var(--bg-default); padding: 12px; border-radius: 4px; font-size: 12px; overflow-x: auto; margin: 0;">POST /api/collections
{
  "name": "my_docs",
  "dimension": 384,
  "metric": "cosine"
}</pre>
              </div>
              <div>
                <div style="font-weight: 500; margin-bottom: 8px; color: var(--primary);">Add Points (with text)</div>
                <pre style="background: var(--bg-default); padding: 12px; border-radius: 4px; font-size: 12px; overflow-x: auto; margin: 0;">POST /api/collections/{name}/points
{
  "points": [{
    "id": "1",
    "text": "Your document text",
    "payload": {"source": "file.pdf"}
  }]
}</pre>
              </div>
              <div>
                <div style="font-weight: 500; margin-bottom: 8px; color: var(--info);">Text Search</div>
                <pre style="background: var(--bg-default); padding: 12px; border-radius: 4px; font-size: 12px; overflow-x: auto; margin: 0;">POST /api/collections/{name}/text-search
{
  "text": "your query",
  "mode": "hybrid",
  "limit": 10
}</pre>
              </div>
              <div>
                <div style="font-weight: 500; margin-bottom: 8px; color: var(--warning);">Search with Filter</div>
                <pre style="background: var(--bg-default); padding: 12px; border-radius: 4px; font-size: 12px; overflow-x: auto; margin: 0;">POST /api/collections/{name}/text-search
{
  "text": "query",
  "filter": {
    "category": "science"
  }
}</pre>
              </div>
            </div>
          </div>
        </div>

        <!-- Code Tips Page -->
        <div class="page" id="page-codetips">
          <h1 class="page-title">Code Tips</h1>
          <p style="color: var(--text-secondary); margin-bottom: 24px;">Copy-paste Python examples for VectrixDB. Click any code block to copy.</p>

          <!-- Quick Navigation -->
          <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 24px;">
            <button class="btn btn-text" onclick="document.getElementById('code-quickstart').scrollIntoView({behavior:'smooth'})" style="font-size: 12px;">Quick Start</button>
            <button class="btn btn-text" onclick="document.getElementById('code-tiers').scrollIntoView({behavior:'smooth'})" style="font-size: 12px;">Tiers & Modes</button>
            <button class="btn btn-text" onclick="document.getElementById('code-data').scrollIntoView({behavior:'smooth'})" style="font-size: 12px;">Loading Data</button>
            <button class="btn btn-text" onclick="document.getElementById('code-custom').scrollIntoView({behavior:'smooth'})" style="font-size: 12px;">Custom Models</button>
            <button class="btn btn-text" onclick="document.getElementById('code-embedders').scrollIntoView({behavior:'smooth'})" style="font-size: 12px;">Direct Embedders</button>
            <button class="btn btn-text" onclick="document.getElementById('code-langchain').scrollIntoView({behavior:'smooth'})" style="font-size: 12px;">LangChain</button>
          </div>

          <!-- Quick Start Section -->
          <div id="code-quickstart" class="card" style="margin-bottom: 24px;">
            <div class="card-header" style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 36px; height: 36px; border-radius: 8px; background: rgba(102, 187, 106, 0.15); display: flex; align-items: center; justify-content: center;">
                <svg viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="2" style="width: 20px; height: 20px;">
                  <polygon points="5 3 19 12 5 21 5 3"/>
                </svg>
              </div>
              <span>Quick Start</span>
            </div>
            <div class="card-body">
              <p style="color: var(--text-secondary); margin-bottom: 16px;">The simplest way to use VectrixDB - one line to add, one line to search.</p>
              <div class="code-block" onclick="copyCode(this)" style="cursor: pointer; position: relative;">
                <div style="position: absolute; top: 8px; right: 8px; font-size: 10px; color: var(--text-disabled);">click to copy</div>
                <pre style="background: var(--bg-default); padding: 16px; border-radius: 8px; font-size: 13px; overflow-x: auto; margin: 0; font-family: 'JetBrains Mono', monospace;"><span style="color: #c792ea;">from</span> vectrixdb <span style="color: #c792ea;">import</span> Vectrix

<span style="color: #546e7a;"># Create database and add data</span>
db = Vectrix(<span style="color: #c3e88d;">"my_docs"</span>, tier=<span style="color: #c3e88d;">"hybrid"</span>)
db.add([<span style="color: #c3e88d;">"Python is great"</span>, <span style="color: #c3e88d;">"JavaScript is fun"</span>, <span style="color: #c3e88d;">"Rust is fast"</span>])

<span style="color: #546e7a;"># Search</span>
results = db.search(<span style="color: #c3e88d;">"programming language"</span>, mode=<span style="color: #c3e88d;">"hybrid"</span>)
<span style="color: #82aaff;">print</span>(results.top.text)  <span style="color: #546e7a;"># Best match</span></pre>
              </div>

              <p style="color: var(--text-secondary); margin: 16px 0;">With metadata and filters:</p>
              <div class="code-block" onclick="copyCode(this)" style="cursor: pointer; position: relative;">
                <div style="position: absolute; top: 8px; right: 8px; font-size: 10px; color: var(--text-disabled);">click to copy</div>
                <pre style="background: var(--bg-default); padding: 16px; border-radius: 8px; font-size: 13px; overflow-x: auto; margin: 0; font-family: 'JetBrains Mono', monospace;"><span style="color: #c792ea;">from</span> vectrixdb <span style="color: #c792ea;">import</span> Vectrix

db = Vectrix(<span style="color: #c3e88d;">"products"</span>, tier=<span style="color: #c3e88d;">"hybrid"</span>)

db.add(
    texts=[<span style="color: #c3e88d;">"iPhone 15 Pro"</span>, <span style="color: #c3e88d;">"Samsung Galaxy"</span>, <span style="color: #c3e88d;">"Pixel 8"</span>],
    metadata=[
        {<span style="color: #c3e88d;">"brand"</span>: <span style="color: #c3e88d;">"Apple"</span>, <span style="color: #c3e88d;">"price"</span>: <span style="color: #f78c6c;">999</span>},
        {<span style="color: #c3e88d;">"brand"</span>: <span style="color: #c3e88d;">"Samsung"</span>, <span style="color: #c3e88d;">"price"</span>: <span style="color: #f78c6c;">899</span>},
        {<span style="color: #c3e88d;">"brand"</span>: <span style="color: #c3e88d;">"Google"</span>, <span style="color: #c3e88d;">"price"</span>: <span style="color: #f78c6c;">699</span>}
    ]
)

<span style="color: #546e7a;"># Filter by metadata</span>
results = db.search(<span style="color: #c3e88d;">"smartphone"</span>, filter={<span style="color: #c3e88d;">"brand"</span>: <span style="color: #c3e88d;">"Apple"</span>})
<span style="color: #82aaff;">print</span>(results.top.text)  <span style="color: #546e7a;"># "iPhone 15 Pro"</span></pre>
              </div>
            </div>
          </div>

          <!-- Tiers & Modes Section -->
          <div id="code-tiers" class="card" style="margin-bottom: 24px;">
            <div class="card-header" style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 36px; height: 36px; border-radius: 8px; background: rgba(156, 39, 176, 0.15); display: flex; align-items: center; justify-content: center;">
                <svg viewBox="0 0 24 24" fill="none" stroke="#9c27b0" stroke-width="2" style="width: 20px; height: 20px;">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                  <line x1="3" y1="9" x2="21" y2="9"/>
                  <line x1="9" y1="21" x2="9" y2="9"/>
                </svg>
              </div>
              <span>Understanding Tiers & Modes</span>
            </div>
            <div class="card-body">
              <!-- Tier Explanation -->
              <div style="background: var(--bg-default); border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                <div style="font-weight: 500; margin-bottom: 12px;">TIER = Collection Capability (set at creation)</div>
                <div style="display: grid; gap: 8px; font-size: 13px;">
                  <div style="display: flex; align-items: center; gap: 8px;"><span class="tag tag-dense">dense</span> Vector search only (fastest)</div>
                  <div style="display: flex; align-items: center; gap: 8px;"><span class="tag tag-hybrid">hybrid</span> Dense + BM25 + Reranking (recommended)</div>
                  <div style="display: flex; align-items: center; gap: 8px;"><span class="tag tag-ultimate">ultimate</span> Hybrid + ColBERT late interaction (most accurate)</div>
                  <div style="display: flex; align-items: center; gap: 8px;"><span class="tag tag-graph">graph</span> Ultimate + Knowledge graph extraction</div>
                </div>
              </div>

              <div style="background: var(--bg-default); border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                <div style="font-weight: 500; margin-bottom: 12px;">MODE = Search Method (set at search time)</div>
                <div style="display: grid; gap: 8px; font-size: 13px;">
                  <div><code>dense</code> - Vector similarity only</div>
                  <div><code>sparse</code> - BM25 keywords only</div>
                  <div><code>hybrid</code> - Dense + Sparse + Rerank</div>
                  <div><code>ultimate</code> - Hybrid + ColBERT</div>
                </div>
              </div>

              <p style="color: var(--text-secondary); margin-bottom: 16px;">Examples for each tier:</p>

              <!-- Dense Tier -->
              <div style="margin-bottom: 16px;">
                <div style="font-weight: 500; color: #1976d2; margin-bottom: 8px;">Dense Tier (Vector Search Only)</div>
                <div class="code-block" onclick="copyCode(this)" style="cursor: pointer; position: relative;">
                  <div style="position: absolute; top: 8px; right: 8px; font-size: 10px; color: var(--text-disabled);">click to copy</div>
                  <pre style="background: var(--bg-default); padding: 16px; border-radius: 8px; font-size: 13px; overflow-x: auto; margin: 0; font-family: 'JetBrains Mono', monospace;"><span style="color: #c792ea;">from</span> vectrixdb <span style="color: #c792ea;">import</span> Vectrix

<span style="color: #546e7a;"># Simple semantic similarity</span>
db = Vectrix(<span style="color: #c3e88d;">"docs"</span>, tier=<span style="color: #c3e88d;">"dense"</span>)
db.add([<span style="color: #c3e88d;">"The quick brown fox"</span>, <span style="color: #c3e88d;">"A fast auburn canine"</span>])
results = db.search(<span style="color: #c3e88d;">"swift fox"</span>, mode=<span style="color: #c3e88d;">"dense"</span>)</pre>
                </div>
              </div>

              <!-- Hybrid Tier -->
              <div style="margin-bottom: 16px;">
                <div style="font-weight: 500; color: #7b1fa2; margin-bottom: 8px;">Hybrid Tier (Recommended Default)</div>
                <div class="code-block" onclick="copyCode(this)" style="cursor: pointer; position: relative;">
                  <div style="position: absolute; top: 8px; right: 8px; font-size: 10px; color: var(--text-disabled);">click to copy</div>
                  <pre style="background: var(--bg-default); padding: 16px; border-radius: 8px; font-size: 13px; overflow-x: auto; margin: 0; font-family: 'JetBrains Mono', monospace;"><span style="color: #c792ea;">from</span> vectrixdb <span style="color: #c792ea;">import</span> Vectrix

<span style="color: #546e7a;"># Keywords + Meaning + Reranking</span>
db = Vectrix(<span style="color: #c3e88d;">"scifact"</span>, tier=<span style="color: #c3e88d;">"hybrid"</span>)
db.add([<span style="color: #c3e88d;">"CRISPR enables precise gene editing"</span>, <span style="color: #c3e88d;">"mRNA vaccines trigger immune response"</span>])

<span style="color: #546e7a;"># You can use different modes on hybrid tier</span>
results_hybrid = db.search(<span style="color: #c3e88d;">"gene therapy"</span>, mode=<span style="color: #c3e88d;">"hybrid"</span>)
results_dense = db.search(<span style="color: #c3e88d;">"immune system"</span>, mode=<span style="color: #c3e88d;">"dense"</span>)
results_sparse = db.search(<span style="color: #c3e88d;">"CRISPR"</span>, mode=<span style="color: #c3e88d;">"sparse"</span>)</pre>
                </div>
              </div>

              <!-- Ultimate Tier -->
              <div style="margin-bottom: 16px;">
                <div style="font-weight: 500; background: linear-gradient(135deg, #f50057, #ff9100); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 8px;">Ultimate Tier (Maximum Accuracy)</div>
                <div class="code-block" onclick="copyCode(this)" style="cursor: pointer; position: relative;">
                  <div style="position: absolute; top: 8px; right: 8px; font-size: 10px; color: var(--text-disabled);">click to copy</div>
                  <pre style="background: var(--bg-default); padding: 16px; border-radius: 8px; font-size: 13px; overflow-x: auto; margin: 0; font-family: 'JetBrains Mono', monospace;"><span style="color: #c792ea;">from</span> vectrixdb <span style="color: #c792ea;">import</span> Vectrix

<span style="color: #546e7a;"># Hybrid + ColBERT late interaction</span>
db = Vectrix(<span style="color: #c3e88d;">"scifact"</span>, tier=<span style="color: #c3e88d;">"ultimate"</span>)
db.add([
    <span style="color: #c3e88d;">"Sleep deprivation impairs memory consolidation"</span>,
    <span style="color: #c3e88d;">"Exercise reduces Alzheimer's disease risk"</span>,
    <span style="color: #c3e88d;">"The gut microbiome affects mental health"</span>
])

<span style="color: #546e7a;"># Best for complex queries</span>
results = db.search(
    <span style="color: #c3e88d;">"How does sleep affect brain function?"</span>,
    mode=<span style="color: #c3e88d;">"ultimate"</span>
)</pre>
                </div>
              </div>

              <!-- Graph Tier -->
              <div>
                <div style="font-weight: 500; color: #00796b; margin-bottom: 8px;">Graph Tier (Knowledge Extraction)</div>
                <div class="code-block" onclick="copyCode(this)" style="cursor: pointer; position: relative;">
                  <div style="position: absolute; top: 8px; right: 8px; font-size: 10px; color: var(--text-disabled);">click to copy</div>
                  <pre style="background: var(--bg-default); padding: 16px; border-radius: 8px; font-size: 13px; overflow-x: auto; margin: 0; font-family: 'JetBrains Mono', monospace;"><span style="color: #c792ea;">from</span> vectrixdb <span style="color: #c792ea;">import</span> Vectrix

<span style="color: #546e7a;"># Auto-extracts entities and relationships</span>
db = Vectrix(<span style="color: #c3e88d;">"biomedical"</span>, tier=<span style="color: #c3e88d;">"graph"</span>)
db.add([
    <span style="color: #c3e88d;">"Metformin treats type 2 diabetes."</span>,
    <span style="color: #c3e88d;">"Metformin may have anticancer properties."</span>
])
<span style="color: #546e7a;"># Internally extracts: Metformin --[treats]--> type 2 diabetes</span>

results = db.search(<span style="color: #c3e88d;">"What does metformin treat?"</span>)</pre>
                </div>
              </div>
            </div>
          </div>

          <!-- Loading Data Section -->
          <div id="code-data" class="card" style="margin-bottom: 24px;">
            <div class="card-header" style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 36px; height: 36px; border-radius: 8px; background: rgba(41, 182, 246, 0.15); display: flex; align-items: center; justify-content: center;">
                <svg viewBox="0 0 24 24" fill="none" stroke="var(--info)" stroke-width="2" style="width: 20px; height: 20px;">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                  <polyline points="17 8 12 3 7 8"/>
                  <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
              </div>
              <span>Loading Data</span>
            </div>
            <div class="card-body">
              <!-- From DataFrame -->
              <div style="margin-bottom: 16px;">
                <div style="font-weight: 500; margin-bottom: 8px;">From Pandas DataFrame</div>
                <div class="code-block" onclick="copyCode(this)" style="cursor: pointer; position: relative;">
                  <div style="position: absolute; top: 8px; right: 8px; font-size: 10px; color: var(--text-disabled);">click to copy</div>
                  <pre style="background: var(--bg-default); padding: 16px; border-radius: 8px; font-size: 13px; overflow-x: auto; margin: 0; font-family: 'JetBrains Mono', monospace;"><span style="color: #c792ea;">import</span> pandas <span style="color: #c792ea;">as</span> pd
<span style="color: #c792ea;">from</span> vectrixdb <span style="color: #c792ea;">import</span> Vectrix

df = pd.read_csv(<span style="color: #c3e88d;">"data.csv"</span>)

db = Vectrix(<span style="color: #c3e88d;">"docs"</span>, tier=<span style="color: #c3e88d;">"hybrid"</span>)
db.add(
    texts=df[<span style="color: #c3e88d;">"text"</span>].tolist(),
    ids=df[<span style="color: #c3e88d;">"id"</span>].tolist(),
    metadata=df[[<span style="color: #c3e88d;">"category"</span>, <span style="color: #c3e88d;">"author"</span>]].to_dict(<span style="color: #c3e88d;">"records"</span>)
)</pre>
                </div>
              </div>

              <!-- From Markdown -->
              <div style="margin-bottom: 16px;">
                <div style="font-weight: 500; margin-bottom: 8px;">From Markdown Files</div>
                <div class="code-block" onclick="copyCode(this)" style="cursor: pointer; position: relative;">
                  <div style="position: absolute; top: 8px; right: 8px; font-size: 10px; color: var(--text-disabled);">click to copy</div>
                  <pre style="background: var(--bg-default); padding: 16px; border-radius: 8px; font-size: 13px; overflow-x: auto; margin: 0; font-family: 'JetBrains Mono', monospace;"><span style="color: #c792ea;">from</span> vectrixdb <span style="color: #c792ea;">import</span> Vectrix
<span style="color: #c792ea;">from</span> pathlib <span style="color: #c792ea;">import</span> Path

db = Vectrix(<span style="color: #c3e88d;">"docs"</span>, tier=<span style="color: #c3e88d;">"hybrid"</span>)

<span style="color: #c792ea;">for</span> f <span style="color: #c792ea;">in</span> Path(<span style="color: #c3e88d;">"./docs"</span>).glob(<span style="color: #c3e88d;">"**/*.md"</span>):
    content = f.read_text(encoding=<span style="color: #c3e88d;">"utf-8"</span>)
    db.add(
        texts=[content],
        ids=[<span style="color: #82aaff;">str</span>(f)],
        metadata=[{<span style="color: #c3e88d;">"filename"</span>: f.name}]
    )</pre>
                </div>
              </div>

              <!-- Chunking -->
              <div>
                <div style="font-weight: 500; margin-bottom: 8px;">Chunking Large Documents</div>
                <div class="code-block" onclick="copyCode(this)" style="cursor: pointer; position: relative;">
                  <div style="position: absolute; top: 8px; right: 8px; font-size: 10px; color: var(--text-disabled);">click to copy</div>
                  <pre style="background: var(--bg-default); padding: 16px; border-radius: 8px; font-size: 13px; overflow-x: auto; margin: 0; font-family: 'JetBrains Mono', monospace;"><span style="color: #c792ea;">from</span> vectrixdb <span style="color: #c792ea;">import</span> Vectrix

<span style="color: #c792ea;">def</span> <span style="color: #82aaff;">chunk_text</span>(text, chunk_size=<span style="color: #f78c6c;">500</span>, overlap=<span style="color: #f78c6c;">50</span>):
    <span style="color: #c3e88d;">"""Split text into overlapping chunks"""</span>
    words = text.split()
    chunks = []
    <span style="color: #c792ea;">for</span> i <span style="color: #c792ea;">in</span> <span style="color: #82aaff;">range</span>(<span style="color: #f78c6c;">0</span>, <span style="color: #82aaff;">len</span>(words), chunk_size - overlap):
        chunk = <span style="color: #c3e88d;">' '</span>.join(words[i:i + chunk_size])
        <span style="color: #c792ea;">if</span> chunk:
            chunks.append(chunk)
    <span style="color: #c792ea;">return</span> chunks

db = Vectrix(<span style="color: #c3e88d;">"docs"</span>, tier=<span style="color: #c3e88d;">"hybrid"</span>)

<span style="color: #546e7a;"># Chunk and add</span>
long_doc = <span style="color: #c3e88d;">"Very long document text..."</span> * <span style="color: #f78c6c;">1000</span>
chunks = chunk_text(long_doc)
db.add(
    texts=chunks,
    ids=[<span style="color: #c3e88d;">f"chunk_</span>{i}<span style="color: #c3e88d;">"</span> <span style="color: #c792ea;">for</span> i <span style="color: #c792ea;">in</span> <span style="color: #82aaff;">range</span>(<span style="color: #82aaff;">len</span>(chunks))],
    metadata=[{<span style="color: #c3e88d;">"chunk_idx"</span>: i} <span style="color: #c792ea;">for</span> i <span style="color: #c792ea;">in</span> <span style="color: #82aaff;">range</span>(<span style="color: #82aaff;">len</span>(chunks))]
)</pre>
                </div>
              </div>
            </div>
          </div>

          <!-- Custom Models Section -->
          <div id="code-custom" class="card" style="margin-bottom: 24px;">
            <div class="card-header" style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 36px; height: 36px; border-radius: 8px; background: rgba(255, 152, 0, 0.15); display: flex; align-items: center; justify-content: center;">
                <svg viewBox="0 0 24 24" fill="none" stroke="var(--warning)" stroke-width="2" style="width: 20px; height: 20px;">
                  <circle cx="12" cy="12" r="3"/>
                  <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                </svg>
              </div>
              <span>Custom Embedding Models</span>
            </div>
            <div class="card-body">
              <p style="color: var(--text-secondary); margin-bottom: 16px;">Use language="en" for bundled English models (faster, offline), or custom models.</p>

              <!-- Bundled Models -->
              <div style="margin-bottom: 16px;">
                <div style="font-weight: 500; margin-bottom: 8px; color: var(--success);">Bundled Models (No Download)</div>
                <div class="code-block" onclick="copyCode(this)" style="cursor: pointer; position: relative;">
                  <div style="position: absolute; top: 8px; right: 8px; font-size: 10px; color: var(--text-disabled);">click to copy</div>
                  <pre style="background: var(--bg-default); padding: 16px; border-radius: 8px; font-size: 13px; overflow-x: auto; margin: 0; font-family: 'JetBrains Mono', monospace;"><span style="color: #c792ea;">from</span> vectrixdb <span style="color: #c792ea;">import</span> Vectrix

<span style="color: #546e7a;"># English models - bundled, no download (~100MB total)</span>
db = Vectrix(<span style="color: #c3e88d;">"docs"</span>, tier=<span style="color: #c3e88d;">"hybrid"</span>, language=<span style="color: #c3e88d;">"en"</span>)

<span style="color: #546e7a;"># Multilingual - auto-downloads on first use</span>
db = Vectrix(<span style="color: #c3e88d;">"docs"</span>, tier=<span style="color: #c3e88d;">"hybrid"</span>)  <span style="color: #546e7a;"># or language="multi"</span></pre>
                </div>
              </div>

              <!-- Sentence Transformers -->
              <div style="margin-bottom: 16px;">
                <div style="font-weight: 500; margin-bottom: 8px;">Sentence Transformers</div>
                <div class="code-block" onclick="copyCode(this)" style="cursor: pointer; position: relative;">
                  <div style="position: absolute; top: 8px; right: 8px; font-size: 10px; color: var(--text-disabled);">click to copy</div>
                  <pre style="background: var(--bg-default); padding: 16px; border-radius: 8px; font-size: 13px; overflow-x: auto; margin: 0; font-family: 'JetBrains Mono', monospace;"><span style="color: #546e7a;"># pip install sentence-transformers</span>
<span style="color: #c792ea;">from</span> vectrixdb <span style="color: #c792ea;">import</span> Vectrix

<span style="color: #546e7a;"># Standard models</span>
db = Vectrix(<span style="color: #c3e88d;">"docs"</span>, model=<span style="color: #c3e88d;">"sentence-transformers/all-MiniLM-L6-v2"</span>)
db = Vectrix(<span style="color: #c3e88d;">"docs"</span>, model=<span style="color: #c3e88d;">"sentence-transformers/all-mpnet-base-v2"</span>)

<span style="color: #546e7a;"># BGE models (high quality)</span>
db = Vectrix(<span style="color: #c3e88d;">"docs"</span>, model=<span style="color: #c3e88d;">"BAAI/bge-small-en-v1.5"</span>)
db = Vectrix(<span style="color: #c3e88d;">"docs"</span>, model=<span style="color: #c3e88d;">"BAAI/bge-large-en-v1.5"</span>)

<span style="color: #546e7a;"># Multilingual</span>
db = Vectrix(<span style="color: #c3e88d;">"docs"</span>, model=<span style="color: #c3e88d;">"sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2"</span>)</pre>
                </div>
              </div>

              <!-- OpenAI -->
              <div style="margin-bottom: 16px;">
                <div style="font-weight: 500; margin-bottom: 8px;">OpenAI Embeddings</div>
                <div class="code-block" onclick="copyCode(this)" style="cursor: pointer; position: relative;">
                  <div style="position: absolute; top: 8px; right: 8px; font-size: 10px; color: var(--text-disabled);">click to copy</div>
                  <pre style="background: var(--bg-default); padding: 16px; border-radius: 8px; font-size: 13px; overflow-x: auto; margin: 0; font-family: 'JetBrains Mono', monospace;"><span style="color: #546e7a;"># pip install openai</span>
<span style="color: #c792ea;">from</span> vectrixdb <span style="color: #c792ea;">import</span> Vectrix
<span style="color: #c792ea;">from</span> openai <span style="color: #c792ea;">import</span> OpenAI

client = OpenAI()  <span style="color: #546e7a;"># Uses OPENAI_API_KEY env var</span>

<span style="color: #c792ea;">def</span> <span style="color: #82aaff;">openai_embed</span>(texts):
    response = client.embeddings.create(
        model=<span style="color: #c3e88d;">"text-embedding-3-small"</span>,
        input=texts
    )
    <span style="color: #c792ea;">return</span> [r.embedding <span style="color: #c792ea;">for</span> r <span style="color: #c792ea;">in</span> response.data]

db = Vectrix(
    <span style="color: #c3e88d;">"docs"</span>,
    tier=<span style="color: #c3e88d;">"hybrid"</span>,
    embed_fn=openai_embed,
    dimension=<span style="color: #f78c6c;">1536</span>
)
db.add([<span style="color: #c3e88d;">"Document 1"</span>, <span style="color: #c3e88d;">"Document 2"</span>])
results = db.search(<span style="color: #c3e88d;">"query"</span>)</pre>
                </div>
              </div>

              <!-- Cohere -->
              <div>
                <div style="font-weight: 500; margin-bottom: 8px;">Cohere Embeddings</div>
                <div class="code-block" onclick="copyCode(this)" style="cursor: pointer; position: relative;">
                  <div style="position: absolute; top: 8px; right: 8px; font-size: 10px; color: var(--text-disabled);">click to copy</div>
                  <pre style="background: var(--bg-default); padding: 16px; border-radius: 8px; font-size: 13px; overflow-x: auto; margin: 0; font-family: 'JetBrains Mono', monospace;"><span style="color: #546e7a;"># pip install cohere</span>
<span style="color: #c792ea;">from</span> vectrixdb <span style="color: #c792ea;">import</span> Vectrix
<span style="color: #c792ea;">import</span> cohere

co = cohere.Client(<span style="color: #c3e88d;">"YOUR_API_KEY"</span>)

<span style="color: #c792ea;">def</span> <span style="color: #82aaff;">cohere_embed</span>(texts):
    response = co.embed(texts=texts, model=<span style="color: #c3e88d;">"embed-english-v3.0"</span>)
    <span style="color: #c792ea;">return</span> response.embeddings

db = Vectrix(
    <span style="color: #c3e88d;">"docs"</span>,
    tier=<span style="color: #c3e88d;">"hybrid"</span>,
    embed_fn=cohere_embed,
    dimension=<span style="color: #f78c6c;">1024</span>
)</pre>
                </div>
              </div>
            </div>
          </div>

          <!-- Direct Embedders Section -->
          <div id="code-embedders" class="card" style="margin-bottom: 24px;">
            <div class="card-header" style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 36px; height: 36px; border-radius: 8px; background: rgba(220, 0, 78, 0.15); display: flex; align-items: center; justify-content: center;">
                <svg viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2" style="width: 20px; height: 20px;">
                  <rect x="4" y="4" width="16" height="16" rx="2" ry="2"/>
                  <rect x="9" y="9" width="6" height="6"/>
                  <line x1="9" y1="1" x2="9" y2="4"/>
                  <line x1="15" y1="1" x2="15" y2="4"/>
                  <line x1="9" y1="20" x2="9" y2="23"/>
                  <line x1="15" y1="20" x2="15" y2="23"/>
                  <line x1="20" y1="9" x2="23" y2="9"/>
                  <line x1="20" y1="14" x2="23" y2="14"/>
                  <line x1="1" y1="9" x2="4" y2="9"/>
                  <line x1="1" y1="14" x2="4" y2="14"/>
                </svg>
              </div>
              <span>Direct Embedder Access</span>
            </div>
            <div class="card-body">
              <p style="color: var(--text-secondary); margin-bottom: 16px;">Use embedders directly for custom pipelines.</p>

              <!-- All Embedders -->
              <div style="margin-bottom: 16px;">
                <div style="font-weight: 500; margin-bottom: 8px;">Available Embedders</div>
                <div class="code-block" onclick="copyCode(this)" style="cursor: pointer; position: relative;">
                  <div style="position: absolute; top: 8px; right: 8px; font-size: 10px; color: var(--text-disabled);">click to copy</div>
                  <pre style="background: var(--bg-default); padding: 16px; border-radius: 8px; font-size: 13px; overflow-x: auto; margin: 0; font-family: 'JetBrains Mono', monospace;"><span style="color: #c792ea;">from</span> vectrixdb.models <span style="color: #c792ea;">import</span> (
    DenseEmbedder,           <span style="color: #546e7a;"># Dense vectors (384 dim)</span>
    SparseEmbedder,          <span style="color: #546e7a;"># BM25 sparse vectors</span>
    RerankerEmbedder,        <span style="color: #546e7a;"># Cross-encoder reranking</span>
    LateInteractionEmbedder, <span style="color: #546e7a;"># ColBERT/BGE-M3 (128/1024 dim)</span>
    GraphExtractor,          <span style="color: #546e7a;"># Knowledge triplet extraction</span>
)</pre>
                </div>
              </div>

              <!-- Dense -->
              <div style="margin-bottom: 16px;">
                <div style="font-weight: 500; margin-bottom: 8px;">DenseEmbedder</div>
                <div class="code-block" onclick="copyCode(this)" style="cursor: pointer; position: relative;">
                  <div style="position: absolute; top: 8px; right: 8px; font-size: 10px; color: var(--text-disabled);">click to copy</div>
                  <pre style="background: var(--bg-default); padding: 16px; border-radius: 8px; font-size: 13px; overflow-x: auto; margin: 0; font-family: 'JetBrains Mono', monospace;"><span style="color: #c792ea;">from</span> vectrixdb.models <span style="color: #c792ea;">import</span> DenseEmbedder

<span style="color: #546e7a;"># English (bundled, faster)</span>
embedder = DenseEmbedder(language=<span style="color: #c3e88d;">"en"</span>)

<span style="color: #546e7a;"># Multilingual (auto-download)</span>
embedder = DenseEmbedder()

<span style="color: #546e7a;"># Generate embeddings</span>
vectors = embedder.embed([<span style="color: #c3e88d;">"Hello world"</span>, <span style="color: #c3e88d;">"How are you"</span>])
<span style="color: #82aaff;">print</span>(vectors.shape)  <span style="color: #546e7a;"># (2, 384)</span></pre>
                </div>
              </div>

              <!-- Reranker -->
              <div style="margin-bottom: 16px;">
                <div style="font-weight: 500; margin-bottom: 8px;">RerankerEmbedder</div>
                <div class="code-block" onclick="copyCode(this)" style="cursor: pointer; position: relative;">
                  <div style="position: absolute; top: 8px; right: 8px; font-size: 10px; color: var(--text-disabled);">click to copy</div>
                  <pre style="background: var(--bg-default); padding: 16px; border-radius: 8px; font-size: 13px; overflow-x: auto; margin: 0; font-family: 'JetBrains Mono', monospace;"><span style="color: #c792ea;">from</span> vectrixdb.models <span style="color: #c792ea;">import</span> RerankerEmbedder

reranker = RerankerEmbedder(language=<span style="color: #c3e88d;">"en"</span>)

scores = reranker.score(<span style="color: #c3e88d;">"What is AI?"</span>, [
    <span style="color: #c3e88d;">"AI is artificial intelligence"</span>,
    <span style="color: #c3e88d;">"The weather is sunny"</span>,
    <span style="color: #c3e88d;">"Machine learning is AI"</span>,
])
<span style="color: #82aaff;">print</span>(scores)  <span style="color: #546e7a;"># [0.99, 0.01, 0.87]</span>

<span style="color: #546e7a;"># Rerank and get sorted results</span>
ranked = reranker.rerank(<span style="color: #c3e88d;">"query"</span>, docs, top_k=<span style="color: #f78c6c;">5</span>)</pre>
                </div>
              </div>

              <!-- Late Interaction -->
              <div style="margin-bottom: 16px;">
                <div style="font-weight: 500; margin-bottom: 8px;">LateInteractionEmbedder (ColBERT/BGE-M3)</div>
                <div class="code-block" onclick="copyCode(this)" style="cursor: pointer; position: relative;">
                  <div style="position: absolute; top: 8px; right: 8px; font-size: 10px; color: var(--text-disabled);">click to copy</div>
                  <pre style="background: var(--bg-default); padding: 16px; border-radius: 8px; font-size: 13px; overflow-x: auto; margin: 0; font-family: 'JetBrains Mono', monospace;"><span style="color: #c792ea;">from</span> vectrixdb.models <span style="color: #c792ea;">import</span> LateInteractionEmbedder

<span style="color: #546e7a;"># English ColBERT (bundled, 128 dim)</span>
late = LateInteractionEmbedder(language=<span style="color: #c3e88d;">"en"</span>)

<span style="color: #546e7a;"># Multilingual BGE-M3 (auto-download, 1024 dim)</span>
late = LateInteractionEmbedder()

<span style="color: #546e7a;"># Encode query and document</span>
query_emb = late.encode_query(<span style="color: #c3e88d;">"What is machine learning?"</span>)
doc_emb = late.encode_document(<span style="color: #c3e88d;">"Machine learning is a subset of AI..."</span>)

<span style="color: #546e7a;"># MaxSim scoring</span>
score = late.max_sim(query_emb, doc_emb)
<span style="color: #82aaff;">print</span>(<span style="color: #c3e88d;">f"MaxSim: </span>{score:.4f}<span style="color: #c3e88d;">"</span>)</pre>
                </div>
              </div>

              <!-- Graph Extractor -->
              <div>
                <div style="font-weight: 500; margin-bottom: 8px;">GraphExtractor (Knowledge Triplets)</div>
                <div class="code-block" onclick="copyCode(this)" style="cursor: pointer; position: relative;">
                  <div style="position: absolute; top: 8px; right: 8px; font-size: 10px; color: var(--text-disabled);">click to copy</div>
                  <pre style="background: var(--bg-default); padding: 16px; border-radius: 8px; font-size: 13px; overflow-x: auto; margin: 0; font-family: 'JetBrains Mono', monospace;"><span style="color: #c792ea;">from</span> vectrixdb.models <span style="color: #c792ea;">import</span> GraphExtractor

extractor = GraphExtractor()

triplets = extractor.extract(<span style="color: #c3e88d;">"CRISPR-Cas9 can edit human DNA."</span>)
<span style="color: #c792ea;">for</span> t <span style="color: #c792ea;">in</span> triplets:
    <span style="color: #82aaff;">print</span>(<span style="color: #c3e88d;">f"</span>{t.head}<span style="color: #c3e88d;"> --[</span>{t.relation}<span style="color: #c3e88d;">]--> </span>{t.tail}<span style="color: #c3e88d;">"</span>)
<span style="color: #546e7a;"># Output: CRISPR-Cas9 --[can edit]--> human DNA</span></pre>
                </div>
              </div>
            </div>
          </div>

          <!-- LangChain Integration Section -->
          <div id="code-langchain" class="card" style="margin-bottom: 24px;">
            <div class="card-header" style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 36px; height: 36px; border-radius: 8px; background: rgba(0, 150, 136, 0.15); display: flex; align-items: center; justify-content: center;">
                <svg viewBox="0 0 24 24" fill="none" stroke="#009688" stroke-width="2" style="width: 20px; height: 20px;">
                  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                </svg>
              </div>
              <span>LangChain / LangGraph Integration</span>
            </div>
            <div class="card-body">
              <p style="color: var(--text-secondary); margin-bottom: 16px;">Build RAG agents with VectrixDB as the retriever.</p>

              <!-- VectrixRetriever -->
              <div style="margin-bottom: 16px;">
                <div style="font-weight: 500; margin-bottom: 8px;">Custom LangChain Retriever</div>
                <div class="code-block" onclick="copyCode(this)" style="cursor: pointer; position: relative;">
                  <div style="position: absolute; top: 8px; right: 8px; font-size: 10px; color: var(--text-disabled);">click to copy</div>
                  <pre style="background: var(--bg-default); padding: 16px; border-radius: 8px; font-size: 13px; overflow-x: auto; margin: 0; font-family: 'JetBrains Mono', monospace;"><span style="color: #c792ea;">from</span> vectrixdb <span style="color: #c792ea;">import</span> Vectrix
<span style="color: #c792ea;">from</span> langchain_core.retrievers <span style="color: #c792ea;">import</span> BaseRetriever
<span style="color: #c792ea;">from</span> langchain_core.documents <span style="color: #c792ea;">import</span> Document
<span style="color: #c792ea;">from</span> pydantic <span style="color: #c792ea;">import</span> Field
<span style="color: #c792ea;">from</span> typing <span style="color: #c792ea;">import</span> List, Optional

<span style="color: #c792ea;">class</span> <span style="color: #ffcb6b;">VectrixRetriever</span>(BaseRetriever):
    <span style="color: #c3e88d;">"""LangChain retriever for VectrixDB."""</span>

    db: Vectrix = Field(description=<span style="color: #c3e88d;">"VectrixDB instance"</span>)
    k: <span style="color: #82aaff;">int</span> = Field(default=<span style="color: #f78c6c;">4</span>)
    mode: <span style="color: #82aaff;">str</span> = Field(default=<span style="color: #c3e88d;">"hybrid"</span>)

    <span style="color: #c792ea;">class</span> <span style="color: #ffcb6b;">Config</span>:
        arbitrary_types_allowed = <span style="color: #f78c6c;">True</span>

    <span style="color: #c792ea;">def</span> <span style="color: #82aaff;">_get_relevant_documents</span>(self, query: <span style="color: #82aaff;">str</span>, **kwargs) -> List[Document]:
        results = self.db.search(query, mode=self.mode, limit=self.k)
        <span style="color: #c792ea;">return</span> [
            Document(
                page_content=r.text,
                metadata={<span style="color: #c3e88d;">"id"</span>: r.id, <span style="color: #c3e88d;">"score"</span>: r.score, **r.metadata}
            )
            <span style="color: #c792ea;">for</span> r <span style="color: #c792ea;">in</span> results
        ]</pre>
                </div>
              </div>

              <!-- RAG Chain -->
              <div style="margin-bottom: 16px;">
                <div style="font-weight: 500; margin-bottom: 8px;">Simple RAG Chain</div>
                <div class="code-block" onclick="copyCode(this)" style="cursor: pointer; position: relative;">
                  <div style="position: absolute; top: 8px; right: 8px; font-size: 10px; color: var(--text-disabled);">click to copy</div>
                  <pre style="background: var(--bg-default); padding: 16px; border-radius: 8px; font-size: 13px; overflow-x: auto; margin: 0; font-family: 'JetBrains Mono', monospace;"><span style="color: #c792ea;">from</span> vectrixdb <span style="color: #c792ea;">import</span> Vectrix
<span style="color: #c792ea;">from</span> langchain_openai <span style="color: #c792ea;">import</span> ChatOpenAI
<span style="color: #c792ea;">from</span> langchain.chains <span style="color: #c792ea;">import</span> create_retrieval_chain
<span style="color: #c792ea;">from</span> langchain.chains.combine_documents <span style="color: #c792ea;">import</span> create_stuff_documents_chain
<span style="color: #c792ea;">from</span> langchain_core.prompts <span style="color: #c792ea;">import</span> ChatPromptTemplate

<span style="color: #546e7a;"># Create VectrixDB + retriever</span>
db = Vectrix(<span style="color: #c3e88d;">"docs"</span>, tier=<span style="color: #c3e88d;">"hybrid"</span>)
db.add([<span style="color: #c3e88d;">"Your documents..."</span>])
retriever = VectrixRetriever(db=db, k=<span style="color: #f78c6c;">4</span>, mode=<span style="color: #c3e88d;">"hybrid"</span>)

<span style="color: #546e7a;"># Create RAG chain</span>
llm = ChatOpenAI(model=<span style="color: #c3e88d;">"gpt-4o-mini"</span>)

prompt = ChatPromptTemplate.from_messages([
    (<span style="color: #c3e88d;">"system"</span>, <span style="color: #c3e88d;">"Answer based on context:\n{context}"</span>),
    (<span style="color: #c3e88d;">"human"</span>, <span style="color: #c3e88d;">"{input}"</span>)
])

doc_chain = create_stuff_documents_chain(llm, prompt)
rag_chain = create_retrieval_chain(retriever, doc_chain)

<span style="color: #546e7a;"># Use it</span>
result = rag_chain.invoke({<span style="color: #c3e88d;">"input"</span>: <span style="color: #c3e88d;">"What is...?"</span>})
<span style="color: #82aaff;">print</span>(result[<span style="color: #c3e88d;">"answer"</span>])</pre>
                </div>
              </div>

              <!-- Benefits -->
              <div style="background: var(--bg-default); border-radius: 8px; padding: 16px;">
                <div style="font-weight: 500; margin-bottom: 12px;">VectrixDB vs Chroma for RAG</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; font-size: 13px;">
                  <div>
                    <div style="color: var(--text-disabled); margin-bottom: 4px;">Chroma</div>
                    <ul style="margin: 0; padding-left: 16px; color: var(--text-secondary);">
                      <li>Requires OpenAI embeddings</li>
                      <li>Single search mode</li>
                      <li>No built-in reranking</li>
                    </ul>
                  </div>
                  <div>
                    <div style="color: var(--success); margin-bottom: 4px;">VectrixDB</div>
                    <ul style="margin: 0; padding-left: 16px; color: var(--text-primary);">
                      <li>Bundled embeddings (free!)</li>
                      <li>Dense, sparse, hybrid, ultimate</li>
                      <li>Built-in cross-encoder reranking</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- CLI Reference -->
          <div class="card">
            <div class="card-header" style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 36px; height: 36px; border-radius: 8px; background: rgba(103, 58, 183, 0.15); display: flex; align-items: center; justify-content: center;">
                <svg viewBox="0 0 24 24" fill="none" stroke="#673ab7" stroke-width="2" style="width: 20px; height: 20px;">
                  <polyline points="4 17 10 11 4 5"/>
                  <line x1="12" y1="19" x2="20" y2="19"/>
                </svg>
              </div>
              <span>CLI Commands</span>
            </div>
            <div class="card-body">
              <div class="code-block" onclick="copyCode(this)" style="cursor: pointer; position: relative;">
                <div style="position: absolute; top: 8px; right: 8px; font-size: 10px; color: var(--text-disabled);">click to copy</div>
                <pre style="background: var(--bg-default); padding: 16px; border-radius: 8px; font-size: 13px; overflow-x: auto; margin: 0; font-family: 'JetBrains Mono', monospace;"><span style="color: #546e7a;"># Install</span>
pip install vectrixdb

<span style="color: #546e7a;"># Set API key (enables write operations)</span>
<span style="color: #546e7a;"># Linux/Mac:</span>
export VECTRIXDB_API_KEY=<span style="color: #c3e88d;">"your-secret-key"</span>
<span style="color: #546e7a;"># Windows:</span>
set VECTRIXDB_API_KEY=<span style="color: #c3e88d;">your-secret-key</span>

<span style="color: #546e7a;"># Optional: Read-only API key (view but not modify)</span>
export VECTRIXDB_READ_ONLY_API_KEY=<span style="color: #c3e88d;">"viewer-key"</span>

<span style="color: #546e7a;"># Download models (optional - English models bundled)</span>
vectrixdb download-models                     <span style="color: #546e7a;"># All multilingual</span>
vectrixdb download-models --type dense        <span style="color: #546e7a;"># Dense only</span>
vectrixdb download-models --type late_interaction  <span style="color: #546e7a;"># BGE-M3</span>

<span style="color: #546e7a;"># Start server with dashboard (CLI)</span>
vectrixdb serve --port 7337

<span style="color: #546e7a;"># Start server without dashboard (CLI)</span>
vectrixdb serve --port 7337 --no-dashboard

<span style="color: #546e7a;"># Start server programmatically (Python)</span>
<span style="color: #c792ea;">from</span> vectrixdb.api.server <span style="color: #c792ea;">import</span> run_server
run_server(host=<span style="color: #c3e88d;">"0.0.0.0"</span>, port=<span style="color: #f78c6c;">7337</span>, db_path=<span style="color: #c3e88d;">"./vectrixdb_data"</span>)

<span style="color: #546e7a;"># Or with uvicorn directly</span>
<span style="color: #c792ea;">import</span> uvicorn
<span style="color: #c792ea;">from</span> vectrixdb.api.server <span style="color: #c792ea;">import</span> create_app
app = create_app(db_path=<span style="color: #c3e88d;">"./vectrixdb_data"</span>)
uvicorn.run(app, host=<span style="color: #c3e88d;">"0.0.0.0"</span>, port=<span style="color: #f78c6c;">7337</span>)

<span style="color: #546e7a;"># Database info</span>
vectrixdb info ./vectrixdb_data
vectrixdb list ./vectrixdb_data

<span style="color: #546e7a;"># Check models</span>
vectrixdb models-info</pre>
              </div>
            </div>
          </div>
        </div>

      </main>
    </div>

    <button class="fab hidden" id="fab" onclick="openDialog('create')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
      </svg>
    </button>
  </div>

  <!-- Create Collection Dialog -->
  <div class="dialog-overlay" id="dialog-create">
    <div class="dialog" style="max-width: 700px; max-height: none; overflow: visible;">
      <div class="dialog-title" style="display: flex; justify-content: space-between; align-items: center;">
        <span>Create Collection</span>
        <div class="lang-toggle" id="create-lang-toggle" onclick="toggleCreateLang()">
          <span class="lang-toggle-option active" data-lang="en">EN</span>
          <span class="lang-toggle-option" data-lang="multi">ML</span>
          <div class="lang-toggle-slider"></div>
        </div>
      </div>
      <div class="dialog-content">
        <div class="form-group">
          <label class="form-label">Name</label>
          <input type="text" class="form-input" id="create-name" placeholder="my_collection">
        </div>
        <div class="form-group">
          <label class="form-label">Dimension</label>
          <input type="number" class="form-input" id="create-dimension" value="384">
        </div>
        <div class="form-group">
          <label class="form-label">Metric</label>
          <select class="form-select" id="create-metric">
            <option value="cosine">Cosine</option>
            <option value="euclidean">Euclidean</option>
            <option value="dot">Dot Product</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Tier</label>
          <div class="tier-selector" id="create-tier">
            <label class="tier-option" data-tier="dense">
              <input type="radio" name="tier" value="dense" checked>
              <div class="tier-card">
                <div class="tier-name">Dense</div>
                <div class="tier-desc">Vector search</div>
              </div>
            </label>
            <label class="tier-option" data-tier="hybrid">
              <input type="radio" name="tier" value="hybrid">
              <div class="tier-card">
                <div class="tier-name">Hybrid</div>
                <div class="tier-desc">+ BM25 + Rerank</div>
              </div>
            </label>
            <label class="tier-option" data-tier="ultimate">
              <input type="radio" name="tier" value="ultimate">
              <div class="tier-card">
                <div class="tier-name">Ultimate</div>
                <div class="tier-desc">+ Late Interaction</div>
              </div>
            </label>
            <label class="tier-option" data-tier="graph">
              <input type="radio" name="tier" value="graph">
              <div class="tier-card">
                <div class="tier-name">Graph</div>
                <div class="tier-desc">+ Knowledge Graph</div>
              </div>
            </label>
          </div>
        </div>
        <div class="form-group" style="margin-bottom: 0;">
          <label class="form-label">Import Data (optional)</label>
          <div class="file-dropzone" id="create-dropzone" onclick="document.getElementById('create-file-input').click()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14 2 14 8 20 8"/>
              <line x1="12" y1="18" x2="12" y2="12"/>
              <line x1="9" y1="15" x2="12" y2="12"/>
              <line x1="15" y1="15" x2="12" y2="12"/>
            </svg>
            <div class="file-dropzone-text">Drop .md files here or click to browse</div>
            <div class="file-dropzone-hint">Auto-chunked by headers and indexed</div>
          </div>
          <input type="file" id="create-file-input" accept=".md,.txt" multiple style="display: none;" onchange="handleFileSelect(event)">
          <div class="file-list" id="create-file-list"></div>
        </div>
      </div>
      <div class="dialog-actions">
        <button class="btn btn-text" onclick="closeDialog('create')">CANCEL</button>
        <button class="btn btn-primary" onclick="createCollection()">CREATE</button>
      </div>
    </div>
  </div>

  <!-- Auth Dialog -->
  <div class="dialog-overlay" id="dialog-auth">
    <div class="dialog">
      <div class="dialog-title" id="auth-dialog-title">Authenticate</div>
      <div class="dialog-content">
        <p id="auth-dialog-desc" style="color: var(--text-secondary); margin-bottom: 16px; font-size: 14px;">
          Enter the server API key to unlock full access. Data is redacted in read-only mode.
        </p>
        <div class="form-group" style="margin-bottom: 0;" id="auth-input-group">
          <label class="form-label">Server API Key</label>
          <input type="password" class="form-input" id="auth-key" placeholder="Enter server API key...">
        </div>
      </div>
      <div class="dialog-actions" id="auth-dialog-actions">
        <button class="btn btn-text" onclick="closeDialog('auth')">CANCEL</button>
        <button class="btn btn-primary" id="auth-action-btn" onclick="handleAuthAction()">LOGIN</button>
      </div>
    </div>
  </div>

  <!-- Confirm Dialog -->
  <div class="dialog-overlay" id="dialog-confirm">
    <div class="dialog">
      <div class="dialog-title">Confirm Action</div>
      <div class="dialog-content">
        <p class="confirm-message" id="confirm-message"></p>
        <div class="confirm-warning" id="confirm-warning"></div>
      </div>
      <div class="dialog-actions">
        <button class="btn btn-text" onclick="closeDialog('confirm')">CANCEL</button>
        <button class="btn btn-primary" id="confirm-action-btn" onclick="confirmAction()">CONFIRM</button>
      </div>
    </div>
  </div>

  <div class="snackbar" id="snackbar"></div>

  <script>
    const API = window.location.origin;

    // State
    let apiKey = localStorage.getItem('vectrix_key') || '';
    let pendingConfirm = null;
    let collectionsCache = [];  // Store collections data for tag lookup
    let cyInstance = null;      // Cytoscape instance

    const settings = {
      darkMode: localStorage.getItem('vectrix_dark') !== 'false',
      hideVectors: localStorage.getItem('vectrix_hideVectors') === 'true',
      maskPayload: localStorage.getItem('vectrix_maskPayload') === 'true',
      maskIds: localStorage.getItem('vectrix_maskIds') === 'true',
      safetyMode: localStorage.getItem('vectrix_safety') !== 'false'
    };

    // WebSocket for real-time updates
    let ws = null;
    let wsReconnectAttempts = 0;
    const MAX_RECONNECT_ATTEMPTS = 10;
    const RECONNECT_DELAY = 3000;

    function connectWebSocket() {
      const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
      const wsUrl = `${wsProtocol}//${window.location.host}/ws`;

      updateWsStatus('connecting');

      try {
        ws = new WebSocket(wsUrl);

        ws.onopen = function() {
          console.log('[VectrixDB] WebSocket connected');
          wsReconnectAttempts = 0;
          updateWsStatus('connected');
        };

        ws.onmessage = function(event) {
          try {
            const message = JSON.parse(event.data);
            handleWsEvent(message);
          } catch (e) {
            console.error('[VectrixDB] Failed to parse WebSocket message:', e);
          }
        };

        ws.onclose = function(event) {
          console.log('[VectrixDB] WebSocket disconnected', event.code, event.reason);
          updateWsStatus('disconnected');
          attemptReconnect();
        };

        ws.onerror = function(error) {
          console.error('[VectrixDB] WebSocket error:', error);
          updateWsStatus('disconnected');
        };
      } catch (error) {
        console.error('[VectrixDB] Failed to create WebSocket:', error);
        updateWsStatus('disconnected');
        attemptReconnect();
      }
    }

    function attemptReconnect() {
      if (wsReconnectAttempts < MAX_RECONNECT_ATTEMPTS) {
        wsReconnectAttempts++;
        console.log(`[VectrixDB] Reconnecting (attempt ${wsReconnectAttempts}/${MAX_RECONNECT_ATTEMPTS})...`);
        setTimeout(connectWebSocket, RECONNECT_DELAY);
      } else {
        console.error('[VectrixDB] Max reconnection attempts reached');
        updateWsStatus('disconnected');
      }
    }

    function updateWsStatus(status) {
      const statusEl = document.getElementById('ws-status');
      const textEl = document.getElementById('ws-text');
      if (!statusEl || !textEl) return;

      statusEl.className = 'ws-status ' + status;
      switch(status) {
        case 'connected':
          textEl.textContent = 'Live';
          statusEl.title = 'Real-time updates active';
          break;
        case 'connecting':
          textEl.textContent = 'Connecting...';
          statusEl.title = 'Connecting to server...';
          break;
        case 'disconnected':
          textEl.textContent = 'Offline';
          statusEl.title = 'Real-time updates unavailable. Click to retry.';
          statusEl.onclick = function() {
            wsReconnectAttempts = 0;
            connectWebSocket();
          };
          break;
      }
    }

    function handleWsEvent(message) {
      const { event, data, timestamp } = message;
      console.log(`[VectrixDB] Event: ${event}`, data);

      switch(event) {
        case 'connected':
          showSnackbar('Real-time updates connected');
          break;

        case 'collection_created':
          showSnackbar(`Collection "${data.name}" created`);
          loadCollections();
          break;

        case 'collection_deleted':
          showSnackbar(`Collection "${data.name}" deleted`);
          loadCollections();
          break;

        case 'points_added':
          showSnackbar(`${data.added} points added to "${data.collection}"`);
          loadCollections();
          break;

        case 'points_deleted':
          showSnackbar(`${data.deleted} points deleted from "${data.collection}"`);
          loadCollections();
          break;

        case 'keepalive':
          // Send pong to keep connection alive
          if (ws && ws.readyState === WebSocket.OPEN) {
            ws.send('ping');
          }
          break;

        case 'pong':
          // Server responded to our ping
          break;

        default:
          console.log(`[VectrixDB] Unhandled event: ${event}`);
      }
    }

    // Initialize
    function init() {
      applyTheme();
      applyToggles();
      updateAuthBadge();
      loadCollections();
      setupNavigation();
      connectWebSocket();
      setupDropzone();

      // Restore last visited page
      const savedPage = localStorage.getItem('vectrix_current_page');
      if (savedPage) {
        showPage(savedPage);
      }
    }

    // Navigation
    function setupNavigation() {
      document.querySelectorAll('.drawer-item').forEach(item => {
        item.addEventListener('click', function() {
          const page = this.dataset.page;
          if (page) showPage(page);
        });
      });
    }

    function showPage(page) {
      document.querySelectorAll('.drawer-item').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));

      const navItem = document.querySelector(`[data-page="${page}"]`);
      const pageEl = document.getElementById(`page-${page}`);

      if (navItem) navItem.classList.add('active');
      if (pageEl) pageEl.classList.add('active');

      // Show FAB only on collections page when authenticated
      const fab = document.getElementById('fab');
      if (page === 'collections' && apiKey) {
        fab.classList.remove('hidden');
      } else {
        fab.classList.add('hidden');
      }

      // Save current page for persistence on refresh
      localStorage.setItem('vectrix_current_page', page);

      // Page-specific initialization
      if (page === 'api-requests') {
        // Update time range button states
        document.querySelectorAll('.api-time-btn').forEach(btn => {
          btn.classList.toggle('active', btn.dataset.range === apiMetrics.timeRange);
        });
        // Load server metrics and render
        loadServerMetrics().then(() => renderApiMetrics());
      }
    }

    // Copy code to clipboard
    function copyCode(element) {
      const pre = element.querySelector('pre');
      if (!pre) return;

      // Get text content, stripping HTML tags
      const text = pre.textContent || pre.innerText;

      // Find the existing "click to copy" div (first child div)
      const feedback = element.querySelector('div');
      if (!feedback) return;

      navigator.clipboard.writeText(text).then(() => {
        // Show success feedback
        element.style.outline = '2px solid var(--success)';
        element.style.outlineOffset = '2px';
        feedback.textContent = 'Copied!';
        feedback.style.color = 'var(--success)';
        feedback.style.fontWeight = '500';

        setTimeout(() => {
          element.style.outline = 'none';
          element.style.outlineOffset = '0';
          feedback.textContent = 'click to copy';
          feedback.style.color = 'var(--text-disabled)';
          feedback.style.fontWeight = 'normal';
        }, 1500);
      }).catch(err => {
        console.error('Copy failed:', err);
      });
    }

    // Theme
    function applyTheme() {
      if (settings.darkMode) {
        document.documentElement.classList.remove('light');
        document.getElementById('theme-icon').innerHTML = '<circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>';
      } else {
        document.documentElement.classList.add('light');
        document.getElementById('theme-icon').innerHTML = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>';
      }
    }

    function toggleTheme() {
      settings.darkMode = !settings.darkMode;
      localStorage.setItem('vectrix_dark', settings.darkMode);
      applyTheme();
    }

    function applyToggles() {
      const toggles = {
        'toggle-vectors': settings.hideVectors,
        'toggle-payload': settings.maskPayload,
        'toggle-ids': settings.maskIds,
        'toggle-safety': settings.safetyMode
      };
      for (const [id, active] of Object.entries(toggles)) {
        const el = document.getElementById(id);
        if (el) el.classList.toggle('active', active);
      }
    }

    function toggleSetting(key) {
      if (!apiKey) {
        showSnackbar('API key required to change settings');
        return;
      }
      settings[key] = !settings[key];
      localStorage.setItem('vectrix_' + key, settings[key]);
      applyToggles();

      // Re-render data with new settings
      refreshDisplayedData();
      showSnackbar(`${key === 'hideVectors' ? 'Hide Vectors' : key === 'maskPayload' ? 'Mask Payload' : key === 'maskIds' ? 'Mask IDs' : 'Safety Mode'} ${settings[key] ? 'enabled' : 'disabled'}`);
    }

    function refreshDisplayedData() {
      // Re-run search if there are results displayed
      const resultsContainer = document.getElementById('search-results');
      if (resultsContainer && resultsContainer.style.display !== 'none') {
        const query = document.getElementById('search-query').value.trim();
        const collection = document.getElementById('search-collection').value;
        if (query && collection) {
          performSearch();
        }
      }
    }

    // Auth
    function getHeaders() {
      const h = { 'Content-Type': 'application/json' };
      if (apiKey) h['api-key'] = apiKey;
      return h;
    }

    function updateAuthBadge() {
      const badge = document.getElementById('auth-badge');
      const text = document.getElementById('auth-text');
      if (apiKey) {
        badge.className = 'auth-badge authenticated';
        text.textContent = 'Authenticated';
      } else {
        badge.className = 'auth-badge read-only';
        text.textContent = 'Read Only';
      }
      // Update FAB visibility
      const fab = document.getElementById('fab');
      const currentPage = document.querySelector('.page.active')?.id?.replace('page-', '');
      if (currentPage === 'collections' && apiKey) {
        fab.classList.remove('hidden');
      } else {
        fab.classList.add('hidden');
      }

      // Update Browse tab state
      updateBrowseTabState();
    }

    async function saveApiKey() {
      const inputKey = document.getElementById('auth-key').value.trim();
      if (!inputKey) {
        showSnackbar('Please enter an API key');
        return;
      }

      // First check if auth is even enabled on the server
      try {
        const statusRes = await fetch(`${API}/auth/status`);
        const statusData = await statusRes.json();
        if (!statusData.data?.auth_enabled) {
          showSnackbar('Server has no API key configured. Authentication is disabled.');
          return;
        }
      } catch (e) {
        showSnackbar('Could not check server auth status: ' + e.message);
        return;
      }

      // Validate the API key by making a test request
      try {
        const res = await fetch(`${API}/api/collections`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'api-key': inputKey },
          body: JSON.stringify({ name: '__test_auth__', dimension: 1, metric: 'cosine' })
        });

        // 401 = invalid key, 409 = collection exists (key is valid), 2xx = success (key is valid)
        if (res.status === 401) {
          showSnackbar('Invalid API key');
          return;
        }

        // If we created a test collection, delete it
        if (res.status === 200 || res.status === 201) {
          await fetch(`${API}/api/collections/__test_auth__`, {
            method: 'DELETE',
            headers: { 'Content-Type': 'application/json', 'api-key': inputKey }
          });
        }

        // Key is valid
        apiKey = inputKey;
        localStorage.setItem('vectrix_key', apiKey);
        updateAuthBadge();
        closeDialog('auth');
        loadCollections();
        showSnackbar('Authenticated successfully');
      } catch (e) {
        showSnackbar('Error validating API key: ' + e.message);
      }
    }

    function clearApiKey() {
      apiKey = '';
      localStorage.removeItem('vectrix_key');
      document.getElementById('auth-key').value = '';
      updateAuthBadge();
      closeDialog('auth');
      loadCollections();  // Refresh to hide delete buttons
      showSnackbar('Logged out');
    }

    function handleAuthAction() {
      if (apiKey) {
        // Already logged in - this is logout
        clearApiKey();
      } else {
        // Not logged in - this is login
        saveApiKey();
      }
    }

    // Dialogs
    function openDialog(name) {
      document.getElementById(`dialog-${name}`).classList.add('active');
      if (name === 'auth') {
        const title = document.getElementById('auth-dialog-title');
        const desc = document.getElementById('auth-dialog-desc');
        const inputGroup = document.getElementById('auth-input-group');
        const actionBtn = document.getElementById('auth-action-btn');

        if (apiKey) {
          // Already authenticated - show logout option
          title.textContent = 'Authenticated';
          desc.textContent = 'You have full access. Click logout to switch to read-only mode.';
          inputGroup.style.display = 'none';
          actionBtn.textContent = 'LOGOUT';
          actionBtn.className = 'btn btn-danger';
        } else {
          // Not authenticated - show login form
          title.textContent = 'Authenticate';
          desc.textContent = 'Enter the server API key to unlock full access. Data is redacted in read-only mode.';
          inputGroup.style.display = 'block';
          actionBtn.textContent = 'LOGIN';
          actionBtn.className = 'btn btn-primary';
          document.getElementById('auth-key').value = '';
        }
      }
    }

    function closeDialog(name) {
      document.getElementById(`dialog-${name}`).classList.remove('active');
    }

    document.querySelectorAll('.dialog-overlay').forEach(el => {
      el.addEventListener('click', e => {
        if (e.target === el) closeDialog(el.id.replace('dialog-', ''));
      });
    });

    function showConfirm(title, message, callback, isDestructive = false) {
      document.getElementById('confirm-message').textContent = title;
      document.getElementById('confirm-warning').textContent = message;
      const confirmBtn = document.getElementById('confirm-action-btn');
      if (isDestructive) {
        confirmBtn.className = 'btn btn-danger';
        confirmBtn.textContent = 'DELETE';
      } else {
        confirmBtn.className = 'btn btn-primary';
        confirmBtn.textContent = 'CONFIRM';
      }
      pendingConfirm = callback;
      openDialog('confirm');
    }

    function confirmAction() {
      closeDialog('confirm');
      if (pendingConfirm) pendingConfirm();
      pendingConfirm = null;
    }

    // Snackbar
    function showSnackbar(msg) {
      const el = document.getElementById('snackbar');
      el.textContent = msg;
      el.classList.add('show');
      setTimeout(() => el.classList.remove('show'), 3000);
    }

    // Helpers
    function formatBytes(b) {
      if (!b) return '0 B';
      const k = 1024, s = ['B', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(b) / Math.log(k));
      return (b / Math.pow(k, i)).toFixed(1) + ' ' + s[i];
    }

    function renderCollectionTags(tags) {
      if (!tags || tags.length === 0) return '';
      const tagClassMap = {
        'dense': 'tag-dense',
        'sparse': 'tag-sparse',
        'hybrid': 'tag-hybrid',
        'ultimate': 'tag-ultimate',
        'graph': 'tag-graph',
        'demo': 'tag-demo',
        'en': 'tag-en',
        'ml': 'tag-ml'
      };
      const tagsHtml = tags.map(tag => {
        const tagClass = tagClassMap[tag.toLowerCase()] || 'tag-default';
        const displayTag = tag.toLowerCase() === 'en' ? 'EN' : (tag.toLowerCase() === 'ml' ? 'ML' : tag);
        return `<span class="tag ${tagClass}">${displayTag}</span>`;
      }).join('');
      return `<div class="collection-tags">${tagsHtml}</div>`;
    }

    function maskText(text) {
      if (!settings.maskPayload || !text || text.length < 20) return text;
      return text.substring(0, 15) + '***...';
    }

    function maskId(id) {
      if (!settings.maskIds || !id) return id;
      return id.length > 6 ? id.substring(0, 3) + '***' : '***';
    }

    function formatVector(dim) {
      return settings.hideVectors ? `[${dim} dims]` : `[${dim} values]`;
    }

    // Language toggle for search
    let searchLang = 'en';
    function toggleSearchLang() {
      const toggle = document.getElementById('search-lang-toggle');
      searchLang = searchLang === 'en' ? 'multi' : 'en';
      toggle.classList.toggle('multi', searchLang === 'multi');
      toggle.querySelectorAll('.lang-toggle-option').forEach(opt => {
        opt.classList.toggle('active', opt.dataset.lang === searchLang);
      });
    }

    // Language toggle for create collection
    let createLang = 'en';
    function toggleCreateLang() {
      const toggle = document.getElementById('create-lang-toggle');
      createLang = createLang === 'en' ? 'multi' : 'en';
      toggle.classList.toggle('multi', createLang === 'multi');
      toggle.querySelectorAll('.lang-toggle-option').forEach(opt => {
        opt.classList.toggle('active', opt.dataset.lang === createLang);
      });
    }

    // File upload handling
    let pendingFiles = [];

    function handleFileSelect(event) {
      const files = Array.from(event.target.files);
      files.forEach(file => {
        if (!pendingFiles.find(f => f.name === file.name)) {
          pendingFiles.push(file);
        }
      });
      renderFileList();
    }

    function renderFileList() {
      const list = document.getElementById('create-file-list');
      if (!pendingFiles.length) {
        list.innerHTML = '';
        return;
      }
      list.innerHTML = pendingFiles.map((f, i) => `
        <div class="file-item">
          <div class="file-item-name">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width: 14px; height: 14px;">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14 2 14 8 20 8"/>
            </svg>
            ${f.name}
          </div>
          <div class="file-item-size">${formatBytes(f.size)}</div>
          <button class="file-item-remove" onclick="removeFile(${i})">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 14px; height: 14px;">
              <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>
      `).join('');
    }

    function removeFile(index) {
      pendingFiles.splice(index, 1);
      renderFileList();
    }

    // Parse markdown into chunks by headers
    function parseMarkdown(content, filename) {
      const chunks = [];
      const lines = content.split('\n');
      let currentChunk = { text: '', header: filename };

      for (const line of lines) {
        // Check for headers (## or ###)
        const headerMatch = line.match(/^#{1,3}\s+(.+)/);
        if (headerMatch) {
          // Save previous chunk if it has content
          if (currentChunk.text.trim()) {
            chunks.push({ ...currentChunk, text: currentChunk.text.trim() });
          }
          currentChunk = { text: '', header: headerMatch[1].trim() };
        } else {
          currentChunk.text += line + '\n';
        }
      }

      // Don't forget the last chunk
      if (currentChunk.text.trim()) {
        chunks.push({ ...currentChunk, text: currentChunk.text.trim() });
      }

      return chunks;
    }

    // Process files and add to collection
    async function processFilesForCollection(collectionName) {
      if (!pendingFiles.length) return;

      const allChunks = [];

      for (const file of pendingFiles) {
        const content = await file.text();
        const chunks = parseMarkdown(content, file.name);
        allChunks.push(...chunks);
      }

      if (!allChunks.length) return;

      // Add chunks to collection via API
      try {
        const lang = createLang;
        const res = await fetch(`${API}/api/v2/collections/${collectionName}/add`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({
            texts: allChunks.map(c => c.text),
            metadatas: allChunks.map(c => ({ source: c.header, type: 'markdown' })),
            language: lang
          })
        });

        if (res.ok) {
          showSnackbar(`Added ${allChunks.length} chunks from ${pendingFiles.length} file(s)`);
        } else {
          const data = await res.json();
          showSnackbar(data.message || 'Failed to add file content');
        }
      } catch (e) {
        showSnackbar('Error processing files: ' + e.message);
      }

      // Clear pending files
      pendingFiles = [];
      renderFileList();
    }

    // Setup dropzone drag-and-drop
    function setupDropzone() {
      const dropzone = document.getElementById('create-dropzone');
      if (!dropzone) return;

      ['dragenter', 'dragover'].forEach(event => {
        dropzone.addEventListener(event, (e) => {
          e.preventDefault();
          dropzone.classList.add('dragover');
        });
      });

      ['dragleave', 'drop'].forEach(event => {
        dropzone.addEventListener(event, (e) => {
          e.preventDefault();
          dropzone.classList.remove('dragover');
        });
      });

      dropzone.addEventListener('drop', (e) => {
        const files = Array.from(e.dataTransfer.files).filter(f =>
          f.name.endsWith('.md') || f.name.endsWith('.txt')
        );
        files.forEach(file => {
          if (!pendingFiles.find(f => f.name === file.name)) {
            pendingFiles.push(file);
          }
        });
        renderFileList();
      });
    }

    // API Calls
    async function loadCollections() {
      const grid = document.getElementById('collections-grid');
      const select = document.getElementById('search-collection');

      try {
        const res = await fetch(`${API}/api/collections`, { headers: getHeaders() });
        const data = await res.json();

        select.innerHTML = '<option value="">Select collection</option>';

        // Cache collections data for tag lookup
        collectionsCache = data.collections || [];

        if (!data.collections?.length) {
          grid.innerHTML = '<div class="empty-state" style="grid-column:1/-1"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg><h3>No collections</h3><p>Create your first collection</p></div>';
          return;
        }

        grid.innerHTML = data.collections.map(c => {
          return `
          <div class="collection-card">
            <div class="collection-header" onclick="selectCollection('${c.name}')" style="cursor: pointer;">
              <div class="collection-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                </svg>
              </div>
              <div style="flex: 1;">
                <div class="collection-name">${c.name}</div>
                <div class="collection-status">Ready</div>
              </div>
              ${apiKey ? `<button class="btn btn-text collection-delete-btn" onclick="event.stopPropagation(); confirmDeleteCollection('${c.name}')" title="Delete collection">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
                  <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                </svg>
              </button>` : ''}
            </div>
            ${renderCollectionTags(c.tags || [])}
            <div class="collection-stats" onclick="selectCollection('${c.name}')" style="cursor: pointer;">
              <div><div class="stat-value">${(c.count||0).toLocaleString()}</div><div class="stat-label">Vectors</div></div>
              <div><div class="stat-value">${c.dimension}</div><div class="stat-label">Dims</div></div>
              <div><div class="stat-value">${c.metric}</div><div class="stat-label">Metric</div></div>
              <div><div class="stat-value">${formatBytes(c.size_bytes)}</div><div class="stat-label">Size</div></div>
            </div>
          </div>
        `}).join('');

        data.collections.forEach(c => {
          const opt = document.createElement('option');
          opt.value = c.name;
          opt.textContent = c.name;
          select.appendChild(opt);
        });
      } catch (e) {
        grid.innerHTML = `<div class="empty-state" style="grid-column:1/-1"><h3>Error</h3><p>${e.message}</p></div>`;
      }
    }

    function selectCollection(name) {
      document.getElementById('search-collection').value = name;
      showPage('search');
      onCollectionChange();
    }

    // Tab switching
    function switchTab(tab) {
      // Check if Browse tab is disabled for read-only users
      if (tab === 'browse' && !apiKey) {
        showSnackbar('API key required to browse points');
        return;
      }

      // Check if Graph tab is disabled (no Graph tag)
      if (tab === 'graph') {
        const graphTab = document.getElementById('tab-graph');
        if (graphTab.classList.contains('disabled')) {
          showSnackbar('Collection must have Graph tag enabled');
          return;
        }
      }

      // Update tab buttons
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.getElementById('tab-' + tab).classList.add('active');

      // Update tab content
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.getElementById('content-' + tab).classList.add('active');

      // Load points if switching to browse
      if (tab === 'browse') {
        const collection = document.getElementById('search-collection').value;
        if (collection) {
          loadPoints(collection, 0);
        }
      }

      // Load graph if switching to graph tab
      if (tab === 'graph') {
        loadGraphData();
      }
    }

    // Update Browse tab state based on auth
    function updateBrowseTabState() {
      const browseTab = document.getElementById('tab-browse');
      const lockIcon = document.getElementById('browse-lock-icon');

      if (apiKey) {
        browseTab.classList.remove('disabled');
        browseTab.title = 'Browse all points in collection';
        if (lockIcon) lockIcon.style.display = 'none';
      } else {
        browseTab.classList.add('disabled');
        browseTab.title = 'API key required to browse points';
        if (lockIcon) lockIcon.style.display = 'inline';
      }
    }

    // Search mode handling - tier-aware
    // Dense: Dense only
    // Hybrid: Dense, Keyword, Rerank
    // Ultimate: Dense, Keyword, Rerank, Late Interaction
    // Graph: All modes + Knowledge Graph
    function updateSearchModeOptions(collectionData) {
      const keywordOption = document.getElementById('mode-keyword');
      const rerankOption = document.getElementById('mode-rerank');
      const lateOption = document.getElementById('mode-late');
      const hintEl = document.getElementById('search-mode-hint');

      // Determine tier from tags
      const tags = collectionData?.tags || [];
      const tagsLower = tags.map(t => t.toLowerCase());
      let tier = 'dense';
      for (const t of ['graph', 'ultimate', 'hybrid']) {
        if (tagsLower.includes(t)) {
          tier = t;
          break;
        }
      }

      // Tier hierarchy: dense < hybrid < ultimate < graph
      const tierLevel = { 'dense': 0, 'hybrid': 1, 'ultimate': 2, 'graph': 3 };
      const level = tierLevel[tier] || 0;

      // Enable/disable modes based on tier level
      // Keyword & Rerank: Hybrid+ (level >= 1)
      if (level >= 1) {
        keywordOption.classList.remove('disabled');
        rerankOption.classList.remove('disabled');
      } else {
        keywordOption.classList.add('disabled');
        rerankOption.classList.add('disabled');
      }

      // Late Interaction: Ultimate+ (level >= 2)
      if (level >= 2) {
        lateOption.classList.remove('disabled');
      } else {
        lateOption.classList.add('disabled');
      }

      // Update hint with tier info
      const tierColors = { 'dense': '#1976d2', 'hybrid': '#7b1fa2', 'ultimate': '#f50057', 'graph': '#00796b' };
      const tierModes = {
        'dense': 'Dense only',
        'hybrid': 'Dense, Keyword, Rerank',
        'ultimate': 'Dense, Keyword, Rerank, Late Interaction',
        'graph': 'All modes + Knowledge Graph'
      };

      hintEl.innerHTML = `<span style="color: ${tierColors[tier]}; font-weight: 500;">${tier.charAt(0).toUpperCase() + tier.slice(1)}</span>: ${tierModes[tier]}`;

      // Reset to dense if current mode is disabled
      const currentMode = getSelectedSearchMode();
      const modeElement = document.getElementById(`mode-${currentMode}`);
      if (modeElement?.classList.contains('disabled')) {
        selectSearchMode('dense');
      }
    }

    function getSelectedSearchMode() {
      const selected = document.querySelector('input[name="search-mode"]:checked');
      return selected ? selected.value : 'dense';
    }

    function selectSearchMode(mode) {
      const option = document.querySelector(`.search-mode-option[data-mode="${mode}"]`);
      if (option && !option.classList.contains('disabled')) {
        document.querySelectorAll('.search-mode-option').forEach(o => o.classList.remove('active'));
        option.classList.add('active');
        option.querySelector('input').checked = true;
      }
    }

    // Initialize search mode click handlers
    document.querySelectorAll('.search-mode-option').forEach(option => {
      option.addEventListener('click', function() {
        if (this.classList.contains('disabled')) return;
        document.querySelectorAll('.search-mode-option').forEach(o => o.classList.remove('active'));
        this.classList.add('active');
        this.querySelector('input').checked = true;
      });
    });

    // Collection change handler
    function onCollectionChange() {
      const collection = document.getElementById('search-collection').value;
      const title = document.getElementById('collection-page-title');

      if (collection) {
        title.textContent = collection;
      } else {
        title.textContent = 'Collection';
      }

      // Update Graph tab visibility based on collection tags
      const graphTab = document.getElementById('tab-graph');
      const collectionData = collectionsCache.find(c => c.name === collection);
      const hasGraphTag = collectionData?.tags?.some(t => t.toLowerCase() === 'graph');

      // Update search mode options based on collection tier
      updateSearchModeOptions(collectionData);

      // Show/hide Graph tab based on tag (no lock - just visibility)
      if (hasGraphTag) {
        graphTab.style.display = 'inline-flex';
      } else {
        graphTab.style.display = 'none';
        // If currently on Graph tab, switch to Search
        if (graphTab.classList.contains('active')) {
          switchTab('search');
        }
      }

      // Reset browse view when collection changes
      currentBrowsePage = 0;
      document.getElementById('points-table-body').innerHTML = `
        <tr>
          <td colspan="4" style="text-align: center; padding: 48px; color: var(--text-secondary);">
            ${collection ? 'Switch to Browse tab to view points' : 'Select a collection to browse points'}
          </td>
        </tr>
      `;
      document.getElementById('points-pagination').style.display = 'none';

      // Reset graph when collection changes
      if (cyInstance) {
        cyInstance.destroy();
        cyInstance = null;
      }
      document.getElementById('graph-loading').innerHTML = '<div>Switch to Graph tab to view knowledge graph</div>';
      document.getElementById('graph-stats').textContent = '';
      document.getElementById('entity-details').style.display = 'none';
    }

    // Browse points state
    let currentBrowsePage = 0;
    const pointsPerPage = 20;
    let totalPoints = 0;

    async function loadPoints(collection, page) {
      if (!collection || !apiKey) return;

      const offset = page * pointsPerPage;
      const tableBody = document.getElementById('points-table-body');
      const pagination = document.getElementById('points-pagination');

      tableBody.innerHTML = `
        <tr>
          <td colspan="4" style="text-align: center; padding: 48px; color: var(--text-secondary);">
            Loading points...
          </td>
        </tr>
      `;

      try {
        // Get point IDs
        const res = await fetch(`${API}/api/v1/collections/${collection}/points?limit=${pointsPerPage}&offset=${offset}`, {
          headers: getHeaders()
        });
        const data = await res.json();

        if (!data.ok) {
          throw new Error(data.message || 'Failed to load points');
        }

        totalPoints = data.data.total;
        const ids = data.data.ids;

        if (ids.length === 0) {
          tableBody.innerHTML = `
            <tr>
              <td colspan="4" style="text-align: center; padding: 48px; color: var(--text-secondary);">
                No points in this collection
              </td>
            </tr>
          `;
          pagination.style.display = 'none';
          return;
        }

        // Fetch each point's details
        const points = await Promise.all(ids.map(async id => {
          try {
            const pointRes = await fetch(`${API}/api/v1/collections/${collection}/points/${id}`, {
              headers: getHeaders()
            });
            const pointData = await pointRes.json();
            return pointData.ok ? pointData.data : null;
          } catch {
            return null;
          }
        }));

        // Render table
        tableBody.innerHTML = points.filter(p => p).map(point => `
          <tr>
            <td class="id-cell">${escapeHtml(point.id)}</td>
            <td class="metadata-cell">
              <code style="font-size: 11px;">${escapeHtml(JSON.stringify(point.metadata || {}))}</code>
            </td>
            <td class="vector-cell" title="${point.vector ? point.vector.length + ' dimensions' : 'N/A'}">
              ${point.vector ? '[' + point.vector.slice(0, 3).map(v => v.toFixed(3)).join(', ') + ', ...]' : 'N/A'}
            </td>
            <td>
              <button class="btn btn-text" style="color: var(--error); padding: 4px 8px;"
                      onclick="confirmDeletePoint('${collection}', '${point.id}')" title="Delete point">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
                  <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                </svg>
              </button>
            </td>
          </tr>
        `).join('');

        // Update pagination
        currentBrowsePage = page;
        const totalPages = Math.ceil(totalPoints / pointsPerPage);
        document.getElementById('pagination-info').textContent = `Page ${page + 1} of ${totalPages} (${totalPoints} points)`;
        document.getElementById('btn-prev-page').disabled = page === 0;
        document.getElementById('btn-next-page').disabled = page >= totalPages - 1;
        pagination.style.display = 'flex';

      } catch (error) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="4" style="text-align: center; padding: 48px; color: var(--error);">
              Error: ${escapeHtml(error.message)}
            </td>
          </tr>
        `;
        pagination.style.display = 'none';
      }
    }

    function loadPointsPage(direction) {
      const collection = document.getElementById('search-collection').value;
      const newPage = currentBrowsePage + direction;
      if (newPage >= 0 && collection) {
        loadPoints(collection, newPage);
      }
    }

    function confirmDeletePoint(collection, pointId) {
      showConfirm(
        'Delete Point',
        `Are you sure you want to delete point "${pointId}"?`,
        () => deletePoint(collection, pointId),
        true
      );
    }

    async function deletePoint(collection, pointId) {
      try {
        const res = await fetch(`${API}/api/v1/collections/${collection}/points`, {
          method: 'DELETE',
          headers: getHeaders(),
          body: JSON.stringify({ ids: [pointId] })
        });
        const data = await res.json();

        if (data.ok) {
          showSnackbar('Point deleted');
          loadPoints(collection, currentBrowsePage);
        } else {
          showSnackbar('Failed to delete point: ' + (data.message || 'Unknown error'));
        }
      } catch (error) {
        showSnackbar('Error: ' + error.message);
      }
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // ============================================
    // Cytoscape Graph Visualization Functions
    // ============================================

    // Entity type to color mapping
    const entityColors = {
      'person': '#2196f3',
      'organization': '#4caf50',
      'location': '#ff9800',
      'concept': '#9c27b0',
      'event': '#f44336',
      'date': '#00bcd4',
      'default': '#607d8b'
    };

    function getEntityColor(entityType) {
      if (!entityType) return entityColors.default;
      const type = entityType.toLowerCase();
      return entityColors[type] || entityColors.default;
    }

    async function extractGraphEntities() {
      const collection = document.getElementById('search-collection').value;
      if (!collection) {
        showSnackbar('Please select a collection first');
        return;
      }

      const btn = document.getElementById('extract-btn');
      const loadingEl = document.getElementById('graph-loading');

      btn.disabled = true;
      btn.textContent = 'Extracting...';
      loadingEl.innerHTML = '<div>Extracting entities with mREBEL model...</div><div style="font-size: 12px; margin-top: 8px;">This may take a moment...</div>';
      loadingEl.style.display = 'block';

      try {
        const res = await fetch(`${API}/api/v1/collections/${collection}/graph/extract`, {
          method: 'POST',
          headers: getHeaders()
        });
        const data = await res.json();

        if (!res.ok) {
          throw new Error(data.detail || data.message || 'Extraction failed');
        }

        showSnackbar(`Extracted ${data.data?.entities_extracted || 0} entities and ${data.data?.relationships_extracted || 0} relationships`);

        // Reload the graph
        await loadGraphData();

      } catch (e) {
        loadingEl.innerHTML = `<div style="color: var(--error);">Error: ${e.message}</div>`;
        showSnackbar('Error: ' + e.message);
      } finally {
        btn.disabled = false;
        btn.innerHTML = `
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; margin-right: 4px;">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 8v8M8 12h8"/>
          </svg>
          Extract Entities
        `;
      }
    }

    async function loadGraphData() {
      const collection = document.getElementById('search-collection').value;
      if (!collection) {
        showSnackbar('Please select a collection first');
        return;
      }

      const loadingEl = document.getElementById('graph-loading');
      loadingEl.innerHTML = '<div>Loading graph data...</div>';
      loadingEl.style.display = 'block';

      try {
        const res = await fetch(`${API}/api/v1/collections/${collection}/graph?limit=500`, {
          headers: getHeaders()
        });
        const data = await res.json();

        if (!data.ok) {
          throw new Error(data.message || 'Failed to load graph data');
        }

        const graphData = data.data;

        if (!graphData.nodes || graphData.nodes.length === 0) {
          loadingEl.innerHTML = '<div>No graph data found in this collection.<br><small style="color: var(--text-tertiary);">Add documents with GraphRAG enabled to see the knowledge graph.</small></div>';
          return;
        }

        // Update stats
        document.getElementById('graph-stats').textContent = `${graphData.nodes.length} entities, ${graphData.edges.length} relationships`;
        loadingEl.style.display = 'none';

        // Initialize Cytoscape
        initCytoscape(graphData);

      } catch (error) {
        loadingEl.innerHTML = `<div style="color: var(--error);">Error: ${escapeHtml(error.message)}</div>`;
      }
    }

    function initCytoscape(graphData) {
      // Destroy previous instance
      if (cyInstance) {
        cyInstance.destroy();
      }

      // Prepare Cytoscape elements
      const elements = [];

      // Add nodes
      graphData.nodes.forEach(node => {
        elements.push({
          data: {
            id: node.data.id,
            label: node.data.label || node.data.id,
            type: node.data.type || 'default',
            properties: node.data.properties || {}
          }
        });
      });

      // Add edges
      graphData.edges.forEach(edge => {
        elements.push({
          data: {
            id: edge.data.id,
            source: edge.data.source,
            target: edge.data.target,
            label: edge.data.label || '',
            type: edge.data.type || ''
          }
        });
      });

      // Initialize Cytoscape
      cyInstance = cytoscape({
        container: document.getElementById('cy'),
        elements: elements,
        style: [
          {
            selector: 'node',
            style: {
              'background-color': function(ele) {
                return getEntityColor(ele.data('type'));
              },
              'label': 'data(label)',
              'color': '#fff',
              'text-valign': 'center',
              'text-halign': 'center',
              'font-size': '10px',
              'text-wrap': 'ellipsis',
              'text-max-width': '80px',
              'width': 'label',
              'height': 'label',
              'padding': '12px',
              'shape': 'round-rectangle',
              'text-outline-color': function(ele) {
                return getEntityColor(ele.data('type'));
              },
              'text-outline-width': '2px',
              'min-width': '40px',
              'min-height': '40px'
            }
          },
          {
            selector: 'node:selected',
            style: {
              'border-width': '3px',
              'border-color': '#fff',
              'border-opacity': 1
            }
          },
          {
            selector: 'edge',
            style: {
              'width': 2,
              'line-color': '#90a4ae',
              'target-arrow-color': '#90a4ae',
              'target-arrow-shape': 'triangle',
              'curve-style': 'bezier',
              'label': 'data(label)',
              'font-size': '9px',
              'text-rotation': 'autorotate',
              'color': '#78909c',
              'text-background-color': 'var(--bg-paper)',
              'text-background-opacity': 0.8,
              'text-background-padding': '2px'
            }
          },
          {
            selector: 'edge:selected',
            style: {
              'width': 3,
              'line-color': '#2196f3',
              'target-arrow-color': '#2196f3'
            }
          }
        ],
        layout: {
          name: 'cose',
          animate: true,
          animationDuration: 500,
          nodeRepulsion: 8000,
          idealEdgeLength: 100,
          gravity: 0.25,
          numIter: 1000,
          initialTemp: 200
        },
        minZoom: 0.1,
        maxZoom: 3,
        wheelSensitivity: 0.3
      });

      // Node click handler
      cyInstance.on('tap', 'node', function(evt) {
        const node = evt.target;
        showEntityDetails(node.data());
      });

      // Background click handler
      cyInstance.on('tap', function(evt) {
        if (evt.target === cyInstance) {
          document.getElementById('entity-details').style.display = 'none';
        }
      });
    }

    function showEntityDetails(nodeData) {
      const detailsPanel = document.getElementById('entity-details');
      const nameEl = document.getElementById('entity-name');
      const infoEl = document.getElementById('entity-info');

      nameEl.textContent = nodeData.label || nodeData.id;

      let html = `
        <div style="margin-bottom: 8px;">
          <span style="font-weight: 500; color: var(--text-secondary);">Type:</span>
          <span class="tag tag-${nodeData.type?.toLowerCase() || 'default'}" style="margin-left: 8px;">${nodeData.type || 'Unknown'}</span>
        </div>
        <div style="margin-bottom: 8px;">
          <span style="font-weight: 500; color: var(--text-secondary);">ID:</span>
          <code style="margin-left: 8px; font-size: 11px;">${escapeHtml(nodeData.id)}</code>
        </div>
      `;

      if (nodeData.properties && Object.keys(nodeData.properties).length > 0) {
        html += `
          <div style="margin-top: 12px;">
            <span style="font-weight: 500; color: var(--text-secondary);">Properties:</span>
            <pre style="margin-top: 4px; font-size: 11px; background: var(--bg-default); padding: 8px; border-radius: 4px; overflow-x: auto;">${escapeHtml(JSON.stringify(nodeData.properties, null, 2))}</pre>
          </div>
        `;
      }

      // Get connected edges
      if (cyInstance) {
        const connectedEdges = cyInstance.edges().filter(e =>
          e.data('source') === nodeData.id || e.data('target') === nodeData.id
        );

        if (connectedEdges.length > 0) {
          html += `
            <div style="margin-top: 12px;">
              <span style="font-weight: 500; color: var(--text-secondary);">Relationships (${connectedEdges.length}):</span>
              <div style="margin-top: 8px; max-height: 150px; overflow-y: auto;">
          `;

          connectedEdges.forEach(edge => {
            const source = cyInstance.$('#' + edge.data('source')).data('label') || edge.data('source');
            const target = cyInstance.$('#' + edge.data('target')).data('label') || edge.data('target');
            const label = edge.data('label') || 'related to';
            const isOutgoing = edge.data('source') === nodeData.id;

            html += `
              <div style="font-size: 12px; padding: 4px 0; border-bottom: 1px solid var(--divider);">
                ${isOutgoing ?
                  `<span style="color: var(--primary);">${escapeHtml(source)}</span> <span style="color: var(--text-tertiary);"></span> <em>${escapeHtml(label)}</em> <span style="color: var(--text-tertiary);"></span> ${escapeHtml(target)}` :
                  `${escapeHtml(source)} <span style="color: var(--text-tertiary);"></span> <em>${escapeHtml(label)}</em> <span style="color: var(--text-tertiary);"></span> <span style="color: var(--primary);">${escapeHtml(target)}</span>`
                }
              </div>
            `;
          });

          html += '</div></div>';
        }
      }

      infoEl.innerHTML = html;
      detailsPanel.style.display = 'block';
    }

    function resetGraphZoom() {
      if (cyInstance) {
        cyInstance.zoom(1);
        cyInstance.center();
      }
    }

    function fitGraph() {
      if (cyInstance) {
        cyInstance.fit(50); // 50px padding
      }
    }

    // ============================================
    // End Graph Visualization Functions
    // ============================================

    // ============================================
    // Demo Data & Tutorials Functions
    // ============================================

    // Demo Data - SciFact-style scientific claims and evidence (from BeIR/scifact corpus)
    const DEMO_DATA = [
      { text: "ALDH1 expression is associated with better prognosis in breast cancer patients. ALDH1 is a detoxifying enzyme responsible for the oxidation of intracellular aldehydes and is thought to play a role in stem cell differentiation.", topic: "oncology" },
      { text: "Metformin improves survival in cancer patients with type 2 diabetes. The biguanide metformin is the most widely used drug for treatment of type 2 diabetes. Recent studies suggest metformin has anticancer properties.", topic: "oncology" },
      { text: "Vitamin D deficiency is associated with increased risk of cardiovascular disease. Vitamin D receptors are present in vascular smooth muscle, endothelium, and cardiomyocytes, suggesting direct cardiovascular effects.", topic: "cardiology" },
      { text: "CRISPR-Cas9 can be used to correct genetic mutations in human embryos. The CRISPR-Cas9 system enables precise genome editing by creating double-strand breaks at specific genomic loci.", topic: "genetics" },
      { text: "Sleep deprivation impairs cognitive function and memory consolidation. During sleep, the brain consolidates memories and clears metabolic waste products accumulated during waking hours.", topic: "neuroscience" },
      { text: "The gut microbiome influences mental health through the gut-brain axis. Gut bacteria produce neurotransmitters including serotonin, dopamine, and GABA that can affect mood and behavior.", topic: "microbiology" },
      { text: "Regular exercise reduces the risk of Alzheimer's disease. Physical activity increases blood flow to the brain and promotes neuroplasticity through the release of brain-derived neurotrophic factor.", topic: "neurology" },
      { text: "Antibiotics can disrupt the gut microbiome for months after treatment. Broad-spectrum antibiotics reduce microbial diversity and can lead to overgrowth of pathogenic bacteria.", topic: "microbiology" },
      { text: "mRNA vaccines induce robust immune responses against SARS-CoV-2. The mRNA is translated into spike protein which triggers both antibody and T cell responses.", topic: "immunology" },
      { text: "Intermittent fasting promotes autophagy and cellular repair mechanisms. Periods of fasting activate AMPK and inhibit mTOR, triggering cellular cleanup processes.", topic: "metabolism" },
      { text: "Telomere length is associated with biological aging and disease risk. Telomeres protect chromosome ends from degradation and shorten with each cell division.", topic: "cell-biology" },
      { text: "The Mediterranean diet reduces inflammation and cardiovascular risk. This dietary pattern emphasizes olive oil, fish, nuts, and vegetables while limiting processed foods.", topic: "nutrition" },
      { text: "Chronic stress alters brain structure and increases cortisol levels. Prolonged stress exposure can lead to hippocampal atrophy and prefrontal cortex dysfunction.", topic: "neuroscience" },
      { text: "CAR-T cell therapy shows remarkable efficacy in blood cancers. Chimeric antigen receptor T cells are engineered to recognize and destroy cancer cells expressing specific antigens.", topic: "immunology" },
      { text: "Air pollution exposure increases risk of respiratory and cardiovascular diseases. Particulate matter can cross the alveolar-capillary barrier and trigger systemic inflammation.", topic: "environmental-health" },
      { text: "Epigenetic modifications can be inherited across generations. DNA methylation and histone modifications can alter gene expression without changing the DNA sequence.", topic: "genetics" },
      { text: "The blood-brain barrier limits drug delivery to the central nervous system. Tight junctions between endothelial cells prevent most molecules from entering the brain parenchyma.", topic: "pharmacology" },
      { text: "Inflammation plays a central role in atherosclerosis development. Macrophages accumulate lipids and form foam cells that contribute to plaque formation in arterial walls.", topic: "cardiology" },
      { text: "Stem cells can differentiate into multiple cell types for regenerative medicine. Pluripotent stem cells have the potential to become any cell type in the body.", topic: "cell-biology" },
      { text: "Mitochondrial dysfunction is implicated in neurodegenerative diseases. Mitochondria are essential for cellular energy production and their dysfunction leads to oxidative stress.", topic: "neurology" },
      { text: "The circadian rhythm regulates metabolism and hormone secretion. The suprachiasmatic nucleus acts as the master clock, synchronizing peripheral clocks throughout the body.", topic: "physiology" },
      { text: "Tumor suppressor genes prevent uncontrolled cell growth when functioning normally. Mutations in genes like p53 and BRCA1 increase cancer susceptibility.", topic: "oncology" },
      { text: "Omega-3 fatty acids have anti-inflammatory properties. EPA and DHA are incorporated into cell membranes and serve as precursors for anti-inflammatory mediators.", topic: "nutrition" },
      { text: "Neuroplasticity allows the brain to reorganize and form new connections. This capacity for change underlies learning, memory, and recovery from brain injury.", topic: "neuroscience" },
      { text: "Insulin resistance is a key feature of type 2 diabetes and metabolic syndrome. Cells become less responsive to insulin signaling, leading to impaired glucose uptake.", topic: "endocrinology" }
    ];

    async function loadDemo() {
      if (!apiKey) {
        showSnackbar('API key required');
        openDialog('auth');
        return;
      }

      const btn = document.getElementById('load-demo-btn');
      const progressContainer = document.getElementById('demo-progress');
      const progressBar = document.getElementById('demo-progress-bar');
      const progressText = document.getElementById('demo-progress-text');

      // Check if demo collection already exists
      try {
        const checkRes = await fetch(`${API}/api/collections/demo`, { headers: getHeaders() });
        if (checkRes.ok) {
          const data = await checkRes.json();
          const count = data.data?.count || data.count || 0;
          progressContainer.style.display = 'block';
          progressBar.style.width = '100%';
          progressText.innerHTML = `<span style="color: var(--success);"> Demo already loaded (${count} items). <a href="#" onclick="deleteDemoAndReload(); return false;" style="color: var(--primary);">Reload?</a></span>`;
          return;
        }
      } catch (e) {}

      btn.disabled = true;
      progressContainer.style.display = 'block';
      progressBar.style.width = '0%';

      try {
        // Create collection with Graph tier (full features) + demo tag
        progressText.textContent = 'Creating demo collection (Graph tier)...';
        progressBar.style.width = '10%';

        const createRes = await fetch(`${API}/api/v2/collections`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({
            name: 'demo',
            dimension: 384,
            metric: 'cosine',
            enable_text_index: true,
            tags: ['graph', 'demo', 'en']
          })
        });

        if (!createRes.ok) {
          const err = await createRes.json();
          throw new Error(err.message || err.detail || 'Failed to create collection');
        }

        // Insert demo data
        for (let i = 0; i < DEMO_DATA.length; i++) {
          const doc = DEMO_DATA[i];
          const progress = 10 + Math.round((i / DEMO_DATA.length) * 85);
          progressBar.style.width = `${progress}%`;
          progressText.textContent = `Inserting ${i + 1} of ${DEMO_DATA.length}...`;

          await fetch(`${API}/api/collections/demo/text-upsert`, {
            method: 'POST',
            headers: getHeaders(),
            body: JSON.stringify({
              points: [{
                id: `doc_${i + 1}`,
                text: doc.text,
                payload: { text: doc.text, topic: doc.topic, author: doc.author || null }
              }]
            })
          });
        }

        progressBar.style.width = '100%';
        progressText.innerHTML = `<span style="color: var(--success);"> Demo loaded! ${DEMO_DATA.length} items with Graph tier (all features enabled)</span>`;
        showSnackbar('Demo loaded! Check Collections page.');
        loadCollections();
        btn.disabled = false;

      } catch (e) {
        showSnackbar('Error: ' + e.message);
        progressText.innerHTML = `<span style="color: var(--error);"> ${e.message}</span>`;
        btn.disabled = false;
      }
    }

    async function deleteDemoAndReload() {
      const progressText = document.getElementById('demo-progress-text');
      progressText.textContent = 'Deleting demo...';
      try {
        await fetch(`${API}/api/collections/demo`, { method: 'DELETE', headers: getHeaders() });
        progressText.textContent = 'Reloading...';
        loadCollections();
        setTimeout(() => loadDemo(), 500);
      } catch (e) {
        progressText.innerHTML = `<span style="color: var(--error);">Failed: ${e.message}</span>`;
      }
    }

    function trySearch(query, mode) {
      showPage('search');
      document.getElementById('search-query').value = query;

      // Select demo collection
      const select = document.getElementById('search-collection');
      for (let opt of select.options) {
        if (opt.value === 'demo') {
          select.value = 'demo';
          onCollectionChange();
          break;
        }
      }

      // Map mode and select
      const modeMap = { 'dense': 'dense', 'keyword': 'keyword', 'rerank': 'rerank', 'late': 'late' };
      selectSearchMode(modeMap[mode] || 'dense');
      showSnackbar(`Using ${mode} search`);
      setTimeout(() => executeSearch(), 300);
    }

    // Legacy function aliases for compatibility
    function loadDemoData() { loadDemo(); }
    function loadGraphDemo() { loadDemo(); }

    // ============================================
    // End Demo Data & Tutorials Functions
    // ============================================

    function confirmDeleteCollection(name) {
      showConfirm(
        'Delete Collection',
        `Are you sure you want to delete "${name}"? This will permanently remove all vectors and data in this collection.`,
        () => deleteCollection(name),
        true  // isDestructive
      );
    }

    async function deleteCollection(name) {
      try {
        const res = await fetch(`${API}/api/collections/${name}`, {
          method: 'DELETE',
          headers: getHeaders()
        });

        if (res.status === 401) {
          showSnackbar('Invalid API key');
          return;
        }

        if (!res.ok) {
          // Handle both JSON and plain text error responses
          const contentType = res.headers.get('content-type');
          let errorMsg = 'Failed to delete collection';
          if (contentType && contentType.includes('application/json')) {
            try {
              const data = await res.json();
              errorMsg = data.message || data.detail || errorMsg;
            } catch (e) {
              // JSON parse failed, try text
              errorMsg = await res.text() || errorMsg;
            }
          } else {
            errorMsg = await res.text() || errorMsg;
          }
          showSnackbar(errorMsg);
          return;
        }

        showSnackbar(`Collection "${name}" deleted`);
        loadCollections();
      } catch (e) {
        showSnackbar('Error: ' + e.message);
      }
    }

    async function createCollection() {
      if (!apiKey) {
        showSnackbar('API key required');
        closeDialog('create');
        openDialog('auth');
        return;
      }

      const name = document.getElementById('create-name').value.trim();
      const dimension = parseInt(document.getElementById('create-dimension').value);
      const metric = document.getElementById('create-metric').value;
      const tier = document.querySelector('input[name="tier"]:checked')?.value || 'dense';
      const lang = createLang;

      if (!name) { showSnackbar('Enter collection name'); return; }

      // Use v2 API for tier-based collection creation
      try {
        const res = await fetch(`${API}/api/v2/collections`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({
            name,
            dimension,
            metric,
            tags: [tier, lang === 'multi' ? 'ml' : 'en'],
            enable_text_index: ['hybrid', 'ultimate', 'graph'].includes(tier)
          })
        });

        if (res.status === 401) {
          showSnackbar('Invalid API key');
          return;
        }

        if (!res.ok) {
          const data = await res.json();
          showSnackbar(data.message || data.detail || 'Failed to create collection');
          return;
        }

        showSnackbar(`Collection created with ${tier} tier`);
        closeDialog('create');

        // Process uploaded files if any
        if (pendingFiles.length) {
          await processFilesForCollection(name);
        }

        document.getElementById('create-name').value = '';
        // Reset tier to default
        document.querySelector('input[name="tier"][value="dense"]').checked = true;
        // Reset language toggle to default (EN)
        createLang = 'en';
        const toggle = document.getElementById('create-lang-toggle');
        toggle.classList.remove('multi');
        toggle.querySelectorAll('.lang-toggle-option').forEach(opt => {
          opt.classList.toggle('active', opt.dataset.lang === 'en');
        });
        loadCollections();
      } catch (e) {
        showSnackbar('Error: ' + e.message);
      }
    }

    async function executeRequest() {
      const method = document.getElementById('console-method').value;
      const endpoint = document.getElementById('console-endpoint').value;
      const body = document.getElementById('console-body').value;

      if (method === 'DELETE' && settings.safetyMode) {
        showConfirm(
          'Are you sure you want to execute this DELETE request?',
          `DELETE ${endpoint} - This action may be irreversible.`,
          () => doExecuteRequest(method, endpoint, body)
        );
        return;
      }

      doExecuteRequest(method, endpoint, body);
    }

    async function doExecuteRequest(method, endpoint, body) {
      const status = document.getElementById('response-status');
      const output = document.getElementById('console-output');

      try {
        const opts = { method, headers: getHeaders() };
        if (method !== 'GET' && body.trim()) opts.body = body;

        const res = await fetch(`${API}/api${endpoint}`, opts);
        const data = await res.json();

        status.textContent = res.status;
        status.className = `status-chip ${res.ok ? 'success' : 'error'}`;
        output.textContent = JSON.stringify(data, null, 2);
      } catch (e) {
        status.textContent = 'Error';
        status.className = 'status-chip error';
        output.textContent = e.message;
      }
    }

    async function executeSearch() {
      const collection = document.getElementById('search-collection').value;
      const queryText = document.getElementById('search-query').value.trim();
      const limit = Math.min(parseInt(document.getElementById('search-limit').value) || 10, 20);
      const searchMode = getSelectedSearchMode();

      if (!collection) { showSnackbar('Select a collection'); return; }
      if (!queryText) { showSnackbar('Enter search query'); return; }

      try {
        let endpoint, body;
        const modeLabels = {
          dense: 'Dense',
          keyword: 'Keyword',
          rerank: 'Rerank',
          late: 'Late Interaction'
        };

        switch (searchMode) {
          case 'keyword':
            endpoint = `${API}/api/v1/collections/${collection}/keyword-search`;
            body = JSON.stringify({ query_text: queryText, limit });
            break;
          case 'rerank':
            // Use text-search with reranking enabled
            endpoint = `${API}/api/collections/${collection}/text-search`;
            body = JSON.stringify({ query_text: queryText, limit, rerank: true });
            break;
          case 'late':
            // Late interaction (ColBERT-style) - uses text-search with late interaction
            endpoint = `${API}/api/collections/${collection}/text-search`;
            body = JSON.stringify({ query_text: queryText, limit, late_interaction: true });
            break;
          case 'dense':
          default:
            endpoint = `${API}/api/collections/${collection}/text-search`;
            body = JSON.stringify({ query_text: queryText, limit });
            break;
        }

        const res = await fetch(endpoint, {
          method: 'POST',
          headers: getHeaders(),
          body: body
        });

        const data = await res.json();

        // Handle errors from API
        if (!res.ok) {
          let errorMsg = data.detail || data.message || 'Search failed';
          // Handle object errors
          if (typeof errorMsg === 'object') {
            errorMsg = errorMsg.msg || errorMsg.message || JSON.stringify(errorMsg);
          }
          showSnackbar(`${modeLabels[searchMode]} search error: ${errorMsg}`);
          return;
        }

        const container = document.getElementById('search-results');
        const list = document.getElementById('results-list');
        const count = document.getElementById('results-count');

        container.style.display = 'block';

        // Check if results were server-redacted
        const isRedacted = data.data?._redacted || data._redacted;
        const results = data.data?.results || data.results || [];
        const searchModeUsed = data.data?.search_mode || searchMode;

        if (!results.length) {
          count.textContent = '0 results';
          list.innerHTML = '<div class="empty-state"><h3>No results</h3></div>';
          return;
        }

        // Show mode badge and redacted badge
        const modeColors = { dense: 'tag-dense', keyword: 'tag-sparse', rerank: 'tag-hybrid', late: 'tag-ultimate' };
        const modeBadge = `<span class="tag ${modeColors[searchMode] || 'tag-default'}" style="margin-left: 8px;">${modeLabels[searchMode] || searchMode}</span>`;
        const redactedBadge = isRedacted ? '<span style="background: rgba(255, 167, 38, 0.15); color: var(--warning); padding: 2px 8px; border-radius: 10px; font-size: 11px; margin-left: 8px;">Redacted</span>' : '';
        count.innerHTML = `${results.length} results${modeBadge}${redactedBadge}`;

        list.innerHTML = results.map(r => {
          // Check both metadata (API response) and payload (legacy) for text
          const payload = r.metadata || r.payload || {};
          const text = payload.text || r.text || JSON.stringify(payload);
          const displayText = settings.maskPayload ? maskText(text) : text;
          const displayId = settings.maskIds ? maskId(r.id) : r.id;

          // Handle vector display - show dimension count if available
          let vectorInfo = '';
          if (typeof r.vector === 'string') {
            vectorInfo = r.vector; // Already formatted by server
          } else if (Array.isArray(r.vector)) {
            vectorInfo = `[${r.vector.length}d]`;
          }

          // Show highlight if available (from hybrid/keyword search)
          const highlight = r.highlight ? `<div style="font-size: 11px; color: var(--text-tertiary); margin-top: 4px;">...${r.highlight}...</div>` : '';

          // Show author if available
          const author = payload.author ? `<span style="color: var(--text-secondary);">  ${payload.author}</span>` : '';

          return `
            <div class="result-item">
              <span class="result-score">Score: ${(r.score||0).toFixed(4)}</span>
              <div class="result-text">${displayText}${author}</div>
              ${highlight}
              <div class="result-id">ID: ${displayId} ${vectorInfo}</div>
            </div>
          `;
        }).join('');
      } catch (e) {
        showSnackbar('Error: ' + e.message);
      }
    }

    // Modal backdrop element (created once)
    let modalBackdrop = null;
    let expandedCardId = null;

    function getOrCreateBackdrop() {
      if (!modalBackdrop) {
        modalBackdrop = document.createElement('div');
        modalBackdrop.className = 'card-modal-backdrop';
        modalBackdrop.onclick = () => {
          if (expandedCardId) toggleFullscreen(expandedCardId);
        };
        document.body.appendChild(modalBackdrop);
      }
      return modalBackdrop;
    }

    function toggleFullscreen(cardId) {
      const card = document.getElementById(`${cardId}-card`);
      if (!card) return;

      const backdrop = getOrCreateBackdrop();
      const isEntering = !card.classList.contains('expanded');

      if (isEntering) {
        // Close any other expanded card first
        if (expandedCardId && expandedCardId !== cardId) {
          toggleFullscreen(expandedCardId);
        }

        card.classList.add('expanded');
        backdrop.classList.add('active');
        expandedCardId = cardId;

        const header = card.querySelector('.card-header');
        if (header) {
          // Add close button to header
          const closeBtn = document.createElement('button');
          closeBtn.className = 'btn btn-text expand-close-btn';
          closeBtn.style.cssText = 'padding: 4px 12px; font-size: 12px; margin-left: 8px;';
          closeBtn.innerHTML = `
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 14px; height: 14px; margin-right: 4px; vertical-align: middle;">
              <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
            </svg>CLOSE
          `;
          closeBtn.onclick = (e) => { e.stopPropagation(); toggleFullscreen(cardId); };
          header.querySelector('div').appendChild(closeBtn);
        }

        // Add escape key listener
        const escHandler = (e) => {
          if (e.key === 'Escape') {
            toggleFullscreen(cardId);
          }
        };
        document.addEventListener('keydown', escHandler);
        card._escHandler = escHandler;

      } else {
        card.classList.remove('expanded');
        backdrop.classList.remove('active');
        expandedCardId = null;

        const header = card.querySelector('.card-header');
        if (header) {
          const closeBtn = header.querySelector('.expand-close-btn');
          if (closeBtn) closeBtn.remove();
        }

        // Remove escape listener
        if (card._escHandler) {
          document.removeEventListener('keydown', card._escHandler);
          delete card._escHandler;
        }
      }
    }

    // Init
    init();

    document.getElementById('search-query').addEventListener('keypress', e => {
      if (e.key === 'Enter') executeSearch();
    });
  </script>
</body>
</html>
