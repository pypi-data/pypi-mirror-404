# Kikusan Cron Configuration Example
#
# This file defines playlists to be monitored and synchronized automatically
# according to cron schedules.

playlists:
  # Playlist name - used for state tracking and M3U playlist file
  favorites:
    # YouTube, YouTube Music, or Spotify playlist URL
    url: https://open.spotify.com/playlist/4X7NjgnVWsjOLNmZtUfFUK?si=93678213885d4c05

    # Sync behavior:
    # - false: Keep local files even if removed from playlist
    # - true: Delete local files when removed from playlist
    sync: false

    # Cron schedule expression (standard cron format)
    # Format: minute hour day month weekday
    # Examples:
    #   "5 4 * * *"        - Daily at 04:05
    #   "0 */2 * * *"      - Every 2 hours
    #   "0 0 * * 0"        - Weekly on Sunday at midnight
    #   "*/30 * * * *"     - Every 30 minutes
    schedule: "5 4 * * *"

  # Another playlist example with sync enabled
  mixed:
    url: https://open.spotify.com/playlist/1fA6WesRnRQoQl5Nj4sk7S?si=6acbec5276ed4f13

    # This playlist will delete local files when tracks are removed
    sync: true

    # Run at minute 23 past every 2nd hour from 0 through 20
    schedule: "23 0-20/2 * * *"

  # YouTube Music playlist example
  # workout:
  #   url: https://music.youtube.com/playlist?list=PLrAXtmErZgOeiKm4sgNOknGvNjby9efdf
  #   sync: false
  #   schedule: "0 6 * * *"  # Daily at 06:00

# Plugin-based syncs (NEW!)
# Plugins allow fetching music from sources other than playlists
plugins:
  # Listenbrainz weekly recommendations
  listenbrainz-discoveries:
    type: listenbrainz
    sync: false
    schedule: "0 8 * * 1"  # Every Monday at 8am
    config:
      user: your_listenbrainz_username
      recommendation_type: weekly-exploration  # or 'weekly-jams'

  # RSS feed example (music podcast, blog, etc.)
  # music-podcast:
  #   type: rss
  #   sync: true  # Remove tracks that are no longer in the feed
  #   schedule: "0 */6 * * *"  # Every 6 hours
  #   config:
  #     url: https://example.com/music-feed.rss
  #     artist_field: creator  # Optional: customize field mappings
  #     title_field: title

  # Reddit r/listentothis - discover new music daily
  reddit-listentothis:
    type: reddit
    sync: false
    schedule: "0 9 * * *"  # Daily at 9am
    config:
      subreddit: listentothis
      sort: top
      time_filter: day
      limit: 25
      min_score: 100  # Only highly upvoted tracks

  # Reddit r/Music - weekly top posts
  # reddit-music-weekly:
  #   type: reddit
  #   sync: true  # Remove tracks that fall off the list
  #   schedule: "0 10 * * 1"  # Monday at 10am
  #   config:
  #     subreddit: Music
  #     sort: top
  #     time_filter: week
  #     limit: 50
  #     min_score: 500

  # Reddit r/IndieHeads - hot tracks every 6 hours
  # reddit-indieheads:
  #   type: reddit
  #   sync: false
  #   schedule: "0 */6 * * *"
  #   config:
  #     subreddit: indieheads
  #     sort: hot
  #     limit: 20
  #     min_score: 50

# Hooks - run commands when events occur
# Useful for integrating with external systems like Navidrome
hooks:
  # Import playlist to Navidrome when updated
  # Uses Navidrome's playlist import API (see https://github.com/navidrome/navidrome/pull/2273)
  - event: playlist_updated
    command: |
      curl -X POST \
        -H "Content-Type: audio/x-mpegurl" \
        -H "X-ND-Authorization: Bearer ${NAVIDROME_TOKEN}" \
        --data-binary @"${KIKUSAN_PLAYLIST_PATH}" \
        "${NAVIDROME_URL}/api/playlist"
    timeout: 30  # seconds (default: 60)

  # Log sync results
  - event: sync_completed
    command: |
      echo "[$(date)] Sync completed: ${KIKUSAN_PLAYLIST_NAME} - Downloaded: ${KIKUSAN_DOWNLOADED}, Skipped: ${KIKUSAN_SKIPPED}, Failed: ${KIKUSAN_FAILED}" >> /var/log/kikusan-sync.log
    run_on_error: true  # Run even if sync failed (default: false)

  # Custom script example - backup playlist on update
  # - event: playlist_updated
  #   command: cp "${KIKUSAN_PLAYLIST_PATH}" "/backup/playlists/${KIKUSAN_PLAYLIST_NAME}_$(date +%Y%m%d).m3u"

# Hook events:
#   - playlist_updated: Triggered when an M3U playlist is created/updated
#   - sync_completed: Triggered after every sync operation (success or failure)
#
# Environment variables available to hooks:
#   KIKUSAN_EVENT          - Event type (playlist_updated, sync_completed)
#   KIKUSAN_PLAYLIST_NAME  - Name of the playlist/plugin
#   KIKUSAN_PLAYLIST_PATH  - Absolute path to the M3U file (if exists)
#   KIKUSAN_SYNC_TYPE      - Type: "playlist" or "plugin"
#   KIKUSAN_DOWNLOADED     - Number of tracks downloaded
#   KIKUSAN_SKIPPED        - Number of tracks skipped
#   KIKUSAN_DELETED        - Number of tracks deleted
#   KIKUSAN_FAILED         - Number of tracks that failed
#   KIKUSAN_SUCCESS        - "true" or "false"

# Usage:
#   kikusan cron                          # Run continuously
#   kikusan cron --config cron.yaml       # Specify config file
#   kikusan cron --once                   # Sync all playlists and plugins once and exit
#   kikusan cron --output /custom/path    # Override download directory
#
#   kikusan plugins list                  # List available plugins
#   kikusan plugins run listenbrainz --config '{"user": "myuser"}'
#
# State files are stored in:
#   - Playlists: {download_dir}/.kikusan/state/
#   - Plugins: {download_dir}/.kikusan/plugin_state/
# M3U playlists are stored in: {download_dir}/{name}.m3u
