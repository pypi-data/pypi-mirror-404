(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9650],{6554:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/privacy-requests/[id]",function(){return i(51947)}])},77213:function(e,t,i){"use strict";i.d(t,{Z:function(){return h}});var s=i(24246),n=i(36010),a=i(88038),l=i.n(a),r=i(86677);i(27378);var o=i(25980),c=i(90867),d=i(42478),u=i(77830),m=()=>{let e=(0,r.useRouter)();return(0,s.jsx)(n.TJV,{bg:"gray.50",border:"1px solid",borderColor:"blue.400",borderRadius:"md",justifyContent:"space-between",p:5,mb:5,mt:5,children:(0,s.jsxs)(n.TJV,{children:[(0,s.jsxs)(n.EO$,{direction:{base:"column",sm:"row"},justifyContent:"space-between",children:[(0,s.jsx)(n.Bjg,{fontWeight:"semibold",children:"Configure your storage and messaging provider"}),(0,s.jsx)(n.zxk,{onClick:()=>{e.push(u.AD)},children:"Configure"})]}),(0,s.jsxs)(n.Bjg,{children:["Before Fides can process your privacy requests we need two simple steps to configure your storage and email client."," "]})]})})},h=e=>{let{children:t,title:i,padded:a=!0,mainProps:u}=e,h=(0,o.hz)(),p=(0,r.useRouter)(),x="/privacy-requests"===p.pathname||"/datastore-connection"===p.pathname,g=!(h.flags.messagingConfiguration&&x),{data:j}=(0,d.JE)(void 0,{skip:g}),{data:y}=(0,c.PW)(void 0,{skip:g}),v=h.flags.messagingConfiguration&&(!j||!y)&&x;return(0,s.jsxs)(n.ad9,{"data-testid":i,direction:"column",h:"100vh",children:[(0,s.jsxs)(l(),{children:[(0,s.jsxs)("title",{children:["Fides Admin UI - ",i]}),(0,s.jsx)("meta",{name:"description",content:"Privacy Engineering Platform"}),(0,s.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,s.jsxs)(n.ad9,{as:"main",direction:"column",py:a?6:0,px:a?10:0,h:a?"calc(100% - 48px)":"full",flex:1,minWidth:0,overflow:"auto",...u,children:[v?(0,s.jsx)(m,{}):null,t]})]})}},51947:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return eH}});var s,n,a,l,r=i(24246),o=i(36010),c=i(86677),d=i(59849),u=i(77213),m=i(77830),h=i(58754),p=i(99716),x=i(27378),g=i(60240),j=i(19904);(s=a||(a={})).IN_PROCESSING="in_processing",s.PENDING="pending",s.COMPLETE="complete",s.ERROR="error",s.PAUSED="paused",s.AWAITING_PROCESSING="awaiting_processing",s.RETRYING="retrying",s.SKIPPED="skipped",s.POLLING="polling";let y={in_processing:"In processing",pending:"Pending",complete:"Complete",error:"Error",paused:"Paused",awaiting_processing:"Awaiting input",retrying:"Retrying",skipped:"Skipped",polling:"Awaiting polling"},v={error:o.tAb.ERROR,skipped:o.tAb.WARNING,awaiting_processing:o.tAb.MINOS,in_processing:void 0,pending:void 0,complete:void 0,paused:void 0,retrying:void 0,polling:o.tAb.WARNING};(n=l||(l={})).REQUEST_UPDATE="Request update",n.INTERNAL_COMMENT="Internal comment",n.MANUAL_TASK="Manual task";let _={"Request update":o.tAb.DEFAULT,"Internal comment":o.tAb.MARBLE,"Manual task":o.tAb.NECTAR};var f=i(90005),b=i.n(f),E=i(16394),T=i(38450),k=i.n(T);let w=e=>{let{attachments:t}=e;if(!t.length)return null;if(1===t.length){let e=t[0];return(0,r.jsx)("div",{className:"flex flex-wrap gap-2 text-sm text-gray-600","data-testid":"activity-timeline-attachments",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(o.PJP.PgN,{className:"mr-1 size-4"}),(0,r.jsx)(o.Typography.Text,{ellipsis:{tooltip:!0},className:"!max-w-[200px]",children:e.file_name})]})})}let i=(0,r.jsx)("ul",{className:"list-disc pl-4",children:t.map(e=>(0,r.jsx)("li",{children:e.file_name},e.id))});return(0,r.jsx)("div",{className:"flex flex-wrap gap-2 text-sm text-gray-600","data-testid":"activity-timeline-attachments",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(o.PJP.PgN,{className:"mr-1 size-4"}),(0,r.jsx)(o.ua7,{title:i,children:(0,r.jsxs)(o.Typography.Text,{ellipsis:!0,className:"!max-w-[200px]",children:[t.length," attachments"]})})]})})};var R=e=>{let{item:t}=e,{author:i,title:s,date:n,type:a,onClick:c,isError:d,isAwaitingInput:u,isPolling:m,description:h,attachments:p,showViewLog:x}=t,g=(0,E.p6)(n),j=!!c,y=p&&p.length>0,v=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:k().header,children:[(0,r.jsxs)("span",{className:k().author,"data-testid":"activity-timeline-author",children:[i,":"]}),s&&(0,r.jsxs)(o.Typography.Text,{className:b()(k().title,{[k()["title--error"]]:d,[k()["title--awaiting-input"]]:u,[k()["title--polling"]]:m}),ellipsis:{tooltip:!0},"data-testid":"activity-timeline-title",children:[s,d&&" failed"]}),(0,r.jsx)("div",{className:"hidden xl:block",children:(0,r.jsx)(o.Typography.Text,{className:k().timestamp,"data-testid":"activity-timeline-timestamp",children:g})}),(0,r.jsx)("div",{className:"xl:hidden",children:(0,r.jsx)(o.ua7,{title:g,children:(0,r.jsx)(o.PJP.qpU,{"data-testid":"activity-timeline-timestamp-icon"})})}),(0,r.jsx)(o.Vp9,{className:k().type,color:_[a],"data-testid":"activity-timeline-type",children:a}),x&&(0,r.jsx)("span",{className:k().viewLogs,"data-testid":"activity-timeline-view-logs",children:"View Log"})]}),(h||y)&&(0,r.jsxs)("div",{className:"mt-2 flex justify-between pl-2.5 align-top",children:[(0,r.jsx)(o.Typography.Paragraph,{className:"!mb-0 whitespace-pre-wrap","data-testid":"activity-timeline-description",children:h||""}),y&&(0,r.jsx)(w,{attachments:p})]})]}),f={className:b()(k().itemButton,{[k()["itemButton--error"]]:d,[k()["itemButton--awaiting-input"]]:u,[k()["itemButton--polling"]]:m,[k()["itemButton--clickable"]]:j,[k()["itemButton--comment"]]:a===l.INTERNAL_COMMENT,[k()["itemButton--manual-task"]]:a===l.MANUAL_TASK}),"data-testid":"activity-timeline-item"};return j?(0,r.jsx)("button",{type:"button",onClick:c,...f,children:v}):(0,r.jsx)("div",{...f,children:v})},C=i(25980),A=i(54427),N=i(78780);let{useGetCommentsQuery:S,useCreateCommentMutation:q,useGetCommentDetailsQuery:P,useLazyGetCommentDetailsQuery:I}=N.u.injectEndpoints({endpoints:e=>({getComments:e.query({query:e=>{let{privacy_request_id:t,page:i=1,size:s}=e;return{url:"plus/privacy-request/".concat(t,"/comment"),method:"GET",params:{page:i,size:s}}},providesTags:["Privacy Request Comments"]}),createComment:e.mutation({query:e=>{let{privacy_request_id:t,comment_text:i,comment_type:s}=e,n=new FormData;return n.append("comment_text",i),n.append("comment_type",s),{url:"plus/privacy-request/".concat(t,"/comment"),method:"POST",body:n,formData:!0}},invalidatesTags:["Privacy Request Comments","Request"]}),getCommentDetails:e.query({query:e=>{let{privacy_request_id:t,comment_id:i}=e;return{url:"plus/privacy-request/".concat(t,"/comment/").concat(i),method:"GET"}}})})}),{reducer:D}=(0,A.oM)({name:"privacyRequestComments",initialState:{},reducers:{}}),O=e=>{let{plus:t}=(0,C.hz)(),i=(0,o.UD8)(),{data:s,isLoading:n,error:a}=S({privacy_request_id:e,size:100},{skip:!t});return(0,x.useEffect)(()=>{a&&i.error("Failed to fetch the request comments")},[a,i]),{commentItems:(null==s?void 0:s.items)?s.items.map(e=>({author:e.user_first_name&&e.user_last_name?"".concat(e.user_first_name," ").concat(e.user_last_name):e.username||"Unknown",date:new Date(e.created_at),type:l.INTERNAL_COMMENT,showViewLog:!1,description:e.comment_text,isError:!1,isSkipped:!1,isAwaitingInput:!1,isPolling:!1,id:"comment-".concat(e.id)})):[],isLoading:n}},L=(e,t)=>{if(0===e.length)return!1;let i=Array.from(e).sort((e,t)=>new Date(t.updated_at).getTime()-new Date(e.updated_at).getTime());if(!i[0].collection_name)return i[0].status===t;let s={};return i.forEach(e=>{e.collection_name&&!s[e.collection_name]&&(s[e.collection_name]=e)}),Object.values(s).some(e=>e.status===t)},z=e=>L(e,a.ERROR),M=e=>L(e,a.SKIPPED),U=e=>L(e,a.AWAITING_PROCESSING),B=e=>L(e,a.POLLING),W=e=>{let t=!e;return{eventItems:e?Object.entries(e).map(e=>{let[t,i]=e,s=z(i),n=M(i),a=U(i),r=B(i);return{author:"Fides",title:t,date:new Date(i[0].updated_at),type:l.REQUEST_UPDATE,showViewLog:s||n||a||r,onClick:()=>{},isError:s,isSkipped:n,isAwaitingInput:a,isPolling:r,id:"request-".concat(t)}}):[],isLoading:t}};var J=i(91317),V=i(45116);let F=e=>{let{plus:t}=(0,C.hz)(),i=(0,o.UD8)(),{data:s,isLoading:n,error:a}=(0,V.Ym)({page:1,size:100,privacy_request_id:e,status:void 0,include_full_submission_details:!0},{skip:!t});return(0,x.useEffect)(()=>{a&&i.error("Failed to fetch manual tasks")},[a,i]),{manualTaskItems:s?s.items.filter(e=>e.status===g.OS.COMPLETED||e.status===g.OS.SKIPPED).map(e=>{var t,i;let s=e.submission_user?(0,E.gJ)(e.submission_user):"Unknown User";(0,J.PN)(null===(t=e.submission_user)||void 0===t?void 0:t.id)&&(s=(null===(i=e.submission_user)||void 0===i?void 0:i.id)||"Unknown User");let n=e.status===g.OS.SKIPPED,a="Task ".concat(n?"skipped":"completed"," - ").concat(e.name),r=e.comments&&e.comments.length>0?e.comments[e.comments.length-1].comment_text:void 0,o=e.attachments||[];return{author:s,title:a,date:new Date(e.updated_at),type:l.MANUAL_TASK,showViewLog:!1,description:r,isError:!1,isSkipped:n,isAwaitingInput:!1,isPolling:!1,id:"manual-task-".concat(e.manual_field_id),attachments:o}}):[],taskCommentIds:(0,x.useMemo)(()=>{let e=new Set;return(null==s?void 0:s.items)&&s.items.filter(e=>e.status===g.OS.COMPLETED||e.status===g.OS.SKIPPED).forEach(t=>{var i;null===(i=t.comments)||void 0===i||i.forEach(t=>{e.add(t.id)})}),e},[s]),isLoading:n}};var G=i(88340),K=e=>{let{errorMessage:t,status:i=a.ERROR}=e;return(0,r.jsxs)(o.TJV,{height:"100%",id:"outer",children:[(0,r.jsxs)(o.ad9,{alignItems:"center",children:[(0,r.jsx)(o.Bjg,{size:"sm",color:"gray.700",fontWeight:"medium",marginRight:"8px",lineHeight:"20px",children:"Status"}),(0,r.jsx)(o.Vp9,{color:v[i],children:y[i]}),(0,r.jsx)(o.TJV,{padding:"0px",marginBottom:"3px",children:(0,r.jsx)(G.Z,{copyText:t})})]}),(0,r.jsx)(o.KMv,{marginTop:"4px",marginBottom:"6px"}),(0,r.jsx)(o.TJV,{id:"errorWrapper",overflow:"auto",height:"100%",children:(0,r.jsx)(o.Bjg,{children:t})})]})},H=i(3124),Z=i.n(H);let $=e=>{switch(e){case g.Us.ACCESS:return"Data Retrieval";case g.Us.ERASURE:return"Data Deletion";case g.Us.CONSENT:return"Consent";case g.Us.UPDATE:return"Data Update";default:return e}},Y=e=>{if(e.status!==a.COMPLETE||!e.collection_name)return"-";let t=(e.message||"").match(/(?:retrieved|masked|processed)\s+(\d+)\s+records?$/i);return t?parseInt(t[1],10).toLocaleString():"-"},Q=(e,t)=>{let i=e.filter(e=>e.action_type===t&&e.status===a.COMPLETE&&e.collection_name).sort((e,t)=>new Date(t.updated_at).getTime()-new Date(e.updated_at).getTime()),s={};i.forEach(e=>{let t=e.collection_name||"unknown";s[t]||(s[t]=e)});let n=0,l=!1,r=/(?:retrieved|masked|processed)\s+(\d+)\s+records?$/i;return Object.values(s).forEach(e=>{if(e.message){let t=e.message.match(r);if(t){l=!0;let e=parseInt(t[1],10);n+=e}}}),l?n:null},X=(e,t,i)=>{if("finished"===e.status&&!e.collection_name&&i){let e=Q(t,i);return null!==e?e.toLocaleString():"-"}return Y(e)};var ee=e=>{var t,i,s;let{eventLogs:n,allEventLogs:l,onDetailPanel:c,privacyRequest:d}=e,u=(null==n?void 0:n.some(e=>e.collection_name))||(null==n?void 0:n.some(e=>"finished"===e.status&&!e.collection_name))||!1,m=null==n?void 0:n.every(e=>"finished"===e.status&&!e.collection_name),h=null==d?void 0:null===(s=d.policy)||void 0===s?void 0:null===(i=s.rules)||void 0===i?void 0:null===(t=i[0])||void 0===t?void 0:t.action_type,p=e=>e?$(e):h?$(h):"-",x=null==n?void 0:n.map(e=>(0,r.jsxs)(o.nNC,{backgroundColor:e.status===a.ERROR||e.status===a.SKIPPED&&e.message||e.status===a.AWAITING_PROCESSING||e.status===a.POLLING?Z().FIDESUI_NEUTRAL_50:"unset",onClick:()=>{(e.status===a.ERROR||e.status===a.SKIPPED&&e.message||e.status===a.AWAITING_PROCESSING||e.status===a.POLLING)&&c(e.message,e.status)},style:{cursor:e.message?"pointer":"unset"},_hover:{backgroundColor:Z().FIDESUI_NEUTRAL_50},children:[(0,r.jsx)(o.Lpm,{children:(0,r.jsx)(o.Bjg,{color:"gray.600",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:(0,E.p6)(e.updated_at)})}),(0,r.jsx)(o.Lpm,{children:(0,r.jsx)(o.Bjg,{color:"gray.600",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:p(e.action_type)})}),(0,r.jsx)(o.Lpm,{children:y[e.status]?(0,r.jsx)(o.Vp9,{color:v[e.status],children:y[e.status]}):(0,r.jsx)(o.Bjg,{color:"gray.600",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:e.status})}),u&&(0,r.jsx)(o.Lpm,{children:(0,r.jsx)(o.Bjg,{color:"gray.600",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:X(e,l||n,h)})}),u&&!m&&(0,r.jsx)(o.Lpm,{children:(0,r.jsx)(o.Bjg,{color:"gray.600",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:"finished"===e.status?"Request completed":e.collection_name})})]},e.updated_at));return(0,r.jsx)(o.TJV,{width:"100%",paddingTop:"0px",height:"100%",children:(0,r.jsx)(o.opv,{id:"tableContainer",height:"100%",style:{overflowY:"auto"},children:(0,r.jsxs)(o.v1O,{size:"sm",id:"table",position:"relative",children:[(0,r.jsx)(o.qpM,{id:"tableHeader",position:"sticky",top:"0px",backgroundColor:"white",zIndex:10,children:(0,r.jsxs)(o.nNC,{children:[(0,r.jsx)(o.e_E,{children:(0,r.jsx)(o.Bjg,{color:"black",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:"Time"})}),(0,r.jsx)(o.e_E,{children:(0,r.jsx)(o.Bjg,{color:"black",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:"Action Type"})}),(0,r.jsx)(o.e_E,{children:(0,r.jsx)(o.Bjg,{color:"black",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:"Status"})}),u&&(0,r.jsx)(o.e_E,{children:(0,r.jsx)(o.Bjg,{color:"black",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:"Records"})}),u&&!m&&(0,r.jsx)(o.e_E,{children:(0,r.jsx)(o.Bjg,{color:"black",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:"Collection"})})]})}),(0,r.jsx)(o.OEo,{id:"tableBody",children:x})]})})})},et=e=>{let{isOpen:t,onClose:i,currentLogs:s,allEventLogs:n,isViewingError:l,errorMessage:c,currentStatus:d=a.ERROR,onCloseErrorPanel:u,onOpenErrorPanel:m,privacyRequest:h}=e;return(0,r.jsxs)(o.JTh,{isOpen:t,placement:"right",onClose:i,size:"full",autoFocus:!1,"data-testid":"log-drawer",children:[(0,r.jsx)(o.yY5,{}),(0,r.jsxs)(o.mJD,{style:{width:"50%"},"data-testid":"log-drawer",children:[(0,r.jsx)(o.v7L,{style:{paddingBottom:"0px"},children:(0,r.jsxs)(o.ad9,{justifyContent:"space-between",alignItems:"center",height:"40px",children:[(0,r.jsxs)(o.ad9,{alignItems:"center",children:[l&&(0,r.jsx)(o.zxk,{icon:(0,r.jsx)(o.Ta$,{}),"aria-label":"Close error logs",size:"small",onClick:u}),(0,r.jsx)(o.Bjg,{color:"gray.900",fontSize:"md",lineHeight:"6",fontWeight:"medium",ml:1,children:l?"Event detail":"Event log"})]}),(0,r.jsx)(o.zxk,{icon:(0,r.jsx)(o.LGN,{width:"17px"}),"aria-label":"Stop viewing error message",size:"small",onClick:i,"data-testid":"log-drawer-close"})]})}),(0,r.jsxs)(o.Q4$,{id:"drawerBody",overflow:"hidden",children:[s&&!l?(0,r.jsx)(ee,{eventLogs:s,allEventLogs:n,onDetailPanel:m,privacyRequest:h}):null,l?(0,r.jsx)(K,{errorMessage:c,status:d}):null]})]})]})},ei=e=>{let{subjectRequest:t}=e,{isOpen:i,onOpen:s,onClose:n}=(0,o.E2M)(),[c,d]=(0,x.useState)([]),[u,m]=(0,x.useState)(""),[h,p]=(0,x.useState)(!1),[g,j]=(0,x.useState)(""),[y,v]=(0,x.useState)(a.ERROR),{results:_,id:f}=t,{commentItems:b,isLoading:E}=O(f),{eventItems:T,isLoading:w}=W(_),{manualTaskItems:C,taskCommentIds:A,isLoading:N}=F(f);(0,x.useEffect)(()=>{u&&_&&_[u]&&d(_[u])},[_,u]);let S=()=>{p(!1)},q=(0,x.useCallback)((e,t)=>{m(e),d(t),s()},[s]),P=(0,x.useMemo)(()=>_?Object.values(_).flat():[],[_]),I=(0,x.useMemo)(()=>b.filter(e=>{let t=e.id.replace("comment-","");return!A.has(t)}),[b,A]),D=(0,x.useMemo)(()=>{let e=T.map(e=>{if("Request update"===e.type&&e.title&&_){let t=e.title;if(_[t])return{...e,onClick:()=>q(t,_[t])}}return e});return[{author:"Fides",title:"Access request received",date:new Date(t.created_at),type:l.REQUEST_UPDATE,showViewLog:!1,isError:!1,isSkipped:!1,isAwaitingInput:!1,isPolling:!1,id:"initial-request"},...e,...I,...C].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime())},[T,I,C,_,q,t.created_at]);return(0,r.jsxs)(o.TJV,{width:"100%",children:[(0,r.jsx)(o.aVo,{className:"!border-none",bordered:!1,split:!1,"data-testid":"activity-timeline-list",children:(0,r.jsx)("ul",{className:"!list-none",children:E||w||N?(0,r.jsx)("div",{className:k().itemButton,"data-testid":"timeline-skeleton",children:(0,r.jsx)(o.OdW,{paragraph:{rows:2},active:!0})}):D.map(e=>(0,r.jsx)("li",{children:(0,r.jsx)(R,{item:e})},e.id))})}),(0,r.jsx)(et,{isOpen:i,onClose:()=>{h&&S(),m(""),n()},currentLogs:c,allEventLogs:P,isViewingError:h,errorMessage:g,currentStatus:y,onOpenErrorPanel:(e,t)=>{j(e),t&&v(t),p(!0)},onCloseErrorPanel:S,privacyRequest:t})]})},es=i(66187);let en=e=>{let{privacyRequestId:t,onCancel:i}=e,[s,n]=(0,x.useState)(""),a=(0,x.useRef)(null),[l,{isLoading:c}]=q(),d=(0,o.UD8)();(0,x.useEffect)(()=>{a.current&&a.current.focus()},[]);let u=async()=>{if(s.trim())try{await l({privacy_request_id:t,comment_text:s,comment_type:es.i.NOTE}).unwrap(),n(""),i()}catch(e){console.error("Failed to add comment:",e),d.error({content:"Failed to add comment",duration:5})}},m=[{key:"internal",label:"Internal comment",children:(0,r.jsx)(o.IIB.TextArea,{ref:a,value:s,onChange:e=>n(e.target.value),rows:3,className:"mb-3 h-[150px] w-full !resize-none","data-testid":"comment-input"})}];return(0,r.jsxs)("div",{children:[(0,r.jsx)(o.mQc,{items:m}),(0,r.jsxs)(o.kCb,{justify:"flex-end",className:"gap-2",children:[(0,r.jsx)(o.zxk,{onClick:i,"data-testid":"cancel-comment-button",children:"Cancel"}),(0,r.jsx)(o.zxk,{onClick:u,loading:c,disabled:!s.trim(),type:"primary",htmlType:"button","data-testid":"submit-comment-button",children:"Save"})]})]})};var ea=e=>{let{subjectRequest:t}=e,[i,s]=(0,x.useState)(!1);return(0,r.jsxs)("div",{className:"w-full",children:[(0,r.jsx)(ei,{subjectRequest:t}),i?(0,r.jsx)(en,{privacyRequestId:t.id,onCancel:()=>s(!1)}):(0,r.jsx)(j.ZP,{scopes:[g.Sh.COMMENT_CREATE],children:(0,r.jsx)(o.kCb,{justify:"flex-start",className:"mt-2",children:(0,r.jsxs)(o.zxk,{type:"default",onClick:()=>s(!0),className:"flex items-center","data-testid":"add-comment-button",children:["Add comment ",(0,r.jsx)("span",{className:"ml-1",children:"+"})]})})})]})},el=i(14207),er=i(46238),eo=i(72281),ec=i(17245),ed=i(90867),eu=i(16134);let em=e=>Array.from(new Set(e.filter(e=>Object.values(g.Us).includes(e.action_type)).map(e=>e.action_type)));var eh=e=>{let{rules:t}=e,i=em(t).map(e=>(0,E.kC)(e)).map(e=>e);return(0,r.jsx)(o.Typography.Text,{children:i.join(" - ")})},ep=i(34090),ex=i(55484),eg=e=>{let{connectorName:t,data:i,isSubmitting:s=!1,onSaveClick:n}=e,{isOpen:a,onOpen:l,onClose:c}=(0,o.E2M)(),d=(0,x.useRef)(null),u=async(e,t)=>{n({connection_key:i.connection_key,privacy_request_id:i.privacy_request_id,body:{...e}}),c()};return(0,r.jsxs)(r.Fragment,{children:[(null==i?void 0:i.checked)&&(0,r.jsx)(o.zxk,{onClick:l,size:"small",children:"Review"}),!(null==i?void 0:i.checked)&&(0,r.jsx)(o.zxk,{onClick:l,size:"small",type:"primary",children:"Begin manual input"}),(0,r.jsx)(ep.J9,{enableReinitialize:!0,initialValues:{...i.fields},onSubmit:u,validateOnBlur:!1,validateOnChange:!1,validationSchema:ex.Ry().shape({}),children:e=>(0,r.jsxs)(o.JTh,{isOpen:a,placement:"right",initialFocusRef:d,onClose:c,size:"lg",children:[(0,r.jsx)(o.yY5,{}),(0,r.jsxs)(o.mJD,{children:[(0,r.jsx)(o.NNE,{}),(0,r.jsxs)(o.v7L,{color:"gray.900",children:[(0,r.jsx)(o.Bjg,{fontSize:"xl",mb:8,children:t}),(0,r.jsx)(o.KMv,{}),(0,r.jsx)(o.Bjg,{fontSize:"md",mt:"4",children:"Manual access"}),(0,r.jsx)(o.TJV,{mt:"8px",children:(0,r.jsx)(o.Bjg,{color:"gray.700",fontSize:"sm",fontWeight:"normal",children:"Please complete the following PII fields that have been collected for the selected subject."})})]}),(0,r.jsx)(o.Q4$,{children:(0,r.jsx)(ep.l0,{id:"manual-detail-form",noValidate:!0,children:(0,r.jsx)(o.s_g,{align:"stretch",gap:"16px",children:Object.entries(i.fields).map((e,t)=>{let[i]=e;return(0,r.jsx)(o.Br$,{children:(0,r.jsx)(ep.gN,{id:i,name:i,children:e=>{let{field:s}=e;return(0,r.jsxs)(o.DTt,{alignItems:"baseline",display:"inline-flex",children:[(0,r.jsx)(o.tLq,{color:"gray.900",fontSize:"14px",fontWeight:"semibold",htmlFor:i,w:"50%",children:i}),(0,r.jsx)(o.RVe,{...s,autoComplete:"off",color:"gray.700",placeholder:"Please enter ".concat(i),ref:0===t?d:void 0,size:"sm"})]})}})},i)})})})}),(0,r.jsx)(o.KR9,{justifyContent:"flex-start",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(o.zxk,{onClick:c,children:"Cancel"}),(0,r.jsx)(o.zxk,{form:"manual-detail-form",loading:s,htmlType:"submit",children:"Save"})]})})]})]})})]})},ej=e=>{let{connectorName:t,data:i,isSubmitting:s=!1,onSaveClick:n}=e,{isOpen:a,onOpen:l,onClose:c}=(0,o.E2M)(),d=(0,x.useRef)(null),u=async(e,t)=>{n({connection_key:i.connection_key,privacy_request_id:i.privacy_request_id,body:{...e}}),c()};return(0,r.jsxs)(r.Fragment,{children:[(null==i?void 0:i.checked)&&(0,r.jsx)(o.zxk,{onClick:l,size:"small",children:"Review"}),!(null==i?void 0:i.checked)&&(0,r.jsx)(o.zxk,{onClick:l,size:"small",type:"primary",children:"Begin manual input"}),(0,r.jsx)(ep.J9,{enableReinitialize:!0,initialValues:{...i.fields},onSubmit:u,validateOnBlur:!1,validateOnChange:!1,validationSchema:ex.Ry().shape({}),children:e=>(0,r.jsxs)(o.JTh,{isOpen:a,placement:"right",initialFocusRef:d,onClose:c,size:"lg",children:[(0,r.jsx)(o.yY5,{}),(0,r.jsxs)(o.mJD,{children:[(0,r.jsx)(o.NNE,{}),(0,r.jsxs)(o.v7L,{color:"gray.900",children:[(0,r.jsx)(o.Bjg,{fontSize:"xl",mb:8,children:t}),(0,r.jsx)(o.KMv,{}),(0,r.jsx)(o.Bjg,{fontSize:"md",mt:"4",children:"Manual erasure"}),(0,r.jsx)(o.TJV,{mt:"8px",children:(0,r.jsx)(o.Bjg,{color:"gray.700",fontSize:"sm",fontWeight:"normal",children:"Please delete the following PII fields associated with the selected subject if they are available. Once deleted, check the box to confirm the deletion."})})]}),(0,r.jsx)(o.Q4$,{children:(0,r.jsx)(ep.l0,{id:"manual-detail-form",noValidate:!0,children:(0,r.jsx)(o.s_g,{align:"stretch",gap:"16px",children:Object.entries(i.fields).map(e=>{let[t]=e;return(0,r.jsx)(o.Br$,{children:(0,r.jsx)(ep.gN,{id:t,name:t,children:e=>{let{field:i}=e;return(0,r.jsxs)(o.DTt,{alignItems:"baseline",display:"inline-flex",children:[(0,r.jsx)(o.tLq,{color:"gray.900",fontSize:"14px",fontWeight:"semibold",htmlFor:t,w:"50%",children:t}),(0,r.jsx)(o.gxE,{...i,isChecked:!!i.value,onChange:i.onChange,name:t,id:t})]})}})},t)})})})}),(0,r.jsx)(o.KR9,{justifyContent:"flex-start",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(o.zxk,{onClick:c,children:"Cancel"}),(0,r.jsx)(o.zxk,{form:"manual-detail-form",loading:s,htmlType:"submit",children:"Save"})]})})]})]})})]})};let ey=(e,t,i)=>e.includes(g.Us.ACCESS)?{ProcessingDetailComponent:eg,uploadMutation:t,getUploadedWebhookDataEndpoint:ed.$I.endpoints.getUploadedManualAccessWebhookData}:e.includes(g.Us.ERASURE)?{ProcessingDetailComponent:ej,uploadMutation:i,getUploadedWebhookDataEndpoint:ed.$I.endpoints.getUploadedManualErasureWebhookData}:null;var ev=e=>{let{subjectRequest:t,onComplete:i}=e,s=(0,eu.T)(),{errorAlert:n,successAlert:a}=(0,ec.VY)(),{handleError:l}=(0,ec.HK)(),[c,d]=(0,x.useState)([]),[u,m]=(0,x.useState)(!1),[h,p]=(0,x.useState)(!1),{data:j,isFetching:y,isLoading:v,isSuccess:_}=(0,el.W6)(),[f]=(0,ed.w3)(),b=em(t.policy.rules),[E]=(0,ed.nL)(),[T]=(0,ed.UR)(),{ProcessingDetailComponent:k,uploadMutation:w,getUploadedWebhookDataEndpoint:R}=ey(b,E,T),C=async()=>{try{m(!0),await f(t.id).unwrap(),a("Manual request has been received. Request now processing."),i()}catch(e){l(e)}finally{m(!1)}},A=async e=>{try{p(!0),await w(e).unwrap();let t={connection_key:e.connection_key,fields:{}};Object.entries(e.body).forEach(e=>{let[i,s]=e;t.fields[i]=s||""});let i=c.map(e=>e.connection_key===t.connection_key?{...e,checked:!0,fields:{...t.fields}}:e);d(i),a("Manual input successfully saved!")}catch(e){l(e)}finally{p(!1)}};return((0,x.useEffect)(()=>(_&&j.length>0&&0===c.length&&(()=>{if(c.length>0)return;let e=[],i=null==j?void 0:j.map(e=>e.connection_config.key);null==i||i.every(i=>e.push(s(R.initiate({connection_key:i,privacy_request_id:t.id})))),Promise.allSettled(e).then(e=>{let t=[];e.forEach((e,i)=>{if("fulfilled"===e.status&&e.value.isSuccess&&e.value.data){let i={checked:e.value.data.checked,fields:{},connection_key:e.value.originalArgs.connection_key,privacy_request_id:e.value.originalArgs.privacy_request_id};Object.entries(e.value.data.fields).forEach(e=>{let[t,s]=e;i.fields[t]=s||""}),t.push(i)}else n("An error occurred while loading manual input data for ".concat(j[i].connection_config.name))}),d(t)})})(),()=>{}),[j,c.length,s,n,_,t.id,R]),b.includes(g.Us.ACCESS)||b.includes(g.Us.ERASURE))?(0,r.jsxs)(o.s_g,{align:"stretch",spacing:8,children:[(0,r.jsx)(o.TJV,{children:(0,r.jsx)(o.Bjg,{color:"gray.700",fontSize:"sm",children:"The following table details the integrations that require manual input from you."})}),(0,r.jsxs)(o.TJV,{children:[(y||v)&&(0,r.jsx)(o.w4_,{children:(0,r.jsx)(o.Y6B,{})}),_&&j?(0,r.jsx)(o.opv,{children:(0,r.jsxs)(o.v1O,{size:"sm",variant:"unstyled",children:[(0,r.jsx)(o.qpM,{children:(0,r.jsxs)(o.nNC,{children:[(0,r.jsx)(o.e_E,{fontSize:"sm",fontWeight:"semibold",pl:"0",textTransform:"none",children:"Integration Identifier"}),(0,r.jsx)(o.e_E,{})]})}),(0,r.jsxs)(o.OEo,{children:[j.length>0&&j.map(e=>(0,r.jsxs)(o.nNC,{display:"block",children:[(0,r.jsx)(o.Lpm,{pl:"0",children:e.connection_config.key}),(0,r.jsx)(o.Lpm,{children:c.length>0?(0,r.jsx)(k,{connectorName:e.connection_config.name,data:c.find(t=>t.connection_key===e.connection_config.key),isSubmitting:h,onSaveClick:A}):null})]},e.id)),0===j.length&&(0,r.jsx)(o.nNC,{children:(0,r.jsx)(o.Lpm,{colSpan:3,pl:"0",children:(0,r.jsx)(o.w4_,{children:(0,r.jsx)(o.Bjg,{children:"You don‘t have any Manual Process connections set up yet."})})})})]}),c.length>0&&c.every(e=>e.checked)?(0,r.jsx)(o.w_p,{children:(0,r.jsx)(o.nNC,{children:(0,r.jsx)(o.e_E,{pl:"0px",children:(0,r.jsx)(o.zxk,{type:"primary",loading:u,onClick:C,className:"mt-2",children:"Complete DSR"})})})}):null]})}):null]})]}):null},e_=e=>{let{subjectRequest:t,onComplete:i}=e,s=(0,c.useRouter)(),{data:n}=(0,el.AZ)({}),a=(0,x.useMemo)(()=>{var e;return(null==n?void 0:null===(e=n.items)||void 0===e?void 0:e.filter(e=>e.connection_type===g.Rj.MANUAL_TASK))||[]},[n]),{data:l}=(0,el.W6)(),d=(l||[]).length>0,{data:u}=(0,V.Ym)({page:1,size:100,privacy_request_id:t.id}),h=(null==u?void 0:u.items)||[],p=h.length,j=h.filter(e=>e.status===g.OS.NEW).length,y=a.length>0,v=h.length>0,_=y||v;return _||d?(0,r.jsxs)(o.EO$,{spacing:6,children:[_&&(0,r.jsxs)(o.TJV,{children:[(0,r.jsx)(o.Typography.Title,{level:4,style:{marginBottom:12},children:"Manual tasks"}),(0,r.jsxs)(o.EO$,{spacing:2,children:[(0,r.jsxs)(o.Typography.Text,{children:[(0,r.jsx)("strong",{children:p})," ",(0,E._6)(p,"task","tasks")," linked to this privacy"," ","request"]}),(0,r.jsxs)(o.Typography.Text,{children:[(0,r.jsx)("strong",{children:j})," pending"," ",(0,E._6)(j,"task","tasks")]}),p>0&&(0,r.jsx)("div",{className:"mt-2",children:(0,r.jsx)(o.zxk,{type:"primary",onClick:()=>{s.push({pathname:m.Jw,query:{privacy_request_id:t.id,tab:eo.G.MANUAL_TASK}})},children:"View all tasks for this request →"})})]})]}),d&&(0,r.jsxs)(o.TJV,{children:[(0,r.jsxs)(o.ad9,{alignItems:"center",style:{marginBottom:12},children:[(0,r.jsx)(o.Typography.Title,{level:4,style:{margin:0,marginRight:8},children:"Manual steps (legacy)"}),(0,r.jsx)(er.b,{label:"This is the legacy manual steps feature. The new manual tasks feature provides more advanced capabilities and better user experience."})]}),(0,r.jsx)(ev,{subjectRequest:t,onComplete:i||(()=>{})})]})]}):(0,r.jsx)(o.TJV,{p:4,children:(0,r.jsx)(o.Typography.Text,{type:"secondary",children:"No manual tasks or legacy manual steps configured for this request."})})},ef=i(59969),eb=i(45259),eE=i(18225),eT=i(812),ek=i(7842);let{useGetAttachmentsQuery:ew,useUploadAttachmentMutation:eR,useGetAttachmentDetailsQuery:eC,useLazyGetAttachmentDetailsQuery:eA}=N.u.injectEndpoints({endpoints:e=>({getAttachments:e.query({query:e=>{let{privacy_request_id:t,page:i=1,size:s}=e;return{url:"plus/privacy-request/".concat(t,"/attachment"),method:"GET",params:{page:i,size:s}}},providesTags:["Privacy Request Attachments"]}),uploadAttachment:e.mutation({query:e=>{let{privacy_request_id:t,attachment_type:i,attachment_file:s}=e,n=new FormData;return n.append("attachment_type",i),n.append("attachment_file",s),{url:"plus/privacy-request/".concat(t,"/attachment"),method:"POST",body:n,params:{}}},invalidatesTags:["Privacy Request Attachments"]}),getAttachmentDetails:e.query({query:e=>{let{privacy_request_id:t,attachment_id:i}=e;return{url:"plus/privacy-request/".concat(t,"/attachment/").concat(i),method:"GET"}}})})}),{reducer:eN}=(0,A.oM)({name:"privacyRequestAttachments",initialState:{},reducers:{}}),eS=e=>{var t;let{file:i}=e,[s,n]=(0,x.useState)(!1),[a]=eA(),l=(0,o.UD8)(),c=async()=>{var e,t,s;if((null===(e=i.customData)||void 0===e?void 0:e.attachment_id)&&(null===(t=i.customData)||void 0===t?void 0:t.privacy_request_id)){n(!0);try{let e=await a({privacy_request_id:i.customData.privacy_request_id,attachment_id:i.customData.attachment_id}),t=null===(s=e.data)||void 0===s?void 0:s.retrieved_attachment_url,n=null==t?void 0:t.startsWith("http");t&&n?window.open(t,"_blank"):t&&!n?l.info("Download is not available when using local storage methods."):l.error("No download URL available for ".concat(i.name))}catch(e){l.error("Failed to fetch attachment download URL")}finally{n(!1)}}},d=(null===(t=i.customData)||void 0===t?void 0:t.attachment_type)===g.sf.INCLUDE_WITH_ACCESS_PACKAGE;return(0,r.jsxs)(o.kCb,{align:"center",gap:8,children:[(0,r.jsx)(o.PJP.PgN,{className:"shrink-0"}),(0,r.jsx)(o.xvT,{ellipsis:{tooltip:i.name},className:"grow",children:i.name}),d&&(0,r.jsx)(o.ua7,{title:"This attachment will be included in the access package.",children:(0,r.jsx)(o.PJP.wvC,{className:"shrink-0",title:"User icon"})}),(0,r.jsx)(o.zxk,{type:"text","aria-label":"Download attachment",icon:(0,r.jsx)(o.PJP.UWx,{}),onClick:c,loading:s,className:"shrink-0"})]})},eq=(e,t)=>(0,r.jsx)(eS,{file:t});var eP=e=>{let{subjectRequest:t}=e,[i,s]=(0,x.useState)(!1),n=(0,j.Tg)([g.Sh.ATTACHMENT_READ]),a=(0,j.Tg)([g.Sh.ATTACHMENT_CREATE]),l=(0,o.UD8)(),[c]=eR(),{data:d,isLoading:u,error:m}=(0,ed.PW)(),{data:h,isLoading:p}=ew({privacy_request_id:t.id}),{refetch:y}=ew({privacy_request_id:t.id}),v=(null==h?void 0:h.items.map(e=>({uid:e.id,name:e.file_name,status:"done",customData:{attachment_id:e.id,privacy_request_id:t.id,attachment_type:e.attachment_type}})))||[],_=(0,x.useCallback)(()=>(0,r.jsx)(o.PJP.PgN,{}),[]);if(!n)return null;let f=a&&(null==d?void 0:d.key),b=[".pdf",".doc",".docx",".xls",".xlsx",".txt",".csv",".jpg",".jpeg",".png",".zip"];return(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)(o.Dxz,{level:3,children:"Attachments"})}),u||p?(0,r.jsx)(eE.Z,{size:"md",alignment:"start"}):(0,r.jsx)(o.gqx,{name:"attachment_file",fileList:v,iconRender:_,showUploadList:{showRemoveIcon:!1,showDownloadIcon:!1},itemRender:eq,accept:b.join(","),customRequest:async e=>{let{file:i,onSuccess:n,onError:a}=e,r=i.name;try{s(!0),await c({privacy_request_id:t.id,attachment_file:i,attachment_type:ek.s.INTERNAL_USE_ONLY}).unwrap(),l.success("".concat(r," file uploaded successfully")),y(),null==n||n(i)}catch(e){l.error("".concat(r," file upload failed.")),null==a||a(e)}finally{s(!1)}},disabled:!f,children:a&&(0,r.jsx)(o.ua7,{title:m&&"Add attachment not available: ".concat((0,eT.e$)(m)),placement:"top",children:(0,r.jsxs)(o.kCb,{align:"center",gap:12,className:"mb-4",children:[(0,r.jsx)(o.zxk,{icon:(0,r.jsx)(o.PJP.mm_,{}),iconPosition:"end",disabled:!f||i,loading:i,children:i?"Uploading":"Add"}),(0,r.jsx)(er.b,{label:"Uploaded attachments are for internal use and won't be send as part of the request package.\n                      Accepted filetypes: ".concat(b.join(", ")),placement:"top"})]})})})]})})},eI=i(15709),eD=i.n(eI),eO=e=>{let{label:t,children:i}=e;return(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"shrink-0 grow-0 basis-1/2 pr-2 ".concat(eD().label),children:(0,r.jsxs)(o.Typography.Text,{children:[t,":"]})}),(0,r.jsx)("div",{className:"min-w-0 shrink grow ".concat(eD().value),"data-testid":"request-detail-value-".concat(t),children:i})]})},eL=e=>{let{subjectRequest:t}=e,{custom_privacy_request_fields:i}=t;return(0,r.jsx)("div",{className:"flex flex-col gap-2",children:i&&Object.keys(i).length>0&&Object.entries(i).filter(e=>{let[,t]=e;return t.value}).map(e=>{let[t,i]=e;return(0,r.jsx)(eO,{label:i.label,children:(0,r.jsx)(o.Typography.Text,{children:Array.isArray(i.value)?i.value.join(", "):i.value})},t)})})},ez=e=>{var t,i;let{subjectRequest:s}=e,{plus:n}=(0,C.hz)(),{id:a,status:l,policy:c,identity:d,identity_verified_at:u}=s;return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)(o.Typography.Title,{level:2,children:"Request details"})}),(0,r.jsxs)(o.kCb,{vertical:!0,gap:12,className:"mb-6",children:[(0,r.jsx)(eO,{label:"Status",children:(0,r.jsx)(eb.Z,{status:l})}),(0,r.jsx)(eO,{label:"Time remaining",children:(0,r.jsx)(ef.Z,{daysLeft:s.days_left,includeText:!0,status:s.status})}),(0,r.jsx)(eO,{label:"Request type",children:(0,r.jsx)(eh,{rules:c.rules})}),(0,r.jsx)(eO,{label:"Source",children:n&&(0,r.jsx)(o.Typography.Text,{children:s.source||"-"})}),s.submitted_by&&(0,r.jsx)(eO,{label:"Created by",children:(0,r.jsx)(o.Typography.Text,{children:(null===(t=s.submitter)||void 0===t?void 0:t.username)||"-"})}),(0,r.jsx)(eO,{label:"Reviewed by",children:(0,r.jsx)(o.Typography.Text,{children:(null===(i=s.reviewer)||void 0===i?void 0:i.username)||"-"})}),Object.entries(d).filter(e=>{let[,{value:t}]=e;return null!==t}).map(e=>{let[t,{value:i="",label:s}]=e,n="".concat(i).concat(u?"":" (Unverified)");return(0,r.jsx)(eO,{label:"Subject ".concat(s.toLocaleLowerCase()),children:(0,r.jsx)(o.ua7,{title:n,trigger:"click",children:(0,r.jsx)(o.Typography.Text,{ellipsis:!0,children:n})})},t)}),(0,r.jsx)(eL,{subjectRequest:s})]}),(0,r.jsxs)(o.l09,{layout:"vertical",children:[(0,r.jsx)(o.l09.Item,{label:"Request ID:",className:"mb-4",children:(0,r.jsx)(o.kCb,{gap:1,children:(0,r.jsxs)(o.TaI.Compact,{style:{width:"100%"},children:[(0,r.jsx)(o.IIB,{readOnly:!0,value:a,"data-testid":"request-detail-value-id"}),(0,r.jsx)(o.zxk,{"aria-label":"Copy request ID",icon:(0,r.jsx)(G.Z,{copyText:a})})]})})}),(0,r.jsx)(o.l09.Item,{label:"Policy key:",className:"mb-4",children:(0,r.jsx)(o.IIB,{readOnly:!0,value:s.policy.key,"data-testid":"request-detail-value-policy"})})]}),(0,r.jsx)(eP,{subjectRequest:s})]})};let eM=[g.q2.COMPLETE,g.q2.CANCELED,g.q2.DENIED,g.q2.ERROR];var eU=e=>{var t;let{data:i}=e,s=(0,x.useMemo)(()=>({id:i.id,verbose:!0}),[i.id]),{data:n}=(0,p.QA)(s,{pollingInterval:eM.includes(i.status)?0:2e3,skip:!i.id}),a=null!==(t=null==n?void 0:n.items[0])&&void 0!==t?t:i,l=a.status===g.q2.REQUIRES_INPUT,[c,d]=(0,x.useState)("activity"),u=(0,x.useMemo)(()=>[{key:"activity",label:"Activity",children:(0,r.jsx)(ea,{subjectRequest:a})},{key:"manual-tasks",label:"Manual tasks",children:(0,r.jsx)(e_,{subjectRequest:a,onComplete:()=>d("activity")}),disabled:!l}],[l,a]);return(0,r.jsxs)("div",{className:"flex gap-8",children:[(0,r.jsx)("div",{className:"w-0 grow",children:(0,r.jsx)(o.mQc,{items:u,activeKey:c,onChange:d})}),(0,r.jsx)("div",{className:"w-1/3 2xl:w-[432px]","data-testid":"privacy-request-details",children:(0,r.jsx)(ez,{subjectRequest:a})})]})},eB=i(57526),eW=i(66548),eJ=i(45489),eV=e=>{let{privacyRequest:t,action:i}=e,{handleApproveRequest:s,handleDenyRequest:n}=(0,eJ.Z)({subjectRequest:t}),a=(0,o.UD8)(),l=t.status===g.q2.PENDING,r=t.status===g.q2.DUPLICATE,c=(0,o.E2M)(),d=async e=>{let{reason:t}=e,l=a.loading({content:"approve"===i?"Approving request...":"Denying request..."});"deny"===i&&await n(t),"approve"===i&&await s(),l()};return{showAction:l||r,closeModal:c.onClose,performAction:d,openConfirmationModal:c.onOpen,isModalOpen:c.isOpen}},eF=e=>{var t,i,s;let{privacyRequest:n}=e,a=null===(i=(0,C.hz)())||void 0===i?void 0:null===(t=i.flags)||void 0===t?void 0:t.downloadAccessRequestResults,l=n.status===g.q2.COMPLETE,r=em(n.policy.rules).includes(g.Us.ACCESS),o=(0,j.Tg)([g.Sh.PRIVACY_REQUEST_ACCESS_RESULTS_READ]),{data:c,isLoading:d,isError:u,error:m}=(0,ed.br)({privacy_request_id:n.id},{skip:!l}),h=null!==(s=null==c?void 0:c.access_result_urls[0])&&void 0!==s?s:"",p=!!h&&"your local fides_uploads folder"!==h,x=null;return u?x=(0,eT.e$)(m,"Unable to resolve download URL"):p||(x="Requests stored locally cannot be downloaded"),{showDownloadResults:a&&o&&r&&l,downloadResults:()=>{let e=document.createElement("a");e.href=h,e.target="_blank",e.rel="noopener noreferrer",e.click(),e.remove()},infoTooltip:x,isLoading:d,isDisabled:!p}},eG=e=>{let{privacyRequest:t}=e,{errorAlert:i,successAlert:s}=(0,ec.VY)(),n=t.status===g.q2.ERROR,a=(0,o.UD8)(),[l]=(0,ed.Fq)();return{reprocessPrivacyRequest:async()=>{if(!t)return;let e=a.loading("Reprocessing privacy request...",0),n=await l(t);"error"in n?i((0,eT.e$)(n.error),"DSR automation has failed for this privacy request due to the following:",{duration:null}):s("Privacy request is now being reprocessed."),e()},showReprocess:n}},eK=e=>{let{privacyRequest:t}=e,{showDownloadResults:i,downloadResults:s,infoTooltip:n,isDisabled:a}=eF({privacyRequest:t}),{isModalOpen:l,closeModal:c,performAction:d,openConfirmationModal:u,showAction:m}=eV({privacyRequest:t,action:"approve"}),{isModalOpen:h,closeModal:p,performAction:j,openConfirmationModal:y,showAction:v}=eV({privacyRequest:t,action:"deny"}),{reprocessPrivacyRequest:_,showReprocess:f}=eG({privacyRequest:t}),{handleFinalizeRequest:b,finalizeRequestResult:E}=(0,eJ.Z)({subjectRequest:t}),T=(0,x.useMemo)(()=>{let e=[];return e.push({key:"approve",label:(0,r.jsx)("span",{"data-testid":"privacy-request-approve-btn",children:"Approve"}),onClick:u,disabled:!m}),e.push({key:"deny",label:(0,r.jsx)("span",{"data-testid":"privacy-request-deny-btn",children:"Deny"}),onClick:y,disabled:!v}),e.push({key:"reprocess",label:(0,r.jsx)("span",{"data-testid":"privacy-request-action-reprocess",children:"Reprocess"}),onClick:_,disabled:!f}),t.status===g.q2.REQUIRES_MANUAL_FINALIZATION&&e.push({key:"finalize",label:(0,r.jsx)("span",{"data-testid":"privacy-request-action-finalize",children:"Finalize"}),onClick:b,disabled:E.isLoading}),i&&e.push({key:"download",label:(0,r.jsx)(o.ua7,{title:a?n:null,placement:"bottom",children:(0,r.jsx)("span",{"data-testid":"download-results-btn",children:"Download request results"})}),onClick:s,disabled:a}),e},[i,s,n,a,m,v,u,y,f,_,t.status,b,E.isLoading]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.Ltx,{menu:{items:T},trigger:["click"],overlayStyle:{minWidth:"160px"},children:(0,r.jsx)(o.zxk,{icon:(0,r.jsx)(o.PJP.pO,{}),"data-testid":"privacy-request-actions-dropdown-btn",iconPosition:"end",type:"primary",disabled:!T.length,size:"large",children:"Actions"})}),(0,r.jsx)(eB.Z,{isOpen:l,isLoading:!1,onClose:c,onApproveRequest:()=>d({reason:""}),subjectRequest:t}),(0,r.jsx)(eW.Z,{isOpen:h,onClose:p,onDenyRequest:e=>j({reason:e})})]})},eH=()=>{let e=(0,c.useRouter)().query.id,{data:t,isLoading:i,error:s}=(0,p.QA)({id:e,verbose:!0},{skip:!e}),n=(null==t?void 0:t.items[0])||null;return s?(0,r.jsx)(d.Z,{error:s,defaultMessage:"A problem occurred while fetching the privacy request ".concat(e)}):(0,r.jsxs)(u.Z,{title:"Privacy Request - ".concat(e),children:[(0,r.jsx)(h.Z,{heading:"Privacy Requests",breadcrumbItems:[{title:"All requests",href:m.Jw},{title:"Request details"}],rightContent:!!n&&(0,r.jsx)(eK,{privacyRequest:n})}),i&&(0,r.jsx)(o.w4_,{children:(0,r.jsx)(o.Y6B,{})}),!i&&n&&(0,r.jsx)(eU,{data:n})]})}},15709:function(e){e.exports={value:"RequestDetailsRow_value__WMXn3",label:"RequestDetailsRow_label__dn3CQ"}},38450:function(e){e.exports={container:"ActivityTimelineEntry_container__tCva0","container--open":"ActivityTimelineEntry_container--open__1d9mA",itemButton:"ActivityTimelineEntry_itemButton__MlmWS","itemButton--error":"ActivityTimelineEntry_itemButton--error__UizD2","itemButton--comment":"ActivityTimelineEntry_itemButton--comment__g98SH","itemButton--awaiting-input":"ActivityTimelineEntry_itemButton--awaiting-input__6lB5t","itemButton--polling":"ActivityTimelineEntry_itemButton--polling__jzolP",header:"ActivityTimelineEntry_header__GYibj",title:"ActivityTimelineEntry_title__rm_g0","title--error":"ActivityTimelineEntry_title--error__fOi0s","title--awaiting-input":"ActivityTimelineEntry_title--awaiting-input__3sPAo","title--polling":"ActivityTimelineEntry_title--polling__g_Hgn",timestamp:"ActivityTimelineEntry_timestamp__uMEMT",viewLogs:"ActivityTimelineEntry_viewLogs___T4jN",logs:"ActivityTimelineEntry_logs__T7R0J","logs--open":"ActivityTimelineEntry_logs--open__o_9Io"}}},function(e){e.O(0,[431,7245,8852,2888,9774,179],function(){return e(e.s=6554)}),_N_E=e.O()}]);