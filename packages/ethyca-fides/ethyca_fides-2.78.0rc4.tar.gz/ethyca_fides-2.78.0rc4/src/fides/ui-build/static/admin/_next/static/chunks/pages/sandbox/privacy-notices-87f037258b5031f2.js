(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7093],{16207:function(e,l,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/sandbox/privacy-notices",function(){return a(52640)}])},58754:function(e,l,a){"use strict";var t=a(24246),n=a(36010),s=a(70788);l.Z=e=>{let{heading:l,breadcrumbItems:a,isSticky:i=!0,children:r,rightContent:c,style:o,...d}=e;return(0,t.jsxs)("div",{...d,style:i?{position:"sticky",top:"-24px",paddingTop:"24px",paddingBottom:"24px",paddingLeft:"40px",marginLeft:"-40px",paddingRight:"40px",marginRight:"-40px",marginTop:"-24px",left:0,zIndex:20,backgroundColor:"white",...o}:{paddingBottom:"24px",...o},children:[(0,t.jsxs)(n.kCb,{justify:"space-between",children:["string"==typeof l?(0,t.jsx)(n.Dxz,{className:a||r?"pb-4":void 0,level:1,"data-testid":"page-heading",children:l}):l,c&&(0,t.jsx)("div",{"data-testid":"page-header-right-content",children:c})]}),!!a&&(0,t.jsx)(s.m,{className:r?"pb-4":void 0,items:a,"data-testid":"page-breadcrumb"}),r]})}},70788:function(e,l,a){"use strict";a.d(l,{m:function(){return o}});var t=a(24246),n=a(36010),s=a(79894),i=a.n(s),r=a(27378);let{Text:c}=n.Typography,o=e=>{let{items:l,...a}=e,s=(0,r.useMemo)(()=>null==l?void 0:l.map((e,a)=>{let s=a===l.length-1,r={...e},o=r.onClick&&!r.href;return("string"==typeof r.title&&(r.title=(0,t.jsx)(c,{style:{color:"inherit",maxWidth:s?void 0:400},ellipsis:!s,id:s?"breadcrumb-current-page":void 0,children:r.title})),o)?r.title=(0,t.jsx)(n.zxk,{type:"text",size:"small",icon:r.icon,onClick:r.onClick,className:"ant-breadcrumb-link -mt-px px-1 text-inherit",children:r.title}):(r.icon&&(r.title=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"anticon align-text-bottom",children:r.icon}),r.title]})),r.href&&r.title&&(r.title=(0,t.jsx)(i(),{href:r.href,className:"ant-breadcrumb-link",children:r.title}),delete r.href)),r}),[l]);return(0,t.jsx)(n.aGc,{items:s,...a})}},52640:function(e,l,a){"use strict";a.r(l),a.d(l,{default:function(){return k}});var t,n,s=a(24246),i=a(36010),r=a(58754),c=a(27378),o=a(812),d=a(18850),p=a(64705),h=a(3124),y=a.n(h),u=e=>{let{title:l,height:a="400px",header:t,headerColor:n,body:r,emptyMessage:c,children:o}=e;return(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Typography.Text,{strong:!0,className:"mb-4 block",children:l}),(0,s.jsx)(i.Zbd,{className:"bg-gray-50 font-mono text-xs",styles:{body:{padding:"18px"}},children:(0,s.jsxs)("div",{className:"overflow-auto",style:{height:a},children:[t&&(0,s.jsx)(i.Typography.Text,{strong:!0,size:"sm",className:"mb-2 block",style:{color:n},children:t}),o||(null!=r?(0,s.jsx)("pre",{className:"m-0 whitespace-pre-wrap",children:JSON.stringify(r,null,2)}):c?(0,s.jsx)(i.kCb,{vertical:!0,align:"center",justify:"center",className:"h-full",children:(0,s.jsx)(i.Typography.Text,{type:"secondary",children:c})}):null)]})})]})};let x=e=>{let{privacyNotices:l}=e;return 0===l.length?null:(0,s.jsx)("div",{className:"max-h-60 overflow-y-auto",children:(0,s.jsx)("ul",{className:"m-0 list-inside list-disc pl-2",children:l.map(e=>(0,s.jsx)("li",{className:"list-none",children:(0,s.jsxs)("ul",{className:"m-0 list-inside list-disc",children:[(0,s.jsx)("li",{className:"py-1",children:e.name}),e.children&&e.children.length>0&&e.children.map(e=>(0,s.jsx)("li",{className:"py-1 pl-5",children:e.name},e.id))]})},e.id))})})};var g=e=>{let{region:l,onRegionChange:a,propertyId:t,onPropertyIdChange:n,onFetchExperience:r,isLoading:c,errorMessage:o,privacyNotices:d}=e;return(0,s.jsxs)(i.kCb,{vertical:!0,gap:"small",children:[(0,s.jsx)(i.Typography.Title,{level:3,children:"Configuration"}),(0,s.jsxs)(i.kCb,{gap:"large",children:[(0,s.jsxs)(i.kCb,{vertical:!0,flex:1,style:{minWidth:0},children:[(0,s.jsx)(i.Typography.Text,{strong:!0,className:"mb-2 block",children:"Experience region"}),(0,s.jsxs)(i.kCb,{gap:"small",className:"mb-4",children:[(0,s.jsx)(i.IIB,{placeholder:"Enter region (e.g., us_ca)",value:l,onChange:e=>a(e.target.value),className:"w-64"}),(0,s.jsx)(i.zxk,{type:"primary",onClick:r,loading:c,disabled:!l,children:"Fetch experience"})]}),(0,s.jsx)(i.Typography.Text,{strong:!0,className:"mb-2 block",children:"Property ID (optional)"}),(0,s.jsx)(i.Typography.Text,{type:"secondary",className:"mb-2 block",children:"Leave empty to retrieve experience with no property"}),(0,s.jsx)(i.kCb,{gap:"small",className:"mb-4",children:(0,s.jsx)(i.IIB,{placeholder:"Property ID (e.g. FDS-1234)",value:t,onChange:e=>n(e.target.value),className:"w-64"})}),o&&(0,s.jsx)(i.Typography.Text,{type:"danger",className:"mb-4 block",children:o})]}),(0,s.jsx)(i.kCb,{vertical:!0,flex:1,children:(0,s.jsx)(u,{title:"Available notices",height:"200px",headerColor:y().FIDESUI_MINOS,emptyMessage:"Available notices will appear here after fetching experience",children:d.length>0?(0,s.jsx)(x,{privacyNotices:d}):null})})]})]})},m=e=>{let{email:l,onEmailChange:a,selectedNoticeKeys:t,onSelectedNoticeKeysChange:n,parentNoticeKeys:r,onFetchCurrentPreferences:c,isLoading:o,isError:d,error:p,getCurrentResponse:h}=e;return(0,s.jsxs)(i.kCb,{gap:"large",children:[(0,s.jsx)(i.kCb,{vertical:!0,flex:1,children:(0,s.jsxs)(i.kCb,{vertical:!0,className:"pr-24",children:[(0,s.jsx)(i.Typography.Text,{strong:!0,className:"mb-2 block",children:"User email (identity)"}),(0,s.jsx)(i.IIB,{placeholder:"Enter email address",value:l,onChange:e=>a(e.target.value),className:"mb-4"}),(0,s.jsx)(i.Typography.Text,{strong:!0,className:"mb-2 block",children:"Notice keys"}),(0,s.jsx)(i.PhF,{mode:"multiple",placeholder:"All notices",value:t,onChange:n,options:r,className:"mb-4 w-full",allowClear:!0,"aria-label":"Notice keys"}),(0,s.jsx)(i.zxk,{type:"primary",onClick:c,loading:o,disabled:!l,className:"mb-4 self-start",children:"Fetch current preferences"}),d&&(0,s.jsxs)(i.Typography.Text,{type:"danger",className:"mb-4 block",children:["Error fetching current preferences: ",p||"Unknown error"]})]})}),(0,s.jsx)(i.kCb,{vertical:!0,flex:1,className:"min-w-0",children:(0,s.jsx)(u,{title:"GET response",header:h?"GET /api/v3/privacy-preferences/current?identity.email=".concat(l).concat(t.length>0?"&notice_keys=".concat(t.join(","),"&include_descendants=true"):""):null,headerColor:y().FIDESUI_SUCCESS,body:h,emptyMessage:"GET response will appear here after fetching preferences"})})]})};let _=e=>{let l=[],a=e=>e.map(e=>{var t,n;let s=(null===(n=e.translations)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.privacy_notice_history_id)||e.id,i={title:e.name,key:e.notice_key,noticeHistoryId:s,noticeKey:e.notice_key};return l.push(i.key),e.children&&e.children.length>0&&(i.children=a(e.children)),i});return{treeData:a(e),allKeys:l}};var v=e=>{let{privacyNotices:l,checkedKeys:a,onCheckedKeysChange:t,onExplicitChange:n}=e,{treeData:r,allKeys:o}=(0,c.useMemo)(()=>_(l),[l]),[d,p]=(0,c.useState)(o),[h,y]=(0,c.useState)(!0);(0,c.useEffect)(()=>{p(o)},[o]);let u=(0,c.useCallback)(e=>{p(e),y(!1)},[]),x=(0,c.useCallback)(e=>{let l=Array.isArray(e)?e:e.checked,s=l.filter(e=>!a.includes(e)),i=a.filter(e=>!l.includes(e)),r=s.length>0?s[0]:i[0];void 0!==r&&n&&n(r),t(l)},[a,t,n]);return(0,s.jsx)("div",{className:"max-w-lg",children:(0,s.jsx)(i.mpN,{checkable:!0,checkStrictly:!0,onExpand:u,expandedKeys:d,autoExpandParent:h,onCheck:x,checkedKeys:a,selectable:!1,treeData:r})})};(t=n||(n={})).CASCADE_DOWN_OPT_OUT="cascade_down_opt_out",t.CASCADE_DOWN_ALL="cascade_down_all",t.CASCADE_UP_ALL="cascade_up_all",t.CASCADE_UP_ALL_CASCADE_DOWN_ALL="cascade_up_all_cascade_down_all",t.CASCADE_DOWN_ALL_CASCADE_UP_OPT_IN="cascade_down_all_cascade_up_opt_in";var C=e=>{let{value:l,onChange:a}=e,t=[{value:n.CASCADE_DOWN_OPT_OUT,label:"Cascade down opt out"},{value:n.CASCADE_DOWN_ALL,label:"Cascade down all"},{value:n.CASCADE_UP_ALL,label:"Cascade up all"},{value:n.CASCADE_UP_ALL_CASCADE_DOWN_ALL,label:"Cascade up and down all"},{value:n.CASCADE_DOWN_ALL_CASCADE_UP_OPT_IN,label:"Cascade down all, cascade up opt in"}];return(0,s.jsxs)(i.kCb,{align:"center",gap:3,className:"mb-4",children:[(0,s.jsx)("label",{htmlFor:"policy-select",id:"policy-select-label",children:(0,s.jsx)(i.Typography.Text,{strong:!0,style:{whiteSpace:"nowrap"},children:"Propagation policy:"})}),(0,s.jsx)(i.PhF,{id:"policy-select",value:null!=l?l:void 0,onChange:e=>{a(void 0===e?null:e)},style:{width:320},placeholder:"Cascade down opt out",allowClear:!0,options:t,"aria-labelledby":"policy-select-label"})]})},b=e=>{let{policy:l,onPolicyChange:a,privacyNotices:t,preferenceState:n,noticeMappings:r,experienceConfigHistoryId:h,email:x,hasCurrentResponse:g,explicitlyChangedKeys:m,onExplicitlyChangedKeysChange:_}=e,{checkedKeys:b,fetchedCheckedKeys:j,onCheckedKeysChange:f,onFetchedKeysChange:N}=n,{noticeKeyToHistoryMap:k}=r,[S,T]=(0,c.useState)(null),[A,{isLoading:E,isError:w,error:D}]=(0,d.ZR)(),L=(0,c.useCallback)(()=>({fetchedSet:new Set(j.map(e=>e.toString())),currentSet:new Set(b.map(e=>e.toString()))}),[j,b]),I=(0,c.useMemo)(()=>{let{fetchedSet:e,currentSet:l}=L();return Array.from(k.keys()).some(a=>e.has(a)!==l.has(a))},[L,k]),P=(0,c.useCallback)(async()=>{let{fetchedSet:e,currentSet:a}=L(),t=Array.from(k.keys()).filter(l=>e.has(l)!==a.has(l));if(0===t.length)return;let n=m.filter(e=>t.includes(String(e))).map(e=>{let l=String(e),t=k.get(l)||"",n=a.has(l);return{notice_key:l,notice_history_id:t,value:n?p.p.OPT_IN:p.p.OPT_OUT,collected_at:new Date().toISOString(),meta:{fides:{experience_config_history_id:h}}}});try{let e=await A({body:{identity:{email:{value:x}},preferences:n},policy:l}).unwrap();T(e);let a=e.preferences.filter(e=>e.value===p.p.OPT_IN).map(e=>e.notice_key);f(a),N(a),_([])}catch(e){}},[L,k,l,h,x,A,f,N,m,_]);return(0,s.jsxs)(i.kCb,{gap:"large",children:[(0,s.jsxs)(i.kCb,{vertical:!0,flex:1,children:[(0,s.jsx)(i.Typography.Title,{level:4,style:{fontSize:14,marginBottom:8},children:"Current preferences"}),g?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C,{value:l,onChange:a}),(0,s.jsx)(v,{privacyNotices:t,checkedKeys:b,onCheckedKeysChange:f,onExplicitChange:e=>{_([...m.filter(l=>l!==e),e])}}),(0,s.jsx)(i.zxk,{type:"primary",onClick:P,loading:E,disabled:!I,className:"mt-4 self-start",children:"Save preferences"}),w&&D&&(0,s.jsxs)(i.Typography.Text,{type:"danger",className:"mt-2 block",children:["Error saving preferences: ",(0,o.e$)(D)]})]}):(0,s.jsx)(i.kCb,{vertical:!0,align:"center",justify:"center",flex:1,children:(0,s.jsx)(i.HYy,{description:"Fetch current preferences to manage user consent"})})]}),(0,s.jsx)(i.kCb,{vertical:!0,flex:1,className:"min-w-0",children:(0,s.jsx)(u,{title:"POST response",header:S?"POST /api/v3/privacy-preferences".concat(l?"?policy=".concat(l):""):null,headerColor:y().FIDESUI_ALERT,body:S,emptyMessage:"POST response will appear here after saving preferences"})})]})};let j={REGION:"us_ca",SHOW_DISABLED:!1};var f=()=>{let[e,l]=(0,c.useState)(j.REGION),[a,t]=(0,c.useState)(""),[n,r]=(0,c.useState)(""),[h,y]=(0,c.useState)(null),[u,x]=(0,c.useState)([]),[_,v]=(0,c.useState)([]),[C,f]=(0,c.useState)([]),[N,k]=(0,c.useState)([]),[S,T]=(0,c.useState)([]),[A,E]=(0,c.useState)(null),[w,D]=(0,c.useState)(null),[L,I]=(0,c.useState)(""),[P,{isLoading:O}]=(0,d.nU)(),[F,{isLoading:U,isError:K,error:M}]=(0,d.Lg)(),{noticeKeyToHistoryMap:W,parentNoticeKeys:z}=(0,c.useMemo)(()=>{let e=new Map,l=[],a=(t,n)=>{t.forEach(t=>{var s,i,r;let c=(null===(i=t.translations)||void 0===i?void 0:null===(s=i[0])||void 0===s?void 0:s.privacy_notice_history_id)||t.id;e.set(t.notice_key,c),n||l.push({label:t.name,value:t.notice_key}),(null===(r=t.children)||void 0===r?void 0:r.length)&&a(t.children,t.notice_key)})};return a(S),{noticeKeyToHistoryMap:e,parentNoticeKeys:l}},[S]),B=(0,c.useCallback)(async()=>{if(I(""),!e){I("Please enter a region");return}try{let s=await P({region:e,show_disabled:j.SHOW_DISABLED,...a&&{property_id:a}}).unwrap();if(s.items&&s.items.length>0){let e=s.items[0];if("privacy_notices"in e&&e.privacy_notices&&e.privacy_notices.length>0){var l,t,n;T(e.privacy_notices);let a=(null===(n=e.experience_config)||void 0===n?void 0:null===(t=n.translations)||void 0===t?void 0:null===(l=t[0])||void 0===l?void 0:l.privacy_experience_config_history_id)||null;E(a),x([]),v([]),k([])}}}catch(e){I("Failed to fetch privacy experience")}},[P,e,a]),R=(0,c.useCallback)(async()=>{try{let e={"identity.email":n};N.length>0&&(e.notice_keys=N);let l=await F(e).unwrap();D(l);let a=l.filter(e=>e.value===p.p.OPT_IN).map(e=>e.notice_key);x(a),v(a),f([])}catch(e){}},[n,N,F]);return(0,s.jsxs)("div",{className:"mt-5 space-y-8",children:[(0,s.jsx)(i.bZj,{type:"info",message:"This page makes real API calls to the Consent V3 API.",description:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Typography.Paragraph,{className:"mb-0 mt-3",children:"Before using this sandbox, ensure you have:"}),(0,s.jsxs)("ul",{className:"mb-0 ml-6 mt-2 space-y-1",children:[(0,s.jsxs)("li",{children:["The consent v3 API enabled via the env var"," ",(0,s.jsx)(i.Typography.Text,{code:!0,children:"FIDESPLUS__EXPERIMENTAL__CONSENT_V3_ENABLED=true"})]}),(0,s.jsx)("li",{children:"An email identity definition configured in your system"}),(0,s.jsx)("li",{children:"A privacy experience set up with at least one privacy notice in the selected region"})]})]}),showIcon:!0}),(0,s.jsx)(g,{region:e,onRegionChange:l,propertyId:a,onPropertyIdChange:t,onFetchExperience:B,isLoading:O,errorMessage:L,privacyNotices:S}),(0,s.jsx)(i.izJ,{}),(0,s.jsxs)(i.kCb,{vertical:!0,gap:"small",children:[(0,s.jsx)(i.Typography.Title,{level:3,children:"User preferences"}),0===S.length&&(0,s.jsx)(i.HYy,{description:"Load an experience in order to manage user preferences"}),S.length>0&&(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(m,{email:n,onEmailChange:r,selectedNoticeKeys:N,onSelectedNoticeKeysChange:k,parentNoticeKeys:z,onFetchCurrentPreferences:R,isLoading:U,isError:K,error:M?(0,o.e$)(M):null,getCurrentResponse:w}),(0,s.jsx)(b,{policy:h,onPolicyChange:y,privacyNotices:S,preferenceState:{checkedKeys:u,fetchedCheckedKeys:_,onCheckedKeysChange:x,onFetchedKeysChange:v},noticeMappings:{noticeKeyToHistoryMap:W},experienceConfigHistoryId:A,email:n,hasCurrentResponse:null!==w,explicitlyChangedKeys:C,onExplicitlyChangedKeysChange:f})]})]})]})};let{Content:N}=i.Layout;var k=()=>(0,s.jsx)(i.Layout,{children:(0,s.jsxs)(N,{className:"overflow-auto px-10 py-6",children:[(0,s.jsx)(r.Z,{heading:"Privacy Notices Sandbox"}),(0,s.jsx)(f,{})]})})}},function(e){e.O(0,[2888,9774,179],function(){return e(e.s=16207)}),_N_E=e.O()}]);