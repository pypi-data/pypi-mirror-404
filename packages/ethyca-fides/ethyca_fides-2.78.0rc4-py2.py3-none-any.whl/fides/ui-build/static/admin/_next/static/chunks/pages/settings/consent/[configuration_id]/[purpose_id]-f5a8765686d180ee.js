(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5135],{77713:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings/consent/[configuration_id]/[purpose_id]",function(){return r(25805)}])},35287:function(e,t,r){"use strict";var i=r(24246),n=r(36010),s=r(88038),o=r.n(s);r(27378),t.Z=e=>{let{children:t,title:r,fullHeight:s,fullWidth:d,mainProps:a}=e;return(0,i.jsxs)(n.ad9,{"data-testid":r,direction:"column",height:s?"100vh":"calc(100vh - 48px)",width:d?"100vw":"calc(100vw - 240px)",children:[(0,i.jsxs)(o(),{children:[(0,i.jsxs)("title",{children:["Fides Admin UI - ",r]}),(0,i.jsx)("meta",{name:"description",content:"Privacy Engineering Platform"}),(0,i.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,i.jsx)(n.ad9,{px:10,py:6,as:"main",overflow:"auto",direction:"column",flex:1,minWidth:0,...a,children:t})]})}},59849:function(e,t,r){"use strict";r.d(t,{Z:function(){return c}});var i=r(24246),n=r(36010),s=r(86677),o=r(88340);let d="/images/errors";var a=e=>{let{status:t}=e;return 404===t?(0,i.jsx)(n.Eep,{src:"".concat(d,"/404.svg"),alt:"Error 404",preview:!1}):500===t?(0,i.jsx)(n.Eep,{src:"".concat(d,"/500.svg"),alt:"Error 500",preview:!1}):(0,i.jsx)(n.Eep,{src:"".concat(d,"/unknown.svg"),alt:"Error Unknown",preview:!1})},l=r(812),c=e=>{let{error:t,defaultMessage:r="An unexpected error occurred.  Please try again",actions:d,showReload:c=!0}=e,u=(0,l.e$)(t,r),p="data"in t&&t.data?JSON.stringify(t.data):JSON.stringify(t),h="status"in t&&t.status?t.status:void 0,v=(0,s.useRouter)(),_=d&&d.length>0||c;return(0,i.jsx)(n.kCb,{vertical:!0,align:"center",justify:"center",className:"h-screen","data-testid":"error-page-result",children:(0,i.jsx)(n.x4B,{status:"error",icon:(0,i.jsx)(a,{status:h}),title:"Error ".concat(h),subTitle:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.Typography.Paragraph,{type:"secondary",children:u}),(0,i.jsx)(n.kCb,{justify:"start",className:"max-w-96",children:(0,i.jsx)(n.UO1,{ghost:!0,size:"small",items:[{key:"1",label:"Show details",classNames:{header:"w-fit"},children:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.Typography.Text,{type:"secondary",children:p}),(0,i.jsx)(o.Z,{copyText:p})]})}]})})]}),extra:_&&(0,i.jsxs)(n.kCb,{gap:"small",justify:"center",children:[null==d?void 0:d.map((e,t)=>(0,i.jsx)(n.zxk,{...e,children:e.label},t)),c&&(0,i.jsx)(n.zxk,{onClick:()=>v.reload(),type:"primary",children:"Reload"})]})})})}},97181:function(e,t,r){"use strict";r.d(t,{d:function(){return l}});var i=r(24246),n=r(36010),s=r(34090),o=r(27378),d=r(46238),a=r(40324);let l=e=>{let{name:t,label:r,labelProps:l,tooltip:c,isRequired:u,layout:p="inline",helperText:h,...v}=e,[_,m,{setValue:x}]=(0,s.U$)(t),f=!!(m.touched&&m.error),[g,y]=(0,o.useState)("");_.value||"tags"!==v.mode&&"multiple"!==v.mode||(_.value=[]),"tags"===v.mode&&"string"==typeof _.value&&(_.value=[_.value]);let E="tags"===v.mode?(e,t)=>e?e.value!==g||_.value.includes(g)?v.optionRender?v.optionRender(e,t):e.label:'Create "'.concat(g,'"'):void 0:v.optionRender||void 0,j=e=>{y(e),v.onSearch&&v.onSearch(e)},I=(e,t)=>{x(e),v.onChange&&v.onChange(e,t)};return"inline"===p?(0,i.jsx)(n.DTt,{isInvalid:f,isRequired:u,children:(0,i.jsxs)(n.MoG,{templateColumns:r?"1fr 3fr":"1fr",children:[r?(0,i.jsx)(a.__,{htmlFor:v.id||t,...l,children:r}):null,(0,i.jsxs)(n.kCb,{align:"center",children:[(0,i.jsxs)(n.kCb,{vertical:!0,flex:1,className:"mr-2",children:[(0,i.jsx)(n.PhF,{..._,id:v.id||t,"data-testid":"controlled-select-".concat(_.name),...v,optionRender:E,onSearch:"tags"===v.mode?j:void 0,onChange:I,value:_.value||void 0,status:f?"error":void 0}),h&&(0,i.jsx)(n.Kug,{children:h}),(0,i.jsx)(a.Bc,{isInvalid:f,message:m.error,fieldName:_.name})]}),(0,i.jsx)(d.b,{label:c,className:f?"mt-2 self-start":void 0})]})]})}):(0,i.jsx)(n.DTt,{isInvalid:f,isRequired:u,children:(0,i.jsxs)(n.s_g,{alignItems:"start",children:[(0,i.jsxs)(n.kCb,{align:"center",children:[r?(0,i.jsx)(a.__,{htmlFor:v.id||t,fontSize:"xs",my:0,mr:1,...l,children:r}):null,(0,i.jsx)(d.b,{label:c})]}),(0,i.jsx)(n.PhF,{..._,id:v.id||t,"data-testid":"controlled-select-".concat(_.name),...v,optionRender:E,onSearch:"tags"===v.mode?j:void 0,onChange:I,value:_.value||void 0,status:f?"error":void 0}),h&&(0,i.jsx)(n.Kug,{style:{marginTop:0},children:h}),(0,i.jsx)(a.Bc,{isInvalid:f,message:m.error,fieldName:_.name})]})})}},25805:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return U}});var i=r(24246),n=r(36010),s=r(86677),o=r(27378),d=r(59301),a=r(59849),l=r(35287),c=r(77830),u=r(58754),p=r(6675),h=r(51263),v=r(59512),_=r(24813),m=r(60240),x=r(812),f=r(46628),g=r(58452),y=r(34090),E=r(55484),j=r(97181),I=r(8133),R=r(52955);let C=e=>{if(/^\d+$/.test(e))return!0;let t=e.match(/^(\d+)-(\d+)$/);return!!t&&parseInt(t[1],10)<parseInt(t[2],10)},T=e=>{if(/^\d+$/.test(e)){let t=parseInt(e,10);return{start:t,end:t}}let t=e.match(/^(\d+)-(\d+)$/);return t?{start:parseInt(t[1],10),end:parseInt(t[2],10)}:null},S=(e,t)=>e.end===e.start?e.start>=t.start&&(null===t.end||e.start<=t.end):t.end===t.start?t.start>=e.start&&(null===e.end||t.start<=e.end):null===e.end&&null!==t.end?e.start<=t.end:null===t.end&&null!==e.end?t.start<=e.end:null===e.end&&null===t.end||e.start<=t.end&&e.end>=t.start||t.start<=e.end&&t.end>=e.start,b=(e,t)=>e.end===e.start?e.start>=t.start&&(null===t.end||e.start<=t.end):null===t.end?e.start>=t.start:null!==e.end&&e.start>=t.start&&e.end<=t.end,N=(e,t,r,i)=>{var n;let s=t.filter(e=>e.purpose_id===r&&e.id!==i);if(!(null===(n=e.vendor_ids)||void 0===n?void 0:n.length))return!1;let o=e.vendor_ids.map(T).filter(e=>null!==e);return 0!==o.length&&s.some(t=>{let r=e.vendor_restriction===m.PY.RESTRICT_SPECIFIC_VENDORS&&t.vendor_restriction===m.PY.ALLOW_SPECIFIC_VENDORS||e.vendor_restriction===m.PY.ALLOW_SPECIFIC_VENDORS&&t.vendor_restriction===m.PY.RESTRICT_SPECIFIC_VENDORS,i=t.vendor_ids.map(T).filter(e=>null!==e);return r?e.vendor_restriction===m.PY.ALLOW_SPECIFIC_VENDORS?i.some(e=>o.some(t=>!b(e,t))):o.some(e=>i.some(t=>!b(e,t))):t.vendor_restriction===e.vendor_restriction&&o.some(e=>i.some(t=>S(e,t)))})},F=e=>{if(/^\d+$/.test(e))return{start_vendor_id:parseInt(e,10),end_vendor_id:null};let t=e.match(/^(\d+)-(\d+)$/);if(t){let e=parseInt(t[1],10),r=parseInt(t[2],10);if(e<r)return{start_vendor_id:e,end_vendor_id:r}}return null},P=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map(F).filter(e=>null!==e)},w="This restriction type is already in use for this purpose",O={restriction_type:"",vendor_restriction:"",vendor_ids:[]},k=e=>{let{isOpen:t,onClose:r,initialValues:s=O,existingRestrictions:o=[],purposeId:d,restrictionId:a,configurationId:l}=e,c=(0,n.p8r)(),[u]=(0,R.a_)(),[p]=(0,R.h3)(),h=!(d&&v.Py.includes(+d)),_=o.filter(e=>e.id!==a).map(e=>e.restriction_type),g=[{value:m.FF.PURPOSE_RESTRICTION,label:v.fj[m.FF.PURPOSE_RESTRICTION],disabled:_.includes(m.FF.PURPOSE_RESTRICTION),title:_.includes(m.FF.PURPOSE_RESTRICTION)?w:void 0},{value:m.FF.REQUIRE_CONSENT,label:v.fj[m.FF.REQUIRE_CONSENT],disabled:_.includes(m.FF.REQUIRE_CONSENT),title:_.includes(m.FF.REQUIRE_CONSENT)?w:void 0},{value:m.FF.REQUIRE_LEGITIMATE_INTEREST,label:v.fj[m.FF.REQUIRE_LEGITIMATE_INTEREST],disabled:_.includes(m.FF.REQUIRE_LEGITIMATE_INTEREST),title:_.includes(m.FF.REQUIRE_LEGITIMATE_INTEREST)?w:void 0}],T=[{value:m.PY.RESTRICT_ALL_VENDORS,label:v.Cu[m.PY.RESTRICT_ALL_VENDORS],disabled:_.length>0,title:_.length>0?"Cannot restrict all vendors when other restrictions exist":void 0},{value:m.PY.RESTRICT_SPECIFIC_VENDORS,label:v.Cu[m.PY.RESTRICT_SPECIFIC_VENDORS]},{value:m.PY.ALLOW_SPECIFIC_VENDORS,label:v.Cu[m.PY.ALLOW_SPECIFIC_VENDORS]}],S=E.Ry().shape({restriction_type:E.Z_().required("Restriction type is required"),vendor_restriction:E.Z_().required("Vendor restriction is required"),vendor_ids:E.IX().when("vendor_restriction",{is:e=>e!==m.PY.RESTRICT_ALL_VENDORS,then:e=>e.required("At least one vendor ID is required").min(1,"At least one vendor ID is required").test("valid-format","Vendor IDs must be numbers or ranges (e.g., 10 or 15-300)",e=>{var t;return null===(t=null==e?void 0:e.every(e=>C(e)))||void 0===t||t}).test("no-conflicts","One or more of these vendors already have a restriction for this purpose. Please update the existing restriction or remove duplicates.",(e,t)=>!N({...t.parent,vendor_ids:e},o,d,a))})}),b=async e=>{try{let t={restriction_type:e.restriction_type,vendor_restriction:e.vendor_restriction,range_entries:e.vendor_restriction!==m.PY.RESTRICT_ALL_VENDORS?P(e.vendor_ids):[]},i={...t,purpose_id:null!=d?d:0};if(a){let e=await p({configuration_id:l,restriction_id:a,restriction:t});if((0,x.D4)(e)){c((0,f.Vo)("Failed to update restriction"));return}c((0,f.t5)("Restriction updated successfully"))}else{let e=await u({configuration_id:l,restriction:i});if((0,x.D4)(e)){c((0,f.Vo)("Failed to create restriction"));return}c((0,f.t5)("Restriction created successfully"))}r()}catch(e){c((0,f.Vo)("Failed to save restriction"))}};return(0,i.jsx)(I.Z,{isOpen:t,onClose:r,title:"Edit restriction",children:(0,i.jsx)(y.J9,{initialValues:{...s,restriction_type:h?s.restriction_type:m.FF.PURPOSE_RESTRICTION},onSubmit:b,validationSchema:S,children:e=>{let{values:t,validateField:s,setTouched:o}=e;return(0,i.jsx)(y.l0,{children:(0,i.jsxs)(n.kCb,{vertical:!0,className:"gap-6",children:[(0,i.jsx)(n.Bjg,{className:"text-sm",children:"Define how specific vendors are restricted from processing data for this purpose. Select a restriction type, set whether the listed vendors are restricted or allowed, and specify which vendor IDs the restriction applies to."}),(0,i.jsx)(n.ua7,{title:h?void 0:"Non-flexible purposes only support Purpose restrictions and cannot be restricted by consent or legitimate interest settings.",children:(0,i.jsx)(j.d,{name:"restriction_type",label:"Restriction type",options:g,layout:"stacked",tooltip:"Choose how vendors are permitted to process data for this purpose. This setting overrides the vendor's declared legal basis in the Global Vendor List.",isRequired:!0,disabled:!h,className:"w-full"})}),(0,i.jsx)(j.d,{name:"vendor_restriction",label:"Vendor restriction",options:T,layout:"stacked",tooltip:"Decide if the restriction applies to all vendors, specific vendors, or if only certain vendors are allowed.",isRequired:!0}),(0,i.jsx)(n.$cs,{in:!!t.restriction_type&&!!t.vendor_restriction&&t.vendor_restriction!==m.PY.RESTRICT_ALL_VENDORS,animateOpacity:!0,children:(0,i.jsx)(j.d,{name:"vendor_ids",label:"Vendor IDs",mode:"tags",options:[],layout:"stacked",placeholder:"Enter vendor IDs",open:!1,suffixIcon:(0,i.jsx)("span",{}),tooltip:"List the specific vendors that are restricted or allowed from processing data for this purpose.",disabled:t.vendor_restriction===m.PY.RESTRICT_ALL_VENDORS,tokenSeparators:[","," "],onBlur:()=>{setTimeout(()=>{o({vendor_ids:!0}),s("vendor_ids")},100)},helperText:"Enter IDs (e.g. 123) or ranges (e.g. 1-10) and press enter",isRequired:!0})}),(0,i.jsxs)(n.kCb,{justify:"flex-end",className:"gap-3 pt-4",children:[(0,i.jsx)(n.zxk,{onClick:r,"data-testid":"cancel-restriction-button",children:"Cancel"}),(0,i.jsx)(n.zxk,{type:"primary",htmlType:"submit","data-testid":"save-restriction-button",children:"Save"})]})]})})}})})},D=e=>{let{currentValues:t,existingRestrictions:r}=e,[d,a]=(0,o.useState)(!1),[l,c]=(0,o.useState)(!1),u=(0,s.useRouter)(),p=(0,n.p8r)(),[h]=(0,R.FC)(),v=u.query.purpose_id?parseInt(u.query.purpose_id,10):void 0,_=u.query.configuration_id,m=async()=>{try{if(!(null==t?void 0:t.id))return;let e=await h({configuration_id:_,restriction_id:t.id});if((0,x.D4)(e)){p((0,f.Vo)("Failed to delete publisher restriction"));return}a(!1),p((0,f.t5)("Publisher restriction deleted successfully"))}catch(e){p((0,f.Vo)("Failed to delete publisher restriction"))}};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.TaI,{children:[(0,i.jsx)(n.zxk,{size:"small",onClick:()=>c(!0),"data-testid":"edit-restriction-button",children:"Edit"}),(0,i.jsx)(n.zxk,{size:"small",onClick:()=>a(!0),"data-testid":"delete-restriction-button",children:"Delete"})]}),(0,i.jsx)(k,{isOpen:l,onClose:()=>c(!1),initialValues:t,existingRestrictions:r,purposeId:v,restrictionId:null==t?void 0:t.id,configurationId:_}),(0,i.jsx)(g.Z,{isOpen:d,onClose:()=>a(!1),onConfirm:m,title:"Confirm deletion",message:"Are you sure you want to delete this publisher restriction? This action cannot be undone.",cancelButtonText:"Cancel",continueButtonText:"Delete"})]})},{Text:L,Title:A}=n.Typography,V=e=>{let{onAdd:t}=e;return(0,i.jsx)(n.HYy,{image:n.HYy.PRESENTED_IMAGE_SIMPLE,description:(0,i.jsxs)(n.kCb,{vertical:!0,align:"center",gap:"small",children:[(0,i.jsx)(A,{level:5,children:"Add a restriction"}),(0,i.jsx)(L,{className:"max-w-lg",type:"secondary",children:"No restrictions have been added. By default, all vendors follow their declared legal basis unless a restriction is applied—add a restriction to override this behavior."})]}),"data-testid":"empty-table-notice",children:(0,i.jsx)(n.zxk,{type:"primary",onClick:t,children:"Add +"})})},q=()=>{let[e,t]=(0,o.useState)(!1),r=(0,s.useRouter)(),d=r.query.purpose_id?parseInt(r.query.purpose_id,10):void 0,a=r.query.configuration_id,{data:l,isFetching:c}=(0,R.a9)({configuration_id:a,purpose_id:null!=d?d:0},{skip:!a||!d}),u=(0,o.useMemo)(()=>{var e;return(null!==(e=null==l?void 0:l.items)&&void 0!==e?e:[]).map(e=>{var t,r;return{id:e.id,restriction_type:e.restriction_type,vendor_restriction:e.vendor_restriction,vendor_ids:null!==(r=null===(t=e.range_entries)||void 0===t?void 0:t.map(e=>e.end_vendor_id?"".concat(e.start_vendor_id,"-").concat(e.end_vendor_id):e.start_vendor_id.toString()))&&void 0!==r?r:[],purpose_id:e.purpose_id}})},[null==l?void 0:l.items]),p=u.some(e=>e.vendor_restriction===m.PY.RESTRICT_ALL_VENDORS),h=Object.values(m.FF).every(e=>u.some(t=>t.restriction_type===e)),x=(0,o.useMemo)(()=>[{title:"Restriction type",key:"restriction_type",dataIndex:"restriction_type",render:e=>v.fj[e]},{title:"Vendor restriction",key:"vendor_restriction",dataIndex:"vendor_restriction",render:e=>v.Cu[e]},{title:(0,i.jsx)(_.ED,{value:"Vendors",tooltip:"Specify which vendors the restriction applies to. You can apply restrictions to all vendors, specific vendors by their IDs, or allow only certain vendors while restricting the rest."}),key:"vendor_ids",dataIndex:"vendor_ids",render:e=>e.join(", ")||"All vendors"},{title:"Actions",key:"actions",width:154,render:(e,t)=>(0,i.jsx)(D,{currentValues:t,existingRestrictions:u})}],[u]),f=()=>{t(!0)};return(0,i.jsxs)(n.kCb,{vertical:!0,gap:"middle",children:[(0,i.jsx)(n.kCb,{justify:"flex-end",children:(0,i.jsx)(n.ua7,{title:p?'Each vendor must have a unique restriction type. When "Restrict all vendors" is active for any restriction type, no other restrictions can be added.':h?"Each purpose must have a unique restriction type. When all restriction types are active, no other restrictions can be added. Use the 'Edit' button to change the vendor restrictions on each type.":void 0,children:(0,i.jsx)(n.zxk,{type:"primary",onClick:f,disabled:p||h,"data-testid":"add-restriction-button",children:"Add restriction +"})})}),(0,i.jsx)(n.iA_,{dataSource:u,columns:x,rowKey:"id",pagination:!1,size:"small",bordered:!0,loading:c,locale:{emptyText:(0,i.jsx)(V,{onAdd:f})},"data-testid":"purpose-restrictions-table"}),(0,i.jsx)(k,{isOpen:e,onClose:()=>{t(!1)},existingRestrictions:u,purposeId:d,configurationId:a})]})};var U=()=>{let e=(0,s.useRouter)(),t=decodeURIComponent(e.query.configuration_id),r=decodeURIComponent(e.query.purpose_id),{data:_,isLoading:m,error:x}=(0,p.a4)(),{data:f}=(0,R.NZ)(t),g=(0,o.useMemo)(()=>null==_?void 0:_.purposes[r],[_,r]);return x?(0,i.jsx)(a.Z,{error:x,defaultMessage:"A problem occurred while fetching TCF purposes",actions:[{label:"Return to consent settings",onClick:()=>e.push(c.GP)}]}):(0,i.jsxs)(l.Z,{title:"Consent Configuration",children:[(0,i.jsx)(u.Z,{heading:"Consent configuration",breadcrumbItems:[{title:"Consent settings",href:c.GP},{title:(null==f?void 0:f.name)||"Configuration"},{title:"TCF purpose ".concat(r)}]}),(0,i.jsxs)(n.TaI,{direction:"vertical",size:"middle",children:[(0,i.jsxs)(n.TaI,{direction:"vertical",size:"middle",children:[(0,i.jsx)(h.Z,{title:"TCF purpose ".concat(r).concat((null==g?void 0:g.name)?": ".concat(null==g?void 0:g.name):""),children:m?(0,i.jsxs)(n.kCb,{vertical:!0,className:"gap-1.5",children:[(0,i.jsx)(n.ug1,{height:"16px",width:"100%"}),(0,i.jsx)(n.ug1,{height:"16px",width:"100%"}),(0,i.jsx)(n.ug1,{height:"16px",width:"30%"})]}):!!g&&(0,i.jsx)(n.Bjg,{fontSize:"sm",children:null==g?void 0:g.description})}),(0,i.jsx)(h.Z,{title:(null==f?void 0:f.name)||"Configuration",children:(0,i.jsx)(n.TaI,{direction:"vertical",className:"gap-3",children:(0,i.jsxs)(n.Bjg,{fontSize:"sm",children:["Add restrictions to control how vendors process data for specific purposes. For each restriction, choose a restriction type. Then, decide whether the restriction applies to all vendors, specific vendors, or only to a limited set of allowed vendors. You can add multiple restrictions—they'll appear in the table below."," ",(0,i.jsx)(d.Z,{href:v.uh,children:"Learn more about publisher restrictions"})," ","in our docs."]})})})]}),(0,i.jsx)(q,{})]})]})}}},function(e){e.O(0,[494,2888,9774,179],function(){return e(e.s=77713)}),_N_E=e.O()}]);