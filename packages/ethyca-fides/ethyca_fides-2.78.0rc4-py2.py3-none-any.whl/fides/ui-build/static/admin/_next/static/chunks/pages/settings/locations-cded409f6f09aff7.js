(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2462],{40135:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings/locations",function(){return n(36956)}])},36956:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return z}});var i=n(24246),l=n(36010),s=n(16134),o=n(59849),a=n(77213),r=n(58754),d=n(98784),c=n.n(d),u=n(86677),h=n(27378),g=n(812),m=n(58452),p=n(26917),x=n(46628),j=n(60240),f=n(31883),C=n(77830),v=n(26089),y=n(61524),w=n(46238),b=e=>{let{id:t,isChecked:n,onChange:s}=e;return(0,i.jsxs)(l.ad9,{alignItems:"center",gap:"8px",children:[(0,i.jsx)(l.rsf,{checked:n,size:"small",onChange:s,id:t,"data-testid":"regulated-toggle"}),(0,i.jsx)(l.tLq,{fontSize:"sm",m:0,htmlFor:t,children:"Regulated"}),(0,i.jsx)(w.b,{label:"Toggle on to see only locations in this region with privacy regulations supported by Fides"})]})},S=n(67991),k=n(12282),_=n(85759),O=e=>{let{groups:t,locations:n,isOpen:s,onClose:o,selected:a,onChange:r}=e,[d,c]=(0,h.useState)(a),[u,g]=(0,h.useState)(!1),{filteredLocations:m,locationsByGroup:p}=(0,h.useMemo)(()=>{let e=u?n.filter(e=>{var t;return null===(t=e.regulation)||void 0===t?void 0:t.length}):n;return{locationsByGroup:(0,_.VT)(e),filteredLocations:e}},[n,u]),{allSelected:x,handleToggleAll:j,handleToggleSelection:f}=(0,S.QZ)({items:m,selected:d,onChange:c}),C=d.filter(e=>!Object.keys(p).includes(e)).length,v=n[0].continent,y=Object.keys(p),w=!(1===y.length&&"Other"===y[0]);return(0,i.jsxs)(l.TGG,{size:"2xl",isOpen:s,onClose:o,isCentered:!0,children:[(0,i.jsx)(l.T5Q,{}),(0,i.jsxs)(l.Z8H,{"data-testid":"subgroup-modal",children:[(0,i.jsx)(k.h4,{title:"Select locations"}),(0,i.jsxs)(l.zOL,{p:6,maxHeight:"70vh",overflowY:"auto",children:[(0,i.jsx)(k.x$,{title:v,allSelected:x,onToggleAll:j,numSelected:C,children:(0,i.jsx)(b,{id:"".concat(v,"-modal-regulated"),isChecked:u,onChange:()=>g(!u)})}),w?(0,i.jsx)(l.NvE,{allowToggle:!0,allowMultiple:!0,children:Object.entries(p).map(e=>{let[n,s]=e,o=t.find(e=>n===e.id),a=o?o.name:n;return(0,i.jsxs)(l.nCC,{"data-testid":"".concat(a,"-accordion"),children:[(0,i.jsx)("h2",{children:(0,i.jsxs)(l.rKS,{children:[(0,i.jsx)(l.TJV,{as:"span",flex:"1",textAlign:"left",fontWeight:"semibold",fontSize:"sm",children:a}),(0,i.jsx)(l.UhW,{})]})}),(0,i.jsx)(l.rnb,{pb:4,children:(0,i.jsx)(l.RmD,{columns:3,spacing:6,children:s.map(e=>(0,i.jsx)(l.gxE,{size:"sm",colorScheme:"complimentary",isChecked:d.includes(e.id),onChange:()=>f(e.id),"data-testid":"".concat(e.name,"-checkbox"),children:e.name},e.id))})})]},n)})}):(0,i.jsx)(l.RmD,{columns:3,spacing:6,paddingInline:4,children:m.map(e=>(0,i.jsx)(l.gxE,{size:"sm",colorScheme:"complimentary",isChecked:d.includes(e.id),onChange:()=>f(e.id),"data-testid":"".concat(e.name,"-checkbox"),children:e.name},e.id))})]}),(0,i.jsx)(k.$_,{onApply:()=>{let e=new Set(d);Object.entries(p).forEach(t=>{let[n,i]=t;i.every(e=>d.includes(e.id))?e.add(n):e.delete(n)}),r(Array.from(e)),o()},onClose:o})]})]})};let E=(e,t)=>{var n;return null===(n=e.name)||void 0===n?void 0:n.toLocaleLowerCase().includes(t.toLocaleLowerCase())};var L=e=>{let{title:t,groups:n,locations:s,selected:o,onChange:a,search:r}=e,d=(0,l.E2M)(),[c,u]=(0,h.useState)(!1),g=!!(null==r?void 0:r.length),m=n.length>0,p=s;n.length&&(p=n),g&&(p=[...s,...n].sort((e,t)=>e.name.localeCompare(t.name)));let x=c?p.filter(e=>(0,_.$q)(e,s)):p,j=r?x.filter(e=>E(e,r)):x,f=n.filter(e=>"checked"===(0,_.ji)({group:e,selected:o,locations:s})).map(e=>e.id),C=n.filter(e=>"indeterminate"===(0,_.ji)({group:e,selected:o,locations:s})).map(e=>e.id),v=m?[...f,...o]:o,w=o.length,S=e=>{a(s.map(t=>e.includes(t.id)?{...t,selected:!0}:{...t,selected:!1}))};return 0===j.length&&r?null:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(y.ZP,{title:t,items:j,selected:v,indeterminate:m?C:[],onChange:e=>{let t=new Set(e),i=new Set(v);e.forEach(e=>{!i.has(e)&&n.find(t=>t.id===e)&&s.filter(t=>{var n;return null===(n=t.belongs_to)||void 0===n?void 0:n.includes(e)}).forEach(e=>{t.add(e.id)})}),i.forEach(e=>{!t.has(e)&&n.find(t=>t.id===e)&&s.filter(t=>{var n;return null===(n=t.belongs_to)||void 0===n?void 0:n.includes(e)}).forEach(e=>{t.delete(e.id)})}),S(Array.from(t))},onViewMore:()=>{d.onOpen()},numSelected:w,toggle:(0,i.jsx)(b,{id:"".concat(t,"-regulated"),isChecked:c,onChange:()=>u(!c)})}),(0,i.jsx)(O,{groups:n,locations:s,isOpen:d.isOpen,onClose:d.onClose,selected:o,onChange:S},"subgroup-modal-selected-".concat(v.length))]})},T=n(64781),A=e=>{var t,n;let{data:s}=e,o=(0,l.p8r)(),a=(0,l.E2M)(),[r,d]=(0,h.useState)(null!==(n=null===(t=s.locations)||void 0===t?void 0:t.filter(e=>e.id!==j._F.GLOBAL))&&void 0!==n?n:[]),[y,w]=(0,h.useState)(""),[b,{isLoading:S}]=(0,T.WA)(),k=(0,h.useMemo)(()=>(0,_.Il)((s.locations||[]).filter(e=>e.id!==j._F.GLOBAL),s.location_groups||[]),[s]),O=!c().isEqual(r,s.locations),E=(0,u.useRouter)(),A=()=>{E.push(C.vY).then(()=>{o.closeAll()})},z=async()=>{let e=await b({locations:r.map(e=>({id:e.id,selected:e.selected})),regulations:[]});(0,f.D4)(e)?o((0,x.Vo)((0,g.e$)(e.error))):o((0,x.t5)((0,i.jsxs)(l.Bjg,{display:"inline",children:["Fides has automatically associated the relevant regulations with your location choices."," ",(0,i.jsx)(v.Z,{onClick:A,children:"View regulations here."})]})))},M=e=>{d(r.map(t=>{let n=e.find(e=>e.id===t.id);return null!=n?n:t}))};return(0,i.jsxs)(l.s_g,{alignItems:"start",spacing:4,children:[(0,i.jsx)(l.TJV,{maxWidth:"510px",width:"100%",children:(0,i.jsx)(p.Z,{onChange:w,placeholder:"Search",value:y,onClear:()=>w("")})}),(0,i.jsx)(l.RmD,{columns:{base:1,md:2,xl:3},spacing:6,width:"100%",children:Object.entries(k).map(e=>{let[t,n]=e;return(0,i.jsx)(L,{title:t,groups:n.locationGroups,locations:n.locations,selected:r.filter(e=>n.locations.find(t=>t.id===e.id)&&e.selected).map(e=>e.id),onChange:M,search:y},t)})}),(0,i.jsx)(m.Z,{isOpen:a.isOpen,onClose:a.onClose,onConfirm:()=>{z(),a.onClose()},title:"Regulation updates",message:"Modifications in your location settings may also affect your regulation settings to simplify management. You can override any Fides-initiated changes directly in the regulation settings.",isCentered:!0,icon:(0,i.jsx)(l.aNP,{color:"orange"})}),O?(0,i.jsx)(l.zxk,{type:"primary",onClick:a.onOpen,loading:S,"data-testid":"save-btn",children:"Save"}):null]})},z=()=>{let{isLoading:e,error:t}=(0,T.QM)(),n=(0,s.C)(T.P8);return t?(0,i.jsx)(o.Z,{error:t,defaultMessage:"A problem occurred while fetching locations settings"}):(0,i.jsx)(a.Z,{title:"Locations",children:(0,i.jsxs)(l.TJV,{"data-testid":"location-management",children:[(0,i.jsx)(r.Z,{heading:"Locations"}),(0,i.jsx)(l.Bjg,{fontSize:"sm",maxWidth:"720px",pb:6,children:"Select the locations that you operate in and Fides will make sure that you are automatically presented with the relevant regulatory guidelines and global frameworks for your locations."}),(0,i.jsx)(l.TJV,{children:e?(0,i.jsx)(l.Y6B,{}):(0,i.jsx)(A,{data:n})})]})})}}},function(e){e.O(0,[5791,2888,9774,179],function(){return e(e.s=40135)}),_N_E=e.O()}]);