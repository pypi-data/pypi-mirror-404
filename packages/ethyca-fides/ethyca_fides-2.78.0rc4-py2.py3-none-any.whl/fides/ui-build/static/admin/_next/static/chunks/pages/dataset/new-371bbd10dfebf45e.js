(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8538],{73846:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dataset/new",function(){return t(17294)}])},39715:function(e,a,t){"use strict";var s=t(24246),r=t(36010);t(27378),a.Z=e=>{let{isEmptyState:a,yamlError:t}=e;return(0,s.jsxs)(r.TJV,{w:"fit-content",bg:"white",p:3,borderRadius:3,children:[(0,s.jsxs)(r.Br$,{children:[(0,s.jsx)(r.y_b,{as:"h5",color:"gray.700",size:"xs",children:"YAML"}),(0,s.jsx)(r.hw$,{colorScheme:"red",size:"sm",variant:"solid",children:"Error"})]}),(0,s.jsx)(r.TJV,{bg:"red.50",border:"1px solid",borderColor:"red.300",color:"red.300",mt:"16px",borderRadius:"6px",children:(0,s.jsxs)(r.Br$,{alignItems:"flex-start",margin:["14px","17px","14px","17px"],children:[(0,s.jsx)(r.f9v,{}),a&&(0,s.jsxs)(r.TJV,{children:[(0,s.jsx)(r.y_b,{as:"h5",color:"red.500",fontWeight:"semibold",size:"xs",children:"Error message:"}),(0,s.jsx)(r.Bjg,{color:"gray.700",fontSize:"sm",fontWeight:"400",children:"Yaml system is required"})]}),t&&(0,s.jsxs)(r.TJV,{children:[(0,s.jsx)(r.y_b,{as:"h5",color:"red.500",fontWeight:"semibold",size:"xs",children:"Error message:"}),(0,s.jsx)(r.Bjg,{color:"gray.700",fontSize:"sm",fontWeight:"400",children:t.message}),(0,s.jsx)(r.Bjg,{color:"gray.700",fontSize:"sm",fontWeight:"400",children:t.reason}),(0,s.jsxs)(r.Bjg,{color:"gray.700",fontSize:"sm",fontWeight:"400",children:["Ln ",(0,s.jsx)("b",{children:t.mark.line}),", Col"," ",(0,s.jsx)("b",{children:t.mark.column}),", Pos"," ",(0,s.jsx)("b",{children:t.mark.position})]})]})]})})]})}},41207:function(e,a,t){"use strict";t.d(a,{F:function(){return i},M:function(){return n}});var s=t(76649),r=t(65218);let n=t.n(r)()(()=>t.e(7088).then(t.bind(t,57088)).then(e=>e.default),{loadableGenerated:{webpack:()=>[57088]},ssr:!1}),i=e=>(0,s.Ln)({name:"string"},e)&&"YAMLException"===e.name},17294:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return E}});var s=t(24246),r=t(36010),n=t(27378),i=t(77213),l=t(77830),o=t(58754),d=t(34090),c=t(86677),u=t(16125),h=t(55484),y=t(25980),m=t(40324),f=t(812),g=t(58452),x=t(46628),p=t(83265),j=t(32885),b=t(60240),w=t(20386);let v=e=>!("system_type"in e),_={url:"",classify:!1,classifyConfirmed:!1},C=h.Ry().shape({url:h.Z_().required().label("Database URL"),classify:h.O7(),classifyConfirmed:h.O7().when(["url","classify"],{is:(e,a)=>e&&a,then:()=>h.O7().equals([!0])})});var k=()=>{let[e,{isLoading:a}]=(0,w.pR)(),[t,{isLoading:n}]=(0,w.IR)(),[i,{isLoading:o}]=(0,j.Du)(),h=a||n||o,k=(0,r.p8r)(),T=(0,c.useRouter)(),S=(0,y.hz)(),V=(0,u.I0)(),z=async a=>{var t;let s=await e({organization_key:p.Av,generate:{config:{connection_string:a.url},target:b.GC.DB,type:b.j.DATASETS}});if((0,f.D4)(s))return{error:(0,f.e$)(s.error)};let r=(null!==(t=s.data.generate_results)&&void 0!==t?t:[]).filter(v);return r&&r.length>0?{datasets:r}:{error:"Unable to generate a dataset with this connection."}},A=async e=>{let a=await t(e);return(0,f.D4)(a)?{error:(0,f.e$)(a.error)}:{dataset:a.data}},E=async e=>{let{values:a,datasets:t}=e,s=await i({dataset_schemas:t.map(e=>{let{name:a,fides_key:t}=e;return{fides_key:t,name:a}}),schema_config:{organization_key:p.Av,generate:{config:{connection_string:a.url},target:b.GC.DB,type:b.j.DATASETS}}});return(0,f.D4)(s)?{error:(0,f.e$)(s.error)}:{classifyInstances:s.data.classify_instances}},L=async e=>{var a;let t=await z(e);if("error"in t){k((0,x.Vo)(t.error));return}let s=await Promise.all(t.datasets.map(e=>A(e))),r=null!==(a=s.find(e=>"error"in e))&&void 0!==a?a:s[0];if("error"in r){k((0,x.Vo)(r.error));return}if(!e.classify){k((0,x.t5)("Generated ".concat(r.dataset.name," dataset"))),T.push({pathname:l.o5,query:{datasetId:r.dataset.fides_key}});return}let n=await E({values:e,datasets:t.datasets});if("error"in n){k((0,x.Vo)(n.error));return}k((0,x.t5)("Generate and classify are now in progress")),V((0,w.Zl)(r.dataset.fides_key)),T.push("/dataset")};return(0,s.jsx)(d.J9,{initialValues:{..._,classify:S.plus},validationSchema:C,onSubmit:L,validateOnChange:!1,validateOnBlur:!1,children:e=>{let{isSubmitting:a,errors:t,values:n,submitForm:i,resetForm:l,setFieldValue:o}=e;return(0,s.jsxs)(d.l0,{children:[(0,s.jsxs)(r.s_g,{spacing:8,align:"left",children:[(0,s.jsx)(r.Bjg,{size:"sm",color:"gray.700",children:"Connect to a database using the connection URL. You may have received this URL from a colleague or your Ethyca developer support engineer."}),(0,s.jsx)(r.TJV,{children:(0,s.jsx)(m.j0,{name:"url",label:"Database URL"})}),S.plus?(0,s.jsx)(m.w8,{name:"classify",label:"Classify dataset",tooltip:"Use Fides Classify to suggest labels based on your data."}):null,(0,s.jsx)(r.TJV,{children:(0,s.jsx)(r.zxk,{type:"primary",htmlType:"submit",loading:a||h,disabled:a||h,"data-testid":"create-dataset-btn",children:"Generate dataset"})})]}),(0,s.jsx)(g.Z,{title:"Generate and classify this dataset",message:"You have chosen to generate and classify this dataset. This process may take several minutes. In the meantime you can continue using Fides. You will receive a notification when the process is complete.",isOpen:void 0!==t.classifyConfirmed,onClose:()=>{l({values:{...n,classifyConfirmed:!1}})},onConfirm:()=>{o("classifyConfirmed",!0),setTimeout(()=>{i()},0)}})]})}})},T=t(66527),S=t(17245),V=t(41207),z=t(39715),A=()=>{let[e]=(0,w.IR)(),[a,t]=(0,n.useState)(!0),[i,o]=(0,n.useState)(!1),[d,u]=(0,n.useState)(!1),h=(0,n.useRef)(null),y=(0,c.useRouter)(),m=(0,r.p8r)(),{errorAlert:g}=(0,S.VY)(),[p,j]=(0,n.useState)(void 0),b=e=>{T.ZP.load(e,{json:!0}),j(void 0)},v=async a=>{let t;return"object"==typeof a&&null!==a&&"dataset"in a&&Array.isArray(a.dataset)?[t]=a.dataset:Array.isArray(a)?[t]=a:t=a,e(t)},_=e=>{m((0,x.t5)("Successfully loaded new dataset YAML")),(0,w.Zl)(e.fides_key),y.push({pathname:l.o5,query:{datasetId:e.fides_key}})},C=async()=>{o(!0);let e=h.current.getValue(),a=T.ZP.load(e,{json:!0}),t=await v(a);(0,f.D4)(t)?m((0,x.Vo)((0,f.e$)(t.error))):"data"in t&&_(t.data),o(!1)};return(0,s.jsxs)(r.ad9,{gap:"97px",children:[(0,s.jsxs)(r.TJV,{w:"75%",children:[(0,s.jsx)(r.TJV,{color:"gray.700",fontSize:"14px",mb:4,children:"Get started creating your first dataset by pasting your dataset yaml below! You may have received this yaml from a colleague or your Ethyca developer support engineer."}),(0,s.jsxs)(r.s_g,{align:"stretch",children:[(0,s.jsx)(r.KMv,{color:"gray.100"}),(0,s.jsx)(V.M,{defaultLanguage:"yaml",height:"calc(100vh - 515px)",onChange:e=>{try{u(!0),b(e),t(!!(!e||""===e.trim()))}catch(e){(0,V.F)(e)?j(e):g("Could not parse the supplied YAML")}},onMount:e=>{h.current=e,h.current.focus()},options:{fontFamily:"Menlo",fontSize:13,minimap:{enabled:!0}},theme:"light"}),(0,s.jsx)(r.KMv,{color:"gray.100"}),(0,s.jsx)(r.zxk,{type:"primary",disabled:a||!!p||i,loading:i,onClick:C,htmlType:"submit",className:"mt-6 w-fit",children:"Create dataset"})]})]}),(0,s.jsx)(r.TJV,{children:d&&(a||p)&&(0,s.jsx)(z.Z,{isEmptyState:a,yamlError:p})})]})},E=()=>{let[e,a]=(0,n.useState)(null);return(0,s.jsxs)(i.Z,{title:"Create New Dataset",children:[(0,s.jsx)(o.Z,{heading:"Datasets",breadcrumbItems:[{title:"All datasets",href:l.$m},{title:"Create new"}]}),(0,s.jsxs)(r.EO$,{spacing:8,children:[(0,s.jsxs)(r.TJV,{children:[(0,s.jsx)(r.zxk,{onClick:()=>a("yaml"),"data-testid":"upload-yaml-btn",className:"mr-2",children:"Upload a Dataset YAML"}),(0,s.jsx)(r.zxk,{onClick:()=>a("database"),ghost:"database"===e,className:"mr-2","data-testid":"connect-db-btn",children:"Connect to a database"})]}),"database"===e&&(0,s.jsx)(r.TJV,{w:{base:"100%",lg:"50%"},children:(0,s.jsx)(k,{})}),"yaml"===e&&(0,s.jsx)(r.TJV,{w:{base:"100%"},children:(0,s.jsx)(A,{})})]})]})}}},function(e){e.O(0,[431,6527,7245,7476,2888,9774,179],function(){return e(e.s=73846)}),_N_E=e.O()}]);