(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7888],{95372:function(e){e.exports=function(e,a,t,s){for(var i=e.length,r=t+(s?1:-1);s?r--:++r<i;)if(a(e[r],r,e))return r;return -1}},59849:function(e,a,t){"use strict";t.d(a,{Z:function(){return c}});var s=t(24246),i=t(36010),r=t(86677),n=t(88340);let l="/images/errors";var d=e=>{let{status:a}=e;return 404===a?(0,s.jsx)(i.Eep,{src:"".concat(l,"/404.svg"),alt:"Error 404",preview:!1}):500===a?(0,s.jsx)(i.Eep,{src:"".concat(l,"/500.svg"),alt:"Error 500",preview:!1}):(0,s.jsx)(i.Eep,{src:"".concat(l,"/unknown.svg"),alt:"Error Unknown",preview:!1})},o=t(812),c=e=>{let{error:a,defaultMessage:t="An unexpected error occurred.  Please try again",actions:l,showReload:c=!0}=e,u=(0,o.e$)(a,t),m="data"in a&&a.data?JSON.stringify(a.data):JSON.stringify(a),p="status"in a&&a.status?a.status:void 0,h=(0,r.useRouter)(),y=l&&l.length>0||c;return(0,s.jsx)(i.kCb,{vertical:!0,align:"center",justify:"center",className:"h-screen","data-testid":"error-page-result",children:(0,s.jsx)(i.x4B,{status:"error",icon:(0,s.jsx)(d,{status:p}),title:"Error ".concat(p),subTitle:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Typography.Paragraph,{type:"secondary",children:u}),(0,s.jsx)(i.kCb,{justify:"start",className:"max-w-96",children:(0,s.jsx)(i.UO1,{ghost:!0,size:"small",items:[{key:"1",label:"Show details",classNames:{header:"w-fit"},children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Typography.Text,{type:"secondary",children:m}),(0,s.jsx)(n.Z,{copyText:m})]})}]})})]}),extra:y&&(0,s.jsxs)(i.kCb,{gap:"small",justify:"center",children:[null==l?void 0:l.map((e,a)=>(0,s.jsx)(i.zxk,{...e,children:e.label},a)),c&&(0,s.jsx)(i.zxk,{onClick:()=>h.reload(),type:"primary",children:"Reload"})]})})})}},97181:function(e,a,t){"use strict";t.d(a,{d:function(){return o}});var s=t(24246),i=t(36010),r=t(34090),n=t(27378),l=t(46238),d=t(40324);let o=e=>{let{name:a,label:t,labelProps:o,tooltip:c,isRequired:u,layout:m="inline",helperText:p,...h}=e,[y,x,{setValue:j}]=(0,r.U$)(a),g=!!(x.touched&&x.error),[v,f]=(0,n.useState)("");y.value||"tags"!==h.mode&&"multiple"!==h.mode||(y.value=[]),"tags"===h.mode&&"string"==typeof y.value&&(y.value=[y.value]);let b="tags"===h.mode?(e,a)=>e?e.value!==v||y.value.includes(v)?h.optionRender?h.optionRender(e,a):e.label:'Create "'.concat(v,'"'):void 0:h.optionRender||void 0,_=e=>{f(e),h.onSearch&&h.onSearch(e)},k=(e,a)=>{j(e),h.onChange&&h.onChange(e,a)};return"inline"===m?(0,s.jsx)(i.DTt,{isInvalid:g,isRequired:u,children:(0,s.jsxs)(i.MoG,{templateColumns:t?"1fr 3fr":"1fr",children:[t?(0,s.jsx)(d.__,{htmlFor:h.id||a,...o,children:t}):null,(0,s.jsxs)(i.kCb,{align:"center",children:[(0,s.jsxs)(i.kCb,{vertical:!0,flex:1,className:"mr-2",children:[(0,s.jsx)(i.PhF,{...y,id:h.id||a,"data-testid":"controlled-select-".concat(y.name),...h,optionRender:b,onSearch:"tags"===h.mode?_:void 0,onChange:k,value:y.value||void 0,status:g?"error":void 0}),p&&(0,s.jsx)(i.Kug,{children:p}),(0,s.jsx)(d.Bc,{isInvalid:g,message:x.error,fieldName:y.name})]}),(0,s.jsx)(l.b,{label:c,className:g?"mt-2 self-start":void 0})]})]})}):(0,s.jsx)(i.DTt,{isInvalid:g,isRequired:u,children:(0,s.jsxs)(i.s_g,{alignItems:"start",children:[(0,s.jsxs)(i.kCb,{align:"center",children:[t?(0,s.jsx)(d.__,{htmlFor:h.id||a,fontSize:"xs",my:0,mr:1,...o,children:t}):null,(0,s.jsx)(l.b,{label:c})]}),(0,s.jsx)(i.PhF,{...y,id:h.id||a,"data-testid":"controlled-select-".concat(y.name),...h,optionRender:b,onSearch:"tags"===h.mode?_:void 0,onChange:k,value:y.value||void 0,status:g?"error":void 0}),p&&(0,s.jsx)(i.Kug,{style:{marginTop:0},children:p}),(0,s.jsx)(d.Bc,{isInvalid:g,message:x.error,fieldName:y.name})]})})}},35258:function(e,a,t){"use strict";t.d(a,{Z:function(){return F}});var s=t(24246),i=t(36010),r=t(27378),n=t(84720),l=t(52368),d=t(812),o=t(46628),c=t(65450),u=t(31883),m=t(34090),p=t(45938),h=t(33162),y=t(55484),x=t(20987),j=t(97181),g=t(40324);let v=y.Ry().shape({data_categories:y.IX(y.Z_()).min(1,"Must assign at least one data category").label("Data categories"),data_use:y.Z_().required().label("Data use"),data_subjects:y.IX(y.Z_()).min(1,"Must assign at least one data subject").label("Data subjects")}),f={data_categories:[],data_subjects:[],data_use:"",dataset_references:[],customFieldValues:{},id:""},b=e=>{var a;let{customFieldValues:t,...s}=e;return{...s,name:null!==(a=e.name)&&void 0!==a?a:""}},_=e=>{let{allDataUses:a,allDataCategories:t,allDataSubjects:r,allDatasets:n,privacyDeclarationId:l,includeCustomFields:d}=e,o=n?n.map(e=>{var a;return{label:null!==(a=e.name)&&void 0!==a?a:e.fides_key,value:e.fides_key}}):[];return(0,s.jsxs)(i.EO$,{spacing:4,children:[(0,s.jsx)(j.d,{id:"data_use",label:"Data use",name:"data_use",options:a.map(e=>({value:e.fides_key,label:e.fides_key})),tooltip:"What is the system using the data for. For example, is it for third party advertising or perhaps simply providing system operations.",layout:"stacked",disabled:!!l}),(0,s.jsx)(g.j0,{id:"name",label:"Processing Activity",name:"name",variant:"stacked",tooltip:"The personal data processing activity or activities associated with this data use.",disabled:!!l}),(0,s.jsx)(j.d,{name:"data_categories",label:"Data categories",options:t.map(e=>({value:e.fides_key,label:e.fides_key})),tooltip:"What type of data is your system processing? This could be various types of user or system data.",mode:"multiple",layout:"stacked",disabled:!0}),(0,s.jsx)(j.d,{name:"data_subjects",label:"Data subjects",options:r.map(e=>({value:e.fides_key,label:e.fides_key})),tooltip:"Whose data are you processing? This could be customers, employees or any other type of user in your system.",mode:"multiple",layout:"stacked",disabled:!0}),n?(0,s.jsx)(j.d,{name:"dataset_references",label:"Dataset references",options:o,tooltip:"Referenced Dataset fides keys used by the system.",mode:"multiple",layout:"stacked"}):null,d?(0,s.jsx)(h.uc,{resourceType:x.J.PRIVACY_DECLARATION,resourceFidesKey:l}):null]})},k=(e,a)=>e?{...e,customFieldValues:a||{}}:f,S=e=>{let{onSubmit:a,initialValues:t,allDataUses:n,privacyDeclarationId:l}=e,{customFieldValues:d,upsertCustomFields:o}=(0,h.mZ)({resourceType:x.J.PRIVACY_DECLARATION,resourceFidesKey:l}),c=(0,r.useMemo)(()=>k(t,d),[t,d]),[u,m]=(0,r.useState)(!1),p=(0,r.useMemo)(()=>{let e=n.filter(e=>e.fides_key===c.data_use)[0];if(e)return c.name?"".concat(e.name," - ").concat(c.name):e.name},[n,c]);return{handleSubmit:async(e,t)=>{let{customFieldValues:s}=e,i=b(e),r=await a(i,t);if(r){let a=r.filter(a=>a.data_use===e.data_use&&(!a.name||a.name===e.name));a.length>0&&await o({customFieldValues:s,fides_key:a[0].id}),t.resetForm({values:e}),m(!0)}},renderHeader:e=>{let{dirty:a,boxProps:t,hideSaved:r}=e;return(0,s.jsxs)(i.TJV,{display:"flex",alignItems:"center",justifyContent:"space-between",...t,children:[p?(0,s.jsx)(i.y_b,{as:"h4",size:"xs",fontWeight:"medium",mr:4,children:p}):null,!r&&u&&!a&&c.data_use?(0,s.jsxs)(i.Bjg,{fontSize:"sm","data-testid":"saved-indicator",children:[(0,s.jsx)(i.StI,{})," Saved"]}):null]})},initialValues:c}},D=e=>{let{onSubmit:a,initialValues:t,onDelete:r,...n}=e,{handleSubmit:l,renderHeader:d,initialValues:o}=S({onSubmit:a,initialValues:t,allDataUses:n.allDataUses,privacyDeclarationId:null==t?void 0:t.id});return(0,s.jsx)(m.J9,{enableReinitialize:!0,initialValues:o,onSubmit:l,validationSchema:v,children:e=>{let{dirty:a}=e;return(0,s.jsxs)(m.l0,{children:[(0,s.jsx)(p.Gt,{id:"PrivacyDeclaration",name:"New Privacy Declaration"}),(0,s.jsxs)(i.EO$,{spacing:4,children:[(0,s.jsx)(i.TJV,{"data-testid":"header",children:d({dirty:a})}),(0,s.jsx)(_,{onDelete:r,...n})]})]})}})},C=e=>{let{privacyDeclaration:a,onEdit:t,onDelete:r,includeCustomFields:n,...l}=e,{initialValues:d,renderHeader:o,handleSubmit:c}=S({initialValues:a,onSubmit:e=>t(a,e),privacyDeclarationId:a.id,...l});return(0,s.jsx)(i.nCC,{children:e=>{let{isExpanded:t}=e;return(0,s.jsx)(m.J9,{enableReinitialize:!0,initialValues:d,onSubmit:c,validationSchema:v,children:e=>{let{dirty:d}=e;return(0,s.jsxs)(m.l0,{"data-testid":"".concat(a.data_use,"-form"),children:[(0,s.jsx)(p.Gt,{id:"".concat(a.id,"-form"),name:a.id}),(0,s.jsxs)(i.rKS,{py:4,borderBottomWidth:t?"0px":"1px",backgroundColor:t?"gray.50":void 0,"data-testid":"accordion-header-".concat(a.data_use),children:[o({dirty:d,boxProps:{flex:"1",textAlign:"left"},hideSaved:!t}),(0,s.jsx)(i.UhW,{})]}),(0,s.jsx)(i.rnb,{backgroundColor:"gray.50",pt:0,children:(0,s.jsx)(i.EO$,{spacing:4,children:(0,s.jsx)(_,{privacyDeclarationId:a.id,onDelete:r,includeCustomFields:n,...l})})})]})}})}})};var w=e=>{let{privacyDeclarations:a,...t}=e;return(0,s.jsx)(i.NvE,{allowToggle:!0,border:"transparent","data-testid":"privacy-declaration-accordion",children:a.map(e=>(0,s.jsx)(C,{privacyDeclaration:e,...t},e.id))})},T=e=>{let{system:a,includeCustomFields:t,onSave:n,...l}=e,m=(0,i.p8r)(),[p]=(0,c.qQ)(),[h,y]=(0,r.useState)(!1),[x,j]=(0,r.useState)(void 0),g=(0,r.useMemo)(()=>x?a.privacy_declarations.filter(e=>e.id!==x.id):a.privacy_declarations,[x,a]),v=e=>g.filter(a=>a.data_use===e.data_use&&a.name===e.name).length>0&&(m((0,o.Vo)("A declaration already exists with that data use in this system. Please supply a different data use.")),!0),f=async(e,t)=>{let s=e.map(e=>{var a;return{...e,name:null!==(a=e.name)&&void 0!==a?a:""}}),i={...a,privacy_declarations:s};return(e=>{if((0,u.D4)(e)){let a=(0,d.e$)(e.error,"An unexpected error occurred while updating the system. Please try again.");m((0,o.Vo)(a));return}return m.closeAll(),m((0,o.t5)(t?"Data use deleted":"Data use saved")),n&&n(e.data),e.data.privacy_declarations})(await p(i))},b=async(e,t)=>{if(!(t.id!==e.id&&v(t)))return f(a.privacy_declarations.map(a=>a.id===e.id?t:a))},_=async e=>{if(v(e))return;m.closeAll();let a=[...g,e],t=await f(a);return t&&j(t.filter(a=>(!a.name||a.name===e.name)&&a.data_use===e.data_use)[0]),t},k=async e=>f(a.privacy_declarations.filter(a=>a.id!==e.id),!0),S=async e=>{let a=await k(e);return a&&(y(!1),j(void 0)),a};return(0,r.useEffect)(()=>{y(!1)},[a.fides_key]),(0,s.jsxs)(i.EO$,{spacing:3,children:[(0,s.jsx)(w,{privacyDeclarations:g,onEdit:b,onDelete:k,includeCustomFields:t,...l}),h?(0,s.jsx)(i.TJV,{backgroundColor:"gray.50",p:4,"data-testid":"new-declaration-form",children:(0,s.jsx)(D,{initialValues:x,onSubmit:_,onDelete:S,includeCustomFields:t,...l})}):null,0===a.privacy_declarations.length?(0,s.jsx)(i.Bjg,{fontSize:"sm",lineHeight:5,fontWeight:"medium",pl:2,children:"No data uses"}):null]})},V=t(19043);let I=e=>{let[a]=(0,c.dB)(),t=(0,i.p8r)();return{handleUpsertSystem:async(s,i)=>{let r=[{...e,name:s.name,description:s.description}],n=await a(r);(0,V.D4)(n)?t((0,o.Vo)((0,d.e$)(n.error))):(t((0,o.t5)("Successfully saved system info")),i.resetForm({values:s}))},validationSchema:y.Ry().shape({name:y.Z_().required().label("Name"),description:y.Z_().required().label("Description")})}},R={name:"",description:""};var E=e=>{let{system:a}=e,t="/systems/configure/".concat(a.fides_key),{handleUpsertSystem:r,validationSchema:n}=I(a);return(0,s.jsxs)(i.TJV,{children:[(0,s.jsxs)(i.ad9,{alignItems:"center",children:[(0,s.jsx)(i.Bjg,{color:"gray.600",size:"md",lineHeight:6,fontWeight:"semibold",marginBottom:2,children:"System details"}),(0,s.jsx)(i.s3C,{}),(0,s.jsxs)(i._pl,{color:"complimentary.500",href:t,children:["View more",(0,s.jsx)(i.Cgm,{ml:2})]})]}),(0,s.jsx)(i.TJV,{width:"100%",padding:4,borderTop:"1px solid",borderColor:"gray.200",children:(0,s.jsx)(m.J9,{enableReinitialize:!0,initialValues:null!=a?a:R,validationSchema:n,onSubmit:r,children:()=>(0,s.jsxs)(m.l0,{children:[(0,s.jsx)(p.Gt,{id:"SystemInfoDrawer",name:"System Info"}),(0,s.jsx)(i.TJV,{marginTop:3,children:(0,s.jsx)(g.j0,{label:"System name",name:"name",variant:"stacked",disabled:!0})}),(0,s.jsx)(i.TJV,{marginTop:3,children:(0,s.jsx)(g.Ks,{label:"System description",name:"description",variant:"stacked",disabled:!0})})]})})})]})},F=e=>{var a;let{selectedSystemId:t,resetSelectedSystemId:d}=e,o=(0,r.useMemo)(()=>!!t,[t]),{...u}=(0,l.f)({includeDatasets:!1,includeDisabled:!1}),{data:m,isLoading:p}=(0,c.rn)(t,{skip:!t});return(0,s.jsx)(i.dys,{open:o,onClose:d,placement:"right",width:480,title:null!==(a=null==m?void 0:m.name)&&void 0!==a?a:"System Information",loading:p,children:m?(0,s.jsxs)("div",{"data-testid":"datamap-drawer",children:[(0,s.jsx)(E,{system:m}),(0,s.jsx)(i.Bjg,{size:"md",color:"gray.600",lineHeight:6,fontWeight:"semibold",mt:"10px",mb:2,children:"Data uses"}),(0,s.jsx)(i.TJV,{borderTop:"1px solid",borderColor:"gray.200",children:(0,s.jsx)(i.TJV,{pb:3,children:(0,s.jsx)(T,{system:m,...u})})}),(0,s.jsx)(i.Bjg,{size:"md",color:"gray.600",lineHeight:6,fontWeight:"semibold",mt:"10px",mb:2,paddingBottom:2,children:"Data flow"}),(0,s.jsx)(n.q,{system:m})]}):null})}},57072:function(e,a,t){"use strict";t.d(a,{Bd:function(){return s.Bd},L5:function(){return s.L5},MO:function(){return s.MO},qb:function(){return s.qb}});var s=t(5785)}}]);