(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3377],{49819:function(e,i,s){var t=s(18911)();e.exports=t},26194:function(e,i,s){var t=s(49819),a=s(50098);e.exports=function(e,i){return e&&t(e,i,a)}},18911:function(e){e.exports=function(e){return function(i,s,t){for(var a=-1,r=Object(i),n=t(i),l=n.length;l--;){var o=n[e?l:++a];if(!1===s(r[o],o,r))break}return i}}},56141:function(e,i,s){var t=s(32866);e.exports=function(e,i){return t(e,i)}},92465:function(e){e.exports=function(e){return void 0===e}},25389:function(e,i,s){var t=s(88799),a=s(26194),r=s(89278);e.exports=function(e,i){var s={};return i=r(i,3),a(e,function(e,a,r){t(s,a,i(e,a,r))}),s}},9799:function(e){e.exports=function(e){if("function"!=typeof e)throw TypeError("Expected a function");return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}},15539:function(e,i,s){var t=s(89278),a=s(9799),r=s(71975);e.exports=function(e,i){return r(e,a(t(i)))}},77213:function(e,i,s){"use strict";s.d(i,{Z:function(){return f}});var t=s(24246),a=s(36010),r=s(88038),n=s.n(r),l=s(86677);s(27378);var o=s(25980),d=s(90867),c=s(42478),u=s(77830),m=()=>{let e=(0,l.useRouter)();return(0,t.jsx)(a.TJV,{bg:"gray.50",border:"1px solid",borderColor:"blue.400",borderRadius:"md",justifyContent:"space-between",p:5,mb:5,mt:5,children:(0,t.jsxs)(a.TJV,{children:[(0,t.jsxs)(a.EO$,{direction:{base:"column",sm:"row"},justifyContent:"space-between",children:[(0,t.jsx)(a.Bjg,{fontWeight:"semibold",children:"Configure your storage and messaging provider"}),(0,t.jsx)(a.zxk,{onClick:()=>{e.push(u.AD)},children:"Configure"})]}),(0,t.jsxs)(a.Bjg,{children:["Before Fides can process your privacy requests we need two simple steps to configure your storage and email client."," "]})]})})},f=e=>{let{children:i,title:s,padded:r=!0,mainProps:u}=e,f=(0,o.hz)(),g=(0,l.useRouter)(),y="/privacy-requests"===g.pathname||"/datastore-connection"===g.pathname,h=!(f.flags.messagingConfiguration&&y),{data:p}=(0,c.JE)(void 0,{skip:h}),{data:_}=(0,d.PW)(void 0,{skip:h}),x=f.flags.messagingConfiguration&&(!p||!_)&&y;return(0,t.jsxs)(a.ad9,{"data-testid":s,direction:"column",h:"100vh",children:[(0,t.jsxs)(n(),{children:[(0,t.jsxs)("title",{children:["Fides Admin UI - ",s]}),(0,t.jsx)("meta",{name:"description",content:"Privacy Engineering Platform"}),(0,t.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,t.jsxs)(a.ad9,{as:"main",direction:"column",py:r?6:0,px:r?10:0,h:r?"calc(100% - 48px)":"full",flex:1,minWidth:0,overflow:"auto",...u,children:[x?(0,t.jsx)(m,{}):null,i]})]})}},90980:function(e,i,s){"use strict";s.d(i,{R:function(){return o}});var t=s(24246),a=s(36010),r=s(79894),n=s.n(r),l=s(63662);let o=e=>{let{onClick:i,...s}=e;return(0,t.jsxs)(a.ad9,{alignItems:"center",mt:-4,mb:3,onClick:i,cursor:"pointer",...s,children:[(0,t.jsx)(a.zxk,{"aria-label":"Back",icon:(0,t.jsx)(a.Ta$,{}),className:"mr-2",size:"small"}),(0,t.jsx)(a.Bjg,{as:"a",fontSize:"sm",fontWeight:"500",children:"Back"})]})};i.Z=e=>{let{backPath:i,...s}=e,r=(0,l.useRouter)();return(0,t.jsxs)(a.ad9,{alignItems:"center",mb:6,...s,children:[(0,t.jsx)(a.zxk,{onClick:()=>r.push(i),"aria-label":"Back",icon:(0,t.jsx)(a.Ta$,{}),className:"mr-2",size:"small"}),(0,t.jsx)(a.Bjg,{as:n(),href:i,tabIndex:-1,fontSize:"sm",fontWeight:"500",children:"Back"})]})}},10792:function(e,i,s){"use strict";s.d(i,{Z:function(){return B}});var t=s(24246),a=s(36010),r=s(27378),n=s(17245),l=s(90710),o=s(51980),d=s(90104),c=s.n(d),u=s(56141),m=s.n(u),f=s(92465),g=s.n(f),y=s(25389),h=s.n(y),p=s(15539),_=s.n(p),x=s(86677),v=s(812),w=s(77830),j=s(17828),k=s(42478);let b=e=>{let{serviceType:i,isOpen:s,onClose:n}=e,[o]=(0,k.SU)(),[d,c]=(0,r.useState)(!1),[u]=a.l09.useForm(),m=(0,a.UD8)(),f=i===l.q.twilio_text,g=e=>{let i="An unexpected error occurred. Please try again.";return(0,v.Ot)(e)?i=e.data.detail:(0,v.tB)(e)&&(i=e.data.detail[0].msg),i},y=async e=>{c(!0);try{let s=await o({service_type:i,details:{to_identity:f?{phone_number:e.phone}:{email:e.email}}});(0,v.D4)(s)?m.error(g(s.error)):(m.success("Test message sent successfully!"),n())}catch(e){m.error(g(e))}finally{c(!1)}},h=f?"SMS":"email",p=()=>{n()};return(0,t.jsx)(a.u_l,{title:"Test ".concat(h),open:s,onCancel:p,footer:null,children:(0,t.jsx)(a.s_g,{spacing:4,children:(0,t.jsxs)(a.l09,{form:u,onFinish:y,layout:"vertical",style:{width:"100%"},children:[f?(0,t.jsx)(a.l09.Item,{name:"phone",label:"Phone number",rules:[{required:!0,message:"Phone number is required"},{pattern:/^\+?[1-9]\d{1,14}$/,message:"Please enter a valid phone number"}],children:(0,t.jsx)(a.IIB,{placeholder:"+1234567890"})}):(0,t.jsx)(a.l09.Item,{name:"email",label:"Email address",rules:[{required:!0,message:"Email address is required"},{type:"email",message:"Please enter a valid email address"}],children:(0,t.jsx)(a.IIB,{placeholder:"test@example.com"})}),(0,t.jsx)(a.l09.Item,{style:{marginBottom:0,marginTop:24},children:(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[(0,t.jsx)(a.zxk,{onClick:p,disabled:d,children:"Cancel"}),(0,t.jsx)(a.zxk,{type:"primary",htmlType:"submit",loading:d,"data-testid":"send-test-message-btn",children:d?"Sending...":"Send test ".concat(h)})]})})]})})})},V=()=>{let[e]=(0,k.SU)(),[i,s]=(0,r.useState)(!1),[t,n]=(0,r.useState)({}),o=(0,a.UD8)(),d=e=>{let i="An unexpected error occurred. Please try again.";return(0,v.Ot)(e)?i=e.data.detail:(0,v.tB)(e)&&(i=e.data.detail[0].msg),i};return{verifyConfiguration:async i=>{s(!0);try{let s=i===l.q.twilio_text,t=await e({service_type:i,details:{to_identity:s?{phone_number:"+15551234567"}:{email:"test@example.com"}}});if((0,v.D4)(t)){o.error(d(t.error));let e=new Date().toISOString();return n(s=>({...s,[i]:{timestamp:e,success:!1}})),!1}o.success("Configuration verified successfully!");let a=new Date().toISOString();return n(e=>({...e,[i]:{timestamp:a,success:!0}})),!0}catch(e){return o.error(d(e)),!1}finally{s(!1)}},isVerifying:i,isConfigurationVerified:e=>{var i;return!!(null===(i=t[e])||void 0===i?void 0:i.success)},getVerificationData:e=>t[e]}};var S=e=>{var i,s,d;let{configKey:u}=e,f=(0,x.useRouter)(),{handleError:y}=(0,n.HK)(),{verifyConfiguration:p,isVerifying:S,getVerificationData:C}=V(),I=(0,a.UD8)(),q=!!u,[T,D]=(0,r.useState)(!1),[B,E]=(0,r.useState)(!1),[A,P]=(0,r.useState)(q?"**********":"secret_keys"),[z]=a.l09.useForm(),[M]=(0,k.h9)(),[J]=(0,k.sn)(),[F]=(0,k.Ki)(),{data:W,refetch:N}=(0,k.FU)({key:u},{skip:!u}),R={email_from:(null==W?void 0:null===(i=W.details)||void 0===i?void 0:i.email_from)||"",domain:(null==W?void 0:null===(s=W.details)||void 0===s?void 0:s.domain)||"",aws_region:(null==W?void 0:null===(d=W.details)||void 0===d?void 0:d.aws_region)||"",auth_method:q?"**********":"secret_keys",aws_access_key_id:q?"**********":"",aws_secret_access_key:q?"**********":"",aws_assume_role_arn:q?"**********":""};(0,r.useEffect)(()=>{if(W){var e,i,s;let t={email_from:(null===(e=W.details)||void 0===e?void 0:e.email_from)||"",domain:(null===(i=W.details)||void 0===i?void 0:i.domain)||"",aws_region:(null===(s=W.details)||void 0===s?void 0:s.aws_region)||"",auth_method:"**********",aws_access_key_id:"**********",aws_secret_access_key:"**********",aws_assume_role_arn:"**********"};z.setFieldsValue(t),P("**********"),E(!1)}},[W,z]);let O=(()=>{let e=C(l.q.aws_ses);if(e){if(!e.success)return{isVerified:!1,status:"Verify configuration"};let i=new Date(e.timestamp),s=(0,o.B)(i,new Date,{addSuffix:!0});return{isVerified:!0,status:"Verified ".concat(s),timestamp:e.timestamp}}if(W){let{last_test_succeeded:e,last_test_timestamp:i}=W;if(i){let s=new Date(i),t=(0,o.B)(s,new Date,{addSuffix:!0});return{isVerified:e,status:e?"Verified ".concat(t):"Verify configuration",timestamp:i}}}let i=f.query.last_test_succeeded,s=f.query.last_test_timestamp;if(s){let e="true"===i||"1"===i,t=new Date(s),a=(0,o.B)(t,new Date,{addSuffix:!0});return{isVerified:e,status:e?"Verified ".concat(a):"Verify configuration",timestamp:s}}return{isVerified:!1,status:"Verify configuration"}})(),U=e=>_()(h()(e,e=>q&&"**********"===e?void 0:e),g()),K=(0,r.useCallback)(()=>{let e=z.getFieldsValue(),i=e.email_from,{domain:s}=e,t=i&&""!==i.trim(),a=s&&""!==s.trim();return t||a?Promise.resolve():Promise.reject(Error("Either email from or domain must be provided"))},[z]),L=async e=>{try{var i,s,t,a;if(q&&u){let a=[],r=(null==W?void 0:null===(i=W.details)||void 0===i?void 0:i.email_from)||"",n=(null==W?void 0:null===(s=W.details)||void 0===s?void 0:s.domain)||"",o=(null==W?void 0:null===(t=W.details)||void 0===t?void 0:t.aws_region)||"";(e.email_from!==r||e.domain!==n||e.aws_region!==o)&&a.push(J({key:u,config:{key:(null==W?void 0:W.key)||u,name:null==W?void 0:W.name,service_type:(null==W?void 0:W.service_type)||l.q.aws_ses,details:{...null==W?void 0:W.details,email_from:e.email_from||null,domain:e.domain||null,aws_region:e.aws_region}}}));let d={auth_method:e.auth_method,aws_access_key_id:e.aws_access_key_id,aws_secret_access_key:e.aws_secret_access_key,aws_assume_role_arn:e.aws_assume_role_arn},m=U(d);if(c()(m)||a.push(F({key:u,secrets:m})),0===a.length){I.info("No changes to save.");return}let f=await Promise.all(a);if(f.some(e=>(0,v.D4)(e))){let e=f.find(e=>(0,v.D4)(e));y(null==e?void 0:e.error)}else I.success("AWS SES configuration successfully updated."),E(!1),N&&N()}else{let i={service_type:l.q.aws_ses,details:{email_from:e.email_from||null,domain:e.domain||null,aws_region:e.aws_region},secrets:{auth_method:e.auth_method,aws_access_key_id:e.aws_access_key_id,aws_secret_access_key:e.aws_secret_access_key,aws_assume_role_arn:e.aws_assume_role_arn}},s=await M(i);if((0,v.D4)(s))y(s.error);else{I.success("AWS SES configuration successfully created."),E(!1);let e=null===(a=s.data)||void 0===a?void 0:a.key;if(e){let i=w.GE.replace("[key]",e);f.push(i)}else f.push(w.AD)}}}catch(e){y(e)}},Z=async()=>{try{await p(l.q.aws_ses)&&N&&setTimeout(()=>{N()},500)}catch(e){y(e)}},$=()=>{z.validateFields(["email_from","domain"]).catch(()=>{})};return(0,t.jsxs)(a.TJV,{position:"relative",children:[(0,t.jsx)(a.l09,{form:z,layout:"vertical",initialValues:R,onFinish:L,onValuesChange:(e,i)=>{let s={...i},t={...R};q&&Object.keys(s).forEach(e=>{"**********"===s[e]&&(s[e]=t[e])}),void 0!==e.auth_method&&(P(e.auth_method),"automatic"===e.auth_method&&z.setFieldsValue({aws_access_key_id:"",aws_secret_access_key:""})),E(!m()(s,t))},children:(0,t.jsxs)(a.TJV,{maxWidth:"720px",border:"1px",borderColor:"gray.200",borderRadius:6,overflow:"visible",mt:6,children:[(0,t.jsx)(a.TJV,{backgroundColor:"gray.50",px:6,py:4,display:"flex",flexDirection:"row",alignItems:"center",borderBottom:"1px",borderColor:"gray.200",borderTopRadius:6,children:(0,t.jsxs)(a.Br$,{children:[(0,t.jsx)(j.Z,{}),(0,t.jsx)(a.y_b,{as:"h3",size:"xs",children:"AWS SES email messaging configuration"})]})}),(0,t.jsxs)(a.TJV,{px:6,py:6,children:[(0,t.jsx)(a.l09.Item,{name:"email_from",label:"Email from",rules:[{validator:K}],style:{marginBottom:24},children:(0,t.jsx)(a.IIB,{placeholder:q?"Enter new email from":"Enter email from",onChange:()=>$()})}),(0,t.jsx)(a.l09.Item,{name:"domain",label:"Domain",rules:[{validator:K}],style:{marginBottom:24},children:(0,t.jsx)(a.IIB,{placeholder:q?"Enter new domain":"Enter domain",onChange:()=>$()})}),(0,t.jsx)(a.l09.Item,{name:"aws_region",label:"AWS region",rules:[{required:!0,message:"AWS region is required"}],style:{marginBottom:24},children:(0,t.jsx)(a.IIB,{placeholder:q?"Enter new AWS region":"Enter AWS region (e.g., us-east-1)"})}),(0,t.jsx)(a.l09.Item,{name:"auth_method",label:"Authentication method",rules:[{required:!0,message:"Authentication method is required"}],style:{marginBottom:24},children:(0,t.jsx)(a.PhF,{placeholder:"Select authentication method",options:[{label:"Secret keys",value:"secret_keys"},{label:"Automatic",value:"automatic"}]})}),("secret_keys"===A||q&&"**********"===A)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.l09.Item,{name:"aws_access_key_id",label:"AWS access key ID",rules:"secret_keys"===A||q&&"**********"===A?[{required:!0,message:"AWS access key ID is required for secret keys authentication"}]:[],style:{marginBottom:24},children:(0,t.jsx)(a.IIB.Password,{placeholder:q?"Enter new AWS access key ID":"Enter AWS access key ID"})}),(0,t.jsx)(a.l09.Item,{name:"aws_secret_access_key",label:"AWS secret access key",rules:"secret_keys"===A||q&&"**********"===A?[{required:!0,message:"AWS secret access key is required for secret keys authentication"}]:[],style:{marginBottom:24},children:(0,t.jsx)(a.IIB.Password,{placeholder:q?"Enter new AWS secret access key":"Enter AWS secret access key"})})]}),(0,t.jsx)(a.l09.Item,{name:"aws_assume_role_arn",label:"AWS assume role ARN",children:(0,t.jsx)(a.IIB.Password,{placeholder:q?"Enter new AWS assume role ARN":"Enter AWS assume role ARN (optional)"})}),(0,t.jsxs)(a.TJV,{mt:6,className:"flex justify-between",children:[(0,t.jsx)(a.TJV,{children:q&&O.isVerified&&(0,t.jsx)(a.zxk,{type:"default",onClick:()=>D(!0),"data-testid":"send-test-message-btn",children:"Send test email"})}),(0,t.jsxs)(a.TJV,{className:"flex",children:[q?(0,t.jsx)(a.zxk,{onClick:Z,className:"mr-2","data-testid":"test-btn",loading:S,icon:O.isVerified&&!S?(0,t.jsx)(a.StI,{}):void 0,children:S?"Verifying":O.isVerified?"Verified":O.status}):(0,t.jsx)(a.zxk,{onClick:()=>f.push(w.AD),className:"mr-2",children:"Cancel"}),(0,t.jsx)(a.zxk,{htmlType:"submit",type:"primary","data-testid":"save-btn",disabled:!B,children:"Save"})]})]})]})]})}),(0,t.jsx)(b,{serviceType:l.q.aws_ses,isOpen:T,onClose:()=>D(!1)})]})},C=s(44907),I=e=>{var i;let{configKey:s}=e,d=(0,x.useRouter)(),{handleError:u}=(0,n.HK)(),{verifyConfiguration:f,isVerifying:y,getVerificationData:p}=V(),[j,S]=(0,r.useState)(!1),[I,q]=(0,r.useState)(!1),[T]=a.l09.useForm(),[D]=(0,k.h9)(),[B]=(0,k.sn)(),[E]=(0,k.Ki)(),A=(0,a.UD8)(),P=!!s,{data:z,refetch:M}=(0,k.FU)({key:s},{skip:!s}),J={domain:(null==z?void 0:null===(i=z.details)||void 0===i?void 0:i.domain)||"",mailgun_api_key:P?"**********":""};(0,r.useEffect)(()=>{if(z){var e;let i={domain:(null===(e=z.details)||void 0===e?void 0:e.domain)||"",mailgun_api_key:"**********"};T.setFieldsValue(i),q(!1)}},[z,T]);let F=(()=>{let e=p(l.q.mailgun);if(e){if(!e.success)return{isVerified:!1,status:"Verify configuration"};let i=new Date(e.timestamp),s=(0,o.B)(i,new Date,{addSuffix:!0});return{isVerified:!0,status:"Verified ".concat(s),timestamp:e.timestamp}}if(z){let{last_test_succeeded:e,last_test_timestamp:i}=z;if(i){let s=new Date(i),t=(0,o.B)(s,new Date,{addSuffix:!0});return{isVerified:e,status:e?"Verified ".concat(t):"Verify configuration",timestamp:i}}}let i=d.query.last_test_succeeded,s=d.query.last_test_timestamp;if(s){let e="true"===i||"1"===i,t=new Date(s),a=(0,o.B)(t,new Date,{addSuffix:!0});return{isVerified:e,status:e?"Verified ".concat(a):"Verify configuration",timestamp:s}}return{isVerified:!1,status:"Verify configuration"}})(),W=e=>_()(h()(e,e=>P&&"**********"===e?void 0:e),g()),N=async e=>{try{var i,t;if(P&&s){let t=[],a=(null==z?void 0:null===(i=z.details)||void 0===i?void 0:i.domain)||"";e.domain!==a&&""!==e.domain.trim()&&t.push(B({key:s,config:{key:(null==z?void 0:z.key)||s,name:null==z?void 0:z.name,service_type:(null==z?void 0:z.service_type)||l.q.mailgun,details:{...null==z?void 0:z.details,is_eu_domain:"false",domain:e.domain}}}));let r=W({mailgun_api_key:e.mailgun_api_key});if(c()(r)||t.push(E({key:s,secrets:r})),0===t.length){A.info("No changes to save.");return}let n=await Promise.all(t);if(n.some(e=>(0,v.D4)(e))){let e=n.find(e=>(0,v.D4)(e));u(null==e?void 0:e.error)}else A.success("Mailgun configuration successfully updated."),q(!1),M&&M()}else{let i={service_type:l.q.mailgun,details:{is_eu_domain:"false",domain:e.domain},secrets:{mailgun_api_key:e.mailgun_api_key}},s=await D(i);if((0,v.D4)(s))u(s.error);else{A.success("Mailgun configuration successfully created."),q(!1);let e=null===(t=s.data)||void 0===t?void 0:t.key;if(e){let i=w.GE.replace("[key]",e);d.push(i)}else d.push(w.AD)}}}catch(e){u(e)}},R=async()=>{try{await f(l.q.mailgun)&&M&&setTimeout(()=>{M()},500)}catch(e){u(e)}};return(0,t.jsxs)(a.TJV,{position:"relative",children:[(0,t.jsx)(a.l09,{form:T,layout:"vertical",initialValues:J,onFinish:N,onValuesChange:(e,i)=>{let s={...i},t={...J};P&&"**********"===s.mailgun_api_key&&(s.mailgun_api_key=t.mailgun_api_key),q(!m()(s,t))},children:(0,t.jsxs)(a.TJV,{maxWidth:"720px",border:"1px",borderColor:"gray.200",borderRadius:6,overflow:"visible",mt:6,children:[(0,t.jsx)(a.TJV,{backgroundColor:"gray.50",px:6,py:4,display:"flex",flexDirection:"row",alignItems:"center",borderBottom:"1px",borderColor:"gray.200",borderTopRadius:6,children:(0,t.jsxs)(a.Br$,{children:[(0,t.jsx)(C.Z,{}),(0,t.jsx)(a.y_b,{as:"h3",size:"xs",children:"Mailgun email messaging configuration"})]})}),(0,t.jsxs)(a.TJV,{px:6,py:6,children:[(0,t.jsx)(a.l09.Item,{name:"domain",label:"Domain",rules:[{required:!0,message:"Domain is required"},{type:"string",min:1,message:"Domain cannot be empty"}],style:{marginBottom:24},children:(0,t.jsx)(a.IIB,{placeholder:P?"Enter new domain":"Enter domain"})}),(0,t.jsx)(a.l09.Item,{name:"mailgun_api_key",label:"API key",rules:[{required:!0,message:"API key is required"},{type:"string",min:1,message:"API key cannot be empty"}],children:(0,t.jsx)(a.IIB.Password,{placeholder:P?"Enter new API key":"Enter API key"})}),(0,t.jsxs)(a.TJV,{mt:6,className:"flex justify-between",children:[(0,t.jsx)(a.TJV,{children:P&&F.isVerified&&(0,t.jsx)(a.zxk,{type:"default",onClick:()=>S(!0),"data-testid":"send-test-message-btn",children:"Send test email"})}),(0,t.jsxs)(a.TJV,{className:"flex",children:[P?(0,t.jsx)(a.zxk,{onClick:R,className:"mr-2","data-testid":"test-btn",loading:y,icon:F.isVerified&&!y?(0,t.jsx)(a.StI,{}):void 0,children:y?"Verifying":F.isVerified?"Verified":F.status}):(0,t.jsx)(a.zxk,{onClick:()=>d.push(w.AD),className:"mr-2",children:"Cancel"}),(0,t.jsx)(a.zxk,{htmlType:"submit",type:"primary","data-testid":"save-btn",disabled:!I,children:"Save"})]})]})]})]})}),(0,t.jsx)(b,{serviceType:l.q.mailgun,isOpen:j,onClose:()=>S(!1)})]})},q=s(5144),T=e=>{var i;let{configKey:s}=e,d=(0,x.useRouter)(),{handleError:u}=(0,n.HK)(),{verifyConfiguration:f,isVerifying:y,getVerificationData:p}=V(),[j,S]=(0,r.useState)(!1),[C,I]=(0,r.useState)(!1),[T]=a.l09.useForm(),D=(0,a.UD8)(),[B]=(0,k.h9)(),[E]=(0,k.sn)(),[A]=(0,k.Ki)(),P=!!s,{data:z,refetch:M}=(0,k.FU)({key:s},{skip:!s}),J={email:(null==z?void 0:null===(i=z.details)||void 0===i?void 0:i.twilio_email_from)||"",twilio_api_key:P?"**********":""};(0,r.useEffect)(()=>{if(z){var e;let i={email:(null===(e=z.details)||void 0===e?void 0:e.twilio_email_from)||"",twilio_api_key:"**********"};T.setFieldsValue(i),I(!1)}},[z,T]);let F=(()=>{let e=p(l.q.twilio_email);if(e){if(!e.success)return{isVerified:!1,status:"Verify configuration"};let i=new Date(e.timestamp),s=(0,o.B)(i,new Date,{addSuffix:!0});return{isVerified:!0,status:"Verified ".concat(s),timestamp:e.timestamp}}if(z){let{last_test_succeeded:e,last_test_timestamp:i}=z;if(i){let s=new Date(i),t=(0,o.B)(s,new Date,{addSuffix:!0});return{isVerified:e,status:e?"Verified ".concat(t):"Verify configuration",timestamp:i}}}let i=d.query.last_test_succeeded,s=d.query.last_test_timestamp;if(s){let e="true"===i||"1"===i,t=new Date(s),a=(0,o.B)(t,new Date,{addSuffix:!0});return{isVerified:e,status:e?"Verified ".concat(a):"Verify configuration",timestamp:s}}return{isVerified:!1,status:"Verify configuration"}})(),W=e=>_()(h()(e,e=>P&&"**********"===e?void 0:e),g()),N=async e=>{try{var i,t;if(P&&s){let t=[],a=(null==z?void 0:null===(i=z.details)||void 0===i?void 0:i.twilio_email_from)||"";e.email!==a&&""!==e.email.trim()&&t.push(E({key:s,config:{key:(null==z?void 0:z.key)||s,name:null==z?void 0:z.name,service_type:(null==z?void 0:z.service_type)||l.q.twilio_email,details:{...null==z?void 0:z.details,twilio_email_from:e.email}}}));let r=W({twilio_api_key:e.twilio_api_key});if(c()(r)||t.push(A({key:s,secrets:r})),0===t.length){D.info("No changes to save.");return}let n=await Promise.all(t);if(n.some(e=>(0,v.D4)(e))){let e=n.find(e=>(0,v.D4)(e));u(null==e?void 0:e.error)}else D.success("Twilio email configuration successfully updated."),I(!1),M&&M()}else{let i={service_type:l.q.twilio_email,details:{twilio_email_from:e.email},secrets:{twilio_api_key:e.twilio_api_key}},s=await B(i);if((0,v.D4)(s))u(s.error);else{D.success("Twilio email configuration successfully created."),I(!1);let e=null===(t=s.data)||void 0===t?void 0:t.key;if(e){let i=w.GE.replace("[key]",e);d.push(i)}else d.push(w.AD)}}}catch(e){u(e)}},R=async()=>{try{await f(l.q.twilio_email)&&M&&setTimeout(()=>{M()},500)}catch(e){u(e)}};return(0,t.jsxs)(a.TJV,{position:"relative",children:[(0,t.jsx)(a.l09,{form:T,layout:"vertical",initialValues:J,onFinish:N,onValuesChange:(e,i)=>{let s={...i},t={...J};P&&"**********"===s.twilio_api_key&&(s.twilio_api_key=t.twilio_api_key),I(!m()(s,t))},children:(0,t.jsxs)(a.TJV,{maxWidth:"720px",border:"1px",borderColor:"gray.200",borderRadius:6,overflow:"visible",mt:6,children:[(0,t.jsx)(a.TJV,{backgroundColor:"gray.50",px:6,py:4,display:"flex",flexDirection:"row",alignItems:"center",borderBottom:"1px",borderColor:"gray.200",borderTopRadius:6,children:(0,t.jsxs)(a.Br$,{children:[(0,t.jsx)(q.Z,{}),(0,t.jsx)(a.y_b,{as:"h3",size:"xs",children:"Twilio email messaging configuration"})]})}),(0,t.jsxs)(a.TJV,{px:6,py:6,children:[(0,t.jsx)(a.l09.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"},{type:"email",message:"Please enter a valid email"}],style:{marginBottom:24},children:(0,t.jsx)(a.IIB,{placeholder:P?"Enter new email":"Enter email"})}),(0,t.jsx)(a.l09.Item,{name:"twilio_api_key",label:"API key",rules:[{required:!0,message:"API key is required"},{type:"string",min:1,message:"API key cannot be empty"}],children:(0,t.jsx)(a.IIB.Password,{placeholder:P?"Enter new API key":"Enter API key"})}),(0,t.jsxs)(a.TJV,{mt:6,className:"flex justify-between",children:[(0,t.jsx)(a.TJV,{children:P&&F.isVerified&&(0,t.jsx)(a.zxk,{type:"default",onClick:()=>S(!0),"data-testid":"send-test-message-btn",children:"Send test email"})}),(0,t.jsxs)(a.TJV,{className:"flex",children:[P?(0,t.jsx)(a.zxk,{onClick:R,className:"mr-2","data-testid":"test-btn",loading:y,icon:F.isVerified&&!y?(0,t.jsx)(a.StI,{}):void 0,children:y?"Verifying":F.isVerified?"Verified":F.status}):(0,t.jsx)(a.zxk,{onClick:()=>d.push(w.AD),className:"mr-2",children:"Cancel"}),(0,t.jsx)(a.zxk,{htmlType:"submit",type:"primary","data-testid":"save-btn",disabled:!C,children:"Save"})]})]})]})]})}),(0,t.jsx)(b,{serviceType:l.q.twilio_email,isOpen:j,onClose:()=>S(!1)})]})},D=e=>{let{configKey:i}=e,s=(0,x.useRouter)(),{verifyConfiguration:n,isVerifying:d,getVerificationData:u}=V(),[f,y]=(0,r.useState)(!1),[p,j]=(0,r.useState)(!1),[S]=a.l09.useForm(),C=(0,a.UD8)(),[I]=(0,k.h9)(),[T]=(0,k.Ki)(),D=!!i,{data:B,refetch:E}=(0,k.FU)({key:i},{skip:!i}),A={account_sid:D?"**********":"",auth_token:D?"**********":"",messaging_service_sid:D?"**********":"",phone:D?"**********":""};(0,r.useEffect)(()=>{B&&(S.setFieldsValue({account_sid:"**********",auth_token:"**********",messaging_service_sid:"**********",phone:"**********"}),j(!1))},[B,S]);let P=(()=>{let e=u(l.q.twilio_text);if(e){if(!e.success)return{isVerified:!1,status:"Verify configuration"};let i=new Date(e.timestamp),s=(0,o.B)(i,new Date,{addSuffix:!0});return{isVerified:!0,status:"Verified ".concat(s),timestamp:e.timestamp}}if(B){let{last_test_succeeded:e,last_test_timestamp:i}=B;if(i){let s=new Date(i),t=(0,o.B)(s,new Date,{addSuffix:!0});return{isVerified:e,status:e?"Verified ".concat(t):"Verify configuration",timestamp:i}}}let i=s.query.last_test_succeeded,t=s.query.last_test_timestamp;if(t){let e="true"===i||"1"===i,s=new Date(t),a=(0,o.B)(s,new Date,{addSuffix:!0});return{isVerified:e,status:e?"Verified ".concat(a):"Verify configuration",timestamp:t}}return{isVerified:!1,status:"Verify configuration"}})(),z=e=>_()(h()(e,e=>D&&"**********"===e?void 0:e),g()),M=e=>{let i="An unexpected error occurred. Please try again.";return(0,v.Ot)(e)?i=e.data.detail:(0,v.tB)(e)&&(i=e.data.detail[0].msg),i},J=(0,r.useCallback)(()=>{let e=S.getFieldsValue(),i=e.messaging_service_sid,s=e.phone,t=i&&""!==i.trim()&&"**********"!==i,a=s&&""!==s.trim()&&"**********"!==s;return t||a?Promise.resolve():Promise.reject(Error("Either messaging service SID or phone number must be provided"))},[S]),F=async e=>{try{if(D&&i){let s={twilio_account_sid:e.account_sid,twilio_auth_token:e.auth_token,twilio_messaging_service_sid:e.messaging_service_sid,twilio_sender_phone_number:e.phone},t=z(s);if(c()(t)){C.info("No changes to save.");return}let a=await T({key:i,secrets:t});(0,v.D4)(a)?C.error(M(a.error)):(C.success("Twilio SMS configuration successfully updated."),j(!1),E&&E())}else{let i={service_type:l.q.twilio_text,secrets:{twilio_account_sid:e.account_sid,twilio_auth_token:e.auth_token,twilio_messaging_service_sid:e.messaging_service_sid,twilio_sender_phone_number:e.phone}},a=await I(i);if((0,v.D4)(a))C.error(M(a.error));else{var t;C.success("Twilio SMS configuration successfully created."),j(!1);let e=null===(t=a.data)||void 0===t?void 0:t.key;if(e){let i=w.GE.replace("[key]",e);s.push(i)}else s.push(w.AD)}}}catch(e){C.error("An unexpected error occurred. Please try again.")}},W=async()=>{try{await n(l.q.twilio_text)&&E&&setTimeout(()=>{E()},500)}catch(e){C.error("An unexpected error occurred during verification.")}},N=()=>{S.validateFields(["messaging_service_sid","phone"]).catch(()=>{})};return(0,t.jsxs)(a.TJV,{position:"relative",children:[(0,t.jsx)(a.l09,{form:S,layout:"vertical",initialValues:A,onFinish:F,onValuesChange:(e,i)=>{let s={...i},t={...A};D&&Object.keys(s).forEach(e=>{"**********"===s[e]&&(s[e]=t[e])}),j(!m()(s,t))},children:(0,t.jsxs)(a.TJV,{maxWidth:"720px",border:"1px",borderColor:"gray.200",borderRadius:6,overflow:"visible",mt:6,children:[(0,t.jsx)(a.TJV,{backgroundColor:"gray.50",px:6,py:4,display:"flex",flexDirection:"row",alignItems:"center",borderBottom:"1px",borderColor:"gray.200",borderTopRadius:6,children:(0,t.jsxs)(a.Br$,{children:[(0,t.jsx)(q.Z,{}),(0,t.jsx)(a.y_b,{as:"h3",size:"xs",children:"Twilio SMS messaging configuration"})]})}),(0,t.jsxs)(a.TJV,{px:6,py:6,children:[(0,t.jsx)(a.l09.Item,{name:"account_sid",label:"Account SID",rules:[{required:!0,message:"Account SID is required"},{type:"string",min:1,message:"Account SID cannot be empty"}],style:{marginBottom:24},children:(0,t.jsx)(a.IIB.Password,{placeholder:D?"Enter new account SID":"Enter account SID"})}),(0,t.jsx)(a.l09.Item,{name:"auth_token",label:"Auth token",rules:[{required:!0,message:"Auth token is required"},{type:"string",min:1,message:"Auth token cannot be empty"}],style:{marginBottom:24},children:(0,t.jsx)(a.IIB.Password,{placeholder:D?"Enter new auth token":"Enter auth token"})}),(0,t.jsx)(a.l09.Item,{name:"messaging_service_sid",label:"Messaging service SID",rules:[{validator:J}],style:{marginBottom:24},children:(0,t.jsx)(a.IIB.Password,{placeholder:D?"Enter new messaging service SID":"Enter messaging service SID",onChange:()=>N()})}),(0,t.jsx)(a.l09.Item,{name:"phone",label:"Phone number",rules:[{validator:J}],children:(0,t.jsx)(a.IIB.Password,{placeholder:D?"Enter new phone number":"Enter phone number",onChange:()=>N()})}),(0,t.jsxs)(a.TJV,{mt:6,className:"flex justify-between",children:[(0,t.jsx)(a.TJV,{children:D&&P.isVerified&&(0,t.jsx)(a.zxk,{type:"default",onClick:()=>y(!0),"data-testid":"send-test-message-btn",children:"Send test SMS"})}),(0,t.jsxs)(a.TJV,{className:"flex",children:[D?(0,t.jsx)(a.zxk,{onClick:W,className:"mr-2","data-testid":"test-btn",loading:d,icon:P.isVerified&&!d?(0,t.jsx)(a.StI,{}):void 0,children:d?"Verifying":P.isVerified?"Verified":P.status}):(0,t.jsx)(a.zxk,{onClick:()=>s.push(w.AD),className:"mr-2",children:"Cancel"}),(0,t.jsx)(a.zxk,{htmlType:"submit",type:"primary","data-testid":"save-btn",disabled:!p,children:"Save"})]})]})]})]})}),(0,t.jsx)(b,{serviceType:l.q.twilio_text,isOpen:f,onClose:()=>y(!1)})]})},B=e=>{let{configKey:i,initialProviderType:s}=e,[o,d]=(0,r.useState)(s||""),c=!!i,{handleError:u}=(0,n.HK)(),{data:m,isLoading:f,error:g}=(0,k.FU)({key:i},{skip:!i}),{data:y}=(0,k.qt)();(0,r.useEffect)(()=>{c&&(null==m?void 0:m.service_type)&&d(m.service_type)},[c,null==m?void 0:m.service_type]),(0,r.useEffect)(()=>{g&&u(g)},[g,u]);let h=(0,r.useMemo)(()=>{var e;let i=new Set((null==y?void 0:null===(e=y.items)||void 0===e?void 0:e.map(e=>e.service_type))||[]),s=!c&&i.has(l.q.mailgun),t=!c&&i.has(l.q.twilio_email),a=!c&&i.has(l.q.twilio_text),r=!c&&i.has(l.q.aws_ses);return[{value:l.q.mailgun,label:l.k.mailgun,disabled:s,title:s?"Only one messaging provider of each type can be created":void 0},{value:l.q.twilio_email,label:l.k.twilio_email,disabled:t,title:t?"Only one messaging provider of each type can be created":void 0},{value:l.q.twilio_text,label:l.k.twilio_text,disabled:a,title:a?"Only one messaging provider of each type can be created":void 0},{value:l.q.aws_ses,label:l.k.aws_ses,disabled:r,title:r?"Only one messaging provider of each type can be created":void 0}]},[y,c]);return c&&f?(0,t.jsx)(a.TJV,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:(0,t.jsx)(a.Y6B,{})}):!c||m||f?(0,t.jsxs)(a.TJV,{children:[!c&&(0,t.jsxs)(a.TJV,{maxWidth:"720px",border:"1px",borderColor:"gray.200",borderRadius:6,overflow:"visible",mt:6,mb:4,children:[(0,t.jsx)(a.TJV,{backgroundColor:"gray.50",px:6,py:4,display:"flex",flexDirection:"row",alignItems:"center",borderBottom:"1px",borderColor:"gray.200",borderTopRadius:6,children:(0,t.jsx)(a.y_b,{as:"h3",size:"xs",children:"Select messaging provider"})}),(0,t.jsx)(a.TJV,{px:6,py:6,children:(0,t.jsx)(a.l09,{layout:"vertical",children:(0,t.jsx)(a.l09.Item,{label:"Provider type",name:"provider_type",rules:[{required:!0,message:"Please select a provider type"}],children:(0,t.jsx)(a.PhF,{placeholder:"Choose a messaging provider...","aria-label":"Select a messaging provider",value:o||void 0,onChange:e=>d(e),options:h})})})})]}),o&&(()=>{switch(o){case l.q.mailgun:return(0,t.jsx)(I,{configKey:i});case l.q.twilio_email:return(0,t.jsx)(T,{configKey:i});case l.q.twilio_text:return(0,t.jsx)(D,{configKey:i});case l.q.aws_ses:return(0,t.jsx)(S,{configKey:i});default:return null}})()]}):(0,t.jsx)(a.TJV,{children:(0,t.jsxs)(a.Bjg,{color:"red.500",children:["Messaging configuration not found for key: ",i]})})}},90710:function(e,i,s){"use strict";s.d(i,{k:function(){return a},q:function(){return t}});let t={mailgun:"mailgun",twilio_email:"twilio_email",twilio_text:"twilio_text",aws_ses:"aws_ses"},a={mailgun:"Mailgun email",twilio_email:"Twilio email",twilio_text:"Twilio SMS",aws_ses:"AWS SES email"}},17828:function(e,i,s){"use strict";var t=s(24246);s(27378),i.Z=()=>(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 74.375 85",width:"20",height:"20",fill:"#fff",fillRule:"evenodd",stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,t.jsx)("use",{xlinkHref:"#A",x:"2.188",y:"2.5"}),(0,t.jsx)("symbol",{id:"A",overflow:"visible",children:(0,t.jsxs)("g",{stroke:"none",children:[(0,t.jsx)("path",{d:"M16.558 12.75L0 38.591l16.558 25.841 13.227-3.324.654-44.869-13.881-3.489z",fill:"#876929"}),(0,t.jsx)("path",{d:"M35.049 59.786l-18.491 4.645V12.75l18.491 4.645v42.391z",fill:"#d9a741"}),(0,t.jsxs)("g",{fill:"#876929",children:[(0,t.jsx)("path",{d:"M32.849 21.614L35.05 80 70 62.867l-.01-43.615-8.914 1.448-28.228.913z"}),(0,t.jsx)("path",{d:"M46.184 33.149l10.906-.632 10.778-19.164L40.612 0 30.439 4.364l15.745 28.785z"})]}),(0,t.jsx)("path",{d:"M40.612 0l27.256 13.353-10.778 19.164L40.612 0z",fill:"#d9a741"}),(0,t.jsx)("path",{d:"M35.049 5.539L57.09 44.742l3.788 22.595L35.049 80l-10.46-5.131V9.64l10.45-4.101h.01z",fill:"#876929"}),(0,t.jsx)("path",{d:"M69.991 19.251L70 62.867 35.05 80V5.539l22.041 39.203 12.899-25.491z",fill:"#d9a741"})]})})]})},44907:function(e,i,s){"use strict";var t=s(24246);s(27378),i.Z=()=>(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",preserveAspectRatio:"xMidYMid",viewBox:"-0.5 0 257 257",children:(0,t.jsx)("path",{fill:"#C02428",d:"M128.418 80.526c-26.51 0-48.884 21.475-48.884 48.728a48.197 48.197 0 0014.187 34.579 48.532 48.532 0 0034.697 14.14c26.511 0 48.875-21.476 48.875-48.719 0-27.253-22.364-48.728-48.875-48.728zm-76.22 47.895c0-41.285 33.968-75.138 75.395-75.138 41.417 0 75.385 33.853 75.385 75.138 0 2.478 0 5.788-.825 8.266-.835 7.422 4.972 13.2 12.43 13.2 12.43 0 14.08-15.678 14.08-21.466 0-55.328-45.573-100.746-101.07-100.746-55.518 0-101.07 45.418-101.07 100.746 0 55.339 45.552 100.747 101.07 100.747 29.822 0 56.333-12.388 74.56-33.03l20.703 17.342c-22.364 26.43-57.158 42.952-94.448 42.952-34.097.105-66.827-13.35-90.932-37.384C13.37 195.016-.118 162.392 0 128.411 0 58.228 57.159.432 128.418.432 198.832.432 256 58.238 256 128.432c0 28.075-13.256 51.205-40.591 51.205-11.605 0-19.053-5.787-23.2-11.565-13.255 21.476-37.29 35.508-64.626 35.508-20.017.068-39.234-7.827-53.388-21.933a74.755 74.755 0 01-22.008-53.205l.01-.02zm76.21-22.297c12.43 0 22.374 9.91 22.374 22.297 0 12.388-9.944 22.298-22.364 22.298a22.322 22.322 0 01-15.848-6.504 22.169 22.169 0 01-6.526-15.794c0-12.387 9.944-22.297 22.374-22.297h-.01z"})})},5144:function(e,i,s){"use strict";var t=s(24246);i.Z=()=>(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",preserveAspectRatio:"xMidYMid",viewBox:"0 0 256 256",children:(0,t.jsx)("path",{fill:"#F12E45",d:"M128 0c70.656 0 128 57.344 128 128s-57.344 128-128 128S0 198.656 0 128 57.344 0 128 0zm0 33.792c-52.224 0-94.208 41.984-94.208 94.208S75.776 222.208 128 222.208s94.208-41.984 94.208-94.208S180.224 33.792 128 33.792zm31.744 99.328c14.704 0 26.624 11.92 26.624 26.624 0 14.704-11.92 26.624-26.624 26.624-14.704 0-26.624-11.92-26.624-26.624 0-14.704 11.92-26.624 26.624-26.624zm-63.488 0c14.704 0 26.624 11.92 26.624 26.624 0 14.704-11.92 26.624-26.624 26.624-14.704 0-26.624-11.92-26.624-26.624 0-14.704 11.92-26.624 26.624-26.624zm63.488-63.488c14.704 0 26.624 11.92 26.624 26.624 0 14.704-11.92 26.624-26.624 26.624-14.704 0-26.624-11.92-26.624-26.624 0-14.704 11.92-26.624 26.624-26.624zm-63.488 0c14.704 0 26.624 11.92 26.624 26.624 0 14.704-11.92 26.624-26.624 26.624-14.704 0-26.624-11.92-26.624-26.624 0-14.704 11.92-26.624 26.624-26.624z"})})},42478:function(e,i,s){"use strict";s.d(i,{FU:function(){return d},JE:function(){return a},Ki:function(){return u},SU:function(){return m},W:function(){return f},h9:function(){return r},jc:function(){return t},qt:function(){return o},sn:function(){return c}});let{useGetEmailInviteStatusQuery:t,useGetActiveMessagingProviderQuery:a,useCreateMessagingConfigurationMutation:r,useCreateMessagingConfigurationSecretsMutation:n,useGetMessagingConfigurationDetailsQuery:l,useGetMessagingConfigurationsQuery:o,useGetMessagingConfigurationByKeyQuery:d,useUpdateMessagingConfigurationByKeyMutation:c,useUpdateMessagingConfigurationSecretsByKeyMutation:u,useCreateTestConnectionMessageMutation:m,useDeleteMessagingConfigurationByKeyMutation:f}=s(78780).u.injectEndpoints({endpoints:e=>({getEmailInviteStatus:e.query({query:()=>({url:"/messaging/email-invite/status"}),providesTags:()=>["Email Invite Status"]}),createMessagingConfiguration:e.mutation({query:e=>({url:"messaging/config",method:"POST",body:e}),invalidatesTags:["Messaging Config","Configuration Settings"]}),getActiveMessagingProvider:e.query({queryFn:async(e,i,s,t)=>{let a=await t({url:"messaging/default/active"});return a.error&&404===a.error.status?{data:null}:a},providesTags:["Messaging Config"]}),createMessagingConfigurationSecrets:e.mutation({query:e=>({url:"messaging/default/".concat(e.service_type,"/secret"),method:"PUT",body:e.details}),invalidatesTags:["Messaging Config","Configuration Settings"]}),getMessagingConfigurationDetails:e.query({query:e=>({url:"messaging/default/".concat(e.type)}),providesTags:["Messaging Config"]}),getMessagingConfigurations:e.query({query:()=>({url:"messaging/config"}),providesTags:["Messaging Config"]}),getMessagingConfigurationByKey:e.query({query:e=>({url:"messaging/config/".concat(e.key)}),providesTags:["Messaging Config"]}),createTestConnectionMessage:e.mutation({query:e=>({url:"messaging/test/".concat(e.service_type),method:"POST",body:e.details}),invalidatesTags:["Messaging Config"]}),updateMessagingConfigurationByKey:e.mutation({query:e=>({url:"messaging/config/".concat(e.key),method:"PATCH",body:e.config}),invalidatesTags:["Messaging Config","Configuration Settings"]}),updateMessagingConfigurationSecretsByKey:e.mutation({query:e=>({url:"messaging/config/".concat(e.key,"/secret"),method:"PUT",body:e.secrets}),invalidatesTags:["Messaging Config","Configuration Settings"]}),deleteMessagingConfigurationByKey:e.mutation({query:e=>({url:"messaging/config/".concat(e.key),method:"DELETE"}),invalidatesTags:["Messaging Config","Configuration Settings"]})})})}}]);