# ==============================================================================
# Sisyphus API Engine - 输出格式配置测试
# ==============================================================================
# 功能说明：演示各种输出报告格式的配置
# - Allure报告格式
# - JUnit报告格式
# - HTML报告格式
# - JSON输出格式
# - CSV导出格式
# ==============================================================================

name: "输出格式配置测试"
description: "演示Allure/JUnit/HTML/JSON/CSV输出格式的配置"

config:
  name: "输出格式配置"
  timeout: 30

  # ========================================================================
  # 输出配置
  # ========================================================================
  output:
    # 输出目录
    dir: "results"

    # 输出格式（可选值：json/allure/junit/html/csv）
    formats:
      - json      # JSON格式（默认）
      - allure    # Allure测试报告
      - junit     # JUnit XML格式
      - html      # HTML测试报告
      - csv       # CSV数据导出

    # JSON输出配置
    json:
      # 是否美化输出
      pretty: true
      # 是否包含性能指标
      include_performance: true
      # 是否包含请求/响应详情
      include_details: true

    # Allure报告配置
    allure:
      # 报告目录
      dir: "allure-results"
      # 是否包含步骤详情
      include_steps: true
      # 是否包含附件
      include_attachments: true
      # 是否包含性能数据
      include_performance: true

    # JUnit报告配置
    junit:
      # 输出文件名
      filename: "junit-results.xml"
      # 是否包含失败的测试用例
      include_failures: true
      # 是否包含跳过的测试用例
      include_skipped: true

    # HTML报告配置
    html:
      # 报告目录
      dir: "html-report"
      # 报告标题
      title: "API测试报告"
      # 主题（可选值：light/dark）
      theme: "light"

    # CSV导出配置
    csv:
      # 输出文件名
      filename: "test-results.csv"
      # 包含的字段
      fields:
        - test_case_name
        - status
        - duration
        - error_message
        - start_time
        - end_time

  profiles:
    prod:
      base_url: "https://httpbin.org"

# ============================================================================
# 测试步骤
# ============================================================================
steps:
  # ----------------------------------------------------------------------------
  # 步骤1: 演示JSON输出格式
  # 用途：说明JSON输出的配置和格式
  # ----------------------------------------------------------------------------
  - name: "JSON输出格式演示"
    description: "演示JSON输出格式的配置"
    type: request
    method: GET
    url: "${config.profiles.prod.base_url}/get"
    validations:
      - type: status_code
        path: "$.status_code"
        expect: "200"
        description: "验证状态码为200"

  # ----------------------------------------------------------------------------
  # 步骤2: 演示Allure报告配置
  # 用途：说明Allure报告的配置项
  # ----------------------------------------------------------------------------
  - name: "Allure报告配置演示"
    description: "演示Allure测试报告的配置"
    type: request
    method: POST
    url: "${config.profiles.prod.base_url}/post"
    headers:
      Content-Type: "application/json"
    body:
      test_name: "Allure报告测试"
      report_format: "allure"
      features:
        - 测试用例详情
        - 步骤执行记录
        - 性能指标
        - 失败截图
        - 附件支持
    validations:
      - type: status_code
        path: "$.status_code"
        expect: "200"
        description: "验证状态码为200"
      - type: eq
        path: "$.json.report_format"
        expect: "allure"
        description: "验证报告格式"

  # ----------------------------------------------------------------------------
  # 步骤3: 演示JUnit报告配置
  # 用途：说明JUnit XML报告的配置项
  # ----------------------------------------------------------------------------
  - name: "JUnit报告配置演示"
    description: "演示JUnit XML报告的配置"
    type: request
    method: POST
    url: "${config.profiles.prod.base_url}/post"
    headers:
      Content-Type: "application/json"
    body:
      report_format: "junit"
      output_file: "junit-results.xml"
      features:
        - XML格式输出
        - 测试套件组织
        - 失败详情
        - 跳过记录
        - 执行时间统计
    validations:
      - type: status_code
        path: "$.status_code"
        expect: "200"
        description: "验证状态码为200"

  # ----------------------------------------------------------------------------
  # 步骤4: 演示HTML报告配置
  # 用途：说明HTML报告的配置项
  # ----------------------------------------------------------------------------
  - name: "HTML报告配置演示"
    description: "演示HTML测试报告的配置"
    type: request
    method: POST
    url: "${config.profiles.prod.base_url}/post"
    headers:
      Content-Type: "application/json"
    body:
      report_format: "html"
      theme: "light"
      features:
        - 可视化仪表板
        - 测试趋势图表
        - 详细执行日志
        - 失败用例高亮
        - 性能指标展示
    validations:
      - type: status_code
        path: "$.status_code"
        expect: "200"
        description: "验证状态码为200"

  # ----------------------------------------------------------------------------
  # 步骤5: 演示CSV导出配置
  # 用途：说明CSV数据导出的配置项
  # ----------------------------------------------------------------------------
  - name: "CSV导出配置演示"
    description: "演示CSV数据导出的配置"
    type: request
    method: POST
    url: "${config.profiles.prod.base_url}/post"
    headers:
      Content-Type: "application/json"
    body:
      export_format: "csv"
      filename: "test-results.csv"
      delimiter: ","
      fields:
        - test_case_name
        - status
        - duration
        - start_time
        - error_message
      features:
        - 表格数据导出
        - 自定义字段选择
        - 数据筛选和排序
        - 兼容Excel打开
    validations:
      - type: status_code
        path: "$.status_code"
        expect: "200"
        description: "验证状态码为200"
      - type: eq
        path: "$.json.export_format"
        expect: "csv"
        description: "验证导出格式"

  # ----------------------------------------------------------------------------
  # 步骤6: 综合输出格式示例
  # 用途：演示同时使用多种输出格式
  # ----------------------------------------------------------------------------
  - name: "综合输出格式配置"
    description: "演示配置多种输出格式"
    type: request
    method: POST
    url: "${config.profiles.prod.base_url}/post"
    headers:
      Content-Type: "application/json"
    body:
      test_name: "综合输出测试"
      output_formats:
        - json: "用于程序解析和数据处理"
        - allure: "用于生成可视化测试报告"
        - junit: "用于CI/CD集成"
        - html: "用于人工查看测试结果"
        - csv: "用于数据分析和报表"
      configuration_example:
        command: "sisyphus-api-engine --cases test.yaml -o result.json --format allure,junit,html"
        output_files:
          - "result.json"
          - "allure-results/"
          - "junit-results.xml"
          - "html-report/"
    validations:
      - type: status_code
        path: "$.status_code"
        expect: "200"
        description: "验证状态码为200"
      - type: length_eq
        path: "$.json.output_formats"
        expect: 5
        description: "验证配置了5种输出格式"

# ============================================================================
# 标签
# ============================================================================
tags:
  - "输出格式"
  - "报告"
  - "allure"
  - "junit"
  - "html"
  - "csv"

enabled: true
