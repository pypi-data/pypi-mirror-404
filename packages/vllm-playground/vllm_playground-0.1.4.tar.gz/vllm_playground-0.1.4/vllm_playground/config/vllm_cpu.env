# vLLM CPU Configuration for Apple Silicon (macOS)
# Based on: https://docs.vllm.ai/en/stable/getting_started/installation/cpu.html

# KV Cache Space (in GB) - Start with conservative value for stability
# Default is 4, you can increase to 40 for better performance if you have enough RAM
export VLLM_CPU_KVCACHE_SPACE=4

# CPU Thread Binding - 'auto' is recommended for most cases
# This optimizes OpenMP thread binding to CPU cores
export VLLM_CPU_OMP_THREADS_BIND=auto

# Force CPU target device (required for CPU backend)
export VLLM_TARGET_DEVICE=cpu

# Disable V1 engine (required for CPU/ARM in vLLM 0.11.0+)
# V1 has assertion errors and limited ARM/CPU support
export VLLM_USE_V1=1

# Optional: Number of reserved CPUs for vLLM frontend (recommended when serving)
# Uncomment if you want to manually reserve CPU cores
# export VLLM_CPU_NUM_OF_RESERVED_CPU=1

# Optional: Disable certain CPU optimizations if they cause issues on Apple Silicon
# Uncomment these if you experience segmentation faults or initialization failures
export VLLM_CPU_MOE_PREPACK=0
export VLLM_CPU_SGL_KERNEL=0
