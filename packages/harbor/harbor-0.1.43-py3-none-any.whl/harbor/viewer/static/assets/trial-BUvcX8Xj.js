import{b as g,t as e,R as _,x as Be,B as Ke,v as ze,A as X}from"./index-CYR-HZan.js";import{c as W,l as ge,k as oe,P as B,m as ve,n as Ue,o as be,H as We,p as P,d as Ge,u as $,B as Qe,a as Je,b as K,q as Z,r as ee,e as Ye,L as S,I as Xe,f as he,J as ye,K as Ze,M as Ne,N as et,O as tt,Q as st}from"./api-BgrBwReI.js";import{t as z,u as nt}from"./index-JVv6katd.js";import{g as rt,E as L,a as E,b as O,c as F,d as V,u as ot}from"./empty-TlmgxYvO.js";import{m as at,T as ae,a as ie,b as M,c as R,F as it,D as lt,d as ct,e as dt,f as ut,g as xt,h as mt,L as ht,S as pt,i as ft,j as jt,k as gt,l as te}from"./tabs-DnzvJY73.js";import{u as Ce}from"./index-DvJT0nJi.js";import{b as vt}from"./scroll-area-Bnf4hdko.js";import{C as T,B as pe}from"./code-block-CUSGUC3x.js";import"./mutation--h5hHClj.js";const bt=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],yt=W("route",bt);const Nt=[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]],_e=W("scroll-text",Nt);const Ct=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],_t=W("terminal",Ct);const wt=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],kt=W("triangle-alert",wt);var G="Collapsible",[Tt,we]=ge(G),[St,le]=Tt(G),ke=g.forwardRef((t,n)=>{const{__scopeCollapsible:s,open:r,defaultOpen:a,disabled:o,onOpenChange:i,...u}=t,[m,h]=oe({prop:r,defaultProp:a??!1,onChange:i,caller:G});return e.jsx(St,{scope:s,disabled:o,contentId:Ce(),open:m,onOpenToggle:g.useCallback(()=>h(d=>!d),[h]),children:e.jsx(B.div,{"data-state":de(m),"data-disabled":o?"":void 0,...u,ref:n})})});ke.displayName=G;var Te="CollapsibleTrigger",Se=g.forwardRef((t,n)=>{const{__scopeCollapsible:s,...r}=t,a=le(Te,s);return e.jsx(B.button,{type:"button","aria-controls":a.contentId,"aria-expanded":a.open||!1,"data-state":de(a.open),"data-disabled":a.disabled?"":void 0,disabled:a.disabled,...r,ref:n,onClick:ve(t.onClick,a.onOpenToggle)})});Se.displayName=Te;var ce="CollapsibleContent",Ae=g.forwardRef((t,n)=>{const{forceMount:s,...r}=t,a=le(ce,t.__scopeCollapsible);return e.jsx(Ue,{present:s||a.open,children:({present:o})=>e.jsx(At,{...r,ref:n,present:o})})});Ae.displayName=ce;var At=g.forwardRef((t,n)=>{const{__scopeCollapsible:s,present:r,children:a,...o}=t,i=le(ce,s),[u,m]=g.useState(r),h=g.useRef(null),d=be(n,h),j=g.useRef(0),p=j.current,f=g.useRef(0),v=f.current,b=i.open||u,x=g.useRef(b),l=g.useRef(void 0);return g.useEffect(()=>{const c=requestAnimationFrame(()=>x.current=!1);return()=>cancelAnimationFrame(c)},[]),We(()=>{const c=h.current;if(c){l.current=l.current||{transitionDuration:c.style.transitionDuration,animationName:c.style.animationName},c.style.transitionDuration="0s",c.style.animationName="none";const C=c.getBoundingClientRect();j.current=C.height,f.current=C.width,x.current||(c.style.transitionDuration=l.current.transitionDuration,c.style.animationName=l.current.animationName),m(r)}},[i.open,r]),e.jsx(B.div,{"data-state":de(i.open),"data-disabled":i.disabled?"":void 0,id:i.contentId,hidden:!b,...o,ref:d,style:{"--radix-collapsible-content-height":p?`${p}px`:void 0,"--radix-collapsible-content-width":v?`${v}px`:void 0,...t.style},children:b&&a})});function de(t){return t?"open":"closed"}var It=ke,Mt=Se,Rt=Ae,A="Accordion",$t=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[ue,Pt,Dt]=at(A),[Q]=ge(A,[Dt,we]),xe=we(),Ie=_.forwardRef((t,n)=>{const{type:s,...r}=t,a=r,o=r;return e.jsx(ue.Provider,{scope:t.__scopeAccordion,children:s==="multiple"?e.jsx(Ft,{...o,ref:n}):e.jsx(Ot,{...a,ref:n})})});Ie.displayName=A;var[Me,Lt]=Q(A),[Re,Et]=Q(A,{collapsible:!1}),Ot=_.forwardRef((t,n)=>{const{value:s,defaultValue:r,onValueChange:a=()=>{},collapsible:o=!1,...i}=t,[u,m]=oe({prop:s,defaultProp:r??"",onChange:a,caller:A});return e.jsx(Me,{scope:t.__scopeAccordion,value:_.useMemo(()=>u?[u]:[],[u]),onItemOpen:m,onItemClose:_.useCallback(()=>o&&m(""),[o,m]),children:e.jsx(Re,{scope:t.__scopeAccordion,collapsible:o,children:e.jsx($e,{...i,ref:n})})})}),Ft=_.forwardRef((t,n)=>{const{value:s,defaultValue:r,onValueChange:a=()=>{},...o}=t,[i,u]=oe({prop:s,defaultProp:r??[],onChange:a,caller:A}),m=_.useCallback(d=>u((j=[])=>[...j,d]),[u]),h=_.useCallback(d=>u((j=[])=>j.filter(p=>p!==d)),[u]);return e.jsx(Me,{scope:t.__scopeAccordion,value:i,onItemOpen:m,onItemClose:h,children:e.jsx(Re,{scope:t.__scopeAccordion,collapsible:!0,children:e.jsx($e,{...o,ref:n})})})}),[Vt,J]=Q(A),$e=_.forwardRef((t,n)=>{const{__scopeAccordion:s,disabled:r,dir:a,orientation:o="vertical",...i}=t,u=_.useRef(null),m=be(u,n),h=Pt(s),j=vt(a)==="ltr",p=ve(t.onKeyDown,f=>{if(!$t.includes(f.key))return;const v=f.target,b=h().filter(Y=>!Y.ref.current?.disabled),x=b.findIndex(Y=>Y.ref.current===v),l=b.length;if(x===-1)return;f.preventDefault();let c=x;const C=0,I=l-1,H=()=>{c=x+1,c>I&&(c=C)},q=()=>{c=x-1,c<C&&(c=I)};switch(f.key){case"Home":c=C;break;case"End":c=I;break;case"ArrowRight":o==="horizontal"&&(j?H():q());break;case"ArrowDown":o==="vertical"&&H();break;case"ArrowLeft":o==="horizontal"&&(j?q():H());break;case"ArrowUp":o==="vertical"&&q();break}const qe=c%l;b[qe].ref.current?.focus()});return e.jsx(Vt,{scope:s,disabled:r,direction:a,orientation:o,children:e.jsx(ue.Slot,{scope:s,children:e.jsx(B.div,{...i,"data-orientation":o,ref:m,onKeyDown:r?void 0:p})})})}),U="AccordionItem",[Ht,me]=Q(U),Pe=_.forwardRef((t,n)=>{const{__scopeAccordion:s,value:r,...a}=t,o=J(U,s),i=Lt(U,s),u=xe(s),m=Ce(),h=r&&i.value.includes(r)||!1,d=o.disabled||t.disabled;return e.jsx(Ht,{scope:s,open:h,disabled:d,triggerId:m,children:e.jsx(It,{"data-orientation":o.orientation,"data-state":Ve(h),...u,...a,ref:n,disabled:d,open:h,onOpenChange:j=>{j?i.onItemOpen(r):i.onItemClose(r)}})})});Pe.displayName=U;var De="AccordionHeader",Le=_.forwardRef((t,n)=>{const{__scopeAccordion:s,...r}=t,a=J(A,s),o=me(De,s);return e.jsx(B.h3,{"data-orientation":a.orientation,"data-state":Ve(o.open),"data-disabled":o.disabled?"":void 0,...r,ref:n})});Le.displayName=De;var ne="AccordionTrigger",Ee=_.forwardRef((t,n)=>{const{__scopeAccordion:s,...r}=t,a=J(A,s),o=me(ne,s),i=Et(ne,s),u=xe(s);return e.jsx(ue.ItemSlot,{scope:s,children:e.jsx(Mt,{"aria-disabled":o.open&&!i.collapsible||void 0,"data-orientation":a.orientation,id:o.triggerId,...u,...r,ref:n})})});Ee.displayName=ne;var Oe="AccordionContent",Fe=_.forwardRef((t,n)=>{const{__scopeAccordion:s,...r}=t,a=J(A,s),o=me(Oe,s),i=xe(s);return e.jsx(Rt,{role:"region","aria-labelledby":o.triggerId,"data-orientation":a.orientation,...i,...r,ref:n,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...t.style}})});Fe.displayName=Oe;function Ve(t){return t?"open":"closed"}var qt=Ie,Bt=Pe,Kt=Le,zt=Ee,Ut=Fe;function Wt({...t}){return e.jsx(qt,{"data-slot":"accordion",...t})}function Gt({className:t,...n}){return e.jsx(Bt,{"data-slot":"accordion-item",className:P("border-b last:border-b-0",t),...n})}function Qt({className:t,children:n,...s}){return e.jsx(Kt,{className:"flex min-w-0",children:e.jsxs(zt,{"data-slot":"accordion-trigger",className:P("group focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 min-w-0 items-start justify-between gap-4 rounded-md py-4 text-left text-sm transition-all outline-none focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",t),...s,children:[n,e.jsx(rt,{className:"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200"})]})})}function Jt({className:t,children:n,...s}){return e.jsx(Ut,{"data-slot":"accordion-content",className:"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm",...s,children:e.jsx("div",{className:P("pt-0 pb-4",t),children:n})})}function y({className:t,...n}){return e.jsx("div",{"data-slot":"card",className:P("bg-card text-card-foreground flex flex-col gap-6 border py-6",t),...n})}function w({className:t,...n}){return e.jsx("div",{"data-slot":"card-header",className:P("flex flex-col gap-1.5 px-6",t),...n})}function k({className:t,...n}){return e.jsx("div",{"data-slot":"card-title",className:P("leading-none font-semibold",t),...n})}function N({className:t,...n}){return e.jsx("div",{"data-slot":"card-content",className:P("px-6",t),...n})}function Yt(t){return t?new Date(t).toLocaleString():"-"}function He(t,n){if(!t)return"-";const s=new Date(t).getTime(),a=(n?new Date(n).getTime():Date.now())-s,o=Math.floor(a/1e3),i=Math.floor(o/60),u=Math.floor(i/60);return u>0?`${u}h ${i%60}m ${o%60}s`:i>0?`${i}m ${o%60}s`:`${o}s`}function Xt(t){if(!t?.started_at)return 0;const n=new Date(t.started_at).getTime();return(t.finished_at?new Date(t.finished_at).getTime():Date.now())-n}function Zt({segments:t,totalLabel:n}){const[s,r]=g.useState(null),[a,o]=g.useState(0),i=t.reduce((x,l)=>x+l.value,0);if(i===0)return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-8 bg-muted"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"No token data"})]});const u=1,m=t.map(x=>x.value>0?x.value/i*100:0),h=m.map(x=>x>0&&x<u),d=h.reduce((x,l,c)=>l?x+(u-m[c]):x,0),j=m.reduce((x,l,c)=>!h[c]&&l>0?x+l:x,0),p=j>0?(j-d)/j:1,f=m.map((x,l)=>x===0?0:h[l]?u:x*p),v=[];let b=0;for(let x=0;x<f.length;x++)v.push(b),b+=f[x];return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[s!==null&&e.jsx("div",{className:"absolute bottom-full mb-2 z-10 -translate-x-1/2 pointer-events-none",style:{left:`${a}%`},children:e.jsxs("div",{className:"bg-popover border border-border rounded-md shadow-md px-3 py-2 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium",children:t[s].label}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t[s].value.toLocaleString()," tokens"]})]})}),e.jsx("div",{className:"flex h-8 overflow-hidden",children:t.map((x,l)=>{if(x.value===0)return null;const c=f[l],C=s!==null&&s!==l,I=v[l]+c/2;return e.jsx("div",{className:"transition-opacity duration-150",style:{width:`${c}%`,backgroundColor:x.color,opacity:C?.3:1},onMouseEnter:()=>{r(l),o(I)},onMouseLeave:()=>r(null)},x.label)})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-4",children:t.map((x,l)=>{if(x.value===0)return null;const c=h[l];return e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-sm",style:{backgroundColor:x.color}}),e.jsxs("span",{className:"text-muted-foreground",children:[x.label,c&&" (scaled)"]})]},x.label)})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:n})]})]})}function es({phases:t,totalDuration:n}){const[s,r]=g.useState(null),[a,o]=g.useState(0),i=t.map(l=>Xt(l.timing)),u=i.reduce((l,c)=>l+c,0);if(u===0)return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-8 bg-muted rounded"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"No timing data"})]});const m=1,h=i.map(l=>l>0?l/u*100:0),d=h.map(l=>l>0&&l<m),j=d.reduce((l,c,C)=>c?l+(m-h[C]):l,0),p=h.reduce((l,c,C)=>!d[C]&&c>0?l+c:l,0),f=p>0?(p-j)/p:1,v=h.map((l,c)=>l===0?0:d[c]?m:l*f),b=[];let x=0;for(let l=0;l<v.length;l++)b.push(x),x+=v[l];return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[s!==null&&e.jsx("div",{className:"absolute bottom-full mb-2 z-10 -translate-x-1/2 pointer-events-none",style:{left:`${a}%`},children:e.jsxs("div",{className:"bg-popover border border-border rounded-md shadow-md px-3 py-2 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium",children:t[s].label}),e.jsx("div",{className:"text-sm text-muted-foreground",children:He(t[s].timing?.started_at??null,t[s].timing?.finished_at??null)})]})}),e.jsx("div",{className:"flex h-8 overflow-hidden",children:t.map((l,c)=>{if(i[c]===0)return null;const I=v[c],H=s!==null&&s!==c,q=b[c]+I/2;return e.jsx("div",{className:"transition-opacity duration-150",style:{width:`${I}%`,backgroundColor:l.color,opacity:H?.3:1},onMouseEnter:()=>{r(c),o(q)},onMouseLeave:()=>r(null)},l.label)})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-4",children:t.map((l,c)=>{if(i[c]===0)return null;const I=d[c];return e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-sm",style:{backgroundColor:l.color}}),e.jsxs("span",{className:"text-muted-foreground",children:[l.label,I&&" (scaled)"]})]},l.label)})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:n})]})]})}function se({label:t,value:n,className:s,showBorder:r=!0}){return e.jsxs("div",{className:`flex justify-between py-1 text-sm ${r?"border-b border-border last:border-0":""}`,children:[e.jsx("span",{className:"text-muted-foreground",children:t}),e.jsx("span",{className:s,children:n})]})}function fe(t,n){if(!t||!n)return null;const s=new Date(t).getTime(),a=new Date(n).getTime()-s;return a<0?null:re(a)}function re(t){const n=t/1e3;if(n<60)return`${n.toFixed(1)}s`;const s=Math.floor(n/60),r=n%60;return`${s}m ${r.toFixed(0)}s`}function ts({step:t}){const s={agent:"text-purple-600 dark:text-purple-300"}.agent;return e.jsxs("div",{className:"space-y-3",children:[t.message&&e.jsx("div",{className:"text-sm whitespace-pre-wrap wrap-break-words",children:t.message}),t.reasoning_content&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Reasoning"}),e.jsx("pre",{className:"text-xs bg-muted p-2 overflow-x-auto whitespace-pre-wrap",children:t.reasoning_content})]}),t.tool_calls&&t.tool_calls.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Tool Calls"}),t.tool_calls.map(r=>e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:`text-xs font-mono mb-1 ${s}`,children:r.function_name}),e.jsx(T,{code:JSON.stringify(r.arguments,null,2),lang:"json"})]},r.tool_call_id))]}),t.observation&&t.observation.results.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Observations"}),t.observation.results.map((r,a)=>e.jsx("div",{className:"mb-2",children:e.jsx(T,{code:r.content||"(empty)",lang:"text"})},a))]}),t.metrics&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Tokens: ",(t.metrics.prompt_tokens??0).toLocaleString()," prompt /"," ",(t.metrics.completion_tokens??0).toLocaleString()," completion",t.metrics.cost_usd&&` / $${t.metrics.cost_usd.toFixed(4)}`]})]})}function ss({step:t,prevTimestamp:n,startTimestamp:s}){const r={system:"text-gray-600 dark:text-gray-300",user:"text-blue-600 dark:text-blue-300",agent:"text-purple-600 dark:text-purple-300"},a=fe(n,t.timestamp),o=fe(s,t.timestamp),i=t.message?.split(`
`)[0]||null;return e.jsxs("div",{className:"flex-1 min-w-0 flex items-center gap-4 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 min-w-0 flex items-center gap-2 overflow-hidden",children:[e.jsxs("span",{className:"text-xs text-muted-foreground shrink-0",children:["#",t.step_id]}),e.jsx("span",{className:`text-xs font-medium shrink-0 ${r[t.source]}`,children:t.source}),t.model_name&&e.jsx("span",{className:"text-xs text-muted-foreground shrink-0",children:t.model_name}),e.jsx("span",{className:"text-xs truncate min-w-0 transition-colors group-data-[state=open]:text-border",children:i||e.jsx("span",{className:"text-muted-foreground italic",children:"No message"})})]}),(o||a)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground shrink-0",children:[a&&e.jsxs(pe,{variant:"secondary",className:"text-xs font-normal",children:["+",a]}),o&&e.jsx(pe,{variant:"outline",className:"text-xs font-normal",children:o})]})]})}function ns(t){const n=["var(--color-neutral-400)","var(--color-neutral-500)","var(--color-neutral-600)","var(--color-neutral-700)"],s=t%6,r=s<=3?s:6-s;return n[r]}function rs({steps:t,onStepClick:n}){const[s,r]=g.useState(null),[a,o]=g.useState(0);if(t.length===0)return null;const i=t[0].timestamp?new Date(t[0].timestamp).getTime():0,u=t.map((p,f)=>{const v=p.timestamp?new Date(p.timestamp).getTime():0,b=f>0?t[f-1]:null,x=b?.timestamp?new Date(b.timestamp).getTime():v;return{stepId:p.step_id,durationMs:Math.max(0,v-x),elapsedMs:v-i}}),m=u.reduce((p,f)=>p+f.durationMs,0);if(m===0)return e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"h-6 bg-muted"})});const h=u.map(p=>p.durationMs/m*100),d=[];let j=0;for(const p of h)d.push(j),j+=p;return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[s!==null&&e.jsx("div",{className:"absolute bottom-full mb-2 z-10 -translate-x-1/2 pointer-events-none",style:{left:`${a}%`},children:e.jsxs("div",{className:"bg-popover border border-border rounded-md shadow-md px-3 py-2 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm font-medium",children:["Step #",u[s].stepId]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Duration: ",re(u[s].durationMs)]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Started at: ",re(u[s].elapsedMs)]})]})}),e.jsx("div",{className:"flex h-6 overflow-hidden",children:u.map((p,f)=>{if(p.durationMs===0)return null;const v=h[f],b=s!==null&&s!==f,x=d[f]+v/2;return e.jsx("div",{className:"transition-opacity duration-150 cursor-pointer",style:{width:`${v}%`,backgroundColor:ns(f),opacity:b?.3:1},onMouseEnter:()=>{r(f),o(x)},onMouseLeave:()=>r(null),onClick:()=>n(f)},p.stepId)})})]})})}function os({jobName:t,trialName:n}){const{data:s,isLoading:r}=$({queryKey:["trajectory",t,n],queryFn:()=>ye(t,n)}),[a,o]=g.useState([]),i=g.useRef([]);if(r)return e.jsxs(y,{children:[e.jsx(w,{children:e.jsx(k,{children:"Trajectory"})}),e.jsx(N,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(S,{})})})]});if(!s)return e.jsx(L,{className:"bg-card border",children:e.jsxs(E,{children:[e.jsx(O,{variant:"icon",children:e.jsx(yt,{})}),e.jsx(F,{children:"No trajectory"}),e.jsxs(V,{children:["No ATIF trajectory found at ",n,"/agent/trajectory.json"]})]})});const u=m=>{const h=`step-${m}`;o(d=>d.includes(h)?d:[...d,h]),i.current[m]?.scrollIntoView({behavior:"smooth",block:"start"})};return e.jsxs(y,{children:[e.jsxs(w,{children:[e.jsx(k,{children:"Trajectory"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.steps.length," steps",s.final_metrics?.total_cost_usd&&e.jsxs(e.Fragment,{children:[" / $",s.final_metrics.total_cost_usd.toFixed(4)," total"]})]})]}),e.jsxs(N,{children:[e.jsx(rs,{steps:s.steps,onStepClick:u}),e.jsx(Wt,{type:"multiple",value:a,onValueChange:o,children:s.steps.map((m,h)=>e.jsxs(Gt,{value:`step-${h}`,ref:d=>{i.current[h]=d},children:[e.jsx(Qt,{children:e.jsx(ss,{step:m,prevTimestamp:h>0?s.steps[h-1]?.timestamp??null:null,startTimestamp:s.steps[0]?.timestamp??null})}),e.jsx(Jt,{children:e.jsx(ts,{step:m})})]},m.step_id))})]})]})}function as({jobName:t,trialName:n}){const{data:s,isLoading:r}=$({queryKey:["verifier-output",t,n],queryFn:()=>Ze(t,n)});if(r)return e.jsxs(y,{children:[e.jsx(w,{children:e.jsx(k,{children:"Verifier Output"})}),e.jsx(N,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(S,{})})})]});const a=!!s?.stdout,o=!!s?.ctrf;return!a&&!o?e.jsx(L,{className:"bg-card border",children:e.jsxs(E,{children:[e.jsx(O,{variant:"icon",children:e.jsx(_e,{})}),e.jsx(F,{children:"No verifier logs"}),e.jsx(V,{children:"No test output or CTRF results found"})]})}):a&&o?e.jsx(y,{className:"py-0 gap-0",children:e.jsx(N,{className:"p-0",children:e.jsxs(ae,{defaultValue:"stdout",children:[e.jsxs(ie,{children:[e.jsx(M,{value:"stdout",children:"Output"}),e.jsx(M,{value:"ctrf",children:"CTRF"})]}),e.jsx(R,{value:"stdout",className:"mt-0 -mx-px",children:e.jsx(T,{code:s.stdout,lang:"text"})}),e.jsx(R,{value:"ctrf",className:"mt-0 -mx-px",children:e.jsx(T,{code:s.ctrf,lang:"json"})})]})})}):a?e.jsx(T,{code:s.stdout,lang:"text"}):e.jsx(T,{code:s.ctrf,lang:"json"})}function is({jobName:t,trialName:n}){const s=nt(),[r,a]=g.useState(!1),[o,i]=g.useState("haiku"),u=ot({mutationFn:()=>Xe(t,n,o),onSuccess:()=>{s.invalidateQueries({queryKey:["agent-logs",t,n]}),a(!1),z.success("Summary generated")},onError:m=>{z.error("Failed to generate summary",{description:m.message})}});return e.jsxs(lt,{open:r,onOpenChange:a,children:[e.jsx(ct,{asChild:!0,children:e.jsx(he,{children:"Generate Summary"})}),e.jsxs(dt,{children:[e.jsxs(ut,{children:[e.jsx(xt,{children:"Generate Summary"}),e.jsx(mt,{children:"Use Claude to analyze this trial and generate a summary."})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ht,{htmlFor:"model",children:"Model"}),e.jsxs(pt,{value:o,onValueChange:i,children:[e.jsx(ft,{id:"model",children:e.jsx(jt,{})}),e.jsxs(gt,{children:[e.jsx(te,{value:"haiku",children:"Haiku (Recommended)"}),e.jsx(te,{value:"sonnet",children:"Sonnet"}),e.jsx(te,{value:"opus",children:"Opus"})]})]})]}),e.jsx(he,{className:"w-full",onClick:()=>u.mutate(),disabled:u.isPending,children:u.isPending?e.jsx(S,{text:"Generating"}):"Generate"})]})]})]})}function ls({jobName:t,trialName:n}){const{data:s,isLoading:r}=$({queryKey:["agent-logs",t,n],queryFn:()=>Ne(t,n)});return r?e.jsxs(y,{children:[e.jsx(w,{children:e.jsx(k,{children:"Summary"})}),e.jsx(N,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(S,{})})})]}):s?.summary?e.jsx(T,{code:s.summary,lang:"markdown",wrap:!0}):e.jsxs(L,{className:"bg-card border",children:[e.jsxs(E,{children:[e.jsx(O,{variant:"icon",children:e.jsx(it,{})}),e.jsx(F,{children:"No summary"}),e.jsx(V,{children:"Generate a summary of this trial using Claude."})]}),e.jsx(is,{jobName:t,trialName:n})]})}function cs({jobName:t,trialName:n}){const{data:s,isLoading:r}=$({queryKey:["exception",t,n],queryFn:()=>et(t,n)});return r?e.jsxs(y,{children:[e.jsx(w,{children:e.jsx(k,{children:"Exception"})}),e.jsx(N,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(S,{})})})]}):s?e.jsx(T,{code:s,lang:"text"}):e.jsx(L,{className:"bg-card border",children:e.jsxs(E,{children:[e.jsx(O,{variant:"icon",children:e.jsx(kt,{})}),e.jsx(F,{children:"No exception"}),e.jsx(V,{children:"No exception.txt file found in this trial."})]})})}function ds({jobName:t,trialName:n}){const{data:s,isLoading:r}=$({queryKey:["trial-log",t,n],queryFn:()=>tt(t,n)});return r?e.jsxs(y,{children:[e.jsx(w,{children:e.jsx(k,{children:"Trial Log"})}),e.jsx(N,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(S,{})})})]}):s?e.jsx(T,{code:s,lang:"text"}):e.jsx(L,{className:"bg-card border",children:e.jsxs(E,{children:[e.jsx(O,{variant:"icon",children:e.jsx(_e,{})}),e.jsx(F,{children:"No trial log"}),e.jsx(V,{children:"No trial.log file found in this trial."})]})})}function us({jobName:t,trialName:n}){const{data:s,isLoading:r}=$({queryKey:["agent-logs",t,n],queryFn:()=>Ne(t,n)});if(r)return e.jsxs(y,{children:[e.jsx(w,{children:e.jsx(k,{children:"Agent Logs"})}),e.jsx(N,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(S,{})})})]});if(!(s&&(s.oracle||s.setup||s.commands.length>0)))return e.jsx(L,{className:"bg-card border",children:e.jsxs(E,{children:[e.jsx(O,{variant:"icon",children:e.jsx(_t,{})}),e.jsx(F,{children:"No agent logs"}),e.jsx(V,{children:"No oracle, setup, or command logs found"})]})});const o=[];s.oracle&&o.push({id:"oracle",label:"Oracle",content:s.oracle,lang:"text"}),s.setup&&o.push({id:"setup",label:"Setup",content:s.setup,lang:"text"});for(const i of s.commands)o.push({id:`command-${i.index}`,label:`Command ${i.index}`,content:i.content,lang:"text"});return o.length===0?null:e.jsx(y,{className:"py-0 gap-0",children:e.jsx(N,{className:"p-0",children:e.jsxs(ae,{defaultValue:o[0].id,children:[e.jsx(ie,{children:o.map(i=>e.jsx(M,{value:i.id,children:i.label},i.id))}),o.map(i=>e.jsx(R,{value:i.id,className:"mt-0 -mx-px",children:e.jsx(T,{code:i.content,lang:i.lang})},i.id))]})})})}function xs(t){const n=["harbor run"];t.source&&n.push(`-d ${t.source}`),n.push(`-t ${t.task_name}`),n.push(`-a ${t.agent_info.name}`);const s=t.agent_info.model_info;if(s){const r=s.provider?`${s.provider}/${s.name}`:s.name;n.push(`-m ${r}`)}return n.join(" ")}function D({value:t}){const n=async()=>{await navigator.clipboard.writeText(t),z("Copied to clipboard",{description:t})};return e.jsx("span",{onClick:n,className:"cursor-default hover:opacity-70 transition-opacity",children:t})}function je(t,n){return`/jobs/${encodeURIComponent(t)}/tasks/${encodeURIComponent(n.source)}/${encodeURIComponent(n.agent)}/${encodeURIComponent(n.modelProvider)}/${encodeURIComponent(n.modelName)}/${encodeURIComponent(n.taskName)}`}function ms({trial:t,jobName:n,trialName:s}){const{data:r}=$({queryKey:["trajectory",n,s],queryFn:()=>ye(n,s)}),a=t.verifier_result?.rewards?.reward??null,o=r?.final_metrics;return e.jsxs(e.Fragment,{children:[e.jsx(T,{code:xs(t),lang:"bash",className:"-mb-px -mx-px"}),e.jsxs("div",{className:"grid grid-cols-1 -mx-px",children:[e.jsxs(y,{className:"-mb-px gap-3 py-4",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between",children:[e.jsx(k,{children:"Outcome"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:Yt(t.started_at)})]}),e.jsxs(N,{children:[e.jsx(se,{label:"Reward",value:a!==null?a.toFixed(2):"-",showBorder:!1}),o?.total_cost_usd&&e.jsx(se,{label:"Cost",value:`$${o.total_cost_usd.toFixed(4)}`,showBorder:!1}),t.exception_info&&e.jsx(se,{label:"Error",value:e.jsx(D,{value:t.exception_info.exception_type}),className:"text-destructive",showBorder:!1})]})]}),e.jsxs(y,{className:"-mb-px -mt-px gap-3 py-4",children:[e.jsx(w,{children:e.jsx(k,{children:"Tokens"})}),e.jsx(N,{children:e.jsx(Zt,{segments:[{label:"Cached",value:o?.total_cached_tokens??0,color:"var(--color-neutral-400)"},{label:"Prompt",value:Math.max(0,(o?.total_prompt_tokens??0)-(o?.total_cached_tokens??0)),color:"var(--color-neutral-500)"},{label:"Output",value:o?.total_completion_tokens??0,color:"var(--color-neutral-600)"}],totalLabel:`${((o?.total_prompt_tokens??0)+(o?.total_completion_tokens??0)).toLocaleString()} tokens`})})]}),e.jsxs(y,{className:"-mt-px gap-3 py-4",children:[e.jsx(w,{children:e.jsx(k,{children:"Timing"})}),e.jsx(N,{children:e.jsx(es,{phases:[{label:"Env Setup",timing:t.environment_setup,color:"var(--color-neutral-400)"},{label:"Agent Setup",timing:t.agent_setup,color:"var(--color-neutral-500)"},{label:"Agent Execution",timing:t.agent_execution,color:"var(--color-neutral-600)"},{label:"Verifier",timing:t.verifier,color:"var(--color-neutral-700)"}],totalDuration:He(t.started_at,t.finished_at)})})]})]}),e.jsxs(ae,{defaultValue:"trajectory",className:"mt-6",children:[e.jsxs(ie,{className:"bg-card border border-b-0 w-full",children:[e.jsx(M,{value:"trajectory",children:"Trajectory"}),e.jsx(M,{value:"agent-logs",children:"Agent Logs"}),e.jsx(M,{value:"test-output",children:"Verifier Logs"}),e.jsx(M,{value:"trial-log",children:"Trial Log"}),e.jsx(M,{value:"summary",children:"Summary"}),e.jsx(M,{value:"exception",children:"Exception"})]}),e.jsx(R,{value:"trajectory",forceMount:!0,className:"data-[state=inactive]:hidden",children:e.jsx(os,{jobName:n,trialName:s})}),e.jsx(R,{value:"agent-logs",forceMount:!0,className:"data-[state=inactive]:hidden",children:e.jsx(us,{jobName:n,trialName:s})}),e.jsx(R,{value:"test-output",forceMount:!0,className:"data-[state=inactive]:hidden",children:e.jsx(as,{jobName:n,trialName:s})}),e.jsx(R,{value:"trial-log",forceMount:!0,className:"data-[state=inactive]:hidden",children:e.jsx(ds,{jobName:n,trialName:s})}),e.jsx(R,{value:"summary",forceMount:!0,className:"data-[state=inactive]:hidden",children:e.jsx(ls,{jobName:n,trialName:s})}),e.jsx(R,{value:"exception",forceMount:!0,className:"data-[state=inactive]:hidden",children:e.jsx(cs,{jobName:n,trialName:s})})]})]})}function hs(){return e.jsxs("div",{className:"grid grid-cols-1 -mx-px",children:[e.jsxs(y,{className:"-mb-px gap-3 py-4",children:[e.jsx(w,{children:e.jsx(k,{children:"Outcome"})}),e.jsx(N,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(S,{})})})]}),e.jsxs(y,{className:"-mb-px -mt-px gap-3 py-4",children:[e.jsx(w,{children:e.jsx(k,{children:"Tokens"})}),e.jsx(N,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(S,{})})})]}),e.jsxs(y,{className:"-mt-px gap-3 py-4",children:[e.jsx(w,{children:e.jsx(k,{children:"Timing"})}),e.jsx(N,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(S,{})})})]})]})}const _s=Be(function(){const{jobName:n,trialName:s,source:r,agent:a,modelProvider:o,modelName:i,taskName:u}=Ke(),m=ze(),h={source:r,agent:a,modelProvider:o,modelName:i,taskName:u};Ge("escape",()=>m(je(n,h)),{enableOnFormTags:!1});const{data:d,isLoading:j,error:p}=$({queryKey:["trial",n,s],queryFn:()=>st(n,s),enabled:!!n&&!!s});return e.jsxs("div",{className:"container mx-auto py-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(Qe,{className:"mb-4",children:e.jsxs(Je,{children:[e.jsx(K,{children:e.jsx(Z,{asChild:!0,children:e.jsx(X,{to:"/",children:"Jobs"})})}),e.jsx(ee,{}),e.jsx(K,{children:e.jsx(Z,{asChild:!0,children:e.jsx(X,{to:`/jobs/${encodeURIComponent(n)}`,children:n})})}),e.jsx(ee,{}),e.jsx(K,{children:e.jsx(Z,{asChild:!0,children:e.jsx(X,{to:je(n,h),children:u})})}),e.jsx(ee,{}),e.jsx(K,{children:e.jsx(Ye,{children:s})})]})}),e.jsx("h1",{className:"text-4xl font-medium mb-4 w-fit cursor-default hover:text-foreground/80 transition-colors",onClick:async()=>{await navigator.clipboard.writeText(s),z("Copied to clipboard",{description:s})},children:s}),j?e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(S,{})}):d?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2 text-sm text-muted-foreground",children:[d.source&&e.jsxs(e.Fragment,{children:[e.jsx(D,{value:d.source}),e.jsx("span",{className:"text-border",children:"|"})]}),e.jsx(D,{value:d.task_name}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx(D,{value:d.agent_info.version&&d.agent_info.version!=="unknown"?`${d.agent_info.name}@${d.agent_info.version}`:d.agent_info.name}),d.agent_info.model_info&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-border",children:"|"}),e.jsx(D,{value:`${d.agent_info.model_info.provider}/${d.agent_info.model_info.name}`})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-3",children:e.jsx(D,{value:d.trial_uri.startsWith("file://")?d.trial_uri.slice(7):d.trial_uri})})]}):null]}),!j&&(p||!d)?e.jsx("div",{className:"text-destructive",children:p instanceof Error?p.message:"Failed to load trial"}):j?e.jsx(hs,{}):d?e.jsx(ms,{trial:d,jobName:n,trialName:s}):null]})});export{_s as default};
