import{x as ge,v as je,b as d,t as e}from"./index-CYR-HZan.js";import{u as fe,t as R,l as ve}from"./index-JVv6katd.js";import{c as ee,u as q,d as be,B as Ne,a as ye,b as Ce,e as we,f as G,g as Se,h as De,i as _e,j as Me}from"./api-BgrBwReI.js";import{u as Te,X as Pe,E as z,a as U,b as X,c as Z,d as Fe}from"./empty-TlmgxYvO.js";import{u as v,p as w,a as b,T as ke,I as Ee,S as W,C as k}from"./input-BPzPo60M.js";import{u as Ve,a as Ke,D as Oe,c as $e,P as Ae,b as Ie,d as g,e as Je,f as E,g as Y,h as Re,S as h}from"./hooks-BI573EzM.js";import{T as S,a as D,b as _}from"./tooltip-CILBUYcN.js";import{K as M}from"./kbd-CNHFVw7L.js";import"./mutation--h5hHClj.js";import"./index-DvJT0nJi.js";import"./compare-Br3z3FUS-D09VrqaM.js";import"./scroll-area-Bnf4hdko.js";const qe=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],Le=ee("folder-open",qe);const He=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],Be=ee("grid-3x3",He),L=100,Qe=[{value:"today",label:"Last 24 hours"},{value:"week",label:"Last 7 days"},{value:"month",label:"Last 30 days"}];function Ge(s,t){if(!s)return"-";const n=new Date(s).getTime(),m=(t?new Date(t).getTime():Date.now())-n,c=Math.floor(m/1e3),l=Math.floor(c/60),r=Math.floor(l/60);return r>0?`${r}h ${l%60}m`:l>0?`${l}m ${c%60}s`:`${c}s`}const ze=[$e(),{accessorKey:"name",header:({column:s})=>e.jsx(h,{column:s,children:"Job Name"})},{accessorKey:"datasets",header:({column:s})=>e.jsx(h,{column:s,children:"Datasets"}),sortingFn:(s,t)=>{const n=s.original.datasets[0]??"",o=t.original.datasets[0]??"";return n.localeCompare(o)},cell:({row:s})=>{const t=s.original.datasets;return t.length===0?e.jsx("span",{className:"text-muted-foreground",children:"-"}):t.length===1?e.jsx("span",{className:"text-sm",children:t[0]}):e.jsxs(S,{children:[e.jsx(D,{asChild:!0,children:e.jsxs("span",{className:"text-sm cursor-default",children:[t[0]," ",e.jsxs("span",{className:"text-muted-foreground",children:["+",t.length-1," more"]})]})}),e.jsx(_,{children:e.jsx("p",{children:t.join(", ")})})]})}},{accessorKey:"agents",header:({column:s})=>e.jsx(h,{column:s,children:"Agents"}),sortingFn:(s,t)=>{const n=s.original.agents[0]??"",o=t.original.agents[0]??"";return n.localeCompare(o)},cell:({row:s})=>{const t=s.original.agents;return t.length===0?e.jsx("span",{className:"text-muted-foreground",children:"-"}):t.length===1?e.jsx("span",{className:"text-sm",children:t[0]}):e.jsxs(S,{children:[e.jsx(D,{asChild:!0,children:e.jsxs("span",{className:"text-sm cursor-default",children:[t[0]," ",e.jsxs("span",{className:"text-muted-foreground",children:["+",t.length-1," more"]})]})}),e.jsx(_,{children:e.jsx("p",{children:t.join(", ")})})]})}},{accessorKey:"providers",header:({column:s})=>e.jsx(h,{column:s,children:"Providers"}),sortingFn:(s,t)=>{const n=s.original.providers[0]??"",o=t.original.providers[0]??"";return n.localeCompare(o)},cell:({row:s})=>{const t=s.original.providers;return t.length===0?e.jsx("span",{className:"text-muted-foreground",children:"-"}):t.length===1?e.jsx("span",{className:"text-sm",children:t[0]}):e.jsxs(S,{children:[e.jsx(D,{asChild:!0,children:e.jsxs("span",{className:"text-sm cursor-default",children:[t[0]," ",e.jsxs("span",{className:"text-muted-foreground",children:["+",t.length-1," more"]})]})}),e.jsx(_,{children:e.jsx("p",{children:t.join(", ")})})]})}},{accessorKey:"models",header:({column:s})=>e.jsx(h,{column:s,children:"Models"}),sortingFn:(s,t)=>{const n=s.original.models[0]??"",o=t.original.models[0]??"";return n.localeCompare(o)},cell:({row:s})=>{const t=s.original.models;return t.length===0?e.jsx("span",{className:"text-muted-foreground",children:"-"}):t.length===1?e.jsx("span",{className:"text-sm",children:t[0]}):e.jsxs(S,{children:[e.jsx(D,{asChild:!0,children:e.jsxs("span",{className:"text-sm cursor-default",children:[t[0]," ",e.jsxs("span",{className:"text-muted-foreground",children:["+",t.length-1," more"]})]})}),e.jsx(_,{children:e.jsx("p",{children:t.join(", ")})})]})}},{accessorKey:"environment_type",header:({column:s})=>e.jsx(h,{column:s,children:"Environment"}),cell:({row:s})=>{const t=s.original.environment_type;return t?e.jsx("span",{className:"text-sm",children:t}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}},{accessorKey:"started_at",header:({column:s})=>e.jsx(h,{column:s,children:"Started"}),cell:({row:s})=>{const t=s.original.started_at;return t?new Date(t).toLocaleString(void 0,{dateStyle:"short",timeStyle:"short"}):"-"}},{id:"duration",header:({column:s})=>e.jsx(h,{column:s,children:"Duration"}),accessorFn:s=>!s.started_at||!s.finished_at?0:new Date(s.finished_at).getTime()-new Date(s.started_at).getTime(),cell:({row:s})=>{const{started_at:t,finished_at:n}=s.original;return!t||!n?"-":Ge(t,n)}},{accessorKey:"n_total_trials",header:({column:s})=>e.jsx("div",{className:"text-right",children:e.jsx(h,{column:s,children:"Trials"})}),cell:({row:s})=>{const t=s.original.n_total_trials,n=s.original.n_completed_trials;return e.jsxs("div",{className:"text-right",children:[n,"/",t]})}},{accessorKey:"n_errors",header:({column:s})=>e.jsx("div",{className:"text-right",children:e.jsx(h,{column:s,children:"Errors"})}),cell:({row:s})=>{const t=s.original.n_errors;return e.jsx("div",{className:"text-right",children:t})}},{accessorKey:"evals",header:({column:s})=>e.jsx("div",{className:"text-right",children:e.jsx(h,{column:s,children:"Result"})}),sortingFn:(s,t)=>{const n=Object.entries(s.original.evals),o=Object.entries(t.original.evals),m=n[0]?.[1]?.metrics[0],c=o[0]?.[1]?.metrics[0],l=m?Object.values(m)[0]:null,r=c?Object.values(c)[0]:null;return l===null&&r===null?0:l===null?1:r===null?-1:typeof l=="number"&&typeof r=="number"?l-r:String(l).localeCompare(String(r))},cell:({row:s})=>{const t=s.original.evals,n=Object.entries(t);if(n.length===0)return e.jsx("div",{className:"text-right text-muted-foreground",children:"-"});const[,o]=n[0],m=o.metrics[0];if(!m)return e.jsx("div",{className:"text-right text-muted-foreground",children:"-"});const[c,l]=Object.entries(m)[0],r=typeof l=="number"?l.toFixed(2):String(l);return n.length===1?e.jsxs(S,{children:[e.jsx(D,{asChild:!0,children:e.jsx("div",{className:"text-right cursor-default",children:r})}),e.jsx(_,{children:e.jsxs("p",{children:[c,"=",r]})})]}):e.jsxs(S,{children:[e.jsx(D,{asChild:!0,children:e.jsxs("div",{className:"text-right cursor-default",children:[r," ",e.jsxs("span",{className:"text-muted-foreground",children:["+",n.length-1," more"]})]})}),e.jsx(_,{align:"end",children:e.jsx("ul",{className:"space-y-0.5",children:n.map(([u,T])=>{const P=T.metrics[0],p=`(${u.split("__").join(", ")})`;if(!P)return e.jsx("li",{children:p},u);const[A,x]=Object.entries(P)[0],I=typeof x=="number"?x.toFixed(2):x;return e.jsxs("li",{children:[p,": ",A,"=",I]},u)})})})]})}}],os=ge(function(){const t=je(),n=fe(),[o,m]=v("selected",w(b).withDefault([])),[c,l]=d.useState(!1),[r,u]=d.useState(1),[T,P]=v("q",b.withDefault("")),[p,A]=v("agent",w(b).withDefault([])),[x,I]=v("provider",w(b).withDefault([])),[N,se]=v("model",w(b).withDefault([])),[y,te]=v("date",w(b).withDefault([])),[V,ae]=v("hide",w(b).withDefault([])),K=d.useMemo(()=>[{value:"name",label:"Job Name"},{value:"datasets",label:"Datasets"},{value:"agents",label:"Agents"},{value:"providers",label:"Providers"},{value:"models",label:"Models"},{value:"environment_type",label:"Environment"},{value:"started_at",label:"Started"},{value:"duration",label:"Duration"},{value:"n_total_trials",label:"Trials"},{value:"n_errors",label:"Errors"},{value:"evals",label:"Result"}],[]),re=d.useMemo(()=>{const a={};for(const i of V)a[i]=!1;return a},[V]),ne=d.useMemo(()=>K.filter(a=>!V.includes(a.value)).map(a=>a.value),[K,V]),le=a=>{const i=K.filter(F=>!a.includes(F.value)).map(F=>F.value);ae(i.length>0?i:null)},O=Ve(T,300);d.useEffect(()=>{u(1)},[O,p,x,N,y]);const{data:C}=q({queryKey:["jobFilters"],queryFn:De,staleTime:6e4}),{data:oe}=q({queryKey:["config"],queryFn:_e,staleTime:1/0}),ie=d.useMemo(()=>(C?.agents??[]).map(a=>({value:a.value,label:a.value,count:a.count})),[C?.agents]),ce=d.useMemo(()=>(C?.providers??[]).map(a=>({value:a.value,label:a.value,count:a.count})),[C?.providers]),de=d.useMemo(()=>(C?.models??[]).map(a=>({value:a.value,label:a.value,count:a.count})),[C?.models]),{data:J,isLoading:ue}=q({queryKey:["jobs",r,O,p,x,N,y],queryFn:()=>Me(r,L,{search:O||void 0,agents:p.length>0?p:void 0,providers:x.length>0?x:void 0,models:N.length>0?N:void 0,dates:y.length>0?y:void 0}),placeholderData:ve}),$=J?.items??[],j=J?.total_pages??0,H=J?.total??0,B=d.useRef(null);be("mod+k",a=>{a.preventDefault(),B.current?.focus()},{enableOnFormTags:!0});const{highlightedIndex:he}=Ke({rows:$,onNavigate:a=>t(`/jobs/${a.name}`)}),me=d.useMemo(()=>{const a={};for(const i of o)a[i]=!0;return a},[o]),f=d.useMemo(()=>$.filter(a=>o.includes(a.name)),[$,o]),xe=a=>{const i=Object.keys(a).filter(F=>a[F]);m(i.length>0?i:null)},Q=Te({mutationFn:async a=>{await Promise.all(a.map(i=>Se(i)))},onSuccess:()=>{n.invalidateQueries({queryKey:["jobs"]}),R("Jobs deleted",{description:`${f.length} job(s) deleted`}),m(null),l(!1)},onError:a=>{R.error("Failed to delete jobs",{description:a.message}),l(!1)}}),pe=()=>{c?Q.mutate(f.map(a=>a.name)):l(!0)};return e.jsxs("div",{className:"container mx-auto py-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(Ne,{className:"mb-4",children:e.jsx(ye,{children:e.jsx(Ce,{children:e.jsx(we,{children:"Jobs"})})})}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-medium mb-2",children:"Jobs"}),e.jsx("p",{className:"text-muted-foreground",children:"Browse and inspect Harbor jobs"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(M,{children:"j"}),e.jsx(M,{children:"k"}),e.jsx("span",{children:"to navigate"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(M,{children:"Enter"}),e.jsx("span",{children:"to open"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(M,{children:"Esc"}),e.jsx("span",{children:"to deselect"})]})]}),f.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[f.length>=1&&e.jsxs(G,{variant:"secondary",onClick:()=>{const a=new URLSearchParams;for(const i of f)a.append("job",i.name);t(`/compare?${a}`)},children:[e.jsx(Be,{className:"h-4 w-4"}),"Compare (",f.length,")"]}),e.jsxs(G,{variant:c?"destructive":"secondary",onClick:pe,onBlur:()=>l(!1),disabled:Q.isPending,children:[e.jsx(ke,{className:"h-4 w-4"}),c?`Confirm delete (${f.length})`:`Delete (${f.length})`]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-7 -mb-px",children:[e.jsxs("div",{className:"col-span-2 relative",children:[e.jsx(Ee,{ref:B,placeholder:"Search for jobs...",value:T,onChange:a=>P(a.target.value||null),size:"lg",variant:"card",className:"peer pl-9 pr-16 shadow-none"}),e.jsx(W,{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-border transition-colors peer-focus-visible:text-ring"}),T?e.jsx("button",{type:"button",onClick:()=>P(null),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:e.jsx(Pe,{className:"h-4 w-4"})}):e.jsxs("div",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-0.5",children:[e.jsx(M,{children:"âŒ˜"}),e.jsx(M,{children:"K"})]})]}),e.jsx(k,{options:ie,value:p,onValueChange:A,placeholder:"All agents",searchPlaceholder:"Search agents...",emptyText:"No agents found.",variant:"card",className:"w-full border-l-0 shadow-none"}),e.jsx(k,{options:ce,value:x,onValueChange:I,placeholder:"All providers",searchPlaceholder:"Search providers...",emptyText:"No providers found.",variant:"card",className:"w-full border-l-0 shadow-none"}),e.jsx(k,{options:de,value:N,onValueChange:se,placeholder:"All models",searchPlaceholder:"Search models...",emptyText:"No models found.",variant:"card",className:"w-full border-l-0 shadow-none"}),e.jsx(k,{options:Qe,value:y,onValueChange:te,placeholder:"All time",searchPlaceholder:"Search...",emptyText:"No options.",variant:"card",className:"w-full border-l-0 shadow-none"}),e.jsx(k,{options:K,value:ne,onValueChange:le,placeholder:"Columns",searchPlaceholder:"Search columns...",emptyText:"No columns.",variant:"card",className:"w-full border-l-0 shadow-none",multiSelectLabel:"columns"})]}),e.jsx(Oe,{columns:ze,data:$,onRowClick:a=>t(`/jobs/${a.name}`),enableRowSelection:!0,rowSelection:me,onRowSelectionChange:xe,columnVisibility:re,getRowId:a=>a.name,isLoading:ue,className:"border-t-0",highlightedIndex:he,emptyState:O||p.length>0||x.length>0||N.length>0||y.length>0?e.jsx(z,{className:"border-0",children:e.jsxs(U,{children:[e.jsx(X,{variant:"icon",children:e.jsx(W,{})}),e.jsx(Z,{children:"No jobs match those filters"})]})}):e.jsx(z,{className:"border-0",children:e.jsxs(U,{children:[e.jsx(X,{variant:"icon",children:e.jsx(Le,{})}),e.jsxs(Z,{children:["No jobs in ",oe?.jobs_dir??"jobs directory"]}),e.jsxs(Fe,{children:["Start a job using"," ",e.jsx("code",{className:"bg-muted px-1 py-0.5 cursor-default hover:bg-ring/20 hover:text-foreground transition-colors",onClick:()=>{navigator.clipboard.writeText("harbor run -d <dataset>"),R("Copied to clipboard")},children:"harbor run -d <dataset>"})]})]})})}),j>1&&e.jsxs("div",{className:"grid grid-cols-3 items-center mt-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",(r-1)*L+1,"-",Math.min(r*L,H)," of ",H," jobs"]}),e.jsx(Ae,{children:e.jsxs(Ie,{children:[e.jsx(g,{children:e.jsx(Je,{onClick:()=>u(a=>Math.max(1,a-1)),className:r===1?"pointer-events-none opacity-50":"cursor-pointer"})}),r>2&&e.jsx(g,{children:e.jsx(E,{onClick:()=>u(1),className:"cursor-pointer",children:"1"})}),r>3&&e.jsx(g,{children:e.jsx(Y,{})}),r>1&&e.jsx(g,{children:e.jsx(E,{onClick:()=>u(r-1),className:"cursor-pointer",children:r-1})}),e.jsx(g,{children:e.jsx(E,{isActive:!0,children:r})}),r<j&&e.jsx(g,{children:e.jsx(E,{onClick:()=>u(r+1),className:"cursor-pointer",children:r+1})}),r<j-2&&e.jsx(g,{children:e.jsx(Y,{})}),r<j-1&&e.jsx(g,{children:e.jsx(E,{onClick:()=>u(j),className:"cursor-pointer",children:j})}),e.jsx(g,{children:e.jsx(Re,{onClick:()=>u(a=>Math.min(j,a+1)),className:r===j?"pointer-events-none opacity-50":"cursor-pointer"})})]})}),e.jsx("div",{})]})]})});export{os as default};
