# ────────────────────────────────────────────────────────────────────────────────────────
#   version.py
#   ──────────
#
#   Version string handling for cal-publish-python.
#
#   (c) 2026 Cyber Assessment Labs — MIT License; see LICENSE in the project root.
#
#   Authors
#   ───────
#   bena (via Claude)
#
#   Version History
#   ───────────────
#   Feb 2026 - Created
# ────────────────────────────────────────────────────────────────────────────────────────

# ────────────────────────────────────────────────────────────────────────────────────────
#   Imports
# ────────────────────────────────────────────────────────────────────────────────────────

from importlib.metadata import PackageNotFoundError
from importlib.metadata import version

# ────────────────────────────────────────────────────────────────────────────────────────
#   Version Detection
# ────────────────────────────────────────────────────────────────────────────────────────


# ────────────────────────────────────────────────────────────────────────────────────────
def _detect_version() -> str:
    """Detect the version string from package metadata or build-time generation."""
    try:
        # Try to get version from installed package metadata
        return version("cal-publish-python")
    except PackageNotFoundError:
        pass

    try:
        # Fall back to _version.py generated by Makefile during build
        from ._version import (  # pyright: ignore[reportMissingImports]
            __version__ as build_version,  # pyright: ignore[reportUnknownVariableType]
        )

        return str(build_version)  # pyright: ignore[reportUnknownArgumentType]
    except ImportError:
        pass

    return "0.0.0.dev0+unknown"


VERSION_STR: str = _detect_version()
