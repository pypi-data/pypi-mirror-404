{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": 5,
  "links": [],
  "panels": [
    {
      "datasource": "PostgreSQL",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 0,
        "y": 0
      },
      "id": 1,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.1.1",
      "targets": [
        {
          "datasource": "PostgreSQL",
          "format": "table",
          "rawSql": "SELECT SUM(value_usd) AS total_revenue FROM usdvalue_presum WHERE top_category = 'Revenue' AND timestamp >= $__from/1000 AND timestamp <= $__to/1000",
          "refId": "A",
          "timeColumns": ["time", "ts"]
        }
      ],
      "title": "Revenue",
      "type": "stat",
      "description": "Displays the total value of all transactions sorted as Revenue for the selected period."
    },
    {
      "datasource": "PostgreSQL",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 4,
        "y": 0
      },
      "id": 2,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.1.1",
      "targets": [
        {
          "datasource": "PostgreSQL",
          "format": "table",
          "rawSql": "SELECT SUM(value_usd) AS total_revenue FROM usdvalue_presum WHERE top_category = 'Expenses' AND timestamp >= $__from/1000 AND timestamp <= $__to/1000",
          "refId": "A",
          "timeColumns": ["time", "ts"]
        }
      ],
      "title": "Expenses",
      "type": "stat",
      "description": "Displays the total value of all transactions sorted as Expenses for the selected period."
    },
    {
      "datasource": "PostgreSQL",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 8,
        "y": 0
      },
      "id": 3,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.1.1",
      "targets": [
        {
          "datasource": "PostgreSQL",
          "format": "table",
          "rawSql": "SELECT SUM(value_usd) AS total_revenue FROM usdvalue_presum WHERE top_category = 'Cost of Revenue' AND timestamp >= $__from/1000 AND timestamp <= $__to/1000",
          "refId": "A",
          "timeColumns": ["time", "ts"]
        }
      ],
      "title": "Cost of Revenue",
      "type": "stat",
      "description": "Displays the total value of all transactions sorted as Cost of Revenue for the selected period."
    },
    {
      "datasource": "PostgreSQL",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 12,
        "y": 0
      },
      "id": 4,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.1.1",
      "targets": [
        {
          "datasource": "PostgreSQL",
          "format": "table",
          "rawSql": "SELECT SUM(value_usd) AS total_revenue FROM usdvalue_presum WHERE top_category = 'Other Income' AND timestamp >= $__from/1000 AND timestamp <= $__to/1000",
          "refId": "A",
          "timeColumns": ["time", "ts"]
        }
      ],
      "title": "Other Income",
      "type": "stat",
      "description": "Displays the total value of all transactions sorted as Other Income for the selected period."
    },
    {
      "datasource": "PostgreSQL",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 16,
        "y": 0
      },
      "id": 5,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.1.1",
      "targets": [
        {
          "datasource": "PostgreSQL",
          "format": "table",
          "rawSql": "SELECT SUM(value_usd) AS total_revenue FROM usdvalue_presum WHERE top_category = 'Other Expenses' AND timestamp >= $__from/1000 AND timestamp <= $__to/1000",
          "refId": "A",
          "timeColumns": ["time", "ts"]
        }
      ],
      "title": "Other Expenses",
      "type": "stat",
      "description": "Displays the total value of all transactions sorted as Other Expenses for the selected period."
    },
    {
      "datasource": "PostgreSQL",
      "description": "Shows the net total cashflow (all Revenue and Other Income minus all Expenses, Cost of Revenue, and Other Expenses) for the selected period.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 20,
        "y": 0
      },
      "id": 10,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.1.1",
      "targets": [
        {
          "datasource": "PostgreSQL",
          "format": "table",
          "rawSql": "SELECT (\n  SUM(CASE WHEN top_category = 'Revenue' THEN value_usd ELSE 0 END)\n  - SUM(CASE WHEN top_category = 'Cost of Revenue' THEN value_usd ELSE 0 END)\n  - SUM(CASE WHEN top_category = 'Expenses' THEN value_usd ELSE 0 END)\n  + SUM(CASE WHEN top_category = 'Other Income' THEN value_usd ELSE 0 END)\n  - SUM(CASE WHEN top_category = 'Other Expenses' THEN value_usd ELSE 0 END)\n) AS total_net\nFROM usdvalue_presum\nWHERE timestamp >= $__from/1000 AND timestamp <= $__to/1000",
          "refId": "A",
          "timeColumns": ["time", "ts"]
        }
      ],
      "title": "Sorted Total",
      "type": "stat"
    },
    {
      "datasource": "PostgreSQL",
      "description": "Time series chart of all sorted cashflows, grouped by category, for the selected period. Shows Total Revenue, Total Expenses, and Net for each week, helping to analyze trends in the DAO's financial flows over time.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "bars",
            "fillOpacity": 70,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "normal"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Net (sum)"
            },
            "properties": [
              {
                "id": "custom.drawStyle",
                "value": "line"
              },
              {
                "id": "custom.stacking",
                "value": {
                  "group": "A",
                  "mode": "none"
                }
              },
              {
                "id": "custom.fillOpacity",
                "value": 19
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 12,
        "w": 24,
        "x": 0,
        "y": 4
      },
      "id": 11,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "12.1.1",
      "targets": [
        {
          "datasource": "PostgreSQL",
          "format": "table",
          "rawSql": "SELECT to_timestamp(timestamp) AS \"timestamp\", SUM(CASE WHEN top_category in ('Revenue', 'Other Income') THEN value_usd ELSE 0 END) AS \"Total Revenue\", SUM(CASE WHEN top_category in ('Cost of Revenue','Expenses','Other Expenses') THEN value_usd ELSE 0 END) * -1 AS \"Total Expenses\", SUM(CASE WHEN top_category in ('Revenue', 'Other Income') THEN value_usd ELSE 0 END) - SUM(CASE WHEN top_category in ('Cost of Revenue','Expenses','Other Expenses') THEN value_usd ELSE 0 END) AS \"Net\" FROM usdvalue_presum WHERE timestamp >= $__from/1000 AND timestamp <= $__to/1000 GROUP BY timestamp ORDER BY timestamp;",
          "refId": "A",
          "timeColumns": ["timestamp"]
        }
      ],
      "title": "Weekly Cashflow",
      "transformations": [
        {
          "id": "formatTime",
          "options": {
            "outputFormat": "YYYY-WW",
            "timeField": "timestamp",
            "timezone": "browser",
            "useTimezone": true
          }
        },
        {
          "id": "convertFieldType",
          "options": {
            "conversions": [
              {
                "dateFormat": "YYYY-WW",
                "destinationType": "time",
                "targetField": "timestamp"
              }
            ],
            "fields": {}
          }
        },
        {
          "id": "groupBy",
          "options": {
            "fields": {
              "Cost of Revenue": {
                "aggregations": ["sum"],
                "operation": "aggregate"
              },
              "Expenses": {
                "aggregations": ["sum"],
                "operation": "aggregate"
              },
              "Net": {
                "aggregations": ["sum"],
                "operation": "aggregate"
              },
              "Other Expenses": {
                "aggregations": ["sum"],
                "operation": "aggregate"
              },
              "Other Income": {
                "aggregations": ["sum"],
                "operation": "aggregate"
              },
              "Revenue": {
                "aggregations": ["sum"],
                "operation": "aggregate"
              },
              "Timestamp": {
                "aggregations": [],
                "operation": "groupby"
              },
              "Total Expenses": {
                "aggregations": ["sum"],
                "operation": "aggregate"
              },
              "Total Revenue": {
                "aggregations": ["sum"],
                "operation": "aggregate"
              },
              "timestamp": {
                "aggregations": [],
                "operation": "groupby"
              }
            }
          }
        }
      ],
      "type": "timeseries"
    }
  ],
  "preload": false,
  "refresh": "",
  "schemaVersion": 41,
  "tags": ["cashflow"],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-6M",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "",
  "title": "Total Cashflow Summary",
  "description": "Shows all sorted cashflows, including Revenue, Cost of Revenue, Expenses, Other Income, and Other Expense, but omits transactions pending categorization. Useful for analyzing the DAO's complete sorted financial flows.",
  "uid": "7e2b1c8a-4e2d-4b7a-9c1a-2f8e6b7d9c3f",
  "version": 107
}
