const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/markdown-input-CG6M9zD0.js","assets/vendor-tanstack-BcZfOOfy.js","assets/vendor-react-Bce9NwRC.js","assets/vendor-codemirror-LnHkUyAP.js","assets/index-B8vo2Lrg.js","assets/vendor-radix-BTiKGWfR.js","assets/vendor-recharts-BvvJP9Po.js","assets/vendor-forms-ClCIacbh.js","assets/vendor-date-wwuDAncJ.js","assets/index-m9O-nIOl.css"])))=>i.map(i=>d[i]);
import{j as e,r as c,s as G,d as Z,L as H}from"./vendor-tanstack-BcZfOOfy.js";import{dN as K,ag as M,ah as q,ai as J,aj as z,al as R,ak as $,am as B,an as V,b9 as X,cf as Y,T as ee,S as re,a as ae,b as oe,c as se,d as ne,e as W,dO as le,cZ as te,y as C,ap as f,p as ce,G as ie,L as me,q as Q}from"./index-B8vo2Lrg.js";import{u as de,L as ue}from"./schema-form-input-string-format-datetime-nrb3g-JJ.js";import"./toggle-group-7WUJn2Tx.js";import{F as pe,a as m,b as d,c as u,d as p,e as h}from"./form-mws4law8.js";import{T as he}from"./tags-input-DHrnkwjQ.js";import{W as je}from"./deployment-action-header-Vp9YsCJO.js";import{a as xe}from"./zod-Cuos7J7w.js";import{c as _e,o as A,s as y,r as be,b as ye,a as ge,u as ve,N as Se,e as Ce}from"./vendor-forms-ClCIacbh.js";const fe=({presetOptions:o=[],selected:s,onSelect:a})=>e.jsx(c.Suspense,{children:e.jsx(Ee,{presetOptions:o,selected:s,onSelect:a})}),Ee=({presetOptions:o=[],selected:s,onSelect:a})=>{const[t,n]=c.useState(""),{data:i}=G(K()),l=c.useDeferredValue(t),j=c.useMemo(()=>i.filter(r=>r.name.toLowerCase().includes(l.toLowerCase())),[i,l]),x=c.useMemo(()=>o.filter(r=>r.label.toLowerCase().includes(l.toLowerCase())),[l,o]);return e.jsxs(M,{children:[e.jsx(q,{selected:!!s,"aria-label":"Select a global concurrency limit",children:i.find(r=>r.id===s)?.name}),e.jsxs(J,{children:[e.jsx(z,{value:t,onValueChange:n,placeholder:"Search for a global concurrency limit..."}),e.jsx(R,{children:"No global concurrency limit found"}),e.jsx($,{children:e.jsxs(B,{children:[x.map(r=>e.jsx(V,{selected:s===r.value,onSelect:()=>{a(r.value),n("")},value:String(r.label),children:r.label},r.label)),j.map(r=>e.jsx(V,{selected:s===r.name,onSelect:N=>{a(N),n("")},value:r.id,children:r.name},r.id))]})})]})]})},Ne=c.lazy(()=>Y(()=>import("./markdown-input-CG6M9zD0.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])).then(o=>({default:o.MarkdownInput})));function we({className:o,...s}){return e.jsx(c.Suspense,{fallback:e.jsx(X,{className:`min-h-[200px] ${o??""}`}),children:e.jsx(Ne,{className:o,...s})})}const ke=({presetOptions:o=[],selected:s,onSelect:a})=>e.jsx(c.Suspense,{children:e.jsx(Le,{presetOptions:o,selected:s,onSelect:a})}),Le=({presetOptions:o=[],selected:s,onSelect:a})=>{const[t,n]=c.useState(""),{data:i}=G(ee()),l=c.useDeferredValue(t),j=c.useMemo(()=>i.filter(r=>r.name.toLowerCase().includes(l.toLowerCase())),[i,l]),x=c.useMemo(()=>o.filter(r=>r.label.toLowerCase().includes(l.toLowerCase())),[l,o]);return e.jsxs(M,{children:[e.jsx(q,{selected:!!s,"aria-label":"Select a work pool",children:s}),e.jsxs(J,{children:[e.jsx(z,{value:t,onValueChange:n,placeholder:"Search for a work pool..."}),e.jsx(R,{children:"No work pool found"}),e.jsx($,{children:e.jsxs(B,{children:[x.map(r=>e.jsx(V,{selected:s===r.value,onSelect:()=>{a(r.value),n("")},value:String(r.label),children:r.label},r.label)),j.map(r=>e.jsx(V,{selected:s===r.name,onSelect:N=>{a(N),n("")},value:r.name,children:r.name},r.id))]})})]})]})},E={ENQUEUE:"ENQUEUE",CANCEL_NEW:"CANCEL_NEW"},Fe=({onValueChange:o,value:s})=>e.jsxs(re,{value:s,onValueChange:a=>{o(a===""?void 0:a)},children:[e.jsx(ae,{children:e.jsx(oe,{placeholder:E.ENQUEUE})}),e.jsx(se,{children:e.jsxs(ne,{children:[e.jsx(W,{value:E.ENQUEUE,children:E.ENQUEUE}),e.jsx(W,{value:E.CANCEL_NEW,children:E.CANCEL_NEW})]})})]}),Ie=(o,{mode:s})=>A({name:y().refine(a=>s==="edit"?!0:a!==o.name,{message:"Name must be different from the original deployment"}),description:y().nullable().optional(),work_pool_name:y().nullable().optional(),work_queue_name:y().nullable().optional(),tags:ge(y()).optional(),concurrency_options:A({collision_strategy:Ce(["ENQUEUE","CANCEL_NEW"]).optional()}).nullable().optional(),job_variables:y().superRefine((a,t)=>{try{return a?JSON.parse(a):void 0}catch(n){return console.error(n),t.addIssue({code:"custom",message:"Invalid JSON"}),Se}}),enforce_parameter_schema:ye(),parameter_openapi_schema:be(ve()).optional().nullable().readonly(),global_concurrency_limit_id:y().uuid().optional().nullable()}),Ve={name:"",description:"",tags:[],job_variables:"",enforce_parameter_schema:!0,global_concurrency_limit_id:null},Oe=(o,{mode:s})=>{const a=Z(),t=_e({resolver:xe(Ie(o,{mode:s})),defaultValues:Ve}),{values:n,setValues:i,errors:l,validateForm:j}=de(),{createDeployment:x}=le(),{updateDeployment:r}=te();return c.useEffect(()=>{const{name:O,description:T,work_pool_name:w,work_queue_name:k,tags:L,concurrency_options:F,parameter_openapi_schema:I,enforce_parameter_schema:g,job_variables:v,global_concurrency_limit:S}=o;i(o.parameters),t.reset({description:T,name:O,work_pool_name:w,work_queue_name:k,tags:L,concurrency_options:F,parameter_openapi_schema:I,enforce_parameter_schema:g,job_variables:v?JSON.stringify(v):"",global_concurrency_limit_id:S?.id})},[t,o,i]),{form:t,onSave:async O=>{const{name:T,job_variables:w,description:k,work_pool_name:L,work_queue_name:F,tags:I,enforce_parameter_schema:g,concurrency_options:v,parameter_openapi_schema:S,global_concurrency_limit_id:U}=O,D=w?JSON.parse(w):void 0;if(S&&g)try{await j({schema:S})}catch(b){const _="Unknown error while updating validating schema.";C.error(_),console.error(_,b)}if(l.length>0)return;const P=v?.collision_strategy?{collision_strategy:v.collision_strategy}:void 0;switch(s){case"duplicate":x({concurrency_options:P,description:k,enforce_parameter_schema:g,flow_id:o.flow_id,job_variables:D,name:T,parameters:n,parameter_openapi_schema:S||void 0,paused:o.paused,tags:I,work_pool_name:L||null,work_queue_name:F||null,global_concurrency_limit_id:U},{onSuccess:({id:b})=>{C.success("Deployment created"),a({to:"/deployments/deployment/$id",params:{id:b}})},onError:b=>{const _=b.message||"Unknown error while creating deployment.";console.error(_),C.error(_)}});break;case"edit":r({concurrency_options:P,description:k,enforce_parameter_schema:g,id:o.id,job_variables:D,parameters:n,paused:o.paused,tags:I,work_pool_name:L||null,work_queue_name:F||null,global_concurrency_limit_id:U},{onSuccess:()=>{C.success("Deployment updated"),a({to:"/deployments/deployment/$id",params:{id:o.id}})},onError:b=>{const _=b.message||"Unknown error while updating deployment.";console.error(_),C.error(_)}});break}},parametersFormValues:n,setParametersFormValues:i,parameterFormErrors:l}},qe=({deployment:o,mode:s})=>{const{form:a,onSave:t,parameterFormErrors:n,setParametersFormValues:i,parametersFormValues:l}=Oe(o,{mode:s}),j=a.watch("work_pool_name"),x=a.getValues("parameter_openapi_schema");return e.jsx(pe,{...a,children:e.jsxs("form",{onSubmit:r=>{a.handleSubmit(t)(r)},className:"space-y-4",children:[e.jsx(m,{children:a.formState.errors.root?.message}),e.jsx(f,{variant:"h3",children:"General"}),e.jsx(d,{control:a.control,name:"name",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Name"}),e.jsx(h,{children:e.jsx(ce,{...r,value:r.value,disabled:s==="edit"})}),e.jsx(m,{})]})}),e.jsx(d,{control:a.control,name:"description",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Description (Optional)"}),e.jsx(h,{children:e.jsx(we,{"aria-label":"deployment description input",value:r.value??"",onChange:r.onChange})}),e.jsx(m,{})]})}),e.jsx(d,{control:a.control,name:"work_pool_name",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Work Pool (Optional)"}),e.jsx(h,{children:e.jsx(ke,{presetOptions:[{label:"None",value:""}],onSelect:r.onChange,selected:r.value})}),e.jsx(m,{})]})}),j&&e.jsx(d,{control:a.control,name:"work_queue_name",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Work Queue (Optional)"}),e.jsx(h,{children:e.jsx(je,{workPoolName:j,presetOptions:[{label:"None",value:""}],onSelect:r.onChange,selected:r.value})}),e.jsx(m,{})]})}),e.jsx(d,{control:a.control,name:"tags",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Tags (Optional)"}),e.jsx(h,{children:e.jsx(he,{...r})}),e.jsx(m,{})]})}),e.jsx(d,{control:a.control,name:"concurrency_options.collision_strategy",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:e.jsxs("div",{className:"col gap-1 mb-0.5",children:[e.jsx(f,{variant:"bodySmall",children:"Concurrency Limit Collision Strategy (Optional)"}),e.jsx(f,{variant:"bodySmall",className:"text-muted-foreground",children:"Configure behavior for runs once the concurrency limit is reached."})]})}),e.jsx(h,{children:e.jsx(Fe,{value:r.value,onValueChange:r.onChange})}),e.jsx(m,{})]})}),e.jsx(d,{control:a.control,name:"global_concurrency_limit_id",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Global concurrency limit"}),e.jsx(h,{children:e.jsx(fe,{presetOptions:[{label:"None",value:null}],onSelect:r.onChange,selected:r.value})}),e.jsx(m,{})]})}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx(f,{variant:"h3",className:"mb-4",children:"Parameters"}),x&&e.jsx(ue,{schema:x,errors:n,values:l,onValuesChange:i,kinds:["json"]}),e.jsx(d,{control:a.control,name:"enforce_parameter_schema",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Enforce Parameter Schema"}),e.jsx(h,{children:e.jsx(ie,{className:"block",checked:r.value,onCheckedChange:r.onChange})}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx(f,{variant:"h3",className:"mb-4",children:"Job Variables"}),e.jsx(d,{control:a.control,name:"job_variables",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Job Variables (Optional)"}),e.jsx(h,{children:e.jsx(me,{...r})}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(H,{to:"/deployments/deployment/$id",params:{id:o.id},children:e.jsx(Q,{variant:"secondary",children:"Cancel"})}),e.jsx(Q,{type:"submit",children:"Save"})]})]})})};export{qe as D};
//# sourceMappingURL=deployment-form-CJcg_6DJ.js.map
