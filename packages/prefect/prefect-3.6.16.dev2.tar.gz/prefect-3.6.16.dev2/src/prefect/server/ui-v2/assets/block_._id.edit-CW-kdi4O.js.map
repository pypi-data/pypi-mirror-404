{"version":3,"file":"block_._id.edit-CW-kdi4O.js","sources":["../../src/components/blocks/block-document-edit-page/block-document-edit-page-header.tsx","../../src/components/blocks/block-document-edit-page/block-document-edit-page.tsx","../../src/routes/blocks/block_.$id.edit.tsx?tsr-split=component"],"sourcesContent":["import type { BlockDocument } from \"@/api/block-documents\";\nimport {\n\tBreadcrumb,\n\tBreadcrumbItem,\n\tBreadcrumbLink,\n\tBreadcrumbList,\n\tBreadcrumbPage,\n\tBreadcrumbSeparator,\n} from \"@/components/ui/breadcrumb\";\n\ntype BlockDocumentEditPageHeaderProps = {\n\tblockDocument: BlockDocument;\n};\n\nexport const BlockDocumentEditPageHeader = ({\n\tblockDocument,\n}: BlockDocumentEditPageHeaderProps) => {\n\treturn (\n\t\t<Breadcrumb>\n\t\t\t<BreadcrumbList>\n\t\t\t\t<BreadcrumbItem>\n\t\t\t\t\t<BreadcrumbLink to=\"/blocks\" className=\"text-xl font-semibold\">\n\t\t\t\t\t\tBlocks\n\t\t\t\t\t</BreadcrumbLink>\n\t\t\t\t</BreadcrumbItem>\n\t\t\t\t<BreadcrumbSeparator />\n\n\t\t\t\t<BreadcrumbItem>\n\t\t\t\t\t<BreadcrumbLink\n\t\t\t\t\t\tto=\"/blocks/block/$id\"\n\t\t\t\t\t\tparams={{ id: blockDocument.id }}\n\t\t\t\t\t\tclassName=\"text-xl font-semibold\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{blockDocument.name ??\n\t\t\t\t\t\t\tblockDocument.block_type_name ??\n\t\t\t\t\t\t\tblockDocument.id}\n\t\t\t\t\t</BreadcrumbLink>\n\t\t\t\t</BreadcrumbItem>\n\t\t\t\t<BreadcrumbSeparator />\n\n\t\t\t\t<BreadcrumbItem className=\"text-xl font-semibold\">\n\t\t\t\t\t<BreadcrumbPage>Edit</BreadcrumbPage>\n\t\t\t\t</BreadcrumbItem>\n\t\t\t</BreadcrumbList>\n\t\t</Breadcrumb>\n\t);\n};\n","import { Link, useNavigate } from \"@tanstack/react-router\";\nimport { type FormEvent, useEffect } from \"react\";\nimport { toast } from \"sonner\";\nimport {\n\ttype BlockDocument,\n\tuseUpdateBlockDocument,\n} from \"@/api/block-documents\";\nimport { BlockTypeDetails } from \"@/components/blocks/block-type-details\";\nimport {\n\tLazySchemaForm,\n\ttype PrefectSchemaObject,\n\tuseSchemaForm,\n} from \"@/components/schemas\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { BlockDocumentEditPageHeader } from \"./block-document-edit-page-header\";\n\ntype BlockDocumentEditPageProps = {\n\tblockDocument: BlockDocument;\n};\n\nexport const BlockDocumentEditPage = ({\n\tblockDocument,\n}: BlockDocumentEditPageProps) => {\n\tconst navigate = useNavigate();\n\tconst { values, setValues, errors, validateForm } = useSchemaForm();\n\tconst { updateBlockDocument, isPending } = useUpdateBlockDocument();\n\n\t// sync up values with block document values\n\tuseEffect(() => {\n\t\tif (blockDocument.data) {\n\t\t\tsetValues(blockDocument.data);\n\t\t}\n\t}, [blockDocument.data, setValues]);\n\n\tconst handleSubmit = async (event: FormEvent) => {\n\t\tevent.preventDefault();\n\t\ttry {\n\t\t\tawait validateForm({ schema: values });\n\t\t\tupdateBlockDocument(\n\t\t\t\t{\n\t\t\t\t\tid: blockDocument.id,\n\t\t\t\t\tdata: values,\n\t\t\t\t\tmerge_existing_data: false,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tonSuccess: () => {\n\t\t\t\t\t\ttoast.success(\"Block updated successfully\");\n\t\t\t\t\t\tvoid navigate({\n\t\t\t\t\t\t\tto: \"/blocks/block/$id\",\n\t\t\t\t\t\t\tparams: { id: blockDocument.id },\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tonError: (err) => {\n\t\t\t\t\t\tconst message = \"Unknown error while updating block.\";\n\t\t\t\t\t\ttoast.error(message);\n\t\t\t\t\t\tconsole.error(message, err);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\t\t} catch (err) {\n\t\t\tconst message = \"Unknown error while validating block data.\";\n\t\t\ttoast.error(message);\n\t\t\tconsole.error(message, err);\n\t\t}\n\t};\n\n\treturn (\n\t\t<div className=\"flex flex-col gap-6\">\n\t\t\t<BlockDocumentEditPageHeader blockDocument={blockDocument} />\n\t\t\t<Card className=\" p-6 grid grid-cols-[minmax(0,_1fr)_250px] gap-4 \">\n\t\t\t\t<form\n\t\t\t\t\tclassName=\"flex flex-col gap-4\"\n\t\t\t\t\tonSubmit={(e) => void handleSubmit(e)}\n\t\t\t\t>\n\t\t\t\t\t<LazySchemaForm\n\t\t\t\t\t\tvalues={values}\n\t\t\t\t\t\tonValuesChange={setValues}\n\t\t\t\t\t\terrors={errors}\n\t\t\t\t\t\tkinds={[\"json\"]}\n\t\t\t\t\t\tschema={\n\t\t\t\t\t\t\t(blockDocument?.block_schema?.fields ??\n\t\t\t\t\t\t\t\t{}) as unknown as PrefectSchemaObject\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t\t<div className=\"flex gap-3 justify-end\">\n\t\t\t\t\t\t<Button variant=\"secondary\">\n\t\t\t\t\t\t\t<Link to=\"/blocks/block/$id\" params={{ id: blockDocument.id }}>\n\t\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button loading={isPending} type=\"submit\">\n\t\t\t\t\t\t\tSave\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\n\t\t\t\t{blockDocument.block_type && (\n\t\t\t\t\t<BlockTypeDetails blockType={blockDocument.block_type} />\n\t\t\t\t)}\n\t\t\t</Card>\n\t\t</div>\n\t);\n};\n","import { useSuspenseQuery } from \"@tanstack/react-query\";\nimport { createFileRoute } from \"@tanstack/react-router\";\nimport { buildGetBlockDocumentQuery } from \"@/api/block-documents\";\nimport { BlockDocumentEditPage } from \"@/components/blocks/block-document-edit-page\";\n\nexport const Route = createFileRoute(\"/blocks/block_/$id/edit\")({\n\tcomponent: RouteComponent,\n\tloader: ({ params, context: { queryClient } }) =>\n\t\tqueryClient.ensureQueryData(buildGetBlockDocumentQuery(params.id)),\n\twrapInSuspense: true,\n});\n\nfunction RouteComponent() {\n\tconst { id } = Route.useParams();\n\tconst { data } = useSuspenseQuery(buildGetBlockDocumentQuery(id));\n\treturn <BlockDocumentEditPage blockDocument={data} />;\n}\n"],"names":["BlockDocumentEditPageHeader","blockDocument","jsx","Breadcrumb","jsxs","BreadcrumbList","BreadcrumbItem","BreadcrumbLink","BreadcrumbSeparator","BreadcrumbPage","BlockDocumentEditPage","navigate","useNavigate","values","setValues","errors","validateForm","useSchemaForm","updateBlockDocument","isPending","useUpdateBlockDocument","useEffect","handleSubmit","event","toast","err","message","Card","e","LazySchemaForm","Button","Link","BlockTypeDetails","RouteComponent","id","Route","useParams","data","useSuspenseQuery","buildGetBlockDocumentQuery"],"mappings":"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"}