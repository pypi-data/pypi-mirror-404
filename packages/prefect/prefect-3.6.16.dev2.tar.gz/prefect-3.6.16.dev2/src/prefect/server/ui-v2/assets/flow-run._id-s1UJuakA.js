const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/flow-run-graph-ckiE3mA9.js","assets/vendor-tanstack-BcZfOOfy.js","assets/vendor-react-Bce9NwRC.js","assets/vendor-graphs-_sWgqfe-.js","assets/index-B8vo2Lrg.js","assets/vendor-radix-BTiKGWfR.js","assets/vendor-recharts-BvvJP9Po.js","assets/vendor-forms-ClCIacbh.js","assets/vendor-date-wwuDAncJ.js","assets/index-m9O-nIOl.css","assets/state-colors-CAAf0Eg3.js","assets/key-value-XHEZOtZX.js","assets/event-resource-display-CDRgVKd4.js"])))=>i.map(i=>d[i]);
import{j as e,r as n,s as $,t as D,L as G,I as Ge,n as J,g as Qe,d as Ve}from"./vendor-tanstack-BcZfOOfy.js";import{b9 as x,cf as Be,cg as $e,q as b,ch as qe,a_ as K,bz as We,C as he,o as pe,c9 as He,bP as te,$ as je,ci as q,aR as ge,cj as fe,ck as ye,cl as Ne,cm as ve,cn as _e,au as C,ao as B,i as be,co as Se,cp as Ce,cq as we,y,a2 as X,a3 as Y,a4 as Z,a5 as ee,a6 as se,p as Je,cr as ke,a7 as ae,cs as De,ct as re,cu as Ke,aH as Fe,B as Xe,g as Ye,h as le,bw as Ze,bF as es,bH as ss,H as as,I as _,aQ as ts,c8 as rs,bT as ls,bU as ns,bV as is,bW as os,cv as cs,cb as ds,S as Te,a as Ee,c as Ae,e as H,b as us,bQ as Le,aG as ms,aI as ne,af as xs,ap as U,V as Pe,cw as ie,cx as W,aJ as oe,ar as hs,cy as ps,cz as js,cA as gs,cB as fs,cC as ys,L as ce,aA as Ns,aB as vs,aC as L,aD as P,cD as de}from"./index-B8vo2Lrg.js";import{R as _s,b as bs,C as Ss,a as Cs,u as ws}from"./use-state-favicon-au2TZdMV.js";import{A as ks}from"./artifact-card-BclosG8t.js";import{T as Ds,a as ue}from"./toggle-group-7WUJn2Tx.js";import{K as S}from"./key-value-XHEZOtZX.js";import{u as Fs,L as Ts}from"./schema-form-input-string-format-datetime-nrb3g-JJ.js";import{L as Es}from"./lazy-markdown-1Hz0xzca.js";import{D as As}from"./delete-confirmation-dialog-CwDK_2QS.js";import{u as Ls}from"./use-delete-confirmation-dialog-CUdii6Lo.js";import{D as Ie,a as ze,b as Re,d as w,e as Ps}from"./dropdown-menu-D7Gwbd15.js";import{S as Is}from"./sort-filter-Cv8zAXMp.js";import{S as zs,a as Rs,F as Ms}from"./flow-runs-pagination-SLbYtvaR.js";import{T as Os,b as Us,a as Gs}from"./task-runs-pagination-DUy3147A.js";import{T as Qs}from"./tags-input-DHrnkwjQ.js";import{o as Vs,e as Bs}from"./vendor-forms-ClCIacbh.js";import"./vendor-react-Bce9NwRC.js";import"./vendor-radix-BTiKGWfR.js";import"./vendor-recharts-BvvJP9Po.js";import"./vendor-date-wwuDAncJ.js";import"./index-D6ynV6U7.js";import"./zod-Cuos7J7w.js";import"./use-debounce-callback-CSs1BjLI.js";import"./timezone-select-D4Q6VBtD.js";import"./form-mws4law8.js";const $s=["RUNNING","SCHEDULED","PENDING","PAUSED"],qs=["COMPLETED","FAILED","CANCELLED","CRASHED"];function Ws(s){return s!=null&&$s.includes(s)}function Hs(s){return s==="RUNNING"}function Js(s){return s==="PAUSED"}function Ks(s){return s!=null&&qs.includes(s)}const Xs=n.lazy(()=>Be(()=>import("./flow-run-graph-ckiE3mA9.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])).then(s=>({default:s.FlowRunGraph})));function Ys(s){return e.jsx(n.Suspense,{fallback:e.jsx(x,{className:"h-[500px] w-full"}),children:e.jsx(Xs,{...s})})}class Q extends n.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}render(){if(this.state.hasError){const{fallback:t}=this.props;return typeof t=="function"?t(this.state.error??new Error("Unknown error")):t}return this.props.children}}function V({error:s,onRetry:t,isRetrying:a}){return e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx("div",{className:"rounded-full bg-destructive/10 p-2 mb-3",children:e.jsx($e,{className:"size-6 text-destructive"})}),e.jsxs("div",{className:"space-y-1 mb-4",children:[e.jsx("p",{className:"font-medium",children:s.message}),s.details&&e.jsx("p",{className:"text-xs text-muted-foreground max-w-sm",children:s.details})]}),t&&e.jsxs(b,{variant:"outline",size:"sm",onClick:t,disabled:a,className:"gap-2",children:[e.jsx(qe,{className:K("size-3",a&&"animate-spin")}),a?"Retrying...":"Retry"]})]})}const Zs=({flowRun:s})=>{const[t,a]=n.useState("grid"),{data:c}=$(We({artifacts:{operator:"and_",flow_run_id:{any_:[s.id]},type:{not_any_:["result"]}},sort:"ID_DESC",offset:0}));return c.length===0?e.jsx(he,{children:e.jsx(pe,{className:"text-center",children:e.jsxs("p",{children:["This flow run did not produce any artifacts; for more information on creating artifacts, see the"," ",e.jsx("a",{href:"https://docs.prefect.io/v3/develop/artifacts",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500",children:"documentation"}),"."]})})}):e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(Ds,{type:"single",variant:"outline",value:t,onValueChange:r=>a(r),children:[e.jsx(ue,{value:"grid","aria-label":"Grid view",children:e.jsx(He,{className:"w-4 h-4"})}),e.jsx(ue,{value:"list","aria-label":"List view",children:e.jsx(_s,{className:"w-4 h-4"})})]})}),e.jsx("div",{className:K("grid",t==="grid"?"grid-cols-1 lg:grid-cols-2 xl:grid-cols-3":"grid-cols-1","gap-4"),"data-testid":"flow-run-artifacts-grid",children:c.map(r=>e.jsx(ks,{artifact:r,compact:t==="list"},r.id))})]})};function ea({flowRun:s}){return s?e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{label:"Run Count",value:s.run_count}),e.jsx(S,{label:"Created",value:e.jsx(te,{date:s.created})}),s.created_by?.display_value&&e.jsx(S,{label:"Created By",value:s.created_by.display_value}),e.jsx(S,{label:"Last Updated",value:e.jsx(te,{date:s.updated})}),s.idempotency_key&&e.jsx(S,{label:"Idempotency Key",value:s.idempotency_key}),s.tags&&s.tags.length>0&&e.jsx(S,{label:"Tags",value:e.jsx(je,{tags:s.tags})}),e.jsx(S,{label:"Flow Run ID",value:s.id,copyable:!0}),s.state?.message&&e.jsx(S,{label:"State Message",value:s.state.message}),s.flow_version&&e.jsx(S,{label:"Flow Version",value:s.flow_version}),s.empirical_policy?.retries!=null&&e.jsxs(e.Fragment,{children:[e.jsx(S,{label:"Retries",value:s.empirical_policy.retries}),e.jsx(S,{label:"Retry Delay",value:s.empirical_policy.retry_delay})]})]}):e.jsx("div",{className:"flex flex-col gap-2 bg-gray-100 p-4 rounded-md",children:e.jsx("span",{className:"text-gray-500",children:"No flow run details available"})})}const sa=({flowRun:s,open:t,onOpenChange:a})=>{const[c,r]=n.useState(!1),{setFlowRunState:m,isPending:o}=q(),{data:d=[]}=D({...ge({flow_runs:{operator:"and_",parent_flow_run_id:{operator:"and_",any_:[s.id]},state:{operator:"and_",type:{any_:["RUNNING","SCHEDULED","PENDING","PAUSED"]}}},sort:"START_TIME_DESC",limit:100,offset:0}),enabled:t}),i=d.length>0,j=u=>{for(const h of d)m({id:h.id,state:{type:"CANCELLING",name:"Cancelling"},force:!0},{onError:()=>{u.push(h.name??h.id)}})},l=()=>{m({id:s.id,state:{type:"CANCELLING",name:"Cancelling"},force:!0},{onSuccess:()=>{if(c&&d.length>0){const u=[];j(u),u.length>0?y.error(`Failed to cancel some sub-flows: ${u.join(", ")}`):y.success(`Flow run and ${d.length} sub-flow${d.length===1?"":"s"} cancelled`)}else y.success("Flow run cancelled");a(!1)},onError:u=>{y.error(u.message||"Failed to cancel flow run")}})};return e.jsx(fe,{open:t,onOpenChange:a,children:e.jsxs(ye,{children:[e.jsxs(Ne,{children:[e.jsx(ve,{children:"Cancel Flow Run"}),e.jsx(_e,{asChild:!0,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{children:["Are you sure you want to cancel"," ",e.jsx("span",{className:"font-medium",children:s.name}),"?"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Current state:"}),s.state_type&&s.state_name&&e.jsx(C,{type:s.state_type,name:s.state_name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Will become:"}),e.jsx(C,{type:"CANCELLING",name:"Cancelling"})]})]})})]}),i&&e.jsxs("div",{className:"flex items-center space-x-2 py-2",children:[e.jsx(B,{id:"cancel-subflows",checked:c,onCheckedChange:u=>r(u===!0)}),e.jsxs(be,{htmlFor:"cancel-subflows",className:"text-sm cursor-pointer",children:["Also cancel ",d.length," sub-flow run",d.length===1?"":"s"]})]}),e.jsxs(Se,{children:[e.jsx(Ce,{disabled:o,children:"Cancel"}),e.jsx(we,{onClick:u=>{u.preventDefault(),l()},disabled:o,children:o?"Cancelling...":"Cancel Flow Run"})]})]})})},aa=({flowRun:s,open:t,onOpenChange:a})=>{const[c,r]=n.useState(300),{setFlowRunState:m,isPending:o}=q(),d=()=>{const j=new Date(Date.now()+c*1e3).toISOString();m({id:s.id,state:{type:"PAUSED",name:"Suspended",state_details:{pause_timeout:j,pause_reschedule:!0,deferred:!1,untrackable_result:!1}},force:!0},{onSuccess:()=>{y.success("Flow run paused"),a(!1)},onError:l=>{y.error(l.message||"Failed to pause flow run")}})},i=c>=5;return e.jsx(X,{open:t,onOpenChange:a,children:e.jsxs(Y,{children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Pause Flow Run"}),e.jsx(se,{asChild:!0,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{children:["Pause ",e.jsx("span",{className:"font-medium",children:s.name})," for a specified duration. The flow will automatically resume after the timeout."]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Current state:"}),s.state_type&&s.state_name&&e.jsx(C,{type:s.state_type,name:s.state_name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Will become:"}),e.jsx(C,{type:"PAUSED",name:"Suspended"})]})]})})]}),e.jsxs("div",{className:"space-y-2 py-4",children:[e.jsx(be,{htmlFor:"timeout",children:"Timeout (seconds)"}),e.jsx(Je,{id:"timeout",type:"number",min:5,value:c,onChange:j=>r(Number.parseInt(j.target.value,10)||5)}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Will pause for ",ke(c),". Minimum 5 seconds."]})]}),e.jsxs(ae,{children:[e.jsx(b,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:o,children:"Cancel"}),e.jsx(b,{onClick:d,disabled:o||!i,loading:o,children:"Pause Flow Run"})]})]})})},ta=({flowRun:s,open:t,onOpenChange:a})=>{const c=s.state?.state_details?.run_input_keyset;return c&&c.schema?e.jsx(X,{open:t,onOpenChange:a,children:e.jsx(Y,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:e.jsx(n.Suspense,{fallback:e.jsx(Me,{}),children:e.jsx(la,{flowRun:s,keyset:c,onOpenChange:a})})})}):e.jsx(ra,{flowRun:s,open:t,onOpenChange:a})},ra=({flowRun:s,open:t,onOpenChange:a})=>{const{resumeFlowRun:c,isPending:r}=De(),m=()=>{c({id:s.id},{onSuccess:()=>{y.success("Flow run resumed"),a(!1)},onError:o=>{y.error(o.message||"Failed to resume flow run")}})};return e.jsx(X,{open:t,onOpenChange:a,children:e.jsxs(Y,{children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Resume Flow Run"}),e.jsx(se,{asChild:!0,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{children:["Resume the paused flow run"," ",e.jsx("span",{className:"font-medium",children:s.name}),"?"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Current state:"}),s.state_type&&s.state_name&&e.jsx(C,{type:s.state_type,name:s.state_name})]})]})})]}),e.jsxs(ae,{children:[e.jsx(b,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:r,children:"Cancel"}),e.jsx(b,{onClick:m,disabled:r,loading:r,children:"Resume"})]})]})})},la=({flowRun:s,keyset:t,onOpenChange:a})=>{const{resumeFlowRun:c,isPending:r}=De(),{values:m,setValues:o,errors:d,validateForm:i}=Fs(),{data:j}=D({...re(s.id,t.schema),select:h=>h}),{data:l}=D({...re(s.id,t.description??""),enabled:!!t.description,select:h=>h});n.useEffect(()=>{o({})},[o]);const u=async()=>{if(j)try{if(await i({schema:m}),d.length>0)return;c({id:s.id,runInput:m},{onSuccess:()=>{y.success("Flow run resumed"),a(!1)},onError:h=>{y.error(h.message||"Failed to resume flow run")}})}catch{y.error("Failed to validate input")}};return j?e.jsxs(e.Fragment,{children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Resume Flow Run"}),e.jsx(se,{asChild:!0,children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:["Provide input to resume"," ",e.jsx("span",{className:"font-medium",children:s.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Current state:"}),s.state_type&&s.state_name&&e.jsx(C,{type:s.state_type,name:s.state_name})]})]})})]}),l&&e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none py-2 px-3 bg-muted/50 rounded-md",children:e.jsx(Es,{children:l})}),e.jsx("div",{className:"py-4",children:e.jsx(Ts,{schema:j,values:m,onValuesChange:o,errors:d,kinds:["json"]})}),e.jsxs(ae,{children:[e.jsx(b,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:r,children:"Cancel"}),e.jsx(b,{onClick:()=>{u()},disabled:r,loading:r,children:"Resume"})]})]}):e.jsx(Me,{})},Me=()=>e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(x,{className:"h-6 w-48"}),e.jsx(x,{className:"h-4 w-full"}),e.jsx(x,{className:"h-32 w-full"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(x,{className:"h-10 w-20"}),e.jsx(x,{className:"h-10 w-20"})]})]}),na=({flowRun:s,open:t,onOpenChange:a})=>{const{setFlowRunState:c,isPending:r}=q(),m=()=>{c({id:s.id,state:{type:"SCHEDULED",name:"AwaitingRetry",message:"Retry from the UI"},force:!0},{onSuccess:()=>{y.success("Flow run scheduled for retry"),a(!1)},onError:o=>{y.error(o.message||"Failed to retry flow run")}})};return e.jsx(fe,{open:t,onOpenChange:a,children:e.jsxs(ye,{children:[e.jsxs(Ne,{children:[e.jsx(ve,{children:"Retry Flow Run"}),e.jsx(_e,{asChild:!0,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{children:["Retry the flow run"," ",e.jsx("span",{className:"font-medium",children:s.name}),"?"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Current state:"}),s.state_type&&s.state_name&&e.jsx(C,{type:s.state_type,name:s.state_name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Will become:"}),e.jsx(C,{type:"SCHEDULED",name:"AwaitingRetry"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Task runs with persisted results will use cached values. Task runs without persisted results will be re-executed."})]})})]}),e.jsxs(Se,{children:[e.jsx(Ce,{disabled:r,children:"Cancel"}),e.jsx(we,{onClick:o=>{o.preventDefault(),m()},disabled:r,children:r?"Retrying...":"Retry"})]})]})})};function ia({flowRun:s,onDeleteClick:t}){const[a,c]=Ls(),{open:r,onOpenChange:m,openDialog:o}=bs(),[d,i]=n.useState(!1),[j,l]=n.useState(!1),[u,h]=n.useState(!1),[v,g]=n.useState(!1),{setFlowRunState:F,isPending:T}=q(),E=s.state_type&&["COMPLETED","FAILED","CANCELLED","CRASHED"].includes(s.state_type),A=Ws(s.state_type)&&s.deployment_id,I=Hs(s.state_type)&&s.deployment_id,z=Js(s.state_type),R=Ks(s.state_type)&&s.deployment_id,M=k=>{F({id:s.id,state:{type:k.type,name:k.type.charAt(0)+k.type.slice(1).toLowerCase(),message:k.message},force:!0},{onSuccess:()=>{y.success("Flow run state changed"),m(!1)},onError:Ue=>{y.error(Ue.message||"Failed to change state")}})},{data:N}=D({...Ke(s.deployment_id??""),enabled:!!s.deployment_id}),{data:p}=D({...Fe({task_runs:{operator:"and_",flow_run_id:{operator:"and_",any_:[s.id],is_null_:!1}}})}),{data:f}=D({...ge({sort:"START_TIME_DESC",offset:0,limit:1,task_runs:{operator:"and_",id:{any_:[s.parent_task_run_id??""]}}}),enabled:!!s.parent_task_run_id}),O=f?.[0],Oe=k=>k===void 0?"...":k===0?"None":`${k} Task run${k===1?"":"s"}`;return e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(Xe,{children:e.jsxs(Ye,{children:[e.jsx(le,{children:e.jsx(Ze,{to:"/runs",className:"text-xl font-semibold",children:"Runs"})}),e.jsx(es,{}),e.jsxs(le,{className:"text-xl",children:[e.jsx(ss,{className:"font-semibold",children:s.name}),s.work_pool_name&&e.jsx(as,{variant:"outline",className:"ml-2",children:s.work_pool_name}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"ml-2",children:e.jsx(je,{tags:s.tags,maxTagsDisplayed:3})})]})]})}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[s.state_type&&s.state_name&&e.jsx(C,{type:s.state_type,name:s.state_name}),s.start_time&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{id:"Calendar",className:"size-4"}),e.jsx("span",{children:ts(s.start_time,"dateTimeNumeric")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{id:"Clock",className:"size-4"}),e.jsx("span",{children:ke(s.total_run_time??0)})]}),e.jsxs("div",{className:`flex items-center gap-1 ${p===0?"text-muted-foreground/60":""}`,children:[e.jsx(_,{id:"ListTodo",className:"size-4"}),e.jsx("span",{children:Oe(p)})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm flex-wrap",children:[s.flow_id&&e.jsx(rs,{flowId:s.flow_id}),s.deployment_id&&e.jsxs(G,{to:"/deployments/deployment/$id",params:{id:s.deployment_id},className:"flex items-center gap-1 hover:underline",children:[e.jsx(_,{id:"Rocket",className:"size-4"}),e.jsx("span",{className:"text-muted-foreground",children:"Deployment"}),e.jsx("span",{children:N?.name??"..."})]}),s.work_pool_name&&e.jsxs(G,{to:"/work-pools/work-pool/$workPoolName",params:{workPoolName:s.work_pool_name},className:"flex items-center gap-1 hover:underline",children:[e.jsx(_,{id:"Server",className:"size-4"}),e.jsx("span",{className:"text-muted-foreground",children:"Work Pool"}),e.jsx("span",{children:s.work_pool_name})]}),s.work_pool_name&&s.work_queue_name&&e.jsxs(G,{to:"/work-pools/work-pool/$workPoolName",params:{workPoolName:s.work_pool_name},search:{tab:"Work Queues"},className:"flex items-center gap-1 hover:underline",children:[e.jsx(_,{id:"ListOrdered",className:"size-4"}),e.jsx("span",{className:"text-muted-foreground",children:"Work Queue"}),e.jsx("span",{children:s.work_queue_name})]}),O&&e.jsxs(G,{to:"/runs/flow-run/$id",params:{id:O.id},className:"flex items-center gap-1 hover:underline",children:[e.jsx(_,{id:"Workflow",className:"size-4"}),e.jsx("span",{className:"text-muted-foreground",children:"Parent Run"}),e.jsx("span",{children:O.name??"..."})]})]})]}),e.jsxs(Ie,{children:[e.jsx(ze,{asChild:!0,children:e.jsx(b,{variant:"outline",className:"p-2",children:e.jsx(ls,{className:"w-4 h-4"})})}),e.jsxs(Re,{children:[A&&e.jsx(w,{onClick:()=>i(!0),children:"Cancel"}),I&&e.jsx(w,{onClick:()=>l(!0),children:"Pause"}),z&&e.jsx(w,{onClick:()=>h(!0),children:"Resume"}),R&&e.jsx(w,{onClick:()=>g(!0),children:"Retry"}),E&&e.jsx(w,{onClick:o,children:"Change state"}),(A||I||z||R||E)&&e.jsx(Ps,{}),e.jsx(w,{onClick:()=>{navigator.clipboard.writeText(s.id),y.success("Copied flow run ID to clipboard")},children:"Copy ID"}),e.jsx(w,{onClick:()=>c({title:"Delete Flow Run",description:`Are you sure you want to delete flow run ${s.name}?`,onConfirm:t}),children:"Delete"})]})]}),e.jsx(As,{...a}),e.jsx(Ss,{open:r,onOpenChange:m,currentState:s.state?{type:s.state.type,name:s.state.name??s.state.type.charAt(0)+s.state.type.slice(1).toLowerCase()}:null,label:"Flow Run",onConfirm:M,isLoading:T}),e.jsx(sa,{flowRun:s,open:d,onOpenChange:i}),e.jsx(aa,{flowRun:s,open:j,onOpenChange:l}),e.jsx(ta,{flowRun:s,open:u,onOpenChange:h}),e.jsx(na,{flowRun:s,open:v,onOpenChange:g})]})}function oa({flowRun:s}){const[t,a]=n.useState(!1),c=async()=>{a(!0);try{const m=await(await cs()).GET("/flow_runs/{id}/logs/download",{params:{path:{id:s.id}},parseAs:"blob"});if(!m.data)throw new Error("No data received from server");const o=URL.createObjectURL(m.data),d=document.createElement("a"),i=s.name??"logs";d.href=o,d.setAttribute("download",`${i}.csv`),d.click(),URL.revokeObjectURL(o)}catch(r){console.error(r),y.error("Failed to download logs")}finally{a(!1)}};return e.jsxs(ns,{children:[e.jsx(is,{asChild:!0,children:e.jsx(b,{variant:"outline",size:"icon",onClick:()=>{c()},disabled:t,"aria-label":"Download logs",children:t?e.jsx(_,{id:"Loader2",className:"size-4 animate-spin"}):e.jsx(_,{id:"Download",className:"size-4"})})}),e.jsx(os,{children:"Download all logs as CSV"})]})}const ca=({flowRun:s,virtualize:t=!0})=>{const[a,c]=n.useState(0),[r,m]=n.useState("TIMESTAMP_ASC"),o=n.useMemo(()=>({...ds({limit:50,sort:r,logs:{operator:"and_",level:{ge_:a},flow_run_id:{any_:[s.id]}}}),refetchInterval:s.state_type==="RUNNING"?5e3:!1}),[a,r,s.id,s.state_type]),{data:d,hasNextPage:i,fetchNextPage:j,isFetchingNextPage:l}=Ge(o),u=d.pages.length===1&&d.pages[0].length===0;let h="This run did not produce any logs.";return u&&(a>0?h="No logs match your filter criteria":s.state_type==="SCHEDULED"&&s.state_name==="Scheduled"?h="Run has not yet started. Check back soon for logs.":s.state_type==="RUNNING"&&(h="Waiting for logs...")),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-row gap-2 justify-end",children:[e.jsx(da,{levelFilter:a,setLevelFilter:c}),e.jsx(ua,{sortOrder:r,setSortOrder:m}),e.jsx(oa,{flowRun:s})]}),u?e.jsx("div",{className:"flex flex-col gap-2 text-center bg-muted p-2 rounded-md",children:e.jsx("span",{className:"text-muted-foreground",children:h})}):e.jsx("div",{className:"rounded-md",children:e.jsx(Cs,{logs:d.pages.flat(),onBottomReached:()=>{i&&!l&&j().catch(v=>{console.error(v)})},className:"max-h-[85vh]",virtualize:t})})]})},me=[{label:"All",value:0},{label:"Critical only",value:50},{label:"Error and above",value:40},{label:"Warning and above",value:30},{label:"Info and above",value:20},{label:"Debug and above",value:10}],da=({levelFilter:s,setLevelFilter:t})=>e.jsxs(Te,{value:s.toString(),onValueChange:a=>t(Number(a)),children:[e.jsx(Ee,{"aria-label":"log level filter",children:e.jsx("span",{children:`Level:
							${me.find(a=>a.value===s)?.label}`})}),e.jsx(Ae,{children:me.map(a=>e.jsx(H,{value:a.value.toString(),children:a.label},a.value))})]}),ua=({sortOrder:s,setSortOrder:t})=>e.jsxs(Te,{value:s,onValueChange:a=>t(a),children:[e.jsx(Ee,{"aria-label":"log sort order",children:e.jsx(us,{placeholder:"Sort log order"})}),e.jsxs(Ae,{children:[e.jsx(H,{value:"TIMESTAMP_ASC",children:"Oldest to newest"}),e.jsx(H,{value:"TIMESTAMP_DESC",children:"Newest to oldest"})]})]}),ma=({parentFlowRunId:s})=>{const t=J(),[a,c]=n.useState(""),[r,m]=n.useState(new Set),[o,d]=n.useState("START_TIME_DESC"),[i,j]=n.useState({page:1,limit:10}),l=Le(a,300),u=n.useMemo(()=>({flow_runs:{operator:"and_",parent_flow_run_id:{operator:"and_",any_:[s]}}}),[s]),{data:h}=$(ms(u,3e4)),v=n.useMemo(()=>({page:i.page,limit:i.limit,sort:o,flow_runs:{operator:"and_",parent_flow_run_id:{operator:"and_",any_:[s]},name:l?{like_:l}:void 0,state:r.size>0?{operator:"and_",name:{any_:Array.from(r)}}:void 0}}),[s,i,o,l,r]),{data:g}=D(ne(v,3e4)),F=n.useMemo(()=>[...new Set((g?.results??[]).map(p=>p.flow_id))],[g?.results]),{data:T}=D(xs({flows:{operator:"and_",id:{any_:F}},offset:0,sort:"NAME_ASC"},{enabled:F.length>0})),E=n.useMemo(()=>{if(!g?.results)return[];const p=new Map(T?.map(f=>[f.id,f])??[]);return g.results.map(f=>{const O=p.get(f.flow_id);return O?{...f,flow:O}:{...f,flow:void 0}}).filter(f=>f!==null)},[g?.results,T]),A=p=>{c(p.target.value),j(f=>({...f,page:1}))},I=p=>{m(p),j(f=>({...f,page:1}))},z=p=>{d(p),j(f=>({...f,page:1}))},R=()=>{c(""),m(new Set),j(p=>({...p,page:1}))},M=p=>{t.prefetchQuery(ne({...v,page:p},3e4))},N=a||r.size>0;return h===0?e.jsx("div",{className:"flex items-center justify-center h-48 border rounded-lg bg-muted/50",children:e.jsx(U,{className:"text-muted-foreground",children:"No subflow runs found for this flow run."})}):e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-12 items-center gap-2",children:[e.jsx("div",{className:"flex flex-col gap-1 xl:col-span-3 md:col-span-12 col-span-6 md:order-0 order-2",children:e.jsxs(U,{variant:"bodySmall",className:"text-muted-foreground",children:[h," Subflow run",h!==1?"s":""]})}),e.jsx("div",{className:"xl:col-span-4 col-span-12 md:order-1 order-0",children:e.jsx(Pe,{value:a,onChange:A,placeholder:"Search by run name","aria-label":"Search by run name",debounceMs:300})}),e.jsx("div",{className:"xl:col-span-3 md:col-span-6 col-span-12 md:order-2 order-1",children:e.jsx(zs,{selectedFilters:r,onSelectFilter:I})}),e.jsx("div",{className:"xl:border-l xl:border-border xl:pl-2 xl:col-span-2 md:col-span-6 col-span-6 md:order-3 order-3",children:e.jsx(Is,{value:o,onSelect:z})})]}),e.jsx(Rs,{flowRuns:E,onClearFilters:N?R:void 0}),g&&g.pages>0&&e.jsx(Ms,{pagination:i,onChangePagination:j,count:g.count,pages:g.pages,onPrefetchPage:M})]})},xe=2,xa=({selectedFilters:s,onSelectFilter:t,className:a})=>{const[c,r]=n.useState(!1),m=n.useMemo(()=>{const l=new Set(ie);return s.has("Scheduled")||l.size!==s.size?!1:Array.from(s).every(u=>l.has(u))},[s]),o=()=>{t(new Set(ie))},d=()=>{t(new Set)},i=l=>{if(m){t(new Set([l]));return}const u=new Set(s);s.has(l)?u.delete(l):u.add(l),t(u)},j=()=>{if(s.size===0)return"All run states";if(m)return"All except scheduled";const l=Array.from(s),u=l.slice(0,xe),h=l.length-xe;return e.jsxs("div",{className:"flex flex-1 min-w-0 items-center gap-2",children:[e.jsx("div",{className:"flex flex-1 min-w-0 items-center gap-2 overflow-hidden",children:u.map(v=>e.jsx(C,{name:v,type:W[v]},v))}),h>0&&e.jsxs(U,{variant:"bodySmall",className:"shrink-0",children:["+ ",h]})]})};return e.jsxs(Ie,{open:c,onOpenChange:r,children:[e.jsx(ze,{asChild:!0,children:e.jsxs(b,{variant:"outline",className:K("justify-between w-full",a),children:[e.jsx("span",{className:"flex-1 min-w-0",children:j()}),e.jsx(_,{id:"ChevronDown",className:"ml-2 size-4 shrink-0"})]})}),e.jsxs(Re,{className:"max-h-96 overflow-x-hidden overflow-y-auto",children:[e.jsxs(w,{onSelect:l=>{l.preventDefault(),o()},children:[e.jsx(B,{checked:m,className:"mr-2"}),"All except scheduled"]}),e.jsxs(w,{onSelect:l=>{l.preventDefault(),d()},children:[e.jsx(B,{checked:s.size===0,className:"mr-2"}),"All run states"]}),Object.keys(W).map(l=>e.jsxs(w,{"aria-label":l,onSelect:u=>{u.preventDefault(),i(l)},children:[e.jsx(B,{"aria-label":l,className:"mr-2",checked:!m&&s.has(l)}),e.jsx(C,{name:l,type:W[l]})]},l))]})]})},ha=({flowRunId:s})=>{const t=J(),[a,c]=n.useState(""),[r,m]=n.useState(new Set),[o,d]=n.useState(new Set),[i,j]=n.useState("EXPECTED_START_TIME_DESC"),[l,u]=n.useState({page:1,limit:20}),h=Le(a,300),{data:v}=$(Fe({task_runs:{operator:"and_",flow_run_id:{operator:"and_",any_:[s],is_null_:!1},subflow_runs:{exists_:!1}}},3e4)),{data:g}=D(oe({task_runs:{operator:"and_",flow_run_id:{operator:"and_",any_:[s],is_null_:!1},subflow_runs:{exists_:!1},name:h?{like_:h}:void 0,state:r.size>0?{operator:"and_",name:{any_:Array.from(r)}}:void 0,tags:o.size>0?{operator:"and_",all_:Array.from(o)}:void 0},sort:i,page:l.page,limit:l.limit},3e4)),F=N=>{c(N.target.value),u(p=>({...p,page:1}))},T=N=>{m(N),u(p=>({...p,page:1}))},E=N=>{j(N),u(p=>({...p,page:1}))},A=N=>{const p=Array.isArray(N)?N:[];d(new Set(p)),u(f=>({...f,page:1}))},I=()=>{c(""),m(new Set),d(new Set),u(N=>({...N,page:1}))},z=N=>{t.prefetchQuery(oe({task_runs:{operator:"and_",flow_run_id:{operator:"and_",any_:[s],is_null_:!1},subflow_runs:{exists_:!1},name:h?{like_:h}:void 0,state:r.size>0?{operator:"and_",name:{any_:Array.from(r)}}:void 0,tags:o.size>0?{operator:"and_",all_:Array.from(o)}:void 0},sort:i,page:N,limit:l.limit},3e4))},R=a||r.size>0||o.size>0,M=n.useMemo(()=>{if(!g?.results)return null;const N=new Map;for(const p of g.results){const f=String(p.state?.name??"Unknown");N.set(f,(N.get(f)??0)+1)}return Array.from(N.entries()).map(([p,f])=>`${f} ${p}`).join(", ")},[g?.results]);return v===0?e.jsx("div",{className:"flex items-center justify-center h-48 border rounded-lg bg-muted/50",children:e.jsx(U,{className:"text-muted-foreground",children:"No task runs found for this flow run."})}):e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-12 items-center gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-1 xl:col-span-3 md:col-span-12 col-span-6 md:order-0 order-3",children:[e.jsxs(U,{variant:"bodySmall",className:"text-muted-foreground",children:[v," Task run",v!==1?"s":""]}),M&&e.jsxs(U,{variant:"bodySmall",className:"text-muted-foreground text-xs capitalize",children:["(",M,")"]})]}),e.jsx("div",{className:"xl:col-span-3 md:col-span-6 col-span-12 md:order-1 order-0",children:e.jsx(Pe,{value:a,onChange:F,placeholder:"Search by run name","aria-label":"Search by run name",debounceMs:300})}),e.jsx("div",{className:"xl:col-span-2 md:col-span-6 col-span-12 md:order-2 order-1",children:e.jsx(xa,{selectedFilters:r,onSelectFilter:T})}),e.jsx("div",{className:"xl:col-span-2 md:col-span-6 col-span-12 md:order-3 order-2",children:e.jsx(Qs,{value:Array.from(o),onChange:A,placeholder:"All tags"})}),e.jsx("div",{className:"xl:border-l xl:border-border xl:pl-2 xl:col-span-2 md:col-span-6 col-span-6 md:order-4 order-4",children:e.jsx(Os,{value:i,onSelect:E})})]}),e.jsx(Us,{taskRuns:g?.results,onClearFilters:R?I:void 0}),g&&g.pages>0&&e.jsx(Gs,{pagination:l,onChangePagination:u,count:g.count,pages:g.pages,onPrefetchPage:z})]})},pa=({id:s,tab:t,onTabChange:a})=>{const[c,r]=n.useState(!1),[m,o]=n.useState(!1),d=J(),{data:i}=$({...hs(s),refetchInterval:c}),{deleteFlowRun:j}=ps(),{navigate:l}=Qe(),u=i.state_type==="PENDING";ws(i?.state_type),n.useEffect(()=>{i.state_type==="RUNNING"||i.state_type==="PENDING"?r(5e3):r(!1)},[i]);const h=()=>{j(i.id,{onSuccess:()=>{r(!1),y.success("Flow run deleted"),l({to:"/runs",replace:!0})},onError:E=>{const A=E.message||"Unknown error while deleting flow run.";y.error(A)}})},v=n.useCallback(()=>{d.invalidateQueries({queryKey:js.all()})},[d]),g=n.useCallback(()=>{d.invalidateQueries({queryKey:gs.all()})},[d]),F=n.useCallback(()=>{d.invalidateQueries({queryKey:fs.lists()})},[d]),T=n.useCallback(()=>{d.invalidateQueries({queryKey:ys.all()})},[d]);return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(ia,{flowRun:i,onDeleteClick:h})}),!u&&e.jsx(he,{className:"py-0",children:e.jsx(pe,{className:"p-0",children:e.jsx(Ys,{flowRunId:i.id,stateType:i.state_type??void 0,fullscreen:m,onFullscreenChange:o})})}),e.jsx("div",{className:"flex flex-col gap-4",children:e.jsx(ja,{currentTab:t,onTabChange:a,flowRun:i,logsContent:e.jsx(Q,{fallback:e.jsx(V,{error:{type:"unknown-error",message:"Failed to load logs",details:"An error occurred while loading log data. Please try again."},onRetry:v}),children:e.jsx(n.Suspense,{fallback:e.jsx(ga,{}),children:e.jsx(ca,{flowRun:i})})}),taskRunsContent:e.jsx(Q,{fallback:e.jsx(V,{error:{type:"unknown-error",message:"Failed to load task runs",details:"An error occurred while loading task run data. Please try again."},onRetry:g}),children:e.jsx(n.Suspense,{fallback:e.jsx(fa,{}),children:e.jsx(ha,{flowRunId:s})})}),subflowRunsContent:e.jsx(Q,{fallback:e.jsx(V,{error:{type:"unknown-error",message:"Failed to load subflow runs",details:"An error occurred while loading subflow run data. Please try again."},onRetry:F}),children:e.jsx(n.Suspense,{fallback:e.jsx(Na,{}),children:e.jsx(ma,{parentFlowRunId:s})})}),artifactsContent:e.jsx(Q,{fallback:e.jsx(V,{error:{type:"unknown-error",message:"Failed to load artifacts",details:"An error occurred while loading artifact data. Please try again."},onRetry:T}),children:e.jsx(n.Suspense,{fallback:e.jsx(ya,{}),children:e.jsx(Zs,{flowRun:i})})}),detailsContent:e.jsx(n.Suspense,{fallback:e.jsx(va,{}),children:e.jsx(ea,{flowRun:i})}),parametersContent:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>{y.success("Copied parameters to clipboard"),navigator.clipboard.writeText(JSON.stringify(i.parameters??{},null,2))},children:[e.jsx(_,{id:"Copy",className:"size-4 mr-2"}),"Copy parameters"]})}),e.jsx(ce,{value:JSON.stringify(i.parameters??{},null,2),disabled:!0})]}),jobVariablesContent:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>{y.success("Copied job variables to clipboard"),navigator.clipboard.writeText(JSON.stringify(i.job_variables??{},null,2))},children:[e.jsx(_,{id:"Copy",className:"size-4 mr-2"}),"Copy job variables"]})}),e.jsx(ce,{value:JSON.stringify(i.job_variables??{},null,2),disabled:!0})]})})})]})},ja=({currentTab:s,onTabChange:t,flowRun:a,logsContent:c,taskRunsContent:r,subflowRunsContent:m,artifactsContent:o,detailsContent:d,parametersContent:i,jobVariablesContent:j})=>e.jsxs(Ns,{value:s,onValueChange:l=>t(l),children:[e.jsxs(vs,{children:[e.jsx(L,{value:"Details",children:"Details"}),e.jsx(L,{value:"Logs",children:"Logs"}),a.state_type!=="PENDING"&&e.jsx(L,{value:"TaskRuns",children:"Task Runs"}),a.state_type!=="PENDING"&&e.jsx(L,{value:"SubflowRuns",children:"Subflow Runs"}),e.jsx(L,{value:"Artifacts",children:"Artifacts"}),e.jsx(L,{value:"Parameters",children:"Parameters"}),e.jsx(L,{value:"JobVariables",children:"Job Variables"})]}),e.jsx(P,{value:"Details",children:d}),e.jsx(P,{value:"Logs",children:c}),e.jsx(P,{value:"TaskRuns",children:r}),e.jsx(P,{value:"SubflowRuns",children:m}),e.jsx(P,{value:"Artifacts",children:o}),e.jsx(P,{value:"Parameters",children:i}),e.jsx(P,{value:"JobVariables",children:j})]}),ga=()=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-row gap-2 justify-end",children:[e.jsx(x,{className:"h-8 w-25"}),e.jsx(x,{className:"h-8 w-32"}),e.jsx(x,{className:"h-8 w-8"})," "]}),e.jsx(x,{className:"h-32"})]}),fa=()=>e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(x,{className:"h-4 w-24"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(x,{className:"h-9 flex-1"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{className:"h-9 w-48"}),e.jsx(x,{className:"h-9 w-40"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(x,{className:"h-24"}),e.jsx(x,{className:"h-24"}),e.jsx(x,{className:"h-24"})]})]}),ya=()=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"flex flex-row justify-end",children:e.jsx(x,{className:"h-8 w-12"})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2 xl:grid-cols-3",children:[e.jsx(x,{className:"h-40"}),e.jsx(x,{className:"h-40"}),e.jsx(x,{className:"h-40"}),e.jsx(x,{className:"h-40"})]})]}),Na=()=>e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(x,{className:"h-4 w-24"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(x,{className:"h-9 flex-1"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{className:"h-9 w-48"}),e.jsx(x,{className:"h-9 w-40"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(x,{className:"h-24"}),e.jsx(x,{className:"h-24"}),e.jsx(x,{className:"h-24"})]})]}),va=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(x,{className:"h-4 w-20"}),e.jsx(x,{className:"h-5 w-12"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(x,{className:"h-4 w-16"}),e.jsx(x,{className:"h-5 w-32"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(x,{className:"h-4 w-24"}),e.jsx(x,{className:"h-5 w-32"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(x,{className:"h-4 w-24"}),e.jsx(x,{className:"h-5 w-64"})]})]});Vs({tab:Bs(["Logs","TaskRuns","SubflowRuns","Artifacts","Details","Parameters","JobVariables"]).default("Logs").catch("Logs")});function Wa(){const{id:s}=de.useParams(),{tab:t}=de.useSearch(),a=Ve(),c=r=>{a({to:".",search:m=>({...m,tab:r})})};return e.jsx(pa,{id:s,tab:t,onTabChange:c})}export{Wa as component};
//# sourceMappingURL=flow-run._id-s1UJuakA.js.map
