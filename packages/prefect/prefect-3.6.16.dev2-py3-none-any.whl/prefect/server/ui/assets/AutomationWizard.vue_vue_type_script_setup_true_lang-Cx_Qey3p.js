import{d as w,K as $,g as S,N as Z,P as H,h as f,c as T,o as v,Q as B,W as E,R as Y,V as J,T as R,X as tt,n as k,l as M,k as c,t as I,i as y,a as U,m as u,r as K,Z as Q,$ as et,a0 as F,a1 as D,a2 as at,w as G,a3 as ot,F as q,x as nt,B as C,a4 as st,a5 as W,a6 as P,O as it,G as rt,a7 as ut,a8 as lt,a9 as mt,aa as pt,ab as ct,ac as dt,ad as gt,ae as O,af as j,ag as _t,ah as vt,ai as ft,u as At,aj as yt}from"./index-C9FkjDpZ.js";import{m as h,i as Vt,A as bt}from"./mapper-NwaeXCHc.js";const Tt=w({__name:"AutomationActionTypeSelect",props:{type:{required:!0},typeModifiers:{}},emits:["update:type"],setup(d){const n=$(d,"type"),o=S(()=>{const e=Z.map(t=>({label:H[t],value:t}));return n.value==="do-nothing"?e:e.filter(t=>t.value!=="do-nothing")});return(e,t)=>{const l=f("p-select");return v(),T(l,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=m=>n.value=m),options:o.value,class:"automation-action-type-select"},null,8,["modelValue","options"])}}}),wt={class:"automation-wizard-action"},St={class:"automation-wizard-action__header"},xt={class:"automation-wizard-action__heading"},kt=w({__name:"AutomationWizardAction",props:{index:{},action:{},automation:{}},emits:["delete","update:action"],setup(d,{emit:n}){const o=d,e=n,t=S({get(){return o.action.type??null},set(p){if(B(p)){e("update:action",{});return}const r=E(o.automation.trigger),g=Y(p,r);e("update:action",g)}}),{state:l,error:m}=J(t,"Action Type",p=>!!p),s=S(()=>o.action.type?R(tt,{action:o.action,"onUpdate:action":p=>e("update:action",p)}):null);function i(p){e("update:action",p)}return(p,r)=>{const g=f("p-button"),_=f("p-label"),A=f("p-content");return v(),k("div",wt,[M("div",St,[M("span",xt,"Action "+I(d.index+1),1),c(g,{size:"sm",icon:"TrashIcon",onClick:r[0]||(r[0]=V=>e("delete"))})]),c(A,null,{default:y(()=>[c(_,{label:"Action Type",state:u(l),message:u(m)},{default:y(({id:V})=>[c(Tt,{id:V,type:t.value,"onUpdate:type":r[1]||(r[1]=a=>t.value=a),state:u(l)},null,8,["id","type","state"])]),_:1},8,["state","message"]),s.value?(v(),T(K(s.value.component),Q({key:0},s.value.props,{"onUpdate:action":i}),null,16)):U("",!0)]),_:1})])}}}),zt={class:"automation-wizard-step-actions"},Ut=w({__name:"AutomationWizardStepActions",props:{automation:{}},emits:["update:automation"],setup(d,{emit:n}){const o=d,e=n,t=et(o.automation.actions??[]);function l(){t.push({})}function m(g){t.splice(g,1)}function s(g,_){t[g]=_}const{error:i}=J(t,"Actions",g=>g.length?!0:"At least 1 action is required"),{defineValidate:p}=F(),{validate:r}=D();return p(r),at(()=>{t.length===0&&l()}),G(t,()=>{e("update:automation",{...o.automation,actions:t.filter(st)})}),(g,_)=>{const A=f("p-divider"),V=f("p-message"),a=f("p-button");return v(),k("div",zt,[(v(),T(ot,null,[(v(!0),k(q,null,nt(t,(b,x)=>(v(),k(q,{key:x},[c(kt,{action:b,automation:d.automation,index:x,"onUpdate:action":N=>s(x,N),onDelete:N=>m(x)},null,8,["action","automation","index","onUpdate:action","onDelete"]),c(A)],64))),128))],1024)),u(i)?(v(),T(V,{key:0,error:""},{default:y(()=>[C(I(u(i)),1)]),_:1})):U("",!0),c(a,{class:"automations-wizard-step-actions__add",icon:"PlusIcon",onClick:l},{default:y(()=>[..._[0]||(_[0]=[C(" Add Action ",-1)])]),_:1})])}}}),$t=w({__name:"AutomationWizardStepDetails",props:{automation:{required:!0},automationModifiers:{}},emits:["update:automation"],setup(d){const n=$(d,"automation"),o=W(n,"name"),e=W(n,"description"),{validate:t}=D(),l=(p="",r)=>p.length>0?!0:`${r} is required`,{state:m,error:s}=J(o,"Automation name",l),{defineValidate:i}=F();return i(t),(p,r)=>{const g=f("p-text-input"),_=f("p-label"),A=f("p-content");return v(),T(A,{class:"automation-wizard-step-details"},{default:y(()=>[c(_,{label:"Automation Name",state:u(m),message:u(s)},{default:y(({id:V})=>[c(g,{id:V,modelValue:u(o),"onUpdate:modelValue":r[0]||(r[0]=a=>P(o)?o.value=a:null),state:u(m)},null,8,["id","modelValue","state"])]),_:1},8,["state","message"]),c(_,{label:"Description (Optional)"},{default:y(({id:V})=>[c(g,{id:V,modelValue:u(e),"onUpdate:modelValue":r[1]||(r[1]=a=>P(e)?e.value=a:null)},null,8,["id","modelValue"])]),_:1})]),_:1})}}}),Jt=w({__name:"AutomationTriggerJsonInput",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(d){const n=$(d,"modelValue"),o=s=>{try{const i=JSON.parse(s);h.map("AutomationTriggerResponse",i,"AutomationTrigger")}catch{return!1}return!0},e=(s,i)=>B(s)||lt(s)||mt(s)||pt(s)?`${i} is required`:!0,t=(s,i)=>{try{JSON.parse(s)}catch{return`${i} must be valid JSON`}return!0},{state:l,error:m}=J(n,"Trigger",[e,t,o]);return(s,i)=>{const p=f("p-message"),r=f("p-label");return v(),k(q,null,[c(p,{info:""},{action:y(()=>[c(u(it),{to:u(rt).docs.automationTriggers,small:""},null,8,["to"])]),default:y(()=>[i[1]||(i[1]=C(" Custom triggers allow advanced configuration of the conditions on which a trigger executes its actions. ",-1))]),_:1}),c(r,{label:"Trigger",state:u(l),message:u(m)},{default:y(()=>[c(u(ut),{modelValue:n.value,"onUpdate:modelValue":i[0]||(i[0]=g=>n.value=g),class:"automation-trigger-json-input__json-input","show-format-button":"",state:u(l)},null,8,["modelValue","state"])]),_:1},8,["state","message"])],64)}}}),Nt=w({__name:"AutomationTriggerTemplateSelect",props:{template:{required:!0},templateModifiers:{}},emits:["update:template"],setup(d){const n=$(d,"template"),o=S(()=>ct.map(e=>({label:dt(e),value:e})));return(e,t)=>{const l=f("p-select");return v(),T(l,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=m=>n.value=m),"empty-message":"Select template",options:o.value,class:"automation-trigger-template-select"},null,8,["modelValue","options"])}}}),qt=w({__name:"AutomationWizardStepTrigger",props:{automation:{required:!0},automationModifiers:{}},emits:["update:automation"],setup(d){const n=$(d,"automation"),o=S({get(){return n.value.trigger?E(n.value.trigger):null},set(a){if(B(a)){V(void 0);return}V(j(a))}}),{values:e}=gt(["Form","JSON"]),t=O("Form");function l(){const a=h.map("AutomationTrigger",n.value.trigger,"AutomationTriggerRequest");return vt(a)}const m=O(l());G(()=>n.value.trigger,()=>m.value=l());function s(){const a=JSON.parse(m.value),b=h.map("AutomationTriggerResponse",a,"AutomationTrigger");return V(b),b}async function i(a){t.value!==a&&await r()&&(a==="Form"&&s(),a==="JSON"&&(m.value=l()),t.value=a)}const{defineValidate:p}=F(),{validate:r}=D(),{state:g,error:_}=J(o,"Trigger template",a=>a?!0:"Trigger type is required");p(async()=>{const a=await r();return a&&t.value==="JSON"&&s(),a});const A=S(()=>{if(!o.value)return null;const a=n.value.trigger??j(o.value);switch(a.type){case"event":return R(_t,{template:o.value,trigger:a,"onUpdate:trigger":V});case"compound":case"sequence":return R(ft,{trigger:a,"onUpdate:trigger":V});default:const b=a;throw new Error(`AutomationWizardStepTrigger is missing case for trigger type ${b.type}`)}});function V(a){n.value={...n.value,trigger:a}}return(a,b)=>{const x=f("p-label"),N=f("p-button-group"),L=f("p-content");return v(),T(L,{class:"automation-wizard-step-trigger"},{default:y(()=>[c(x,{label:"Trigger Template",state:u(g),message:u(_)},{default:y(({id:z})=>[c(Nt,{id:z,template:o.value,"onUpdate:template":b[0]||(b[0]=X=>o.value=X),state:u(g)},null,8,["id","template","state"])]),_:1},8,["state","message"]),A.value?(v(),k(q,{key:0},[c(N,{class:"automation-wizard-step-trigger__mode-switcher","model-value":t.value,options:u(e),small:"","onUpdate:modelValue":b[1]||(b[1]=z=>i(z))},null,8,["model-value","options"]),t.value==="Form"&&o.value?(v(),T(K(A.value.component),Q({key:o.value},A.value.props),null,16)):t.value==="JSON"?(v(),T(Jt,{key:1,modelValue:m.value,"onUpdate:modelValue":b[2]||(b[2]=z=>m.value=z)},null,8,["modelValue"])):U("",!0)],64)):U("",!0)]),_:1})}}}),Ct=w({__name:"AutomationWizard",props:{automation:{},editing:{type:Boolean}},emits:["submit"],setup(d,{emit:n}){const o=d,e=O(o.automation??{}),t=n,l=At(),m=S(()=>o.automation?"Save":"Create"),s=[{title:"Trigger",key:"trigger-step"},{title:"Actions",key:"actions-step"},{title:"Details",key:"details-step"}],i=O();function p(){t("submit",new bt(e.value))}function r(){l.back()}return(g,_)=>(v(),T(u(yt),{ref_key:"wizardRef",ref:i,class:"automation-wizard",steps:s,"last-step-text":m.value,"show-cancel":"",nonlinear:d.editing,"show-save-and-exit":d.editing,onCancel:r,onSubmit:p},{"trigger-step":y(()=>[c(qt,{automation:e.value,"onUpdate:automation":_[0]||(_[0]=A=>e.value=A)},null,8,["automation"])]),"actions-step":y(()=>[u(Vt)(e.value)?(v(),T(Ut,{key:0,automation:e.value,"onUpdate:automation":_[1]||(_[1]=A=>e.value=A)},null,8,["automation"])):U("",!0)]),"details-step":y(()=>[c($t,{automation:e.value,"onUpdate:automation":_[2]||(_[2]=A=>e.value=A)},null,8,["automation"])]),_:1},8,["last-step-text","nonlinear","show-save-and-exit"]))}});export{Ct as _};
//# sourceMappingURL=AutomationWizard.vue_vue_type_script_setup_true_lang-Cx_Qey3p.js.map
