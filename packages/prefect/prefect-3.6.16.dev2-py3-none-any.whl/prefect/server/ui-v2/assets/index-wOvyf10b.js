import{j as e,L as C,t as y,r as m,C as U,D as z,n as W,s as A}from"./vendor-tanstack-BcZfOOfy.js";import{aQ as Y,aR as _,aS as B,aT as P,aU as Q,U as O,aV as q,aW as V,q as Z,I as L,y as H,ao as E,V as X,S as G,a as J,b as ee,c as ae,e as te,E as se,t as ne,v as le,w as oe,x as re,D as ie,B as ce,g as de,h as ue,aX as h,aY as F,aZ as D}from"./index-B8vo2Lrg.js";import{D as me}from"./data-table-CPkppyg6.js";import{T as pe}from"./tags-input-DHrnkwjQ.js";import{D as ge,a as fe,b as he,c as xe,d as R,e as we}from"./dropdown-menu-D7Gwbd15.js";import{Y as ye}from"./vendor-date-wwuDAncJ.js";import{o as je,e as Se,a as _e,n as I,s as M}from"./vendor-forms-ClCIacbh.js";import"./vendor-react-Bce9NwRC.js";import"./vendor-radix-BTiKGWfR.js";import"./vendor-recharts-BvvJP9Po.js";import"./table-BBNGfPra.js";const Ce=({row:t})=>t.original.id?e.jsxs("div",{className:"flex flex-col pl-4",children:[e.jsx(C,{to:"/flows/flow/$id",params:{id:t.original.id},className:"text-sm font-medium truncate",title:t.original.name,children:t.original.name}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Created"," ",t.original?.created&&Y(t.original.created,"dateTime")]})]}):null,ve=({row:t})=>{const a=t.original.id,{data:n}=y({..._({flows:{operator:"and_",id:{any_:[a??""]}},flow_runs:{operator:"and_",start_time:{is_null_:!1}},offset:0,limit:1,sort:"START_TIME_DESC"}),enabled:!!a}),s=n?.[0];return!a||!s?null:e.jsxs("div",{className:"flex items-center gap-1",children:[s.state_type&&e.jsx(B,{type:s.state_type,name:s.state_name??void 0}),e.jsx(C,{to:"/runs/flow-run/$id",params:{id:s.id??""},children:e.jsx("span",{className:"text-sm text-blue-700 hover:underline",children:s.name})})]})},be=({row:t})=>{const a=t.original.id,{data:n}=y(P(a?[a]:[],{enabled:!!a})),s=a?n?.[a]:null;return!a||!s?null:e.jsxs("div",{className:"flex items-center gap-1",children:[s.state_type&&e.jsx(B,{type:s.state_type,name:s.state_name}),e.jsx(C,{to:"/runs/flow-run/$id",params:{id:s.id??""},children:e.jsx("span",{className:"text-sm text-blue-700 hover:underline",children:s.name})})]})},Ne=({row:t})=>{const a=t.original.id,{data:n}=y(Q(a?[a]:[],{enabled:!!a}));if(!a)return null;const s=n?.[a]??0;return s===0?e.jsx("span",{className:"text-sm text-muted-foreground",children:"None"}):e.jsx(C,{to:"/flows/flow/$id",params:{id:a},search:{tab:"deployments"},children:e.jsxs("span",{className:"text-sm text-blue-700 hover:underline",children:[s," ",O(s,"Deployment")]})})},De=({row:t})=>{const a=t.original.id,{deleteFlow:n}=V();return a?e.jsx("div",{className:"flex justify-end",children:e.jsxs(ge,{children:[e.jsx(fe,{asChild:!0,children:e.jsxs(Z,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(L,{id:"MoreVertical",className:"h-4 w-4"})]})}),e.jsxs(he,{align:"end",children:[e.jsx(xe,{children:"Actions"}),e.jsx(R,{onClick:()=>{navigator.clipboard.writeText(a),H.success("ID copied")},children:"Copy ID"}),e.jsx(we,{}),e.jsx(R,{onClick:()=>n(a),children:"Delete"}),e.jsx(R,{children:"Automate"})]})]})}):null},k=16,Re=({row:t})=>{const a=t.original.id,{startDate:n,endDate:s}=m.useMemo(()=>{const i=new Date;return{startDate:ye(i),endDate:i}},[]),{data:o}=y({..._({flows:{operator:"and_",id:{any_:[a??""]}},flow_runs:{operator:"and_",start_time:{is_null_:!1}},offset:0,limit:k,sort:"START_TIME_DESC"}),enabled:!!a});return a?e.jsx(q,{chartId:`flow-activity-${a}`,enrichedFlowRuns:o??[],startDate:n,endDate:s,numberOfBars:k,className:"h-[24px] w-[140px]"}):null},Te=[{id:"select",header:({table:t})=>e.jsx(E,{checked:t.getIsAllPageRowsSelected(),onCheckedChange:a=>t.toggleAllPageRowsSelected(!!a),"aria-label":"Select all"}),cell:({row:t})=>e.jsx(E,{checked:t.getIsSelected(),onCheckedChange:a=>t.toggleSelected(!!a),"aria-label":"Select row"}),enableSorting:!1,enableHiding:!1,maxSize:10},{accessorKey:"name",header:()=>e.jsx("div",{className:"pl-4",children:"Flow"}),cell:Ce},{accessorKey:"lastRuns",header:"Last Run",cell:ve},{accessorKey:"nextRuns",header:"Next Run",cell:be},{accessorKey:"deployments",header:"Deployments",cell:Ne},{accessorKey:"activity",header:"Activity",cell:Re},{id:"actions",cell:De}],Ae=[{label:"A to Z",value:"NAME_ASC"},{label:"Z to A",value:"NAME_DESC"},{label:"Created",value:"CREATED_DESC"}];function Ee({flows:t,count:a,pageCount:n,sort:s,pagination:o,onPaginationChange:i,onSortChange:g,columnFilters:c,onColumnFiltersChange:r,onPrefetchPage:x}){const{deleteFlow:w}=V(),[f,v]=m.useState({}),b=c.find(l=>l.id==="name")?.value??"",N=c.find(l=>l.id==="tags")?.value??[],j=m.useCallback(l=>{const u=c.filter(p=>p.id!=="name");r(l?[...u,{id:"name",value:l}]:u)},[r,c]),T=m.useCallback(l=>{const u=Array.isArray(l)?l:[],p=c.filter($=>$.id!=="tags");r(u.length?[...p,{id:"tags",value:u}]:p)},[r,c]),S=m.useCallback(l=>{let u=o;typeof l=="function"?u=l(o):u=l,i(u)},[o,i]),d=U({columns:Te,data:t,getCoreRowModel:z(),manualPagination:!0,pageCount:n,state:{rowSelection:f,pagination:o},onRowSelectionChange:v,onPaginationChange:S}),K=()=>{const u=Object.keys(f).map(p=>t[Number(p)].id);for(const p of u)w(p);d.toggleAllRowsSelected(!1)};return e.jsxs("div",{className:"h-full",children:[e.jsxs("div",{className:"grid sm:grid-cols-2 md:grid-cols-6 lg:grid-cols-12 gap-2 pb-4 items-center",children:[e.jsx("div",{className:"sm:col-span-2 md:col-span-6 lg:col-span-4 order-last lg:order-first",children:Object.keys(f).length>0?e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center",children:[Object.keys(f).length," selected",e.jsx(L,{id:"Trash2",className:"ml-2 cursor-pointer h-4 w-4 inline",onClick:K})]}):e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a," ",O(a,"Flow")]})}),e.jsx("div",{className:"sm:col-span-2 md:col-span-2 lg:col-span-3",children:e.jsx(X,{placeholder:"Flow names",value:b,onChange:l=>j(l.target.value)})}),e.jsx("div",{className:"xs:col-span-1 md:col-span-2 lg:col-span-3",children:e.jsx(pe,{placeholder:"Filter by tags",onChange:T,value:N})}),e.jsx("div",{className:"xs:col-span-1 md:col-span-2 lg:col-span-2",children:e.jsxs(G,{value:s,onValueChange:g,children:[e.jsx(J,{"aria-label":"Flow sort order",className:"w-full",children:e.jsx(ee,{placeholder:"Sort by"})}),e.jsx(ae,{children:Ae.map(l=>e.jsx(te,{value:l.value,children:l.label},l.value))})]})})]}),e.jsx(me,{table:d,onPrefetchPage:x})]})}const Fe=()=>e.jsxs(se,{children:[e.jsx(ne,{id:"Workflow"}),e.jsx(le,{children:"Run a flow to get started"}),e.jsx(oe,{children:"Flows are Python functions that encapsulate workflow logic and allow users to interact with and reason about the state of their workflows."}),e.jsx(re,{children:e.jsx(ie,{id:"flows-guide"})})]}),Ie=()=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(ce,{children:e.jsx(de,{children:e.jsx(ue,{className:"text-xl font-semibold",children:"Flows"})})})});function Me({flows:t,count:a,totalCount:n,pageCount:s,sort:o,pagination:i,onPaginationChange:g,onSortChange:c,columnFilters:r,onColumnFiltersChange:x,onPrefetchPage:w}){return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(Ie,{}),n===0?e.jsx(Fe,{}):e.jsx(Ee,{flows:t,count:a,pageCount:s,sort:o,pagination:i,onPaginationChange:g,onSortChange:c,columnFilters:r,onColumnFiltersChange:x,onPrefetchPage:w})]})}je({name:M().optional(),page:I().int().positive().optional().default(1).catch(1),limit:I().int().positive().max(100).optional().default(10).catch(10),tags:_e(M()).optional(),sort:Se(["CREATED_DESC","UPDATED_DESC","NAME_ASC","NAME_DESC"]).optional().default("NAME_ASC")}).optional().default({});const ke=t=>{const a=!!t?.name,n=!!t?.tags?.length;return!a&&!n?{page:t?.page??1,limit:t?.limit??10,sort:t?.sort??"NAME_ASC"}:{page:t?.page??1,limit:t?.limit??10,sort:t?.sort??"NAME_ASC",flows:{operator:"and_",...a&&{name:{like_:t?.name}},...n&&{tags:{operator:"and_",all_:t?.tags}}}}},Be=16,Pe=()=>{const t=h.useSearch(),a=h.useNavigate(),n=m.useMemo(()=>({pageIndex:(t.page??1)-1,pageSize:t.limit??10}),[t.page,t.limit]),s=m.useCallback(o=>{a({to:".",search:i=>({...i,page:o.pageIndex+1,limit:o.pageSize}),replace:!0})},[a]);return[n,s]},Qe=()=>{const t=h.useSearch(),a=h.useNavigate(),n=m.useCallback(s=>{a({to:".",search:o=>({...o,sort:s}),replace:!0})},[a]);return[t.sort,n]},Oe=()=>{const t=h.useSearch(),a=h.useNavigate(),n=m.useMemo(()=>[{id:"name",value:t.name},{id:"tags",value:t.tags}],[t.name,t.tags]),s=m.useCallback(o=>{a({to:".",search:i=>{const g=o.find(r=>r.id==="name")?.value,c=o.find(r=>r.id==="tags")?.value;return{...i,page:1,name:g,tags:c}},replace:!0})},[a]);return[n,s]};function Xe(){const t=h.useSearch(),a=W(),[n,s]=Pe(),[o,i]=Qe(),[g,c]=Oe(),r=ke(t),{data:x}=A(F({offset:0,sort:t.sort,flows:r.flows??void 0})),{data:w}=A(F({offset:0,sort:"NAME_ASC"})),{data:f}=y(D(r,3e4)),v=f?.results??[],b=m.useCallback(N=>{const j={...r,page:N};a.prefetchQuery(D(j,3e4)).then(()=>{const S=a.getQueryData(D(j,3e4).queryKey)?.results?.map(d=>d.id).filter(d=>!!d)??[];if(S.length!==0)for(const d of S)a.prefetchQuery(P([d])),a.prefetchQuery(Q([d])),a.prefetchQuery(_({flows:{operator:"and_",id:{any_:[d]}},flow_runs:{operator:"and_",start_time:{is_null_:!1}},offset:0,limit:1,sort:"START_TIME_DESC"})),a.prefetchQuery(_({flows:{operator:"and_",id:{any_:[d]}},flow_runs:{operator:"and_",start_time:{is_null_:!1}},offset:0,limit:Be,sort:"START_TIME_DESC"}))})},[a,r]);return e.jsx(Me,{flows:v,count:x??0,totalCount:w??0,pageCount:f?.pages??0,sort:o,pagination:n,onPaginationChange:s,onSortChange:i,columnFilters:g,onColumnFiltersChange:c,onPrefetchPage:b})}export{Xe as component};
//# sourceMappingURL=index-wOvyf10b.js.map
