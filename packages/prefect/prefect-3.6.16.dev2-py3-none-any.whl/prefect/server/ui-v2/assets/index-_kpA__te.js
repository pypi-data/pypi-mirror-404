import{r as c,j as e,B as J,C as L,D as P,E as H}from"./vendor-tanstack-BcZfOOfy.js";import{X as B,Y as Q,Z,L as R,_ as q,q as E,I as F,y as h,U as G,V as X,S as Y,a as $,b as K,c as W,e as y,$ as ee,E as ae,t as se,v as te,w as ne,x as re,D as le,a0 as oe,a1 as ie,a2 as ce,a3 as de,a4 as ue,a5 as me,a6 as ge,p as pe,a7 as he,a8 as xe,a9 as p,aa as je,ab as T}from"./index-B8vo2Lrg.js";import{D as fe}from"./data-table-CPkppyg6.js";import{T as U}from"./tags-input-DHrnkwjQ.js";import{D as be,a as ve,b as Ce,c as Se,d as C}from"./dropdown-menu-D7Gwbd15.js";import{u as Ve}from"./use-is-overflowing-CpSV4NPP.js";import{V as De}from"./header-CPxTHSvz.js";import{a as ye}from"./zod-Cuos7J7w.js";import{c as Ne,o as Ee,s as A}from"./vendor-forms-ClCIacbh.js";import{F as Ae,a as N,b as k,c as w,d as M,e as I}from"./form-mws4law8.js";import"./vendor-react-Bce9NwRC.js";import"./vendor-radix-BTiKGWfR.js";import"./vendor-recharts-BvvJP9Po.js";import"./vendor-date-wwuDAncJ.js";import"./table-BBNGfPra.js";const ke=({row:a,onVariableEdit:t})=>{const s=a.original.id,{deleteVariable:n}=q();if(!s)return null;const r=()=>{n(s,{onSuccess:()=>{h.success("Variable deleted")}})};return e.jsx("div",{className:"flex flex-row justify-end",children:e.jsxs(be,{children:[e.jsx(ve,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:"size-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(F,{id:"MoreVertical",className:"size-4"})]})}),e.jsxs(Ce,{align:"end",children:[e.jsx(Se,{children:"Actions"}),e.jsx(C,{onClick:()=>{navigator.clipboard.writeText(s),h.success("ID copied")},children:"Copy ID"}),e.jsx(C,{onClick:()=>{navigator.clipboard.writeText(a.original.name),h.success("Name copied")},children:"Copy Name"}),e.jsx(C,{onClick:()=>{const l=typeof a.original.value!="string"?JSON.stringify(a.original.value):a.original.value;l&&(navigator.clipboard.writeText(l),h.success("Value copied"))},children:"Copy Value"}),e.jsx(C,{onClick:()=>t(a.original),children:"Edit"}),e.jsx(C,{onClick:r,children:"Delete"})]})]})})},we=a=>{const t=a.getValue(),s=c.useRef(null),n=Ve(s);return t?e.jsxs(B,{open:n?void 0:!1,children:[e.jsx(Q,{asChild:!0,children:e.jsx("code",{ref:s,className:"px-2 py-1 font-mono text-sm text-ellipsis overflow-hidden whitespace-nowrap block",children:JSON.stringify(t,null,2)})}),e.jsx(Z,{className:"p-0",children:e.jsx(R,{value:JSON.stringify(t,null,2),disabled:!0})})]}):null},S=J(),Me=a=>[S.accessor("name",{header:"Name"}),S.accessor("value",{header:"Value",cell:we}),S.accessor("updated",{header:"Updated",cell:t=>{const s=t.getValue();return s?new Date(s??new Date).toLocaleString(void 0,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0}).replace(",",""):null}}),S.accessor("tags",{header:()=>null,cell:t=>{const s=t.getValue();return s?e.jsx(ee,{tags:s,maxTagsDisplayed:3}):null}}),S.display({id:"actions",cell:t=>e.jsx(ke,{...t,onVariableEdit:a})})],Ie=({variables:a,currentVariableCount:t,pagination:s,onPaginationChange:n,columnFilters:r,onColumnFiltersChange:l,sorting:u,onSortingChange:m,onVariableEdit:d})=>{const x=c.useMemo(()=>Me(d),[d]),j=r.find(i=>i.id==="name")?.value,f=r.find(i=>i.id==="tags")?.value,o=c.useCallback(i=>{const g=r.filter(D=>D.id!=="name");l(i?[...g,{id:"name",value:i}]:g)},[l,r]),V=c.useCallback(i=>{const g=Array.isArray(i)?i:i.target.value,D=r.filter(z=>z.id!=="tags");l(g.length?[...D,{id:"tags",value:g}]:D)},[l,r]),b=c.useCallback(i=>{let g=s;typeof i=="function"?g=i(s):g=i,n(g)},[s,n]),v=L({data:a,columns:x,state:{pagination:s,columnFilters:r},getCoreRowModel:P(),manualPagination:!0,onPaginationChange:b,rowCount:t,defaultColumn:{maxSize:300}});return e.jsxs("div",{children:[e.jsxs("div",{className:"grid sm:grid-cols-2 md:grid-cols-6 lg:grid-cols-12 gap-2 pb-4 items-center",children:[e.jsx("div",{className:"sm:col-span-2 md:col-span-6 lg:col-span-4 order-last lg:order-first",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t," ",G(t,"Variable")]})}),e.jsx("div",{className:"sm:col-span-2 md:col-span-2 lg:col-span-3",children:e.jsx(X,{placeholder:"Search variables",value:j,onChange:i=>o(i.target.value)})}),e.jsx("div",{className:"xs:col-span-1 md:col-span-2 lg:col-span-3",children:e.jsx(U,{placeholder:"Filter by tags",onChange:V,value:f})}),e.jsx("div",{className:"xs:col-span-1 md:col-span-2 lg:col-span-2",children:e.jsxs(Y,{value:u,onValueChange:m,children:[e.jsx($,{"aria-label":"Variable sort order",className:"w-full",children:e.jsx(K,{placeholder:"Sort by"})}),e.jsxs(W,{children:[e.jsx(y,{value:"CREATED_DESC",children:"Created"}),e.jsx(y,{value:"UPDATED_DESC",children:"Updated"}),e.jsx(y,{value:"NAME_ASC",children:"A to Z"}),e.jsx(y,{value:"NAME_DESC",children:"Z to A"})]})]})})]}),e.jsx(fe,{table:v})]})},Te=({onAddVariableClick:a})=>e.jsxs(ae,{children:[e.jsx(se,{id:"Variable"}),e.jsx(te,{children:"Add a variable to get started"}),e.jsx(ne,{children:"Variables store non-sensitive pieces of JSON."}),e.jsxs(re,{children:[e.jsxs(E,{onClick:()=>a(),children:["Add Variable ",e.jsx(F,{id:"Plus",className:"size-4 ml-2"})]}),e.jsx(le,{id:"variables-guide"})]})]}),Oe=()=>{const a=c.useCallback(r=>{s(l=>({...l,open:r}))},[]),[t,s]=c.useState({open:!1,onOpenChange:a}),n=c.useCallback(r=>{s(l=>({...l,open:!0,variableToEdit:r}))},[]);return[t,n]},_e=Ee({name:A().min(2,{message:"Name must be at least 2 characters"}),value:A(),tags:A().array().optional()}),O={name:"",value:"",tags:[]},Re=({onOpenChange:a,open:t,variableToEdit:s})=>{const n=Ne({resolver:ye(_e),defaultValues:O}),r=c.useMemo(()=>{if(s)return{name:s.name,value:JSON.stringify(s.value,null,2),tags:s.tags}},[s]);c.useEffect(()=>{t&&n.reset(r??O)},[r,n,t]);const{createVariable:l,isPending:u}=oe(),{updateVariable:m,isPending:d}=ie(),x=o=>{try{const V=JSON.parse(o.value);s?.id?m({id:s.id,name:o.name,value:V,tags:o.tags},{onSuccess:()=>{h.success("Variable updated"),a(!1)},onError:b=>{const v=b.message||"Unknown error while updating variable.";n.setError("root",{message:v})}}):l({name:o.name,value:V,tags:o.tags},{onSuccess:()=>{h.success("Variable created"),a(!1)},onError:b=>{const v=b.message||"Unknown error while creating variable.";n.setError("root",{message:v})}})}catch{n.setError("value",{message:"Value must be valid JSON"})}},j=s?"Edit Variable":"New Variable",f=s?"Edit the variable by changing the name, value, or tags.":"Add a new variable by providing a name, value, and optional tags. Values can be any valid JSON value.";return e.jsx(ce,{open:t,onOpenChange:a,children:e.jsxs(de,{children:[e.jsx(ue,{children:e.jsx(me,{children:j})}),e.jsx(ge,{children:f}),e.jsx(Ae,{...n,children:e.jsxs("form",{onSubmit:o=>{n.handleSubmit(x)(o)},className:"space-y-4",children:[e.jsx(N,{children:n.formState.errors.root?.message}),e.jsx(k,{control:n.control,name:"name",render:({field:o})=>e.jsxs(w,{children:[e.jsx(M,{children:"Name"}),e.jsx(I,{children:e.jsx(pe,{autoComplete:"off",...o})}),e.jsx(N,{})]})}),e.jsx(k,{control:n.control,name:"value",render:({field:o})=>e.jsxs(w,{children:[e.jsx(M,{children:"Value"}),e.jsx(I,{children:e.jsx(R,{...o})}),e.jsx(N,{})]})}),e.jsx(k,{control:n.control,name:"tags",render:({field:o})=>e.jsxs(w,{children:[e.jsx(M,{children:"Tags"}),e.jsx(I,{children:e.jsx(U,{...o})}),e.jsx(N,{})]})}),e.jsxs(he,{children:[e.jsx(xe,{asChild:!0,children:e.jsx(E,{type:"button",variant:"outline",children:"Close"})}),e.jsx(E,{type:"submit",loading:u||d,children:s?"Save":"Create"})]})]})})]})})},_=a=>({offset:a?.offset??0,limit:a?.limit??10,sort:a?.sort??"CREATED_DESC",variables:{operator:"and_",...a?.name&&{name:{like_:a.name}},...a?.tags?.length&&{tags:{operator:"and_",all_:a.tags}}}}),Fe=()=>{const a=p.useSearch(),t=p.useNavigate(),s=a.offset?Math.ceil(a.offset/a.limit):0,n=a.limit??10,r=c.useMemo(()=>({pageIndex:s,pageSize:n}),[s,n]),l=c.useCallback(u=>{t({to:".",search:m=>({...m,offset:u.pageIndex*u.pageSize,limit:u.pageSize}),replace:!0})},[t]);return[r,l]},Ue=()=>{const a=p.useSearch(),t=p.useNavigate(),s=c.useMemo(()=>[{id:"name",value:a.name},{id:"tags",value:a.tags}],[a.name,a.tags]),n=c.useCallback(r=>{t({to:".",search:l=>{const u=r.find(d=>d.id==="name")?.value,m=r.find(d=>d.id==="tags")?.value;return{...l,offset:0,name:u,tags:m}},replace:!0})},[t]);return[s,n]},ze=()=>{const a=p.useSearch(),t=p.useNavigate(),s=c.useCallback(n=>{t({to:".",search:r=>({...r,sort:n}),replace:!0})},[t]);return[a.sort,s]};function aa(){const a=p.useSearch(),[t,s]=Fe(),[n,r]=Ue(),[l,u]=ze(),[m,d]=Oe(),[{data:x},{data:j},{data:f}]=H({queries:[je(_(a)),T(_(a)),T()]}),o=(f??0)>0;return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(De,{onAddVariableClick:d}),e.jsx(Re,{...m}),o?e.jsx(Ie,{variables:x??[],currentVariableCount:j??0,pagination:t,onPaginationChange:s,columnFilters:n,onColumnFiltersChange:r,sorting:l,onSortingChange:u,onVariableEdit:d}):e.jsx(Te,{onAddVariableClick:d})]})}export{aa as component};
//# sourceMappingURL=index-_kpA__te.js.map
