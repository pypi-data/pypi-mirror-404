import{r as f,j as r,s as J}from"./vendor-tanstack-BcZfOOfy.js";import{u as Pe}from"./use-debounce-callback-CSs1BjLI.js";import{bL as Z,C as ee,q as L,I as ne,ag as te,ah as re,ai as se,aj as oe,al as ie,ak as ae,an as z,bt as De,am as X,di as Fe,dm as Ee,b9 as Q,G as Ve,p as W,L as ce,aa as Ae,cU as Me,cV as Te,a_ as $e,ax as Be,cW as Ke,cX as Le,i as Ue}from"./index-B8vo2Lrg.js";import{D as Je,a as ze,b as Re,d as C,e as We}from"./dropdown-menu-D7Gwbd15.js";import{m as U,c as D,i as fe,p as Ge,g as qe,d as Qe,C as Ye,e as He,f as me,D as Xe,h as Ze,S as en,v as nn,s as tn,K as rn,P as sn,j as on,B as an,k as cn,l as ln}from"./schema-form-input-string-format-datetime-nrb3g-JJ.js";import{H as un,a4 as dn,e as fn,f as he}from"./vendor-date-wwuDAncJ.js";import{T as mn,a as hn}from"./toggle-group-7WUJn2Tx.js";import{B as xn}from"./block-type-logo-CyAWq7mC.js";import{T as jn}from"./textarea-DUhh6-kq.js";import"./vendor-react-Bce9NwRC.js";import"./vendor-radix-BTiKGWfR.js";import"./vendor-recharts-BvvJP9Po.js";import"./vendor-forms-ClCIacbh.js";import"./zod-Cuos7J7w.js";import"./timezone-select-D4Q6VBtD.js";import"./form-mws4law8.js";const pn=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],bn=Z("eye-off",pn);const gn=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],yn=Z("eye",gn);const Sn=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],_n=Z("grip-vertical",Sn);function k(e){return e!==void 0}function N(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)&&!un(e)}function O(e){return Array.isArray(e)}function vn(e){return typeof e=="object"&&!Array.isArray(e)&&e!==null&&Object.keys(e).length===0}function A(e){return"$ref"in e}function ge(e){return"anyOf"in e&&k(e.anyOf)}function wn(e){return"oneOf"in e&&k(e.oneOf)}function kn(e){return"allOf"in e&&k(e.allOf)}function In(e){return"items"in e&&k(e.items)}function Nn(e){return"definitions"in e&&N(e.definitions)}function M(e,n){if(Nn(e)){const t=n.replace("#/definitions/",""),s=e.definitions?.[t];if(!s)throw new Error(`Definition not found for ${n}`);return s}if("$defs"in e&&N(e.$defs)){const t=n.replace("#/$defs/",""),s=e.$defs?.[t];if(!s)throw new Error(`Definition not found for ${n}`);return s}throw new Error("Schema does not contain definitions")}function ye(e,n){if(A(e)&&typeof e.$ref=="string"){const{$ref:t,...s}=e;return U({},M(n,t),s)}return e}function Cn({property:e,value:n,onValueChange:t,errors:s,id:o}){const{schema:i}=D(),c=f.useMemo(()=>{const{allOf:a,...d}=e,u=a.reduce((h,p)=>{if(A(p)){const l=M(i,p.$ref);return U({},h,l)}return U({},h,p)},{});return U({},u,d)},[e,i]);return r.jsx(ue,{value:n,onValueChange:t,errors:s,property:c,id:o})}function On({value:e,property:n,schema:t}){const s=k(e)?e:n.default;if(!k(s))return 0;const o=Pn(n,t);switch(typeof s){case"string":return o.findIndex(i=>i.type==="string");case"number":return o.findIndex(i=>i.type==="number"||i.type==="integer");case"boolean":return o.findIndex(i=>i.type==="boolean");case"object":return Dn(s,o);default:return-1}}function Pn(e,n){return e.anyOf?e.anyOf.map(t=>A(t)?M(n,t.$ref):t):[]}function Dn(e,n){return N(e)?Fn(e,n):O(e)?n.findIndex(t=>t.type==="array"):e===null?n.findIndex(t=>t.type==="null"):-1}function Fn(e,n){if(vn(e))return n.findIndex(i=>i.type==="object");const t=Object.keys(e),[s,o]=n.reduce(([i,c],a,d)=>{if(!("properties"in a)||!a.properties)return[i,c];const u=Object.keys(a.properties),h=t.filter(p=>u.includes(p)).length;return h>c?[d,h]:[i,c]},[0,0]);return o===0?-1:s}const En={null:"None",string:"str",boolean:"bool",integer:"int",number:"float",array:"list",object:"dict"};function Vn(e){if(e.type&&typeof e.type=="string")return En[e.type]}function le(e,n){if(A(e)){const s=M(n,e.$ref);return le(s,n)}const t=Vn(e)??"Field";return e.title??e.format??t}function Y({value:e,property:n,onValueChange:t,errors:s}){const{schema:o}=D(),[i,c]=f.useState(On({value:e,property:n,schema:o})),a=f.useRef(new Map);function d(u){const h=Number.parseInt(u,10);if(Number.isNaN(h))throw new Error(`Invalid index: ${u}`);a.current.set(i,e),c(h),t(a.current.get(h))}return r.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[r.jsx(mn,{size:"sm",variant:"outline",type:"single",value:i.toString(),onValueChange:d,className:"justify-start",children:n.anyOf.map((u,h)=>{const p=le(u,o);return r.jsx(hn,{value:h.toString(),children:p},p)})}),r.jsx(ee,{className:"p-2",children:r.jsx(Ce,{value:e,property:n.anyOf[i],onValueChange:t,errors:s,showLabel:!1,nested:!1,required:!1})})]})}const g=[];for(let e=0;e<256;++e)g.push((e+256).toString(16).slice(1));function An(e,n=0){return(g[e[n+0]]+g[e[n+1]]+g[e[n+2]]+g[e[n+3]]+"-"+g[e[n+4]]+g[e[n+5]]+"-"+g[e[n+6]]+g[e[n+7]]+"-"+g[e[n+8]]+g[e[n+9]]+"-"+g[e[n+10]]+g[e[n+11]]+g[e[n+12]]+g[e[n+13]]+g[e[n+14]]+g[e[n+15]]).toLowerCase()}let H;const Mn=new Uint8Array(16);function Tn(){if(!H){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");H=crypto.getRandomValues.bind(crypto)}return H(Mn)}const $n=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),xe={randomUUID:$n};function Bn(e,n,t){e=e||{};const s=e.random??e.rng?.()??Tn();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,An(s)}function je(e,n,t){return xe.randomUUID&&!e?xe.randomUUID():Bn(e)}function Kn(e){return typeof e=="string"}function Se(e){return N(e)&&"property"in e}function _e(e){return N(e)&&"index"in e}function ve({errors:e}){const n=f.useMemo(()=>e.filter(t=>Kn(t)),[e]);return n.length===0?null:n.length===1?r.jsx("p",{className:"text-red-500 text-sm",children:n[0]}):r.jsx("ul",{className:"list-disc text-red-500 text-sm pl-4",children:n.map(t=>r.jsx("li",{children:t},t))})}function we(e){return K(e)?e.__prefect_kind:null}function K(e,n){return N(e)&&fe(e.__prefect_kind)?fe(n)?e.__prefect_kind===n:!0:!1}function Ln({value:e,property:n,schema:t,to:s}){const o=we(e);try{switch(o){case"json":return Un({json:e,property:n,schema:t,to:s});case"jinja":return Jn({jinja:e,property:n,schema:t,to:s});case"workspace_variable":return zn({workspaceVariable:e,to:s});case null:return Rn({value:e,property:n,schema:t,to:s});default:throw new Error(`Unknown prefect kind value: ${o}`)}}catch(i){console.error(i);return}}function Un({json:e,property:n,schema:t,to:s}){switch(s){case"jinja":return{__prefect_kind:"jinja",template:e.value};case"json":return e;case"workspace_variable":return{__prefect_kind:"workspace_variable",variable_name:void 0};case null:if(e.value===void 0)return;try{const o=JSON.parse(e.value);return G({value:o,property:n,schema:t})}catch{throw new ke("json",null)}default:throw new Error(`mapSchemaValueJson missing case for kind: ${s}`)}}function Jn({jinja:e,property:n,schema:t,to:s}){switch(s){case"jinja":return e;case"json":return{__prefect_kind:"json",value:e.template};case"workspace_variable":return{__prefect_kind:"workspace_variable",variable_name:void 0};case null:if(e.template===void 0)return;try{const o=JSON.parse(e.template);return G({value:o,property:n,schema:t})}catch{throw new ke("jinja",null)}default:throw new Error(`mapSchemaValueJson missing case for kind: ${s}`)}}function zn({workspaceVariable:e,to:n}){switch(n){case"workspace_variable":return e;case"jinja":return{__prefect_kind:"jinja",template:void 0};case"json":return{__prefect_kind:"json",value:void 0};case null:return;default:throw new Error(`mapSchemaValueWorkspaceVariable missing case for kind: ${n}`)}}function Rn({value:e,property:n,schema:t,to:s}){switch(s){case"jinja":return{__prefect_kind:"jinja",template:e===void 0?void 0:JSON.stringify(e,null,2)};case"json":return{__prefect_kind:"json",value:e===void 0?void 0:JSON.stringify(e,null,2)};case"workspace_variable":return{__prefect_kind:"workspace_variable",variable_name:void 0};case null:return G({value:e,property:n,schema:t});default:throw new Error(`mapSchemaValueNull missing case for kind: ${s}`)}}function G({value:e,property:n,schema:t}){return O(n)?n.map(o=>R({value:e,property:o,schema:t})).find(o=>o!==void 0):R({value:e,property:n,schema:t})}function R({value:e,property:n,schema:t}){const s=ye(n,t);if(ge(s))return G({value:e,property:s.anyOf,schema:t});switch(s.type){case"null":return null;case"string":return typeof e=="string"?e:void 0;case"boolean":return typeof e=="boolean"?e:void 0;case"number":return typeof e=="number"?e:void 0;case"integer":return typeof e=="number"?Math.round(e):void 0;case"array":return Wn({value:e,property:s,schema:t});case"object":return Gn({value:e,property:s,schema:t});default:if(O(s.type)){console.error(new Error("Array types are not supported for schema coercing values to schema properties"));return}throw new Error(`Unsupported property type: ${s.type}`)}}function Wn({value:e,property:n,schema:t}){return O(e)?[...e].map(o=>R({value:o,property:n,schema:t})):void 0}function Gn({value:e,property:n,schema:t}){if(!N(e))return;if(n.properties===void 0)return e;const s={...e};for(const[o,i]of Object.entries(n.properties))R({value:e[o],property:i,schema:t})===void 0&&delete s[o];return s}class ke extends Error{constructor(n,t){super(`Unable to convert prefect kind value from "${n}" to "${t??"null"}"`)}}const Ie=({value:e,onValueChange:n,property:t,children:s,disableKinds:o,defaultValue:i,hasDefaultValue:c})=>{const{schema:a,kinds:d}=D(),[u,h]=f.useState(!1),p=!c||JSON.stringify(e)===JSON.stringify(i);function l(){c&&n(i)}function x(v){const S=Ln({value:e,property:t,schema:a,to:v});n(S)}const y=f.useMemo(()=>{const v=we(e);return Ge.filter(S=>S!==v&&(d.includes(S)||S===null)&&!o)},[e,d,o]);return r.jsxs(Je,{open:u,onOpenChange:h,children:[r.jsx(ze,{asChild:!0,children:r.jsxs(L,{variant:"ghost","data-open":u,className:"h-8 w-8 p-0",children:[r.jsx("span",{className:"sr-only",children:"Open menu"}),r.jsx(ne,{id:"MoreVertical",className:"size-4"})]})}),r.jsxs(Re,{align:"end",children:[y.map(v=>r.jsx(C,{onClick:()=>x(v),children:qe(v)},v)),c&&r.jsx(C,{onClick:l,disabled:p,children:"Use default value"}),r.jsx(We,{}),s]})]})};function qn({itemKey:e,items:n,value:t,onValueChange:s,errors:o,onDelete:i,first:c,last:a,canMove:d,moveUp:u,moveDown:h,moveToTop:p,moveToBottom:l}){const{schema:x}=D(),y=f.useId(),{attributes:v,listeners:S,setNodeRef:I,transform:F,transition:E,isDragging:$}=Qe({id:e,disabled:!d}),B={transform:Ye.Transform.toString(F),transition:E,opacity:$?.5:1},w=f.useMemo(()=>O(n)?{anyOf:n}:A(n)?M(x,n.$ref):n,[n,x]);return r.jsxs("div",{ref:I,style:B,className:"grid grid-cols-[auto_1fr_auto] gap-2",children:[d?r.jsx("button",{type:"button",className:"flex items-center justify-center cursor-grab text-muted-foreground hover:text-foreground focus:outline-none","aria-label":"Drag to reorder",...v,...S,children:r.jsx(_n,{className:"h-5 w-5"})}):r.jsx("div",{className:"w-5"}),r.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[r.jsx(ue,{value:t,onValueChange:s,property:w,errors:o,id:y}),r.jsx(ve,{errors:o})]}),r.jsxs(Ie,{value:t,onValueChange:s,property:n,children:[r.jsx(C,{onClick:i,children:"Delete"}),d&&!c&&r.jsxs(r.Fragment,{children:[r.jsx(C,{onClick:p,children:"Move to top"}),r.jsx(C,{onClick:u,children:"Move up"})]}),d&&!a&&r.jsxs(r.Fragment,{children:[r.jsx(C,{onClick:h,children:"Move down"}),r.jsx(C,{onClick:l,children:"Move to bottom"})]})]})]})}function Qn({property:e,values:n,onValuesChange:t,errors:s}){const o=n===void 0||n.length===0,i=e.maxItems===void 0||(n?.length??0)<(e.maxItems??Number.POSITIVE_INFINITY),c=O(e.prefixItems)?e.prefixItems.length:0,a=He(me(sn),me(rn,{coordinateGetter:tn})),[d,u]=f.useState(n?.map(m=>({key:je(),value:m}))??[]);function h(m){return O(e.prefixItems)&&m<e.prefixItems.length?e.prefixItems[m]:e.items??{type:"string"}}function p(m){return s.filter(b=>_e(b)&&b.index===m).flatMap(b=>b.errors)}function l(m){return m===0}function x(m){return m===(n?.length??0)-1}function y(m){return!(O(e.prefixItems)&&m<e.prefixItems.length)}function v(m,b){u(d.map(j=>j.key===m?{...j,value:b}:j))}function S(){const m=[...d,{key:je(),value:void 0}];u(m),t(m.map(({value:b})=>b))}function I(m,b){const j=[...d];j.splice(b,0,j.splice(m,1)[0]),u(j),t(j.map(({value:V})=>V))}function F(m){I(m,0)}function E(m){I(m,d.length-1)}function $(m){const b=d.filter(j=>j.key!==m);u(b),t(b.map(({value:j})=>j))}function B(m){const{active:b,over:j}=m;if(j&&b.id!==j.id){const V=d.findIndex(q=>q.key===b.id),de=d.findIndex(q=>q.key===j.id);V!==-1&&de!==-1&&I(V,de)}}const w=d.slice(c).map(m=>m.key);return r.jsxs(ee,{className:"flex flex-col gap-2 p-2",children:[o&&r.jsx("p",{className:"text-sm text-subdued italic",children:"No items in this list"}),r.jsx(Xe,{sensors:a,collisionDetection:Ze,onDragEnd:B,children:r.jsx(en,{items:w,strategy:nn,children:d?.map(({key:m,value:b},j)=>r.jsx(qn,{itemKey:m,items:h(j),value:b,onValueChange:V=>v(m,V),errors:p(j),onDelete:()=>$(m),first:l(j),last:x(j),canMove:y(j),moveUp:()=>I(j,j-1),moveDown:()=>I(j,j+1),moveToTop:()=>F(j),moveToBottom:()=>E(j)},m))})}),i&&r.jsx("div",{className:"flex justify-end",children:r.jsx(L,{size:"sm",variant:"outline",onClick:S,children:"Add item"})}),!i&&r.jsx("p",{className:"text-sm text-subdued text-right",children:"You can't add more items"})]})}function T({property:e,id:n,...t}){const[s,o]=f.useState(""),i=f.useMemo(()=>Object.fromEntries(Object.entries(e.enum).filter(([,l])=>String(l).toLowerCase().includes(s.toLowerCase()))),[e.enum,s]),c=!!(t.multiple?t.values?.length:t.value),a=t.multiple?t.values?.join(", "):String(t.value);function d(l){const x=i[l];return t.multiple?t.values?.includes(x):t.value===x}function u(l){o("");const x=i[l];return t.multiple?p(x):h(x)}function h(l){if(t.multiple)throw new Error("onSingleSelect called on multiple value input");t.onValueChange(l)}function p(l){if(!t.multiple)throw new Error("onMultipleSelect called on single value input");if(!t.values){t.onValuesChange([l]);return}if(t.values?.includes(l)){t.onValuesChange(t.values.filter(x=>x!==l));return}t.onValuesChange([...t.values,l])}return r.jsxs(te,{children:[r.jsx(re,{selected:c,"aria-label":`Select ${e.title}`,id:n,children:c?a:"Select"}),r.jsxs(se,{children:[r.jsx(oe,{value:s,onValueChange:o,placeholder:"Search..."}),r.jsx(ie,{children:"No values found"}),r.jsx(ae,{children:Object.entries(i).map(([l,x])=>r.jsx(z,{value:l,onSelect:u,selected:d(l),closeOnSelect:!t.multiple,children:String(x)},l))})]})]})}function P(e){return"enum"in e&&Array.isArray(e.enum)&&e.enum.every(n=>on(typeof n))}function _(e,n){if(typeof e==typeof n())return e}function Yn(e){if(N(e))return e}function Hn(e){return _(e,String)??_(e,Number)??_(e,Boolean)}function Ne(e,n){if(n===void 0&&Array.isArray(e))return e;if(Array.isArray(e))switch(n){case String:return e.map(t=>_(t,String)).filter(t=>t!==void 0);case Number:return e.map(t=>_(t,Number)).filter(t=>t!==void 0);case Boolean:return e.map(t=>_(t,Boolean)).filter(t=>t!==void 0);case"primitive":return e.map(t=>_(t,String)??_(t,Number)??_(t,Boolean)).filter(t=>t!==void 0);default:throw new Error(`Invalid array type: ${n}`)}}function Xn({values:e,property:n,onValuesChange:t,errors:s,id:o}){const{schema:i}=D();function c(a){if(a===void 0||a.length===0){t(void 0);return}t(a)}if(In(n)&&N(n.items)){let a=n.items;if(A(a)&&(a=M(i,a.$ref)),P(a)){const d={...n,...a};return r.jsx(T,{multiple:!0,values:Ne(e,"primitive"),property:d,onValuesChange:c,id:o})}}return r.jsx(Qn,{property:n,values:e,onValuesChange:c,errors:s})}const Zn=({blockTypeSlug:e,selectedBlockDocumentId:n,onSelect:t,onCreateNew:s})=>r.jsx(f.Suspense,{children:r.jsx(et,{blockTypeSlug:e,selectedBlockDocumentId:n,onSelect:t,onCreateNew:s})}),et=({blockTypeSlug:e,selectedBlockDocumentId:n,onSelect:t,onCreateNew:s})=>{const[o,i]=f.useState(""),c=f.useDeferredValue(o),{data:a}=J(De({offset:0,sort:"BLOCK_TYPE_AND_NAME_ASC",include_secrets:!1,block_types:{slug:{any_:[e]}},block_documents:{operator:"and_",is_anonymous:{eq_:!1},...c?{name:{like_:c}}:{}},limit:50})),d=f.useMemo(()=>a.filter(h=>h.name?.toLowerCase().includes(c.toLowerCase())),[a,c]),u=f.useMemo(()=>a.find(h=>h.id===n),[a,n]);return r.jsxs(te,{children:[r.jsx(re,{selected:!!n,"aria-label":"Select a block",children:u?.name??"Select a block..."}),r.jsxs(se,{children:[r.jsx(oe,{value:o,onValueChange:i,placeholder:"Search for a block..."}),r.jsx(ie,{children:"No block found"}),r.jsxs(ae,{children:[r.jsx(X,{children:d.map(h=>r.jsx(z,{selected:n===h.id,onSelect:p=>{t(p),i("")},value:h.id,children:h.name},h.id))}),s&&r.jsx(X,{children:r.jsxs(z,{onSelect:()=>{s(),i("")},value:"__create_new__",closeOnSelect:!0,children:[r.jsx(ne,{id:"Plus",className:"mr-2 size-4"}),"Create new block"]})})]})]})]})};function nt({value:e,onValueChange:n,blockTypeSlug:t,id:s}){return r.jsx(f.Suspense,{fallback:r.jsx(tt,{}),children:r.jsx(rt,{value:e,onValueChange:n,blockTypeSlug:t,id:s})})}function tt(){return r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Q,{className:"size-8 rounded"}),r.jsx(Q,{className:"h-9 flex-1"}),r.jsx(Q,{className:"h-9 w-20"})]})}function rt({value:e,onValueChange:n,blockTypeSlug:t,id:s}){const[o,i]=f.useState(!1),{data:c}=J(Fe(t)),{data:a}=J(Ee({block_types:{slug:{any_:[t]}},block_documents:{operator:"and_",is_anonymous:{eq_:!1}},include_secrets:!1,sort:"BLOCK_TYPE_AND_NAME_ASC",offset:0})),d=a>0,u=e?.$ref,h=l=>{n(l?{$ref:l}:void 0)},p=l=>{n({$ref:l})};return r.jsxs("div",{id:s,className:"flex items-center gap-2",children:[r.jsx(xn,{logoUrl:c.logo_url,alt:c.name}),d&&r.jsx("div",{className:"flex-1",children:r.jsx(Zn,{blockTypeSlug:t,selectedBlockDocumentId:u,onSelect:h,onCreateNew:()=>i(!0)})}),r.jsxs(L,{type:"button",variant:"outline",onClick:()=>i(!0),children:["Add",r.jsx(ne,{id:"Plus",className:"ml-2 size-4"})]}),r.jsx(an,{open:o,onOpenChange:i,blockTypeSlug:t,onCreated:p})]})}function st({value:e,onValueChange:n,property:t,id:s}){function o(i){n(_(i,Boolean))}return P(t)?r.jsx(T,{multiple:!1,value:e,property:t,onValueChange:n,id:s}):r.jsx(Ve,{checked:e,onCheckedChange:o,id:s})}function ot({value:e,onValueChange:n,property:t,id:s}){if(P(t))return r.jsx(T,{multiple:!1,value:e,property:t,onValueChange:n,id:s});function o(i){n(i===""?void 0:Number(i))}return r.jsx(W,{type:"number",min:t.minimum,max:t.maximum,value:e??"",step:"1",onChange:i=>o(i.target.value),id:s})}function it(){return r.jsx("p",{className:"text-subdued text-sm",children:'Property is type "None"'})}function at({value:e,onValueChange:n,property:t,id:s}){if(P(t))return r.jsx(T,{multiple:!1,value:e,property:t,onValueChange:n,id:s});function o(i){n(i===""?void 0:Number(i))}return r.jsx(W,{type:"number",min:t.minimum,max:t.maximum,value:e??"",onChange:i=>o(i.target.value),id:s})}function ct({value:e,onValueChange:n,id:t}){const s=o=>{(typeof o=="string"||o===void 0)&&n({__prefect_kind:"jinja",template:o||void 0})};return r.jsx(ce,{value:e.template,onChange:s,id:t})}function lt({value:e,onValueChange:n,id:t}){const s=o=>{(typeof o=="string"||o===void 0)&&n({__prefect_kind:"json",value:o||void 0})};return r.jsx(ce,{value:e.value,onChange:s,id:t})}const ut=({selectedVariableName:e,onSelect:n})=>r.jsx(f.Suspense,{children:r.jsx(dt,{selectedVariableName:e,onSelect:n})}),dt=({selectedVariableName:e,onSelect:n})=>{const[t,s]=f.useState(""),o=f.useDeferredValue(t),{data:i}=J(Ae({offset:0,sort:"NAME_ASC",variables:o?{operator:"and_",name:{like_:o}}:void 0,limit:50})),c=f.useMemo(()=>i.filter(a=>a.name.toLowerCase().includes(o.toLowerCase())),[i,o]);return r.jsxs(te,{children:[r.jsx(re,{selected:!!e,"aria-label":"Select a variable",children:e??"Select a variable..."}),r.jsxs(se,{children:[r.jsx(oe,{value:t,onValueChange:s,placeholder:"Search for a variable..."}),r.jsx(ie,{children:"No variable found"}),r.jsx(ae,{children:r.jsx(X,{children:c.map(a=>r.jsx(z,{selected:e===a.name,onSelect:d=>{n(d),s("")},value:a.name,children:a.name},a.id))})})]})]})};function ft({value:e,onValueChange:n,id:t}){const s=o=>{n({__prefect_kind:"workspace_variable",variable_name:o})};return r.jsx("div",{id:t,children:r.jsx(ut,{selectedVariableName:e.variable_name,onSelect:s})})}const pe="yyyy-MM-dd";function mt({value:e,onValueChange:n,id:t}){const s=e?dn(e,pe,fn()):void 0,[o,i]=f.useState(s);function c(a){i(a),n(a?he(a,pe):void 0)}return r.jsxs(Me,{children:[r.jsx(Te,{asChild:!0,children:r.jsxs(L,{variant:"outline",className:$e("justify-start text-left font-normal w-full",!o&&"text-muted-foreground"),id:t,children:[r.jsx(Be,{className:"mr-2 h-4 w-4"}),o?he(o,"PPP"):r.jsx("span",{children:"Pick a date"})]})}),r.jsx(Ke,{className:"w-auto p-0",children:r.jsx(Le,{mode:"single",selected:o,onSelect:c,required:!0,autoFocus:!0})})]})}function ht({value:e,onValueChange:n,id:t}){const s=o=>{(typeof o=="string"||o===void 0)&&n(o||void 0)};return r.jsx(ce,{value:e,onChange:s,id:t})}function xt({value:e,onValueChange:n,id:t}){const[s,o]=f.useState(!1),i=c=>{n(c.target.value||void 0)};return r.jsxs("div",{className:"relative",children:[r.jsx(W,{id:t,type:s?"text":"password",value:e??"",onChange:i,autoComplete:"off",className:"pr-10"}),r.jsx(L,{type:"button",variant:"ghost",size:"icon",className:"absolute right-1 top-1/2 -translate-y-1/2 h-7 w-7",onClick:()=>o(!s),"aria-label":s?"Hide password":"Show password",children:s?r.jsx(bn,{className:"h-4 w-4"}):r.jsx(yn,{className:"h-4 w-4"})})]})}function jt({value:e,onValueChange:n,id:t}){function s(o){const i=o.target.value;if(i===""){n(void 0);return}const c=Number(i);Number.isNaN(c)||n(String(c))}return r.jsx(W,{type:"number",value:e??"",onChange:s,id:t,placeholder:"Duration in seconds",min:0})}function pt({value:e,onValueChange:n,property:t,id:s}){function o(i){n(i||void 0)}return P(t)?r.jsx(T,{multiple:!1,value:e,property:t,onValueChange:o,id:s}):t.format==="date"?r.jsx(mt,{value:e,onValueChange:o,id:s}):t.format==="date-time"?r.jsx(cn,{value:e,onValueChange:o,id:s}):t.format==="json-string"?r.jsx(ht,{value:e,onValueChange:o,id:s}):t.format==="time-delta"?r.jsx(jt,{value:e,onValueChange:o,id:s}):t.format==="password"?r.jsx(xt,{value:e,onValueChange:o,id:s}):r.jsx(jn,{value:e??"",rows:1,className:"min-h-min",onChange:i=>o(i.target.value),id:s})}function bt({value:e,onValueChange:n,property:t,id:s}){return f.useEffect(()=>{P(t)||n({__prefect_kind:"json"})},[t,n]),P(t)?r.jsx(T,{multiple:!1,value:Hn(e),property:t,onValueChange:n,id:s}):null}function ue({value:e,onValueChange:n,errors:t,property:s,id:o,nested:i=!0}){if(K(e)){if(K(e,"json"))return r.jsx(lt,{value:e,onValueChange:n,id:o});if(K(e,"jinja"))return r.jsx(ct,{value:e,onValueChange:n,id:o});if(K(e,"workspace_variable"))return r.jsx(ft,{value:e,onValueChange:n,id:o});throw new Error(`Prefect kind not implemented: ${e.__prefect_kind}`)}if("block_type_slug"in s){const c=s.block_type_slug;if(typeof c=="string")return r.jsx(nt,{value:e,onValueChange:n,blockTypeSlug:c,id:o})}if(ge(s))return r.jsx(Y,{value:e,property:s,onValueChange:n,errors:t});if(wn(s)){const c={...s,anyOf:s.oneOf};return r.jsx(Y,{value:e,property:c,onValueChange:n,errors:t})}if(Array.isArray(s.type)){const c={...s,anyOf:Object.values(s.type).map(a=>({type:a}))};return r.jsx(Y,{value:e,property:c,onValueChange:n,errors:t})}if(kn(s))return r.jsx(Cn,{value:e,onValueChange:n,errors:t,property:s,id:o});if(s.type==="string")return r.jsx(pt,{value:_(e,String),onValueChange:n,property:s,id:o});if(s.type==="integer")return r.jsx(ot,{value:_(e,Number),onValueChange:n,property:s,id:o});if(s.type==="number")return r.jsx(at,{value:_(e,Number),onValueChange:n,property:s,id:o});if(s.type==="boolean")return r.jsx(st,{value:_(e,Boolean),onValueChange:n,property:s,id:o});if(s.type==="object")return r.jsx(Oe,{values:Yn(e),property:s,onValuesChange:n,errors:t,nested:i});if(s.type==="array")return r.jsx(Xn,{values:Ne(e),property:s,onValuesChange:n,errors:t,id:o});if(s.type==="null")return r.jsx(it,{});if(s.type===void 0)return r.jsx(bt,{value:e,onValueChange:n,property:s,id:o});throw new Error(`Schema type not implemented: ${String(s.type)}`)}function be({property:e}){const n=f.useMemo(()=>e.description?.replace(/\n(?!\n)/g," "),[e.description]);return n&&r.jsx("p",{className:"text-sm text-gray-500",children:n})}function gt({property:e,required:n,id:t}){const{schema:s}=D(),o=f.useMemo(()=>{const i=le(e,s);return n?i:`${i} (Optional)`},[e,n,s]);return r.jsx(Ue,{htmlFor:t,children:o})}function Ce({property:e,value:n,onValueChange:t,required:s,errors:o,showLabel:i=!0,nested:c=!0}){const{schema:a,skipDefaultValueInitialization:d}=D(),u=f.useMemo(()=>ye(e,a),[e,a]),h=f.useMemo(()=>!k(u.type),[u.type]),p=f.useMemo(()=>o.filter(w=>Se(w)||_e(w)),[o]),[l,x]=f.useState(!1),[y,v]=f.useState(B),[S,I]=f.useState(!1),F=f.useId(),E=f.useCallback(w=>{v(w),t(w)},[t]),$=f.useCallback(()=>{const w=!S;I(w),t(w?void 0:y)},[S,t,y]);f.useEffect(()=>{l||d||(k(u.default)&&!k(n)&&t(u.default),x(!0))},[l,d,t,u.default,n]);function B(){if(k(n))return n;if(k(u.default)&&!d)return u.default}return r.jsxs("div",{className:"flex flex-col gap-2 group",children:[i&&r.jsxs("div",{className:"grid grid-cols-[1fr_auto] items-center gap-2",children:[r.jsxs("div",{className:"flex flex-col gap-1",children:[r.jsx(gt,{property:u,required:s,id:F}),r.jsx(be,{property:u})]}),r.jsx("div",{className:"ml-auto",children:r.jsx(Ie,{value:n,onValueChange:E,property:u,disableKinds:h,defaultValue:u.default,hasDefaultValue:k(u.default),children:r.jsx(C,{onClick:$,children:S?"Include value":"Omit value"})})})]}),!i&&r.jsx(be,{property:u}),r.jsx("fieldset",{disabled:S,children:r.jsx(ue,{property:u,value:y,onValueChange:E,errors:p,id:F,nested:c})}),r.jsx(ve,{errors:o})]})}function yt(e,n){return(e.position??0)-(n.position??0)}function Oe({values:e,onValuesChange:n,property:t,errors:s,nested:o}){const i=f.useRef([]),c=Pe(f.useCallback(()=>{const l={...e};for(const{key:x,value:y}of i.current)l[x]=y,y===void 0&&delete l[x];if(i.current=[],Object.keys(l).length===0){n(void 0);return}n(l)},[e,n]),10);function a(l,x){i.current.push({key:l,value:x}),c()}function d(l){return e?.[l]}function u(l){return s.filter(Se).filter(x=>x.property===l).flatMap(x=>x.errors)}const h=f.useMemo(()=>Object.entries(t.properties??{}).sort(([,l],[,x])=>yt(l,x)),[t.properties]),p=r.jsx("div",{className:"flex flex-col gap-4",children:h.map(([l,x])=>r.jsx(Ce,{value:d(l),onValueChange:y=>a(l,y),property:x,errors:u(l),required:!!t.required?.includes(l)},l))});return o?r.jsx(ee,{className:"p-2",children:p}):p}const St=({children:e,...n})=>r.jsx(ln.Provider,{value:n,children:e}),$t=({schema:e,kinds:n,skipDefaultValueInitialization:t,values:s,onValuesChange:o,errors:i})=>{const c={schema:e,kinds:n,skipDefaultValueInitialization:t},a=f.useCallback(u=>{if(u===void 0){o({});return}o(u)},[o]),d={values:s,property:e,onValuesChange:a,errors:i};return r.jsx("div",{className:"flex flex-col gap-4",children:r.jsx(St,{...c,children:r.jsx(Oe,{...d,nested:!1})})})};export{$t as SchemaForm};
//# sourceMappingURL=schema-form-BwTmkvJk.js.map
