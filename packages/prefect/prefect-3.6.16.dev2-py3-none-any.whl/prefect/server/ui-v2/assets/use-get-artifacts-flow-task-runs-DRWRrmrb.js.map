{"version":3,"file":"use-get-artifacts-flow-task-runs-DRWRrmrb.js","sources":["../../src/api/artifacts/use-get-artifacts-flow-task-runs/use-get-artifacts-flow-task-runs.ts"],"sourcesContent":["import { useQueries, useQuery } from \"@tanstack/react-query\";\nimport { buildFilterFlowRunsQuery } from \"@/api/flow-runs\";\nimport { buildListTaskRunsQuery } from \"@/api/task-runs\";\nimport {\n\ttype ArtifactsFilter,\n\ttype ArtifactWithFlowRunAndTaskRun,\n\tbuildGetArtifactQuery,\n\tbuildListArtifactsQuery,\n} from \"..\";\n\nexport const useFilterArtifactsFlowTaskRuns = (filter: ArtifactsFilter) => {\n\tconst { data: artifacts } = useQuery(buildListArtifactsQuery(filter));\n\n\tconst flowRunIds = artifacts\n\t\t?.map((artifact) => artifact.flow_run_id)\n\t\t.filter((val) => val != null && val !== undefined);\n\tconst taskRunIds = artifacts\n\t\t?.map((artifact) => artifact.task_run_id)\n\t\t.filter((val) => val != null && val !== undefined);\n\n\tconst { flowRuns, taskRuns } = useQueries({\n\t\tqueries: [\n\t\t\tbuildFilterFlowRunsQuery({\n\t\t\t\tflow_runs: {\n\t\t\t\t\toperator: \"and_\",\n\t\t\t\t\tid: {\n\t\t\t\t\t\tany_: flowRunIds,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tsort: \"ID_DESC\",\n\t\t\t\toffset: 0,\n\t\t\t}),\n\t\t\tbuildListTaskRunsQuery({\n\t\t\t\ttask_runs: {\n\t\t\t\t\toperator: \"and_\",\n\t\t\t\t\tid: {\n\t\t\t\t\t\tany_: taskRunIds,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tsort: \"ID_DESC\",\n\t\t\t\toffset: 0,\n\t\t\t}),\n\t\t],\n\t\tcombine: (data) => {\n\t\t\tconst [flowRuns, taskRuns] = data;\n\t\t\treturn {\n\t\t\t\tflowRuns: flowRuns.data,\n\t\t\t\ttaskRuns: taskRuns.data,\n\t\t\t};\n\t\t},\n\t});\n\n\tconst artifactsWithMetadata = artifacts?.map((artifact) => {\n\t\tconst flowRun = flowRuns?.find(\n\t\t\t(flowRun) => flowRun.id === artifact.flow_run_id,\n\t\t);\n\t\tconst taskRun = taskRuns?.find(\n\t\t\t(taskRun) => taskRun.id === artifact.task_run_id,\n\t\t);\n\n\t\treturn {\n\t\t\t...artifact,\n\t\t\tflow_run: flowRun,\n\t\t\ttask_run: taskRun,\n\t\t};\n\t});\n\n\treturn artifactsWithMetadata as ArtifactWithFlowRunAndTaskRun[];\n};\n\nexport const useGetArtifactFlowTaskRuns = (artifactId: string) => {\n\tconst { data: artifact } = useQuery(buildGetArtifactQuery(artifactId));\n\n\tconst flowRunId = artifact?.flow_run_id;\n\tconst taskRunId = artifact?.task_run_id;\n\tconst { flowRuns, taskRuns } = useQueries({\n\t\tqueries: [\n\t\t\tbuildFilterFlowRunsQuery({\n\t\t\t\tflow_runs: {\n\t\t\t\t\toperator: \"and_\",\n\t\t\t\t\tid: {\n\t\t\t\t\t\tany_: [flowRunId ?? \"\"],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tsort: \"ID_DESC\",\n\t\t\t\toffset: 0,\n\t\t\t}),\n\t\t\tbuildListTaskRunsQuery({\n\t\t\t\ttask_runs: {\n\t\t\t\t\toperator: \"and_\",\n\t\t\t\t\tid: {\n\t\t\t\t\t\tany_: [taskRunId ?? \"\"],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tsort: \"ID_DESC\",\n\t\t\t\toffset: 0,\n\t\t\t}),\n\t\t],\n\t\tcombine: (data) => {\n\t\t\tconst [flowRuns, taskRuns] = data;\n\t\t\treturn {\n\t\t\t\tflowRuns: flowRuns.data,\n\t\t\t\ttaskRuns: taskRuns.data,\n\t\t\t};\n\t\t},\n\t});\n\n\treturn {\n\t\t...artifact,\n\t\tflow_run: flowRuns?.[0],\n\t\ttask_run: taskRuns?.[0],\n\t} as ArtifactWithFlowRunAndTaskRun;\n};\n"],"names":["useFilterArtifactsFlowTaskRuns","filter","artifacts","useQuery","buildListArtifactsQuery","flowRunIds","artifact","val","taskRunIds","flowRuns","taskRuns","useQueries","buildFilterFlowRunsQuery","buildListTaskRunsQuery","data","flowRun","taskRun","useGetArtifactFlowTaskRuns","artifactId","buildGetArtifactQuery","flowRunId","taskRunId"],"mappings":"0HAUO,MAAMA,EAAkCC,GAA4B,CAC1E,KAAM,CAAE,KAAMC,CAAA,EAAcC,EAASC,EAAwBH,CAAM,CAAC,EAE9DI,EAAaH,GAChB,IAAKI,GAAaA,EAAS,WAAW,EACvC,OAAQC,GAAQA,GAAO,MAAQA,IAAQ,MAAS,EAC5CC,EAAaN,GAChB,IAAKI,GAAaA,EAAS,WAAW,EACvC,OAAQC,GAAQA,GAAO,MAAQA,IAAQ,MAAS,EAE5C,CAAE,SAAAE,EAAU,SAAAC,CAAA,EAAaC,EAAW,CACzC,QAAS,CACRC,EAAyB,CACxB,UAAW,CACV,SAAU,OACV,GAAI,CACH,KAAMP,CAAA,CACP,EAED,KAAM,UACN,OAAQ,CAAA,CACR,EACDQ,EAAuB,CACtB,UAAW,CACV,SAAU,OACV,GAAI,CACH,KAAML,CAAA,CACP,EAED,KAAM,UACN,OAAQ,CAAA,CACR,CAAA,EAEF,QAAUM,GAAS,CAClB,KAAM,CAACL,EAAUC,CAAQ,EAAII,EAC7B,MAAO,CACN,SAAUL,EAAS,KACnB,SAAUC,EAAS,IAAA,CAErB,CAAA,CACA,EAiBD,OAf8BR,GAAW,IAAKI,GAAa,CAC1D,MAAMS,EAAUN,GAAU,KACxBM,GAAYA,EAAQ,KAAOT,EAAS,WAAA,EAEhCU,EAAUN,GAAU,KACxBM,GAAYA,EAAQ,KAAOV,EAAS,WAAA,EAGtC,MAAO,CACN,GAAGA,EACH,SAAUS,EACV,SAAUC,CAAA,CAEZ,CAAC,CAGF,EAEaC,EAA8BC,GAAuB,CACjE,KAAM,CAAE,KAAMZ,CAAA,EAAaH,EAASgB,EAAsBD,CAAU,CAAC,EAE/DE,EAAYd,GAAU,YACtBe,EAAYf,GAAU,YACtB,CAAE,SAAAG,EAAU,SAAAC,CAAA,EAAaC,EAAW,CACzC,QAAS,CACRC,EAAyB,CACxB,UAAW,CACV,SAAU,OACV,GAAI,CACH,KAAM,CAACQ,GAAa,EAAE,CAAA,CACvB,EAED,KAAM,UACN,OAAQ,CAAA,CACR,EACDP,EAAuB,CACtB,UAAW,CACV,SAAU,OACV,GAAI,CACH,KAAM,CAACQ,GAAa,EAAE,CAAA,CACvB,EAED,KAAM,UACN,OAAQ,CAAA,CACR,CAAA,EAEF,QAAUP,GAAS,CAClB,KAAM,CAACL,EAAUC,CAAQ,EAAII,EAC7B,MAAO,CACN,SAAUL,EAAS,KACnB,SAAUC,EAAS,IAAA,CAErB,CAAA,CACA,EAED,MAAO,CACN,GAAGJ,EACH,SAAUG,IAAW,CAAC,EACtB,SAAUC,IAAW,CAAC,CAAA,CAExB"}