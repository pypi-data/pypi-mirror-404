import{j as e,d as B,L as y,s as h}from"./vendor-tanstack-BcZfOOfy.js";import{B as N,g as F,h as n,bw as i,bF as d,bH as v,dk as _,C as S,p as C,q as p,y as u,dQ as L,di as w,dj as E}from"./index-B8vo2Lrg.js";import{a as D}from"./zod-Cuos7J7w.js";import{c as P,o as A,s as Q}from"./vendor-forms-ClCIacbh.js";import{B as R}from"./block-type-details-CYrdaLot.js";import{u as T,L as U}from"./schema-form-input-string-format-datetime-nrb3g-JJ.js";import"./toggle-group-7WUJn2Tx.js";import{F as V,b as I,c as z,d as G,e as H,a as M}from"./form-mws4law8.js";import"./vendor-react-Bce9NwRC.js";import"./vendor-radix-BTiKGWfR.js";import"./vendor-recharts-BvvJP9Po.js";import"./vendor-date-wwuDAncJ.js";import"./block-type-logo-CyAWq7mC.js";import"./lazy-markdown-1Hz0xzca.js";import"./use-debounce-callback-CSs1BjLI.js";import"./timezone-select-D4Q6VBtD.js";import"./dropdown-menu-D7Gwbd15.js";const $=({blockType:s})=>e.jsx(N,{children:e.jsxs(F,{children:[e.jsx(n,{children:e.jsx(i,{to:"/blocks",className:"text-xl font-semibold",children:"Blocks"})}),e.jsx(d,{}),e.jsx(n,{children:e.jsx(i,{to:"/blocks/catalog",className:"text-xl font-semibold",children:"Catalog"})}),e.jsx(d,{}),e.jsx(n,{children:e.jsx(i,{to:"/blocks/catalog",className:"text-xl font-semibold",children:s.name})}),e.jsx(d,{}),e.jsx(n,{className:"text-xl font-semibold",children:e.jsx(v,{children:"Create"})})]})}),q=/^[a-zA-Z0-9-]+$/,K=A({blockName:Q().regex(q,{message:"Name must only contain lowercase letters, numbers, and dashes"})}),O={blockName:""},X=({blockSchema:s,blockType:o})=>{const l=B(),{values:a,setValues:b,errors:x,validateForm:j}=T(),{createBlockDocument:k,isPending:f}=_(),m=P({resolver:D(K),defaultValues:O}),g=async r=>{try{if(await j({schema:a}),x.length>0)return;k({block_schema_id:s.id,block_type_id:o.id,is_anonymous:!1,data:a,name:r.blockName},{onSuccess:t=>{u.success("Block created successfully"),l({to:"/blocks/block/$id",params:{id:t.id}})},onError:t=>{const c="Unknown error while creating block.";u.error(c),console.error(c,t)}})}catch(t){const c="Unknown error while validating block data.";u.error(c),console.error(c,t)}};return e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx($,{blockType:o}),e.jsxs(S,{className:" p-6 grid grid-cols-[minmax(0,_1fr)_250px] gap-4 ",children:[e.jsx(V,{...m,children:e.jsxs("form",{className:"flex flex-col gap-4",onSubmit:r=>{m.handleSubmit(g)(r)},children:[e.jsx(I,{control:m.control,name:"blockName",render:({field:r})=>e.jsxs(z,{children:[e.jsx(G,{children:"Name"}),e.jsx(H,{children:e.jsx(C,{...r,value:r.value})}),e.jsx(M,{})]})}),e.jsx(U,{values:a,onValuesChange:b,errors:x,kinds:["json"],schema:s.fields}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(p,{variant:"secondary",children:e.jsx(y,{to:"/blocks/catalog",children:"Cancel"})}),e.jsx(p,{loading:f,type:"submit",children:"Save"})]})]})}),e.jsx(R,{blockType:o})]})]})};function xe(){const{slug:s}=L.useParams(),{data:o}=h(w(s)),{data:l}=h(E({block_schemas:{block_type_id:{any_:[o.id]},operator:"and_"},offset:0})),a=l[0];if(!a)throw new Error("Block schema not found");return e.jsx(X,{blockSchema:a,blockType:o})}export{xe as component};
//# sourceMappingURL=catalog_._slug_.create-DBaeHi9Q.js.map
