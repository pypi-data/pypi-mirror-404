import{r as i,j as s,t as R,L as Ee,F as qe,n as it,E as ct}from"./vendor-tanstack-BcZfOOfy.js";import{ac as Xe,ad as ut,ae as dt,af as Re,ag as mt,ah as ft,ai as gt,aj as ht,ak as pt,al as xt,am as wt,an as Ae,ao as K,ap as J,aq as St,y as Q,U as Ke,q as Z,I as _,ar as vt,as as kt,at as yt,au as Ft,av as Ct,aw as jt,ax as Tt,a2 as Rt,a3 as bt,a4 as Dt,a5 as _t,a6 as Nt,p as Et,a7 as At,ay as ee,az as Mt,i as D,aA as Pt,aB as It,aC as Me,aD as Pe,C as Lt,o as zt,G as Ot,V as Ie,B as Ut,g as Vt,h as Ht,E as Bt,t as Wt,v as $t,w as Qt,x as Yt,D as Gt,aE as Je,aF as S,aG as qt,aH as Xt,aI as Le,aJ as ze,aK as Kt,aL as Oe,aM as Jt,aN as Zt,aO as es,aP as ts}from"./index-B8vo2Lrg.js";import{D as ss,W as as}from"./work-pool-filter-CSOATj2D.js";import{S as ns}from"./sort-filter-Cv8zAXMp.js";import{S as os,F as rs,a as ls}from"./flow-runs-pagination-SLbYtvaR.js";import{u as is,F as cs}from"./use-flow-runs-selected-rows-C-tehPRB.js";import{D as Ze}from"./delete-confirmation-dialog-CwDK_2QS.js";import{D as us,a as ds,b as ms,d as Y,e as fs}from"./dropdown-menu-D7Gwbd15.js";import{g as Ue,S as Ve}from"./state-colors-CAAf0Eg3.js";import{R as gs,S as hs,d as ps,X as xs,Y as ws,T as Ss,e as vs}from"./vendor-recharts-BvvJP9Po.js";import{T as ks,a as ys,b as Fs}from"./task-runs-pagination-DUy3147A.js";import{u as Cs}from"./use-delete-confirmation-dialog-CUdii6Lo.js";import{T as js}from"./tags-input-DHrnkwjQ.js";import{a as Ts}from"./zod-Cuos7J7w.js";import{c as Rs,o as et,s as T,e as G,n as q,b as bs}from"./vendor-forms-ClCIacbh.js";import{F as Ds,b as _s,c as Ns,d as Es,e as As,a as Ms}from"./form-mws4law8.js";import"./vendor-react-Bce9NwRC.js";import"./vendor-radix-BTiKGWfR.js";import"./vendor-date-wwuDAncJ.js";const Ps=({value:e,onValueChange:t,className:n})=>{const a=i.useMemo(()=>Xe(e),[e]),o=r=>{t(dt(r))};return s.jsx(ut,{value:a,onValueChange:o,placeholder:"All time",clearable:!0,className:n})},He=2,Is=({selectedFlows:e,onSelectFlows:t})=>{const[n,a]=i.useState(""),o=i.useDeferredValue(n),{data:r=[]}=R(Re({flows:o?{operator:"and_",name:{like_:o}}:void 0,limit:100,offset:0,sort:"NAME_ASC"})),{data:c=[]}=R(Re({flows:e.size>0?{operator:"and_",id:{any_:Array.from(e)}}:void 0,limit:e.size||1,offset:0,sort:"NAME_ASC"},{enabled:e.size>0})),l=m=>{const f=new Set(e);e.has(m)?f.delete(m):f.add(m),t(f)},u=()=>{t(new Set)},g=()=>{if(e.size===0)return"All flows";const m=c.filter(w=>e.has(w.id)).map(w=>w.name),f=m.slice(0,He),h=m.length-He;return s.jsxs("div",{className:"flex flex-1 min-w-0 items-center gap-2",children:[s.jsx("div",{className:"flex flex-1 min-w-0 items-center gap-2 overflow-hidden",children:s.jsx("span",{className:"truncate",children:f.join(", ")})}),h>0&&s.jsxs(J,{variant:"bodySmall",className:"shrink-0",children:["+ ",h]})]})},d=i.useMemo(()=>r.filter(m=>!o||m.name.toLowerCase().includes(o.toLowerCase())),[r,o]);return s.jsxs(mt,{children:[s.jsx(ft,{"aria-label":"Filter by flow",selected:e.size===0,children:g()}),s.jsxs(gt,{children:[s.jsx(ht,{value:n,onValueChange:a,placeholder:"Search flows..."}),s.jsxs(pt,{children:[s.jsx(xt,{children:"No flows found"}),s.jsxs(wt,{children:[s.jsxs(Ae,{"aria-label":"All flows",onSelect:u,closeOnSelect:!1,value:"__all__",children:[s.jsx(K,{checked:e.size===0}),"All flows"]}),d.map(m=>s.jsxs(Ae,{"aria-label":m.name,onSelect:()=>l(m.id),closeOnSelect:!1,value:m.id,children:[s.jsx(K,{checked:e.has(m.id)}),m.name]},m.id))]})]})]})]})},Ls=()=>{const[e,t]=Cs(),{mutateAsync:n}=St(),a=async(r,c=()=>{})=>{try{const l=await Promise.allSettled(r.map(d=>n({id:d}))),{numFails:u,numSuccess:g}=l.reduce((d,m)=>(m.status==="rejected"?d.numFails+=1:d.numSuccess+=1,d),{numFails:0,numSuccess:0});u>1?Q.error(`${u} task runs failed to delete`):u===1?Q.error("Task run failed to delete"):g>1?Q.success(`${g} task runs deleted`):Q.success("Task run deleted")}catch(l){console.error("Unknown error while deleting task run.",l)}finally{c()}};return[e,(r,c=()=>{})=>t({title:"Delete Task Runs",description:"Are you sure you want to delete selected task runs?",onConfirm:()=>{a(r,c)}})]},zs=({count:e=0,...t})=>"results"in t&&"setSelectedRows"in t&&"selectedRows"in t?s.jsx(Os,{count:e,...t}):s.jsxs(J,{variant:"bodySmall",className:"text-muted-foreground",children:[e," ",Ke(e,"Task run")]});function Os({count:e=0,results:t=[],setSelectedRows:n,selectedRows:a}){const[o,r]=Ls(),c=i.useMemo(()=>t.map(({id:g})=>g),[t]),l=Array.from(a),u=()=>{const g=c.every(f=>a.has(f)),d=c.some(f=>a.has(f));let m=!1;return g?m=!0:d&&(m="indeterminate"),s.jsx(K,{className:"block",checked:m,onCheckedChange:f=>{n(f?new Set(c):new Set)},"aria-label":"Toggle all"})};return a.size>0?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(u,{}),s.jsxs(J,{variant:"bodySmall",className:"text-muted-foreground",children:[l.length," selected"]}),s.jsx(Z,{"aria-label":"Delete rows",size:"icon",variant:"secondary",onClick:()=>{r(l,()=>n(new Set))},children:s.jsx(_,{id:"Trash2",className:"size-4"})})]}),s.jsx(Ze,{...o})]}):s.jsxs("div",{className:"flex items-center gap-2",children:[t&&n&&a&&s.jsx(K,{className:"block",checked:!1,onCheckedChange:g=>{n(new Set(g?c:void 0))},"aria-label":"Toggle all"}),s.jsxs(J,{variant:"bodySmall",className:"text-muted-foreground",children:[e," ",Ke(e,"Task run")]})]})}const Us=e=>{const[t,n]=i.useState(new Set(e)),a=u=>n(g=>new Set(g).add(u)),o=u=>n(g=>{const d=new Set(g);return d.delete(u),d});return[t,n,{addRow:a,removeRow:o,onSelectRow:(u,g)=>{g?a(u):o(u)},clearSet:()=>n(new Set)}]},tt="Custom",Vs="Unsaved";function Hs(e){return e?e.name===tt||e.name===Vs:!0}const Bs=({currentFilter:e,savedFilters:t,onSelect:n,onSave:a,onDelete:o,onSetDefault:r,onRemoveDefault:c,permissions:l={canSave:!0,canDelete:!0}})=>{const[u,g]=i.useState(!1),d=e?.name??tt,m=Hs(e),f=m&&l.canSave,h=e?.id&&l.canDelete,w=!m,v=()=>{e?.id&&(o(e.id),g(!1))},x=()=>{e?.id&&(e.isDefault?c(e.id):r(e.id))};return s.jsxs(s.Fragment,{children:[s.jsxs(us,{children:[s.jsx(ds,{asChild:!0,children:s.jsxs(Z,{variant:"outline",className:"gap-2",children:[s.jsx(_,{id:"SlidersVertical",className:"size-4"}),s.jsx("span",{children:d}),s.jsx(_,{id:"ChevronDown",className:"size-4"})]})}),s.jsxs(ms,{align:"start",className:"min-w-[200px]",children:[t.map(p=>s.jsxs(Y,{onClick:()=>n(p),className:"flex items-center justify-between",children:[s.jsx("span",{children:p.name}),p.isDefault&&s.jsx(_,{id:"CircleCheck",className:"size-4 text-green-500"})]},p.id??p.name)),(f||h||w)&&s.jsx(fs,{}),f&&s.jsxs(Y,{onClick:a,children:[s.jsx(_,{id:"Plus",className:"mr-2 size-4"}),"Save current filters"]}),h&&s.jsxs(Y,{variant:"destructive",onClick:()=>g(!0),children:[s.jsx(_,{id:"Trash2",className:"mr-2 size-4"}),"Delete"]}),w&&s.jsxs(Y,{onClick:x,children:[s.jsx(_,{id:"CircleCheck",className:"mr-2 size-4"}),e?.isDefault?"Remove as default":"Set as default"]})]})]}),s.jsx(Ze,{isOpen:u,title:"Delete saved filter",description:`Are you sure you want to delete "${e?.name}"? This action cannot be undone.`,onConfirm:v,onClose:()=>g(!1)})]})},Ws=e=>{if(e===0)return"0s";if(e<1)return`${e.toFixed(2)}s`;const t=31536e3,n=86400,a=3600,o=60,r=Math.floor(e/t);if(r>0)return`${r}y`;const c=Math.floor(e/n);if(c>0)return`${c}d`;const l=Math.floor(e/a);if(l>0)return`${l}h`;const u=Math.floor(e/o);return u>0?`${u}m`:`${Math.ceil(e)}s`},Be=[{ms:1e3,name:"second"},{ms:5*1e3,name:"5seconds"},{ms:15*1e3,name:"15seconds"},{ms:30*1e3,name:"30seconds"},{ms:60*1e3,name:"minute"},{ms:300*1e3,name:"5minutes"},{ms:900*1e3,name:"15minutes"},{ms:1800*1e3,name:"30minutes"},{ms:3600*1e3,name:"hour"},{ms:10800*1e3,name:"3hours"},{ms:360*60*1e3,name:"6hours"},{ms:720*60*1e3,name:"12hours"},{ms:1440*60*1e3,name:"day"},{ms:10080*60*1e3,name:"week"},{ms:720*60*60*1e3,name:"month"}],$s=(e,t,n)=>{const a=t-e;if(a<=0)return[e];const o=a/n;let r=Be[0].ms;for(const u of Be){if(u.ms>=o){r=u.ms;break}r=u.ms}const c=Math.ceil(e/r)*r,l=[];for(let u=c;u<=t;u+=r)l.push(u);return l.length===0&&l.push(e),l},Qs=()=>e=>{const t=new Date(e),n=new Date(t);if(n.setMilliseconds(0),n.getTime()<t.getTime())return`.${t.getMilliseconds().toString().padStart(3,"0").slice(0,3)}`;const a=new Date(t);if(a.setSeconds(0,0),a.getTime()<t.getTime())return`:${t.getSeconds().toString().padStart(2,"0")}`;const o=new Date(t);if(o.setMinutes(0,0,0),o.getTime()<t.getTime())return t.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"});const r=new Date(t);if(r.setHours(0,0,0,0),r.getTime()<t.getTime())return t.toLocaleTimeString(void 0,{hour:"numeric",hour12:!0});const c=new Date(t);if(c.setDate(1),c.setHours(0,0,0,0),c.getTime()<t.getTime())return t.toLocaleDateString(void 0,{weekday:"short",day:"numeric"});const l=new Date(t);return l.setMonth(0,1),l.setHours(0,0,0,0),l.getTime()<t.getTime()?t.toLocaleDateString(void 0,{month:"long"}):t.getFullYear().toString()},Ys=({cx:e,cy:t,payload:n})=>{if(e===void 0||t===void 0||!n)return null;const a=Ue(n.stateType,500)||Ve[n.stateType]||"#6b7280",o=Ue(n.stateType,600)||Ve[n.stateType]||"#6b7280";return s.jsx("circle",{cx:e,cy:t,r:8,fill:a,stroke:o,strokeWidth:1,opacity:.5,className:"hover:opacity-100 transition-opacity cursor-pointer"})},Gs=({active:e,payload:t})=>{const a=t?.[0]?.payload,o=a?.id,{data:r}=R({...vt(o??""),enabled:e&&!!o,staleTime:300*1e3}),{data:c}=R({...kt(r?.flow_id??""),enabled:!!r?.flow_id,staleTime:300*1e3});if(!e||!t||t.length===0||!a)return null;const l=new Date(a.timestamp);return s.jsxs("div",{className:"bg-background border rounded-lg p-3 shadow-lg flex flex-col gap-2 min-w-48",children:[s.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[r?.flow_id&&s.jsxs(s.Fragment,{children:[s.jsx(Ee,{to:"/flows/flow/$id",params:{id:r.flow_id},className:"font-semibold hover:underline truncate max-w-32",children:c?.name??"..."}),s.jsx(yt,{className:"size-3 flex-shrink-0"})]}),s.jsx(Ee,{to:"/runs/flow-run/$id",params:{id:a.id},className:"hover:underline truncate max-w-32",children:r?.name??a.id.slice(0,8)})]}),s.jsx("div",{children:s.jsx(Ft,{type:a.stateType})}),s.jsx("hr",{className:"border-border"}),s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsxs("span",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[s.jsx(jt,{className:"size-4"}),Ct(Math.ceil(a.duration*1e3),{largest:2,round:!0})]}),s.jsxs("span",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[s.jsx(Tt,{className:"size-4"}),l.toLocaleString()]})]})]})},qs=({history:e,startDate:t,endDate:n})=>{const a=i.useMemo(()=>e.map(l=>({x:new Date(l.timestamp).getTime(),y:l.duration,stateType:l.state_type,id:l.id,duration:l.duration,lateness:l.lateness,timestamp:l.timestamp})),[e]),o=i.useMemo(()=>{if(t&&n)return[t.getTime(),n.getTime()];if(a.length===0){const d=Date.now();return[d-1440*60*1e3,d]}const l=a.map(d=>d.x),u=Math.min(...l),g=Math.max(...l);return[u,g]},[t,n,a]),r=i.useMemo(()=>Qs(),[]),c=i.useMemo(()=>$s(o[0],o[1],10),[o]);return e.length===0?null:s.jsx("div",{className:"hidden md:block w-full h-72","data-testid":"scatter-plot",children:s.jsx(gs,{width:"100%",height:"100%",children:s.jsxs(hs,{children:[s.jsx(ps,{horizontal:!0,vertical:!1,stroke:"#cacccf",strokeDasharray:""}),s.jsx(xs,{type:"number",dataKey:"x",scale:"time",domain:o,ticks:c,tickFormatter:r,tick:{fontSize:12},tickLine:!1,axisLine:{stroke:"#e5e7eb"}}),s.jsx(ws,{type:"number",dataKey:"y",tickFormatter:Ws,tick:{fontSize:12},tickLine:!1,axisLine:{stroke:"#e5e7eb"},width:60}),s.jsx(Ss,{content:s.jsx(Gs,{}),cursor:{strokeDasharray:"3 3"},animationDuration:0}),s.jsx(vs,{data:a,shape:s.jsx(Ys,{}),isAnimationActive:!1})]})})})},Xs=et({name:T().min(1,{message:"Name is required"}).max(100,{message:"Name must be 100 characters or less"})}),Ks=({open:e,onOpenChange:t,onSave:n})=>{const a=Rs({resolver:Ts(Xs),defaultValues:{name:""}});i.useEffect(()=>{e&&a.reset({name:""})},[e,a]);const o=r=>{n(r.name),t(!1)};return s.jsx(Rt,{open:e,onOpenChange:t,children:s.jsxs(bt,{children:[s.jsx(Dt,{children:s.jsx(_t,{children:"Save Filter"})}),s.jsx(Nt,{children:"Save your current filter configuration for quick access later."}),s.jsx(Ds,{...a,children:s.jsxs("form",{onSubmit:r=>{a.handleSubmit(o)(r)},className:"space-y-4",children:[s.jsx(_s,{control:a.control,name:"name",render:({field:r})=>s.jsxs(Ns,{children:[s.jsx(Es,{children:"Filter Name"}),s.jsx(As,{children:s.jsx(Et,{autoComplete:"off",placeholder:"e.g., Failed runs this week",...r})}),s.jsx(Ms,{})]})}),s.jsxs(At,{children:[s.jsx(Z,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancel"}),s.jsx(Z,{type:"submit",children:"Save"})]})]})})]})})},Js="prefect-ui-v2-saved-filters",Zs="prefect-ui-v2-default-filter-id",st="system-past-week",at="system-hide-scheduled";function ea(e){return e===st||e===at}const nt=[{id:st,name:"Past week",filters:{range:"past-7-days"}},{id:at,name:"Hide scheduled runs",filters:{range:"past-7-days",state:[...Mt]}}],ta=nt[0];function sa(){return`${Date.now()}-${Math.random().toString(36).substring(2,9)}`}function aa(e,t){const n=(a,o)=>{if(a===void 0&&o===void 0)return!0;if(a===void 0||o===void 0||a.length!==o.length)return!1;const r=[...a].sort(),c=[...o].sort();return r.every((l,u)=>l===c[u])};return n(e.state,t.state)&&n(e.flows,t.flows)&&n(e.deployments,t.deployments)&&n(e.workPools,t.workPools)&&n(e.tags,t.tags)&&e.range===t.range&&e.start===t.start&&e.end===t.end}function ot(){const[e,t]=ee(Js,[]),[n,a]=ee(Zs,null),o=i.useMemo(()=>[...nt,...e],[e]),r=i.useCallback(f=>{const h={id:sa(),name:f.name,filters:f.filters};return t(w=>[...w,h]),h},[t]),c=i.useCallback(f=>{t(h=>h.filter(w=>w.id!==f)),a(h=>h===f?null:h)},[t,a]),l=i.useCallback((f,h)=>{t(w=>w.map(v=>v.id===f?{...v,...h.name!==void 0&&{name:h.name},...h.filters!==void 0&&{filters:h.filters}}:v))},[t]),u=i.useCallback(f=>{a(f)},[a]),g=i.useCallback(f=>o.find(h=>h.id===f),[o]),d=i.useCallback(f=>o.find(h=>aa(h.filters,f)),[o]),m=i.useMemo(()=>f=>n===f,[n]);return{savedFilters:o,defaultFilterId:n,saveFilter:r,deleteFilter:c,updateFilter:l,setDefaultFilter:u,getFilterById:g,findMatchingFilter:d,isDefaultFilter:m}}const na=({tab:e,onTabChange:t,flowRunsCount:n,taskRunsCount:a,hasAnyFlowRuns:o,hasAnyTaskRuns:r,flowRuns:c,flowRunsPages:l,pagination:u,onPaginationChange:g,onPrefetchPage:d,sort:m,onSortChange:f,hideSubflows:h,onHideSubflowsChange:w,flowRunSearch:v,onFlowRunSearchChange:x,selectedStates:p,onStateFilterChange:y,selectedFlows:E,onFlowFilterChange:A,selectedDeployments:F,onDeploymentFilterChange:N,selectedTags:M,onTagsFilterChange:b,selectedWorkPools:ae,onWorkPoolFilterChange:ne,dateRange:oe,onDateRangeChange:re,flowRunHistory:le,scatterPlotDateRange:U,taskRuns:V,taskRunsPages:ie,taskRunsPagination:ce,onTaskRunsPaginationChange:ue,onTaskRunsPrefetchPage:P,taskRunsSort:de,onTaskRunsSortChange:me,taskRunSearch:fe,onTaskRunSearchChange:ge,onClearTaskRunFilters:he,currentFilter:H,savedFilters:pe,onSelectFilter:xe,onSaveFilter:we,onDeleteFilter:Se,onSetDefault:ve,onRemoveDefault:ke,isSaveDialogOpen:I,onCloseSaveDialog:L,onConfirmSave:ye})=>{const z=!o&&!r,[B,Fe,{onSelectRow:Ce}]=is(),[W,je,{onSelectRow:k}]=Us(),j=[...new Set(c.map(C=>C.flow_id))],{data:$}=R(Re({flows:{operator:"and_",id:{any_:j}},offset:0,sort:"NAME_ASC"},{enabled:j.length>0})),O=c.map(C=>({...C,flow:$?.find(Te=>Te.id===C.flow_id)}));return z?s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsx(We,{}),s.jsx(oa,{})]}):s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(We,{}),s.jsx(Bs,{currentFilter:H,savedFilters:pe,onSelect:xe,onSave:we,onDelete:Se,onSetDefault:ve,onRemoveDefault:ke,permissions:{canSave:!0,canDelete:!ea(H?.id??null)}})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("div",{className:"flex flex-wrap gap-2 lg:grid lg:grid-flow-col lg:auto-cols-fr",children:[s.jsxs("div",{className:"flex flex-col gap-1 w-full lg:w-auto",children:[s.jsx(D,{className:"text-xs text-muted-foreground",children:"Date Range"}),s.jsx(Ps,{value:oe,onValueChange:re})]}),s.jsxs("div",{className:"flex flex-col gap-1 w-full lg:w-auto",children:[s.jsx(D,{className:"text-xs text-muted-foreground",children:"States"}),s.jsx(os,{selectedFilters:p,onSelectFilter:y})]})]}),s.jsxs("div",{className:"flex flex-wrap gap-2 lg:grid lg:grid-flow-col lg:auto-cols-fr",children:[s.jsxs("div",{className:"flex flex-col gap-1 w-full lg:w-auto",children:[s.jsx(D,{className:"text-xs text-muted-foreground",children:"Flows"}),s.jsx(Is,{selectedFlows:E,onSelectFlows:A})]}),s.jsxs("div",{className:"flex flex-col gap-1 w-full lg:w-auto",children:[s.jsx(D,{className:"text-xs text-muted-foreground",children:"Deployments"}),s.jsx(ss,{selectedDeployments:F,onSelectDeployments:N})]}),s.jsxs("div",{className:"flex flex-col gap-1 w-full lg:w-auto",children:[s.jsx(D,{className:"text-xs text-muted-foreground",children:"Work Pools"}),s.jsx(as,{selectedWorkPools:ae,onSelectWorkPools:ne})]}),s.jsxs("div",{className:"flex flex-col gap-1 w-full lg:w-auto",children:[s.jsx(D,{className:"text-xs text-muted-foreground",children:"Tags"}),s.jsx(js,{value:Array.from(M),onChange:C=>{const Te=Array.isArray(C)?C:[];b(new Set(Te))},placeholder:"All tags"})]})]})]}),s.jsx(Ks,{open:I,onOpenChange:L,onSave:ye}),s.jsxs(Pt,{value:e,onValueChange:t,children:[s.jsxs(It,{children:[s.jsx(Me,{value:"flow-runs",children:"Flow Runs"}),s.jsx(Me,{value:"task-runs",children:"Task Runs"})]}),s.jsx(Pe,{value:"flow-runs",children:s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsx(Lt,{children:s.jsx(zt,{children:s.jsx(qs,{history:le,startDate:U.startDate,endDate:U.endDate})})}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(cs,{count:n,results:O,selectedRows:B,setSelectedRows:Fe}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[s.jsx(Ot,{id:"hide-subflows",checked:h,onCheckedChange:w}),s.jsx(D,{htmlFor:"hide-subflows",children:"Hide subflows"})]}),s.jsx(Ie,{value:v,onChange:C=>x(C.target.value),placeholder:"Search by flow run name","aria-label":"Search by flow run name",className:"w-64",debounceMs:1200}),s.jsx(ns,{value:m,onSelect:f})]})]}),s.jsx(rs,{count:n,pages:l,pagination:u,onChangePagination:g,onPrefetchPage:d}),s.jsx(ls,{flowRuns:O,selectedRows:B,onSelect:Ce})]})}),s.jsx(Pe,{value:"task-runs",children:s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(zs,{count:a,results:V,selectedRows:W,setSelectedRows:je}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(Ie,{value:fe,onChange:C=>ge(C.target.value),placeholder:"Search by task run name","aria-label":"Search by task run name",className:"w-64",debounceMs:1200}),s.jsx(ks,{value:de,onSelect:me})]})]}),s.jsx(ys,{count:a,pages:ie,pagination:ce,onChangePagination:ue,onPrefetchPage:P}),s.jsx(Fs,{taskRuns:V,selectedRows:W,onSelect:k,onClearFilters:he})]})})]})]})},We=()=>s.jsx("div",{className:"flex items-center gap-2",children:s.jsx(Ut,{children:s.jsx(Vt,{children:s.jsx(Ht,{className:"text-xl font-semibold",children:"Runs"})})})}),oa=()=>s.jsxs(Bt,{children:[s.jsx(Wt,{id:"Workflow"}),s.jsx($t,{children:"Run a task or flow to get started"}),s.jsx(Qt,{children:"Runs store the state history for each execution of a task or flow."}),s.jsx(Yt,{children:s.jsx(Gt,{id:"getting-started"})})]}),te=qe("/runs/");function ra(e){const t=l=>l?l.split(",").filter(u=>u.trim().length>0):[],n=t(e.state),a=t(e.flows),o=t(e.deployments),r=t(e["work-pools"]),c=t(e.tags);return{...n.length>0&&{state:n},...a.length>0&&{flows:a},...o.length>0&&{deployments:o},...r.length>0&&{workPools:r},...c.length>0&&{tags:c},...e.range&&{range:e.range},...e.start&&{start:e.start},...e.end&&{end:e.end}}}function rt(e){return{state:e.state?.join(",")??"",flows:e.flows?.join(",")??"",deployments:e.deployments?.join(",")??"","work-pools":e.workPools?.join(",")??"",tags:e.tags?.join(",")??"",range:e.range,start:e.start,end:e.end}}function $e(e,t){return{id:e.id,name:e.name,isDefault:e.id===t}}function la(){const e=te.useSearch(),t=te.useNavigate(),{savedFilters:n,defaultFilterId:a,saveFilter:o,deleteFilter:r,setDefaultFilter:c,findMatchingFilter:l}=ot(),[u,g]=i.useState(!1),d=i.useMemo(()=>ra(e),[e]),m=i.useMemo(()=>l(d),[l,d]),f=i.useMemo(()=>n.map(F=>$e(F,a)),[n,a]),h=i.useMemo(()=>m?$e(m,a):d.state?.length||d.flows?.length||d.deployments?.length||d.workPools?.length||d.tags?.length||d.range||d.start||d.end?{id:null,name:"Unsaved",isDefault:!1}:{id:null,name:"Custom",isDefault:!1},[m,a,d]),w=i.useCallback(F=>{const N=n.find(b=>b.id===F.id);if(!N)return;const M=rt(N.filters);t({to:".",search:b=>({...b,...M,page:1}),replace:!0})},[t,n]),v=i.useCallback(()=>{g(!0)},[]),x=i.useCallback(F=>{o({name:F,filters:d}),g(!1)},[o,d]),p=i.useCallback(()=>{g(!1)},[]),y=i.useCallback(F=>{r(F)},[r]),E=i.useCallback(F=>{c(F)},[c]),A=i.useCallback(()=>{c(null)},[c]);return{currentFilter:h,savedFiltersForMenu:f,onSelectFilter:w,onSaveFilter:v,onDeleteFilter:y,onSetDefault:E,onRemoveDefault:A,isSaveDialogOpen:u,closeSaveDialog:p,confirmSave:x}}function ia(){const e=te.useNavigate(),t=te.useSearch(),{defaultFilterId:n,getFilterById:a}=ot(),o=i.useRef(!1),r=i.useMemo(()=>!!(t.state||t.flows||t.deployments||t["work-pools"]||t.tags||t.range||t.start||t.end),[t]);i.useEffect(()=>{if(o.current||r)return;let c;n&&(c=a(n)),c||(c=ta),o.current=!0;const l=rt(c.filters);e({to:".",search:u=>({...u,...l,page:1}),replace:!0})},[n,r,a,e])}const Qe=qe("/runs/"),ca=e=>e?e.split(",").filter(t=>Je.includes(t)):[],X=e=>e?e.split(",").filter(t=>t.trim().length>0):[];function ua(){const e=Qe.useSearch(),t=Qe.useNavigate(),n=i.useMemo(()=>new Set(ca(e.state??"")),[e.state]),a=i.useMemo(()=>new Set(X(e.flows??"")),[e.flows]),o=i.useMemo(()=>new Set(X(e.deployments??"")),[e.deployments]),r=i.useMemo(()=>new Set(X(e["work-pools"]??"")),[e["work-pools"]]),c=i.useMemo(()=>new Set(X(e.tags??"")),[e.tags]),l=i.useMemo(()=>({range:e.range,start:e.start,end:e.end}),[e.range,e.start,e.end]),u=i.useCallback(x=>{const p=Array.from(x);t({to:".",search:y=>({...y,state:p.length>0?p.join(","):"",page:1}),replace:!0})},[t]),g=i.useCallback(x=>{const p=Array.from(x);t({to:".",search:y=>({...y,flows:p.length>0?p.join(","):"",page:1}),replace:!0})},[t]),d=i.useCallback(x=>{const p=Array.from(x);t({to:".",search:y=>({...y,deployments:p.length>0?p.join(","):"",page:1}),replace:!0})},[t]),m=i.useCallback(x=>{const p=Array.from(x);t({to:".",search:y=>({...y,"work-pools":p.length>0?p.join(","):"",page:1}),replace:!0})},[t]),f=i.useCallback(x=>{const p=Array.from(x);t({to:".",search:y=>({...y,tags:p.length>0?p.join(","):"",page:1}),replace:!0})},[t]),h=i.useCallback(x=>{t({to:".",search:p=>({...p,range:x.range,start:x.start,end:x.end,page:1}),replace:!0})},[t]),w=i.useMemo(()=>n.size>0||a.size>0||o.size>0||r.size>0||c.size>0||l.range!==void 0||l.start!==void 0||l.end!==void 0,[n,a,o,r,c,l]),v=i.useCallback(()=>{t({to:".",search:x=>({...x,state:"",flows:"",deployments:"","work-pools":"",tags:"",range:void 0,start:void 0,end:void 0,page:1}),replace:!0})},[t]);return{states:n,flows:a,deployments:o,workPools:r,tags:c,dateRange:l,onStatesChange:u,onFlowsChange:g,onDeploymentsChange:d,onWorkPoolsChange:m,onTagsChange:f,onDateRangeChange:h,clearAllFilters:v,hasActiveFilters:w}}et({tab:G(["flow-runs","task-runs"]).optional().default("flow-runs"),page:q().int().positive().optional().default(1).catch(1),limit:q().int().positive().optional().catch(void 0),sort:G(ts).optional().default("START_TIME_DESC"),"hide-subflows":bs().optional().default(!1),"flow-run-search":T().optional().default(""),state:T().optional().default(""),flows:T().optional().default(""),deployments:T().optional().default(""),"work-pools":T().optional().default(""),tags:T().optional().default(""),range:G(es).optional(),start:T().optional(),end:T().optional(),"task-runs-page":q().int().positive().optional().default(1).catch(1),"task-runs-limit":q().int().positive().optional().catch(void 0),"task-runs-sort":G(Zt).optional().default("EXPECTED_START_TIME_DESC"),"task-run-search":T().optional().default("")});const be=e=>e?e.split(",").filter(t=>Je.includes(t)):[],se=e=>{if(!e)return;const t={range:e.range,start:e.start,end:e.end},n=Xe(t);if(!n)return;const a=Jt(n);if(a)return{after_:a.startDate.toISOString(),before_:a.endDate.toISOString()}},De=e=>e?e.split(",").filter(t=>t.trim().length>0):[],_e=e=>e?e.split(",").filter(t=>t.trim().length>0):[],lt=e=>e?e.split(",").filter(t=>t.trim().length>0):[],Ne=e=>e?e.split(",").filter(t=>t.trim().length>0):[],Ye=e=>{const t=e?.["hide-subflows"],n=e?.["flow-run-search"],a=be(e?.state??""),o=De(e?.flows??""),r=_e(e?.deployments??""),c=lt(e?.["work-pools"]??""),l=Ne(e?.tags??""),u=se(e),g=a.length>0?a:void 0,d=o.length>0?o:void 0,m=r.length>0?r:void 0,f=c.length>0?c:void 0,w=t||n||g||d||m||l.length>0||u?{operator:"and_",...t&&{parent_task_run_id:{operator:"and_",is_null_:!0}},...n&&{name:{like_:n}},...g&&{state:{operator:"and_",name:{any_:g}}},...l.length>0&&{tags:{operator:"and_",any_:l}},...u&&{expected_start_time:u}}:void 0,v=d?{operator:"and_",id:{any_:d}}:void 0,x=m?{operator:"and_",id:{any_:m}}:void 0,p=f?{operator:"and_",name:{any_:f}}:void 0;return{page:e?.page??1,limit:e?.limit??100,sort:e?.sort??"START_TIME_DESC",flow_runs:w,flows:v,deployments:x,work_pools:p}},Ge=e=>{const t=e?.["task-run-search"],n=be(e?.state??""),a=De(e?.flows??""),o=_e(e?.deployments??""),r=Ne(e?.tags??""),c=se(e),l=t?{operator:"and_",name:{like_:t}}:void 0,u=n.length>0?n:void 0,d=u||r.length>0||c?{operator:"and_",...u&&{state:{operator:"and_",name:{any_:u}}},...r.length>0&&{tags:{operator:"and_",any_:r}},...c&&{expected_start_time:c}}:void 0,m=a.length>0?a:void 0,f=m?{operator:"and_",id:{any_:m}}:void 0,h=o.length>0?o:void 0,w=h?{operator:"and_",id:{any_:h}}:void 0;return{page:e?.["task-runs-page"]??1,limit:e?.["task-runs-limit"]??100,sort:e?.["task-runs-sort"]??"EXPECTED_START_TIME_DESC",task_runs:l,flow_runs:d,flows:f,deployments:w}},da=e=>{const t=e?.["hide-subflows"],n=be(e?.state??""),a=De(e?.flows??""),o=_e(e?.deployments??""),r=lt(e?.["work-pools"]??""),c=Ne(e?.tags??""),l=se(e),u=n.length>0?n:void 0,g=a.length>0?a:void 0,d=o.length>0?o:void 0,m=r.length>0?r:void 0;return{sort:"EXPECTED_START_TIME_DESC",limit:1e3,offset:0,flow_runs:t||u||c.length>0||l?{operator:"and_",...t&&{parent_task_run_id:{operator:"and_",is_null_:!0}},...u&&{state:{operator:"and_",name:{any_:u}}},...c.length>0&&{tags:{operator:"and_",any_:c}},...l&&{expected_start_time:l}}:void 0,flows:g?{operator:"and_",id:{any_:g}}:void 0,deployments:d?{operator:"and_",id:{any_:d}}:void 0,work_pools:m?{operator:"and_",name:{any_:m}}:void 0}},ma=()=>{const e=S.useSearch(),t=S.useNavigate(),n=i.useMemo(()=>({page:e.page??1,limit:e.limit??100}),[e.page,e.limit]),a=i.useCallback(o=>{t({to:".",search:r=>({...r,page:o.page,limit:o.limit}),replace:!0})},[t]);return[n,a]},fa=()=>{const e=S.useSearch(),t=S.useNavigate(),n=i.useCallback(a=>{t({to:".",search:o=>({...o,sort:a,page:1}),replace:!0})},[t]);return[e.sort,n]},ga=()=>{const e=S.useSearch(),t=S.useNavigate(),n=i.useCallback(a=>{t({to:".",search:o=>({...o,"hide-subflows":a,page:1}),replace:!0})},[t]);return[e["hide-subflows"],n]},ha=()=>{const e=S.useSearch(),t=S.useNavigate(),n=i.useCallback(a=>{t({to:".",search:o=>({...o,tab:a,page:1}),replace:!0})},[t]);return[e.tab,n]},pa=()=>{const e=S.useSearch(),t=S.useNavigate(),n=i.useCallback(a=>{t({to:".",search:o=>({...o,"flow-run-search":a,page:1}),replace:!0})},[t]);return[e["flow-run-search"],n]},xa=()=>{const e=S.useSearch(),t=S.useNavigate(),n=i.useMemo(()=>({page:e["task-runs-page"]??1,limit:e["task-runs-limit"]??100}),[e["task-runs-page"],e["task-runs-limit"]]),a=i.useCallback(o=>{t({to:".",search:r=>({...r,"task-runs-page":o.page,"task-runs-limit":o.limit}),replace:!0})},[t]);return[n,a]},wa=()=>{const e=S.useSearch(),t=S.useNavigate(),n=i.useCallback(a=>{t({to:".",search:o=>({...o,"task-runs-sort":a,"task-runs-page":1}),replace:!0})},[t]);return[e["task-runs-sort"],n]},Sa=()=>{const e=S.useSearch(),t=S.useNavigate(),n=i.useCallback(a=>{t({to:".",search:o=>({...o,"task-run-search":a,"task-runs-page":1}),replace:!0})},[t]);return[e["task-run-search"],n]};function Oa(){const e=it(),t=S.useSearch(),n=S.useNavigate(),[a,o]=ee("workspace-flow-runs-list-limit",100),[r,c]=ee("workspace-task-runs-list-limit",100),l=i.useRef(!1);i.useEffect(()=>{if(l.current)return;l.current=!0;const k=t.limit===void 0,j=t["task-runs-limit"]===void 0;(k||j)&&n({to:".",search:$=>({...$,...k&&{limit:a},...j&&{"task-runs-limit":r}}),replace:!0})},[n,t.limit,t["task-runs-limit"],a,r]),i.useEffect(()=>{t.limit!==void 0&&t.limit!==a&&o(t.limit)},[t.limit,a,o]),i.useEffect(()=>{t["task-runs-limit"]!==void 0&&t["task-runs-limit"]!==r&&c(t["task-runs-limit"])},[t["task-runs-limit"],r,c]);const[u,g]=ma(),[d,m]=fa(),[f,h]=ga(),[w,v]=ha(),[x,p]=pa(),{states:y,flows:E,deployments:A,workPools:F,tags:N,dateRange:M,onStatesChange:b,onFlowsChange:ae,onDeploymentsChange:ne,onWorkPoolsChange:oe,onTagsChange:re,onDateRangeChange:le}=ua(),[U,V]=xa(),[ie,ce]=wa(),[ue,P]=Sa(),{currentFilter:de,savedFiltersForMenu:me,onSelectFilter:fe,onSaveFilter:ge,onDeleteFilter:he,onSetDefault:H,onRemoveDefault:pe,isSaveDialogOpen:xe,closeSaveDialog:we,confirmSave:Se}=la();ia();const[{data:ve},{data:ke}]=ct({queries:[qt(),Xt()]}),{data:I}=R(Le(Ye(t),3e4)),{data:L}=R(ze(Ge(t),3e4)),{data:ye}=R(Kt(da(t),3e4)),z=I?.results??[],B=L?.results??[],Fe=i.useMemo(()=>{const k=se(t);return{startDate:k?.after_?new Date(k.after_):void 0,endDate:k?.before_?new Date(k.before_):void 0}},[t]);i.useEffect(()=>{const k=z.map(j=>j.id);k.length>0&&e.prefetchQuery(Oe(k))},[e,z]);const Ce=i.useCallback(k=>{const j=Ye({...t,page:k});(async()=>{const O=(await e.ensureQueryData(Le(j,3e4)))?.results?.map(C=>C.id)??[];O.length>0&&e.prefetchQuery(Oe(O))})()},[e,t]),W=i.useCallback(k=>{const j=Ge({...t,"task-runs-page":k});e.prefetchQuery(ze(j,3e4))},[e,t]),je=i.useCallback(()=>{P("")},[P]);return s.jsx(na,{tab:w,onTabChange:v,flowRunsCount:I?.count??0,taskRunsCount:L?.count??0,hasAnyFlowRuns:(ve??0)>0,hasAnyTaskRuns:(ke??0)>0,flowRuns:z,flowRunsPages:I?.pages??0,pagination:u,onPaginationChange:g,onPrefetchPage:Ce,sort:d,onSortChange:m,hideSubflows:f,onHideSubflowsChange:h,flowRunSearch:x,onFlowRunSearchChange:p,selectedStates:y,onStateFilterChange:b,selectedFlows:E,onFlowFilterChange:ae,selectedDeployments:A,onDeploymentFilterChange:ne,selectedTags:N,onTagsFilterChange:re,selectedWorkPools:F,onWorkPoolFilterChange:oe,dateRange:M,onDateRangeChange:le,flowRunHistory:ye??[],scatterPlotDateRange:Fe,taskRuns:B,taskRunsPages:L?.pages??0,taskRunsPagination:U,onTaskRunsPaginationChange:V,onTaskRunsPrefetchPage:W,taskRunsSort:ie,onTaskRunsSortChange:ce,taskRunSearch:ue,onTaskRunSearchChange:P,onClearTaskRunFilters:je,currentFilter:de,savedFilters:me,onSelectFilter:fe,onSaveFilter:ge,onDeleteFilter:he,onSetDefault:H,onRemoveDefault:pe,isSaveDialogOpen:xe,onCloseSaveDialog:we,onConfirmSave:Se})}export{Oa as component};
//# sourceMappingURL=index-BpKoubXu.js.map
