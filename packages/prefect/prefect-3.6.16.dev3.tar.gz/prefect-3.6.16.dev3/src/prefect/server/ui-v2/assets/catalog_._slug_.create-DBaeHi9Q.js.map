{"version":3,"file":"catalog_._slug_.create-DBaeHi9Q.js","sources":["../../src/components/blocks/block-document-create-page/block-document-create-page-header.tsx","../../src/components/blocks/block-document-create-page/block-document-create-page.tsx","../../src/routes/blocks/catalog_.$slug_.create.tsx?tsr-split=component"],"sourcesContent":["import type { BlockType } from \"@/api/block-types\";\nimport {\n\tBreadcrumb,\n\tBreadcrumbItem,\n\tBreadcrumbLink,\n\tBreadcrumbList,\n\tBreadcrumbPage,\n\tBreadcrumbSeparator,\n} from \"@/components/ui/breadcrumb\";\n\ntype BlockDocumentCreatePageHeaderProps = {\n\tblockType: BlockType;\n};\n\nexport const BlockDocumentCreatePageHeader = ({\n\tblockType,\n}: BlockDocumentCreatePageHeaderProps) => {\n\treturn (\n\t\t<Breadcrumb>\n\t\t\t<BreadcrumbList>\n\t\t\t\t<BreadcrumbItem>\n\t\t\t\t\t<BreadcrumbLink to=\"/blocks\" className=\"text-xl font-semibold\">\n\t\t\t\t\t\tBlocks\n\t\t\t\t\t</BreadcrumbLink>\n\t\t\t\t</BreadcrumbItem>\n\t\t\t\t<BreadcrumbSeparator />\n\n\t\t\t\t<BreadcrumbItem>\n\t\t\t\t\t<BreadcrumbLink\n\t\t\t\t\t\tto=\"/blocks/catalog\"\n\t\t\t\t\t\tclassName=\"text-xl font-semibold\"\n\t\t\t\t\t>\n\t\t\t\t\t\tCatalog\n\t\t\t\t\t</BreadcrumbLink>\n\t\t\t\t</BreadcrumbItem>\n\t\t\t\t<BreadcrumbSeparator />\n\n\t\t\t\t<BreadcrumbItem>\n\t\t\t\t\t<BreadcrumbLink\n\t\t\t\t\t\tto=\"/blocks/catalog\"\n\t\t\t\t\t\tclassName=\"text-xl font-semibold\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{blockType.name}\n\t\t\t\t\t</BreadcrumbLink>\n\t\t\t\t</BreadcrumbItem>\n\t\t\t\t<BreadcrumbSeparator />\n\n\t\t\t\t<BreadcrumbItem className=\"text-xl font-semibold\">\n\t\t\t\t\t<BreadcrumbPage>Create</BreadcrumbPage>\n\t\t\t\t</BreadcrumbItem>\n\t\t\t</BreadcrumbList>\n\t\t</Breadcrumb>\n\t);\n};\n","import { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Link, useNavigate } from \"@tanstack/react-router\";\nimport { useForm } from \"react-hook-form\";\nimport { toast } from \"sonner\";\nimport { z } from \"zod\";\nimport { useCreateBlockDocument } from \"@/api/block-documents\";\nimport type { BlockSchema } from \"@/api/block-schemas\";\nimport type { BlockType } from \"@/api/block-types\";\nimport { BlockTypeDetails } from \"@/components/blocks/block-type-details\";\nimport {\n\tLazySchemaForm,\n\ttype PrefectSchemaObject,\n\tuseSchemaForm,\n} from \"@/components/schemas\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport {\n\tForm,\n\tFormControl,\n\tFormField,\n\tFormItem,\n\tFormLabel,\n\tFormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { BlockDocumentCreatePageHeader } from \"./block-document-create-page-header\";\n\ntype BlockDocumentCreatePageProps = {\n\tblockSchema: BlockSchema;\n\tblockType: BlockType;\n};\n\n// Letters, numbers, and dashes only\nconst BLOCK_NAME_REGEX = /^[a-zA-Z0-9-]+$/;\n\nconst BlockNameFormSchema = z.object({\n\tblockName: z.string().regex(BLOCK_NAME_REGEX, {\n\t\tmessage: \"Name must only contain lowercase letters, numbers, and dashes\",\n\t}),\n});\n\nexport type BlockNameFormSchema = z.infer<typeof BlockNameFormSchema>;\nconst DEFAULT_VALUES: BlockNameFormSchema = {\n\tblockName: \"\",\n};\n\nexport const BlockDocumentCreatePage = ({\n\tblockSchema,\n\tblockType,\n}: BlockDocumentCreatePageProps) => {\n\tconst navigate = useNavigate();\n\tconst { values, setValues, errors, validateForm } = useSchemaForm();\n\tconst { createBlockDocument, isPending } = useCreateBlockDocument();\n\n\tconst form = useForm({\n\t\tresolver: zodResolver(BlockNameFormSchema),\n\t\tdefaultValues: DEFAULT_VALUES,\n\t});\n\n\tconst onSave = async (zodFormValues: BlockNameFormSchema) => {\n\t\ttry {\n\t\t\tawait validateForm({ schema: values });\n\t\t\t// Early exit if there's errors from block schema validation\n\t\t\tif (errors.length > 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcreateBlockDocument(\n\t\t\t\t{\n\t\t\t\t\tblock_schema_id: blockSchema.id,\n\t\t\t\t\tblock_type_id: blockType.id,\n\t\t\t\t\tis_anonymous: false,\n\t\t\t\t\tdata: values,\n\t\t\t\t\tname: zodFormValues.blockName,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tonSuccess: (res) => {\n\t\t\t\t\t\ttoast.success(\"Block created successfully\");\n\t\t\t\t\t\tvoid navigate({\n\t\t\t\t\t\t\tto: \"/blocks/block/$id\",\n\t\t\t\t\t\t\tparams: { id: res.id },\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tonError: (err) => {\n\t\t\t\t\t\tconst message = \"Unknown error while creating block.\";\n\t\t\t\t\t\ttoast.error(message);\n\t\t\t\t\t\tconsole.error(message, err);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\t\t} catch (err) {\n\t\t\tconst message = \"Unknown error while validating block data.\";\n\t\t\ttoast.error(message);\n\t\t\tconsole.error(message, err);\n\t\t}\n\t};\n\n\treturn (\n\t\t<div className=\"flex flex-col gap-6\">\n\t\t\t<BlockDocumentCreatePageHeader blockType={blockType} />\n\t\t\t<Card className=\" p-6 grid grid-cols-[minmax(0,_1fr)_250px] gap-4 \">\n\t\t\t\t<Form {...form}>\n\t\t\t\t\t<form\n\t\t\t\t\t\tclassName=\"flex flex-col gap-4\"\n\t\t\t\t\t\tonSubmit={(e) => void form.handleSubmit(onSave)(e)}\n\t\t\t\t\t>\n\t\t\t\t\t\t<FormField\n\t\t\t\t\t\t\tcontrol={form.control}\n\t\t\t\t\t\t\tname=\"blockName\"\n\t\t\t\t\t\t\trender={({ field }) => (\n\t\t\t\t\t\t\t\t<FormItem>\n\t\t\t\t\t\t\t\t\t<FormLabel>Name</FormLabel>\n\t\t\t\t\t\t\t\t\t<FormControl>\n\t\t\t\t\t\t\t\t\t\t<Input {...field} value={field.value} />\n\t\t\t\t\t\t\t\t\t</FormControl>\n\t\t\t\t\t\t\t\t\t<FormMessage />\n\t\t\t\t\t\t\t\t</FormItem>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<LazySchemaForm\n\t\t\t\t\t\t\tvalues={values}\n\t\t\t\t\t\t\tonValuesChange={setValues}\n\t\t\t\t\t\t\terrors={errors}\n\t\t\t\t\t\t\tkinds={[\"json\"]}\n\t\t\t\t\t\t\tschema={blockSchema.fields as unknown as PrefectSchemaObject}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div className=\"flex gap-3 justify-end\">\n\t\t\t\t\t\t\t<Button variant=\"secondary\">\n\t\t\t\t\t\t\t\t<Link to=\"/blocks/catalog\">Cancel</Link>\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<Button loading={isPending} type=\"submit\">\n\t\t\t\t\t\t\t\tSave\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</form>\n\t\t\t\t</Form>\n\t\t\t\t<BlockTypeDetails blockType={blockType} />\n\t\t\t</Card>\n\t\t</div>\n\t);\n};\n","import { useSuspenseQuery } from \"@tanstack/react-query\";\nimport { createFileRoute } from \"@tanstack/react-router\";\nimport { buildListFilterBlockSchemasQuery } from \"@/api/block-schemas\";\nimport { buildGetBlockTypeQuery } from \"@/api/block-types\";\nimport { BlockDocumentCreatePage } from \"@/components/blocks/block-document-create-page\";\n\nexport const Route = createFileRoute(\"/blocks/catalog_/$slug_/create\")({\n\tcomponent: RouteComponent,\n\tloader: async ({ params, context: { queryClient } }) => {\n\t\t// critical data\n\t\tconst res = await queryClient.ensureQueryData(\n\t\t\tbuildGetBlockTypeQuery(params.slug),\n\t\t);\n\t\tvoid queryClient.ensureQueryData(\n\t\t\tbuildListFilterBlockSchemasQuery({\n\t\t\t\tblock_schemas: {\n\t\t\t\t\tblock_type_id: { any_: [res.id] },\n\t\t\t\t\toperator: \"and_\",\n\t\t\t\t},\n\t\t\t\toffset: 0,\n\t\t\t}),\n\t\t);\n\t},\n\twrapInSuspense: true,\n});\n\nfunction RouteComponent() {\n\tconst { slug } = Route.useParams();\n\tconst { data: blockType } = useSuspenseQuery(buildGetBlockTypeQuery(slug));\n\tconst { data: blockSchemas } = useSuspenseQuery(\n\t\tbuildListFilterBlockSchemasQuery({\n\t\t\tblock_schemas: {\n\t\t\t\tblock_type_id: { any_: [blockType.id] },\n\t\t\t\toperator: \"and_\",\n\t\t\t},\n\t\t\toffset: 0,\n\t\t}),\n\t);\n\tconst blockSchema = blockSchemas[0];\n\tif (!blockSchema) {\n\t\tthrow new Error(\"Block schema not found\");\n\t}\n\n\treturn (\n\t\t<BlockDocumentCreatePage blockSchema={blockSchema} blockType={blockType} />\n\t);\n}\n"],"names":["BlockDocumentCreatePageHeader","blockType","jsx","Breadcrumb","jsxs","BreadcrumbList","BreadcrumbItem","BreadcrumbLink","BreadcrumbSeparator","BreadcrumbPage","BLOCK_NAME_REGEX","BlockNameFormSchema","z.object","z.string","DEFAULT_VALUES","BlockDocumentCreatePage","blockSchema","navigate","useNavigate","values","setValues","errors","validateForm","useSchemaForm","createBlockDocument","isPending","useCreateBlockDocument","form","useForm","zodResolver","onSave","zodFormValues","res","toast","err","message","Card","Form","e","FormField","field","FormItem","FormLabel","FormControl","Input","FormMessage","LazySchemaForm","Button","Link","BlockTypeDetails","RouteComponent","slug","Route","useParams","data","useSuspenseQuery","buildGetBlockTypeQuery","blockSchemas","buildListFilterBlockSchemasQuery","block_schemas","block_type_id","any_","id","operator","offset","Error"],"mappings":"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"}