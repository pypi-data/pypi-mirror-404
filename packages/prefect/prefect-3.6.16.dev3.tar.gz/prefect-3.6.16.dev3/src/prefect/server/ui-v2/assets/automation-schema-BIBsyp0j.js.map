{"version":3,"file":"automation-schema-BIBsyp0j.js","sources":["../../src/components/automations/automations-wizard/automation-schema.ts"],"sourcesContent":["import { z } from \"zod\";\nexport const UNASSIGNED = \"UNASSIGNED\";\n\n//----- Actions\nconst DoNothingSchema = z.object({ type: z.literal(\"do-nothing\") });\n\nconst FlowRunSchema = z.object({\n\ttype: z.enum([\"cancel-flow-run\", \"suspend-flow-run\", \"resume-flow-run\"]),\n});\n\nconst ChangeFlowRunStateSchema = z\n\t.object({\n\t\ttype: z.literal(\"change-flow-run-state\"),\n\t\tstate: z.enum([\n\t\t\t\"COMPLETED\",\n\t\t\t\"RUNNING\",\n\t\t\t\"SCHEDULED\",\n\t\t\t\"PENDING\",\n\t\t\t\"FAILED\",\n\t\t\t\"CANCELLED\",\n\t\t\t\"CANCELLING\",\n\t\t\t\"CRASHED\",\n\t\t\t\"PAUSED\",\n\t\t]),\n\t\tname: z.string().optional(),\n\t\tmessage: z.string().optional(),\n\t\tforce: z.boolean().optional(),\n\t})\n\t.transform((schema) => ({\n\t\t...schema,\n\t\tforce: schema.force ?? false,\n\t}));\n\nconst RunDeploymentsSchema = z\n\t.object({\n\t\ttype: z.literal(\"run-deployment\"),\n\t\tdeployment_id: z.string().or(z.literal(UNASSIGNED)),\n\t\tjob_variables: z.record(z.unknown()).optional(),\n\t\tparameters: z.record(z.unknown()).optional(),\n\t})\n\t.transform((schema) => ({\n\t\t...schema,\n\t\t...(schema.deployment_id === UNASSIGNED\n\t\t\t? ({ source: \"inferred\", deployment_id: null } as const)\n\t\t\t: ({ source: \"selected\", deployment_id: schema.deployment_id } as const)),\n\t}));\n\nconst DeploymentsSchema = z\n\t.object({\n\t\ttype: z.enum([\"pause-deployment\", \"resume-deployment\"]),\n\t\t/** nb: Because shadcn MUST have a non empty string as a value, use UNASSIGNED to indicate that this will turn to a null value */\n\t\tdeployment_id: z.string().or(z.literal(UNASSIGNED)),\n\t})\n\t.transform((schema) => ({\n\t\ttype: schema.type,\n\t\t...(schema.deployment_id === UNASSIGNED\n\t\t\t? ({ source: \"inferred\", deployment_id: null } as const)\n\t\t\t: ({ source: \"selected\", deployment_id: schema.deployment_id } as const)),\n\t}));\n\nconst WorkQueueSchema = z\n\t.object({\n\t\ttype: z.enum([\"pause-work-queue\", \"resume-work-queue\"]),\n\t\t/** nb: Because shadcn MUST have a non empty string as a value, use UNASSIGNED to indicate that this will turn to a null value */\n\t\twork_queue_id: z.string().or(z.literal(UNASSIGNED)),\n\t})\n\t.transform((schema) => ({\n\t\ttype: schema.type,\n\t\t...(schema.work_queue_id === UNASSIGNED\n\t\t\t? ({ source: \"inferred\", work_queue_id: null } as const)\n\t\t\t: ({ source: \"selected\", work_queue_id: schema.work_queue_id } as const)),\n\t}));\n\nconst WorkPoolSchema = z\n\t.object({\n\t\ttype: z.enum([\"pause-work-pool\", \"resume-work-pool\"]),\n\t\t/** nb: Because shadcn MUST have a non empty string as a value, use UNASSIGNED to indicate that this will turn to a null value */\n\t\twork_pool_id: z.string().or(z.literal(UNASSIGNED)),\n\t})\n\t.transform((schema) => ({\n\t\ttype: schema.type,\n\t\t...(schema.work_pool_id === UNASSIGNED\n\t\t\t? ({ source: \"inferred\", work_pool_id: null } as const)\n\t\t\t: ({ source: \"selected\", work_pool_id: schema.work_pool_id } as const)),\n\t}));\n\nconst AutomationSchema = z\n\t.object({\n\t\ttype: z.enum([\"pause-automation\", \"resume-automation\"]),\n\t\t/** nb: Because shadcn MUST have a non empty string as a value, use UNASSIGNED to indicate that this will turn to a null value */\n\t\tautomation_id: z.string().or(z.literal(UNASSIGNED)),\n\t})\n\t.transform((schema) => ({\n\t\ttype: schema.type,\n\t\t...(schema.automation_id === UNASSIGNED\n\t\t\t? ({ source: \"inferred\", automation_id: null } as const)\n\t\t\t: ({ source: \"selected\", automation_id: schema.automation_id } as const)),\n\t}));\n\nconst SendNotificationSchema = z.object({\n\ttype: z.literal(\"send-notification\"),\n\tblock_document_id: z.string(),\n\tbody: z.string(),\n\tsubject: z.string(),\n});\n\nconst CallWebhookSchema = z.object({\n\ttype: z.literal(\"call-webhook\"),\n\tblock_document_id: z.string(),\n\tpayload: z.string(),\n});\n\n//----- Triggers\n\n// Trigger template type (for UI selection)\nexport const TriggerTemplateSchema = z.enum([\n\t\"deployment-status\",\n\t\"flow-run-state\",\n\t\"work-pool-status\",\n\t\"work-queue-status\",\n\t\"custom\",\n]);\nexport type TriggerTemplate = z.infer<typeof TriggerTemplateSchema>;\n\n// Trigger posture\nconst TriggerPostureSchema = z.enum([\"Reactive\", \"Proactive\"]);\nexport type TriggerPosture = z.infer<typeof TriggerPostureSchema>;\n\n// Event trigger schema (the primary trigger type for form mode)\n// Resource specification schema (for match conditions)\nconst ResourceSpecificationSchema = z.record(\n\tz.union([z.string(), z.array(z.string())]),\n);\n\nexport const EventTriggerSchema = z.object({\n\ttype: z.literal(\"event\"),\n\tposture: TriggerPostureSchema,\n\tthreshold: z.number().min(1).default(1),\n\twithin: z.number().min(0).default(0),\n\t// Match conditions\n\tmatch: ResourceSpecificationSchema.optional(),\n\tmatch_related: ResourceSpecificationSchema.optional(),\n\tfor_each: z.array(z.string()).optional(),\n\tafter: z.array(z.string()).optional(),\n\texpect: z.array(z.string()).optional(),\n});\nexport type EventTrigger = z.output<typeof EventTriggerSchema>;\nexport type EventTriggerInput = z.input<typeof EventTriggerSchema>;\n\n// Output types (after parsing - all defaults are applied, fields are required)\nexport type CompoundTrigger = {\n\ttype: \"compound\";\n\ttriggers: Trigger[];\n\trequire: number | \"any\" | \"all\";\n\twithin: number;\n};\n\nexport type SequenceTrigger = {\n\ttype: \"sequence\";\n\ttriggers: Trigger[];\n\twithin: number;\n};\n\nexport type Trigger = EventTrigger | CompoundTrigger | SequenceTrigger;\n\n// Input types (before parsing - defaulted fields are optional)\nexport type CompoundTriggerInput = {\n\ttype: \"compound\";\n\ttriggers: TriggerInput[];\n\trequire?: number | \"any\" | \"all\";\n\twithin?: number;\n};\n\nexport type SequenceTriggerInput = {\n\ttype: \"sequence\";\n\ttriggers: TriggerInput[];\n\twithin?: number;\n};\n\nexport type TriggerInput =\n\t| EventTriggerInput\n\t| CompoundTriggerInput\n\t| SequenceTriggerInput;\n\n// Recursive trigger schemas with explicit type annotations\n// Using z.ZodType<Output, z.ZodTypeDef, Input> to handle input/output type differences from defaults\n\nexport const TriggerSchema: z.ZodType<Trigger, z.ZodTypeDef, TriggerInput> =\n\tz.lazy(() =>\n\t\tz.union([EventTriggerSchema, CompoundTriggerSchema, SequenceTriggerSchema]),\n\t);\n\nexport const CompoundTriggerSchema: z.ZodType<\n\tCompoundTrigger,\n\tz.ZodTypeDef,\n\tCompoundTriggerInput\n> = z.lazy(() =>\n\tz.object({\n\t\ttype: z.literal(\"compound\"),\n\t\ttriggers: z.array(TriggerSchema),\n\t\trequire: z\n\t\t\t.union([z.number().min(1), z.literal(\"any\"), z.literal(\"all\")])\n\t\t\t.default(\"all\"),\n\t\twithin: z.number().min(0).default(0),\n\t}),\n);\n\nexport const SequenceTriggerSchema: z.ZodType<\n\tSequenceTrigger,\n\tz.ZodTypeDef,\n\tSequenceTriggerInput\n> = z.lazy(() =>\n\tz.object({\n\t\ttype: z.literal(\"sequence\"),\n\t\ttriggers: z.array(TriggerSchema),\n\t\twithin: z.number().min(0).default(0),\n\t}),\n);\n\nexport const AutomationWizardSchema = z.object({\n\tname: z.string().min(1, \"Name is required\"),\n\tdescription: z.string().optional(),\n\ttriggerTemplate: TriggerTemplateSchema.optional(),\n\ttrigger: TriggerSchema,\n\tactions: z.array(\n\t\tz.union([\n\t\t\tDoNothingSchema,\n\t\t\tChangeFlowRunStateSchema,\n\t\t\tDeploymentsSchema,\n\t\t\tRunDeploymentsSchema,\n\t\t\tWorkPoolSchema,\n\t\t\tWorkQueueSchema,\n\t\t\tAutomationSchema,\n\t\t\tSendNotificationSchema,\n\t\t\tCallWebhookSchema,\n\t\t\tFlowRunSchema,\n\t\t]),\n\t),\n});\nexport type AutomationWizardSchema = z.infer<typeof AutomationWizardSchema>;\nexport type ActionsSchema = AutomationWizardSchema[\"actions\"][number];\nexport type ActionType = AutomationWizardSchema[\"actions\"][number][\"type\"];\n"],"names":["UNASSIGNED","DoNothingSchema","z.object","z.literal","FlowRunSchema","z.enum","ChangeFlowRunStateSchema","z.string","z.boolean","schema","RunDeploymentsSchema","z.record","z.unknown","DeploymentsSchema","WorkQueueSchema","WorkPoolSchema","AutomationSchema","SendNotificationSchema","CallWebhookSchema","TriggerTemplateSchema","TriggerPostureSchema","ResourceSpecificationSchema","z.union","z.array","EventTriggerSchema","z.number","TriggerSchema","z.lazy","CompoundTriggerSchema","SequenceTriggerSchema","AutomationWizardSchema"],"mappings":"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"}