{"version":3,"file":"base-job-template-form-section-oZD6U-RW.js","sources":["../../src/components/work-pools/create/infrastructure-configuration-step/base-job-template-form-section.tsx"],"sourcesContent":["import { useCallback, useMemo, useState } from \"react\";\nimport { useSchemaFormErrors } from \"@/components/schemas/hooks/useSchemaFormErrors\";\nimport { useSchemaFormValues } from \"@/components/schemas/hooks/useSchemaValues\";\nimport { SchemaForm } from \"@/components/schemas/schema-form\";\nimport type { PrefectSchemaObject } from \"@/components/schemas/types/schemas\";\nimport type { SchemaFormValues } from \"@/components/schemas/types/values\";\nimport { Card, CardContent, CardDescription } from \"@/components/ui/card\";\nimport type { JsonInputOnChange } from \"@/components/ui/json-input\";\nimport { LazyJsonInput as JsonInput } from \"@/components/ui/json-input-lazy\";\nimport { Label } from \"@/components/ui/label\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Typography } from \"@/components/ui/typography\";\nimport type { WorkerBaseJobTemplate } from \"./schema\";\n\ntype BaseJobTemplateFormSectionProps = {\n\tbaseJobTemplate?: WorkerBaseJobTemplate;\n\tonBaseJobTemplateChange: (value: WorkerBaseJobTemplate) => void;\n};\n\nexport function BaseJobTemplateFormSection({\n\tbaseJobTemplate,\n\tonBaseJobTemplateChange,\n}: BaseJobTemplateFormSectionProps) {\n\tconst [jsonValue, setJsonValue] = useState(() =>\n\t\tJSON.stringify(baseJobTemplate || {}, null, 2),\n\t);\n\tconst [jsonError, setJsonError] = useState<string | null>(null);\n\n\tconst variablesSchema = useMemo<PrefectSchemaObject | undefined>(() => {\n\t\treturn baseJobTemplate?.variables as PrefectSchemaObject;\n\t}, [baseJobTemplate?.variables]);\n\n\tconst hasSchemaProperties = useMemo(() => {\n\t\treturn (\n\t\t\tvariablesSchema?.properties &&\n\t\t\tObject.keys(variablesSchema.properties).length > 0\n\t\t);\n\t}, [variablesSchema?.properties]);\n\n\t// Get default values from schema properties\n\tconst defaultValues = useMemo<SchemaFormValues>(() => {\n\t\tif (!variablesSchema?.properties) return {};\n\n\t\tconst defaults: SchemaFormValues = {};\n\t\tObject.entries(variablesSchema.properties).forEach(([key, property]) => {\n\t\t\tif (property && typeof property === \"object\" && \"default\" in property) {\n\t\t\t\tdefaults[key] = property.default;\n\t\t\t}\n\t\t});\n\t\treturn defaults;\n\t}, [variablesSchema?.properties]);\n\n\tconst [schemaValues, setSchemaValues] = useSchemaFormValues(defaultValues);\n\tconst [schemaErrors] = useSchemaFormErrors([]);\n\n\tconst handleSchemaValuesChange = useCallback(\n\t\t(values: SchemaFormValues) => {\n\t\t\tsetSchemaValues(values);\n\n\t\t\tif (!variablesSchema?.properties) return;\n\n\t\t\t// Update the base job template with new default values\n\t\t\tconst newTemplate: WorkerBaseJobTemplate = {\n\t\t\t\t...baseJobTemplate,\n\t\t\t\tvariables: {\n\t\t\t\t\t...variablesSchema,\n\t\t\t\t\tproperties: Object.fromEntries(\n\t\t\t\t\t\tObject.entries(variablesSchema.properties).map(\n\t\t\t\t\t\t\t([key, property]) => [\n\t\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...property,\n\t\t\t\t\t\t\t\t\tdefault: values[key],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tonBaseJobTemplateChange(newTemplate);\n\t\t\tsetJsonValue(JSON.stringify(newTemplate, null, 2));\n\t\t},\n\t\t[\n\t\t\tbaseJobTemplate,\n\t\t\tvariablesSchema,\n\t\t\tonBaseJobTemplateChange,\n\t\t\tsetSchemaValues,\n\t\t],\n\t);\n\n\tconst handleJsonChange = useCallback(\n\t\t(value: string) => {\n\t\t\tsetJsonValue(value);\n\t\t\tsetJsonError(null);\n\n\t\t\ttry {\n\t\t\t\tconst parsed = JSON.parse(value) as WorkerBaseJobTemplate;\n\t\t\t\tonBaseJobTemplateChange(parsed);\n\t\t\t} catch (error) {\n\t\t\t\tsetJsonError(error instanceof Error ? error.message : \"Invalid JSON\");\n\t\t\t}\n\t\t},\n\t\t[onBaseJobTemplateChange],\n\t);\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<Typography variant=\"h3\">Base Job Template</Typography>\n\n\t\t\t<Tabs defaultValue=\"defaults\" className=\"w-full\">\n\t\t\t\t<TabsList>\n\t\t\t\t\t<TabsTrigger value=\"defaults\">Defaults</TabsTrigger>\n\t\t\t\t\t<TabsTrigger value=\"advanced\">Advanced</TabsTrigger>\n\t\t\t\t</TabsList>\n\n\t\t\t\t<TabsContent value=\"defaults\" className=\"space-y-4\">\n\t\t\t\t\t{hasSchemaProperties ? (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<Card>\n\t\t\t\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t\t\t\t\tThe fields below control the default values for the base job\n\t\t\t\t\t\t\t\t\t\ttemplate. These values can be overridden by deployments.\n\t\t\t\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t\t\t\t</CardContent>\n\t\t\t\t\t\t\t</Card>\n\n\t\t\t\t\t\t\t{variablesSchema && (\n\t\t\t\t\t\t\t\t<SchemaForm\n\t\t\t\t\t\t\t\t\tschema={variablesSchema}\n\t\t\t\t\t\t\t\t\tkinds={[\"json\"]}\n\t\t\t\t\t\t\t\t\tvalues={schemaValues}\n\t\t\t\t\t\t\t\t\tonValuesChange={handleSchemaValuesChange}\n\t\t\t\t\t\t\t\t\terrors={schemaErrors}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<Card>\n\t\t\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t\t\t\tThis work pool&apos;s base job template does not have any\n\t\t\t\t\t\t\t\t\tcustomizations. To add customizations, edit the base job\n\t\t\t\t\t\t\t\t\ttemplate directly with the <strong>Advanced</strong> tab.\n\t\t\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t\t\t</CardContent>\n\t\t\t\t\t\t</Card>\n\t\t\t\t\t)}\n\t\t\t\t</TabsContent>\n\n\t\t\t\t<TabsContent value=\"advanced\" className=\"space-y-4\">\n\t\t\t\t\t<Card>\n\t\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t\t\tThis is the JSON representation of the base job template. A work\n\t\t\t\t\t\t\t\tpool&apos;s job template controls infrastructure configuration\n\t\t\t\t\t\t\t\tfor all flow runs in the work pool, and specifies the\n\t\t\t\t\t\t\t\tconfiguration that can be overridden by deployments.\n\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\tFor more information on the structure of a work pool&apos;s base\n\t\t\t\t\t\t\t\tjob template, check out the docs.\n\t\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t\t</CardContent>\n\t\t\t\t\t</Card>\n\n\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t<Label>Base Job Template JSON</Label>\n\t\t\t\t\t\t<JsonInput\n\t\t\t\t\t\t\tvalue={jsonValue}\n\t\t\t\t\t\t\tonChange={handleJsonChange as JsonInputOnChange}\n\t\t\t\t\t\t\tclassName={jsonError ? \"border-destructive\" : \"\"}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{jsonError && (\n\t\t\t\t\t\t\t<p className=\"text-sm text-destructive\">{jsonError}</p>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</TabsContent>\n\t\t\t</Tabs>\n\t\t</div>\n\t);\n}\n"],"names":["BaseJobTemplateFormSection","baseJobTemplate","onBaseJobTemplateChange","jsonValue","setJsonValue","useState","jsonError","setJsonError","variablesSchema","useMemo","hasSchemaProperties","defaultValues","defaults","key","property","schemaValues","setSchemaValues","useSchemaFormValues","schemaErrors","useSchemaFormErrors","handleSchemaValuesChange","useCallback","values","newTemplate","handleJsonChange","value","parsed","error","jsxs","jsx","Typography","Tabs","TabsList","TabsTrigger","TabsContent","Fragment","Card","CardContent","CardDescription","SchemaForm","Label","JsonInput"],"mappings":"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"}