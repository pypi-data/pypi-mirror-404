# 📦 阿里云MCP服务部署完整指南

## 🎯 部署配置（直接使用）

在阿里云MCP管理界面中，**直接复制以下JSON配置**：

```json
{
  "mcpServers": {
    "douyin-mcp": {
      "command": "uvx",
      "args": [
        "douyin-mcp-server"
      ],
      "env": {
        "DASHSCOPE_API_KEY": "sk-your-api-key-here"
      }
    }
  }
}
```

## 📋 部署步骤详解

### 步骤1：检查项目状态

项目名称：`douyin-mcp-server`
当前版本：`1.2.0`

**检查是否已发布到PyPI：**
```bash
# 检查包是否存在
pip search douyin-mcp-server 2>/dev/null || echo "需要发布到PyPI"
```

### 步骤2：发布到PyPI（如果未发布）

#### 2.1 安装构建工具
```bash
pip3 install build twine
```

#### 2.2 构建分发包
```bash
# 使用提供的脚本
./build_and_deploy.sh

# 或手动构建
python3 -m build
```

#### 2.3 检查构建结果
```bash
ls -lh dist/
# 应该看到 .whl 和 .tar.gz 文件
```

#### 2.4 上传到PyPI

**测试环境（推荐先测试）：**
```bash
python3 -m twine upload --repository testpypi dist/*
```

**正式环境：**
```bash
python3 -m twine upload dist/*
```

**需要PyPI账号：**
- 访问 https://pypi.org/account/register/ 注册账号
- 或使用现有账号

### 步骤3：在阿里云部署

#### 3.1 登录阿里云MCP管理界面
- 访问阿里云控制台
- 进入MCP服务管理页面

#### 3.2 创建MCP服务
- 点击"创建MCP服务"
- 填写服务名称（如：douyin-mcp）

#### 3.3 配置服务参数

**安装方式：**
- ✅ 选择 **uvx**

**部署方式：**
- **基础模式**（推荐）：按次计费，0.000156元/秒
- **极速模式**：按小时计费，0.13元/小时，冷启动≤5毫秒

**部署地域：**
- 选择离您最近的地域（如：华东1-杭州）

**MCP服务配置：**
- 粘贴上面的JSON配置
- 确保JSON格式正确（可以使用JSON验证工具）

#### 3.4 提交部署
- 点击"提交部署"
- 等待部署完成（首次部署需要5-10秒下载和安装）

### 步骤4：验证部署

部署成功后，您应该能够：
1. ✅ 在MCP客户端中看到 `douyin-mcp` 服务
2. ✅ 调用 `get_douyin_download_link` 工具
3. ✅ 调用 `extract_douyin_text` 工具
4. ✅ 调用 `parse_douyin_video_info` 工具

## 🔧 配置说明

### 环境变量

| 变量名 | 必需 | 说明 | 默认值 |
|--------|------|------|--------|
| `DASHSCOPE_API_KEY` | ✅ 是 | 阿里云百炼API密钥 | 无 |
| `DOUYIN_MODEL` | ❌ 否 | 语音识别模型 | `paraformer-v2` |

### 修改API密钥

如果需要更换API密钥，修改JSON中的值：
```json
"env": {
  "DASHSCOPE_API_KEY": "your-new-api-key-here"
}
```

## 💰 费用说明

### 基础模式（按次计费）
- **首次请求**：5~10秒连接时间（下载和安装）
- **计费方式**：0.000156元/秒 × 实际使用时长
- **释放**：连接断开后自动释放，不计费
- **适合**：低频使用场景

**示例费用：**
- 单次调用10秒：0.00156元
- 单次调用60秒：0.00936元

### 极速模式（按小时计费）
- **冷启动**：≤5毫秒
- **计费方式**：0.13元/小时
- **释放**：需要手动关闭服务
- **适合**：高频使用、时延敏感场景

**示例费用：**
- 运行1小时：0.13元
- 运行24小时：3.12元

## 🆘 故障排查

### 问题1：uvx找不到包

**错误信息：**
```
Error: Package 'douyin-mcp-server' not found
```

**解决方案：**
1. 确认包已发布到PyPI
2. 尝试指定版本：`douyin-mcp-server@1.2.0`
3. 检查网络连接

### 问题2：API密钥错误

**错误信息：**
```
未设置API密钥，请在config.json中配置或传入api_key参数
```

**解决方案：**
1. 检查环境变量 `DASHSCOPE_API_KEY` 是否正确设置
2. 确认API密钥有效且有额度
3. 查看函数计算日志

### 问题3：服务启动失败

**解决方案：**
1. 查看函数计算执行日志
2. 检查Python版本（需要3.10+）
3. 确认所有依赖都已安装

### 问题4：JSON格式错误

**解决方案：**
1. 使用JSON验证工具检查格式
2. 确保所有引号都是双引号
3. 确保没有多余的逗号

## 📊 部署检查清单

部署前：
- [ ] 项目已发布到PyPI（或使用本地包）
- [ ] 准备好阿里云百炼API密钥
- [ ] 了解费用模式（基础/极速）
- [ ] 选择合适的地域

部署时：
- [ ] 选择正确的安装方式（uvx）
- [ ] JSON配置格式正确
- [ ] 环境变量已正确设置
- [ ] 已选择部署地域

部署后：
- [ ] 服务状态为"运行中"
- [ ] 可以调用MCP工具
- [ ] 日志无错误信息

## 🔄 更新部署

如果需要更新服务：

1. **更新代码**：修改代码后重新发布到PyPI
2. **更新配置**：在MCP管理界面修改配置
3. **重新部署**：提交新的配置，系统会自动更新

## 📞 获取帮助

- 📖 详细文档：查看 `DEPLOY.md`
- 🚀 快速指南：查看 `QUICK_DEPLOY.md`
- 🐛 问题反馈：GitHub Issues
- 📧 联系作者：yz.liu.me@gmail.com

## 🎉 部署成功！

部署成功后，您就可以在任何支持MCP的应用中使用抖音视频处理功能了！

**可用功能：**
- ✅ 获取无水印视频下载链接
- ✅ 解析视频基本信息
- ✅ AI语音识别提取文本内容