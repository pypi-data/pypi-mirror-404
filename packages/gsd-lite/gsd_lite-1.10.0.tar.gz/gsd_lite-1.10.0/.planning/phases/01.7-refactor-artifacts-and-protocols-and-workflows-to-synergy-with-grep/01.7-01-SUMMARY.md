---
phase: 01.7-refactor-artifacts-and-protocols-and-workflows-to-synergy-with-grep
plan: 01
subsystem: templates
tags: [grep, markdown, artifacts, workflow, protocol]

# Dependency graph
requires:
  - phase: 01.5-evaluation-framework
    provides: Eval framework for testing template changes
provides:
  - Grep-friendly WORK.md with 3-part structure (Current Understanding, Key Events Index, Atomic Log)
  - housekeeping.md workflow for PR extraction and archiving
  - PROTOCOL.md with grep-first behavior guidance and read_to_next_pattern patterns
  - STATE.md deprecated and merged into WORK.md
affects: [all-future-sessions, agent-onboarding, template-usage]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Grep-first file reading: discover with ^## , surgical read with boundaries"
    - "Perpetual WORK.md with user-controlled housekeeping (not ephemeral)"
    - "Multi-task support via Task: TAG in log entries"
    - "[LOG-NNN] format with 6 types: VISION, DECISION, DISCOVERY, PLAN, BLOCKER, EXEC"

key-files:
  created:
    - src/gsd_lite/template/workflows/housekeeping.md
  modified:
    - src/gsd_lite/template/WORK.md
    - src/gsd_lite/template/PROTOCOL.md
    - src/gsd_lite/template/STATE.md

key-decisions:
  - "WORK.md is perpetual with user-controlled housekeeping, not ephemeral"
  - "STATE.md deprecated and merged into WORK.md Current Understanding"
  - "housekeeping.md replaces promotion.md with unified PR extraction and archiving"
  - "Grep-first behavior: always grep headers before reading, use read_to_next_pattern if available"
  - "6 log types established: VISION, DECISION, DISCOVERY, PLAN, BLOCKER, EXEC"

patterns-established:
  - "3-part WORK.md: Current Understanding → Key Events Index → Atomic Session Log"
  - "Grep patterns: ^## for headers, ^\[LOG- for entries, \[TYPE\] for filtering, Task: TAG for multi-task"
  - "read_to_next_pattern recommended for section-aware reading with manual calculation fallback"
  - "Code snippets required for EXEC/DISCOVERY entries (enables PR extraction)"

# Metrics
duration: 5min
completed: 2026-01-27
---

# Phase 01.7 Plan 01: Refactor Artifacts for Grep Synergy Summary

**Grep-optimized WORK.md with 3-part structure, perpetual lifecycle with housekeeping workflow, and STATE.md merged into Current Understanding section**

## Performance

- **Duration:** 5 min
- **Started:** 2026-01-27T15:57:09Z
- **Completed:** 2026-01-27T16:02:09Z
- **Tasks:** 3
- **Files modified:** 4

## Accomplishments
- WORK.md redesigned with grep-friendly 3-part structure optimized for non-linear retrieval
- housekeeping.md workflow created unifying PR extraction and task archiving
- PROTOCOL.md updated with grep-first behavior guidance and File Reading Strategy section
- STATE.md deprecated and merged into WORK.md Current Understanding

## Task Commits

Each task was committed atomically:

1. **Task 1: Redesign WORK.md with 3-part grep-friendly structure** - `6ccbf20` (refactor)
2. **Task 2: Create housekeeping.md workflow replacing promotion.md** - `86d84a9` (feat)
3. **Task 3: Update PROTOCOL.md for merged structure, new router, and grep-first behavior** - `316a301` (refactor)

## Files Created/Modified
- `src/gsd_lite/template/WORK.md` - 3-part structure: Current Understanding (with mode, active/parked tasks) → Key Events Index (query accelerator with Task column) → Atomic Session Log ([LOG-NNN] format with 6 types)
- `src/gsd_lite/template/workflows/housekeeping.md` - Unified workflow for PR extraction (filter by Task: TAG) and archiving (move to HISTORY.md), triggered by natural language
- `src/gsd_lite/template/PROTOCOL.md` - Updated router (housekeeping replaces promotion), Fresh Agent Resume Protocol (grep-first), new File Reading Strategy section with read_to_next_pattern patterns
- `src/gsd_lite/template/STATE.md` - Deprecated with notice pointing to WORK.md Current Understanding

## Decisions Made

1. **WORK.md is perpetual, not ephemeral**
   - Rationale: Enables PR extraction at any time, supports multi-session work, user controls cleanup timing
   - Impact: Logs persist until user requests archiving via housekeeping workflow

2. **STATE.md merged into WORK.md Current Understanding**
   - Rationale: Fewer files reduces confusion for weak agents, single source of truth for session state
   - Impact: Fresh agents read WORK.md only (not STATE.md + WORK.md)

3. **housekeeping.md replaces promotion.md**
   - Rationale: Unified workflow handles both PR extraction AND archiving, natural language triggers (not mode-based), supports perpetual WORK.md
   - Impact: User can generate PRs anytime ("write PR for MODEL-A"), archive selectively ("archive AUTH-IMPL"), multiple times per project

4. **Grep-first behavior explicit in PROTOCOL.md**
   - Rationale: Agents need prompting to use grep before reading, with clear patterns and fallbacks
   - Impact: Fresh Agent Resume Protocol includes grep instruction, new File Reading Strategy section teaches patterns

5. **read_to_next_pattern recommended with fallbacks**
   - Rationale: Server-side boundary detection is cleaner than agent calculation, but not all servers support it yet
   - Impact: PROTOCOL.md documents recommended approach (read_to_next_pattern) and fallbacks (manual calculation, read first 50 lines)

6. **6 log types established: VISION, DECISION, DISCOVERY, PLAN, BLOCKER, EXEC**
   - Rationale: Clear taxonomy for filtering, enables type-based grep queries
   - Impact: All examples updated to use 6 types consistently

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- All templates updated for grep-optimized retrieval
- PROTOCOL.md teaches grep-first behavior with clear patterns
- housekeeping.md enables flexible PR extraction and archiving
- Ready for Phase 01.7 Plan 02 (if planned) or next phase in roadmap

**Blockers:** None

**Concerns:** Need to update other workflow files (moodboard.md, execution.md, checkpoint.md) to reference new WORK.md structure and remove STATE.md references. This should be addressed in subsequent plans within Phase 01.7.

---
*Phase: 01.7-refactor-artifacts-and-protocols-and-workflows-to-synergy-with-grep*
*Completed: 2026-01-27*
