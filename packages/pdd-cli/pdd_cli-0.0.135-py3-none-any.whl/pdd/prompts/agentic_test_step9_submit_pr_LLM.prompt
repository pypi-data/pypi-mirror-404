% You are an expert software engineer handling a test generation request. Your task is to create a draft pull request with the generated tests and link it to the issue.

% Context

You are working on step 9 of 9 (final step) in an agentic test generation workflow. Previous steps have generated and verified the tests.

% Inputs

- GitHub Issue URL: {issue_url}
- Repository: {repo_owner}/{repo_name}
- Issue Number: {issue_number}

% Issue Content
<issue_content>
{issue_content}
</issue_content>

% Previous Steps Output
<step1_output>
{step1_output}
</step1_output>

<step2_output>
{step2_output}
</step2_output>

<step3_output>
{step3_output}
</step3_output>

<step4_output>
{step4_output}
</step4_output>

<step5_output>
{step5_output}
</step5_output>

<step6_output>
{step6_output}
</step6_output>

<step7_output>
{step7_output}
</step7_output>

<step8_output>
{step8_output}
</step8_output>

% Worktree Information

You are operating in an isolated git worktree at: {worktree_path}
This worktree is already checked out to branch `test/issue-{issue_number}`.
Do NOT create a new branch - just stage, commit, and push.

% Files to Stage

**IMPORTANT: Only stage these specific files:**
{files_to_stage}

% Your Task

1. **Prepare the commit**
   - You are already on branch `test/issue-{issue_number}` in an isolated worktree
   - **CRITICAL: Stage ONLY the test files created/modified in Steps 6 and 8**
   - Get the exact file paths from:
     - Step 6's `FILES_CREATED:` or `FILES_MODIFIED:` output
     - Step 8's `FILES_MODIFIED:` output (if any fixes were made)
   - Stage each file individually: `git add <exact_file_path>`
   - **DO NOT use `git add .` or `git add -A`** - these will stage unrelated files
   - Verify only the intended files are staged: `git status --short`
   - Commit with a descriptive message referencing the issue

2. **Create the draft PR**
   - Push the branch to origin
   - Create a draft pull request using `gh pr create --draft`
   - Link to the issue using "Closes #{issue_number}" in the PR body

3. **Post final summary**
   - Comment on the issue with PR link and next steps

% PR Creation Command

```bash
gh pr create --draft --title "Add tests for #{issue_number}" --body "$(cat <<'EOF'
## Summary
Adds tests based on the requirements in #{issue_number}.

## Test Files
{{list_of_test_files}}

## Test Coverage
- **Total Tests:** {{N}}
- **Framework:** {{framework}}
- **Status:** {{passing | some_failing}}

## What These Tests Verify
{{summary_from_step5_test_plan}}

## Test Execution
```bash
{{command_to_run_tests}}
```

## Next Steps
1. [ ] Review the generated tests
2. [ ] Run tests locally to verify
3. [ ] Adjust tests if needed
4. [ ] Mark PR as ready for review

Closes #{issue_number}

---
*Generated by PDD agentic test workflow*
EOF
)"
```

% Output

After creating the PR, use `gh issue comment` to post your final report to issue #{issue_number}:

```
gh issue comment {issue_number} --repo {repo_owner}/{repo_name} --body "..."
```

Your comment should follow this format:

```markdown
## Step 9: Draft PR Created

### Pull Request
**PR #{{pr_number}}:** [{{pr_title}}]({{pr_url}})

### Branch
`test/issue-{issue_number}`

### What's Included
- Test files at:
  - `{{test_file_1}}`
  - `{{test_file_2}}`
  ...
- Commits: {{commit_count}}

### Test Summary
- **Total Tests:** {{N}}
- **Passing:** {{N}}
- **Framework:** {{framework}}

### Next Steps for Reviewers
1. Review the generated tests for completeness
2. Run tests locally: `{{run_command}}`
3. Adjust test selectors/assertions if needed
4. Mark the PR as ready for review

### Running the Tests
```bash
{{test_run_command}}
```

---
*Test generation complete. A draft PR with the tests has been created and linked to this issue.*
```

% Important

- Create a DRAFT PR (not ready for review) to allow for test review
- The PR should clearly describe what tests were created
- Use "Closes #{issue_number}" to auto-link the PR to the issue
- Do NOT create a new branch - you are already on the correct branch in the worktree
- Include all test files from Steps 6 and 8
- Always post your findings as a GitHub comment before completing
