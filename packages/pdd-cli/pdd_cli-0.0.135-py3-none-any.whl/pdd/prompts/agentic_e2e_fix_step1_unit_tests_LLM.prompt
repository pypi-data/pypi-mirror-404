% You are an expert software engineer fixing bugs identified in a GitHub issue. Your task is to run the **issue-specific unit tests** (created by `pdd bug`) and fix any failures using pdd fix.

% Context

You are working on step 1 of 9 in an agentic e2e fix workflow. This issue was typically created by `pdd bug` and contains unit tests that need to pass.

**Important distinction from Step 8:**
- Step 1 (this step): Runs unit tests **explicitly listed in the GitHub issue** (created by `pdd bug`) and fixes their associated dev units
- Step 8: Runs pdd fix on dev units **identified during e2e failure analysis** in Steps 3-5 (may be different dev units)

% Inputs

- GitHub Issue URL: {issue_url}
- Repository: {repo_owner}/{repo_name}
- Issue Number: {issue_number}
- Cycle: {cycle_number}/{max_cycles}

% Issue Content
<issue_content>
{issue_content}
</issue_content>

% Your Task

1. **Identify unit tests from the issue**
   - Parse the issue content to find unit test file paths
   - Look for patterns like `tests/test_*.py`, `FILES_CREATED:`, or test code blocks
   - Extract the test file paths and test function names

2. **Run the unit tests**
   - Execute pytest with the test files you identified above (e.g., `pytest tests/test_foo.py -v`)
   - Capture the output including any failures
   - Note which tests pass and which fail

3. **For each failing test, run pdd fix**
   - Identify the dev unit (module) associated with each failing test
   - For each failing dev unit, run pdd fix in manual mode:
     ```bash
     pdd fix --manual --loop {protect_tests_flag} prompts/{{dev_unit}}_python.prompt pdd/{{dev_unit}}.py tests/test_{{dev_unit}}.py
     ```
   - Run pdd fix sequentially, one dev unit at a time
   - Capture the output of each pdd fix run

4. **Re-run unit tests to verify fixes**
   - After all pdd fix runs complete, re-run the unit tests
   - Report which tests now pass vs still fail

% Output

After completing your analysis, use `gh issue comment` to post your findings to issue #{issue_number}:

```
gh issue comment {issue_number} --repo {repo_owner}/{repo_name} --body "..."
```

Your comment should follow this format:

```markdown
## Step 1: Unit Test Execution (Cycle {cycle_number})

**Status:** [All Tests Pass | N Tests Still Failing]

### Unit Tests Identified
- `{{test_file}}::{{test_function}}`
- ...

### Initial Test Results
- Passed: {{N}}
- Failed: {{N}}

### pdd fix Runs
| Dev Unit | Result |
|----------|--------|
| {{name}} | Fixed / Still Failing |

### Final Test Results
- Passed: {{N}}
- Failed: {{N}}

---
*Proceeding to Step 2: E2E Test Check*
```

% Important

- Run pdd fix sequentially, not in parallel
- If a dev unit has already been fixed in a previous cycle, skip it unless tests still fail
- Always post your findings as a GitHub comment before completing
