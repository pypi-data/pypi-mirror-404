plugins {
    id 'com.android.application'
}

android {
    namespace "com.github.ethindp.prism.tests.android.simpleapp"
    compileSdk 35
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_21
        targetCompatibility JavaVersion.VERSION_21
    }
    defaultConfig {
        applicationId "com.github.ethindp.prism.tests.android.simpleapp"
        minSdk 30
        targetSdk 35
        versionCode 1
        versionName "1.0"
        externalNativeBuild {
            cmake {
                cppFlags "-std=c++23 -fexceptions -frtti"
            }
        }
        ndk {
            abiFilters "arm64-v8a", "x86_64"
        }
        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
    }
    testOptions {
        managedDevices {
            localDevices {
                        def osArch = System.getProperty("os.arch").toLowerCase()
        def isArm64 = (osArch == "aarch64" || osArch == "arm64")
if (isArm64) {
                api30AospArm64 {
                    device = "Pixel 6"
                    apiLevel = 30
                    systemImageSource = "google_apis"
                    require64Bit = true
                    testedAbi = "arm64-v8a"
                }
                api31AospArm64 {
                    device = "Pixel 6"
                    apiLevel = 31
                    systemImageSource = "google_apis"
                    require64Bit = true
                    testedAbi = "arm64-v8a"
                }
                api32AospArm64 {
                    device = "Pixel 6"
                    apiLevel = 32
                    systemImageSource = "google_apis"
                    require64Bit = true
                    testedAbi = "arm64-v8a"
                }
                api33AospArm64 {
                    device = "Pixel 6"
                    apiLevel = 33
                    systemImageSource = "google_apis"
                    require64Bit = true
                    testedAbi = "arm64-v8a"
                }
                api34AospArm64 {
                    device = "Pixel 6"
                    apiLevel = 34
                    systemImageSource = "google_apis"
                    require64Bit = true
                    testedAbi = "arm64-v8a"
                }
                api35AospArm64 {
                    device = "Pixel 6"
                    apiLevel = 35
                    systemImageSource = "google_apis"
                    require64Bit = true
                    testedAbi = "arm64-v8a"
                }
                api36AospArm64 {
                    device = "Pixel 6"
                    apiLevel = 36
                    systemImageSource = "google_apis"
                    require64Bit = true
                    testedAbi = "arm64-v8a"
                }
                } else {
                                api31AospX64 {
                    device = "Pixel 2"
                    apiLevel = 31
                    systemImageSource = "google_apis"
                    testedAbi = "x86_64"
                    require64Bit = true
                }
                api32AospX64 {
                    device = "Pixel 2"
                    apiLevel = 32
                    systemImageSource = "google_apis"
                    testedAbi = "x86_64"
                    require64Bit = true
                }
                api33AospX64 {
                    device = "Pixel 2"
                    apiLevel = 33
                    systemImageSource = "google_apis"
                    testedAbi = "x86_64"
                    require64Bit = true
                }
                api34AospX64 {
                    device = "Pixel 2"
                    apiLevel = 34
                    systemImageSource = "google_apis"
                    testedAbi = "x86_64"
                    require64Bit = true
                }
                api35AospX64 {
                    device = "Pixel 2"
                    apiLevel = 35
                    systemImageSource = "google_apis"
                    testedAbi = "x86_64"
                    require64Bit = true
                }
                api36AospX64 {
                    device = "Pixel 2"
                    apiLevel = 36
                    systemImageSource = "google_apis"
                    testedAbi = "x86_64"
                    require64Bit = true
                }
}
            }
groups {
    allDevices {
        def osArch = System.getProperty("os.arch").toLowerCase()
        def isArm64 = (osArch == "aarch64" || osArch == "arm64")
        if (isArm64) {
            targetDevices.add(devices.api30AospArm64)
            targetDevices.add(devices.api31AospArm64)
            targetDevices.add(devices.api32AospArm64)
            targetDevices.add(devices.api33AospArm64)
            targetDevices.add(devices.api34AospArm64)
            targetDevices.add(devices.api35AospArm64)
            targetDevices.add(devices.api36AospArm64)
        } else {
            targetDevices.add(devices.api31AospX64)
            targetDevices.add(devices.api32AospX64)
            targetDevices.add(devices.api33AospX64)
            targetDevices.add(devices.api34AospX64)
            targetDevices.add(devices.api35AospX64)
            targetDevices.add(devices.api36AospX64)
        }
    }
}
        }
    }
    buildTypes {
        release {
            minifyEnabled false
        }
    }
    externalNativeBuild {
        cmake {
            path "src/main/cpp/CMakeLists.txt"
        }
    }
}

dependencies {
    implementation rootProject
    implementation "androidx.appcompat:appcompat:1.7.1"
    implementation "com.google.android.material:material:1.13.0"
    androidTestImplementation 'androidx.test.ext:junit:1.2.1'
    androidTestImplementation 'androidx.test:runner:1.7.0'
    androidTestImplementation 'androidx.test:core:1.7.0'
}
