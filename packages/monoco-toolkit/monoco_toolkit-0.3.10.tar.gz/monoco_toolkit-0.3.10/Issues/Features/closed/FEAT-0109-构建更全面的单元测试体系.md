---
id: FEAT-0109
uid: '660746'
type: feature
status: closed
stage: done
title: 构建更全面的单元测试体系
created_at: '2026-01-29T16:01:54'
updated_at: 2026-01-29 16:19:32
parent: EPIC-0021
dependencies: []
related: []
domains: []
tags:
- '#EPIC-0021'
- '#FEAT-0109'
files: []
opened_at: '2026-01-29T16:01:54'
closed_at: '2026-01-29T16:16:32'
solution: implemented
---

## FEAT-0109: 构建更全面的单元测试体系

## Objective
建立 Monoco Issue 模块的自动化测试体系，确保 Pydantic 模型的严格约束、状态机流转逻辑以及 CLI 操作的正确性。

## Acceptance Criteria
- [x] **模型校验**: 覆盖 `IssueMetadata` 的所有核心字段校验（枚举、正则、关联逻辑）。
- [x] **状态机**: 验证 issue start/submit/close/backlog 等操作的状态变更是否符合预期。
- [x] **错误处理**: 确保非法输入（如错误的 parent 引用、非法的 solution 文本）能被准确识别并抛出友好错误。
- [x] **CLI 集成**: 通过 `pytest` 运行 CLI 命令并验证文件系统的变更。

## Technical Tasks
- [x] 完善 `tests/features/issue/test_models.py`，增加边界情况测试。
- [x] 创建 `tests/features/issue/test_lifecycle.py`，测试 issue 状态流转。
- [x] 创建 `tests/features/issue/test_cli.py`，验证 `monoco issue` CLI 命令。

## Review Comments
- 2026-01-29:
  - 完善了 `test_models.py`，支持 `IssueID` 解析、`UID` 生成和更细致的 `IssueMetadata` 边界校验。
  - 新增 `test_lifecycle.py`，覆盖了从创建到关闭的全生命周期状态流转测试，并验证了依赖阻断逻辑。
  - 新增 `test_cli.py`，模拟真实项目环境验证了 `create`, `list`, `backlog` 等核心 CLI 命令。
  - 修复了 `StateMachine` 中存在的重复方法定义。
  - 增强了 `conftest.py`，提供 `project_env` fixture 以支持系统级集成测试。
