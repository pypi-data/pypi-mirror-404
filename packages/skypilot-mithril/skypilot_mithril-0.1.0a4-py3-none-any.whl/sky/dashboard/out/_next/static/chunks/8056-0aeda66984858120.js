"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8056],{50326:function(e,t,o){o.d(t,{$N:function(){return h},Be:function(){return p},Vq:function(){return c},cN:function(){return g},cZ:function(){return d},fK:function(){return f}});var r=o(85893),a=o(67294),n=o(6327),s=o(32350),l=o(43767);let c=n.fC;n.xz;let u=n.h_;n.x8;let i=a.forwardRef((e,t)=>{let{className:o,...a}=e;return(0,r.jsx)(n.aV,{ref:t,className:(0,s.cn)("fixed inset-0 z-50 bg-black/50 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",o),...a})});i.displayName=n.aV.displayName;let d=a.forwardRef((e,t)=>{let{className:o,children:a,...c}=e;return(0,r.jsxs)(u,{children:[(0,r.jsx)(i,{}),(0,r.jsxs)(n.VY,{ref:t,className:(0,s.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-gray-200 bg-white p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",o),...c,children:[a,(0,r.jsxs)(n.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-white transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-gray-100 data-[state=open]:text-gray-500",children:[(0,r.jsx)(l.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});d.displayName=n.VY.displayName;let f=e=>{let{className:t,...o}=e;return(0,r.jsx)("div",{className:(0,s.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...o})};f.displayName="DialogHeader";let g=e=>{let{className:t,...o}=e;return(0,r.jsx)("div",{className:(0,s.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...o})};g.displayName="DialogFooter";let h=a.forwardRef((e,t)=>{let{className:o,...a}=e;return(0,r.jsx)(n.Dx,{ref:t,className:(0,s.cn)("text-lg font-semibold leading-none tracking-tight",o),...a})});h.displayName=n.Dx.displayName;let p=a.forwardRef((e,t)=>{let{className:o,...a}=e;return(0,r.jsx)(n.dk,{ref:t,className:(0,s.cn)("text-sm text-gray-500",o),...a})});p.displayName=n.dk.displayName},23266:function(e,t,o){o.d(t,{GH:function(){return f},QL:function(){return h},Sl:function(){return d},getClusters:function(){return u},uR:function(){return i}});var r=o(67294),a=o(15821),n=o(47145),s=o(93225),l=o(6378);let c={UP:"RUNNING",STOPPED:"STOPPED",INIT:"LAUNCHING",null:"TERMINATED"};async function u(){let{clusterNames:e=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return(await n.x.fetch("/status",{cluster_names:e,all_users:!0,include_credentials:!1,include_handle:!1,summary_response:null==e})).map(e=>{let t="";t=e.zone?e.zone:e.region,"SSH"===e.cloud&&(null==t?void 0:t.startsWith("ssh-"))&&(t=t.substring(4));let o=t;return t&&t.length>25&&(t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15;if(!e||e.length<=t)return e;if(t<=3)return"...";let o=Math.floor((t-3)/2),r=o+(t-3)%2;return 0===o?e.substring(0,r)+"...":e.substring(0,r)+"..."+e.substring(e.length-o)}(t,25)),{status:c[e.status],cluster:e.name,user:e.user_name,user_hash:e.user_hash,cluster_hash:e.cluster_hash,cloud:e.cloud,region:e.region,infra:t?e.cloud+" ("+t+")":e.cloud,full_infra:o?"".concat(e.cloud," (").concat(o,")"):e.cloud,cpus:e.cpus,mem:e.memory,gpus:e.accelerators,resources_str:e.resources_str,resources_str_full:e.resources_str_full,time:new Date(1e3*e.launched_at),num_nodes:e.nodes,workspace:e.workspace,autostop:e.autostop,last_event:e.last_event,to_down:e.to_down,cluster_name_on_cloud:e.cluster_name_on_cloud,labels:e.labels||{},jobs:[],command:e.last_creation_command||e.last_use,task_yaml:e.last_creation_yaml||"{}",events:[{time:new Date(1e3*e.launched_at),event:"Cluster created."}]}})}catch(e){throw console.error("Error fetching clusters:",e),e}}async function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;try{let o={days:t,dashboard_summary_response:!0};e&&(o.cluster_hashes=[e]);let r=await n.x.fetch("/cost_report",o);console.log("Raw cluster history data:",r);let a=r.map(e=>{let t="Unknown";e.cloud?t=e.cloud:e.resources&&e.resources.cloud&&(t=e.resources.cloud);let o=e.user_name||"-";return{status:e.status?c[e.status]:"TERMINATED",cluster:e.name,user:o,user_hash:e.user_hash,cluster_hash:e.cluster_hash,cloud:t,region:"",infra:t,full_infra:t,resources_str:e.resources_str,resources_str_full:e.resources_str_full,time:e.launched_at?new Date(1e3*e.launched_at):null,num_nodes:e.num_nodes||1,duration:e.duration,total_cost:e.total_cost,workspace:e.workspace||"default",autostop:-1,last_event:e.last_event,to_down:!1,cluster_name_on_cloud:null,usage_intervals:e.usage_intervals,command:e.last_creation_command||"",task_yaml:e.last_creation_yaml||"{}",events:[{time:e.launched_at?new Date(1e3*e.launched_at):new Date,event:"Cluster created."}]}});return console.log("Processed cluster history data:",a),a}catch(e){throw console.error("Error fetching cluster history:",e),e}}async function d(e){let{clusterName:t,jobId:o,onNewLog:r,workspace:s,signal:l}=e;try{await n.x.stream("/logs",{follow:!1,cluster_name:t,job_id:o,tail:5e3,override_skypilot_config:{active_workspace:s||"default"}},r,{signal:l})}catch(e){if((null==e?void 0:e.name)==="AbortError")return;console.error("Error in streamClusterJobLogs:",e),(0,a.C)("Error in streamClusterJobLogs: ".concat(e.message),"error")}}async function f(e){let{clusterName:t,jobIds:o=null,workspace:r}=e;try{let e=await n.x.fetch("/download_logs",{cluster_name:t,job_ids:o?o.map(String):null,override_skypilot_config:{active_workspace:r||"default"}}),l=Object.values(e||{});if(!l.length){(0,a.C)("No logs found to download.","warning");return}let c=window.location.origin,u="".concat(c).concat(s.f4,"/download"),i=await fetch("".concat(u,"?relative=items"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({folder_paths:l})});if(!i.ok){let e=await i.text();throw Error("Download failed: ".concat(i.status," ").concat(e))}let d=await i.blob(),f=window.URL.createObjectURL(d),g=document.createElement("a"),h=new Date().toISOString().replace(/[:.]/g,"-"),p=o&&1===o.length?"job-".concat(o[0]):"jobs";g.href=f,g.download="".concat(t,"-").concat(p,"-logs-").concat(h,".zip"),document.body.appendChild(g),g.click(),g.remove(),window.URL.revokeObjectURL(f)}catch(e){console.error("Error downloading logs:",e),(0,a.C)("Error downloading logs: ".concat(e.message),"error")}}async function g(e){let{clusterName:t,workspace:o}=e;try{return(await n.x.fetch("/queue",{cluster_name:t,all_users:!0,override_skypilot_config:{active_workspace:o}})).map(e=>{var r;let a=e.end_at?e.end_at:Date.now()/1e3,n=0,s=0;return e.submitted_at&&(n=a-e.submitted_at),e.start_at&&(s=a-e.start_at),{id:e.job_id,status:e.status,job:e.job_name,user:e.username,user_hash:e.user_hash,gpus:e.accelerators||{},submitted_at:e.submitted_at?new Date(1e3*e.submitted_at):null,resources:e.resources,cluster:t,total_duration:n,job_duration:s,infra:"",logs:"",workspace:o||"default",git_commit:(null===(r=e.metadata)||void 0===r?void 0:r.git_commit)||"-"}})}catch(e){throw console.error("Error fetching cluster jobs:",e),e}}function h(e){let{cluster:t,job:o=null}=e,[a,n]=(0,r.useState)(null),[s,c]=(0,r.useState)(null),[i,d]=(0,r.useState)(!0),[f,h]=(0,r.useState)(!0),p=(0,r.useCallback)(async()=>{if(t)try{d(!0);let e=await l.ZP.get(u,[{clusterNames:[t]}]);if(e.length>0)return n(e[0]),e[0];return console.error("No cluster data found for cluster:",t),null}catch(e){console.error("Error fetching cluster data:",e)}finally{d(!1)}return null},[t]),m=(0,r.useCallback)(async e=>{if(t)try{h(!0);let o=await l.ZP.get(g,[{clusterName:t,workspace:e||"default"}]);c(o)}catch(e){console.error("Error fetching cluster job data:",e)}finally{h(!1)}},[t]),_=(0,r.useCallback)(async()=>{l.ZP.invalidate(u,[{clusterNames:[t]}]);let e=await p();e&&(l.ZP.invalidate(g,[{clusterName:t,workspace:e.workspace||"default"}]),await m(e.workspace))},[p,m,t]),w=(0,r.useCallback)(async()=>{a&&(l.ZP.invalidate(g,[{clusterName:t,workspace:a.workspace||"default"}]),await m(a.workspace))},[m,a,t]);return(0,r.useEffect)(()=>{(async()=>{let e=await p();e&&m(e.workspace)})()},[t,o,p,m]),{clusterData:a,clusterJobData:s,loading:i,clusterDetailsLoading:i,clusterJobsLoading:f,refreshData:_,refreshClusterJobsOnly:w}}},32045:function(e,t,o){o.d(t,{CI:function(){return d},F5:function(){return m},R8:function(){return p},UU:function(){return f},Ve:function(){return y},Xg:function(){return i},ef:function(){return u},oD:function(){return c}});var r=o(93225),a=o(47145),n=o(94545),s=o(6378),l=o(30017);async function c(){let{getWorkspaces:e,getEnabledClouds:t}=await Promise.resolve().then(o.bind(o,17324));try{let o=await s.ZP.get(e).catch(()=>({})),a=Object.keys(o||{});if(0===a.length)return{clouds:[],totalClouds:r.$m.length,enabledClouds:0};let n=new Set;await Promise.all(a.map(async e=>{try{let o=await s.ZP.get(t,[e,!1]);Array.isArray(o)&&o.forEach(e=>{e&&n.add(e.toLowerCase())})}catch(t){console.error("Error fetching enabled clouds for workspace ".concat(e,":"),t)}}));let l=Array.from(n),c=r.$m.filter(e=>l.includes(e.toLowerCase())).map(e=>({name:e,enabled:!0})).sort((e,t)=>e.name.localeCompare(t.name));return{clouds:c,totalClouds:r.$m.length,enabledClouds:c.length}}catch(e){return console.error("Error fetching enabled clouds list:",e),{clouds:[],totalClouds:r.$m.length,enabledClouds:0}}}async function u(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];let{getClusters:e}=await Promise.resolve().then(o.bind(o,23266)),{getManagedJobs:t}=await Promise.resolve().then(o.bind(o,68969)),{getWorkspaces:a,getEnabledClouds:n}=await Promise.resolve().then(o.bind(o,17324));try{let[o,l,c]=await Promise.all([s.ZP.get(t,[{allUsers:!0,skipFinished:!0}]).catch(e=>(console.error("Error fetching managed jobs:",e),{jobs:[]})),s.ZP.get(e).catch(e=>(console.error("Error fetching clusters:",e),[])),s.ZP.get(a).catch(e=>(console.error("Error fetching workspaces:",e),{}))]),u=(null==o?void 0:o.jobs)||[],i=[],d=Object.keys(c||{});if(0===d.length)console.warn("No accessible workspaces found"),i=[];else{let e=new Set;await Promise.all(d.map(async t=>{try{let o=await s.ZP.get(n,[t,!1]);Array.isArray(o)&&o.forEach(t=>{t&&e.add(t.toLowerCase())})}catch(e){console.error("Error fetching enabled clouds for workspace ".concat(t,":"),e)}})),i=Array.from(e),console.log("Aggregated enabled clouds across all workspaces:",i)}let f={};r.$m.forEach(e=>{let t=i.includes(e.toLowerCase());f[e]={name:e,clusters:0,jobs:0,enabled:t}}),(l||[]).forEach(e=>{if(e.cloud){let t=e.cloud;f[t]&&(f[t].clusters+=1,f[t].enabled=!0)}}),u.forEach(e=>{if(e.cloud){let t=e.cloud;f[t]&&(f[t].jobs+=1,f[t].enabled=!0)}});let g=r.$m.length,h=Object.values(f).filter(e=>e.enabled).length;return{clouds:Object.values(f).filter(e=>e.enabled).sort((e,t)=>e.name.localeCompare(t.name)),totalClouds:g,enabledClouds:h}}catch(e){throw console.error("Error fetching cloud infrastructure:",e),e}}async function i(){try{console.log("[DEBUG] Starting workspace-aware infrastructure fetch");let{getWorkspaces:e}=await Promise.resolve().then(o.bind(o,17324));console.log("[DEBUG] About to call getWorkspaces() via cache");let t=await s.ZP.get(e);if(console.log("[DEBUG] Workspaces data received:",t),console.log("[DEBUG] Number of accessible workspaces:",Object.keys(t||{}).length),console.log("[DEBUG] Workspace names:",Object.keys(t||{})),!t||0===Object.keys(t).length)return console.log("[DEBUG] No accessible workspaces found - returning empty result"),{workspaces:{},allContextNames:[],allGPUs:[],perContextGPUs:[],perNodeGPUs:[],allSlurmGPUs:[],perClusterSlurmGPUs:[],perNodeSlurmGPUs:[],contextStats:{},contextWorkspaceMap:{},contextErrors:{}};let{getEnabledClouds:r}=await Promise.resolve().then(o.bind(o,17324)),a={},n=[],l={};await Promise.allSettled(Object.entries(t).map(async e=>{let[t,o]=e;console.log("Fetching infrastructure for workspace: ".concat(t));try{console.log("[DEBUG] Fetching enabled clouds for workspace: ".concat(t," via cache"));let e=await s.ZP.get(r,[t,!0]);console.log("[DEBUG] Expanded clouds for ".concat(t,":"),e),a[t]={config:o,clouds:e,contexts:[]},console.log("[DEBUG] Processing expandedClouds for ".concat(t,":"),e),e&&Array.isArray(e)?e.forEach(e=>{if(console.log("[DEBUG] Processing infraItem: ".concat(e)),e.toLowerCase().startsWith("kubernetes/")){let o=e.replace(/^kubernetes\//i,"");console.log("[DEBUG] Extracted kubernetes context: ".concat(o)),n.push(o),l[o]||(l[o]=[]),l[o].includes(t)||l[o].push(t),a[t].contexts.push(o)}else if(e.toLowerCase().startsWith("ssh/")){let o=e.replace(/^ssh\//i,""),r="ssh-".concat(o);console.log("[DEBUG] Extracted SSH context: ".concat(r)),n.push(r),l[r]||(l[r]=[]),l[r].includes(t)||l[r].push(t),a[t].contexts.push(r)}}):console.log("[DEBUG] No expanded clouds or not an array for ".concat(t))}catch(e){throw console.error("Failed to fetch infrastructure for workspace ".concat(t,":"),e),e}}));let{getClusters:c}=await Promise.resolve().then(o.bind(o,23266)),u=[];try{u=await s.ZP.get(c)}catch(e){console.error("Error fetching clusters:",e)}let i=u||[],d={};try{d=await m(i)}catch(e){console.error("Error fetching context clusters:",e)}let f=[...new Set(n)].filter(e=>e&&"string"==typeof e),h={allGPUs:[],perContextGPUs:[],perNodeGPUs:[],contextErrors:{}};try{h=await g(f)}catch(e){console.error("Error fetching Kubernetes GPUs:",e)}let p={workspaces:a,allContextNames:[...new Set(n)].sort(),allGPUs:h.allGPUs||[],perContextGPUs:h.perContextGPUs||[],perNodeGPUs:h.perNodeGPUs||[],contextStats:d,contextWorkspaceMap:l,contextErrors:h.contextErrors||{}};return console.log("[DEBUG] Final result:",p),console.log("[DEBUG] All contexts found:",n),console.log("[DEBUG] Context workspace map:",l),p}catch(e){throw console.error("[DEBUG] Failed to fetch workspace infrastructure:",e),console.error("[DEBUG] Error stack:",e.stack),e}}async function d(){try{let{getWorkspaces:e}=await Promise.resolve().then(o.bind(o,17324)),t=await s.ZP.get(e);if(!t||0===Object.keys(t).length)return{workspaces:{},allContextNames:[],contextWorkspaceMap:{}};let{getEnabledClouds:r}=await Promise.resolve().then(o.bind(o,17324)),a={},n=[],l={};return await Promise.allSettled(Object.entries(t).map(async e=>{let[t,o]=e;try{let e=await s.ZP.get(r,[t,!0]);a[t]={config:o,clouds:e,contexts:[]},e&&Array.isArray(e)&&e.forEach(e=>{if(e.toLowerCase().startsWith("kubernetes/")){let o=e.replace(/^kubernetes\//i,"");n.push(o),l[o]||(l[o]=[]),l[o].includes(t)||l[o].push(t),a[t].contexts.push(o)}else if(e.toLowerCase().startsWith("ssh/")){let o=e.replace(/^ssh\//i,""),r="ssh-".concat(o);n.push(r),l[r]||(l[r]=[]),l[r].includes(t)||l[r].push(t),a[t].contexts.push(r)}})}catch(e){console.error("Failed to fetch infrastructure for workspace ".concat(t,":"),e)}})),{workspaces:a,allContextNames:[...new Set(n)].sort(),contextWorkspaceMap:l}}catch(e){throw console.error("Failed to fetch workspace contexts:",e),e}}async function f(e){try{let l=await h(e),c={},u=[];if(l&&Object.keys(l).length>0)for(let i in l){var t,o,r,a,n,s;let d=l[i];if(!d)continue;let f=d.accelerator_type||"-",g=(null===(t=d.total)||void 0===t?void 0:t.accelerator_count)||0,h=(null===(o=d.free)||void 0===o?void 0:o.accelerators_available)||0,p=!1!==d.is_ready;u.push({node_name:d.name||i,gpu_name:f,gpu_total:g,gpu_free:h,is_ready:p,context:e,ip_address:d.ip_address||null,cpu_count:null!==(r=d.cpu_count)&&void 0!==r?r:null,memory_gb:null!==(a=d.memory_gb)&&void 0!==a?a:null,cpu_free:null!==(n=d.cpu_free)&&void 0!==n?n:null,memory_free_gb:null!==(s=d.memory_free_gb)&&void 0!==s?s:null}),g>0&&(c[f]||(c[f]={gpu_name:f,gpu_requestable_qty_per_node:0,gpu_total:0,gpu_free:0,gpu_not_ready:0,context:e}),c[f].gpu_total+=g,c[f].gpu_free+=h,p||(c[f].gpu_not_ready+=g),c[f].gpu_requestable_qty_per_node=g)}return{context:e,perContextGPUs:Object.values(c),perNodeGPUs:u,error:null}}catch(o){let t=(null==o?void 0:o.message)||"string"==typeof o&&o||"Context may be unavailable or timed out";return console.warn("Failed to get GPU data for context ".concat(e,":"),t),{context:e,perContextGPUs:[],perNodeGPUs:[],error:t}}}async function g(e){try{var t,o,r,a,n,s,l,c,u,i,d;if(!e||0===e.length)return{allGPUs:[],perContextGPUs:[],perNodeGPUs:[],contextErrors:{}};let f={},g={},p={},m={},_=await Promise.allSettled(e.map(e=>h(e))),w={};for(let o=0;o<e.length;o++){let r=_[o];if("fulfilled"===r.status)w[e[o]]=r.value,console.log("[CONTEXT_DEBUG] Context node info result:",e[o],r.value);else{let a=(null===(t=r.reason)||void 0===t?void 0:t.message)||"string"==typeof r.reason&&r.reason||"Context may be unavailable or timed out";console.warn("Failed to get node info for context ".concat(e[o],":"),a),w[e[o]]={},m[e[o]]=a}}for(let t of e){let e=w[t]||{};if(e&&Object.keys(e).length>0){let a={};for(let n in e){let s=e[n];if(!s){console.warn("No node data for node ".concat(n," in context ").concat(t));continue}let l=s.accelerator_type||"-",c=(null===(o=s.total)||void 0===o?void 0:o.accelerator_count)||0,u=(null===(r=s.free)||void 0===r?void 0:r.accelerators_available)||0,i=!1!==s.is_ready;c>0&&(a[l]||(a[l]={gpu_name:l,gpu_requestable_qty_per_node:0,gpu_total:0,gpu_free:0,gpu_not_ready:0,context:t}),a[l].gpu_total+=c,a[l].gpu_free+=u,!1===i&&(a[l].gpu_not_ready+=c),a[l].gpu_requestable_qty_per_node=c)}for(let e in g[t]=Object.values(a),a)e in f?(f[e].gpu_total+=a[e].gpu_total,f[e].gpu_free+=a[e].gpu_free,f[e].gpu_not_ready+=a[e].gpu_not_ready):f[e]={gpu_total:a[e].gpu_total,gpu_free:a[e].gpu_free,gpu_not_ready:a[e].gpu_not_ready,gpu_name:e}}else g[t]=[]}for(let t of e){let e=w[t];if(e&&Object.keys(e).length>0)for(let o in e){let r=e[o];if(!r){console.warn("No node data for node ".concat(o," in context ").concat(t));continue}let h=r.accelerator_type||"-",m=null!==(s=null===(a=r.total)||void 0===a?void 0:a.accelerator_count)&&void 0!==s?s:0,_=null!==(l=null===(n=r.free)||void 0===n?void 0:n.accelerators_available)&&void 0!==l?l:0,w=!1!==r.is_ready,y=null!==(c=r.cpu_count)&&void 0!==c?c:null,P=null!==(u=r.memory_gb)&&void 0!==u?u:null,b=null!==(i=r.cpu_free)&&void 0!==i?i:null,v=null!==(d=r.memory_free_gb)&&void 0!==d?d:null;p["".concat(t,"/").concat(o)]={node_name:r.name||o,gpu_name:h,gpu_total:m,gpu_free:_,ip_address:r.ip_address||null,context:t,cpu_count:y,memory_gb:P,cpu_free:b,memory_free_gb:v,is_ready:w},"-"===h||!g[t]||g[t].some(e=>e.gpu_name===h)||(h in f||(f[h]={gpu_total:0,gpu_free:0,gpu_not_ready:0,gpu_name:h}),g[t].find(e=>e.gpu_name===h)||g[t].push({gpu_name:h,gpu_not_ready:0,gpu_requestable_qty_per_node:"-",gpu_total:0,gpu_free:0,context:t}))}}return console.log("[CONTEXT_DEBUG] All GPUs summary:",f),console.log("[CONTEXT_DEBUG] Per context GPUs data:",g),console.log("[CONTEXT_DEBUG] Per node GPUs data:",p),console.log("[CONTEXT_DEBUG] Context errors:",m),{allGPUs:Object.values(f).sort((e,t)=>(e.gpu_name||"").localeCompare(t.gpu_name||"")),perContextGPUs:Object.values(g).flat().sort((e,t)=>(e.context||"").localeCompare(t.context||"")||(e.gpu_name||"").localeCompare(t.gpu_name||"")),perNodeGPUs:Object.values(p).sort((e,t)=>(e.context||"").localeCompare(t.context||"")||(e.node_name||"").localeCompare(t.node_name||"")||(e.gpu_name||"").localeCompare(t.gpu_name||"")),contextErrors:m}}catch(e){throw console.error("[infra.jsx] Error in getKubernetesGPUsFromContexts:",e),e}}async function h(e){try{let t=await a.x.post("/kubernetes_node_info",{context:e});if(!t.ok){let o="Failed to get kubernetes node info for context ".concat(e," with status ").concat(t.status,", error: ").concat(t.statusText);throw Error(o)}let o=t.headers.get("X-Skypilot-Request-ID")||t.headers.get("x-request-id");if(!o)throw Error("No request ID received from server for kubernetes node info");let r=await a.x.get("/api/get?request_id=".concat(o));if(!r.ok){let t=await (0,n.oN)(r),o="Failed to get kubernetes node info result for context ".concat(e," with status ").concat(r.status,", error: ").concat(t);throw Error(o)}let s=await r.json();return(s.return_value?JSON.parse(s.return_value):{}).node_info_dict||{}}catch(t){throw console.warn("[infra.jsx] Context ".concat(e," unavailable or timed out:"),t.message),t}}async function p(e){try{let t={};return e.forEach(e=>{let o=(0,l.y)(e.cloud,e.region);o&&(t[o]||(t[o]={clusters:0,jobs:0}),t[o].jobs+=1)}),t}catch(e){throw console.error("=== Error in getContextJobs ===",e),e}}async function m(e){try{let t={};return e.forEach(e=>{let o=(0,l.y)(e.cloud,e.region);o&&(t[o]||(t[o]={clusters:0,jobs:0}),t[o].clusters+=1)}),t}catch(e){throw console.error("=== Error in getContextClusters ===",e),e}}async function _(){try{let e=await a.x.post("/slurm_gpu_availability",{});if(!e.ok){let t="Failed to get slurm cluster GPUs with status ".concat(e.status);throw Error(t)}let t=e.headers.get("X-Skypilot-Request-ID")||e.headers.get("x-request-id");if(!t)throw Error("No request ID received from server for slurm cluster GPUs");let o=await a.x.get("/api/get?request_id=".concat(t));if(500===o.status){try{let e=await o.json();if(e.detail&&e.detail.error)try{let t=JSON.parse(e.detail.error);console.error("Error fetching Slurm cluster GPUs:",t.message)}catch(e){console.error("Error parsing JSON for Slurm error:",e)}}catch(e){console.error("Error parsing JSON for Slurm 500 response:",e)}return[]}if(!o.ok){let e="Failed to get slurm cluster GPUs result with status ".concat(o.status);throw Error(e)}let r=await o.json();return r.return_value?JSON.parse(r.return_value):[]}catch(e){return console.error("Error fetching Slurm cluster GPUs:",e),[]}}async function w(){try{let e=await a.x.post("/slurm_node_info",{});if(!e.ok){let t="Failed to get slurm node info with status ".concat(e.status);throw Error(t)}let t=e.headers.get("X-Skypilot-Request-ID")||e.headers.get("x-request-id");if(!t)throw Error("No request ID received from server for slurm node info");let o=await a.x.get("/api/get?request_id=".concat(t));if(500===o.status){try{let e=await o.json();if(e.detail&&e.detail.error)try{let t=JSON.parse(e.detail.error);console.error("Error fetching Slurm per node GPUs:",t.message)}catch(e){console.error("Error parsing JSON for Slurm node error:",e)}}catch(e){console.error("Error parsing JSON for Slurm node 500 response:",e)}return[]}if(!o.ok){let e="Failed to get slurm node info result with status ".concat(o.status);throw Error(e)}let r=await o.json();return r.return_value?JSON.parse(r.return_value):[]}catch(e){return console.error("Error fetching Slurm per node GPUs:",e),[]}}async function y(){return await P()}async function P(){try{let[e,t]=await Promise.all([_(),w()]),o={},r={},a={};for(let t of e){let e=t[0];for(let a of t[1]){let t=a[0],n=a[1].join(", "),s=a[2],l=a[3];t in o?(o[t].gpu_total+=s,o[t].gpu_free+=l):o[t]={gpu_total:s,gpu_free:l,gpu_name:t},r["".concat(e,"#").concat(t)]={gpu_name:t,gpu_requestable_qty_per_node:n,gpu_total:s,gpu_free:l,cluster:e}}}for(let e of t){let t=e.slurm_cluster_name||"default";a["".concat(t,"/").concat(e.node_name,"/").concat(e.gpu_type||"-")]={node_name:e.node_name,gpu_name:e.gpu_type||"-",gpu_total:e.total_gpus||0,gpu_free:e.free_gpus||0,cluster:t,partition:e.partition||"default"}}return{allSlurmGPUs:Object.values(o).sort((e,t)=>e.gpu_name.localeCompare(t.gpu_name)),perClusterSlurmGPUs:Object.values(r).sort((e,t)=>e.cluster.localeCompare(t.cluster)||e.gpu_name.localeCompare(t.gpu_name)),perNodeSlurmGPUs:Object.values(a).sort((e,t)=>(e.cluster||"").localeCompare(t.cluster||"")||(e.node_name||"").localeCompare(t.node_name||"")||(e.gpu_name||"").localeCompare(t.gpu_name||""))}}catch(e){return console.error("Error fetching Slurm GPUs:",e),{allSlurmGPUs:[],perClusterSlurmGPUs:[],perNodeSlurmGPUs:[]}}}},29326:function(e,t,o){o.d(t,{IS:function(){return d},It:function(){return n},MV:function(){return l},Ri:function(){return s},_x:function(){return u},ez:function(){return i},hY:function(){return c},mF:function(){return g},wJ:function(){return f}});var r=o(93225),a=o(15821);async function n(){try{let e=await fetch("".concat(r.f4,"/ssh_node_pools"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return await e.json()}catch(e){return console.error("Error fetching SSH Node Pools:",e),{}}}async function s(e){try{let t=await fetch("".concat(r.f4,"/ssh_node_pools"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}catch(e){throw console.error("Error updating SSH Node Pools:",e),e}}async function l(e){try{let t=await fetch("".concat(r.f4,"/ssh_node_pools/").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}catch(e){throw console.error("Error deleting SSH Node Pool:",e),e}}async function c(e,t){try{let o=new FormData;o.append("key_name",e),o.append("key_file",t);let a=await fetch("".concat(r.f4,"/ssh_node_pools/keys"),{method:"POST",body:o});if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));return await a.json()}catch(e){throw console.error("Error uploading SSH key:",e),e}}async function u(e){try{let t=await fetch("".concat(r.f4,"/ssh_node_pools/").concat(e,"/deploy"),{method:"POST",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}catch(e){throw console.error("Error deploying SSH Node Pool:",e),e}}async function i(e){try{let t=await fetch("".concat(r.f4,"/ssh_node_pools/").concat(e,"/down"),{method:"POST",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}catch(e){throw console.error("Error tearing down SSH Node Pool:",e),e}}async function d(e){try{let t=await fetch("".concat(r.f4,"/ssh_node_pools/").concat(e,"/status"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}catch(e){throw console.error("Error fetching SSH Node Pool status:",e),e}}async function f(e){let t,{requestId:o,signal:n,onNewLog:s}=e,l=Date.now(),c=new Promise(e=>{let o=()=>{let r=Date.now()-l;r>=3e5?e({timeout:!0}):t=setTimeout(o,3e5-r)};t=setTimeout(o,3e5)}),u=(async()=>{try{let e=await fetch("".concat(r.f4,"/api/stream?request_id=").concat(o,"&format=plain&tail=").concat(1e3,"&follow=true"),{method:"GET",headers:{"Content-Type":"application/json"},...n?{signal:n}:{}});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let a=e.body.getReader();try{for(;;){let{done:e,value:t}=await a.read();if(e)break;l=Date.now();let o=new TextDecoder().decode(t);s(o)}}finally{a.cancel(),t&&clearTimeout(t)}return{timeout:!1}}catch(e){if(t&&clearTimeout(t),"AbortError"===e.name)return{timeout:!1};throw e}})(),i=await Promise.race([u,c]);if(t&&clearTimeout(t),i.timeout){(0,a.C)("SSH deployment log stream timed out after ".concat(300,"s of inactivity"),"warning");return}}async function g(e){let t,{requestId:o,signal:n,onNewLog:s,operationType:l="operation"}=e,c=Date.now(),u=new Promise(e=>{let o=()=>{let r=Date.now()-c;r>=3e5?e({timeout:!0}):t=setTimeout(o,3e5-r)};t=setTimeout(o,3e5)}),i=(async()=>{try{let e=await fetch("".concat(r.f4,"/api/stream?request_id=").concat(o,"&format=plain&tail=").concat(1e3,"&follow=true"),{method:"GET",headers:{"Content-Type":"application/json"},...n?{signal:n}:{}});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let a=e.body.getReader();try{for(;;){let{done:e,value:t}=await a.read();if(e)break;c=Date.now();let o=new TextDecoder().decode(t);s(o)}}finally{a.cancel(),t&&clearTimeout(t)}return{timeout:!1}}catch(e){if(t&&clearTimeout(t),"AbortError"===e.name)return{timeout:!1};throw e}})(),d=await Promise.race([i,u]);if(t&&clearTimeout(t),d.timeout){(0,a.C)("SSH ".concat(l," log stream timed out after ").concat(300,"s of inactivity"),"warning");return}}},53081:function(e,t,o){o.d(t,{R:function(){return n},i:function(){return a}});var r=o(47145);async function a(){try{let e=await r.x.get("/users/service-account-tokens");if(!e.ok)throw Error("Failed to fetch service account tokens with status ".concat(e.status));return await e.json()||[]}catch(e){throw console.error("Failed to fetch service account tokens:",e),e}}async function n(){try{let e=await r.x.get("/users");if(!e.ok)throw Error("Failed to fetch users with status ".concat(e.status));return(await e.json()).map(e=>({userId:e.id,username:e.name,role:e.role,created_at:e.created_at}))||[]}catch(e){throw console.error("Failed to fetch users:",e),e}}},19238:function(e,t,o){o.d(t,{C:function(){return n},w:function(){return s}});var r=o(47145),a=o(94545);async function n(){try{return(await r.x.fetch("/volumes",{},"GET")).map(e=>{var t,o,r;let a=e.cloud||"";return e.region&&(a+="/".concat(e.region)),e.zone&&(a+="/".concat(e.zone)),{name:e.name,launched_at:e.launched_at,user_hash:e.user_hash,user_name:e.user_name||"-",workspace:e.workspace||"-",last_attached_at:e.last_attached_at,status:e.status,type:e.type,cloud:e.cloud,region:e.region,zone:e.zone,infra:a,size:"".concat(e.size,"Gi"),config:e.config,storage_class:(null===(t=e.config)||void 0===t?void 0:t.storage_class_name)||"-",access_mode:(null===(o=e.config)||void 0===o?void 0:o.access_mode)||"-",namespace:(null===(r=e.config)||void 0===r?void 0:r.namespace)||"-",name_on_cloud:e.name_on_cloud,usedby_pods:e.usedby_pods,usedby_clusters:e.usedby_clusters}})||[]}catch(e){throw console.error("Failed to fetch volumes:",e),e}}async function s(e){let t="";try{let o=await r.x.post("/volumes/delete",{names:[e]});if(!o.ok)return console.error("Initial API request to delete volume failed with status ".concat(o.status)),{success:!1,msg:"Failed to delete volume with status ".concat(o.status)};let n=o.headers.get("X-SkyPilot-Request-ID")||o.headers.get("X-Request-ID");if(!n)return console.error("No request ID received from server for deleting volume"),{success:!1,msg:"No request ID received from server for deleting volume"};let s=await r.x.get("/api/get?request_id=".concat(n));if(!s.ok){let e=await (0,a.oN)(s);return t="Failed to delete volume with status ".concat(s.status,", error: ").concat(e),console.error(t),{success:!1,msg:t}}return{success:!0}}catch(e){return console.error(t="Failed to delete volume: ".concat(e)),{success:!1,msg:t}}}},23001:function(e,t,o){o.d(t,{X:function(){return a}});var r=o(67294);function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:768,[t,o]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{let t=()=>{o(window.innerWidth<e)};return t(),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[e]),t}},36856:function(e,t,o){var r=o(6378),a=o(23266),n=o(68969),s=o(17324),l=o(53081),c=o(19238),u=o(32045),i=o(29326);let d={base:{getClusters:{fn:a.getClusters,args:[]},getManagedJobs:{fn:n.aT,args:[{allUsers:!0}]},getManagedJobsForOtherPages:{fn:n.getManagedJobs,args:[{allUsers:!0,skipFinished:!0}]},getWorkspaces:{fn:s.getWorkspaces,args:[]},getUsers:{fn:l.R,args:[]},getEnabledCloudsList:{fn:u.oD,args:[]},getWorkspaceContexts:{fn:u.CI,args:[]},getSlurmInfrastructure:{fn:u.Ve,args:[]},getSSHNodePools:{fn:i.It,args:[]},getVolumes:{fn:c.C,args:[]}},dynamic:{getEnabledClouds:{fn:s.getEnabledClouds,requiresWorkspaces:!0},getContextGPUDataForAllContexts:{fn:u.UU,requiresContexts:!0}},pages:{clusters:["getClusters","getWorkspaces"],jobs:["getManagedJobs","getClusters","getWorkspaces","getUsers"],infra:[],workspaces:["getWorkspaces","getClusters","getManagedJobsForOtherPages","getEnabledClouds"],users:["getUsers","getClusters","getManagedJobsForOtherPages"],volumes:["getVolumes"]}};class f{async preloadForPage(e,t){let{backgroundPreload:o=!0,force:r=!1}=t||{};if(!d.pages[e]){console.warn("Unknown page: ".concat(e));return}console.log("[CachePreloader] Preloading cache for page: ".concat(e));try{await this._loadPageData(e,r),o&&this._backgroundPreloadOtherPages(e)}catch(t){console.error("[CachePreloader] Error preloading for page ".concat(e,":"),t)}}async _loadPageData(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=d.pages[e],a=[];for(let e of o)if(d.base[e]){let{fn:o,args:n}=d.base[e];t&&r.ZP.invalidate(o,n),a.push(r.ZP.get(o,n).then(e=>(this._markAsPreloaded(o,n),e)))}else"getEnabledClouds"===e?a.push(this._loadEnabledCloudsForAllWorkspaces(t)):"getContextGPUDataForAllContexts"===e&&a.push(this._loadContextGPUDataForAllContexts(t));await Promise.allSettled(a),console.log("[CachePreloader] Loaded data for page: ".concat(e))}async _loadEnabledCloudsForAllWorkspaces(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{e&&r.ZP.invalidate(s.getWorkspaces);let t=await r.ZP.get(s.getWorkspaces),o=Object.keys(t||{}).map(t=>(e&&r.ZP.invalidate(s.getEnabledClouds,[t]),r.ZP.get(s.getEnabledClouds,[t])));await Promise.allSettled(o)}catch(e){console.error("[CachePreloader] Error loading enabled clouds:",e)}}async _loadContextGPUDataForAllContexts(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{e&&r.ZP.invalidate(u.CI);let t=await r.ZP.get(u.CI);if(!t||!t.allContextNames)return;let o=t.allContextNames.filter(e=>e&&!e.startsWith("ssh-")).map(t=>(e&&r.ZP.invalidate(u.UU,[t]),r.ZP.get(u.UU,[t])));await Promise.allSettled(o)}catch(e){console.error("[CachePreloader] Error loading context GPU data:",e)}}_backgroundPreloadOtherPages(e){if(this.isPreloading)return;this.isPreloading=!0;let t=new Set(d.pages[e]),o=new Set;Object.keys(d.pages).filter(t=>t!==e).forEach(e=>{d.pages[e].forEach(e=>{t.has(e)||o.add(e)})}),"infra"!==e&&(o.add("getClusters"),o.add("getManagedJobsForOtherPages"),o.add("getEnabledCloudsList"),o.add("getWorkspaceContexts"),o.add("getSlurmInfrastructure"),o.add("getSSHNodePools"),o.add("getContextGPUDataForAllContexts")),console.log("[CachePreloader] Background preloading ".concat(o.size," unique functions: ").concat(Array.from(o).join(", "))),Promise.allSettled(Array.from(o).map(async e=>{try{if(d.base[e]){let{fn:t,args:o}=d.base[e];await r.ZP.get(t,o),this._markAsPreloaded(t,o)}else"getEnabledClouds"===e?await this._loadEnabledCloudsForAllWorkspaces(!1):"getContextGPUDataForAllContexts"===e&&await this._loadContextGPUDataForAllContexts(!1);console.log("[CachePreloader] Background loaded function: ".concat(e))}catch(t){console.error("[CachePreloader] Background load failed for function ".concat(e,":"),t)}})).then(()=>{this.isPreloading=!1,console.log("[CachePreloader] Background preloading complete")})}async preloadBaseFunctions(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];console.log("[CachePreloader] Preloading all base functions");let t=Object.entries(d.base).map(t=>{let[o,{fn:a,args:n}]=t;return e&&r.ZP.invalidate(a,n),r.ZP.get(a,n).catch(e=>{console.error("[CachePreloader] Failed to preload ".concat(o,":"),e)})});await Promise.allSettled(t),console.log("[CachePreloader] Base functions preloaded")}getCacheStats(){return{...r.ZP.getStats(),isPreloading:this.isPreloading}}wasRecentlyPreloaded(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=this._generateKey(e,t),r=this.recentlyPreloaded.get(o);if(!r)return!1;let a=Date.now()-r<this.PRELOAD_GRACE_PERIOD;return a||this.recentlyPreloaded.delete(o),a}_markAsPreloaded(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=this._generateKey(e,t);this.recentlyPreloaded.set(o,Date.now())}_generateKey(e,t){let o=e.toString(),r=this._simpleHash(o),a=t.length>0?JSON.stringify(t):"";return"".concat(r,"_").concat(a)}_simpleHash(e){let t=5381;for(let o=0;o<e.length;o++)t=(t<<5)+t+e.charCodeAt(o);return t>>>0}clearCache(){r.ZP.clear(),this.isPreloading=!1,this.preloadPromises.clear(),this.recentlyPreloaded.clear(),console.log("[CachePreloader] Cache cleared")}constructor(){this.isPreloading=!1,this.preloadPromises=new Map,this.recentlyPreloaded=new Map,this.PRELOAD_GRACE_PERIOD=5e3}}let g=new f;r.ZP.setPreloader(g),t.ZP=g},30017:function(e,t,o){function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return null;let{isSSH:o,isSlurm:r,cloud:a}=t,n=null;n=o||"SSH"===a?"ssh":r||(null==a?void 0:a.toLowerCase())==="slurm"?"slurm":"Kubernetes"===a?"kubernetes":e.startsWith("ssh-")?"ssh":"kubernetes";let s=e;return"ssh"===n&&(s=e.replace(/^ssh-/,"")),"".concat(n,"/").concat(s)}function a(e,t){return e&&t?r(t,{cloud:e}):null}o.d(t,{G:function(){return r},y:function(){return a}})}}]);