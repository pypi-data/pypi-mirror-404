"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2109],{16826:function(e,s,t){t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(60998).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},20546:function(e,s,t){t.d(s,{H:function(){return d}});var a=t(85893);t(67294);var n=t(41664),r=t.n(n),l=t(45697),i=t.n(l);function c(e){return!!e&&"string"==typeof e&&e.toLowerCase().startsWith("sa-")}let o=()=>(0,a.jsx)("span",{className:"px-2 py-0.5 text-xs bg-blue-100 text-blue-700 rounded font-medium ml-1",children:"SA"}),d=e=>{let{username:s,userHash:t,className:n="flex items-center gap-1",linkClassName:l="text-gray-700 hover:text-blue-600 hover:underline",showBadge:i=!0}=e,d=c(t),h=c(t)?"/users?tab=service-accounts":"/users";return(0,a.jsxs)("div",{className:n,children:[(0,a.jsx)(r(),{href:h,className:l,children:s}),i&&d&&(0,a.jsx)(o,{})]})};d.propTypes={username:i().string.isRequired,userHash:i().string,className:i().string,linkClassName:i().string,showBadge:i().bool}},92128:function(e,s,t){t.d(s,{Oh:function(){return u},_R:function(){return x},cV:function(){return m}});var a=t(85893),n=t(67294),r=t(50326),l=t(30803),i=t(37673),c=t(27325),o=t(36989),d=t(93225),h=t(23001);function u(e){let{isOpen:s,onClose:t,cluster:d}=e,[h,u]=n.useState(!1),x=e=>{navigator.clipboard.writeText(e),u(!0),setTimeout(()=>u(!1),2e3)},m=["sky status ".concat(d),"ssh ".concat(d)],j=m.join("\n");return(0,a.jsx)(r.Vq,{open:s,onOpenChange:t,children:(0,a.jsxs)(r.cZ,{className:"sm:max-w-md",children:[(0,a.jsxs)(r.fK,{children:[(0,a.jsxs)(r.$N,{children:["Connect to: ",(0,a.jsx)("span",{className:"font-light",children:d})]}),(0,a.jsx)(r.Be,{children:"Use these instructions to connect to your cluster via SSH."})]}),(0,a.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium mb-2",children:"SSH Command"}),(0,a.jsx)(i.Zb,{className:"p-3 bg-gray-50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("pre",{className:"text-sm w-full whitespace-pre-wrap",children:m.map((e,s)=>(0,a.jsx)("code",{className:"block",children:e},s))}),(0,a.jsx)(o.WH,{content:h?"Copied!":"Copy command",children:(0,a.jsx)(l.z,{variant:"ghost",size:"icon",onClick:()=>x(j),className:"h-8 w-8 rounded-full",children:(0,a.jsx)(c.Z,{className:"h-4 w-4"})})})]})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium mb-2",children:"Additional Information"}),(0,a.jsxs)("p",{className:"text-sm text-secondary-foreground",children:["Make sure to run"," ",(0,a.jsxs)("code",{className:"text-sm",children:["sky status ",d]})," first to have SkyPilot set up the SSH access."]})]})]})]})})}function x(e){let{isOpen:s,onClose:t,cluster:n}=e,u=(0,h.X)();return(0,a.jsx)(r.Vq,{open:s,onOpenChange:t,children:(0,a.jsx)(r.cZ,{className:"sm:max-w-3xl",children:(0,a.jsxs)(r.fK,{children:[(0,a.jsxs)(r.$N,{children:["Connect to: ",(0,a.jsx)("span",{className:"font-light",children:n})]}),(0,a.jsx)(r.Be,{children:(0,a.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium mb-2 my-2",children:"Setup SSH access"}),(0,a.jsx)(i.Zb,{className:"p-3 bg-gray-50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("pre",{className:"text-sm",children:(0,a.jsxs)("code",{children:["sky status ",n]})}),(0,a.jsx)(o.WH,{content:"Copy command",children:(0,a.jsx)(l.z,{variant:"ghost",size:"icon",onClick:()=>navigator.clipboard.writeText("sky status ".concat(n)),className:"h-8 w-8 rounded-full",children:(0,a.jsx)(c.Z,{className:"h-4 w-4"})})})]})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium mb-2 my-2",children:"Connect with VSCode/Cursor"}),(0,a.jsx)(i.Zb,{className:"p-3 bg-gray-50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("pre",{className:"text-sm",children:(0,a.jsxs)("code",{children:["code --remote ssh-remote+",n,' "/home"']})}),(0,a.jsx)(o.WH,{content:"Copy command",children:(0,a.jsx)(l.z,{variant:"ghost",size:"icon",onClick:()=>navigator.clipboard.writeText("code --remote ssh-remote+".concat(n,' "/home"')),className:"h-8 w-8 rounded-full",children:(0,a.jsx)(c.Z,{className:"h-4 w-4"})})})]})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium",children:"Or use the GUI to connect"}),(0,a.jsx)("div",{className:"relative ".concat(u?"-mt-5":"-mt-10"),style:{paddingBottom:"70%"},children:(0,a.jsxs)("video",{className:"absolute top-0 left-0 w-full h-full rounded-lg",controls:!0,autoPlay:!0,muted:!0,preload:"metadata",children:[(0,a.jsx)("source",{src:"".concat(d.GW,"/videos/cursor-small.mp4"),type:"video/mp4"}),"Your browser does not support the video tag."]})})]})]})})]})})})}function m(e){let{isOpen:s,onClose:t,onConfirm:n,title:i,message:c,confirmText:o="Confirm",confirmVariant:d="destructive",confirmClassName:h=null}=e;return(0,a.jsx)(r.Vq,{open:s,onOpenChange:t,children:(0,a.jsxs)(r.cZ,{className:"sm:max-w-md",children:[(0,a.jsxs)(r.fK,{children:[(0,a.jsx)(r.$N,{children:i}),(0,a.jsx)(r.Be,{children:c})]}),(0,a.jsxs)(r.cN,{className:"flex justify-end gap-2 pt-4",children:[(0,a.jsx)(l.z,{variant:"outline",onClick:t,children:"Cancel"}),(0,a.jsx)(l.z,{variant:h?void 0:d,className:h,onClick:()=>{n(),t()},children:o})]})]})})}},2109:function(e,s,t){t.r(s),t.d(s,{ClusterJobs:function(){return H},ManagedJobs:function(){return T},ManagedJobsTable:function(){return U},Status2Actions:function(){return W},filterJobsByName:function(){return I},filterJobsByPool:function(){return z},filterJobsByUser:function(){return Z},filterJobsByWorkspace:function(){return P},statusGroups:function(){return F}});var a=t(85893),n=t(67294),r=t(11163),l=t(41664),i=t.n(l),c=t(55739),o=t(30803),d=t(37673),h=t(68764),u=t(36989),x=t(51214),m=t(68969),j=t(6378);class p{_generateFilterKey(e){let{allUsers:s=!0,nameMatch:t,userMatch:a,workspaceMatch:n,poolMatch:r,statuses:l}=e;return["allUsers:".concat(s),t?"name:".concat(t):"",a?"user:".concat(a):"",n?"workspace:".concat(n):"",r?"pool:".concat(r):"",l&&l.length>0?"statuses:".concat(l.sort().join(",")):""].filter(Boolean).join("|")||"default"}_getCacheStatus(e){let s=this.fullDataCache.get(e),t=Date.now();if(!s)return{isCached:!1,isFresh:!1,age:0,maxAge:12e4,hasData:!1};let a=t-s.timestamp;return{isCached:!0,isFresh:a<12e4,age:a,maxAge:12e4,hasData:s.jobs&&Array.isArray(s.jobs),data:s}}async getPaginatedJobs(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{page:s=1,limit:t=10,...a}=e,n=this._generateFilterKey(a);try{let e=this._getCacheStatus(n);if(e.isCached&&e.hasData){let r=e.data;if(!r.jobs||Array.isArray(r.jobs)&&0===r.jobs.length){if(!this.prefetching.has(n)){let e=this._loadFullDataset(a,n).catch(()=>{}).finally(()=>this.prefetching.delete(n));this.prefetching.set(n,e)}}else{let l=(s-1)*t,i=r.jobs.slice(l,l+t);if(!this.prefetching.has(n)&&(!e.isFresh||e.age>e.maxAge/2)){let e=this._loadFullDataset(a,n).catch(()=>{}).finally(()=>this.prefetching.delete(n));this.prefetching.set(n,e)}return{jobs:i,total:r.total,totalNoFilter:r.totalNoFilter||r.total,controllerStopped:r.controllerStopped,statusCounts:r.statusCounts||{},fromCache:!0,cacheStatus:e.isFresh?"local_cache_hit":"local_cache_stale_hit"}}}let r=await j.ZP.get(m.getManagedJobs,[{...a,page:s,limit:t}]),l=(null==r?void 0:r.jobs)||[],i="number"==typeof(null==r?void 0:r.total)?r.total:l.length,c=!!(null==r?void 0:r.controllerStopped);if(!this.prefetching.has(n)){let e=this._loadFullDataset(a,n).catch(e=>{console.warn("Background prefetch of full jobs failed:",e)}).finally(()=>{this.prefetching.delete(n)});this.prefetching.set(n,e)}return{jobs:l,total:i,totalNoFilter:(null==r?void 0:r.totalNoFilter)||i,controllerStopped:c,statusCounts:(null==r?void 0:r.statusCounts)||{},fromCache:!1,cacheStatus:"server_page_fetch"}}catch(e){throw console.error("Error in getPaginatedJobs:",e),e}}async _loadFullDataset(e,s){let t=await j.ZP.get(m.getManagedJobs,[e]);if(t&&t.__skipCache||t.controllerStopped||!t.jobs)return t;let a={jobs:t.jobs,total:t.jobs.length,totalNoFilter:t.totalNoFilter||t.jobs.length,controllerStopped:!1,statusCounts:t.statusCounts||{},timestamp:Date.now()};return this.fullDataCache.set(s,a),a}isDataLoading(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=this._generateFilterKey(e);return this.isLoading.has(s)||this.prefetching.has(s)}isDataCached(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=this._generateFilterKey(e),t=this._getCacheStatus(s);return t.isCached&&t.isFresh&&t.hasData}getCacheStatus(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=this._generateFilterKey(e);return this._getCacheStatus(s)}invalidateCache(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e){let s=this._generateFilterKey(e);this.fullDataCache.delete(s),this.isLoading.delete(s),this.prefetching.delete(s)}else this.fullDataCache.clear(),this.isLoading.clear(),this.prefetching.clear();j.ZP.invalidateFunction(m.getManagedJobs)}getCacheStats(){let e={cachedFilters:Array.from(this.fullDataCache.keys()),loadingFilters:Array.from(this.isLoading.keys()),prefetchingFilters:Array.from(this.prefetching.keys()),cacheSize:this.fullDataCache.size,loadingCount:this.isLoading.size,prefetchingCount:this.prefetching.size};for(let[s,t]of(e.detailedStatus={},this.fullDataCache.entries())){let a=this._getCacheStatus(s);e.detailedStatus[s]={age:a.age,isFresh:a.isFresh,hasData:a.hasData,jobCount:t.jobs?t.jobs.length:0}}return e}constructor(){this.fullDataCache=new Map,this.isLoading=new Map,this.prefetching=new Map}}let f=new p;var g=t(23266),b=t(17324),v=t(13626),N=t(60998);/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let y=(0,N.Z)("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),w=(0,N.Z)("FileSearch",[["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M4.268 21a2 2 0 0 0 1.727 1H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"ms7g94"}],["path",{d:"m9 18-1.5-1.5",key:"1j6qii"}],["circle",{cx:"5",cy:"14",r:"3",key:"ufru5t"}]]);var k=t(16826),C=t(92128),S=t(94545),_=t(99307),L=t(20546),E=t(23001),D=t(36856),R=t(55988),M=t(10546);let F={active:["PENDING","RUNNING","RECOVERING","SUBMITTED","STARTING","CANCELLING"],finished:["SUCCEEDED","FAILED","CANCELLED","FAILED_SETUP","FAILED_PRECHECKS","FAILED_NO_RESOURCE","FAILED_CONTROLLER"]},A=[{label:"Name",value:"name"},{label:"User",value:"user"},{label:"Workspace",value:"workspace"},{label:"Pool",value:"pool"},{label:"Labels",value:"labels"}];function I(e,s){if(!s||""===s.trim())return e;let t=s.toLowerCase().trim();return e.filter(e=>(e.name||"").toLowerCase().includes(t))}function P(e,s){return s&&"ALL_WORKSPACES"!==s?e.filter(e=>(e.workspace||"default").toLowerCase()===s.toLowerCase()):e}function Z(e,s){return s&&"ALL_USERS"!==s?e.filter(e=>(e.user_hash||e.user)===s):e}function z(e,s){if(!s||""===s.trim())return e;let t=s.toLowerCase().trim();return e.filter(e=>(e.pool||"").toLowerCase().includes(t))}let O=e=>{if(!e)return"-";let s=e instanceof Date?e:new Date(1e3*e);return(0,a.jsx)(u.Zg,{date:s})};function T(){let e=(0,r.useRouter)(),[s,t]=(0,n.useState)(!1),[l,c]=(0,n.useState)(!0),[o,d]=(0,n.useState)(!0),h=n.useRef(null),x=n.useRef(null),[p,g]=(0,n.useState)([]),[v,N]=(0,n.useState)([]),[y,w]=(0,n.useState)({name:[],user:[],workspace:[],pool:[],labels:[]}),[k,C]=(0,n.useState)(!1),[S,_]=(0,n.useState)(null),L=n.useCallback(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t(!0),!e&&o&&c(!0);try{let[e]=await Promise.all([j.ZP.get(m.vs,[{}])]);g(e.pools||[])}catch(e){console.error("Error fetching data:",e)}finally{t(!1),!e&&o&&(c(!1),d(!1))}},[o]);(0,n.useEffect)(()=>{(async()=>{try{await D.ZP.preloadForPage("jobs")}catch(e){console.error("Error preloading jobs data:",e)}finally{C(!0),_(new Date),L()}})()},[L]);let E=s=>{(0,M.eG)(e,s)},R=n.useCallback(()=>{let s=new Map;s.set("",""),s.set("status","Status"),s.set("name","Name"),s.set("user","User"),s.set("workspace","Workspace"),s.set("pool","Pool"),s.set("labels","Labels"),N((0,M.Fu)(e,s))},[e,N]);return(0,n.useEffect)(()=>{e.isReady&&R()},[e.isReady,e.query.tab,R]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 mb-1",children:[(0,a.jsx)("div",{className:"text-base",children:(0,a.jsx)(i(),{href:"/jobs",className:"text-sky-blue hover:underline leading-none",children:"Managed Jobs"})}),(0,a.jsx)("div",{className:"w-full sm:w-auto",children:(0,a.jsx)(M.ML,{propertyList:A,valueList:y,setFilters:N,updateURLParams:E,placeholder:"Filter jobs"})})]}),(0,a.jsx)(M.x$,{filters:v,setFilters:N,updateURLParams:E}),(0,a.jsx)(U,{refreshInterval:u.yc,setLoading:t,refreshDataRef:h,filters:v,onRefresh:()=>{f.invalidateCache(),j.ZP.invalidate(m.vs,[{}]),j.ZP.invalidate(b.getWorkspaces),C(!1),D.ZP.preloadForPage("jobs",{force:!0}).then(()=>{C(!0),_(new Date),h.current&&h.current(),x.current&&x.current()})},poolsData:p,poolsLoading:l,setValueList:w,preloadingComplete:k,lastFetchedTime:S}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)(B,{refreshInterval:u.yc,setLoading:t,refreshDataRef:x})})]})}function U(e){let{refreshInterval:s,setLoading:t,refreshDataRef:r,filters:l,onRefresh:p,poolsData:b,poolsLoading:N,setValueList:w,preloadingComplete:k,lastFetchedTime:D}=e,[A,I]=(0,n.useState)([]),[P,Z]=(0,n.useState)(0),[z,T]=(0,n.useState)(0),[U,H]=(0,n.useState)({key:null,direction:"ascending"}),[B,G]=(0,n.useState)(!1),[K,V]=(0,n.useState)(!0),[$,Y]=(0,n.useState)(1),[X,Q]=(0,n.useState)(10),[ee,es]=(0,n.useState)(null),et=(0,n.useRef)(null),[ea,en]=(0,n.useState)([]),[er,el]=(0,n.useState)({}),[ei,ec]=(0,n.useState)({}),[eo,ed]=(0,n.useState)(!1),[eh,eu]=(0,n.useState)(!1),[ex,em]=(0,n.useState)(!1),[ej,ep]=(0,n.useState)("all"),[ef,eg]=(0,n.useState)(!0),[eb,ev]=(0,n.useState)({isOpen:!1,title:"",message:"",onConfirm:null}),eN=(0,E.X)(),ey=(0,n.useRef)(0),ew=n.useMemo(()=>{if(!A||0===A.length)return!1;let e=new Set(A.map(e=>e.workspace||"default"));return e.size>1||1===e.size&&!e.has("default")},[A]),ek=n.useMemo(()=>b&&b.length>0,[b]),eC=async()=>{ev({isOpen:!0,title:"Restart Controller",message:"Are you sure you want to restart the controller?",onConfirm:async()=>{try{em(!0),G(!0),await (0,m.Ce)("restartcontroller"),await eS()}catch(e){console.error("Error restarting controller:",e)}finally{em(!1),G(!1)}}})},eS=n.useCallback(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=!1!==e.includeStatus,a=ey.current+1;ey.current=a,G(!0),t(!0);try{let e;let t=e=>{let s=(l||[]).find(s=>(s.property||"").toLowerCase()===e);return s&&s.value?String(s.value):void 0};ea.length>0?e=ea:ef?"active"===ej?e=F.active:"finished"===ej&&(e=F.finished):e=[];let n={allUsers:!0,nameMatch:t("name"),userMatch:t("user"),workspaceMatch:t("workspace"),poolMatch:t("pool"),statuses:e,page:$,limit:X},r=null;if(f.isDataCached(n),f.isDataLoading(n),s)try{r=await j.ZP.get(g.getClusters)}catch(e){console.error("Error fetching clusters:",e)}let{jobs:i=[],total:c=0,totalNoFilter:o=0,controllerStopped:d=!1,cacheStatus:h="unknown",statusCounts:u={}}=await f.getPaginatedJobs(n)||{},x=!1,m=!1;if(s&&r){let e=null==r?void 0:r.find(e=>(0,S.Ym)(e.cluster)),s=e?e.status:"NOT_FOUND";"STOPPED"==s&&d&&(x=!0),"LAUNCHING"==s&&(m=!0)}a===ey.current&&(I(i),Z(c||0),T(o||0),ed(!!x),eu(!!m),ec(u),V(!1))}catch(e){console.error("Error fetching data:",e),a===ey.current&&(I([]),ed(!1),V(!1))}finally{a===ey.current&&(G(!1),t(!1))}},[t,l,$,X,ea,ef,ej]);n.useEffect(()=>{r&&(r.current=eS)},[r,eS]);let e_=n.useRef(eS);n.useEffect(()=>{e_.current=eS},[eS]);let eL=n.useRef(!0);n.useEffect(()=>{eS({includeStatus:!0}),eL.current=!1},[]),n.useEffect(()=>{!eL.current&&k&&eS({includeStatus:!1})},[$,eS,k]),n.useEffect(()=>{!eL.current&&k&&eS({includeStatus:!0})},[l,X,eS,k]),n.useEffect(()=>{!eL.current&&k&&eS({includeStatus:!0})},[ej,ea,ef,eS,k]),(0,n.useEffect)(()=>{if(!k)return;let e=setInterval(()=>{e_.current&&"visible"===window.document.visibilityState&&e_.current({includeStatus:!0})},s);return()=>{clearInterval(e)}},[s,k]),(0,n.useEffect)(()=>{Y(1)},[ej]),(0,n.useEffect)(()=>{Y(1)},[l,X]),(0,n.useEffect)(()=>{en([]),eg(!0)},[ej]),(0,n.useEffect)(()=>{if(!w)return;let e=new Set,s=new Set,t=new Set,a=new Set,n=new Set;A.forEach(r=>{r.name&&e.add(r.name),r.user&&s.add(r.user),r.workspace&&t.add(r.workspace),r.pool&&a.add(r.pool),Object.entries(r.labels||{}).forEach(e=>{let[s,t]=e;n.add("".concat(s,":").concat(t))})}),b&&Array.isArray(b)&&b.forEach(e=>{if(!e.name)return;let s=e.jobCounts&&Object.keys(e.jobCounts).length>0,t=null!==e.uptime&&void 0!==e.uptime&&e.uptime>0&&e.uptime<86400;(s||t)&&a.add(e.name)}),w({name:Array.from(e).sort(),user:Array.from(s).sort(),workspace:Array.from(t).sort(),pool:Array.from(a).sort(),labels:Array.from(n).sort()})},[A,b,w]);let eE=e=>{let s="ascending";U.key===e&&"ascending"===U.direction&&(s="descending"),H({key:e,direction:s})},eD=e=>U.key===e?"ascending"===U.direction?" ↑":" ↓":"";n.useMemo(()=>{let e=A||[];return{active:e.filter(e=>F.active.includes(e.status)).length,finished:e.filter(e=>F.finished.includes(e.status)).length}},[A]);let eR=e=>ea.length>0?ea.includes(e):"all"===ej||F[ej].includes(e),eM=n.useMemo(()=>{let e=A,s=null==l?void 0:l.find(e=>"labels"===(e.property||"").toLowerCase());return s&&s.value&&(e=e.filter(e=>(0,M.mu)(e,s))),e},[A,l]),eF=n.useMemo(()=>U.key?[...eM].sort((e,s)=>e[U.key]<s[U.key]?"ascending"===U.direction?-1:1:e[U.key]>s[U.key]?"ascending"===U.direction?1:-1:0):eM,[eM,U]),eA=($-1)*X,eI=P>0?Math.ceil(P/X):0,eP=P>0?Math.min(eA+eF.length,P):0,eZ=e=>{if(ea.includes(e)){let s=ea.filter(s=>s!==e);0===s.length?(eg(!0),en([])):(en(s),eg(!1))}else en([...ea,e]),eg(!1);Y(1)};return(0,n.useEffect)(()=>{el(ei)},[ei]),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"flex flex-col space-y-1 mb-1",children:(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between text-sm mb-1",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center",children:[(0,a.jsx)("span",{className:"mr-2 text-sm font-medium",children:"Statuses:"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 items-center",children:[!B&&0===z&&!K&&(0,a.jsx)("span",{className:"text-gray-500 mr-2",children:"No jobs found"}),Object.entries(er).map(e=>{let[s,t]=e;return(0,a.jsxs)("button",{onClick:()=>eZ(s),className:"px-3 py-0.5 rounded-full flex items-center space-x-2 ".concat(eR(s)||ea.includes(s)?(0,_.Cl)(s):"bg-gray-50 text-gray-600 hover:bg-gray-100"),children:[(0,a.jsx)("span",{children:s}),(0,a.jsx)("span",{className:"text-xs ".concat(eR(s)||ea.includes(s)?"bg-white/50":"bg-gray-200"," px-1.5 py-0.5 rounded"),children:t})]},s)}),z>0&&(0,a.jsxs)("div",{className:"flex items-center ml-2 gap-2",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"("}),(0,a.jsx)("button",{onClick:()=>{n.startTransition(()=>{ep("all"),en([]),eg(!0),Y(1)})},className:"text-sm font-medium ".concat("all"===ej&&ef?"text-purple-700 underline":"text-gray-600 hover:text-purple-700 hover:underline"),children:"show all jobs"}),(0,a.jsx)("span",{className:"text-gray-500 mx-1",children:"|"}),(0,a.jsx)("button",{onClick:()=>{n.startTransition(()=>{ep("active"),en([]),eg(!0),Y(1)})},className:"text-sm font-medium ".concat("active"===ej&&ef?"text-green-700 underline":"text-gray-600 hover:text-green-700 hover:underline"),children:"show all active jobs"}),(0,a.jsx)("span",{className:"text-gray-500 mx-1",children:"|"}),(0,a.jsx)("button",{onClick:()=>{n.startTransition(()=>{ep("finished"),en([]),eg(!0),Y(1)})},className:"text-sm font-medium ".concat("finished"===ej&&ef?"text-blue-700 underline":"text-gray-600 hover:text-blue-700 hover:underline"),children:"show all finished jobs"}),(0,a.jsx)("span",{className:"text-gray-500",children:")"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[B&&(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(c.Z,{size:15,className:"mt-0"}),(0,a.jsx)("span",{className:"ml-2 text-gray-500 text-sm",children:"Loading..."})]}),!B&&D&&(0,a.jsx)(u.$3,{timestamp:D}),(0,a.jsxs)("button",{onClick:()=>{p&&p()},disabled:B,className:"text-sky-blue hover:text-sky-blue-bright flex items-center text-sm",children:[(0,a.jsx)(v.Z,{className:"h-4 w-4 mr-1.5"}),(0,a.jsx)("span",{children:"Refresh"})]})]})]})}),eN&&eo&&0===eF.length&&!B&&!K&&(0,a.jsx)("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg border",children:(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-3",children:[(0,a.jsxs)("p",{className:"text-gray-700 text-center text-sm",children:["Job controller stopped.",(0,a.jsx)("br",{}),"Restart to check status."]}),(0,a.jsx)(o.z,{variant:"outline",size:"sm",onClick:eC,className:"text-sky-blue hover:text-sky-blue-bright",disabled:B||ex,children:ex?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.Z,{size:12,className:"mr-2"}),"Restarting..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y,{className:"h-4 w-4 mr-2"}),"Restart"]})})]})}),(0,a.jsx)(d.Zb,{children:(0,a.jsx)("div",{className:"overflow-x-auto rounded-lg",children:(0,a.jsxs)(h.iA,{className:"min-w-full",children:[(0,a.jsx)(h.xD,{children:(0,a.jsxs)(h.SC,{children:[(0,a.jsxs)(h.ss,{className:"sortable whitespace-nowrap",onClick:()=>eE("id"),children:["ID",eD("id")]}),(0,a.jsxs)(h.ss,{className:"sortable whitespace-nowrap",onClick:()=>eE("name"),children:["Name",eD("name")]}),(0,a.jsxs)(h.ss,{className:"sortable whitespace-nowrap",onClick:()=>eE("user"),children:["User",eD("user")]}),ew&&(0,a.jsxs)(h.ss,{className:"sortable whitespace-nowrap",onClick:()=>eE("workspace"),children:["Workspace",eD("workspace")]}),(0,a.jsxs)(h.ss,{className:"sortable whitespace-nowrap",onClick:()=>eE("submitted_at"),children:["Submitted",eD("submitted_at")]}),(0,a.jsxs)(h.ss,{className:"sortable whitespace-nowrap",onClick:()=>eE("job_duration"),children:["Duration",eD("job_duration")]}),(0,a.jsxs)(h.ss,{className:"sortable whitespace-nowrap",onClick:()=>eE("status"),children:["Status",eD("status")]}),(0,a.jsxs)(h.ss,{className:"sortable whitespace-nowrap",onClick:()=>eE("infra"),children:["Infra",eD("infra")]}),(0,a.jsxs)(h.ss,{className:"sortable whitespace-nowrap",onClick:()=>eE("cluster"),children:["Requested Resources",eD("cluster")]}),(0,a.jsxs)(h.ss,{className:"sortable whitespace-nowrap",onClick:()=>eE("recoveries"),children:["Recoveries",eD("recoveries")]}),ek&&(0,a.jsxs)(h.ss,{className:"sortable whitespace-nowrap",onClick:()=>eE("pool"),children:["Pool",eD("pool")]}),(0,a.jsx)(h.ss,{children:"Details"}),(0,a.jsx)(h.ss,{children:"Logs"})]})}),(0,a.jsx)(h.RM,{children:B&&K?(0,a.jsx)(h.SC,{children:(0,a.jsx)(h.pj,{colSpan:11+(ew?1:0)+(ek?1:0),className:"text-center py-6 text-gray-500",children:(0,a.jsxs)("div",{className:"flex justify-center items-center",children:[(0,a.jsx)(c.Z,{size:20,className:"mr-2"}),(0,a.jsx)("span",{children:"Loading..."})]})})}):eF.length>0?(0,a.jsx)(a.Fragment,{children:eF.map(e=>(0,a.jsxs)(n.Fragment,{children:[(0,a.jsxs)(h.SC,{children:[(0,a.jsx)(h.pj,{children:(0,a.jsx)(i(),{href:"/jobs/".concat(e.id),className:"text-blue-600",children:e.id})}),(0,a.jsx)(h.pj,{children:(0,a.jsx)(i(),{href:"/jobs/".concat(e.id),className:"text-blue-600",children:e.name})}),(0,a.jsx)(h.pj,{children:(0,a.jsx)(L.H,{username:e.user,userHash:e.user_hash})}),ew&&(0,a.jsx)(h.pj,{children:(0,a.jsx)(i(),{href:"/workspaces",className:"text-gray-700 hover:text-blue-600 hover:underline",children:e.workspace||"default"})}),(0,a.jsx)(h.pj,{children:O(e.submitted_at)}),(0,a.jsx)(h.pj,{children:(0,u.LU)(e.job_duration)}),(0,a.jsx)(h.pj,{children:(0,a.jsx)(R.j,{name:"jobs.table.status.badge",context:e,fallback:(0,a.jsx)(_.OE,{status:e.status,statusTooltip:e.statusTooltip})})}),(0,a.jsx)(h.pj,{children:e.infra&&"-"!==e.infra?(0,a.jsx)(u.Md,{content:e.full_infra||e.infra,className:"text-sm text-muted-foreground",children:(0,a.jsxs)("span",{children:[(0,a.jsx)(i(),{href:"/infra",className:"text-blue-600 hover:underline",children:e.cloud||e.infra.split("(")[0].trim()}),e.infra.includes("(")&&(0,a.jsx)("span",{children:" "+(()=>{let s=x.MO.NAME_TRUNCATE_LENGTH,t=e.infra.substring(e.infra.indexOf("(")),a=t.substring(1,t.length-1);if(a.length<=s)return t;let n="".concat(a.substring(0,Math.floor((s-3)/2)),"...").concat(a.substring(a.length-Math.ceil((s-3)/2)));return"(".concat(n,")")})()})]})}):(0,a.jsx)("span",{children:e.infra||"-"})}),(0,a.jsx)(h.pj,{children:(0,a.jsx)(u.Md,{content:e.requested_resources||e.resources_str_full||e.resources_str||"-",className:"text-sm text-muted-foreground",children:(0,a.jsx)("span",{children:e.requested_resources||e.resources_str||"-"})})}),(0,a.jsx)(h.pj,{children:e.recoveries}),ek&&(0,a.jsx)(h.pj,{children:(0,a.jsx)("div",{className:N?"blur-sm transition-all duration-300":"",children:N?"-":(0,u.os)(e.pool,e.pool_hash,b)})}),(0,a.jsx)(h.pj,{children:e.details?(0,a.jsx)(q,{text:e.details,rowId:e.id,expandedRowId:ee,setExpandedRowId:es}):"-"}),(0,a.jsx)(h.pj,{children:(0,a.jsx)(W,{jobParent:"/jobs",jobId:e.id,managed:!0,workspace:e.workspace})})]}),ee===e.id&&(0,a.jsx)(J,{text:e.details,colSpan:11+(ew?1:0)+(ek?1:0),innerRef:et})]},e.task_job_id))}):(0,a.jsx)(h.SC,{children:(0,a.jsx)(h.pj,{colSpan:11+(ew?1:0)+(ek?1:0),className:"text-center py-6",children:(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[eh&&(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,a.jsx)("p",{className:"text-gray-700",children:"The managed job controller is launching. It will be ready shortly."}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(c.Z,{size:12,className:"mr-2"}),(0,a.jsx)("span",{className:"text-gray-500",children:"Launching..."})]})]}),!eo&&!eh&&(0,a.jsx)("p",{className:"text-gray-500",children:"No active jobs"}),!eN&&eo&&(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-3 px-4",children:[(0,a.jsx)("p",{className:"text-gray-700 text-center text-sm sm:text-base max-w-md",children:"The managed job controller has been stopped. Restart to check the latest job status."}),(0,a.jsx)(o.z,{variant:"outline",size:"sm",onClick:eC,className:"text-sky-blue hover:text-sky-blue-bright",disabled:B||ex,children:ex?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.Z,{size:12,className:"mr-2"}),"Restarting..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y,{className:"h-4 w-4 mr-2"}),"Restart Controller"]})})]})]})})})})]})})}),(0,a.jsx)("div",{className:"flex justify-end items-center py-2 px-4 text-sm text-gray-700",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"mr-2",children:"Rows per page:"}),(0,a.jsxs)("div",{className:"relative inline-block",children:[(0,a.jsxs)("select",{value:X,onChange:e=>{Q(parseInt(e.target.value,10)),Y(1)},className:"py-1 pl-2 pr-6 appearance-none outline-none cursor-pointer border-none bg-transparent",style:{minWidth:"40px"},children:[(0,a.jsx)("option",{value:10,children:"10"}),(0,a.jsx)("option",{value:30,children:"30"}),(0,a.jsx)("option",{value:50,children:"50"}),(0,a.jsx)("option",{value:100,children:"100"}),(0,a.jsx)("option",{value:200,children:"200"})]}),(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500 absolute right-0 top-1/2 transform -translate-y-1/2 pointer-events-none",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),(0,a.jsx)("div",{children:P>0?"".concat(eA+1," – ").concat(eP," of ").concat(P):"0 – 0 of 0"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(o.z,{variant:"ghost",size:"icon",onClick:()=>{Y(e=>Math.max(e-1,1))},disabled:1===$||!eF||0===eF.length,className:"text-gray-500 h-8 w-8 p-0",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"chevron-left",children:(0,a.jsx)("path",{d:"M15 18l-6-6 6-6"})})}),(0,a.jsx)(o.z,{variant:"ghost",size:"icon",onClick:()=>{eI>0&&$<eI&&Y(e=>e+1)},disabled:0===eI||$>=eI||!eF||0===eF.length,className:"text-gray-500 h-8 w-8 p-0",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"chevron-right",children:(0,a.jsx)("path",{d:"M9 18l6-6-6-6"})})})]})]})}),(0,a.jsx)(C.cV,{isOpen:eb.isOpen,onClose:()=>ev({...eb,isOpen:!1}),onConfirm:eb.onConfirm,title:eb.title,message:eb.message,confirmClassName:"bg-blue-600 hover:bg-blue-700 text-white"})]})}function W(e){let{withLabel:s=!1,jobParent:t,jobId:n,managed:l,workspace:i="default"}=e,c=(0,r.useRouter)(),o=(e,s)=>{e.preventDefault(),e.stopPropagation(),c.push({pathname:"".concat(t,"/").concat(n),query:{tab:s}})},d=function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.preventDefault(),e.stopPropagation(),l)(0,m.jh)({jobId:parseInt(n),controller:s});else{let e=t.match(/\/clusters\/(.+)/);if(e){let s=e[1];(0,g.GH)({clusterName:s,jobIds:[n],workspace:i})}}};return(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(u.WH,{content:"View Job Logs",className:"capitalize text-sm text-muted-foreground",children:(0,a.jsxs)("button",{onClick:e=>o(e,"logs"),className:"text-sky-blue hover:text-sky-blue-bright font-medium inline-flex items-center h-8",children:[(0,a.jsx)(w,{className:"w-4 h-4"}),s&&(0,a.jsx)("span",{className:"ml-1.5",children:"Logs"})]})},"logs"),(0,a.jsx)(u.WH,{content:"Download Job Logs",className:"capitalize text-sm text-muted-foreground",children:(0,a.jsxs)("button",{onClick:e=>d(e,!1),className:"text-sky-blue hover:text-sky-blue-bright font-medium inline-flex items-center h-8",children:[(0,a.jsx)(k.Z,{className:"w-4 h-4"}),s&&(0,a.jsx)("span",{className:"ml-1.5",children:"Download"})]})},"downloadlogs")]})}function H(e){let{clusterName:s,clusterJobData:t,loading:r,refreshClusterJobsOnly:l,userFilter:x=null,nameFilter:m=null,workspace:j="default"}=e,[p,f]=(0,n.useState)(null),[g,b]=(0,n.useState)({key:null,direction:"ascending"}),[N,y]=(0,n.useState)(1),[w,k]=(0,n.useState)(10),C=(0,n.useRef)(null),[S,E]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=e=>{p&&C.current&&!C.current.contains(e.target)&&f(null)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[p]);let D=n.useMemo(()=>{let e=t||[];return x&&"ALL_USERS"!==x&&(e=Z(e,x)),m&&(e=I(e,m)),e},[t,x,m]);(0,n.useEffect)(()=>{JSON.stringify(t)!==JSON.stringify(S)&&E(t)},[t,S]);let R=n.useMemo(()=>g.key?[...D].sort((e,s)=>e[g.key]<s[g.key]?"ascending"===g.direction?-1:1:e[g.key]>s[g.key]?"ascending"===g.direction?1:-1:0):D,[D,g]),M=e=>{let s="ascending";g.key===e&&"ascending"===g.direction&&(s="descending"),b({key:e,direction:s})},F=e=>g.key===e?"ascending"===g.direction?" ↑":" ↓":"",A=Math.ceil(R.length/w),P=(N-1)*w,z=P+w,T=R.slice(P,z);return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)(d.Zb,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Cluster Jobs"}),(0,a.jsx)("div",{className:"flex items-center",children:l&&(0,a.jsxs)("button",{onClick:l,disabled:r,className:"text-sky-blue hover:text-sky-blue-bright font-medium inline-flex items-center text-sm ml-2",children:[(0,a.jsx)(v.Z,{className:"w-4 h-4 mr-1"}),"Refresh Jobs"]})})]}),(0,a.jsxs)(h.iA,{children:[(0,a.jsx)(h.xD,{children:(0,a.jsxs)(h.SC,{children:[(0,a.jsxs)(h.ss,{className:"sortable whitespace-nowrap",onClick:()=>M("id"),children:["ID",F("id")]}),(0,a.jsxs)(h.ss,{className:"sortable whitespace-nowrap",onClick:()=>M("job"),children:["Name",F("job")]}),(0,a.jsxs)(h.ss,{className:"sortable whitespace-nowrap",onClick:()=>M("user"),children:["User",F("user")]}),(0,a.jsxs)(h.ss,{className:"sortable whitespace-nowrap",onClick:()=>M("submitted_at"),children:["Submitted",F("submitted_at")]}),(0,a.jsxs)(h.ss,{className:"sortable whitespace-nowrap",onClick:()=>M("job_duration"),children:["Duration",F("job_duration")]}),(0,a.jsxs)(h.ss,{className:"sortable whitespace-nowrap",onClick:()=>M("status"),children:["Status",F("status")]}),(0,a.jsxs)(h.ss,{className:"sortable whitespace-nowrap",onClick:()=>M("resources"),children:["Resources",F("resources")]}),(0,a.jsx)(h.ss,{className:"whitespace-nowrap",children:"Logs"})]})}),(0,a.jsx)(h.RM,{children:r?(0,a.jsx)(h.SC,{children:(0,a.jsx)(h.pj,{colSpan:8,className:"text-center py-12 text-gray-500",children:(0,a.jsxs)("div",{className:"flex justify-center items-center",children:[(0,a.jsx)(c.Z,{size:24,className:"mr-2"}),(0,a.jsx)("span",{children:"Loading cluster jobs..."})]})})}):T.length>0?T.map(e=>(0,a.jsxs)(n.Fragment,{children:[(0,a.jsxs)(h.SC,{className:p===e.id?"selected-row":"",children:[(0,a.jsx)(h.pj,{children:(0,a.jsx)(i(),{href:"/clusters/".concat(s,"/").concat(e.id),className:"text-blue-600",children:e.id})}),(0,a.jsx)(h.pj,{children:(0,a.jsx)(i(),{href:"/clusters/".concat(s,"/").concat(e.id),className:"text-blue-600",children:(0,a.jsx)(q,{text:e.job||"Unnamed job",rowId:e.id,expandedRowId:p,setExpandedRowId:f})})}),(0,a.jsx)(h.pj,{children:(0,a.jsx)(L.H,{username:e.user,userHash:e.user_hash})}),(0,a.jsx)(h.pj,{children:O(e.submitted_at)}),(0,a.jsx)(h.pj,{children:(0,u.LU)(e.job_duration)}),(0,a.jsx)(h.pj,{children:(0,a.jsx)(_.OE,{status:e.status})}),(0,a.jsx)(h.pj,{children:e.resources}),(0,a.jsx)(h.pj,{className:"flex content-center items-center",children:(0,a.jsx)(W,{jobParent:"/clusters/".concat(s),jobId:e.id,managed:!1,workspace:j})})]}),p===e.id&&(0,a.jsx)(J,{text:e.job||"Unnamed job",colSpan:8,innerRef:C})]},e.id)):(0,a.jsx)(h.SC,{children:(0,a.jsx)(h.pj,{colSpan:8,className:"text-center py-6 text-gray-500",children:"No jobs found"})})})]})]}),R&&R.length>0&&(0,a.jsx)("div",{className:"flex justify-end items-center py-2 px-4 text-sm text-gray-700",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"mr-2",children:"Rows per page:"}),(0,a.jsxs)("div",{className:"relative inline-block",children:[(0,a.jsxs)("select",{value:w,onChange:e=>{k(parseInt(e.target.value,10)),y(1)},className:"py-1 pl-2 pr-6 appearance-none outline-none cursor-pointer border-none bg-transparent",style:{minWidth:"40px"},children:[(0,a.jsx)("option",{value:5,children:"5"}),(0,a.jsx)("option",{value:10,children:"10"}),(0,a.jsx)("option",{value:20,children:"20"}),(0,a.jsx)("option",{value:50,children:"50"})]}),(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500 absolute right-0 top-1/2 transform -translate-y-1/2 pointer-events-none",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),(0,a.jsxs)("div",{children:[P+1," – ",Math.min(z,R.length)," of"," ",R.length]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(o.z,{variant:"ghost",size:"icon",onClick:()=>{y(e=>Math.max(e-1,1))},disabled:1===N,className:"text-gray-500 h-8 w-8 p-0",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"chevron-left",children:(0,a.jsx)("path",{d:"M15 18l-6-6 6-6"})})}),(0,a.jsx)(o.z,{variant:"ghost",size:"icon",onClick:()=>{y(e=>Math.min(e+1,A))},disabled:N===A||0===A,className:"text-gray-500 h-8 w-8 p-0",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"chevron-right",children:(0,a.jsx)("path",{d:"M9 18l6-6-6-6"})})})]})]})})]})}function J(e){let{text:s,colSpan:t,innerRef:n}=e;return(0,a.jsx)(h.SC,{className:"expanded-details",children:(0,a.jsx)(h.pj,{colSpan:t,children:(0,a.jsx)("div",{className:"p-4 bg-gray-50 rounded-md border border-gray-200",ref:n,children:(0,a.jsx)("div",{className:"flex justify-between items-start",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Full Details"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-700",style:{whiteSpace:"pre-wrap"},children:s})]})})})})})}function q(e){let{text:s,rowId:t,expandedRowId:r,setExpandedRowId:l}=e,i=s||"",c=i.length>50,o=r===t,d=c?"".concat(i.substring(0,50)):i,h=(0,n.useRef)(null);return(0,a.jsxs)("div",{className:"truncated-details relative max-w-full flex items-center",children:[(0,a.jsx)("span",{className:"truncate",children:d}),c&&(0,a.jsx)("button",{ref:h,type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),l(o?null:t)},className:"text-blue-600 hover:text-blue-800 font-medium ml-1 flex-shrink-0","data-button-type":"show-more-less",children:o?"... show less":"... show more"})]})}function B(e){let{refreshInterval:s,setLoading:t,refreshDataRef:r}=e,[l,o]=(0,n.useState)([]),[x,p]=(0,n.useState)({key:null,direction:"ascending"}),[f,g]=(0,n.useState)(!1),[b,v]=(0,n.useState)(!0),[N,y]=(0,n.useState)(1),[w,k]=(0,n.useState)(10),C=n.useCallback(async()=>{g(!0),t(!0);try{let{pools:e=[]}=await j.ZP.get(m.vs,[{}])||{};o(e),v(!1)}catch(e){console.error("Error fetching pools data:",e),o([]),v(!1)}finally{g(!1),t(!1)}},[t]);n.useEffect(()=>{r&&(r.current=C)},[r,C]),(0,n.useEffect)(()=>{o([]);let e=!0;C();let t=setInterval(()=>{e&&"visible"===window.document.visibilityState&&C()},s);return()=>{e=!1,clearInterval(t)}},[s,C]);let S=e=>{let s="ascending";x.key===e&&"ascending"===x.direction&&(s="descending"),p({key:e,direction:s})},L=e=>x.key===e?"ascending"===x.direction?" ↑":" ↓":"",E=n.useMemo(()=>x.key?[...l].sort((e,s)=>e[x.key]<s[x.key]?"ascending"===x.direction?-1:1:e[x.key]>s[x.key]?"ascending"===x.direction?1:-1:0):l,[l,x]),D=Math.ceil(E.length/w),R=(N-1)*w,F=R+w,A=E.slice(R,F),I=e=>{if(!e||!e.replica_info||0===e.replica_info.length)return"0 (target: 0)";let s=e.replica_info.filter(e=>"READY"===e.status).length,t=e.target_num_replicas||0;return"".concat(s," (target: ").concat(t,")")},P=e=>{let{jobCounts:s}=e;return(0,a.jsx)(u.x9,{jobCounts:s,getStatusStyle:_.Cl})},Z=e=>{let{replicaInfo:s}=e;return(0,a.jsx)(u.Kl,{replicaInfo:s})};return(0,a.jsxs)(d.Zb,{children:[(0,a.jsx)("div",{className:"overflow-x-auto rounded-lg",children:(0,a.jsxs)(h.iA,{className:"min-w-full table-fixed",children:[(0,a.jsx)(h.xD,{children:(0,a.jsxs)(h.SC,{children:[(0,a.jsxs)(h.ss,{className:"sortable whitespace-nowrap w-32",onClick:()=>S("name"),children:["Pool",L("name")]}),(0,a.jsxs)(h.ss,{className:"sortable whitespace-nowrap w-40",onClick:()=>S("job_counts"),children:["Jobs",L("job_counts")]}),(0,a.jsx)(h.ss,{className:"whitespace-nowrap w-20",children:"Workers"}),(0,a.jsxs)(h.ss,{className:"sortable whitespace-nowrap w-36",onClick:()=>S("requested_resources_str"),children:["Worker Details",L("requested_resources_str")]}),(0,a.jsxs)(h.ss,{className:"sortable whitespace-nowrap w-40",onClick:()=>S("requested_resources_str"),children:["Worker Resources",L("requested_resources_str")]})]})}),(0,a.jsx)(h.RM,{children:f&&b?(0,a.jsx)(h.SC,{children:(0,a.jsx)(h.pj,{colSpan:5,className:"text-center py-6 text-gray-500",children:(0,a.jsxs)("div",{className:"flex justify-center items-center",children:[(0,a.jsx)(c.Z,{size:20,className:"mr-2"}),(0,a.jsx)("span",{children:"Loading..."})]})})}):A.length>0?A.map(e=>(0,a.jsxs)(h.SC,{children:[(0,a.jsx)(h.pj,{children:(0,a.jsx)(i(),{href:"/jobs/pools/".concat(e.name),className:"text-blue-600 hover:text-blue-800",children:e.name})}),(0,a.jsx)(h.pj,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,a.jsx)(P,{jobCounts:e.jobCounts}),(0,a.jsx)(i(),{href:(0,M.P2)("/jobs","pool",":",e.name),className:"text-blue-600 hover:text-blue-800 text-xs",children:"See all jobs"})]})}),(0,a.jsx)(h.pj,{children:I(e)}),(0,a.jsx)(h.pj,{children:(0,a.jsx)(Z,{replicaInfo:e.replica_info})}),(0,a.jsx)(h.pj,{children:e.requested_resources_str||"-"})]},e.name)):(0,a.jsx)(h.SC,{children:(0,a.jsx)(h.pj,{colSpan:5,className:"text-center py-6 text-gray-500",children:"No pools found"})})})]})}),A.length>0&&D>1&&(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-t border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"Rows per page:"}),(0,a.jsxs)("select",{value:w,onChange:e=>{k(parseInt(e.target.value,10)),y(1)},className:"border border-gray-300 rounded px-2 py-1 text-sm",children:[(0,a.jsx)("option",{value:5,children:"5"}),(0,a.jsx)("option",{value:10,children:"10"}),(0,a.jsx)("option",{value:25,children:"25"}),(0,a.jsx)("option",{value:50,children:"50"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)("span",{className:"text-sm text-gray-700",children:[R+1,"-",Math.min(F,E.length)," of"," ",E.length]}),(0,a.jsx)("button",{onClick:()=>{y(e=>Math.max(e-1,1))},disabled:1===N,className:"px-2 py-1 text-sm border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Previous"}),(0,a.jsx)("button",{onClick:()=>{y(e=>Math.min(e+1,D))},disabled:N===D,className:"px-2 py-1 text-sm border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Next"})]})]})]})}},55988:function(e,s,t){t.d(s,{j:function(){return r}});var a=t(85893);t(67294);var n=t(23800);function r(e){let{name:s,context:t={},fallback:r=null,wrapperClassName:l=""}=e,i=(0,n.dL)(s);return 0===i.length?r:(0,a.jsx)("div",{className:l||void 0,children:i.map(e=>{let s=e.component;return(0,a.jsx)(s,{...t},e.id)})})}}}]);