# Claude Code Statusline ä¿®å¤ä¼šè¯è®°å½•

## ä¼šè¯æ—¥æœŸ
2025-02-01

## ä¿®å¤çš„é—®é¢˜

### 1. æ¨¡å—ä¸æ˜¾ç¤ºé—®é¢˜
**é—®é¢˜æè¿°**: é…ç½® `--preset full` ååªæ˜¾ç¤º ğŸ“ ç›®å½•ã€â±ï¸ æ—¶é—´ã€ğŸŸ¢ MCP çŠ¶æ€ï¼Œå…¶ä»–æ¨¡å—ä¸æ˜¾ç¤º

**æ ¹æœ¬åŸå› **: 
- `statusline_engine.py` çš„ `initialize()` æ–¹æ³•åœ¨æ£€æŸ¥ `module.is_available()` ä¹‹åæ‰ä¼ é€’ä¸Šä¸‹æ–‡æ•°æ®
- ä¾èµ–ä¸Šä¸‹æ–‡çš„æ¨¡å—ï¼ˆmodelã€planã€costã€context_bar ç­‰ï¼‰åœ¨åˆ›å»ºæ—¶å†…éƒ¨çŠ¶æ€ä¸ºç©ºï¼Œå¯¼è‡´ `is_available()` è¿”å› False

**ä¿®å¤æ–¹æ¡ˆ**:
- æ–‡ä»¶: `src/cc_statusline/engine/statusline_engine.py`
- ä¿®æ”¹: åœ¨æ£€æŸ¥ `is_available()` ä¹‹å‰å…ˆè°ƒç”¨ `set_context()` ä¼ é€’ä¸Šä¸‹æ–‡æ•°æ®
- å…³é”®ä»£ç ä½ç½®: ç¬¬ 154-162 è¡Œ

### 2. æ€§èƒ½ä¼˜åŒ–
**é—®é¢˜æè¿°**: å‘½ä»¤æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼ˆ10ç§’ä»¥ä¸Šï¼‰

**æ ¹æœ¬åŸå› **:
- MCP çŠ¶æ€æ¨¡å—æ¯æ¬¡éƒ½ä¼šå°è¯•è¿è¡Œ `claude mcp list` å‘½ä»¤
- è¯¥å‘½ä»¤éœ€è¦æ£€æŸ¥æ‰€æœ‰ MCP æœåŠ¡å™¨å¥åº·çŠ¶æ€ï¼Œè€—æ—¶ 10+ ç§’

**ä¼˜åŒ–æ–¹æ¡ˆ**:
- æ–‡ä»¶: `src/cc_statusline/modules/mcp_status.py`
- ä¼˜åŒ– 1: æ·»åŠ é…ç½®ç¼“å­˜æœºåˆ¶ï¼ˆ30ç§’ TTLï¼‰ï¼Œé¿å…æ¯æ¬¡åˆ·æ–°éƒ½è¯»å–é…ç½®æ–‡ä»¶
- ä¼˜åŒ– 2: é¦–æ¬¡åˆ·æ–°ä½¿ç”¨å¿«é€Ÿæ¨¡å¼ï¼Œè·³è¿‡è€—æ—¶çš„ `claude mcp list` å‘½ä»¤
- æ‰§è¡Œæ—¶é—´: ä» 10 ç§’é™è‡³ 0.1 ç§’

### 3. æ–°å¢è°ƒè¯•åŠŸèƒ½
**åŠŸèƒ½**: æ·»åŠ  `--debug` å‚æ•°

**ç”¨é€”**:
- æ˜¾ç¤ºä¸Šä¸‹æ–‡æ•°æ®
- æ˜¾ç¤ºæ¨¡å—å¯ç”¨æ€§çŠ¶æ€
- æ˜¾ç¤ºå®é™…è¾“å‡ºæ¨¡å—åˆ—è¡¨
- å¸®åŠ©ç”¨æˆ·è¯Šæ–­é—®é¢˜

**ä½¿ç”¨æ–¹æ³•**:
```bash
cc-statusline --once --preset full --debug
```

## é…ç½®ä¼˜åŒ–

æ›´æ–° `~/.claude/settings.json`ï¼Œæ·»åŠ  `refreshInterval: 5000`:

```json
{
  "statusLine": {
    "type": "command",
    "command": "/home/michael/workspace/github/cc-statusline/.venv/bin/cc-statusline --once --theme modern --preset full",
    "refreshInterval": 5000,
    "padding": 0
  }
}
```

## å…³é”®æ–‡ä»¶å˜æ›´

1. `src/cc_statusline/engine/statusline_engine.py` - ä¿®å¤æ¨¡å—åˆå§‹åŒ–é¡ºåº
2. `src/cc_statusline/modules/mcp_status.py` - æ€§èƒ½ä¼˜åŒ–
3. `src/cc_statusline/cli/commands.py` - æ·»åŠ  --debug å‚æ•°

## éªŒè¯ç»“æœ

å¸¦ä¸Šä¸‹æ–‡çš„å®Œæ•´è¾“å‡ºç°åœ¨æ­£ç¡®æ˜¾ç¤ºæ‰€æœ‰æ¨¡å—:
- ğŸ“ ç›®å½•
- ğŸ¤– æ¨¡å‹ (Sonnet)
- â­ è®¢é˜…è®¡åˆ’ (Pro)
- ğŸ“¦ ç‰ˆæœ¬
- ğŸ§  ä¸Šä¸‹æ–‡ä½¿ç”¨ç‡è¿›åº¦æ¡
- â±ï¸ ä¼šè¯æ—¶é—´
- ğŸ”„ é‡ç½®è®¡æ—¶å™¨
- ğŸ’° ä¼šè¯æˆæœ¬
- ğŸ“… ä»Šæ—¥æˆæœ¬
- ğŸŸ¢ MCP çŠ¶æ€

## æŠ€æœ¯è¦ç‚¹

1. **æ¨¡å—å¯ç”¨æ€§æ£€æŸ¥æ—¶æœº**: å¿…é¡»åœ¨ä¼ é€’ä¸Šä¸‹æ–‡æ•°æ®ä¹‹åæ£€æŸ¥ `is_available()`
2. **å¿«é€Ÿæ¨¡å¼ç­–ç•¥**: å¯¹äº --once æ¨¡å¼ï¼Œå‡è®¾é…ç½®çš„æœåŠ¡å™¨éƒ½åœ¨è¿è¡Œï¼Œè·³è¿‡è€—æ—¶æ£€æµ‹
3. **ç¼“å­˜ç­–ç•¥**: é…ç½®æ–‡ä»¶è¯»å–ä½¿ç”¨ 30 ç§’ TTL ç¼“å­˜ï¼Œé¿å…é¢‘ç¹ I/O
