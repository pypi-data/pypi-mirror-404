# جزئیات فنی: پیاده‌سازی ایران سیستم

کتابخانه `iran-encoding` به عنوان پلی بین سیستم‌های مدرن مبتنی بر یونیکد و مجموعه‌های کاراکتری قدیمی و بصری ایران سیستم طراحی شده است.

## ترتیب بصری (Visual) در مقابل ترتیب منطقی (Logical)
یونیکد مدرن متن را به ترتیب منطقی (همان‌طور که خوانده می‌شود) ذخیره می‌کند و مسئولیت چیدمان راست‌به‌چپ و تغییر شکل حروف را به موتور نمایش (Display Engine) واگذار می‌کند.

**ایران سیستم** (که پیش از یونیکد ابداع شده) کاراکترها را به **ترتیب بصری** ذخیره می‌کند. برای مثال، کد بایتی برای حرف "س" در ابتدای کلمه با کد همان حرف در انتهای کلمه متفاوت است.

## پورت کردن موتور C
هسته اصلی این کتابخانه، یک پورت مستقیم از منطق موجود در `iran_system.c` است. این منطق دو مرحله اصلی را انجام می‌دهد:
۱. **تغییر شکل متنی (Contextual Reshaping)**: با بررسی بایت‌های مجاور، شکل صحیح بصری (اول، وسط، آخر، تنها) را انتخاب می‌کند.
۲. **مدیریت دوجهته (BiDi Handling)**: از الگوریتمی مشابه `ReverseAlphaNumeric` استفاده می‌کند تا اطمینان حاصل شود که اعداد و کلمات انگلیسی قرار گرفته در میان متن فارسی، به گونه‌ای ذخیره می‌شوند که در پایانه‌های بصری ساده به درستی نمایش داده شوند.

## ساختارهای داده
جداول نگاشت در `iran_encoding/core.py` (مانند `UNICODE_STR` و `IRANSYSTEM_UPPER_STR`) بایت‌به‌بایت با نسخه اصلی مطابقت دارند. این امر باعث می‌شود هنگام کار با پایگاه‌های داده قدیمی که با نرم‌افزارهای اصلی C نوشته شده‌اند، سازگاری کامل حفظ شود.
