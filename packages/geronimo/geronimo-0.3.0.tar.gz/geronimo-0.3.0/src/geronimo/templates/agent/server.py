"""MCP Server implementation for the ML model.

This is a TEMPLATE FILE generated by `geronimo generate agent`.
Do not use this file directly - it requires project-specific modules
that are created during code generation.
"""

from typing import Any

# These imports are PLACEHOLDERS for code generation.
# The generator replaces these with actual project imports.
# Running this file directly will raise an ImportError with instructions.
try:
    from geronimo.api.models.schemas import PredictionRequest
    from geronimo.api.deps import get_predictor
except ImportError as e:
    raise ImportError(
        "This template file requires generated project code. "
        "Run 'geronimo generate agent' to create a usable MCP server.\n"
        f"Original error: {e}"
    ) from e

try:
    from mcp.server.fastmcp import FastMCP
except ImportError:
    raise ImportError(
        "MCP server dependencies not installed. "
        "Install with: pip install geronimo[mcp]"
    )

# Initialize FastMCP Server
# "name" will be replaced by the generator
mcp = FastMCP("geronimo-agent")

@mcp.tool()
async def predict(input_data: dict[str, Any]) -> str:
    """Make a prediction using the ML model.
    
    Args:
        input_data: The input features for the model.
    """
    predictor = get_predictor()
    
    # Validate input using Pydantic model
    try:
        request = PredictionRequest(**input_data)
    except Exception as e:
        return f"Error validating input: {str(e)}"

    try:
        prediction = predictor.predict(request)
        return str(prediction.dict())
    except Exception as e:
        return f"Prediction error: {str(e)}"

def run_stdio():
    """Run the server using stdio transport."""
    mcp.run(transport="stdio")

if __name__ == "__main__":
    run_stdio()
