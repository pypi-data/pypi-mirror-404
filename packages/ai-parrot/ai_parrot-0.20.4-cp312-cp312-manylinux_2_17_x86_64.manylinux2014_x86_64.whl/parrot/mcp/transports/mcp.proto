// mcp.proto
syntax = "proto3";

package mcp;

option go_package = "parrot/mcp/proto";

// Hybrid approach: JSON-RPC wrapped in protobuf
service MCPService {
    // Bidirectional streaming for full duplex communication
    rpc BiDirectionalStream(stream MCPRequest) returns (stream MCPResponse);
    
    // Unary calls for simple request/response
    rpc Initialize(InitializeRequest) returns (InitializeResponse);
    rpc ListTools(ListToolsRequest) returns (ListToolsResponse);
    rpc CallTool(CallToolRequest) returns (CallToolResponse);
}

// Wrapper for JSON-RPC messages (backwards compatible)
message MCPRequest {
    oneof payload {
        string json_rpc_message = 1;  // JSON-RPC 2.0 string
        NativeRequest native = 2;      // Native protobuf (more efficient)
    }
}

message MCPResponse {
    oneof payload {
        string json_rpc_message = 1;
        NativeResponse native = 2;
    }
}

// Native protobuf messages (optional, for maximum efficiency)
message NativeRequest {
    int64 id = 1;
    string method = 2;
    bytes params = 3;  // MessagePack or JSON bytes
}

message NativeResponse {
    int64 id = 1;
    bytes result = 2;
    Error error = 3;
}

message Error {
    int32 code = 1;
    string message = 2;
    bytes data = 3;
}

// Typed messages for common operations
message InitializeRequest {
    string protocol_version = 1;
    ClientInfo client_info = 2;
    Capabilities capabilities = 3;
}

message InitializeResponse {
    string protocol_version = 1;
    ServerInfo server_info = 2;
    Capabilities capabilities = 3;
}

message ClientInfo {
    string name = 1;
    string version = 2;
}

message ServerInfo {
    string name = 1;
    string version = 2;
}

message Capabilities {
    bool tools = 1;
    bool resources = 2;
    bool prompts = 3;
}

message ListToolsRequest {}

message ListToolsResponse {
    repeated Tool tools = 1;
}

message Tool {
    string name = 1;
    string description = 2;
    bytes input_schema = 3;  // JSON Schema as bytes
}

message CallToolRequest {
    string name = 1;
    bytes arguments = 2;  // JSON arguments
}

message CallToolResponse {
    repeated Content content = 1;
    bool is_error = 2;
}

message Content {
    string type = 1;
    string text = 2;
    bytes data = 3;
}