<!DOCTYPE html>

<html lang="en">

<head>
  <script data-car-bootstrap="" src="static/bootstrap.js?v=__CAR_ASSET_VERSION__"></script>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"
    name="viewport" />
  <meta content="yes" name="apple-mobile-web-app-capable" />
  <meta content="black-translucent" name="apple-mobile-web-app-status-bar-style" />
  <meta content="#0a0c12" name="theme-color" />
  <title>Codex Autorunner</title>
</head>

<body>
  <div class="hub-shell hidden" id="hub-shell">
    <header class="hub-hero">
      <div class="hub-hero-text">
        <h1>CAR Hub</h1>
        <span class="pill pill-small pill-idle" id="hub-last-scan">‚Äì</span>
        <span class="hub-version" id="hub-version">v‚Äì</span>
      </div>
      <div class="hub-hero-actions">
        <button class="primary sm" id="hub-new-repo">+ New</button>
        <button class="sm" id="hub-scan">Scan</button>
        <button class="ghost sm" id="hub-refresh">Refresh</button>
        <button class="ghost sm icon-btn" id="hub-settings" title="Settings">‚öô</button>
      </div>
    </header>
    <section class="hub-stats">
      <div class="hub-stat">
        <div class="hub-stat-value" id="hub-count-total">‚Äì</div>
        <p class="muted small">repos</p>
      </div>
      <div class="hub-stat">
        <div class="hub-stat-value" id="hub-count-running">‚Äì</div>
        <p class="muted small">running</p>
      </div>
      <div class="hub-stat">
        <div class="hub-stat-value" id="hub-count-missing">‚Äì</div>
        <p class="muted small">missing</p>
      </div>
    </section>
    <section class="hub-inbox">
      <div class="hub-panel-header">
        <span class="label">Inbox</span>
        <div class="hub-panel-actions">
          <button class="ghost sm" id="hub-inbox-refresh">Refresh</button>
        </div>
      </div>
      <div class="hub-inbox-list" id="hub-inbox-list">Loading‚Ä¶</div>
    </section>
    <section class="hub-usage-chart">
      <div class="hub-usage-chart-header">
        <span class="label">Usage Trend</span>
        <div class="usage-chart-controls">
          <select aria-label="Range" class="usage-chart-select" id="hub-usage-chart-range" title="Range">
            <option value="7">1w</option>
            <option selected="" value="30">1m</option>
            <option value="90">3m</option>
            <option value="180">6m</option>
            <option value="365">1y</option>
          </select>
          <select aria-label="Group" class="usage-chart-select" id="hub-usage-chart-segment" title="Group">
            <option value="none">Total</option>
            <option value="repo">By repo</option>
            <option value="agent">By agent</option>
          </select>
        </div>
      </div>
      <div class="usage-chart-canvas hub-usage-chart-canvas" id="hub-usage-chart-canvas"></div>
    </section>
    <section class="hub-repo-panel">
      <div class="hub-panel-header">
        <span class="label">Repositories</span>
        <div class="hub-panel-actions">
          <button class="ghost sm" id="hub-quick-scan">Rescan</button>
        </div>
      </div>
      <div class="hub-repo-list" id="hub-repo-list">
        <div class="muted small">Loading‚Ä¶</div>
      </div>
    </section>
  </div>
  <div class="app-shell" id="repo-shell">
    <nav class="nav-bar">
      <span class="nav-brand">CAR</span>
      <div class="tabs">
        <!-- Tabs will be injected here by tabs.js -->
      </div>
    </nav>
    <main>
      <div class="doc-banner hidden" id="repo-health-banner">
        <div class="doc-banner-text">
          <div class="doc-banner-title" id="repo-health-title">Repo server offline</div>
          <div class="doc-banner-detail muted small" id="repo-health-detail"></div>
        </div>
        <div class="doc-banner-actions">
          <button class="ghost sm" id="repo-health-retry">Retry</button>
        </div>
      </div>
      <section class="panel" id="analytics">
        <div class="cards">
          <div class="card status-card">
            <div class="card-header">
              <div class="card-header-left">
                <span class="label">Ticket Analytics</span>
                <span class="version-label" id="repo-version">v‚Äì</span>
              </div>
              <span class="pill pill-idle" id="runner-status">idle</span>
            </div>
            <div class="grid-two">
              <div>
                <p class="muted">Started</p>
                <p class="metric" id="last-start">‚Äì</p>
              </div>
              <div>
                <p class="muted">Finished</p>
                <p class="metric" id="last-finish">‚Äì</p>
              </div>
              <div>
                <p class="muted">Duration</p>
                <p class="metric" id="last-duration">‚Äì</p>
              </div>
              <div>
                <p class="muted">TODO</p>
                <p class="metric" id="todo-count">‚Äì</p>
              </div>
              <div>
                <p class="muted">Done</p>
                <p class="metric" id="done-count">‚Äì</p>
              </div>
              <div>
                <p class="muted">Active ticket</p>
                <p class="metric" id="ticket-active">‚Äì</p>
              </div>
              <div>
                <p class="muted">Ticket Turns</p>
                <p class="metric" id="ticket-turns">‚Äì</p>
              </div>
              <div>
                <p class="muted">Total Turns</p>
                <p class="metric" id="total-turns">‚Äì</p>
              </div>
              <div>
                <p class="muted">Dispatches</p>
                <p class="metric" id="message-dispatches">‚Äì</p>
              </div>
              <div>
                <p class="muted">Replies</p>
                <p class="metric" id="message-replies">‚Äì</p>
              </div>
              <div>
                <p class="muted">Lines Changed</p>
                <p class="metric diff-stats-metric" id="lines-changed">‚Äì</p>
              </div>
              <div>
                <p class="muted">Run ID</p>
                <p class="metric" id="last-run-id">‚Äì</p>
              </div>
            </div>
          </div>
          <details class="card" id="run-history">
            <summary class="card-header">
              <div class="card-header-left">
                <span class="label">Run History</span>
                <span class="muted small">Last 10 runs</span>
              </div>
              <button class="ghost sm icon-btn" id="analytics-refresh" title="Refresh analytics">‚Üª</button>
            </summary>
            <div class="run-history-list" id="run-history-list">
              <div class="muted">Loading‚Ä¶</div>
            </div>
          </details>
          <div class="card usage-card-compact">
            <div class="usage-header">
              <span class="label">Usage</span>
              <span class="usage-total-badge" id="usage-total">‚Äì</span>
              <span class="usage-events-badge" id="usage-events">‚Äì</span>
              <button class="ghost sm icon-btn" id="usage-refresh" title="Refresh usage">‚Üª</button>
            </div>
            <div class="usage-breakdown">
              <div class="usage-stat">
                <span class="usage-stat-val" id="usage-input">‚Äì</span>
                <span class="usage-stat-lbl">in</span>
              </div>
              <div class="usage-stat usage-stat-cached">
                <span class="usage-stat-val" id="usage-cached">‚Äì</span>
                <span class="usage-stat-lbl">cached</span>
              </div>
              <div class="usage-stat">
                <span class="usage-stat-val" id="usage-output">‚Äì</span>
                <span class="usage-stat-lbl">out</span>
              </div>
              <div class="usage-stat">
                <span class="usage-stat-val" id="usage-reasoning">‚Äì</span>
                <span class="usage-stat-lbl">reason</span>
              </div>
            </div>
            <div class="usage-chart">
              <div class="usage-chart-header">
                <span class="usage-chart-title">Trend</span>
                <div class="usage-chart-controls">
                  <select aria-label="Range" class="usage-chart-select" id="usage-chart-range" title="Range">
                    <option value="7">1w</option>
                    <option selected="" value="30">1m</option>
                    <option value="90">3m</option>
                    <option value="180">6m</option>
                    <option value="365">1y</option>
                  </select>
                  <select aria-label="Group" class="usage-chart-select" id="usage-chart-segment" title="Group">
                    <option value="none">Total</option>
                    <option value="agent">Agent</option>
                    <option value="model">Model</option>
                    <option value="token_type">Token type</option>
                    <option value="model_token">Model + type</option>
                  </select>
                </div>
              </div>
              <div class="usage-chart-canvas" id="usage-chart-canvas"></div>
            </div>
            <div class="usage-rates-visual">
              <div class="usage-rate-row">
                <span class="usage-rate-label">Primary</span>
                <div class="usage-rate-bar-container" id="usage-rate-primary"></div>
              </div>
              <div class="usage-rate-row">
                <span class="usage-rate-label">Secondary</span>
                <div class="usage-rate-bar-container" id="usage-rate-secondary"></div>
              </div>
            </div>
            <div class="usage-footer">
              <span class="hidden" id="usage-rates">‚Äì</span>
              <span id="usage-meta">‚Äì</span>
            </div>
          </div>
        </div>

        <!-- Legacy analytics section removed -->
      </section>
      <section class="panel" id="inbox">
        <div class="cards">
          <div class="card">
            <div class="messages-layout">
              <div class="messages-sidebar">
                <div class="messages-thread-list" id="messages-thread-list"></div>
              </div>
              <div class="messages-main">
                <div class="messages-detail-header mobile-only">
                  <button class="messages-back-btn" id="messages-back-btn">‚Üê Back</button>
                  <div class="messages-detail-meta" id="messages-detail-meta">
                    <span class="messages-detail-status pill pill-small pill-idle" id="messages-detail-status">‚Äì</span>
                    <span class="messages-detail-counts muted" id="messages-detail-counts">‚Äì</span>
                  </div>
                </div>
                <div class="messages-thread-detail" id="messages-thread-detail">
                  <div class="messages-empty-state">
                    <div class="messages-empty-icon">üí¨</div>
                    <div class="messages-empty-title">Select a conversation</div>
                    <div class="messages-empty-hint">Choose a session from the left to view dispatches and replies.
                    </div>
                  </div>
                </div>
                <div class="messages-reply-box">
                  <textarea class="messages-reply-body" id="messages-reply-body"
                    placeholder="Write a reply‚Ä¶"></textarea>
                  <div class="messages-reply-row">
                    <input type="file" id="messages-reply-files" multiple />
                    <div class="messages-reply-actions">
                      <button class="primary sm" id="messages-reply-send">Send</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <section class="panel" id="archive">
        <div class="cards">
          <div class="card">
            <div class="archive-layout">
              <aside class="archive-sidebar">
                <div class="archive-header">
                  <span class="label">Archive</span>
                  <button class="ghost sm" id="archive-refresh">Refresh</button>
                </div>
                <div class="archive-empty muted small hidden" id="archive-empty">
                  No archived snapshots found yet. Clean up a worktree to create a snapshot.
                </div>
                <div class="archive-list" id="archive-snapshot-list"></div>
              </aside>
              <div class="archive-detail" id="archive-snapshot-detail">
                <div class="archive-empty-state">
                  <div class="archive-empty-title">Select a snapshot</div>
                  <div class="archive-empty-hint">Choose a snapshot to view metadata and summary.</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <section class="panel" id="workspace">
        <div class="workspace-header workspace-header-desktop">
          <div class="workspace-header-left">
            <h3 class="workspace-title">Workspace</h3>
            <span class="muted small" id="workspace-status"></span>
          </div>
          <div class="workspace-header-actions">
            <input type="file" id="workspace-upload-input" multiple hidden />
            <button class="ghost sm" id="workspace-upload" title="Upload to current folder">Upload</button>
            <button class="ghost sm" id="workspace-new-folder" title="Create folder">New Folder</button>
            <button class="ghost sm" id="workspace-new-file" title="Create markdown file">New File</button>
            <button class="ghost sm hidden" id="workspace-generate-tickets" title="Generate tickets from spec">Generate
              tickets</button>
            <button class="ghost sm" id="workspace-reload">Reload</button>
            <button class="primary sm" id="workspace-save">Save</button>
          </div>
        </div>
        <div class="workspace-path-row">
          <nav class="workspace-breadcrumbs" id="workspace-breadcrumbs"></nav>
          <button class="ghost sm workspace-download-all-btn" id="workspace-download-all"
            title="Download all as ZIP">‚¨á</button>
        </div>
        <div class="workspace-grid">
          <aside class="workspace-file-browser">
            <div class="workspace-file-mobile">
              <select id="workspace-file-select"></select>
            </div>
            <div class="workspace-file-list" id="workspace-file-list"></div>
          </aside>
          <div class="workspace-main">
            <div class="doc-patch-main hidden" id="workspace-patch-main">
              <div class="doc-patch-header">
                <div class="doc-patch-info">
                  <div class="muted small">Pending draft</div>
                  <div class="doc-patch-summary" id="workspace-patch-summary"></div>
                  <div class="doc-patch-meta" id="workspace-patch-meta"></div>
                  <div class="doc-patch-legend">
                    <span class="doc-patch-legend-item doc-patch-legend-add">Added</span>
                    <span class="doc-patch-legend-item doc-patch-legend-del">Removed</span>
                  </div>
                </div>
                <div class="doc-patch-actions">
                  <button class="primary sm" id="workspace-patch-apply">Apply</button>
                  <button class="ghost sm" id="workspace-patch-reload">Reload</button>
                  <button class="danger sm" id="workspace-patch-discard">Discard</button>
                </div>
              </div>
              <div class="doc-patch-body" id="workspace-patch-body">(no draft)</div>
            </div>
            <textarea id="workspace-content" spellcheck="false"></textarea>
            <!-- Mobile toolbar: file selector + actions, positioned above compose -->
            <div class="workspace-mobile-toolbar">
              <button class="workspace-file-btn" id="workspace-file-pill" type="button">
                <span class="workspace-file-btn-name" id="workspace-file-pill-name">active_context.md</span>
              </button>
              <div class="workspace-mobile-actions">
                <span class="muted small" id="workspace-status-mobile"></span>
                <button class="ghost sm" id="workspace-reload-mobile" title="Reload">‚Üª</button>
                <button class="primary sm" id="workspace-save-mobile">Save</button>
              </div>
            </div>
            <div class="doc-chat-panel compose-panel">
              <div class="doc-chat-compose">
                <div class="doc-agent-controls">
                  <select id="workspace-chat-agent-select" title="Agent"></select>
                  <select id="workspace-chat-model-select" title="Model"></select>
                  <select id="workspace-chat-reasoning-select" title="Reasoning"></select>
                </div>
                <div class="doc-chat-input-row compose-row">
                  <textarea enterkeyhint="enter" id="workspace-chat-input"
                    placeholder="Ask AI to edit this workspace doc..." rows="1" spellcheck="false"></textarea>
                  <div class="doc-chat-input-buttons compose-buttons">
                    <button class="ghost sm voice-button" id="workspace-chat-voice" title="Hold to talk"></button>
                    <button class="primary sm" id="workspace-chat-send" title="Send">‚Üë</button>
                  </div>
                </div>
                <div class="doc-chat-meta">
                  <div class="doc-chat-meta-left">
                    <span class="muted small" id="workspace-chat-hint">Cmd+Enter/Ctrl+Enter to send ¬∑ Enter for
                      newline</span>
                  </div>
                  <div class="doc-chat-meta-right">
                    <button class="ghost sm hidden doc-chat-cancel-inline" id="workspace-chat-cancel"
                      title="Cancel">‚úï</button>
                    <button class="ghost sm" id="workspace-chat-new-thread" title="Start a new chat thread">New
                      thread</button>
                    <span class="pill pill-idle" id="workspace-chat-status">idle</span>
                  </div>
                </div>
              </div>
              <div class="doc-chat-stream" id="workspace-chat-stream">
                <div class="doc-chat-error hidden" id="workspace-chat-error"></div>
                <div class="doc-chat-events hidden" id="workspace-chat-events">
                  <div class="doc-chat-section-header">
                    <div class="doc-chat-section-title">
                      Agent updates
                      <span class="doc-chat-count" id="workspace-chat-events-count">0</span>
                    </div>
                    <button class="ghost sm hidden" id="workspace-chat-events-toggle">Show more</button>
                  </div>
                  <div class="doc-chat-events-list" id="workspace-chat-events-list"></div>
                </div>
                <div class="doc-chat-section-header" id="workspace-chat-history-header">
                  <div class="doc-chat-section-title">History</div>
                </div>
                <div class="doc-chat-history" id="workspace-chat-history"></div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <section class="panel active" id="tickets">
        <div class="card ticket-card" id="ticket-card">
          <div class="card-header">
            <div class="card-header-left ticket-header-left">
              <span class="label">Ticket Flow</span>
              <span class="muted small ticket-mono" id="ticket-flow-run">‚Äì</span>
            </div>
            <span class="pill pill-idle" id="ticket-flow-status">idle</span>
          </div>
          <div class="ticket-flow-actions">
            <button class="primary sm" id="ticket-flow-bootstrap">Start Ticket Flow</button>
            <button class="ghost sm" id="ticket-flow-stop">Stop</button>
            <button class="ghost sm" id="ticket-flow-resume">Resume</button>
            <button class="ghost sm ticket-desktop-only" id="ticket-flow-restart" style="display:none;">Restart</button>
            <button class="ghost sm ticket-desktop-only" id="ticket-flow-archive" style="display:none;">Archive
              Flow</button>
            <button class="ghost sm icon-btn" id="ticket-flow-refresh" title="Refresh ticket flow">‚Üª</button>
            <!-- Overflow menu for mobile -->
            <div class="ticket-overflow-menu">
              <button class="ghost sm icon-btn" id="ticket-overflow-toggle" title="More actions">‚ãØ</button>
              <div class="ticket-overflow-dropdown hidden" id="ticket-overflow-dropdown">
                <button class="ticket-overflow-item" id="ticket-overflow-new">+ New Ticket</button>
                <button class="ticket-overflow-item" id="ticket-overflow-restart" style="display:none;">Restart</button>
                <button class="ticket-overflow-item" id="ticket-overflow-archive" style="display:none;">Archive
                  Flow</button>
              </div>
            </div>
            <button class="ghost sm ticket-desktop-only" id="ticket-new-btn" title="Create new ticket">+ New
              Ticket</button>
          </div>
          <div class="ticket-flow-meta" id="ticket-flow-meta">
            <div class="ticket-meta-details" id="ticket-meta-details">
              <div class="ticket-meta-secondary">
                <span class="muted">Current ticket</span>
                <span class="ticket-mono" id="ticket-flow-current">‚Äì</span>
              </div>
              <div class="ticket-meta-secondary">
                <span class="muted">Turn</span>
                <span class="ticket-mono" id="ticket-flow-turn">‚Äì</span>
              </div>
              <div class="ticket-meta-secondary">
                <span class="muted">Elapsed</span>
                <span class="ticket-mono" id="ticket-flow-elapsed">‚Äì</span>
              </div>
              <div class="ticket-meta-secondary">
                <span class="muted">Progress</span>
                <span class="ticket-mono" id="ticket-flow-progress">‚Äì</span>
              </div>
              <div class="ticket-meta-secondary">
                <span class="muted">Reason</span>
                <span class="ticket-mono ticket-flow-reason" id="ticket-flow-reason">‚Äì</span>
              </div>
              <div class="ticket-meta-critical">
                <span class="muted">Last activity</span>
                <span class="ticket-mono" id="ticket-flow-last-activity">‚Äì</span>
                <span class="pill pill-warn pill-small ticket-flow-pill" id="ticket-flow-stale"
                  style="display:none;">stale</span>
                <button class="ghost sm ticket-flow-action" id="ticket-flow-reconnect"
                  style="display:none;">Reconnect</button>
              </div>
              <div class="ticket-meta-critical">
                <span class="muted">Worker</span>
                <span class="ticket-mono" id="ticket-flow-worker">‚Äì</span>
                <span class="pill pill-error pill-small ticket-flow-pill" id="ticket-flow-worker-pill"
                  style="display:none;">dead</span>
                <button class="ghost sm ticket-flow-action" id="ticket-flow-recover"
                  style="display:none;">Recover</button>
              </div>
            </div>
          </div>
          <!-- Live Agent Output Panel -->
          <div class="ticket-live-output-panel" id="ticket-live-output-panel">
            <div class="ticket-live-output-header">
              <span class="ticket-live-output-title">Agent</span>
              <span class="ticket-live-output-status" id="ticket-live-output-status">Disconnected</span>
              <span class="ticket-live-output-spacer"></span>
              <button class="ticket-live-output-view-toggle" id="ticket-live-output-view-toggle"
                title="Show full output">‚ãØ</button>
            </div>
            <pre class="ticket-live-output-compact" id="ticket-live-output-compact"></pre>
            <div class="ticket-live-output-detail hidden" id="ticket-live-output-detail">
              <div class="ticket-live-output-events hidden" id="ticket-live-output-events">
                <div class="ticket-live-output-events-header">
                  <span class="muted">Events</span>
                  <span class="ticket-live-output-events-count" id="ticket-live-output-events-count">0</span>
                </div>
                <div class="ticket-chat-events-list" id="ticket-live-output-events-list"></div>
              </div>
              <pre class="ticket-live-output-text" id="ticket-live-output-text"></pre>
            </div>
          </div>
          <div class="ticket-flow-grid">
            <div class="ticket-panel">
              <div class="ticket-panel-header">
                <span class="muted">Tickets</span>
                <span class="muted small" id="ticket-flow-dir">‚Äì</span>
              </div>
              <div class="ticket-progress-bar" id="ticket-progress-bar">
                <div class="ticket-progress-fill" id="ticket-progress-fill"></div>
              </div>
              <div class="ticket-list" id="ticket-flow-tickets">Loading tickets‚Ä¶</div>
            </div>
            <div class="ticket-panel" id="dispatch-panel">
              <div class="ticket-panel-header">
                <span class="muted">Dispatch history</span>
                <span class="muted small" id="ticket-dispatch-note">‚Äì</span>
                <button class="ticket-panel-toggle" id="dispatch-panel-toggle" aria-label="Toggle dispatch panel"
                  title="Collapse/expand panel">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                    stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                  </svg>
                </button>
              </div>
              <div class="dispatch-mini-list" id="dispatch-mini-list"></div>
              <div class="ticket-list" id="ticket-dispatch-history">No dispatches yet. Agent messages will appear here.
              </div>
            </div>
          </div>
        </div>
        <!-- Ticket Editor Modal (Full Screen) -->
        <div class="modal-overlay hidden" id="ticket-editor-modal">
          <div class="modal-content ticket-editor-modal">
            <div class="modal-header ticket-editor-header">
              <div class="ticket-header-row">
                <select class="ticket-fm-select" id="ticket-fm-agent" title="Agent">
                  <option value="codex">codex</option>
                  <option value="opencode">opencode</option>
                  <option value="user">user</option>
                </select>
                <select class="ticket-fm-select" id="ticket-fm-model" title="Model"></select>
                <select class="ticket-fm-select" id="ticket-fm-reasoning" title="Reasoning"></select>
                <input class="ticket-fm-input" id="ticket-fm-title" placeholder="Title (optional)" spellcheck="false"
                  type="text">
                <div class="ticket-header-actions">
                  <button class="ghost sm icon-btn ticket-nav-btn" id="ticket-nav-prev" title="Previous ticket (‚Üê)"
                    aria-label="Previous ticket" aria-keyshortcuts="ArrowLeft Alt+ArrowLeft">‚Üê</button>
                  <button class="ghost sm icon-btn ticket-nav-btn" id="ticket-nav-next" title="Next ticket (‚Üí)"
                    aria-label="Next ticket" aria-keyshortcuts="ArrowRight Alt+ArrowRight">‚Üí</button>
                  <label class="ticket-fm-toggle" title="Mark as done">
                    <input id="ticket-fm-done" type="checkbox">
                    <span class="ticket-fm-toggle-label">Done</span>
                  </label>
                  <button class="ghost sm icon-btn" id="ticket-editor-close" title="Close">√ó</button>
                </div>
              </div>
            </div>
            <div class="ticket-editor-error hidden" id="ticket-editor-error"></div>
            <div class="ticket-editor-main">
              <!--
  MUTUALLY EXCLUSIVE VIEWS:
  The toolbar + textarea (content editor) and the patch-main (pending changes preview)
  should NEVER be shown at the same time. When there's a pending draft from AI chat,
  only show the patch preview. When there's no pending draft, only show the content editor.
  See renderTicketChat() in ticketChatActions.ts for the toggle logic.
-->
              <!-- Body Editor (hidden when patch preview is visible) -->
              <div class="ticket-editor-toolbar" id="ticket-editor-toolbar">
                <button class="ghost sm" id="ticket-insert-checkbox" title="Insert checkbox">+ Checkbox</button>
                <button class="ghost sm" id="ticket-undo-btn" title="Undo changes" disabled>Undo</button>
                <button class="danger sm hidden" id="ticket-editor-delete" title="Delete ticket">Delete</button>
                <span class="ticket-autosave-status muted small" id="ticket-autosave-status"></span>
              </div>
              <textarea id="ticket-editor-content" class="ticket-editor-textarea" spellcheck="false"
                placeholder="Describe the task details here..."></textarea>
              <!-- Patch Preview (hidden when content editor is visible) -->
              <div class="ticket-patch-main hidden" id="ticket-patch-main">
                <div class="ticket-patch-header">
                  <span class="ticket-patch-title">Pending Changes</span>
                  <span class="ticket-patch-status muted" id="ticket-patch-status"></span>
                </div>
                <div class="ticket-patch-body" id="ticket-patch-body"></div>
                <div class="ticket-patch-actions">
                  <button class="primary sm" id="ticket-patch-apply">Apply</button>
                  <button class="ghost sm" id="ticket-patch-discard">Discard</button>
                </div>
              </div>
              <!-- Chat Panel (matches Docs chat) -->
              <div class="ticket-chat-panel">
                <div class="ticket-chat-compose">
                  <div class="ticket-chat-agent-controls">
                    <select class="mobile-hide-empty" id="ticket-chat-agent-select" title="Agent"></select>
                    <select id="ticket-chat-model-select" title="Model"></select>
                    <select id="ticket-chat-reasoning-select" title="Reasoning"></select>
                  </div>
                  <div class="ticket-chat-input-row">
                    <textarea id="ticket-chat-input" class="ticket-chat-input" enterkeyhint="enter"
                      placeholder="Ask AI to edit this ticket..." rows="1" spellcheck="false"></textarea>
                    <div class="ticket-chat-input-buttons">
                      <button class="ghost sm voice-button" id="ticket-chat-voice" title="Hold to talk"></button>
                      <button class="primary sm" id="ticket-chat-send" title="Send">‚Üë</button>
                    </div>
                  </div>
                  <div class="ticket-chat-meta">
                    <div class="ticket-chat-meta-left">
                      <span class="muted small ticket-chat-hint" id="ticket-chat-hint">Cmd+Enter to send ¬∑ Enter for
                        newline</span>
                      <span class="muted small hidden ticket-chat-voice-status" id="ticket-chat-voice-status"></span>
                    </div>
                    <div class="ticket-chat-meta-right">
                      <button class="ghost sm hidden ticket-chat-cancel-inline" id="ticket-chat-cancel"
                        title="Cancel">‚úï</button>
                      <button class="ghost sm" id="ticket-chat-new-thread" title="Start a new chat thread">New
                        thread</button>
                      <span class="ticket-chat-status" id="ticket-chat-status">idle</span>
                    </div>
                  </div>
                </div>
                <!-- Rich Chat Stream: shows message history and agent events -->
                <div class="ticket-chat-stream" id="ticket-chat-stream">
                  <!-- Messages History (user prompts and assistant responses) -->
                  <div class="ticket-chat-messages" id="ticket-chat-messages"></div>
                  <!-- Agent Activity Events (thinking, tool calls, etc.) - shown during processing -->
                  <div class="ticket-chat-events hidden" id="ticket-chat-events">
                    <div class="ticket-chat-events-list" id="ticket-chat-events-list"></div>
                  </div>
                  <!-- Hidden elements for event tracking -->
                  <span class="hidden" id="ticket-chat-events-count">0</span>
                  <button class="ghost sm hidden" id="ticket-chat-events-toggle">Show more</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <section class="panel" id="terminal">
        <div class="terminal-toolbar">
          <div class="terminal-toolbar-row terminal-toolbar-main">
            <span class="terminal-status muted" id="terminal-status">Disconnected</span>
            <div class="terminal-actions">
              <button class="primary sm" id="terminal-connect">New</button>
              <button class="ghost sm" id="terminal-resume">Resume</button>
              <button class="ghost sm" id="terminal-disconnect">Disconnect</button>
            </div>
          </div>
          <div class="terminal-toolbar-row terminal-toolbar-config">
            <div class="terminal-agent-controls">
              <select id="terminal-agent-select" title="Agent"></select>
              <select id="terminal-model-select" title="Model"></select>
              <select id="terminal-reasoning-select" title="Reasoning"></select>
            </div>
            <div class="terminal-toolbar-extras">
              <button aria-controls="terminal-text-input" aria-expanded="false" class="ghost sm terminal-text-toggle"
                id="terminal-text-input-toggle" title="Text input" type="button">
                <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  viewbox="0 0 24 24">
                  <rect height="18" rx="2" width="18" x="3" y="3"></rect>
                  <line x1="7" x2="17" y1="12" y2="12"></line>
                  <line x1="7" x2="13" y1="8" y2="8"></line>
                  <line x1="7" x2="15" y1="16" y2="16"></line>
                </svg>
                <span class="terminal-text-toggle-label">Text</span>
              </button>
              <div class="terminal-voice">
                <button class="ghost sm voice-button" id="terminal-voice" title="Hold to talk"></button>
                <span class="muted small hidden voice-status" id="terminal-voice-status"></span>
              </div>
            </div>
          </div>
        </div>
        <div class="terminal-container" id="terminal-container">
          <div class="terminal-overlay" id="terminal-overlay">
            <p>Click <strong>New</strong> to start a fresh agent session, or <strong>Resume</strong> to continue an
              existing one.</p>
            <p class="terminal-overlay-hint">Use the agent dropdown above to switch between different agents.</p>
          </div>
          <button class="terminal-jump-btn hidden" id="terminal-jump-bottom" title="Jump to latest">
            ‚Üì Latest
          </button>
        </div>
        <!-- Mobile control bar - touch-friendly special keys (above text input) -->
        <div class="terminal-mobile-controls" id="terminal-mobile-controls">
          <div class="tmb-row">
            <button class="tmb-key tmb-mod" data-key="ctrl" id="tmb-ctrl">Ctrl</button>
            <button class="tmb-key tmb-mod" data-key="alt" id="tmb-alt">Alt</button>
            <button class="tmb-key" data-seq="">Esc</button>
            <button class="tmb-key" data-seq="	">Tab</button>
            <button class="tmb-key tmb-primary" data-seq="
">Enter</button>
          </div>
          <div class="tmb-row">
            <button class="tmb-key tmb-ctrl-combo" data-ctrl="c">^C</button>
            <button class="tmb-key tmb-ctrl-combo" data-ctrl="d">^D</button>
            <button class="tmb-key tmb-ctrl-combo" data-ctrl="z">^Z</button>
            <button class="tmb-key tmb-bksp" data-seq="">Bksp</button>
            <button class="tmb-key tmb-arrow" data-seq="[D">‚Üê</button>
            <button class="tmb-key tmb-arrow" data-seq="[A">‚Üë</button>
            <button class="tmb-key tmb-arrow" data-seq="[B">‚Üì</button>
            <button class="tmb-key tmb-arrow" data-seq="[C">‚Üí</button>
          </div>
        </div>
        <div aria-hidden="true" class="terminal-text-input compose-panel hidden" id="terminal-text-input">
          <label class="terminal-text-input-title" for="terminal-textarea">Text input</label>
          <div class="terminal-text-input-row compose-row">
            <textarea autocapitalize="off" autocomplete="off" enterkeyhint="enter" id="terminal-textarea"
              placeholder="Type or paste text/images to send to the terminal‚Ä¶" rows="2" spellcheck="false"></textarea>
            <div class="terminal-text-input-buttons compose-buttons">
              <button aria-label="Attach image" class="ghost sm terminal-text-image" id="terminal-text-image"
                title="Attach image" type="button">Img</button>
              <input accept="image/*" class="hidden" id="terminal-text-image-input" type="file" />
              <button class="ghost sm voice-button terminal-text-voice" data-voice-mode="waveform"
                id="terminal-text-voice" title="Hold to talk" type="button"></button>
              <button aria-label="Send" class="primary terminal-text-send-icon" id="terminal-text-send"
                type="button">‚Üí</button>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>
  <div class="toast" id="toast"></div>
  <!-- Confirmation Modal -->
  <div class="modal-overlay" hidden="" id="confirm-modal">
    <div aria-describedby="confirm-modal-message" aria-labelledby="confirm-modal-title" aria-modal="true"
      class="modal-dialog" role="dialog" tabindex="-1">
      <span class="sr-only" id="confirm-modal-title">Confirmation</span>
      <p id="confirm-modal-message"></p>
      <div class="modal-actions">
        <button class="ghost" id="confirm-modal-cancel">Cancel</button>
        <button class="danger" id="confirm-modal-ok">Confirm</button>
      </div>
    </div>
  </div>
  <!-- Input Modal -->
  <div class="modal-overlay" hidden="" id="input-modal">
    <div aria-describedby="input-modal-message" aria-labelledby="input-modal-title" aria-modal="true"
      class="modal-dialog modal-input" role="dialog" tabindex="-1">
      <span class="sr-only" id="input-modal-title">Input</span>
      <p id="input-modal-message"></p>
      <input autocomplete="off" id="input-modal-input" spellcheck="false" type="text" />
      <div class="modal-actions">
        <button class="ghost" id="input-modal-cancel">Cancel</button>
        <button class="primary" id="input-modal-ok">OK</button>
      </div>
    </div>
  </div>
  <!-- Create Repo Modal -->
  <div class="modal-overlay" hidden="" id="create-repo-modal">
    <div aria-describedby="create-repo-modal-body" aria-labelledby="create-repo-modal-title" aria-modal="true"
      class="modal-dialog modal-create-repo" role="dialog" tabindex="-1">
      <div class="modal-header">
        <span class="label" id="create-repo-modal-title">Create New Repository</span>
      </div>
      <div class="modal-body" id="create-repo-modal-body">
        <div class="form-group">
          <label for="create-repo-id">Repo ID <span class="required">*</span></label>
          <input autocomplete="off" id="create-repo-id" placeholder="my-project" spellcheck="false" type="text" />
          <span class="form-hint">Used as directory name if path not specified</span>
        </div>
        <div class="form-group">
          <label for="create-repo-path">Path <span class="optional">(optional)</span></label>
          <input autocomplete="off" id="create-repo-path" placeholder="relative/path/to/repo" spellcheck="false"
            type="text" />
          <span class="form-hint">Leave empty to use repo ID as path</span>
        </div>
        <div class="form-group">
          <label for="create-repo-url">Git URL <span class="optional">(optional)</span></label>
          <input autocomplete="off" id="create-repo-url" placeholder="https://github.com/org/repo.git"
            spellcheck="false" type="text" />
          <span class="form-hint">If provided, the repo will be cloned automatically</span>
        </div>
        <div class="form-group form-checkbox">
          <label>
            <input checked="" id="create-repo-git" type="checkbox" />
            <span>Initialize git repository</span>
          </label>
        </div>
      </div>
      <div class="modal-actions">
        <button class="ghost" id="create-repo-cancel">Cancel</button>
        <button class="primary" id="create-repo-submit">Create</button>
      </div>
    </div>
  </div>
  <!-- Hub Settings Modal -->
  <div class="modal-overlay" hidden="" id="hub-settings-modal">
    <div aria-describedby="hub-settings-modal-body" aria-labelledby="hub-settings-modal-title" aria-modal="true"
      class="modal-dialog" role="dialog" tabindex="-1">
      <div class="modal-header">
        <span class="label" id="hub-settings-modal-title">Hub Settings</span>
      </div>
      <div class="modal-body" id="hub-settings-modal-body">
        <p class="muted small">System-wide settings for Codex Autorunner.</p>
        <div class="form-group">
          <label>System Update</label>
          <select id="hub-update-target">
            <option value="both">Web + Telegram</option>
            <option value="web">Web only</option>
            <option value="telegram">Telegram only</option>
          </select>
          <button class="primary sm" id="hub-update-btn">Update CAR</button>
          <span class="form-hint">Pull latest code and restart selected services</span>
        </div>
      </div>
      <div class="modal-actions">
        <button class="ghost" id="hub-settings-close">Close</button>
      </div>
    </div>
  </div>
  <!-- Repo Settings Modal -->
  <div class="modal-overlay" hidden="" id="repo-settings-modal">
    <div aria-describedby="repo-settings-modal-body" aria-labelledby="repo-settings-modal-title" aria-modal="true"
      class="modal-dialog" role="dialog" tabindex="-1">
      <div class="modal-header">
        <span class="label" id="repo-settings-modal-title">Repo Settings</span>
      </div>
      <div class="modal-body" id="repo-settings-modal-body">
        <p class="muted small">Settings for the current repository session.</p>
        <div class="form-group">
          <label>System Update</label>
          <select id="repo-update-target">
            <option value="both">Web + Telegram</option>
            <option value="web">Web only</option>
            <option value="telegram">Telegram only</option>
          </select>
          <button class="primary sm" id="repo-update-btn">Update CAR</button>
          <span class="form-hint">Pull latest code and restart selected services</span>
        </div>
        <div class="form-group">
          <label>Autorunner Settings</label>
          <div class="settings-grid">
            <div>
              <label class="muted small" for="autorunner-model-select">Model</label>
              <select id="autorunner-model-select"></select>
            </div>
            <div>
              <label class="muted small" for="autorunner-effort-select">Reasoning effort</label>
              <select id="autorunner-effort-select"></select>
            </div>
            <div>
              <label class="muted small" for="autorunner-approval-select">Approval policy</label>
              <select id="autorunner-approval-select"></select>
            </div>
            <div>
              <label class="muted small" for="autorunner-sandbox-select">Sandbox</label>
              <select id="autorunner-sandbox-select"></select>
            </div>
            <div>
              <label class="muted small" for="autorunner-max-runs-input">Max runs</label>
              <input id="autorunner-max-runs-input" min="1" placeholder="Unlimited" step="1" type="number" />
              <span class="form-hint">Maximum number of autorunner cycles (empty = unlimited)</span>
            </div>
          </div>
          <div class="settings-toggle-row" id="autorunner-network-row">
            <label class="form-checkbox">
              <input id="autorunner-network-toggle" type="checkbox" />
              <span>Allow network access in workspace-write mode</span>
            </label>
          </div>
          <div class="settings-actions">
            <button class="primary sm" id="autorunner-settings-save">Save settings</button>
            <button class="ghost sm" id="autorunner-settings-reload">Reload</button>
          </div>
          <span class="form-hint warning" id="autorunner-settings-warning">Changing these settings starts a new
            autorunner conversation.</span>
        </div>
        <div class="form-group">
          <label>Thread Tools</label>
          <div class="thread-tools-list" id="thread-tools-list"></div>
          <div class="thread-tools-actions">
            <button class="ghost sm" id="thread-new-autorunner">New autorunner thread</button>
            <button class="ghost sm" id="thread-archive-autorunner">Archive autorunner thread</button>
            <button class="danger sm" id="thread-reset-all">Reset all conversations</button>
            <button class="ghost sm" id="thread-backup-download">Download backup</button>
          </div>
          <span class="form-hint">Resetting conversations clears stored thread IDs and restarts chats.</span>
        </div>
      </div>
      <div class="modal-actions">
        <button class="ghost" id="repo-settings-close">Close</button>
      </div>
    </div>
  </div>
  <!-- Reason Details Modal -->
  <div class="modal-overlay" hidden="" id="reason-modal">
    <div aria-describedby="reason-modal-content" aria-labelledby="reason-modal-title" aria-modal="true"
      class="modal-dialog reason-modal-dialog" role="dialog" tabindex="-1">
      <h3 class="reason-modal-title" id="reason-modal-title">Status Details</h3>
      <pre class="reason-modal-content" id="reason-modal-content"></pre>
      <div class="modal-actions">
        <button class="ghost" id="reason-modal-close">Close</button>
      </div>
    </div>
  </div>
  <!-- File Picker Modal -->
  <div class="modal-overlay file-picker-modal" hidden="" id="file-picker-modal">
    <div aria-labelledby="file-picker-modal-title" aria-modal="true" class="modal-dialog file-picker-dialog"
      role="dialog" tabindex="-1">
      <div class="file-picker-header">
        <span class="file-picker-title" id="file-picker-modal-title">Select File</span>
        <button class="file-picker-close" id="file-picker-close" aria-label="Close">&times;</button>
      </div>
      <div class="file-picker-body" id="file-picker-body">
        <!-- File list rendered here by JS -->
      </div>
    </div>
  </div>
  <!-- Workspace Create Modal -->
  <div class="modal-overlay" hidden="" id="workspace-create-modal">
    <div aria-describedby="workspace-create-body" aria-labelledby="workspace-create-title" aria-modal="true"
      class="modal-dialog workspace-create-dialog" role="dialog" tabindex="-1">
      <div class="modal-header">
        <span class="label" id="workspace-create-title">Create</span>
        <button class="file-picker-close" id="workspace-create-close" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body" id="workspace-create-body">
        <div class="form-group">
          <label class="muted small" for="workspace-create-name">Name</label>
          <input id="workspace-create-name" placeholder="my-note.md" type="text" />
          <span class="form-hint" id="workspace-create-hint">Created under current folder</span>
        </div>
        <div class="form-group">
          <label class="muted small" for="workspace-create-path">Location</label>
          <select id="workspace-create-path"></select>
        </div>
      </div>
      <div class="modal-actions workspace-create-actions">
        <button class="ghost sm" id="workspace-create-cancel">Cancel</button>
        <button class="primary sm" id="workspace-create-submit">Create</button>
      </div>
    </div>
  </div>
  <!-- Workspace Confirm Modal -->
  <div class="modal-overlay" hidden="" id="workspace-confirm-modal">
    <div aria-describedby="workspace-confirm-body" aria-labelledby="workspace-confirm-title" aria-modal="true"
      class="modal-dialog workspace-confirm-dialog" role="dialog" tabindex="-1">
      <div class="modal-header">
        <span class="label" id="workspace-confirm-title">Confirm</span>
      </div>
      <div class="modal-body" id="workspace-confirm-body">
        <p id="workspace-confirm-text"></p>
      </div>
      <div class="modal-actions workspace-confirm-actions">
        <button class="ghost sm" id="workspace-confirm-cancel">Cancel</button>
        <button class="primary sm" id="workspace-confirm-yes">Confirm</button>
      </div>
    </div>
  </div>
  <script data-car-loader="" src="static/loader.js?v=__CAR_ASSET_VERSION__"></script>
</body>

</html>