"""Relation type definitions generated from a TypeDB schema."""

from type_bridge import {{ imports | join(', ') }}

from . import attributes, entities


def _multi(role: Role) -> Role:
    """Attach allowed_player_types for compatibility with MultiRole."""
    role.allowed_player_types = role.player_entity_types
    return role


{% for relation in relations %}
class {{ relation.class_name }}({{ relation.base_class }}):
    """{{ relation.docstring }}"""
    flags = TypeFlags({{ relation.flags_args | join(', ') }})
{% for attr_field in relation.attr_fields %}
    {{ attr_field }}
{% endfor %}
{% for role_field in relation.role_fields %}
    {{ role_field }}
{% endfor %}
{% if relation.cascade_attrs %}
    # TODO: @cascade annotation (coming soon in TypeDB)
    # cascade_attrs: {{ relation.cascade_attrs }}
{% endif %}
{% if relation.subkey_groups %}
    # TODO: @subkey annotation (coming soon in TypeDB)
{% for group, attrs in relation.subkey_groups.items() %}
    # subkey_group "{{ group }}": {{ attrs }}
{% endfor %}
{% endif %}
{% if relation.distinct_roles %}
    # TODO: @distinct annotation (coming soon in TypeDB)
    # distinct_roles: {{ relation.distinct_roles }}
{% endif %}


{% endfor %}
def get_roles(relation_cls: type[Relation]) -> dict[str, Role]:
    """Expose relation roles for introspection."""
    return relation_cls.get_roles()


__all__ = [
{% for name in all_names %}
    "{{ name }}",
{% endfor %}
    "get_roles",
]
