{"version":3,"file":"cloudRemoteConfig-lGXiftQH.js","names":[],"sources":["../../src/extensions/core/cloudRemoteConfig.ts"],"sourcesContent":["import { watchDebounced } from '@vueuse/core'\n\nimport { useCurrentUser } from '@/composables/auth/useCurrentUser'\nimport { useSubscription } from '@/platform/cloud/subscription/composables/useSubscription'\nimport { refreshRemoteConfig } from '@/platform/remoteConfig/refreshRemoteConfig'\nimport { useExtensionService } from '@/services/extensionService'\n\n/**\n * Cloud-only extension that polls for remote config updates\n * Initial config load happens in main.ts before any other imports\n */\nuseExtensionService().registerExtension({\n  name: 'Comfy.Cloud.RemoteConfig',\n\n  setup: async () => {\n    const { isLoggedIn } = useCurrentUser()\n    const { isActiveSubscription } = useSubscription()\n\n    // Refresh config when auth or subscription status changes\n    // Primary auth refresh is handled by WorkspaceAuthGate on mount\n    // This watcher handles subscription changes and acts as a backup for auth\n    watchDebounced(\n      [isLoggedIn, isActiveSubscription],\n      () => {\n        if (!isLoggedIn.value) return\n        void refreshRemoteConfig()\n      },\n      { debounce: 256, immediate: true }\n    )\n\n    // Poll for config updates every 10 minutes (with auth)\n    setInterval(() => void refreshRemoteConfig(), 600_000)\n  }\n})\n"],"mappings":"mRAA+B,IAEA,IACC,IACI,IACA,CAMpC,GAAqB,CAAC,kBAAkB,CACtC,KAAM,2BAEN,MAAO,SAAY,CACjB,GAAM,CAAE,cAAe,GAAgB,CACjC,CAAE,wBAAyB,GAAiB,CAKlD,EACE,CAAC,EAAY,EAAqB,KAC5B,CACC,EAAW,OACX,GAAqB,EAE5B,CAAE,SAAU,IAAK,UAAW,GAAM,CACnC,CAGD,gBAAkB,KAAK,GAAqB,CAAE,IAAQ,EAEzD,CAAC"}