{"version":3,"file":"refreshRemoteConfig-WEXOjGVw.js","names":[],"sources":["../../src/platform/remoteConfig/refreshRemoteConfig.ts"],"sourcesContent":["import { api } from '@/scripts/api'\n\nimport { remoteConfig, remoteConfigState } from './remoteConfig'\n\ninterface RefreshRemoteConfigOptions {\n  /**\n   * Whether to use authenticated API (default: true).\n   * Set to false during bootstrap before auth is initialized.\n   */\n  useAuth?: boolean\n}\n\n/**\n * Loads remote configuration from the backend /features endpoint\n * and updates the reactive remoteConfig ref.\n *\n * Sets remoteConfigState to:\n * - 'anonymous' when loaded without auth\n * - 'authenticated' when loaded with auth\n * - 'error' when load fails\n */\nexport async function refreshRemoteConfig(\n  options: RefreshRemoteConfigOptions = {}\n): Promise<void> {\n  const { useAuth = true } = options\n\n  try {\n    const response = useAuth\n      ? await api.fetchApi('/features', { cache: 'no-store' })\n      : await fetch('/api/features', { cache: 'no-store' })\n\n    if (response.ok) {\n      const config = await response.json()\n      window.__CONFIG__ = config\n      remoteConfig.value = config\n      remoteConfigState.value = useAuth ? 'authenticated' : 'anonymous'\n      return\n    }\n\n    console.warn('Failed to load remote config:', response.statusText)\n    if (response.status === 401 || response.status === 403) {\n      window.__CONFIG__ = {}\n      remoteConfig.value = {}\n      remoteConfigState.value = 'error'\n    }\n  } catch (error) {\n    console.error('Failed to fetch remote config:', error)\n    window.__CONFIG__ = {}\n    remoteConfig.value = {}\n    remoteConfigState.value = 'error'\n  }\n}\n"],"mappings":"+JAqBA,eAAsB,oBACpB,EAAsC,EAAE,CACzB,CACf,GAAM,CAAE,UAAU,IAAS,EAE3B,GAAI,CACF,IAAM,EAAW,EACb,MAAM,EAAI,SAAS,YAAa,CAAE,MAAO,WAAY,CAAC,CACtD,MAAM,MAAM,gBAAiB,CAAE,MAAO,WAAY,CAAC,CAEvD,GAAI,EAAS,GAAI,CACf,IAAM,EAAS,MAAM,EAAS,MAAM,CACpC,OAAO,WAAa,EACpB,EAAa,MAAQ,EACrB,EAAkB,MAAQ,EAAU,gBAAkB,YACtD,OAGF,QAAQ,KAAK,gCAAiC,EAAS,WAAW,EAC9D,EAAS,SAAW,KAAO,EAAS,SAAW,OACjD,OAAO,WAAa,EAAE,CACtB,EAAa,MAAQ,EAAE,CACvB,EAAkB,MAAQ,eAErB,EAAO,CACd,QAAQ,MAAM,iCAAkC,EAAM,CACtD,OAAO,WAAa,EAAE,CACtB,EAAa,MAAQ,EAAE,CACvB,EAAkB,MAAQ,0BAjDV,IAE4B"}