{"version":3,"mappings":";0cAAqC,IACI,IAEjB,IACQ,IACC,IACb,IACiB,IACR,KAEhB,EAAoB,EAAY,gBAAmB,CAC9D,IAAM,EAAe,GAAiB,CAChC,EAAgB,GAAkB,CAElC,CACJ,QAAS,EACT,MAAO,EACP,QAAS,GACP,EACF,SAAY,CACV,GAAM,CAAE,6CAAF,CAAE,wBAAyB,MAAM,OAAO,6BAAtC,+EAER,EADiB,MAAM,EAAI,oBAAoB,CACjB,EAEhC,OACA,CAAE,UAAW,GAAO,CACrB,CAEG,EAAe,GAEnB,SAAS,yBAA0B,CAC7B,IACJ,EAAe,GACV,EAAa,MAAM,CACnB,EAAc,eAAe,EAGpC,eAAe,qBAAsB,CACnC,IAAM,EAAY,GAAc,CAGhC,GAFA,MAAM,EAAU,YAAY,CAExB,EAAS,CACX,GAAM,CAAE,iBAAkB,EAAY,GAAsB,CAAC,CAC7D,MAAM,EAAM,EAAc,CAAC,KAAK,GAAK,CAGvC,GAAM,CAAE,cAAe,EAAY,EAAU,CAC7C,MAAM,EAAM,EAAW,CAAC,KAAK,GAAM,CAE9B,GAAU,CACf,yBAAyB,CAG3B,MAAO,CACL,cACA,YACA,oBACD,EACD","names":[],"ignoreList":[],"sources":["../../src/stores/bootstrapStore.ts"],"sourcesContent":["import { until, useAsyncState } from '@vueuse/core'\nimport { defineStore, storeToRefs } from 'pinia'\n\nimport { isCloud } from '@/platform/distribution/types'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { api } from '@/scripts/api'\nimport { useFirebaseAuthStore } from '@/stores/firebaseAuthStore'\nimport { useUserStore } from '@/stores/userStore'\n\nexport const useBootstrapStore = defineStore('bootstrap', () => {\n  const settingStore = useSettingStore()\n  const workflowStore = useWorkflowStore()\n\n  const {\n    isReady: isI18nReady,\n    error: i18nError,\n    execute: loadI18n\n  } = useAsyncState(\n    async () => {\n      const { mergeCustomNodesI18n } = await import('@/i18n')\n      const i18nData = await api.getCustomNodesI18n()\n      mergeCustomNodesI18n(i18nData)\n    },\n    undefined,\n    { immediate: false }\n  )\n\n  let storesLoaded = false\n\n  function loadAuthenticatedStores() {\n    if (storesLoaded) return\n    storesLoaded = true\n    void settingStore.load()\n    void workflowStore.loadWorkflows()\n  }\n\n  async function startStoreBootstrap() {\n    const userStore = useUserStore()\n    await userStore.initialize()\n\n    if (isCloud) {\n      const { isInitialized } = storeToRefs(useFirebaseAuthStore())\n      await until(isInitialized).toBe(true)\n    }\n\n    const { needsLogin } = storeToRefs(userStore)\n    await until(needsLogin).toBe(false)\n\n    void loadI18n()\n    loadAuthenticatedStores()\n  }\n\n  return {\n    isI18nReady,\n    i18nError,\n    startStoreBootstrap\n  }\n})\n"],"file":"bootstrapStore-5CCVTG-h.js"}