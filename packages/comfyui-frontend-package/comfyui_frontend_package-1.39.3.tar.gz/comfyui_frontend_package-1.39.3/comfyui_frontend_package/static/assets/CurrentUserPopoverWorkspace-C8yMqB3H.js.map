{"version":3,"file":"CurrentUserPopoverWorkspace-C8yMqB3H.js","names":[],"sources":["../../src/platform/auth/workspace/useWorkspaceSwitch.ts","../../src/components/topbar/WorkspaceSwitcherPopover.vue","../../src/components/topbar/WorkspaceSwitcherPopover.vue","../../src/components/topbar/CurrentUserPopoverWorkspace.vue","../../src/components/topbar/CurrentUserPopoverWorkspace.vue"],"sourcesContent":["import { storeToRefs } from 'pinia'\nimport { useI18n } from 'vue-i18n'\n\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useTeamWorkspaceStore } from '@/platform/workspace/stores/teamWorkspaceStore'\nimport { useDialogService } from '@/services/dialogService'\n\nexport function useWorkspaceSwitch() {\n  const { t } = useI18n()\n  const workspaceStore = useTeamWorkspaceStore()\n  const { activeWorkspace } = storeToRefs(workspaceStore)\n  const workflowStore = useWorkflowStore()\n  const dialogService = useDialogService()\n\n  function hasUnsavedChanges(): boolean {\n    return workflowStore.modifiedWorkflows.length > 0\n  }\n\n  async function switchWithConfirmation(workspaceId: string): Promise<boolean> {\n    if (activeWorkspace.value?.id === workspaceId) {\n      return true\n    }\n\n    if (hasUnsavedChanges()) {\n      const confirmed = await dialogService.confirm({\n        title: t('workspace.unsavedChanges.title'),\n        message: t('workspace.unsavedChanges.message'),\n        type: 'dirtyClose'\n      })\n\n      if (!confirmed) {\n        return false\n      }\n    }\n\n    try {\n      await workspaceStore.switchWorkspace(workspaceId)\n      // Note: switchWorkspace triggers page reload internally\n      return true\n    } catch {\n      return false\n    }\n  }\n\n  return {\n    hasUnsavedChanges,\n    switchWithConfirmation\n  }\n}\n","<template>\n  <div class=\"flex w-80 flex-col overflow-hidden rounded-lg\">\n    <div class=\"flex flex-col overflow-y-auto\">\n      <!-- Loading state -->\n      <div v-if=\"isFetchingWorkspaces\" class=\"flex flex-col gap-2 p-2\">\n        <div\n          v-for=\"i in 2\"\n          :key=\"i\"\n          class=\"flex h-[54px] animate-pulse items-center gap-2 rounded px-2 py-4\"\n        >\n          <div class=\"size-8 rounded-full bg-secondary-background\" />\n          <div class=\"flex flex-1 flex-col gap-1\">\n            <div class=\"h-4 w-24 rounded bg-secondary-background\" />\n            <div class=\"h-3 w-16 rounded bg-secondary-background\" />\n          </div>\n        </div>\n      </div>\n\n      <!-- Workspace list -->\n      <template v-else>\n        <template v-for=\"workspace in availableWorkspaces\" :key=\"workspace.id\">\n          <div class=\"border-b border-border-default p-2\">\n            <div\n              :class=\"\n                cn(\n                  'group flex h-[54px] w-full items-center gap-2 rounded px-2 py-4',\n                  'hover:bg-secondary-background-hover',\n                  isCurrentWorkspace(workspace) && 'bg-secondary-background'\n                )\n              \"\n            >\n              <button\n                class=\"flex flex-1 cursor-pointer items-center gap-2 border-none bg-transparent p-0\"\n                @click=\"handleSelectWorkspace(workspace)\"\n              >\n                <WorkspaceProfilePic\n                  class=\"size-8 text-sm\"\n                  :workspace-name=\"workspace.name\"\n                />\n                <div class=\"flex min-w-0 flex-1 flex-col items-start gap-1\">\n                  <div class=\"flex items-center gap-1.5\">\n                    <span class=\"text-sm text-base-foreground\">\n                      {{\n                        workspace.type === 'personal'\n                          ? $t('workspaceSwitcher.personal')\n                          : workspace.name\n                      }}\n                    </span>\n                    <span\n                      v-if=\"getTierLabel(workspace)\"\n                      class=\"text-[10px] font-bold uppercase text-base-background bg-base-foreground px-1 py-0.5 rounded-full\"\n                    >\n                      {{ getTierLabel(workspace) }}\n                    </span>\n                  </div>\n                  <span class=\"text-xs text-muted-foreground\">\n                    {{ getRoleLabel(workspace.role) }}\n                  </span>\n                </div>\n                <i\n                  v-if=\"isCurrentWorkspace(workspace)\"\n                  class=\"pi pi-check text-sm text-base-foreground\"\n                />\n              </button>\n            </div>\n          </div>\n        </template>\n      </template>\n\n      <!-- Create workspace button -->\n      <div class=\"px-2 py-2\">\n        <div\n          :class=\"\n            cn(\n              'flex h-12 w-full items-center gap-2 rounded px-2 py-2',\n              canCreateWorkspace\n                ? 'cursor-pointer hover:bg-secondary-background-hover'\n                : 'cursor-default'\n            )\n          \"\n          @click=\"canCreateWorkspace && handleCreateWorkspace()\"\n        >\n          <div\n            :class=\"\n              cn(\n                'flex size-8 items-center justify-center rounded-full bg-secondary-background',\n                !canCreateWorkspace && 'opacity-50'\n              )\n            \"\n          >\n            <i class=\"pi pi-plus text-sm text-muted-foreground\" />\n          </div>\n          <div class=\"flex min-w-0 flex-1 flex-col\">\n            <span\n              v-if=\"canCreateWorkspace\"\n              class=\"text-sm text-muted-foreground\"\n            >\n              {{ $t('workspaceSwitcher.createWorkspace') }}\n            </span>\n            <span v-else class=\"text-sm text-muted-foreground\">\n              {{ $t('workspaceSwitcher.maxWorkspacesReached') }}\n            </span>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { storeToRefs } from 'pinia'\nimport { computed } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport WorkspaceProfilePic from '@/components/common/WorkspaceProfilePic.vue'\nimport { useWorkspaceSwitch } from '@/platform/auth/workspace/useWorkspaceSwitch'\nimport { useSubscription } from '@/platform/cloud/subscription/composables/useSubscription'\nimport type {\n  WorkspaceRole,\n  WorkspaceType\n} from '@/platform/workspace/api/workspaceApi'\nimport { useTeamWorkspaceStore } from '@/platform/workspace/stores/teamWorkspaceStore'\nimport { cn } from '@/utils/tailwindUtil'\n\ntype SubscriptionPlan = 'PRO_MONTHLY' | 'PRO_YEARLY' | null\n\ninterface AvailableWorkspace {\n  id: string\n  name: string\n  type: WorkspaceType\n  role: WorkspaceRole\n  isSubscribed: boolean\n  subscriptionPlan: SubscriptionPlan\n}\n\nconst emit = defineEmits<{\n  select: [workspace: AvailableWorkspace]\n  create: []\n}>()\n\nconst { t } = useI18n()\nconst { switchWithConfirmation } = useWorkspaceSwitch()\nconst { subscriptionTierName: userSubscriptionTierName } = useSubscription()\n\nconst workspaceStore = useTeamWorkspaceStore()\nconst { workspaceId, workspaces, canCreateWorkspace, isFetchingWorkspaces } =\n  storeToRefs(workspaceStore)\n\nconst availableWorkspaces = computed<AvailableWorkspace[]>(() =>\n  workspaces.value.map((w) => ({\n    id: w.id,\n    name: w.name,\n    type: w.type,\n    role: w.role,\n    isSubscribed: w.isSubscribed,\n    subscriptionPlan: w.subscriptionPlan\n  }))\n)\n\nfunction isCurrentWorkspace(workspace: AvailableWorkspace): boolean {\n  return workspace.id === workspaceId.value\n}\n\nfunction getRoleLabel(role: AvailableWorkspace['role']): string {\n  if (role === 'owner') return t('workspaceSwitcher.roleOwner')\n  if (role === 'member') return t('workspaceSwitcher.roleMember')\n  return ''\n}\n\nfunction getTierLabel(workspace: AvailableWorkspace): string | null {\n  // Personal workspace: use user's subscription tier\n  if (workspace.type === 'personal') {\n    return userSubscriptionTierName.value || null\n  }\n  // Team workspace: use workspace subscription plan\n  if (!workspace.isSubscribed || !workspace.subscriptionPlan) return null\n  if (workspace.subscriptionPlan === 'PRO_MONTHLY')\n    return t('subscription.tiers.pro.name')\n  if (workspace.subscriptionPlan === 'PRO_YEARLY')\n    return t('subscription.tierNameYearly', {\n      name: t('subscription.tiers.pro.name')\n    })\n  return null\n}\n\nasync function handleSelectWorkspace(workspace: AvailableWorkspace) {\n  const success = await switchWithConfirmation(workspace.id)\n  if (success) {\n    emit('select', workspace)\n  }\n}\n\nfunction handleCreateWorkspace() {\n  emit('create')\n}\n</script>\n","<template>\n  <div class=\"flex w-80 flex-col overflow-hidden rounded-lg\">\n    <div class=\"flex flex-col overflow-y-auto\">\n      <!-- Loading state -->\n      <div v-if=\"isFetchingWorkspaces\" class=\"flex flex-col gap-2 p-2\">\n        <div\n          v-for=\"i in 2\"\n          :key=\"i\"\n          class=\"flex h-[54px] animate-pulse items-center gap-2 rounded px-2 py-4\"\n        >\n          <div class=\"size-8 rounded-full bg-secondary-background\" />\n          <div class=\"flex flex-1 flex-col gap-1\">\n            <div class=\"h-4 w-24 rounded bg-secondary-background\" />\n            <div class=\"h-3 w-16 rounded bg-secondary-background\" />\n          </div>\n        </div>\n      </div>\n\n      <!-- Workspace list -->\n      <template v-else>\n        <template v-for=\"workspace in availableWorkspaces\" :key=\"workspace.id\">\n          <div class=\"border-b border-border-default p-2\">\n            <div\n              :class=\"\n                cn(\n                  'group flex h-[54px] w-full items-center gap-2 rounded px-2 py-4',\n                  'hover:bg-secondary-background-hover',\n                  isCurrentWorkspace(workspace) && 'bg-secondary-background'\n                )\n              \"\n            >\n              <button\n                class=\"flex flex-1 cursor-pointer items-center gap-2 border-none bg-transparent p-0\"\n                @click=\"handleSelectWorkspace(workspace)\"\n              >\n                <WorkspaceProfilePic\n                  class=\"size-8 text-sm\"\n                  :workspace-name=\"workspace.name\"\n                />\n                <div class=\"flex min-w-0 flex-1 flex-col items-start gap-1\">\n                  <div class=\"flex items-center gap-1.5\">\n                    <span class=\"text-sm text-base-foreground\">\n                      {{\n                        workspace.type === 'personal'\n                          ? $t('workspaceSwitcher.personal')\n                          : workspace.name\n                      }}\n                    </span>\n                    <span\n                      v-if=\"getTierLabel(workspace)\"\n                      class=\"text-[10px] font-bold uppercase text-base-background bg-base-foreground px-1 py-0.5 rounded-full\"\n                    >\n                      {{ getTierLabel(workspace) }}\n                    </span>\n                  </div>\n                  <span class=\"text-xs text-muted-foreground\">\n                    {{ getRoleLabel(workspace.role) }}\n                  </span>\n                </div>\n                <i\n                  v-if=\"isCurrentWorkspace(workspace)\"\n                  class=\"pi pi-check text-sm text-base-foreground\"\n                />\n              </button>\n            </div>\n          </div>\n        </template>\n      </template>\n\n      <!-- Create workspace button -->\n      <div class=\"px-2 py-2\">\n        <div\n          :class=\"\n            cn(\n              'flex h-12 w-full items-center gap-2 rounded px-2 py-2',\n              canCreateWorkspace\n                ? 'cursor-pointer hover:bg-secondary-background-hover'\n                : 'cursor-default'\n            )\n          \"\n          @click=\"canCreateWorkspace && handleCreateWorkspace()\"\n        >\n          <div\n            :class=\"\n              cn(\n                'flex size-8 items-center justify-center rounded-full bg-secondary-background',\n                !canCreateWorkspace && 'opacity-50'\n              )\n            \"\n          >\n            <i class=\"pi pi-plus text-sm text-muted-foreground\" />\n          </div>\n          <div class=\"flex min-w-0 flex-1 flex-col\">\n            <span\n              v-if=\"canCreateWorkspace\"\n              class=\"text-sm text-muted-foreground\"\n            >\n              {{ $t('workspaceSwitcher.createWorkspace') }}\n            </span>\n            <span v-else class=\"text-sm text-muted-foreground\">\n              {{ $t('workspaceSwitcher.maxWorkspacesReached') }}\n            </span>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { storeToRefs } from 'pinia'\nimport { computed } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport WorkspaceProfilePic from '@/components/common/WorkspaceProfilePic.vue'\nimport { useWorkspaceSwitch } from '@/platform/auth/workspace/useWorkspaceSwitch'\nimport { useSubscription } from '@/platform/cloud/subscription/composables/useSubscription'\nimport type {\n  WorkspaceRole,\n  WorkspaceType\n} from '@/platform/workspace/api/workspaceApi'\nimport { useTeamWorkspaceStore } from '@/platform/workspace/stores/teamWorkspaceStore'\nimport { cn } from '@/utils/tailwindUtil'\n\ntype SubscriptionPlan = 'PRO_MONTHLY' | 'PRO_YEARLY' | null\n\ninterface AvailableWorkspace {\n  id: string\n  name: string\n  type: WorkspaceType\n  role: WorkspaceRole\n  isSubscribed: boolean\n  subscriptionPlan: SubscriptionPlan\n}\n\nconst emit = defineEmits<{\n  select: [workspace: AvailableWorkspace]\n  create: []\n}>()\n\nconst { t } = useI18n()\nconst { switchWithConfirmation } = useWorkspaceSwitch()\nconst { subscriptionTierName: userSubscriptionTierName } = useSubscription()\n\nconst workspaceStore = useTeamWorkspaceStore()\nconst { workspaceId, workspaces, canCreateWorkspace, isFetchingWorkspaces } =\n  storeToRefs(workspaceStore)\n\nconst availableWorkspaces = computed<AvailableWorkspace[]>(() =>\n  workspaces.value.map((w) => ({\n    id: w.id,\n    name: w.name,\n    type: w.type,\n    role: w.role,\n    isSubscribed: w.isSubscribed,\n    subscriptionPlan: w.subscriptionPlan\n  }))\n)\n\nfunction isCurrentWorkspace(workspace: AvailableWorkspace): boolean {\n  return workspace.id === workspaceId.value\n}\n\nfunction getRoleLabel(role: AvailableWorkspace['role']): string {\n  if (role === 'owner') return t('workspaceSwitcher.roleOwner')\n  if (role === 'member') return t('workspaceSwitcher.roleMember')\n  return ''\n}\n\nfunction getTierLabel(workspace: AvailableWorkspace): string | null {\n  // Personal workspace: use user's subscription tier\n  if (workspace.type === 'personal') {\n    return userSubscriptionTierName.value || null\n  }\n  // Team workspace: use workspace subscription plan\n  if (!workspace.isSubscribed || !workspace.subscriptionPlan) return null\n  if (workspace.subscriptionPlan === 'PRO_MONTHLY')\n    return t('subscription.tiers.pro.name')\n  if (workspace.subscriptionPlan === 'PRO_YEARLY')\n    return t('subscription.tierNameYearly', {\n      name: t('subscription.tiers.pro.name')\n    })\n  return null\n}\n\nasync function handleSelectWorkspace(workspace: AvailableWorkspace) {\n  const success = await switchWithConfirmation(workspace.id)\n  if (success) {\n    emit('select', workspace)\n  }\n}\n\nfunction handleCreateWorkspace() {\n  emit('create')\n}\n</script>\n","<!-- A popover that shows current user information and actions -->\n<template>\n  <div\n    class=\"current-user-popover w-80 -m-3 p-2 rounded-lg border border-border-default bg-base-background shadow-[1px_1px_8px_0_rgba(0,0,0,0.4)]\"\n  >\n    <!-- User Info Section -->\n    <div class=\"flex flex-col items-center px-0 py-3 mb-4\">\n      <UserAvatar\n        class=\"mb-1\"\n        :photo-url=\"userPhotoUrl\"\n        :pt:icon:class=\"{\n          'text-2xl!': !userPhotoUrl\n        }\"\n        size=\"large\"\n      />\n\n      <!-- User Details -->\n      <h3 class=\"my-0 mb-1 truncate text-base font-bold text-base-foreground\">\n        {{ userDisplayName || $t('g.user') }}\n      </h3>\n      <p v-if=\"userEmail\" class=\"my-0 truncate text-sm text-muted\">\n        {{ userEmail }}\n      </p>\n    </div>\n\n    <!-- Workspace Selector -->\n    <div\n      class=\"flex cursor-pointer items-center justify-between rounded-lg px-4 py-2 hover:bg-secondary-background-hover\"\n      @click=\"toggleWorkspaceSwitcher\"\n    >\n      <div class=\"flex min-w-0 flex-1 items-center gap-2\">\n        <WorkspaceProfilePic\n          class=\"size-6 shrink-0 text-xs\"\n          :workspace-name=\"workspaceName\"\n        />\n        <span class=\"truncate text-sm text-base-foreground\">{{\n          workspaceName\n        }}</span>\n      </div>\n      <i class=\"pi pi-chevron-down shrink-0 text-sm text-muted-foreground\" />\n    </div>\n\n    <Popover\n      ref=\"workspaceSwitcherPopover\"\n      append-to=\"body\"\n      :pt=\"{\n        content: {\n          class: 'p-0'\n        }\n      }\"\n    >\n      <WorkspaceSwitcherPopover\n        @select=\"workspaceSwitcherPopover?.hide()\"\n        @create=\"handleCreateWorkspace\"\n      />\n    </Popover>\n\n    <!-- Credits Section (PERSONAL and OWNER only) -->\n    <template v-if=\"showCreditsSection\">\n      <div class=\"flex items-center gap-2 px-4 py-2\">\n        <i class=\"icon-[lucide--component] text-sm text-amber-400\" />\n        <Skeleton\n          v-if=\"isLoadingBalance\"\n          width=\"4rem\"\n          height=\"1.25rem\"\n          class=\"w-full\"\n        />\n        <span v-else class=\"text-base font-semibold text-base-foreground\">{{\n          displayedCredits\n        }}</span>\n        <i\n          v-tooltip=\"{ value: $t('credits.unified.tooltip'), showDelay: 300 }\"\n          class=\"icon-[lucide--circle-help] mr-auto cursor-help text-base text-muted-foreground\"\n        />\n        <!-- Subscribed: Show Add Credits button -->\n        <Button\n          v-if=\"isActiveSubscription && isWorkspaceSubscribed\"\n          variant=\"secondary\"\n          size=\"sm\"\n          class=\"text-base-foreground\"\n          data-testid=\"add-credits-button\"\n          @click=\"handleTopUp\"\n        >\n          {{ $t('subscription.addCredits') }}\n        </Button>\n        <!-- Unsubscribed: Show Subscribe button -->\n        <SubscribeButton\n          v-else-if=\"isPersonalWorkspace\"\n          :fluid=\"false\"\n          :label=\"$t('workspaceSwitcher.subscribe')\"\n          size=\"sm\"\n          variant=\"gradient\"\n        />\n        <!-- Non-personal workspace: Navigate to workspace settings -->\n        <Button\n          v-else\n          variant=\"primary\"\n          size=\"sm\"\n          @click=\"handleOpenPlanAndCreditsSettings\"\n        >\n          {{ $t('workspaceSwitcher.subscribe') }}\n        </Button>\n      </div>\n\n      <Divider class=\"mx-0 my-2\" />\n    </template>\n\n    <!-- Plans & Pricing (PERSONAL and OWNER only) -->\n    <div\n      v-if=\"showPlansAndPricing\"\n      class=\"flex cursor-pointer items-center gap-2 px-4 py-2 hover:bg-secondary-background-hover\"\n      data-testid=\"plans-pricing-menu-item\"\n      @click=\"handleOpenPlansAndPricing\"\n    >\n      <i class=\"icon-[lucide--receipt-text] text-sm text-muted-foreground\" />\n      <span class=\"flex-1 text-sm text-base-foreground\">{{\n        $t('subscription.plansAndPricing')\n      }}</span>\n      <span\n        v-if=\"canUpgrade\"\n        class=\"rounded-full bg-base-foreground px-1.5 py-0.5 text-xs font-bold text-base-background\"\n      >\n        {{ $t('subscription.upgrade') }}\n      </span>\n    </div>\n\n    <!-- Manage Plan (PERSONAL and OWNER, only if subscribed) -->\n    <div\n      v-if=\"showManagePlan\"\n      class=\"flex cursor-pointer items-center gap-2 px-4 py-2 hover:bg-secondary-background-hover\"\n      data-testid=\"manage-plan-menu-item\"\n      @click=\"handleOpenPlanAndCreditsSettings\"\n    >\n      <i class=\"icon-[lucide--file-text] text-sm text-muted-foreground\" />\n      <span class=\"flex-1 text-sm text-base-foreground\">{{\n        $t('subscription.managePlan')\n      }}</span>\n    </div>\n\n    <!-- Partner Nodes Pricing (always shown) -->\n    <div\n      class=\"flex cursor-pointer items-center gap-2 px-4 py-2 hover:bg-secondary-background-hover\"\n      data-testid=\"partner-nodes-menu-item\"\n      @click=\"handleOpenPartnerNodesInfo\"\n    >\n      <i class=\"icon-[lucide--tag] text-sm text-muted-foreground\" />\n      <span class=\"flex-1 text-sm text-base-foreground\">{{\n        $t('subscription.partnerNodesCredits')\n      }}</span>\n    </div>\n\n    <Divider class=\"mx-0 my-2\" />\n\n    <!-- Workspace Settings (always shown) -->\n    <div\n      class=\"flex cursor-pointer items-center gap-2 px-4 py-2 hover:bg-secondary-background-hover\"\n      data-testid=\"workspace-settings-menu-item\"\n      @click=\"handleOpenWorkspaceSettings\"\n    >\n      <i class=\"icon-[lucide--users] text-sm text-muted-foreground\" />\n      <span class=\"flex-1 text-sm text-base-foreground\">{{\n        $t('userSettings.workspaceSettings')\n      }}</span>\n    </div>\n\n    <!-- Account Settings (always shown) -->\n    <div\n      class=\"flex cursor-pointer items-center gap-2 px-4 py-2 hover:bg-secondary-background-hover\"\n      data-testid=\"user-settings-menu-item\"\n      @click=\"handleOpenUserSettings\"\n    >\n      <i class=\"icon-[lucide--settings-2] text-sm text-muted-foreground\" />\n      <span class=\"flex-1 text-sm text-base-foreground\">{{\n        $t('userSettings.accountSettings')\n      }}</span>\n    </div>\n\n    <Divider class=\"mx-0 my-2\" />\n\n    <!-- Logout (always shown) -->\n    <div\n      class=\"flex cursor-pointer items-center gap-2 px-4 py-2 hover:bg-secondary-background-hover\"\n      data-testid=\"logout-menu-item\"\n      @click=\"handleLogout\"\n    >\n      <i class=\"icon-[lucide--log-out] text-sm text-muted-foreground\" />\n      <span class=\"flex-1 text-sm text-base-foreground\">{{\n        $t('auth.signOut.signOut')\n      }}</span>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { storeToRefs } from 'pinia'\nimport Divider from 'primevue/divider'\nimport Popover from 'primevue/popover'\nimport Skeleton from 'primevue/skeleton'\nimport { computed, onMounted, ref } from 'vue'\n\nimport UserAvatar from '@/components/common/UserAvatar.vue'\nimport WorkspaceProfilePic from '@/components/common/WorkspaceProfilePic.vue'\nimport WorkspaceSwitcherPopover from '@/components/topbar/WorkspaceSwitcherPopover.vue'\nimport Button from '@/components/ui/button/Button.vue'\nimport { useCurrentUser } from '@/composables/auth/useCurrentUser'\nimport { useFirebaseAuthActions } from '@/composables/auth/useFirebaseAuthActions'\nimport { useExternalLink } from '@/composables/useExternalLink'\nimport SubscribeButton from '@/platform/cloud/subscription/components/SubscribeButton.vue'\nimport { useSubscription } from '@/platform/cloud/subscription/composables/useSubscription'\nimport { useSubscriptionCredits } from '@/platform/cloud/subscription/composables/useSubscriptionCredits'\nimport { useSubscriptionDialog } from '@/platform/cloud/subscription/composables/useSubscriptionDialog'\nimport { isCloud } from '@/platform/distribution/types'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useWorkspaceUI } from '@/platform/workspace/composables/useWorkspaceUI'\nimport { useTeamWorkspaceStore } from '@/platform/workspace/stores/teamWorkspaceStore'\nimport { useDialogService } from '@/services/dialogService'\n\nconst workspaceStore = useTeamWorkspaceStore()\nconst {\n  initState,\n  workspaceName,\n  isInPersonalWorkspace: isPersonalWorkspace,\n  isWorkspaceSubscribed\n} = storeToRefs(workspaceStore)\nconst { workspaceRole } = useWorkspaceUI()\nconst workspaceSwitcherPopover = ref<InstanceType<typeof Popover> | null>(null)\n\nconst emit = defineEmits<{\n  close: []\n}>()\n\nconst { buildDocsUrl, docsPaths } = useExternalLink()\n\nconst { userDisplayName, userEmail, userPhotoUrl, handleSignOut } =\n  useCurrentUser()\nconst authActions = useFirebaseAuthActions()\nconst dialogService = useDialogService()\nconst { isActiveSubscription, subscriptionStatus } = useSubscription()\nconst { totalCredits, isLoadingBalance } = useSubscriptionCredits()\nconst subscriptionDialog = useSubscriptionDialog()\n\nconst displayedCredits = computed(() => {\n  if (initState.value !== 'ready') return ''\n  // Only personal workspaces have subscription status from useSubscription()\n  // Team workspaces don't have backend subscription data yet\n  if (isPersonalWorkspace.value) {\n    // Wait for subscription status to load\n    if (subscriptionStatus.value === null) return ''\n    return isActiveSubscription.value ? totalCredits.value : '0'\n  }\n  return '0'\n})\n\nconst canUpgrade = computed(() => {\n  // PRO is currently the only/highest tier, so no upgrades available\n  // This will need updating when additional tiers are added\n  return false\n})\n\nconst showPlansAndPricing = computed(\n  () => isPersonalWorkspace.value || workspaceRole.value === 'owner'\n)\nconst showManagePlan = computed(\n  () => showPlansAndPricing.value && isActiveSubscription.value\n)\nconst showCreditsSection = computed(\n  () => isPersonalWorkspace.value || workspaceRole.value === 'owner'\n)\n\nconst handleOpenUserSettings = () => {\n  dialogService.showSettingsDialog('user')\n  emit('close')\n}\n\nconst handleOpenWorkspaceSettings = () => {\n  dialogService.showSettingsDialog('workspace')\n  emit('close')\n}\n\nconst handleOpenPlansAndPricing = () => {\n  subscriptionDialog.show()\n  emit('close')\n}\n\nconst handleOpenPlanAndCreditsSettings = () => {\n  if (isCloud) {\n    dialogService.showSettingsDialog('workspace')\n  } else {\n    dialogService.showSettingsDialog('credits')\n  }\n\n  emit('close')\n}\n\nconst handleTopUp = () => {\n  // Track purchase credits entry from avatar popover\n  useTelemetry()?.trackAddApiCreditButtonClicked()\n  dialogService.showTopUpCreditsDialog()\n  emit('close')\n}\n\nconst handleOpenPartnerNodesInfo = () => {\n  window.open(\n    buildDocsUrl(docsPaths.partnerNodesPricing, { includeLocale: true }),\n    '_blank'\n  )\n  emit('close')\n}\n\nconst handleLogout = async () => {\n  await handleSignOut()\n  emit('close')\n}\n\nconst handleCreateWorkspace = () => {\n  workspaceSwitcherPopover.value?.hide()\n  dialogService.showCreateWorkspaceDialog()\n  emit('close')\n}\n\nconst toggleWorkspaceSwitcher = (event: MouseEvent) => {\n  workspaceSwitcherPopover.value?.toggle(event)\n}\n\nonMounted(() => {\n  void authActions.fetchBalance()\n})\n</script>\n","<!-- A popover that shows current user information and actions -->\n<template>\n  <div\n    class=\"current-user-popover w-80 -m-3 p-2 rounded-lg border border-border-default bg-base-background shadow-[1px_1px_8px_0_rgba(0,0,0,0.4)]\"\n  >\n    <!-- User Info Section -->\n    <div class=\"flex flex-col items-center px-0 py-3 mb-4\">\n      <UserAvatar\n        class=\"mb-1\"\n        :photo-url=\"userPhotoUrl\"\n        :pt:icon:class=\"{\n          'text-2xl!': !userPhotoUrl\n        }\"\n        size=\"large\"\n      />\n\n      <!-- User Details -->\n      <h3 class=\"my-0 mb-1 truncate text-base font-bold text-base-foreground\">\n        {{ userDisplayName || $t('g.user') }}\n      </h3>\n      <p v-if=\"userEmail\" class=\"my-0 truncate text-sm text-muted\">\n        {{ userEmail }}\n      </p>\n    </div>\n\n    <!-- Workspace Selector -->\n    <div\n      class=\"flex cursor-pointer items-center justify-between rounded-lg px-4 py-2 hover:bg-secondary-background-hover\"\n      @click=\"toggleWorkspaceSwitcher\"\n    >\n      <div class=\"flex min-w-0 flex-1 items-center gap-2\">\n        <WorkspaceProfilePic\n          class=\"size-6 shrink-0 text-xs\"\n          :workspace-name=\"workspaceName\"\n        />\n        <span class=\"truncate text-sm text-base-foreground\">{{\n          workspaceName\n        }}</span>\n      </div>\n      <i class=\"pi pi-chevron-down shrink-0 text-sm text-muted-foreground\" />\n    </div>\n\n    <Popover\n      ref=\"workspaceSwitcherPopover\"\n      append-to=\"body\"\n      :pt=\"{\n        content: {\n          class: 'p-0'\n        }\n      }\"\n    >\n      <WorkspaceSwitcherPopover\n        @select=\"workspaceSwitcherPopover?.hide()\"\n        @create=\"handleCreateWorkspace\"\n      />\n    </Popover>\n\n    <!-- Credits Section (PERSONAL and OWNER only) -->\n    <template v-if=\"showCreditsSection\">\n      <div class=\"flex items-center gap-2 px-4 py-2\">\n        <i class=\"icon-[lucide--component] text-sm text-amber-400\" />\n        <Skeleton\n          v-if=\"isLoadingBalance\"\n          width=\"4rem\"\n          height=\"1.25rem\"\n          class=\"w-full\"\n        />\n        <span v-else class=\"text-base font-semibold text-base-foreground\">{{\n          displayedCredits\n        }}</span>\n        <i\n          v-tooltip=\"{ value: $t('credits.unified.tooltip'), showDelay: 300 }\"\n          class=\"icon-[lucide--circle-help] mr-auto cursor-help text-base text-muted-foreground\"\n        />\n        <!-- Subscribed: Show Add Credits button -->\n        <Button\n          v-if=\"isActiveSubscription && isWorkspaceSubscribed\"\n          variant=\"secondary\"\n          size=\"sm\"\n          class=\"text-base-foreground\"\n          data-testid=\"add-credits-button\"\n          @click=\"handleTopUp\"\n        >\n          {{ $t('subscription.addCredits') }}\n        </Button>\n        <!-- Unsubscribed: Show Subscribe button -->\n        <SubscribeButton\n          v-else-if=\"isPersonalWorkspace\"\n          :fluid=\"false\"\n          :label=\"$t('workspaceSwitcher.subscribe')\"\n          size=\"sm\"\n          variant=\"gradient\"\n        />\n        <!-- Non-personal workspace: Navigate to workspace settings -->\n        <Button\n          v-else\n          variant=\"primary\"\n          size=\"sm\"\n          @click=\"handleOpenPlanAndCreditsSettings\"\n        >\n          {{ $t('workspaceSwitcher.subscribe') }}\n        </Button>\n      </div>\n\n      <Divider class=\"mx-0 my-2\" />\n    </template>\n\n    <!-- Plans & Pricing (PERSONAL and OWNER only) -->\n    <div\n      v-if=\"showPlansAndPricing\"\n      class=\"flex cursor-pointer items-center gap-2 px-4 py-2 hover:bg-secondary-background-hover\"\n      data-testid=\"plans-pricing-menu-item\"\n      @click=\"handleOpenPlansAndPricing\"\n    >\n      <i class=\"icon-[lucide--receipt-text] text-sm text-muted-foreground\" />\n      <span class=\"flex-1 text-sm text-base-foreground\">{{\n        $t('subscription.plansAndPricing')\n      }}</span>\n      <span\n        v-if=\"canUpgrade\"\n        class=\"rounded-full bg-base-foreground px-1.5 py-0.5 text-xs font-bold text-base-background\"\n      >\n        {{ $t('subscription.upgrade') }}\n      </span>\n    </div>\n\n    <!-- Manage Plan (PERSONAL and OWNER, only if subscribed) -->\n    <div\n      v-if=\"showManagePlan\"\n      class=\"flex cursor-pointer items-center gap-2 px-4 py-2 hover:bg-secondary-background-hover\"\n      data-testid=\"manage-plan-menu-item\"\n      @click=\"handleOpenPlanAndCreditsSettings\"\n    >\n      <i class=\"icon-[lucide--file-text] text-sm text-muted-foreground\" />\n      <span class=\"flex-1 text-sm text-base-foreground\">{{\n        $t('subscription.managePlan')\n      }}</span>\n    </div>\n\n    <!-- Partner Nodes Pricing (always shown) -->\n    <div\n      class=\"flex cursor-pointer items-center gap-2 px-4 py-2 hover:bg-secondary-background-hover\"\n      data-testid=\"partner-nodes-menu-item\"\n      @click=\"handleOpenPartnerNodesInfo\"\n    >\n      <i class=\"icon-[lucide--tag] text-sm text-muted-foreground\" />\n      <span class=\"flex-1 text-sm text-base-foreground\">{{\n        $t('subscription.partnerNodesCredits')\n      }}</span>\n    </div>\n\n    <Divider class=\"mx-0 my-2\" />\n\n    <!-- Workspace Settings (always shown) -->\n    <div\n      class=\"flex cursor-pointer items-center gap-2 px-4 py-2 hover:bg-secondary-background-hover\"\n      data-testid=\"workspace-settings-menu-item\"\n      @click=\"handleOpenWorkspaceSettings\"\n    >\n      <i class=\"icon-[lucide--users] text-sm text-muted-foreground\" />\n      <span class=\"flex-1 text-sm text-base-foreground\">{{\n        $t('userSettings.workspaceSettings')\n      }}</span>\n    </div>\n\n    <!-- Account Settings (always shown) -->\n    <div\n      class=\"flex cursor-pointer items-center gap-2 px-4 py-2 hover:bg-secondary-background-hover\"\n      data-testid=\"user-settings-menu-item\"\n      @click=\"handleOpenUserSettings\"\n    >\n      <i class=\"icon-[lucide--settings-2] text-sm text-muted-foreground\" />\n      <span class=\"flex-1 text-sm text-base-foreground\">{{\n        $t('userSettings.accountSettings')\n      }}</span>\n    </div>\n\n    <Divider class=\"mx-0 my-2\" />\n\n    <!-- Logout (always shown) -->\n    <div\n      class=\"flex cursor-pointer items-center gap-2 px-4 py-2 hover:bg-secondary-background-hover\"\n      data-testid=\"logout-menu-item\"\n      @click=\"handleLogout\"\n    >\n      <i class=\"icon-[lucide--log-out] text-sm text-muted-foreground\" />\n      <span class=\"flex-1 text-sm text-base-foreground\">{{\n        $t('auth.signOut.signOut')\n      }}</span>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { storeToRefs } from 'pinia'\nimport Divider from 'primevue/divider'\nimport Popover from 'primevue/popover'\nimport Skeleton from 'primevue/skeleton'\nimport { computed, onMounted, ref } from 'vue'\n\nimport UserAvatar from '@/components/common/UserAvatar.vue'\nimport WorkspaceProfilePic from '@/components/common/WorkspaceProfilePic.vue'\nimport WorkspaceSwitcherPopover from '@/components/topbar/WorkspaceSwitcherPopover.vue'\nimport Button from '@/components/ui/button/Button.vue'\nimport { useCurrentUser } from '@/composables/auth/useCurrentUser'\nimport { useFirebaseAuthActions } from '@/composables/auth/useFirebaseAuthActions'\nimport { useExternalLink } from '@/composables/useExternalLink'\nimport SubscribeButton from '@/platform/cloud/subscription/components/SubscribeButton.vue'\nimport { useSubscription } from '@/platform/cloud/subscription/composables/useSubscription'\nimport { useSubscriptionCredits } from '@/platform/cloud/subscription/composables/useSubscriptionCredits'\nimport { useSubscriptionDialog } from '@/platform/cloud/subscription/composables/useSubscriptionDialog'\nimport { isCloud } from '@/platform/distribution/types'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useWorkspaceUI } from '@/platform/workspace/composables/useWorkspaceUI'\nimport { useTeamWorkspaceStore } from '@/platform/workspace/stores/teamWorkspaceStore'\nimport { useDialogService } from '@/services/dialogService'\n\nconst workspaceStore = useTeamWorkspaceStore()\nconst {\n  initState,\n  workspaceName,\n  isInPersonalWorkspace: isPersonalWorkspace,\n  isWorkspaceSubscribed\n} = storeToRefs(workspaceStore)\nconst { workspaceRole } = useWorkspaceUI()\nconst workspaceSwitcherPopover = ref<InstanceType<typeof Popover> | null>(null)\n\nconst emit = defineEmits<{\n  close: []\n}>()\n\nconst { buildDocsUrl, docsPaths } = useExternalLink()\n\nconst { userDisplayName, userEmail, userPhotoUrl, handleSignOut } =\n  useCurrentUser()\nconst authActions = useFirebaseAuthActions()\nconst dialogService = useDialogService()\nconst { isActiveSubscription, subscriptionStatus } = useSubscription()\nconst { totalCredits, isLoadingBalance } = useSubscriptionCredits()\nconst subscriptionDialog = useSubscriptionDialog()\n\nconst displayedCredits = computed(() => {\n  if (initState.value !== 'ready') return ''\n  // Only personal workspaces have subscription status from useSubscription()\n  // Team workspaces don't have backend subscription data yet\n  if (isPersonalWorkspace.value) {\n    // Wait for subscription status to load\n    if (subscriptionStatus.value === null) return ''\n    return isActiveSubscription.value ? totalCredits.value : '0'\n  }\n  return '0'\n})\n\nconst canUpgrade = computed(() => {\n  // PRO is currently the only/highest tier, so no upgrades available\n  // This will need updating when additional tiers are added\n  return false\n})\n\nconst showPlansAndPricing = computed(\n  () => isPersonalWorkspace.value || workspaceRole.value === 'owner'\n)\nconst showManagePlan = computed(\n  () => showPlansAndPricing.value && isActiveSubscription.value\n)\nconst showCreditsSection = computed(\n  () => isPersonalWorkspace.value || workspaceRole.value === 'owner'\n)\n\nconst handleOpenUserSettings = () => {\n  dialogService.showSettingsDialog('user')\n  emit('close')\n}\n\nconst handleOpenWorkspaceSettings = () => {\n  dialogService.showSettingsDialog('workspace')\n  emit('close')\n}\n\nconst handleOpenPlansAndPricing = () => {\n  subscriptionDialog.show()\n  emit('close')\n}\n\nconst handleOpenPlanAndCreditsSettings = () => {\n  if (isCloud) {\n    dialogService.showSettingsDialog('workspace')\n  } else {\n    dialogService.showSettingsDialog('credits')\n  }\n\n  emit('close')\n}\n\nconst handleTopUp = () => {\n  // Track purchase credits entry from avatar popover\n  useTelemetry()?.trackAddApiCreditButtonClicked()\n  dialogService.showTopUpCreditsDialog()\n  emit('close')\n}\n\nconst handleOpenPartnerNodesInfo = () => {\n  window.open(\n    buildDocsUrl(docsPaths.partnerNodesPricing, { includeLocale: true }),\n    '_blank'\n  )\n  emit('close')\n}\n\nconst handleLogout = async () => {\n  await handleSignOut()\n  emit('close')\n}\n\nconst handleCreateWorkspace = () => {\n  workspaceSwitcherPopover.value?.hide()\n  dialogService.showCreateWorkspaceDialog()\n  emit('close')\n}\n\nconst toggleWorkspaceSwitcher = (event: MouseEvent) => {\n  workspaceSwitcherPopover.value?.toggle(event)\n}\n\nonMounted(() => {\n  void authActions.fetchBalance()\n})\n</script>\n"],"mappings":"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"}