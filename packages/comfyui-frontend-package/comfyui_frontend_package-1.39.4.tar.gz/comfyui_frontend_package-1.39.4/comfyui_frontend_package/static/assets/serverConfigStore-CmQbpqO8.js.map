{"version":3,"file":"serverConfigStore-CmQbpqO8.js","names":[],"sources":["../../src/stores/serverConfigStore.ts"],"sourcesContent":["import { defineStore } from 'pinia'\nimport { computed, ref } from 'vue'\n\nimport type { ServerConfig, ServerConfigValue } from '@/constants/serverConfig'\n\ntype ServerConfigWithValue<T> = ServerConfig<T> & {\n  /**\n   * Current value.\n   */\n  value: T\n  /**\n   * Initial value loaded from settings.\n   */\n  initialValue: T\n}\n\nexport const useServerConfigStore = defineStore('serverConfig', () => {\n  const serverConfigById = ref<\n    Record<string, ServerConfigWithValue<ServerConfigValue>>\n  >({})\n  const serverConfigs = computed(() => {\n    return Object.values(serverConfigById.value)\n  })\n  const modifiedConfigs = computed<ServerConfigWithValue<ServerConfigValue>[]>(\n    () => {\n      return serverConfigs.value.filter((config) => {\n        return config.initialValue !== config.value\n      })\n    }\n  )\n  const revertChanges = () => {\n    for (const config of modifiedConfigs.value) {\n      config.value = config.initialValue\n    }\n  }\n  const serverConfigsByCategory = computed<\n    Record<string, ServerConfigWithValue<ServerConfigValue>[]>\n  >(() => {\n    return serverConfigs.value.reduce(\n      (acc, config) => {\n        const category = config.category?.[0] ?? 'General'\n        acc[category] = acc[category] || []\n        acc[category].push(config)\n        return acc\n      },\n      {} as Record<string, ServerConfigWithValue<ServerConfigValue>[]>\n    )\n  })\n  const serverConfigValues = computed<Record<string, ServerConfigValue>>(() => {\n    return Object.fromEntries(\n      serverConfigs.value.map((config) => {\n        return [\n          config.id,\n          config.value === config.defaultValue ||\n          config.value === null ||\n          config.value === undefined\n            ? undefined\n            : config.value\n        ]\n      })\n    )\n  })\n  const launchArgs = computed<Record<string, string>>(() => {\n    const args: Record<\n      string,\n      Omit<ServerConfigValue, 'undefined' | 'null'>\n    > = Object.assign(\n      {},\n      ...serverConfigs.value.map((config) => {\n        // Filter out configs that have the default value or undefined | null value\n        if (\n          config.value === config.defaultValue ||\n          config.value === null ||\n          config.value === undefined\n        ) {\n          return {}\n        }\n        return config.getValue\n          ? config.getValue(config.value)\n          : { [config.id]: config.value }\n      })\n    )\n\n    // Convert true to empty string\n    // Convert number to string\n    return Object.fromEntries(\n      Object.entries(args).map(([key, value]) => {\n        if (value === true) {\n          return [key, '']\n        }\n        return [key, value.toString()]\n      })\n    ) as Record<string, string>\n  })\n  const commandLineArgs = computed<string>(() => {\n    return Object.entries(launchArgs.value)\n      .map(([key, value]) => [`--${key}`, value])\n      .flat()\n      .filter((arg: string) => arg !== '')\n      .join(' ')\n  })\n\n  function loadServerConfig(\n    configs: ServerConfig<ServerConfigValue>[],\n    values: Record<string, ServerConfigValue>\n  ) {\n    for (const config of configs) {\n      const value = values[config.id] ?? config.defaultValue\n      serverConfigById.value[config.id] = {\n        ...config,\n        value,\n        initialValue: value\n      }\n    }\n  }\n\n  return {\n    serverConfigById,\n    serverConfigs,\n    modifiedConfigs,\n    serverConfigsByCategory,\n    serverConfigValues,\n    launchArgs,\n    commandLineArgs,\n    revertChanges,\n    loadServerConfig\n  }\n})\n"],"mappings":"oMAA4B,IACE,CAejB,EAAuB,EAAY,mBAAsB,CACpE,IAAM,EAAmB,EAEvB,EAAE,CAAC,CACC,EAAgB,MACb,OAAO,OAAO,EAAiB,MAAM,CAC5C,CACI,EAAkB,MAEb,EAAc,MAAM,OAAQ,GAC1B,EAAO,eAAiB,EAAO,MACtC,CAEL,CACK,kBAAsB,CAC1B,IAAK,IAAM,KAAU,EAAgB,MACnC,EAAO,MAAQ,EAAO,cAGpB,EAA0B,MAGvB,EAAc,MAAM,QACxB,EAAK,IAAW,CACf,IAAM,EAAW,EAAO,WAAW,IAAM,UAGzC,MAFA,GAAI,GAAY,EAAI,IAAa,EAAE,CACnC,EAAI,GAAU,KAAK,EAAO,CACnB,GAET,EAAE,CACH,CACD,CACI,EAAqB,MAClB,OAAO,YACZ,EAAc,MAAM,IAAK,GAChB,CACL,EAAO,GACP,EAAO,QAAU,EAAO,cACxB,EAAO,QAAU,MACjB,EAAO,QAAU,IAAA,GACb,IAAA,GACA,EAAO,MACZ,CACD,CACH,CACD,CACI,EAAa,MAAuC,CACxD,IAAM,EAGF,OAAO,OACT,EAAE,CACF,GAAG,EAAc,MAAM,IAAK,GAGxB,EAAO,QAAU,EAAO,cACxB,EAAO,QAAU,MACjB,EAAO,QAAU,IAAA,GAEV,EAAE,CAEJ,EAAO,SACV,EAAO,SAAS,EAAO,MAAM,CAC7B,EAAG,EAAO,IAAK,EAAO,MAAO,CACjC,CACH,CAID,OAAO,OAAO,YACZ,OAAO,QAAQ,EAAK,CAAC,KAAK,CAAC,EAAK,KAC1B,IAAU,GACL,CAAC,EAAK,GAAG,CAEX,CAAC,EAAK,EAAM,UAAU,CAAC,CAC9B,CACH,EACD,CACI,EAAkB,MACf,OAAO,QAAQ,EAAW,MAAM,CACpC,KAAK,CAAC,EAAK,KAAW,CAAC,KAAK,IAAO,EAAM,CAAC,CAC1C,MAAM,CACN,OAAQ,GAAgB,IAAQ,GAAG,CACnC,KAAK,IAAI,CACZ,CAEF,SAAS,iBACP,EACA,EACA,CACA,IAAK,IAAM,KAAU,EAAS,CAC5B,IAAM,EAAQ,EAAO,EAAO,KAAO,EAAO,aAC1C,EAAiB,MAAM,EAAO,IAAM,CAClC,GAAG,EACH,QACA,aAAc,EACf,EAIL,MAAO,CACL,mBACA,gBACA,kBACA,0BACA,qBACA,aACA,kBACA,cACA,iBACD,EACD"}