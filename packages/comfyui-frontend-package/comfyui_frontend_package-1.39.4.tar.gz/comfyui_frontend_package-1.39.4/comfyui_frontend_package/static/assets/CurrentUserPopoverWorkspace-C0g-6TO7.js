import{i as e,n as t}from"./rolldown-runtime-BKYq3fBv.js";import{$n as n,Cr as r,Gn as i,Nn as a,Or as o,Qn as s,Qt as c,Rr as l,Tr as u,Ut as d,Wt as f,Xn as p,Xr as m,Zn as h,Zt as g,ai as _,ar as v,br as ee,er as y,gn as te,hn as b,ir as x,si as S,sr as C,ui as w,zr as ne}from"./vendor-primevue-Cg-HmKZY.js";import{ot as T,st as E}from"./vendor-other-CoxDvJ0a.js";import{i as D,r as O}from"./vendor-vue-J4jYbuLn.js";import{an as k,on as re}from"./api-DwS-Gkat.js";import{n as A,t as j}from"./tailwindUtil-F1kyO01s.js";import{n as M,t as N}from"./Button-YQy7RkKq.js";import{N as P,P as ie}from"./PanelTemplate-C_M5tiqP.js";import{Eo as ae,Mo as oe,No as F,Po as I,Q as L,To as R,X as z,_ as B,an as se,c as V,g as H,in as U,jo as W,n as G,s as K,t as q}from"./dialogService-DMnraGWZ.js";import{n as J,t as ce}from"./UserAvatar-BHBnMJq5.js";import{n as le,t as ue}from"./useWorkspaceUI-CInjoYrk.js";import{n as de,t as fe}from"./useSubscriptionCredits-BRixztQo.js";import{n as pe,t as me}from"./useSubscriptionDialog-CMPayoTE.js";import{n as he,t as ge}from"./SubscribeButton-DtRpmn6W.js";function useWorkspaceSwitch(){let{t:e}=E(),t=V(),{activeWorkspace:n}=D(t),r=L(),i=G();function hasUnsavedChanges(){return r.modifiedWorkflows.length>0}async function switchWithConfirmation(r){if(n.value?.id===r)return!0;if(hasUnsavedChanges()&&!await i.confirm({title:e(`workspace.unsavedChanges.title`),message:e(`workspace.unsavedChanges.message`),type:`dirtyClose`}))return!1;try{return await t.switchWorkspace(r),!0}catch{return!1}}return{hasUnsavedChanges,switchWithConfirmation}}var _e=t((()=>{O(),T(),z(),K(),q()})),Y,X,Z,Q,ve,ye,be,xe,Se,Ce,we,Te,Ee,De,Oe,ke=t((()=>{a(),O(),T(),B(),_e(),F(),K(),j(),Y={class:`flex w-80 flex-col overflow-hidden rounded-lg`},X={class:`flex flex-col overflow-y-auto`},Z={key:0,class:`flex flex-col gap-2 p-2`},Q=[`onClick`],ve={class:`flex min-w-0 flex-1 flex-col items-start gap-1`},ye={class:`flex items-center gap-1.5`},be={class:`text-sm text-base-foreground`},xe={key:0,class:`text-[10px] font-bold uppercase text-base-background bg-base-foreground px-1 py-0.5 rounded-full`},Se={class:`text-xs text-muted-foreground`},Ce={key:0,class:`pi pi-check text-sm text-base-foreground`},we={class:`px-2 py-2`},Te={class:`flex min-w-0 flex-1 flex-col`},Ee={key:0,class:`text-sm text-muted-foreground`},De={key:1,class:`text-sm text-muted-foreground`},Oe=C({__name:`WorkspaceSwitcherPopover`,emits:[`select`,`create`],setup(e,{emit:t}){let a=t,{t:o}=E(),{switchWithConfirmation:s}=useWorkspaceSwitch(),{subscriptionTierName:c}=I(),{workspaceId:l,workspaces:d,canCreateWorkspace:f,isFetchingWorkspaces:m}=D(V()),g=p(()=>d.value.map(e=>({id:e.id,name:e.name,type:e.type,role:e.role,isSubscribed:e.isSubscribed,subscriptionPlan:e.subscriptionPlan})));function isCurrentWorkspace(e){return e.id===l.value}function getRoleLabel(e){return e===`owner`?o(`workspaceSwitcher.roleOwner`):e===`member`?o(`workspaceSwitcher.roleMember`):``}function getTierLabel(e){return e.type===`personal`?c.value||null:!e.isSubscribed||!e.subscriptionPlan?null:e.subscriptionPlan===`PRO_MONTHLY`?o(`subscription.tiers.pro.name`):e.subscriptionPlan===`PRO_YEARLY`?o(`subscription.tierNameYearly`,{name:o(`subscription.tiers.pro.name`)}):null}async function handleSelectWorkspace(e){await s(e.id)&&a(`select`,e)}function handleCreateWorkspace(){a(`create`)}return(e,t)=>(r(),y(`div`,Y,[h(`div`,X,[_(m)?(r(),y(`div`,Z,[(r(),y(i,null,u(2,e=>h(`div`,{key:e,class:`flex h-[54px] animate-pulse items-center gap-2 rounded px-2 py-4`},t[1]||=[h(`div`,{class:`size-8 rounded-full bg-secondary-background`},null,-1),h(`div`,{class:`flex flex-1 flex-col gap-1`},[h(`div`,{class:`h-4 w-24 rounded bg-secondary-background`}),h(`div`,{class:`h-3 w-16 rounded bg-secondary-background`})],-1)])),64))])):(r(!0),y(i,{key:1},u(g.value,t=>(r(),y(`div`,{key:t.id,class:`border-b border-border-default p-2`},[h(`div`,{class:S(_(A)(`group flex h-[54px] w-full items-center gap-2 rounded px-2 py-4`,`hover:bg-secondary-background-hover`,isCurrentWorkspace(t)&&`bg-secondary-background`))},[h(`button`,{class:`flex flex-1 cursor-pointer items-center gap-2 border-none bg-transparent p-0`,onClick:e=>handleSelectWorkspace(t)},[v(H,{class:`size-8 text-sm`,"workspace-name":t.name},null,8,[`workspace-name`]),h(`div`,ve,[h(`div`,ye,[h(`span`,be,w(t.type===`personal`?e.$t(`workspaceSwitcher.personal`):t.name),1),getTierLabel(t)?(r(),y(`span`,xe,w(getTierLabel(t)),1)):n(``,!0)]),h(`span`,Se,w(getRoleLabel(t.role)),1)]),isCurrentWorkspace(t)?(r(),y(`i`,Ce)):n(``,!0)],8,Q)],2)]))),128)),h(`div`,we,[h(`div`,{class:S(_(A)(`flex h-12 w-full items-center gap-2 rounded px-2 py-2`,_(f)?`cursor-pointer hover:bg-secondary-background-hover`:`cursor-default`)),onClick:t[0]||=e=>_(f)&&handleCreateWorkspace()},[h(`div`,{class:S(_(A)(`flex size-8 items-center justify-center rounded-full bg-secondary-background`,!_(f)&&`opacity-50`))},t[2]||=[h(`i`,{class:`pi pi-plus text-sm text-muted-foreground`},null,-1)],2),h(`div`,Te,[_(f)?(r(),y(`span`,Ee,w(e.$t(`workspaceSwitcher.createWorkspace`)),1)):(r(),y(`span`,De,w(e.$t(`workspaceSwitcher.maxWorkspacesReached`)),1))])],2)])])]))}})})),Ae,je=t((()=>{ke(),ke(),Ae=Oe})),Me,Ne,Pe,Fe,Ie,Le,Re,ze,Be,Ve,$,He,Ue,We,Ge,Ke,qe,Je=t((()=>{a(),O(),d(),g(),b(),J(),B(),je(),M(),R(),W(),P(),he(),F(),fe(),me(),k(),U(),ue(),K(),q(),Me={class:`current-user-popover w-80 -m-3 p-2 rounded-lg border border-border-default bg-base-background shadow-[1px_1px_8px_0_rgba(0,0,0,0.4)]`},Ne={class:`flex flex-col items-center px-0 py-3 mb-4`},Pe={class:`my-0 mb-1 truncate text-base font-bold text-base-foreground`},Fe={key:0,class:`my-0 truncate text-sm text-muted`},Ie={class:`flex min-w-0 flex-1 items-center gap-2`},Le={class:`truncate text-sm text-base-foreground`},Re={class:`flex items-center gap-2 px-4 py-2`},ze={key:1,class:`text-base font-semibold text-base-foreground`},Be={class:`icon-[lucide--circle-help] mr-auto cursor-help text-base text-muted-foreground`},Ve={class:`flex-1 text-sm text-base-foreground`},$={key:0,class:`rounded-full bg-base-foreground px-1.5 py-0.5 text-xs font-bold text-base-background`},He={class:`flex-1 text-sm text-base-foreground`},Ue={class:`flex-1 text-sm text-base-foreground`},We={class:`flex-1 text-sm text-base-foreground`},Ge={class:`flex-1 text-sm text-base-foreground`},Ke={class:`flex-1 text-sm text-base-foreground`},qe=C({__name:`CurrentUserPopoverWorkspace`,emits:[`close`],setup(e,{emit:t}){let{initState:a,workspaceName:u,isInPersonalWorkspace:d,isWorkspaceSubscribed:g}=D(V()),{workspaceRole:b}=le(),S=m(null),C=t,{buildDocsUrl:T,docsPaths:E}=ie(),{userDisplayName:O,userEmail:k,userPhotoUrl:A,handleSignOut:j}=ae(),M=oe(),P=G(),{isActiveSubscription:F,subscriptionStatus:L}=I(),{totalCredits:R,isLoadingBalance:z}=de(),B=pe(),U=p(()=>a.value===`ready`?d.value?L.value===null?``:F.value?R.value:`0`:`0`:``),W=p(()=>!1),K=p(()=>d.value||b.value===`owner`),q=p(()=>K.value&&F.value),J=p(()=>d.value||b.value===`owner`),handleOpenUserSettings=()=>{P.showSettingsDialog(`user`),C(`close`)},handleOpenWorkspaceSettings=()=>{P.showSettingsDialog(`workspace`),C(`close`)},handleOpenPlansAndPricing=()=>{B.show(),C(`close`)},handleOpenPlanAndCreditsSettings=()=>{re?P.showSettingsDialog(`workspace`):P.showSettingsDialog(`credits`),C(`close`)},handleTopUp=()=>{se()?.trackAddApiCreditButtonClicked(),P.showTopUpCreditsDialog(),C(`close`)},handleOpenPartnerNodesInfo=()=>{window.open(T(E.partnerNodesPricing,{includeLocale:!0}),`_blank`),C(`close`)},handleLogout=async()=>{await j(),C(`close`)},handleCreateWorkspace=()=>{S.value?.hide(),P.showCreateWorkspaceDialog(),C(`close`)},toggleWorkspaceSwitcher=e=>{S.value?.toggle(e)};return ee(()=>{M.fetchBalance()}),(e,t)=>{let a=o(`tooltip`);return r(),y(`div`,Me,[h(`div`,Ne,[v(ce,{class:`mb-1`,"photo-url":_(A),"pt:icon:class":{"text-2xl!":!_(A)},size:`large`},null,8,[`photo-url`,`pt:icon:class`]),h(`h3`,Pe,w(_(O)||e.$t(`g.user`)),1),_(k)?(r(),y(`p`,Fe,w(_(k)),1)):n(``,!0)]),h(`div`,{class:`flex cursor-pointer items-center justify-between rounded-lg px-4 py-2 hover:bg-secondary-background-hover`,onClick:toggleWorkspaceSwitcher},[h(`div`,Ie,[v(H,{class:`size-6 shrink-0 text-xs`,"workspace-name":_(u)},null,8,[`workspace-name`]),h(`span`,Le,w(_(u)),1)]),t[1]||=h(`i`,{class:`pi pi-chevron-down shrink-0 text-sm text-muted-foreground`},null,-1)]),v(_(c),{ref_key:`workspaceSwitcherPopover`,ref:S,"append-to":`body`,pt:{content:{class:`p-0`}}},{default:l(()=>[v(Ae,{onSelect:t[0]||=e=>S.value?.hide(),onCreate:handleCreateWorkspace})]),_:1},512),J.value?(r(),y(i,{key:0},[h(`div`,Re,[t[2]||=h(`i`,{class:`icon-[lucide--component] text-sm text-amber-400`},null,-1),_(z)?(r(),s(_(te),{key:0,width:`4rem`,height:`1.25rem`,class:`w-full`})):(r(),y(`span`,ze,w(U.value),1)),ne(h(`i`,Be,null,512),[[a,{value:e.$t(`credits.unified.tooltip`),showDelay:300}]]),_(F)&&_(g)?(r(),s(N,{key:2,variant:`secondary`,size:`sm`,class:`text-base-foreground`,"data-testid":`add-credits-button`,onClick:handleTopUp},{default:l(()=>[x(w(e.$t(`subscription.addCredits`)),1)]),_:1})):_(d)?(r(),s(ge,{key:3,fluid:!1,label:e.$t(`workspaceSwitcher.subscribe`),size:`sm`,variant:`gradient`},null,8,[`label`])):(r(),s(N,{key:4,variant:`primary`,size:`sm`,onClick:handleOpenPlanAndCreditsSettings},{default:l(()=>[x(w(e.$t(`workspaceSwitcher.subscribe`)),1)]),_:1}))]),v(_(f),{class:`mx-0 my-2`})],64)):n(``,!0),K.value?(r(),y(`div`,{key:1,class:`flex cursor-pointer items-center gap-2 px-4 py-2 hover:bg-secondary-background-hover`,"data-testid":`plans-pricing-menu-item`,onClick:handleOpenPlansAndPricing},[t[3]||=h(`i`,{class:`icon-[lucide--receipt-text] text-sm text-muted-foreground`},null,-1),h(`span`,Ve,w(e.$t(`subscription.plansAndPricing`)),1),W.value?(r(),y(`span`,$,w(e.$t(`subscription.upgrade`)),1)):n(``,!0)])):n(``,!0),q.value?(r(),y(`div`,{key:2,class:`flex cursor-pointer items-center gap-2 px-4 py-2 hover:bg-secondary-background-hover`,"data-testid":`manage-plan-menu-item`,onClick:handleOpenPlanAndCreditsSettings},[t[4]||=h(`i`,{class:`icon-[lucide--file-text] text-sm text-muted-foreground`},null,-1),h(`span`,He,w(e.$t(`subscription.managePlan`)),1)])):n(``,!0),h(`div`,{class:`flex cursor-pointer items-center gap-2 px-4 py-2 hover:bg-secondary-background-hover`,"data-testid":`partner-nodes-menu-item`,onClick:handleOpenPartnerNodesInfo},[t[5]||=h(`i`,{class:`icon-[lucide--tag] text-sm text-muted-foreground`},null,-1),h(`span`,Ue,w(e.$t(`subscription.partnerNodesCredits`)),1)]),v(_(f),{class:`mx-0 my-2`}),h(`div`,{class:`flex cursor-pointer items-center gap-2 px-4 py-2 hover:bg-secondary-background-hover`,"data-testid":`workspace-settings-menu-item`,onClick:handleOpenWorkspaceSettings},[t[6]||=h(`i`,{class:`icon-[lucide--users] text-sm text-muted-foreground`},null,-1),h(`span`,We,w(e.$t(`userSettings.workspaceSettings`)),1)]),h(`div`,{class:`flex cursor-pointer items-center gap-2 px-4 py-2 hover:bg-secondary-background-hover`,"data-testid":`user-settings-menu-item`,onClick:handleOpenUserSettings},[t[7]||=h(`i`,{class:`icon-[lucide--settings-2] text-sm text-muted-foreground`},null,-1),h(`span`,Ge,w(e.$t(`userSettings.accountSettings`)),1)]),v(_(f),{class:`mx-0 my-2`}),h(`div`,{class:`flex cursor-pointer items-center gap-2 px-4 py-2 hover:bg-secondary-background-hover`,"data-testid":`logout-menu-item`,onClick:handleLogout},[t[8]||=h(`i`,{class:`icon-[lucide--log-out] text-sm text-muted-foreground`},null,-1),h(`span`,Ke,w(e.$t(`auth.signOut.signOut`)),1)])])}}})})),Ye;t((()=>{Je(),Je(),Ye=qe}))();export{Ye as default};
//# sourceMappingURL=CurrentUserPopoverWorkspace-C0g-6TO7.js.map