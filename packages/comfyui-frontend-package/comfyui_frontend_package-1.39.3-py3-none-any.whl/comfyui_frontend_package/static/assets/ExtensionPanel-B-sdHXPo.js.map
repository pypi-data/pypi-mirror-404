{"version":3,"file":"ExtensionPanel-B-sdHXPo.js","names":[],"sources":["../../src/platform/settings/components/ExtensionPanel.vue","../../src/platform/settings/components/ExtensionPanel.vue"],"sourcesContent":["<template>\n  <PanelTemplate value=\"Extension\" class=\"extension-panel\">\n    <template #header>\n      <SearchBox\n        v-model=\"filters['global'].value\"\n        :placeholder=\"$t('g.searchExtensions') + '...'\"\n      />\n      <Message\n        v-if=\"hasChanges\"\n        severity=\"info\"\n        pt:text=\"w-full\"\n        class=\"max-h-96 overflow-y-auto\"\n      >\n        <ul>\n          <li v-for=\"ext in changedExtensions\" :key=\"ext.name\">\n            <span>\n              {{ extensionStore.isExtensionEnabled(ext.name) ? '[-]' : '[+]' }}\n            </span>\n            {{ ext.name }}\n          </li>\n        </ul>\n        <div class=\"flex justify-end\">\n          <Button variant=\"destructive\" @click=\"applyChanges\">\n            {{ $t('g.reloadToApplyChanges') }}\n          </Button>\n        </div>\n      </Message>\n    </template>\n    <div class=\"mb-3 flex gap-2\">\n      <SelectButton\n        v-model=\"filterType\"\n        :options=\"filterTypes\"\n        option-label=\"label\"\n        option-value=\"value\"\n      />\n    </div>\n    <DataTable\n      v-model:selection=\"selectedExtensions\"\n      :value=\"filteredExtensions\"\n      striped-rows\n      size=\"small\"\n      :filters=\"filters\"\n      selection-mode=\"multiple\"\n      data-key=\"name\"\n    >\n      <Column selection-mode=\"multiple\" :frozen=\"true\" style=\"width: 3rem\" />\n      <Column :header=\"$t('g.extensionName')\" sortable field=\"name\">\n        <template #body=\"slotProps\">\n          {{ slotProps.data.name }}\n          <Tag\n            v-if=\"extensionStore.isCoreExtension(slotProps.data.name)\"\n            :value=\"$t('g.core')\"\n          />\n          <Tag v-else :value=\"$t('g.custom')\" severity=\"info\" />\n        </template>\n      </Column>\n      <Column\n        :pt=\"{\n          headerCell: 'flex items-center justify-end',\n          bodyCell: 'flex items-center justify-end'\n        }\"\n      >\n        <template #header>\n          <Button\n            size=\"icon\"\n            variant=\"muted-textonly\"\n            @click=\"menu?.show($event)\"\n          >\n            <i class=\"pi pi-ellipsis-h\" />\n          </Button>\n          <ContextMenu ref=\"menu\" :model=\"contextMenuItems\" />\n        </template>\n        <template #body=\"slotProps\">\n          <ToggleSwitch\n            v-model=\"editingEnabledExtensions[slotProps.data.name]\"\n            :disabled=\"extensionStore.isExtensionReadOnly(slotProps.data.name)\"\n            @change=\"updateExtensionStatus\"\n          />\n        </template>\n      </Column>\n    </DataTable>\n  </PanelTemplate>\n</template>\n\n<script setup lang=\"ts\">\nimport { FilterMatchMode } from '@primevue/core/api'\nimport Column from 'primevue/column'\nimport ContextMenu from 'primevue/contextmenu'\nimport DataTable from 'primevue/datatable'\nimport Message from 'primevue/message'\nimport SelectButton from 'primevue/selectbutton'\nimport Tag from 'primevue/tag'\nimport ToggleSwitch from 'primevue/toggleswitch'\nimport { computed, onMounted, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport SearchBox from '@/components/common/SearchBox.vue'\nimport PanelTemplate from '@/components/dialog/content/setting/PanelTemplate.vue'\nimport Button from '@/components/ui/button/Button.vue'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useExtensionStore } from '@/stores/extensionStore'\nimport type { ComfyExtension } from '@/types/comfy'\n\nconst { t } = useI18n()\n\nconst filterTypeKeys = ['all', 'core', 'custom'] as const\ntype FilterTypeKey = (typeof filterTypeKeys)[number]\nconst filterTypes = computed(() =>\n  filterTypeKeys.map((key) => ({\n    label: t(`g.${key}`),\n    value: key\n  }))\n)\nconst filterType = ref<FilterTypeKey>('all')\nconst selectedExtensions = ref<ComfyExtension[]>([])\n\nconst filters = ref({\n  global: { value: '', matchMode: FilterMatchMode.CONTAINS }\n})\n\nconst extensionStore = useExtensionStore()\nconst settingStore = useSettingStore()\n\nconst editingEnabledExtensions = ref<Record<string, boolean>>({})\n\nconst filteredExtensions = computed(() => {\n  const extensions = extensionStore.extensions\n  switch (filterType.value) {\n    case 'core':\n      return extensions.filter((ext) =>\n        extensionStore.isCoreExtension(ext.name)\n      )\n    case 'custom':\n      return extensions.filter(\n        (ext) => !extensionStore.isCoreExtension(ext.name)\n      )\n    default:\n      return extensions\n  }\n})\n\nonMounted(() => {\n  extensionStore.extensions.forEach((ext) => {\n    editingEnabledExtensions.value[ext.name] =\n      extensionStore.isExtensionEnabled(ext.name)\n  })\n})\n\nconst changedExtensions = computed(() => {\n  return extensionStore.extensions.filter(\n    (ext) =>\n      editingEnabledExtensions.value[ext.name] !==\n      extensionStore.isExtensionEnabled(ext.name)\n  )\n})\n\nconst hasChanges = computed(() => {\n  return changedExtensions.value.length > 0\n})\n\nconst updateExtensionStatus = async () => {\n  const editingDisabledExtensionNames = Object.entries(\n    editingEnabledExtensions.value\n  )\n    .filter(([_, enabled]) => !enabled)\n    .map(([name]) => name)\n\n  await settingStore.set('Comfy.Extension.Disabled', [\n    ...extensionStore.inactiveDisabledExtensionNames,\n    ...editingDisabledExtensionNames\n  ])\n}\n\nconst enableAllExtensions = async () => {\n  extensionStore.extensions.forEach((ext) => {\n    if (extensionStore.isExtensionReadOnly(ext.name)) return\n\n    editingEnabledExtensions.value[ext.name] = true\n  })\n  await updateExtensionStatus()\n}\n\nconst disableAllExtensions = async () => {\n  extensionStore.extensions.forEach((ext) => {\n    if (extensionStore.isExtensionReadOnly(ext.name)) return\n\n    editingEnabledExtensions.value[ext.name] = false\n  })\n  await updateExtensionStatus()\n}\n\nconst disableThirdPartyExtensions = async () => {\n  extensionStore.extensions.forEach((ext) => {\n    if (extensionStore.isCoreExtension(ext.name)) return\n\n    editingEnabledExtensions.value[ext.name] = false\n  })\n  await updateExtensionStatus()\n}\n\nconst applyChanges = () => {\n  // Refresh the page to apply changes\n  window.location.reload()\n}\n\nconst menu = ref<InstanceType<typeof ContextMenu>>()\nconst contextMenuItems = computed(() => [\n  {\n    label: t('g.enableSelected'),\n    icon: 'pi pi-check',\n    command: async () => {\n      selectedExtensions.value.forEach((ext) => {\n        if (!extensionStore.isExtensionReadOnly(ext.name)) {\n          editingEnabledExtensions.value[ext.name] = true\n        }\n      })\n      await updateExtensionStatus()\n    }\n  },\n  {\n    label: t('g.disableSelected'),\n    icon: 'pi pi-times',\n    command: async () => {\n      selectedExtensions.value.forEach((ext) => {\n        if (!extensionStore.isExtensionReadOnly(ext.name)) {\n          editingEnabledExtensions.value[ext.name] = false\n        }\n      })\n      await updateExtensionStatus()\n    }\n  },\n  {\n    separator: true\n  },\n  {\n    label: t('g.enableAll'),\n    icon: 'pi pi-check',\n    command: enableAllExtensions\n  },\n  {\n    label: t('g.disableAll'),\n    icon: 'pi pi-times',\n    command: disableAllExtensions\n  },\n  {\n    label: t('g.disableThirdParty'),\n    icon: 'pi pi-times',\n    command: disableThirdPartyExtensions,\n    disabled: !extensionStore.hasThirdPartyExtensions\n  }\n])\n</script>\n","<template>\n  <PanelTemplate value=\"Extension\" class=\"extension-panel\">\n    <template #header>\n      <SearchBox\n        v-model=\"filters['global'].value\"\n        :placeholder=\"$t('g.searchExtensions') + '...'\"\n      />\n      <Message\n        v-if=\"hasChanges\"\n        severity=\"info\"\n        pt:text=\"w-full\"\n        class=\"max-h-96 overflow-y-auto\"\n      >\n        <ul>\n          <li v-for=\"ext in changedExtensions\" :key=\"ext.name\">\n            <span>\n              {{ extensionStore.isExtensionEnabled(ext.name) ? '[-]' : '[+]' }}\n            </span>\n            {{ ext.name }}\n          </li>\n        </ul>\n        <div class=\"flex justify-end\">\n          <Button variant=\"destructive\" @click=\"applyChanges\">\n            {{ $t('g.reloadToApplyChanges') }}\n          </Button>\n        </div>\n      </Message>\n    </template>\n    <div class=\"mb-3 flex gap-2\">\n      <SelectButton\n        v-model=\"filterType\"\n        :options=\"filterTypes\"\n        option-label=\"label\"\n        option-value=\"value\"\n      />\n    </div>\n    <DataTable\n      v-model:selection=\"selectedExtensions\"\n      :value=\"filteredExtensions\"\n      striped-rows\n      size=\"small\"\n      :filters=\"filters\"\n      selection-mode=\"multiple\"\n      data-key=\"name\"\n    >\n      <Column selection-mode=\"multiple\" :frozen=\"true\" style=\"width: 3rem\" />\n      <Column :header=\"$t('g.extensionName')\" sortable field=\"name\">\n        <template #body=\"slotProps\">\n          {{ slotProps.data.name }}\n          <Tag\n            v-if=\"extensionStore.isCoreExtension(slotProps.data.name)\"\n            :value=\"$t('g.core')\"\n          />\n          <Tag v-else :value=\"$t('g.custom')\" severity=\"info\" />\n        </template>\n      </Column>\n      <Column\n        :pt=\"{\n          headerCell: 'flex items-center justify-end',\n          bodyCell: 'flex items-center justify-end'\n        }\"\n      >\n        <template #header>\n          <Button\n            size=\"icon\"\n            variant=\"muted-textonly\"\n            @click=\"menu?.show($event)\"\n          >\n            <i class=\"pi pi-ellipsis-h\" />\n          </Button>\n          <ContextMenu ref=\"menu\" :model=\"contextMenuItems\" />\n        </template>\n        <template #body=\"slotProps\">\n          <ToggleSwitch\n            v-model=\"editingEnabledExtensions[slotProps.data.name]\"\n            :disabled=\"extensionStore.isExtensionReadOnly(slotProps.data.name)\"\n            @change=\"updateExtensionStatus\"\n          />\n        </template>\n      </Column>\n    </DataTable>\n  </PanelTemplate>\n</template>\n\n<script setup lang=\"ts\">\nimport { FilterMatchMode } from '@primevue/core/api'\nimport Column from 'primevue/column'\nimport ContextMenu from 'primevue/contextmenu'\nimport DataTable from 'primevue/datatable'\nimport Message from 'primevue/message'\nimport SelectButton from 'primevue/selectbutton'\nimport Tag from 'primevue/tag'\nimport ToggleSwitch from 'primevue/toggleswitch'\nimport { computed, onMounted, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport SearchBox from '@/components/common/SearchBox.vue'\nimport PanelTemplate from '@/components/dialog/content/setting/PanelTemplate.vue'\nimport Button from '@/components/ui/button/Button.vue'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useExtensionStore } from '@/stores/extensionStore'\nimport type { ComfyExtension } from '@/types/comfy'\n\nconst { t } = useI18n()\n\nconst filterTypeKeys = ['all', 'core', 'custom'] as const\ntype FilterTypeKey = (typeof filterTypeKeys)[number]\nconst filterTypes = computed(() =>\n  filterTypeKeys.map((key) => ({\n    label: t(`g.${key}`),\n    value: key\n  }))\n)\nconst filterType = ref<FilterTypeKey>('all')\nconst selectedExtensions = ref<ComfyExtension[]>([])\n\nconst filters = ref({\n  global: { value: '', matchMode: FilterMatchMode.CONTAINS }\n})\n\nconst extensionStore = useExtensionStore()\nconst settingStore = useSettingStore()\n\nconst editingEnabledExtensions = ref<Record<string, boolean>>({})\n\nconst filteredExtensions = computed(() => {\n  const extensions = extensionStore.extensions\n  switch (filterType.value) {\n    case 'core':\n      return extensions.filter((ext) =>\n        extensionStore.isCoreExtension(ext.name)\n      )\n    case 'custom':\n      return extensions.filter(\n        (ext) => !extensionStore.isCoreExtension(ext.name)\n      )\n    default:\n      return extensions\n  }\n})\n\nonMounted(() => {\n  extensionStore.extensions.forEach((ext) => {\n    editingEnabledExtensions.value[ext.name] =\n      extensionStore.isExtensionEnabled(ext.name)\n  })\n})\n\nconst changedExtensions = computed(() => {\n  return extensionStore.extensions.filter(\n    (ext) =>\n      editingEnabledExtensions.value[ext.name] !==\n      extensionStore.isExtensionEnabled(ext.name)\n  )\n})\n\nconst hasChanges = computed(() => {\n  return changedExtensions.value.length > 0\n})\n\nconst updateExtensionStatus = async () => {\n  const editingDisabledExtensionNames = Object.entries(\n    editingEnabledExtensions.value\n  )\n    .filter(([_, enabled]) => !enabled)\n    .map(([name]) => name)\n\n  await settingStore.set('Comfy.Extension.Disabled', [\n    ...extensionStore.inactiveDisabledExtensionNames,\n    ...editingDisabledExtensionNames\n  ])\n}\n\nconst enableAllExtensions = async () => {\n  extensionStore.extensions.forEach((ext) => {\n    if (extensionStore.isExtensionReadOnly(ext.name)) return\n\n    editingEnabledExtensions.value[ext.name] = true\n  })\n  await updateExtensionStatus()\n}\n\nconst disableAllExtensions = async () => {\n  extensionStore.extensions.forEach((ext) => {\n    if (extensionStore.isExtensionReadOnly(ext.name)) return\n\n    editingEnabledExtensions.value[ext.name] = false\n  })\n  await updateExtensionStatus()\n}\n\nconst disableThirdPartyExtensions = async () => {\n  extensionStore.extensions.forEach((ext) => {\n    if (extensionStore.isCoreExtension(ext.name)) return\n\n    editingEnabledExtensions.value[ext.name] = false\n  })\n  await updateExtensionStatus()\n}\n\nconst applyChanges = () => {\n  // Refresh the page to apply changes\n  window.location.reload()\n}\n\nconst menu = ref<InstanceType<typeof ContextMenu>>()\nconst contextMenuItems = computed(() => [\n  {\n    label: t('g.enableSelected'),\n    icon: 'pi pi-check',\n    command: async () => {\n      selectedExtensions.value.forEach((ext) => {\n        if (!extensionStore.isExtensionReadOnly(ext.name)) {\n          editingEnabledExtensions.value[ext.name] = true\n        }\n      })\n      await updateExtensionStatus()\n    }\n  },\n  {\n    label: t('g.disableSelected'),\n    icon: 'pi pi-times',\n    command: async () => {\n      selectedExtensions.value.forEach((ext) => {\n        if (!extensionStore.isExtensionReadOnly(ext.name)) {\n          editingEnabledExtensions.value[ext.name] = false\n        }\n      })\n      await updateExtensionStatus()\n    }\n  },\n  {\n    separator: true\n  },\n  {\n    label: t('g.enableAll'),\n    icon: 'pi pi-check',\n    command: enableAllExtensions\n  },\n  {\n    label: t('g.disableAll'),\n    icon: 'pi pi-times',\n    command: disableAllExtensions\n  },\n  {\n    label: t('g.disableThirdParty'),\n    icon: 'pi pi-times',\n    command: disableThirdPartyExtensions,\n    disabled: !extensionStore.hasThirdPartyExtensions\n  }\n])\n</script>\n"],"mappings":"0nBCqFgC,IACb,IACK,IACF,IACF,IACK,IACT,IACS,IAED,IAEF,IACI,IACP,IACa,IACE,gGAGlC,GAAM,CAAE,GAAM,GAAQ,CAEhB,EAAiB,CAAC,MAAO,OAAQ,SAAS,CAE1C,EAAc,MAClB,EAAe,IAAK,IAAS,CAC3B,MAAO,EAAE,KAAK,IAAM,CACpB,MAAO,EACR,EAAC,CACJ,CACM,EAAa,EAAmB,MAAK,CACrC,EAAqB,EAAsB,EAAE,CAAA,CAE7C,EAAU,EAAI,CAClB,OAAQ,CAAE,MAAO,GAAI,UAAW,EAAgB,SAAS,CAC1D,CAAA,CAEK,EAAiB,GAAkB,CACnC,EAAe,GAAgB,CAE/B,EAA2B,EAA6B,EAAE,CAAA,CAE1D,EAAqB,MAAe,CACxC,IAAM,EAAa,EAAe,WAClC,OAAQ,EAAW,MAAnB,CACE,IAAK,OACH,OAAO,EAAW,OAAQ,GACxB,EAAe,gBAAgB,EAAI,KAAI,CACzC,CACF,IAAK,SACH,OAAO,EAAW,OACf,GAAQ,CAAC,EAAe,gBAAgB,EAAI,KAAI,CACnD,CACF,QACE,OAAO,IAEZ,CAED,MAAgB,CACd,EAAe,WAAW,QAAS,GAAQ,CACzC,EAAyB,MAAM,EAAI,MACjC,EAAe,mBAAmB,EAAI,KAAI,EAC7C,EACF,CAED,IAAM,EAAoB,MACjB,EAAe,WAAW,OAC9B,GACC,EAAyB,MAAM,EAAI,QACnC,EAAe,mBAAmB,EAAI,KAAI,CAC9C,CACD,CAEK,EAAa,MACV,EAAkB,MAAM,OAAS,EACzC,CAEK,sBAAwB,SAAY,CACxC,IAAM,EAAgC,OAAO,QAC3C,EAAyB,MAC3B,CACG,QAAQ,CAAC,EAAG,KAAa,CAAC,EAAO,CACjC,KAAK,CAAC,KAAU,EAAI,CAEvB,MAAM,EAAa,IAAI,2BAA4B,CACjD,GAAG,EAAe,+BAClB,GAAG,EACJ,CAAA,EAGG,oBAAsB,SAAY,CACtC,EAAe,WAAW,QAAS,GAAQ,CACrC,EAAe,oBAAoB,EAAI,KAAK,GAEhD,EAAyB,MAAM,EAAI,MAAQ,KAC5C,CACD,MAAM,uBAAsB,EAGxB,qBAAuB,SAAY,CACvC,EAAe,WAAW,QAAS,GAAQ,CACrC,EAAe,oBAAoB,EAAI,KAAK,GAEhD,EAAyB,MAAM,EAAI,MAAQ,KAC5C,CACD,MAAM,uBAAsB,EAGxB,4BAA8B,SAAY,CAC9C,EAAe,WAAW,QAAS,GAAQ,CACrC,EAAe,gBAAgB,EAAI,KAAK,GAE5C,EAAyB,MAAM,EAAI,MAAQ,KAC5C,CACD,MAAM,uBAAsB,EAGxB,iBAAqB,CAEzB,OAAO,SAAS,QAAO,EAGnB,EAAO,GAAsC,CAC7C,EAAmB,MAAe,CACtC,CACE,MAAO,EAAE,mBAAmB,CAC5B,KAAM,cACN,QAAS,SAAY,CACnB,EAAmB,MAAM,QAAS,GAAQ,CACnC,EAAe,oBAAoB,EAAI,KAAK,GAC/C,EAAyB,MAAM,EAAI,MAAQ,KAE9C,CACD,MAAM,uBAAsB,EAE/B,CACD,CACE,MAAO,EAAE,oBAAoB,CAC7B,KAAM,cACN,QAAS,SAAY,CACnB,EAAmB,MAAM,QAAS,GAAQ,CACnC,EAAe,oBAAoB,EAAI,KAAK,GAC/C,EAAyB,MAAM,EAAI,MAAQ,KAE9C,CACD,MAAM,uBAAsB,EAE/B,CACD,CACE,UAAW,GACZ,CACD,CACE,MAAO,EAAE,cAAc,CACvB,KAAM,cACN,QAAS,oBACV,CACD,CACE,MAAO,EAAE,eAAe,CACxB,KAAM,cACN,QAAS,qBACV,CACD,CACE,MAAO,EAAE,sBAAsB,CAC/B,KAAM,cACN,QAAS,4BACT,SAAU,CAAC,EAAe,yBAE7B,CAAA"}