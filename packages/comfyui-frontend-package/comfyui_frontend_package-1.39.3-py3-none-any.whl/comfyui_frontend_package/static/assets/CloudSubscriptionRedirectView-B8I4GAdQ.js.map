{"version":3,"file":"CloudSubscriptionRedirectView-B8I4GAdQ.js","names":[],"sources":["../../src/platform/cloud/onboarding/CloudSubscriptionRedirectView.vue","../../src/platform/cloud/onboarding/CloudSubscriptionRedirectView.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { until } from '@vueuse/core'\nimport Button from 'primevue/button'\nimport ProgressSpinner from 'primevue/progressspinner'\nimport { computed, onMounted, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\nimport { useRoute, useRouter } from 'vue-router'\n\nimport { useFirebaseAuthActions } from '@/composables/auth/useFirebaseAuthActions'\nimport { useErrorHandling } from '@/composables/useErrorHandling'\nimport { useSubscription } from '@/platform/cloud/subscription/composables/useSubscription'\nimport type { TierKey } from '@/platform/cloud/subscription/constants/tierPricing'\nimport { performSubscriptionCheckout } from '@/platform/cloud/subscription/utils/subscriptionCheckoutUtil'\n\nimport type { BillingCycle } from '../subscription/utils/subscriptionTierRank'\n\nconst { t } = useI18n()\nconst route = useRoute()\nconst router = useRouter()\nconst { reportError, accessBillingPortal } = useFirebaseAuthActions()\nconst { wrapWithErrorHandlingAsync } = useErrorHandling()\n\nconst { isActiveSubscription, isInitialized } = useSubscription()\n\nconst selectedTierKey = ref<TierKey | null>(null)\n\nconst tierDisplayName = computed(() => {\n  if (!selectedTierKey.value) return ''\n  const names: Record<TierKey, string> = {\n    standard: t('subscription.tiers.standard.name'),\n    creator: t('subscription.tiers.creator.name'),\n    pro: t('subscription.tiers.pro.name'),\n    founder: t('subscription.tiers.founder.name')\n  }\n  return names[selectedTierKey.value]\n})\n\nconst runRedirect = wrapWithErrorHandlingAsync(async () => {\n  const rawType = route.query.tier\n  const rawCycle = route.query.cycle\n  let tierKeyParam: string | null = null\n  let cycleParam = 'monthly'\n\n  if (typeof rawType === 'string') {\n    tierKeyParam = rawType\n  } else if (Array.isArray(rawType) && rawType[0]) {\n    tierKeyParam = rawType[0]\n  }\n\n  if (typeof rawCycle === 'string') {\n    cycleParam = rawCycle\n  } else if (Array.isArray(rawCycle) && rawCycle[0]) {\n    cycleParam = rawCycle[0]\n  }\n\n  if (!tierKeyParam) {\n    await router.push('/')\n    return\n  }\n\n  const validTierKeys: TierKey[] = ['standard', 'creator', 'pro', 'founder']\n  if (!(validTierKeys as string[]).includes(tierKeyParam)) {\n    await router.push('/')\n    return\n  }\n\n  const tierKey = tierKeyParam as TierKey\n\n  selectedTierKey.value = tierKey\n\n  const validCycles: BillingCycle[] = ['monthly', 'yearly']\n  if (!cycleParam || !(validCycles as string[]).includes(cycleParam)) {\n    cycleParam = 'monthly'\n  }\n\n  if (!isInitialized.value) {\n    await until(isInitialized).toBe(true)\n  }\n\n  if (isActiveSubscription.value) {\n    await accessBillingPortal(undefined, false)\n  } else {\n    await performSubscriptionCheckout(\n      tierKey,\n      cycleParam as BillingCycle,\n      false\n    )\n  }\n}, reportError)\n\nonMounted(() => {\n  void runRedirect()\n})\n</script>\n\n<template>\n  <div\n    class=\"flex h-full w-full items-center justify-center bg-comfy-menu-secondary-bg\"\n  >\n    <div class=\"flex flex-col items-center gap-4\">\n      <img\n        src=\"/assets/images/comfy-logo-single.svg\"\n        :alt=\"t('g.comfyOrgLogoAlt')\"\n        class=\"h-16 w-16\"\n      />\n      <p\n        v-if=\"selectedTierKey\"\n        class=\"font-inter text-base font-normal leading-normal text-base-foreground\"\n      >\n        {{\n          t('subscription.subscribeTo', {\n            plan: tierDisplayName\n          })\n        }}\n      </p>\n      <ProgressSpinner\n        v-if=\"selectedTierKey\"\n        class=\"h-8 w-8\"\n        stroke-width=\"4\"\n      />\n      <Button\n        v-if=\"selectedTierKey\"\n        as=\"a\"\n        href=\"/\"\n        link\n        :label=\"t('cloudOnboarding.skipToCloudApp')\"\n      />\n    </div>\n  </div>\n</template>\n","<script setup lang=\"ts\">\nimport { until } from '@vueuse/core'\nimport Button from 'primevue/button'\nimport ProgressSpinner from 'primevue/progressspinner'\nimport { computed, onMounted, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\nimport { useRoute, useRouter } from 'vue-router'\n\nimport { useFirebaseAuthActions } from '@/composables/auth/useFirebaseAuthActions'\nimport { useErrorHandling } from '@/composables/useErrorHandling'\nimport { useSubscription } from '@/platform/cloud/subscription/composables/useSubscription'\nimport type { TierKey } from '@/platform/cloud/subscription/constants/tierPricing'\nimport { performSubscriptionCheckout } from '@/platform/cloud/subscription/utils/subscriptionCheckoutUtil'\n\nimport type { BillingCycle } from '../subscription/utils/subscriptionTierRank'\n\nconst { t } = useI18n()\nconst route = useRoute()\nconst router = useRouter()\nconst { reportError, accessBillingPortal } = useFirebaseAuthActions()\nconst { wrapWithErrorHandlingAsync } = useErrorHandling()\n\nconst { isActiveSubscription, isInitialized } = useSubscription()\n\nconst selectedTierKey = ref<TierKey | null>(null)\n\nconst tierDisplayName = computed(() => {\n  if (!selectedTierKey.value) return ''\n  const names: Record<TierKey, string> = {\n    standard: t('subscription.tiers.standard.name'),\n    creator: t('subscription.tiers.creator.name'),\n    pro: t('subscription.tiers.pro.name'),\n    founder: t('subscription.tiers.founder.name')\n  }\n  return names[selectedTierKey.value]\n})\n\nconst runRedirect = wrapWithErrorHandlingAsync(async () => {\n  const rawType = route.query.tier\n  const rawCycle = route.query.cycle\n  let tierKeyParam: string | null = null\n  let cycleParam = 'monthly'\n\n  if (typeof rawType === 'string') {\n    tierKeyParam = rawType\n  } else if (Array.isArray(rawType) && rawType[0]) {\n    tierKeyParam = rawType[0]\n  }\n\n  if (typeof rawCycle === 'string') {\n    cycleParam = rawCycle\n  } else if (Array.isArray(rawCycle) && rawCycle[0]) {\n    cycleParam = rawCycle[0]\n  }\n\n  if (!tierKeyParam) {\n    await router.push('/')\n    return\n  }\n\n  const validTierKeys: TierKey[] = ['standard', 'creator', 'pro', 'founder']\n  if (!(validTierKeys as string[]).includes(tierKeyParam)) {\n    await router.push('/')\n    return\n  }\n\n  const tierKey = tierKeyParam as TierKey\n\n  selectedTierKey.value = tierKey\n\n  const validCycles: BillingCycle[] = ['monthly', 'yearly']\n  if (!cycleParam || !(validCycles as string[]).includes(cycleParam)) {\n    cycleParam = 'monthly'\n  }\n\n  if (!isInitialized.value) {\n    await until(isInitialized).toBe(true)\n  }\n\n  if (isActiveSubscription.value) {\n    await accessBillingPortal(undefined, false)\n  } else {\n    await performSubscriptionCheckout(\n      tierKey,\n      cycleParam as BillingCycle,\n      false\n    )\n  }\n}, reportError)\n\nonMounted(() => {\n  void runRedirect()\n})\n</script>\n\n<template>\n  <div\n    class=\"flex h-full w-full items-center justify-center bg-comfy-menu-secondary-bg\"\n  >\n    <div class=\"flex flex-col items-center gap-4\">\n      <img\n        src=\"/assets/images/comfy-logo-single.svg\"\n        :alt=\"t('g.comfyOrgLogoAlt')\"\n        class=\"h-16 w-16\"\n      />\n      <p\n        v-if=\"selectedTierKey\"\n        class=\"font-inter text-base font-normal leading-normal text-base-foreground\"\n      >\n        {{\n          t('subscription.subscribeTo', {\n            plan: tierDisplayName\n          })\n        }}\n      </p>\n      <ProgressSpinner\n        v-if=\"selectedTierKey\"\n        class=\"h-8 w-8\"\n        stroke-width=\"4\"\n      />\n      <Button\n        v-if=\"selectedTierKey\"\n        as=\"a\"\n        href=\"/\"\n        link\n        :label=\"t('cloudOnboarding.skipToCloudApp')\"\n      />\n    </div>\n  </div>\n</template>\n"],"mappings":"2jBCCsB,IACH,IACS,IAEJ,IACY,IAEG,IACN,IACD,IAEY,0RAI5C,GAAM,CAAE,GAAM,GAAQ,CAChB,EAAQ,GAAS,CACjB,EAAS,GAAU,CACnB,CAAE,cAAa,uBAAwB,GAAuB,CAC9D,CAAE,8BAA+B,GAAiB,CAElD,CAAE,uBAAsB,iBAAkB,GAAgB,CAE1D,EAAkB,EAAoB,KAAI,CAE1C,EAAkB,MACjB,EAAgB,MACkB,CACrC,SAAU,EAAE,mCAAmC,CAC/C,QAAS,EAAE,kCAAkC,CAC7C,IAAK,EAAE,8BAA8B,CACrC,QAAS,EAAE,kCAAA,CACb,CACa,EAAgB,OAPM,GAQpC,CAEK,EAAc,EAA2B,SAAY,CACzD,IAAM,EAAU,EAAM,MAAM,KACtB,EAAW,EAAM,MAAM,MACzB,EAA8B,KAC9B,EAAa,UAcjB,GAZI,OAAO,GAAY,SACrB,EAAe,EACN,MAAM,QAAQ,EAAQ,EAAI,EAAQ,KAC3C,EAAe,EAAQ,IAGrB,OAAO,GAAa,SACtB,EAAa,EACJ,MAAM,QAAQ,EAAS,EAAI,EAAS,KAC7C,EAAa,EAAS,IAGpB,CAAC,EAAc,CACjB,MAAM,EAAO,KAAK,IAAG,CACrB,OAIF,GAAI,CAD6B,CAAC,WAAY,UAAW,MAAO,UAAS,CACxC,SAAS,EAAa,CAAE,CACvD,MAAM,EAAO,KAAK,IAAG,CACrB,OAGF,IAAM,EAAU,EAEhB,EAAgB,MAAQ,GAGpB,CAAC,GAAc,CADiB,CAAC,UAAW,SAAQ,CACV,SAAS,EAAW,IAChE,EAAa,WAGV,EAAc,OACjB,MAAM,EAAM,EAAc,CAAC,KAAK,GAAI,CAGlC,EAAqB,MACvB,MAAM,EAAoB,IAAA,GAAW,GAAK,CAE1C,MAAM,EACJ,EACA,EACA,GACF,EAED,EAAW,QAEd,MAAgB,CACT,GAAY,EAClB"}