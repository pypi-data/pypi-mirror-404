{"version":3,"file":"WidgetImageCrop-B9GfP40y.js","names":[],"sources":["../../src/composables/useImageCrop.ts","../../src/components/imagecrop/WidgetImageCrop.vue","../../src/components/imagecrop/WidgetImageCrop.vue"],"sourcesContent":["import { useResizeObserver } from '@vueuse/core'\nimport type { Ref } from 'vue'\nimport { computed, onMounted, ref, watch } from 'vue'\n\nimport type { LGraphNode, NodeId } from '@/lib/litegraph/src/LGraphNode'\nimport type { Bounds } from '@/renderer/core/layout/types'\nimport { app } from '@/scripts/app'\nimport { useNodeOutputStore } from '@/stores/imagePreviewStore'\n\ntype ResizeDirection =\n  | 'top'\n  | 'bottom'\n  | 'left'\n  | 'right'\n  | 'nw'\n  | 'ne'\n  | 'sw'\n  | 'se'\n\nconst HANDLE_SIZE = 8\nconst CORNER_SIZE = 10\nconst MIN_CROP_SIZE = 16\nconst CROP_BOX_BORDER = 2\n\ninterface UseImageCropOptions {\n  imageEl: Ref<HTMLImageElement | null>\n  containerEl: Ref<HTMLDivElement | null>\n  modelValue: Ref<Bounds>\n}\n\nexport function useImageCrop(nodeId: NodeId, options: UseImageCropOptions) {\n  const { imageEl, containerEl, modelValue } = options\n  const nodeOutputStore = useNodeOutputStore()\n\n  const node = ref<LGraphNode | null>(null)\n\n  const imageUrl = ref<string | null>(null)\n  const isLoading = ref(false)\n\n  const naturalWidth = ref(0)\n  const naturalHeight = ref(0)\n  const displayedWidth = ref(0)\n  const displayedHeight = ref(0)\n  const scaleFactor = ref(1)\n  const imageOffsetX = ref(0)\n  const imageOffsetY = ref(0)\n\n  const cropX = computed({\n    get: () => modelValue.value.x,\n    set: (v: number) => {\n      modelValue.value.x = v\n    }\n  })\n\n  const cropY = computed({\n    get: () => modelValue.value.y,\n    set: (v: number) => {\n      modelValue.value.y = v\n    }\n  })\n\n  const cropWidth = computed({\n    get: () => modelValue.value.width || 512,\n    set: (v: number) => {\n      modelValue.value.width = v\n    }\n  })\n\n  const cropHeight = computed({\n    get: () => modelValue.value.height || 512,\n    set: (v: number) => {\n      modelValue.value.height = v\n    }\n  })\n\n  const isDragging = ref(false)\n  const dragStartX = ref(0)\n  const dragStartY = ref(0)\n  const dragStartCropX = ref(0)\n  const dragStartCropY = ref(0)\n\n  const isResizing = ref(false)\n  const resizeDirection = ref<ResizeDirection | null>(null)\n  const resizeStartX = ref(0)\n  const resizeStartY = ref(0)\n  const resizeStartCropX = ref(0)\n  const resizeStartCropY = ref(0)\n  const resizeStartCropWidth = ref(0)\n  const resizeStartCropHeight = ref(0)\n\n  useResizeObserver(containerEl, () => {\n    if (imageEl.value && imageUrl.value) {\n      updateDisplayedDimensions()\n    }\n  })\n\n  const getInputImageUrl = (): string | null => {\n    if (!node.value) return null\n\n    const inputNode = node.value.getInputNode(0)\n\n    if (!inputNode) return null\n\n    const urls = nodeOutputStore.getNodeImageUrls(inputNode)\n\n    if (urls?.length) {\n      return urls[0]\n    }\n\n    return null\n  }\n\n  const updateImageUrl = () => {\n    imageUrl.value = getInputImageUrl()\n  }\n\n  const updateDisplayedDimensions = () => {\n    if (!imageEl.value || !containerEl.value) return\n\n    const img = imageEl.value\n    const container = containerEl.value\n\n    naturalWidth.value = img.naturalWidth\n    naturalHeight.value = img.naturalHeight\n\n    if (naturalWidth.value <= 0 || naturalHeight.value <= 0) {\n      scaleFactor.value = 1\n      return\n    }\n\n    const containerWidth = container.clientWidth\n    const containerHeight = container.clientHeight\n\n    const imageAspect = naturalWidth.value / naturalHeight.value\n    const containerAspect = containerWidth / containerHeight\n\n    if (imageAspect > containerAspect) {\n      displayedWidth.value = containerWidth\n      displayedHeight.value = containerWidth / imageAspect\n      imageOffsetX.value = 0\n      imageOffsetY.value = (containerHeight - displayedHeight.value) / 2\n    } else {\n      displayedHeight.value = containerHeight\n      displayedWidth.value = containerHeight * imageAspect\n      imageOffsetX.value = (containerWidth - displayedWidth.value) / 2\n      imageOffsetY.value = 0\n    }\n\n    if (naturalWidth.value <= 0 || displayedWidth.value <= 0) {\n      scaleFactor.value = 1\n    } else {\n      scaleFactor.value = displayedWidth.value / naturalWidth.value\n    }\n  }\n\n  const getEffectiveScale = (): number => {\n    const container = containerEl.value\n\n    if (!container || naturalWidth.value <= 0 || displayedWidth.value <= 0) {\n      return 1\n    }\n\n    const rect = container.getBoundingClientRect()\n    const clientWidth = container.clientWidth\n\n    if (!clientWidth || !rect.width) return 1\n\n    const renderedDisplayedWidth =\n      (displayedWidth.value / clientWidth) * rect.width\n\n    return renderedDisplayedWidth / naturalWidth.value\n  }\n\n  const cropBoxStyle = computed(() => ({\n    left: `${imageOffsetX.value + cropX.value * scaleFactor.value - CROP_BOX_BORDER}px`,\n    top: `${imageOffsetY.value + cropY.value * scaleFactor.value - CROP_BOX_BORDER}px`,\n    width: `${cropWidth.value * scaleFactor.value}px`,\n    height: `${cropHeight.value * scaleFactor.value}px`\n  }))\n\n  const cropImageStyle = computed(() => {\n    if (!imageUrl.value) return {}\n\n    return {\n      backgroundImage: `url(${imageUrl.value})`,\n      backgroundSize: `${displayedWidth.value}px ${displayedHeight.value}px`,\n      backgroundPosition: `-${cropX.value * scaleFactor.value}px -${cropY.value * scaleFactor.value}px`,\n      backgroundRepeat: 'no-repeat'\n    }\n  })\n\n  interface ResizeHandle {\n    direction: ResizeDirection\n    class: string\n    style: {\n      left: string\n      top: string\n      width?: string\n      height?: string\n    }\n  }\n\n  const resizeHandles = computed<ResizeHandle[]>(() => {\n    const x = imageOffsetX.value + cropX.value * scaleFactor.value\n    const y = imageOffsetY.value + cropY.value * scaleFactor.value\n    const w = cropWidth.value * scaleFactor.value\n    const h = cropHeight.value * scaleFactor.value\n\n    return [\n      {\n        direction: 'top',\n        class: 'h-2 cursor-ns-resize',\n        style: {\n          left: `${x + HANDLE_SIZE}px`,\n          top: `${y - HANDLE_SIZE / 2}px`,\n          width: `${Math.max(0, w - HANDLE_SIZE * 2)}px`\n        }\n      },\n      {\n        direction: 'bottom',\n        class: 'h-2 cursor-ns-resize',\n        style: {\n          left: `${x + HANDLE_SIZE}px`,\n          top: `${y + h - HANDLE_SIZE / 2}px`,\n          width: `${Math.max(0, w - HANDLE_SIZE * 2)}px`\n        }\n      },\n      {\n        direction: 'left',\n        class: 'w-2 cursor-ew-resize',\n        style: {\n          left: `${x - HANDLE_SIZE / 2}px`,\n          top: `${y + HANDLE_SIZE}px`,\n          height: `${Math.max(0, h - HANDLE_SIZE * 2)}px`\n        }\n      },\n      {\n        direction: 'right',\n        class: 'w-2 cursor-ew-resize',\n        style: {\n          left: `${x + w - HANDLE_SIZE / 2}px`,\n          top: `${y + HANDLE_SIZE}px`,\n          height: `${Math.max(0, h - HANDLE_SIZE * 2)}px`\n        }\n      },\n      {\n        direction: 'nw',\n        class: 'cursor-nwse-resize rounded-sm bg-white/80',\n        style: {\n          left: `${x - CORNER_SIZE / 2}px`,\n          top: `${y - CORNER_SIZE / 2}px`,\n          width: `${CORNER_SIZE}px`,\n          height: `${CORNER_SIZE}px`\n        }\n      },\n      {\n        direction: 'ne',\n        class: 'cursor-nesw-resize rounded-sm bg-white/80',\n        style: {\n          left: `${x + w - CORNER_SIZE / 2}px`,\n          top: `${y - CORNER_SIZE / 2}px`,\n          width: `${CORNER_SIZE}px`,\n          height: `${CORNER_SIZE}px`\n        }\n      },\n      {\n        direction: 'sw',\n        class: 'cursor-nesw-resize rounded-sm bg-white/80',\n        style: {\n          left: `${x - CORNER_SIZE / 2}px`,\n          top: `${y + h - CORNER_SIZE / 2}px`,\n          width: `${CORNER_SIZE}px`,\n          height: `${CORNER_SIZE}px`\n        }\n      },\n      {\n        direction: 'se',\n        class: 'cursor-nwse-resize rounded-sm bg-white/80',\n        style: {\n          left: `${x + w - CORNER_SIZE / 2}px`,\n          top: `${y + h - CORNER_SIZE / 2}px`,\n          width: `${CORNER_SIZE}px`,\n          height: `${CORNER_SIZE}px`\n        }\n      }\n    ]\n  })\n\n  const handleImageLoad = () => {\n    isLoading.value = false\n    updateDisplayedDimensions()\n  }\n\n  const handleImageError = () => {\n    isLoading.value = false\n    imageUrl.value = null\n  }\n\n  const capturePointer = (e: PointerEvent) =>\n    (e.target as HTMLElement).setPointerCapture(e.pointerId)\n\n  const releasePointer = (e: PointerEvent) =>\n    (e.target as HTMLElement).releasePointerCapture(e.pointerId)\n\n  const handleDragStart = (e: PointerEvent) => {\n    if (!imageUrl.value) return\n\n    isDragging.value = true\n    dragStartX.value = e.clientX\n    dragStartY.value = e.clientY\n    dragStartCropX.value = cropX.value\n    dragStartCropY.value = cropY.value\n    capturePointer(e)\n  }\n\n  const handleDragMove = (e: PointerEvent) => {\n    if (!isDragging.value) return\n\n    const effectiveScale = getEffectiveScale()\n    if (effectiveScale === 0) return\n\n    const deltaX = (e.clientX - dragStartX.value) / effectiveScale\n    const deltaY = (e.clientY - dragStartY.value) / effectiveScale\n\n    const maxX = naturalWidth.value - cropWidth.value\n    const maxY = naturalHeight.value - cropHeight.value\n\n    cropX.value = Math.round(\n      Math.max(0, Math.min(maxX, dragStartCropX.value + deltaX))\n    )\n    cropY.value = Math.round(\n      Math.max(0, Math.min(maxY, dragStartCropY.value + deltaY))\n    )\n  }\n\n  const handleDragEnd = (e: PointerEvent) => {\n    if (!isDragging.value) return\n\n    isDragging.value = false\n    releasePointer(e)\n  }\n\n  const handleResizeStart = (e: PointerEvent, direction: ResizeDirection) => {\n    if (!imageUrl.value) return\n\n    e.stopPropagation()\n    isResizing.value = true\n    resizeDirection.value = direction\n\n    resizeStartX.value = e.clientX\n    resizeStartY.value = e.clientY\n    resizeStartCropX.value = cropX.value\n    resizeStartCropY.value = cropY.value\n    resizeStartCropWidth.value = cropWidth.value\n    resizeStartCropHeight.value = cropHeight.value\n    capturePointer(e)\n  }\n\n  const handleResizeMove = (e: PointerEvent) => {\n    if (!isResizing.value || !resizeDirection.value) return\n\n    const effectiveScale = getEffectiveScale()\n    if (effectiveScale === 0) return\n\n    const dir = resizeDirection.value\n    const deltaX = (e.clientX - resizeStartX.value) / effectiveScale\n    const deltaY = (e.clientY - resizeStartY.value) / effectiveScale\n\n    const affectsLeft = dir === 'left' || dir === 'nw' || dir === 'sw'\n    const affectsRight = dir === 'right' || dir === 'ne' || dir === 'se'\n    const affectsTop = dir === 'top' || dir === 'nw' || dir === 'ne'\n    const affectsBottom = dir === 'bottom' || dir === 'sw' || dir === 'se'\n\n    let newX = resizeStartCropX.value\n    let newY = resizeStartCropY.value\n    let newWidth = resizeStartCropWidth.value\n    let newHeight = resizeStartCropHeight.value\n\n    if (affectsLeft) {\n      const maxDeltaX = resizeStartCropWidth.value - MIN_CROP_SIZE\n      const minDeltaX = -resizeStartCropX.value\n      const clampedDeltaX = Math.max(minDeltaX, Math.min(maxDeltaX, deltaX))\n      newX = resizeStartCropX.value + clampedDeltaX\n      newWidth = resizeStartCropWidth.value - clampedDeltaX\n    } else if (affectsRight) {\n      const maxWidth = naturalWidth.value - resizeStartCropX.value\n      newWidth = Math.max(\n        MIN_CROP_SIZE,\n        Math.min(maxWidth, resizeStartCropWidth.value + deltaX)\n      )\n    }\n\n    if (affectsTop) {\n      const maxDeltaY = resizeStartCropHeight.value - MIN_CROP_SIZE\n      const minDeltaY = -resizeStartCropY.value\n      const clampedDeltaY = Math.max(minDeltaY, Math.min(maxDeltaY, deltaY))\n      newY = resizeStartCropY.value + clampedDeltaY\n      newHeight = resizeStartCropHeight.value - clampedDeltaY\n    } else if (affectsBottom) {\n      const maxHeight = naturalHeight.value - resizeStartCropY.value\n      newHeight = Math.max(\n        MIN_CROP_SIZE,\n        Math.min(maxHeight, resizeStartCropHeight.value + deltaY)\n      )\n    }\n\n    if (affectsLeft || affectsRight) {\n      cropX.value = Math.round(newX)\n      cropWidth.value = Math.round(newWidth)\n    }\n    if (affectsTop || affectsBottom) {\n      cropY.value = Math.round(newY)\n      cropHeight.value = Math.round(newHeight)\n    }\n  }\n\n  const handleResizeEnd = (e: PointerEvent) => {\n    if (!isResizing.value) return\n\n    isResizing.value = false\n    resizeDirection.value = null\n    releasePointer(e)\n  }\n\n  const initialize = () => {\n    if (nodeId != null) {\n      node.value = app.rootGraph?.getNodeById(nodeId) || null\n    }\n\n    updateImageUrl()\n  }\n\n  watch(\n    () => nodeOutputStore.nodeOutputs,\n    () => updateImageUrl(),\n    { deep: true }\n  )\n\n  watch(\n    () => nodeOutputStore.nodePreviewImages,\n    () => updateImageUrl(),\n    { deep: true }\n  )\n\n  onMounted(initialize)\n\n  return {\n    imageUrl,\n    isLoading,\n\n    cropX,\n    cropY,\n    cropWidth,\n    cropHeight,\n\n    cropBoxStyle,\n    cropImageStyle,\n    resizeHandles,\n\n    handleImageLoad,\n    handleImageError,\n    handleDragStart,\n    handleDragMove,\n    handleDragEnd,\n    handleResizeStart,\n    handleResizeMove,\n    handleResizeEnd\n  }\n}\n","<template>\n  <div\n    class=\"widget-expands relative flex h-full w-full flex-col gap-1\"\n    @pointerdown.stop\n    @pointermove.stop\n    @pointerup.stop\n  >\n    <!-- Image preview container -->\n    <div\n      ref=\"containerEl\"\n      class=\"relative min-h-0 flex-1 overflow-hidden rounded-[5px] bg-node-component-surface\"\n    >\n      <div v-if=\"isLoading\" class=\"flex size-full items-center justify-center\">\n        <span class=\"text-sm\">{{ $t('imageCrop.loading') }}</span>\n      </div>\n\n      <div\n        v-else-if=\"!imageUrl\"\n        class=\"flex size-full flex-col items-center justify-center text-center\"\n      >\n        <i class=\"mb-2 icon-[lucide--image] h-12 w-12\" />\n        <p class=\"text-sm\">{{ $t('imageCrop.noInputImage') }}</p>\n      </div>\n\n      <img\n        v-else\n        ref=\"imageEl\"\n        :src=\"imageUrl\"\n        :alt=\"$t('imageCrop.cropPreviewAlt')\"\n        draggable=\"false\"\n        class=\"block size-full object-contain select-none brightness-50\"\n        @load=\"handleImageLoad\"\n        @error=\"handleImageError\"\n        @dragstart.prevent\n      />\n\n      <div\n        v-if=\"imageUrl && !isLoading\"\n        class=\"absolute box-content cursor-move overflow-hidden border-2 border-white\"\n        :style=\"cropBoxStyle\"\n        @pointerdown=\"handleDragStart\"\n        @pointermove=\"handleDragMove\"\n        @pointerup=\"handleDragEnd\"\n      >\n        <div class=\"pointer-events-none size-full\" :style=\"cropImageStyle\" />\n      </div>\n\n      <div\n        v-for=\"handle in resizeHandles\"\n        v-show=\"imageUrl && !isLoading\"\n        :key=\"handle.direction\"\n        :class=\"['absolute', handle.class]\"\n        :style=\"handle.style\"\n        @pointerdown=\"(e) => handleResizeStart(e, handle.direction)\"\n        @pointermove=\"handleResizeMove\"\n        @pointerup=\"handleResizeEnd\"\n      />\n    </div>\n\n    <WidgetBoundingBox v-model=\"modelValue\" class=\"shrink-0\" />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useTemplateRef } from 'vue'\n\nimport WidgetBoundingBox from '@/components/boundingbox/WidgetBoundingBox.vue'\nimport { useImageCrop } from '@/composables/useImageCrop'\nimport type { NodeId } from '@/platform/workflow/validation/schemas/workflowSchema'\nimport type { Bounds } from '@/renderer/core/layout/types'\n\nconst props = defineProps<{\n  nodeId: NodeId\n}>()\n\nconst modelValue = defineModel<Bounds>({\n  default: () => ({ x: 0, y: 0, width: 512, height: 512 })\n})\n\nconst imageEl = useTemplateRef<HTMLImageElement>('imageEl')\nconst containerEl = useTemplateRef<HTMLDivElement>('containerEl')\n\nconst {\n  imageUrl,\n  isLoading,\n\n  cropBoxStyle,\n  cropImageStyle,\n  resizeHandles,\n\n  handleImageLoad,\n  handleImageError,\n  handleDragStart,\n  handleDragMove,\n  handleDragEnd,\n  handleResizeStart,\n  handleResizeMove,\n  handleResizeEnd\n} = useImageCrop(props.nodeId, { imageEl, containerEl, modelValue })\n</script>\n","<template>\n  <div\n    class=\"widget-expands relative flex h-full w-full flex-col gap-1\"\n    @pointerdown.stop\n    @pointermove.stop\n    @pointerup.stop\n  >\n    <!-- Image preview container -->\n    <div\n      ref=\"containerEl\"\n      class=\"relative min-h-0 flex-1 overflow-hidden rounded-[5px] bg-node-component-surface\"\n    >\n      <div v-if=\"isLoading\" class=\"flex size-full items-center justify-center\">\n        <span class=\"text-sm\">{{ $t('imageCrop.loading') }}</span>\n      </div>\n\n      <div\n        v-else-if=\"!imageUrl\"\n        class=\"flex size-full flex-col items-center justify-center text-center\"\n      >\n        <i class=\"mb-2 icon-[lucide--image] h-12 w-12\" />\n        <p class=\"text-sm\">{{ $t('imageCrop.noInputImage') }}</p>\n      </div>\n\n      <img\n        v-else\n        ref=\"imageEl\"\n        :src=\"imageUrl\"\n        :alt=\"$t('imageCrop.cropPreviewAlt')\"\n        draggable=\"false\"\n        class=\"block size-full object-contain select-none brightness-50\"\n        @load=\"handleImageLoad\"\n        @error=\"handleImageError\"\n        @dragstart.prevent\n      />\n\n      <div\n        v-if=\"imageUrl && !isLoading\"\n        class=\"absolute box-content cursor-move overflow-hidden border-2 border-white\"\n        :style=\"cropBoxStyle\"\n        @pointerdown=\"handleDragStart\"\n        @pointermove=\"handleDragMove\"\n        @pointerup=\"handleDragEnd\"\n      >\n        <div class=\"pointer-events-none size-full\" :style=\"cropImageStyle\" />\n      </div>\n\n      <div\n        v-for=\"handle in resizeHandles\"\n        v-show=\"imageUrl && !isLoading\"\n        :key=\"handle.direction\"\n        :class=\"['absolute', handle.class]\"\n        :style=\"handle.style\"\n        @pointerdown=\"(e) => handleResizeStart(e, handle.direction)\"\n        @pointermove=\"handleResizeMove\"\n        @pointerup=\"handleResizeEnd\"\n      />\n    </div>\n\n    <WidgetBoundingBox v-model=\"modelValue\" class=\"shrink-0\" />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useTemplateRef } from 'vue'\n\nimport WidgetBoundingBox from '@/components/boundingbox/WidgetBoundingBox.vue'\nimport { useImageCrop } from '@/composables/useImageCrop'\nimport type { NodeId } from '@/platform/workflow/validation/schemas/workflowSchema'\nimport type { Bounds } from '@/renderer/core/layout/types'\n\nconst props = defineProps<{\n  nodeId: NodeId\n}>()\n\nconst modelValue = defineModel<Bounds>({\n  default: () => ({ x: 0, y: 0, width: 512, height: 512 })\n})\n\nconst imageEl = useTemplateRef<HTMLImageElement>('imageEl')\nconst containerEl = useTemplateRef<HTMLDivElement>('containerEl')\n\nconst {\n  imageUrl,\n  isLoading,\n\n  cropBoxStyle,\n  cropImageStyle,\n  resizeHandles,\n\n  handleImageLoad,\n  handleImageError,\n  handleDragStart,\n  handleDragMove,\n  handleDragEnd,\n  handleResizeStart,\n  handleResizeMove,\n  handleResizeEnd\n} = useImageCrop(props.nodeId, { imageEl, containerEl, modelValue })\n</script>\n"],"mappings":"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"}