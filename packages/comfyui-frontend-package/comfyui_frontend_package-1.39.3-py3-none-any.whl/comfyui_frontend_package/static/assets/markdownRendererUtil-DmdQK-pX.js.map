{"version":3,"file":"markdownRendererUtil-DmdQK-pX.js","names":[],"sources":["../../src/utils/markdownRendererUtil.ts"],"sourcesContent":["import { default as DOMPurify } from 'dompurify'\nimport { Renderer, marked } from 'marked'\n\nconst ALLOWED_TAGS = ['video', 'source']\nconst ALLOWED_ATTRS = [\n  'controls',\n  'autoplay',\n  'loop',\n  'muted',\n  'preload',\n  'poster'\n]\n\n// Matches relative src attributes in img, source, and video HTML tags\n// Captures: 1) opening tag with src=\", 2) relative path, 3) closing quote\n// Excludes absolute paths (starting with /) and URLs (http:// or https://)\nconst MEDIA_SRC_REGEX =\n  /(<(?:img|source|video)[^>]*\\ssrc=['\"])(?!(?:\\/|https?:\\/\\/))([^'\"\\s>]+)(['\"])/gi\n\n// Create a marked Renderer that prefixes relative URLs with base\nexport function createMarkdownRenderer(baseUrl?: string): Renderer {\n  const normalizedBase = baseUrl ? baseUrl.replace(/\\/+$/, '') : ''\n  const renderer = new Renderer()\n  renderer.image = ({ href, title, text }) => {\n    let src = href\n    if (normalizedBase && !/^(?:\\/|https?:\\/\\/)/.test(href)) {\n      src = `${normalizedBase}/${href}`\n    }\n    const titleAttr = title ? ` title=\"${title}\"` : ''\n    return `<img src=\"${src}\" alt=\"${text}\"${titleAttr} />`\n  }\n  renderer.link = ({ href, title, tokens, text }) => {\n    // For autolinks (bare URLs), tokens may be undefined, so fall back to text\n    const linkText = tokens ? renderer.parser.parseInline(tokens) : text\n    const titleAttr = title ? ` title=\"${title}\"` : ''\n    return `<a href=\"${href}\" ${titleAttr} target=\"_blank\" rel=\"noopener noreferrer\">${linkText}</a>`\n  }\n  return renderer\n}\n\nexport function renderMarkdownToHtml(\n  markdown: string,\n  baseUrl?: string\n): string {\n  if (!markdown) return ''\n\n  let html = marked.parse(markdown, {\n    renderer: createMarkdownRenderer(baseUrl),\n    gfm: true // Enable GitHub Flavored Markdown (including autolinks)\n  }) as string\n\n  if (baseUrl) {\n    html = html.replace(MEDIA_SRC_REGEX, `$1${baseUrl}$2$3`)\n  }\n\n  return DOMPurify.sanitize(html, {\n    ADD_TAGS: ALLOWED_TAGS,\n    ADD_ATTR: [...ALLOWED_ATTRS, 'target', 'rel']\n  })\n}\n"],"mappings":"qIAoBA,SAAgB,uBAAuB,EAA4B,CACjE,IAAM,EAAiB,EAAU,EAAQ,QAAQ,OAAQ,GAAG,CAAG,GACzD,EAAW,IAAI,EAerB,MAdA,GAAS,OAAS,CAAE,OAAM,QAAO,UAAW,CAC1C,IAAI,EAAM,EACN,GAAkB,CAAC,sBAAsB,KAAK,EAAK,GACrD,EAAM,GAAG,EAAe,GAAG,KAE7B,IAAM,EAAY,EAAQ,WAAW,EAAM,GAAK,GAChD,MAAO,aAAa,EAAI,SAAS,EAAK,GAAG,EAAU,MAErD,EAAS,MAAQ,CAAE,OAAM,QAAO,SAAQ,UAAW,CAEjD,IAAM,EAAW,EAAS,EAAS,OAAO,YAAY,EAAO,CAAG,EAEhE,MAAO,YAAY,EAAK,IADN,EAAQ,WAAW,EAAM,GAAK,GACV,6CAA6C,EAAS,OAEvF,EAGT,SAAgB,qBACd,EACA,EACQ,CACR,GAAI,CAAC,EAAU,MAAO,GAEtB,IAAI,EAAO,EAAO,MAAM,EAAU,CAChC,SAAU,uBAAuB,EAAQ,CACzC,IAAK,GACN,CAAC,CAMF,OAJI,IACF,EAAO,EAAK,QAAQ,EAAiB,KAAK,EAAQ,MAAM,EAGnD,EAAU,SAAS,EAAM,CAC9B,SAAU,EACV,SAAU,CAAC,GAAG,EAAe,SAAU,MAAM,CAC9C,CAAC,wBA1DiC,IACJ,CAE3B,EAAe,CAAC,QAAS,SAAS,CAClC,EAAgB,CACpB,WACA,WACA,OACA,QACA,UACA,SACD,CAKK,EACJ"}