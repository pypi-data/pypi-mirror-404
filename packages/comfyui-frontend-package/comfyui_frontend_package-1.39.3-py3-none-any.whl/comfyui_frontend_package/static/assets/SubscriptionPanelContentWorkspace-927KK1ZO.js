import{i as e,n as t}from"./rolldown-runtime-BKYq3fBv.js";import{$n as n,Cr as r,Gn as i,Nn as a,Or as ee,Q as te,Qn as o,Rr as s,Tr as ne,Xn as c,Xr as re,Z as ie,Zn as l,ai as u,ar as d,br as ae,er as f,gn as p,hn as m,ir as h,si as oe,sr as se,ui as g,vr as ce,zr as le}from"./vendor-primevue-Cg-HmKZY.js";import{ot as _,st as ue}from"./vendor-other-CoxDvJ0a.js";import{i as de,r as fe}from"./vendor-vue-J4jYbuLn.js";import{n as pe,t as v}from"./tailwindUtil-F1kyO01s.js";import{n as me,t as y}from"./Button-YQy7RkKq.js";import{Ao as he,Fo as ge,Io as _e,Lo as ve,Mo as ye,No as be,Ro as xe,c as Se,jo as b,ko as x,n as Ce,s as S,t as C,zo as w}from"./dialogService-DvYmp2_F.js";import{n as we,t as Te}from"./_plugin-vue_export-helper-Ckv1EJQX.js";import{n as Ee,t as De}from"./useWorkspaceUI-DgiliDDq.js";import{n as Oe,t as T}from"./useSubscriptionActions-C7hMido6.js";import{n as ke,t as E}from"./useSubscriptionCredits--htUCYXg.js";import{n as Ae,t as D}from"./useSubscriptionDialog-B-H7bxB0.js";var O,k,A,j,M,N,P,F,I,L,R,z,B,V,H,U,W,G,je,Me,Ne,Pe,Fe,Ie,Le,Re,ze,Be,Ve,He,Ue,We,Ge,Ke,qe,Je,Ye,Xe,Ze,K,Qe,q,J=t((()=>{a(),fe(),ie(),m(),_(),me(),x(),C(),b(),T(),E(),D(),w(),De(),S(),v(),O={class:`grow overflow-auto pt-6`},k={class:`rounded-2xl border border-interface-stroke p-6`},A={class:`flex flex-col gap-4 md:flex-row md:items-center md:justify-between md:gap-2`},j={class:`flex flex-col gap-2`},M={class:`text-sm font-bold text-text-primary`},N={class:`text-sm text-text-secondary`},P={key:1,class:`flex flex-col gap-2`},F={class:`text-sm font-bold text-text-primary`},I={class:`text-sm text-text-secondary`},L={class:`flex flex-col gap-2`},R={class:`text-sm font-bold text-text-primary`},z={class:`flex items-baseline gap-1 font-inter font-semibold`},B={class:`text-2xl`},V={class:`text-base`},H={key:0,class:`text-sm text-text-secondary`},U={key:0,class:`flex flex-wrap gap-2 md:ml-auto`},W={class:`flex flex-col lg:flex-row gap-6 pt-9`},G={class:`flex flex-col shrink-0`},je={class:`flex flex-col gap-3`},Me={class:`flex flex-col gap-2`},Ne={class:`text-sm text-muted`},Pe={key:1,class:`text-2xl font-bold`},Fe={class:`text-sm text-muted`},Ie={class:`pr-4 font-bold text-left align-middle`},Le={key:1},Re=[`title`],ze={class:`pr-4 font-bold text-left align-middle`},Be={key:1},Ve=[`title`],He={class:`flex items-center justify-between`},Ue={href:`https://platform.comfy.org/profile/usage`,target:`_blank`,rel:`noopener noreferrer`,class:`text-sm underline text-center text-muted`},We={class:`flex flex-col gap-2`},Ge={class:`text-sm text-text-primary`},Ke={class:`flex flex-col gap-0`},qe={key:0,class:`pi pi-check text-xs text-text-primary`},Je={key:1,class:`text-sm font-normal whitespace-nowrap text-text-primary`},Ye={class:`text-sm text-muted`},Xe={class:`flex items-center gap-2 py-4`},Ze={href:`https://www.comfy.org/cloud/pricing`,target:`_blank`,rel:`noopener noreferrer`,class:`text-sm underline hover:opacity-80 text-muted`},K=`pending_topup_timestamp`,Qe=300*1e3,q=se({__name:`SubscriptionPanelContentWorkspace`,setup(e){let t=he(),a=Se(),{isWorkspaceSubscribed:ie,isInPersonalWorkspace:m}=de(a),{subscribeWorkspace:se}=a,{permissions:_,workspaceRole:fe}=Ee(),{t:v,n:me}=ue(),{showBillingComingSoonDialog:b}=Ce(),x=c(()=>fe.value===`owner`?m.value?!w.value:!ie.value:!1),S=c(()=>!_.value.canManageSubscription),C=c(()=>x.value||S.value);function handleSubscribeWorkspace(){if(!m.value){b();return}se(`PRO_MONTHLY`)}let{isActiveSubscription:w,isCancelled:we,formattedRenewalDate:Te,formattedEndDate:De,subscriptionTier:T,subscriptionTierName:E,subscriptionStatus:D,isYearlySubscription:q}=ye(),{show:J}=Ae(),Y=re(null),X=c(()=>[{label:v(`subscription.cancelSubscription`),icon:`pi pi-times`,command:async()=>{await t.accessBillingPortal()}}]),Z=c(()=>{let e=T.value;return e?ge[e]??`standard`:be}),$e=c(()=>xe(Z.value,q.value)),et=c(()=>{if(!D.value?.renewal_date)return``;let e=new Date(D.value.renewal_date),t=String(e.getDate()).padStart(2,`0`);return`${String(e.getMonth()+1).padStart(2,`0`)}/${t}/${String(e.getFullYear()).slice(-2)}`}),tt=c(()=>q.value?v(`subscription.creditsRemainingThisYear`,{date:et.value}):v(`subscription.creditsRemainingThisMonth`,{date:et.value})),nt=c(()=>{let e=_e(Z.value);return me(q.value?e*12:e)}),rt=c(()=>`${ot.value} / ${nt.value}`),it=c(()=>{let e=Z.value,t=[{key:`maxDuration`,type:`metric`,value:v(`subscription.maxDuration.${e}`),label:v(`subscription.maxDurationLabel`)},{key:`gpu`,type:`feature`,label:v(`subscription.gpuLabel`)},{key:`addCredits`,type:`feature`,label:v(`subscription.addCreditsLabel`)}];return ve(e).customLoRAs&&t.push({key:`customLoRAs`,type:`feature`,label:v(`subscription.customLoRAsLabel`)}),t}),{totalCredits:at,monthlyBonusCredits:ot,prepaidCredits:st,isLoadingBalance:Q}=ke(),{handleAddApiCredits:ct,handleRefresh:$}=Oe();function handleWindowFocus(){let e=localStorage.getItem(K);if(!e)return;let t=parseInt(e,10);if(Date.now()-t>Qe){localStorage.removeItem(K);return}$(),localStorage.removeItem(K)}return ae(()=>{window.addEventListener(`focus`,handleWindowFocus)}),ce(()=>{window.removeEventListener(`focus`,handleWindowFocus)}),(e,a)=>{let c=ee(`tooltip`);return r(),f(`div`,O,[l(`div`,k,[l(`div`,null,[l(`div`,A,[x.value?(r(),f(i,{key:0},[l(`div`,j,[l(`div`,M,g(e.$t(`subscription.workspaceNotSubscribed`)),1),l(`div`,N,g(e.$t(`subscription.subscriptionRequiredMessage`)),1)]),d(y,{variant:`primary`,size:`lg`,class:`ml-auto rounded-lg px-4 py-2 text-sm font-normal`,onClick:handleSubscribeWorkspace},{default:s(()=>[h(g(e.$t(`subscription.subscribeNow`)),1)]),_:1})],64)):S.value?(r(),f(`div`,P,[l(`div`,F,g(e.$t(`subscription.workspaceNotSubscribed`)),1),l(`div`,I,g(e.$t(`subscription.contactOwnerToSubscribe`)),1)])):(r(),f(i,{key:2},[l(`div`,L,[l(`div`,R,g(u(E)),1),l(`div`,z,[l(`span`,B,`$`+g($e.value),1),l(`span`,V,g(e.$t(`subscription.perMonth`)),1)]),u(w)?(r(),f(`div`,H,[u(we)?(r(),f(i,{key:0},[h(g(e.$t(`subscription.expiresDate`,{date:u(De)})),1)],64)):(r(),f(i,{key:1},[h(g(e.$t(`subscription.renewsDate`,{date:u(Te)})),1)],64))])):n(``,!0)]),u(w)&&u(_).canManageSubscription?(r(),f(`div`,U,[d(y,{size:`lg`,variant:`secondary`,class:`rounded-lg px-4 text-sm font-normal text-text-primary bg-interface-menu-component-surface-selected`,onClick:a[0]||=async()=>{await u(t).accessBillingPortal()}},{default:s(()=>[h(g(e.$t(`subscription.managePayment`)),1)]),_:1}),d(y,{size:`lg`,variant:`primary`,class:`rounded-lg px-4 text-sm font-normal text-text-primary`,onClick:u(J)},{default:s(()=>[h(g(e.$t(`subscription.upgradePlan`)),1)]),_:1},8,[`onClick`]),le((r(),o(y,{variant:`secondary`,size:`lg`,"aria-label":e.$t(`g.moreOptions`),onClick:a[1]||=e=>Y.value?.toggle(e)},{default:s(()=>a[2]||=[l(`i`,{class:`pi pi-ellipsis-h`},null,-1)]),_:1},8,[`aria-label`])),[[c,{value:e.$t(`g.moreOptions`),showDelay:300}]]),d(u(te),{ref_key:`planMenu`,ref:Y,model:X.value,popup:!0},null,8,[`model`])])):n(``,!0)],64))])]),l(`div`,W,[l(`div`,G,[l(`div`,je,[l(`div`,{class:oe(u(pe)(`relative flex flex-col gap-6 rounded-2xl p-5`,`bg-modal-panel-background`))},[d(y,{variant:`muted-textonly`,size:`icon-sm`,class:`absolute top-4 right-4`,loading:u(Q),onClick:u($)},{default:s(()=>a[3]||=[l(`i`,{class:`pi pi-sync text-text-secondary text-sm`},null,-1)]),_:1},8,[`loading`,`onClick`]),l(`div`,Me,[l(`div`,Ne,g(e.$t(`subscription.totalCredits`)),1),u(Q)?(r(),o(u(p),{key:0,width:`8rem`,height:`2rem`})):(r(),f(`div`,Pe,g(C.value?`0`:u(at)),1))]),l(`table`,Fe,[l(`tbody`,null,[l(`tr`,null,[l(`td`,Ie,[u(Q)?(r(),o(u(p),{key:0,width:`5rem`,height:`1rem`})):(r(),f(`span`,Le,g(C.value?`0 / 0`:rt.value),1))]),l(`td`,{class:`align-middle`,title:tt.value},g(tt.value),9,Re)]),l(`tr`,null,[l(`td`,ze,[u(Q)?(r(),o(u(p),{key:0,width:`3rem`,height:`1rem`})):(r(),f(`span`,Be,g(C.value?`0`:u(st)),1))]),l(`td`,{class:`align-middle`,title:e.$t(`subscription.creditsYouveAdded`)},g(e.$t(`subscription.creditsYouveAdded`)),9,Ve)])])]),l(`div`,He,[l(`a`,Ue,g(e.$t(`subscription.viewUsageHistory`)),1),u(w)&&!C.value?(r(),o(y,{key:0,variant:`secondary`,class:`p-2 min-h-8 rounded-lg text-sm font-normal text-text-primary bg-interface-menu-component-surface-selected`,onClick:u(ct)},{default:s(()=>[h(g(e.$t(`subscription.addCredits`)),1)]),_:1},8,[`onClick`])):n(``,!0)])],2)])]),l(`div`,We,[l(`div`,Ge,g(e.$t(`subscription.yourPlanIncludes`)),1),l(`div`,Ke,[(r(!0),f(i,null,ne(it.value,e=>(r(),f(`div`,{key:e.key,class:`flex items-center gap-2 py-2`},[e.type===`feature`?(r(),f(`i`,qe)):e.type===`metric`&&e.value?(r(),f(`span`,Je,g(e.value),1)):n(``,!0),l(`span`,Ye,g(e.label),1)]))),128))])])])]),l(`div`,Xe,[a[4]||=l(`i`,{class:`pi pi-external-link text-muted`},null,-1),l(`a`,Ze,g(e.$t(`subscription.viewMoreDetailsPlans`)),1)])])}}})})),Y=t((()=>{})),X,Z=t((()=>{J(),J(),Y(),we(),X=Te(q,[[`__scopeId`,`data-v-c54a1f88`]])}));export{Z as n,X as t};
//# sourceMappingURL=SubscriptionPanelContentWorkspace-927KK1ZO.js.map