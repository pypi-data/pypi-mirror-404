import{i as e,n as t}from"./rolldown-runtime-BKYq3fBv.js";import{$n as n,Bn as r,Cr as i,Fr as a,Jr as o,Mr as s,Nn as c,Qn as l,Xn as u,Xr as d,Zn as f,ai as p,er as m,gn as h,hn as g,li as _,mr as v,ri as y,si as b,sr as x,ti as S,vr as C,xr as w,zr as T}from"./vendor-primevue-Cg-HmKZY.js";import{Kn as E,fn as D}from"./vendor-other-CoxDvJ0a.js";import{n as O,t as k}from"./tailwindUtil-F1kyO01s.js";var A,j,M,N=t((()=>{c(),D(),k(),A=[`placeholder`,`autofocus`],j=[`aria-label`],M=x({__name:`FormSearchInput`,props:v({searcher:{type:Function,default:async()=>{}},updateKey:{},autofocus:{type:Boolean,default:!1},class:{}},{modelValue:{default:``},modelModifiers:{}}),emits:[`update:modelValue`],setup(e){let t=s(e,`modelValue`),o=d(!1),c=E(t,250,{maxWait:1e3});a(t,e=>{o.value=e!==c.value}),a([c,S(()=>y(e.updateKey))],(t,n,r)=>{let i=!1,a;r(()=>{i=!0,a?.()}),e.searcher(c.value,e=>a=e).catch(e=>{console.error(`[SidePanelSearch] searcher failed`,e)}).finally(()=>{i||(o.value=!1)})},{immediate:!0});function handleFocus(e){e.target.select()}return(a,s)=>(i(),m(`label`,{class:b(p(O)(`group`,`bg-component-node-widget-background rounded-lg transition-all duration-150`,`flex-1 flex items-center`,`text-base-foreground border-0`,`focus-within:ring focus-within:ring-component-node-widget-background-highlighted/80`,e.class))},[f(`i`,{class:b(p(O)(`size-4 ml-2 shrink-0 transition-colors duration-150`,o.value?`icon-[lucide--loader-circle] animate-spin`:`icon-[lucide--search]`,t.value?.trim()===``?`text-muted-foreground group-hover:text-base-foreground group-focus-within:text-base-foreground`:`text-base-foreground`))},null,2),T(f(`input`,{"onUpdate:modelValue":s[0]||=e=>t.value=e,type:`text`,class:`bg-transparent border-0 outline-0 ring-0 h-5 w-full my-1.5 mx-2`,placeholder:a.$t(`g.searchPlaceholder`),autofocus:a.autofocus,onFocus:handleFocus},null,40,A),[[r,t.value]]),t.value.trim().length>0?(i(),m(`button`,{key:0,class:`text-muted-foreground hover:text-base-foreground bg-transparent shrink-0 border-0 outline-0 ring-0 p-0 m-0 pr-3 pl-1 flex items-center justify-center transition-all duration-150 hover:scale-108`,"aria-label":a.$t(`g.clear`),onClick:s[1]||=e=>t.value=``},[f(`i`,{class:b(p(O)(`icon-[lucide--delete] size-4 cursor-pointer`))},null,2)],8,j)):n(``,!0)],2))}})})),P,F=t((()=>{N(),N(),P=M})),I,L=t((()=>{I=``+new URL(`images/default-template.png`,import.meta.url).href}));function useIntersectionObserver(e,t,n={}){let{immediate:r=!0,...i}=n,o=typeof window<`u`&&`IntersectionObserver`in window,s=d(!1),c=null,cleanup=()=>{c&&=(c.disconnect(),null)},observe=()=>{cleanup(),!(!o||!e.value)&&(c=new IntersectionObserver(e=>{s.value=e.some(e=>e.isIntersecting),t(e,c)},i),c.observe(e.value))},unobserve=()=>{c&&e.value&&c.unobserve(e.value)};return r&&a(e,observe,{immediate:!0,flush:`post`}),C(cleanup),{isSupported:o,isIntersecting:s,observe,unobserve,cleanup}}var R=t((()=>{c()}));function useMediaCache(e){z||=new MediaCacheService(e);let getCachedMedia=e=>z.getCachedMedia(e),clearCache=()=>z.clearCache(),acquireUrl=e=>z.acquireUrl(e),releaseUrl=e=>z.releaseUrl(e);return{getCachedMedia,clearCache,acquireUrl,releaseUrl,cache:z.cache}}var MediaCacheService,z,B=t((()=>{c(),MediaCacheService=class{cache=o(new Map);maxSize;maxAge;cleanupInterval=null;urlRefCount=new Map;constructor(e={}){this.maxSize=e.maxSize??100,this.maxAge=e.maxAge??1800*1e3,this.startCleanupInterval()}startCleanupInterval(){this.cleanupInterval=window.setInterval(()=>{this.cleanup()},300*1e3)}cleanup(){let e=Date.now(),t=[];for(let[n,r]of Array.from(this.cache.entries()))e-r.lastAccessed>this.maxAge&&(r.objectUrl?(this.urlRefCount.get(r.objectUrl)||0)===0&&(URL.revokeObjectURL(r.objectUrl),this.urlRefCount.delete(r.objectUrl),t.push(n)):t.push(n));if(t.forEach(e=>this.cache.delete(e)),this.cache.size>this.maxSize){let e=Array.from(this.cache.entries());e.sort((e,t)=>e[1].lastAccessed-t[1].lastAccessed);let t=0,n=this.cache.size-this.maxSize;for(let[r,i]of e){if(t>=n)break;i.objectUrl?(this.urlRefCount.get(i.objectUrl)||0)===0&&(URL.revokeObjectURL(i.objectUrl),this.urlRefCount.delete(i.objectUrl),this.cache.delete(r),t++):(this.cache.delete(r),t++)}}}async getCachedMedia(e){let t=this.cache.get(e);if(t)return t.lastAccessed=Date.now(),t;t={src:e,isLoading:!0,lastAccessed:Date.now()},this.cache.set(e,t);try{let t=await fetch(e,{cache:`force-cache`});if(!t.ok)throw Error(`Failed to fetch: ${t.status}`);let n=await t.blob(),r={src:e,blob:n,objectUrl:URL.createObjectURL(n),isLoading:!1,lastAccessed:Date.now()};return this.cache.set(e,r),r}catch(t){console.warn(`Failed to cache media:`,e,t);let n={src:e,error:!0,isLoading:!1,lastAccessed:Date.now()};return this.cache.set(e,n),n}}acquireUrl(e){let t=this.cache.get(e);if(t?.objectUrl){let e=this.urlRefCount.get(t.objectUrl)||0;return this.urlRefCount.set(t.objectUrl,e+1),t.objectUrl}}releaseUrl(e){let t=this.cache.get(e);if(t?.objectUrl){let n=(this.urlRefCount.get(t.objectUrl)||1)-1;n<=0?(URL.revokeObjectURL(t.objectUrl),this.urlRefCount.delete(t.objectUrl),this.cache.delete(e)):this.urlRefCount.set(t.objectUrl,n)}}clearCache(){for(let e of Array.from(this.cache.values()))e.objectUrl&&URL.revokeObjectURL(e.objectUrl);this.cache.clear(),this.urlRefCount.clear()}destroy(){this.cleanupInterval&&=(clearInterval(this.cleanupInterval),null),this.clearCache()}},z=null,typeof window<`u`&&window.addEventListener(`beforeunload`,()=>{z&&z.destroy()})})),V,H,U,W,G=t((()=>{c(),L(),g(),R(),B(),V=[`src`,`alt`],H={key:2,class:`absolute inset-0 flex items-center justify-center`},U=[`alt`],W=x({__name:`LazyImage`,props:{src:{},alt:{default:``},containerClass:{type:[Array,Object,String,Number,null,Boolean],default:``},imageClass:{type:[Array,Object,String,Number,null,Boolean],default:``},imageStyle:{},rootMargin:{default:`300px`}},setup(e){let t=d(null),r=d(!1),o=d(!1),s=d(!1),c=d(void 0),{getCachedMedia:g,acquireUrl:v,releaseUrl:y}=useMediaCache();useIntersectionObserver(t,e=>{r.value=e[0]?.isIntersecting??!1},{rootMargin:e.rootMargin,threshold:.1}),a(u(()=>r.value),async t=>{if(t&&e.src&&!c.value&&!s.value)try{let t=await g(e.src);t.error?s.value=!0:t.objectUrl?c.value=v(e.src)||t.objectUrl:c.value=e.src}catch(t){console.warn(`Failed to load cached media:`,t),c.value=e.src}else t||(c.value?.startsWith(`blob:`)&&y(e.src),o.value=!1,c.value=void 0,s.value=!1)},{immediate:!0});let onImageLoad=()=>{o.value=!0,s.value=!1},onImageError=()=>{s.value=!0,o.value=!1};return w(()=>{c.value?.startsWith(`blob:`)&&y(e.src)}),(e,r)=>(i(),m(`div`,{ref_key:`containerRef`,ref:t,class:b([`relative flex h-full w-full items-center justify-center overflow-hidden`,e.containerClass])},[o.value?n(``,!0):(i(),l(p(h),{key:0,width:`100%`,height:`100%`,class:`absolute inset-0`})),c.value?(i(),m(`img`,{key:1,src:c.value,alt:e.alt,draggable:`false`,class:b(e.imageClass),style:_(e.imageStyle),onLoad:onImageLoad,onError:onImageError},null,46,V)):n(``,!0),s.value?(i(),m(`div`,H,[f(`img`,{src:I,alt:e.alt,draggable:`false`,class:b(e.imageClass),style:_(e.imageStyle)},null,14,U)])):n(``,!0)],2))}})})),K,q=t((()=>{G(),G(),K=W}));export{I as a,F as c,useIntersectionObserver as i,q as n,L as o,R as r,P as s,K as t};
//# sourceMappingURL=LazyImage-BcC2lrC2.js.map