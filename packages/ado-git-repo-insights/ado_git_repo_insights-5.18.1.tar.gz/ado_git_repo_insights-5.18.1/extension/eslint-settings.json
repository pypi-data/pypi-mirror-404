[
  {
    "filePath": "E:\\projects\\ado-git-repo-insights\\extension\\ui\\settings.ts",
    "messages": [
      {
        "ruleId": "@typescript-eslint/no-explicit-any",
        "severity": 1,
        "message": "Unexpected any. Specify a different type.",
        "line": 104,
        "column": 47,
        "nodeType": "TSAnyKeyword",
        "messageId": "unexpectedAny",
        "endLine": 104,
        "endColumn": 50,
        "suggestions": [
          {
            "messageId": "suggestUnknown",
            "fix": { "range": [2900, 2903], "text": "unknown" },
            "desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
          },
          {
            "messageId": "suggestNever",
            "fix": { "range": [2900, 2903], "text": "never" },
            "desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
          }
        ]
      },
      {
        "ruleId": "@typescript-eslint/no-explicit-any",
        "severity": 1,
        "message": "Unexpected any. Specify a different type.",
        "line": 104,
        "column": 55,
        "nodeType": "TSAnyKeyword",
        "messageId": "unexpectedAny",
        "endLine": 104,
        "endColumn": 58,
        "suggestions": [
          {
            "messageId": "suggestUnknown",
            "fix": { "range": [2908, 2911], "text": "unknown" },
            "desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
          },
          {
            "messageId": "suggestNever",
            "fix": { "range": [2908, 2911], "text": "never" },
            "desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
          }
        ]
      },
      {
        "ruleId": "@typescript-eslint/no-explicit-any",
        "severity": 1,
        "message": "Unexpected any. Specify a different type.",
        "line": 138,
        "column": 51,
        "nodeType": "TSAnyKeyword",
        "messageId": "unexpectedAny",
        "endLine": 138,
        "endColumn": 54,
        "suggestions": [
          {
            "messageId": "suggestUnknown",
            "fix": { "range": [3878, 3881], "text": "unknown" },
            "desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
          },
          {
            "messageId": "suggestNever",
            "fix": { "range": [3878, 3881], "text": "never" },
            "desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
          }
        ]
      },
      {
        "ruleId": "@typescript-eslint/no-explicit-any",
        "severity": 1,
        "message": "Unexpected any. Specify a different type.",
        "line": 140,
        "column": 59,
        "nodeType": "TSAnyKeyword",
        "messageId": "unexpectedAny",
        "endLine": 140,
        "endColumn": 62,
        "suggestions": [
          {
            "messageId": "suggestUnknown",
            "fix": { "range": [3989, 3992], "text": "unknown" },
            "desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
          },
          {
            "messageId": "suggestNever",
            "fix": { "range": [3989, 3992], "text": "never" },
            "desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
          }
        ]
      },
      {
        "ruleId": "@typescript-eslint/no-explicit-any",
        "severity": 1,
        "message": "Unexpected any. Specify a different type.",
        "line": 145,
        "column": 28,
        "nodeType": "TSAnyKeyword",
        "messageId": "unexpectedAny",
        "endLine": 145,
        "endColumn": 31,
        "suggestions": [
          {
            "messageId": "suggestUnknown",
            "fix": { "range": [4129, 4132], "text": "unknown" },
            "desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
          },
          {
            "messageId": "suggestNever",
            "fix": { "range": [4129, 4132], "text": "never" },
            "desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
          }
        ]
      },
      {
        "ruleId": "@typescript-eslint/no-explicit-any",
        "severity": 1,
        "message": "Unexpected any. Specify a different type.",
        "line": 148,
        "column": 26,
        "nodeType": "TSAnyKeyword",
        "messageId": "unexpectedAny",
        "endLine": 148,
        "endColumn": 29,
        "suggestions": [
          {
            "messageId": "suggestUnknown",
            "fix": { "range": [4216, 4219], "text": "unknown" },
            "desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
          },
          {
            "messageId": "suggestNever",
            "fix": { "range": [4216, 4219], "text": "never" },
            "desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
          }
        ]
      },
      {
        "ruleId": "@typescript-eslint/no-explicit-any",
        "severity": 1,
        "message": "Unexpected any. Specify a different type.",
        "line": 400,
        "column": 61,
        "nodeType": "TSAnyKeyword",
        "messageId": "unexpectedAny",
        "endLine": 400,
        "endColumn": 64,
        "suggestions": [
          {
            "messageId": "suggestUnknown",
            "fix": { "range": [11842, 11845], "text": "unknown" },
            "desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
          },
          {
            "messageId": "suggestNever",
            "fix": { "range": [11842, 11845], "text": "never" },
            "desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
          }
        ]
      },
      {
        "ruleId": "@typescript-eslint/no-explicit-any",
        "severity": 1,
        "message": "Unexpected any. Specify a different type.",
        "line": 417,
        "column": 31,
        "nodeType": "TSAnyKeyword",
        "messageId": "unexpectedAny",
        "endLine": 417,
        "endColumn": 34,
        "suggestions": [
          {
            "messageId": "suggestUnknown",
            "fix": { "range": [12259, 12262], "text": "unknown" },
            "desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
          },
          {
            "messageId": "suggestNever",
            "fix": { "range": [12259, 12262], "text": "never" },
            "desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
          }
        ]
      },
      {
        "ruleId": "@typescript-eslint/no-explicit-any",
        "severity": 1,
        "message": "Unexpected any. Specify a different type.",
        "line": 446,
        "column": 30,
        "nodeType": "TSAnyKeyword",
        "messageId": "unexpectedAny",
        "endLine": 446,
        "endColumn": 33,
        "suggestions": [
          {
            "messageId": "suggestUnknown",
            "fix": { "range": [13088, 13091], "text": "unknown" },
            "desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
          },
          {
            "messageId": "suggestNever",
            "fix": { "range": [13088, 13091], "text": "never" },
            "desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
          }
        ]
      },
      {
        "ruleId": "@typescript-eslint/no-explicit-any",
        "severity": 1,
        "message": "Unexpected any. Specify a different type.",
        "line": 489,
        "column": 61,
        "nodeType": "TSAnyKeyword",
        "messageId": "unexpectedAny",
        "endLine": 489,
        "endColumn": 64,
        "suggestions": [
          {
            "messageId": "suggestUnknown",
            "fix": { "range": [14375, 14378], "text": "unknown" },
            "desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
          },
          {
            "messageId": "suggestNever",
            "fix": { "range": [14375, 14378], "text": "never" },
            "desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
          }
        ]
      },
      {
        "ruleId": "@typescript-eslint/no-explicit-any",
        "severity": 1,
        "message": "Unexpected any. Specify a different type.",
        "line": 498,
        "column": 24,
        "nodeType": "TSAnyKeyword",
        "messageId": "unexpectedAny",
        "endLine": 498,
        "endColumn": 27,
        "suggestions": [
          {
            "messageId": "suggestUnknown",
            "fix": { "range": [14647, 14650], "text": "unknown" },
            "desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
          },
          {
            "messageId": "suggestNever",
            "fix": { "range": [14647, 14650], "text": "never" },
            "desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
          }
        ]
      },
      {
        "ruleId": "@typescript-eslint/no-explicit-any",
        "severity": 1,
        "message": "Unexpected any. Specify a different type.",
        "line": 503,
        "column": 37,
        "nodeType": "TSAnyKeyword",
        "messageId": "unexpectedAny",
        "endLine": 503,
        "endColumn": 40,
        "suggestions": [
          {
            "messageId": "suggestUnknown",
            "fix": { "range": [14833, 14836], "text": "unknown" },
            "desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
          },
          {
            "messageId": "suggestNever",
            "fix": { "range": [14833, 14836], "text": "never" },
            "desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
          }
        ]
      },
      {
        "ruleId": "@typescript-eslint/no-explicit-any",
        "severity": 1,
        "message": "Unexpected any. Specify a different type.",
        "line": 532,
        "column": 41,
        "nodeType": "TSAnyKeyword",
        "messageId": "unexpectedAny",
        "endLine": 532,
        "endColumn": 44,
        "suggestions": [
          {
            "messageId": "suggestUnknown",
            "fix": { "range": [15705, 15708], "text": "unknown" },
            "desc": "Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."
          },
          {
            "messageId": "suggestNever",
            "fix": { "range": [15705, 15708], "text": "never" },
            "desc": "Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."
          }
        ]
      },
      {
        "ruleId": "@typescript-eslint/no-floating-promises",
        "severity": 1,
        "message": "Promises must be awaited, end with a call to .catch, end with a call to .then with a rejection handler or be explicitly marked as ignored with the `void` operator.",
        "line": 661,
        "column": 9,
        "nodeType": "ExpressionStatement",
        "messageId": "floatingVoid",
        "endLine": 661,
        "endColumn": 24,
        "suggestions": [
          {
            "messageId": "floatingFixVoid",
            "fix": { "range": [19593, 19593], "text": "void " },
            "desc": "Add void operator to ignore."
          },
          {
            "messageId": "floatingFixAwait",
            "fix": { "range": [19593, 19593], "text": "await " },
            "desc": "Add await operator."
          }
        ]
      },
      {
        "ruleId": "@typescript-eslint/no-floating-promises",
        "severity": 1,
        "message": "Promises must be awaited, end with a call to .catch, end with a call to .then with a rejection handler or be explicitly marked as ignored with the `void` operator.",
        "line": 668,
        "column": 9,
        "nodeType": "ExpressionStatement",
        "messageId": "floatingVoid",
        "endLine": 668,
        "endColumn": 24,
        "suggestions": [
          {
            "messageId": "floatingFixVoid",
            "fix": { "range": [19768, 19768], "text": "void " },
            "desc": "Add void operator to ignore."
          },
          {
            "messageId": "floatingFixAwait",
            "fix": { "range": [19768, 19768], "text": "await " },
            "desc": "Add await operator."
          }
        ]
      },
      {
        "ruleId": "@typescript-eslint/no-floating-promises",
        "severity": 1,
        "message": "Promises must be awaited, end with a call to .catch, end with a call to .then with a rejection handler or be explicitly marked as ignored with the `void` operator.",
        "line": 677,
        "column": 3,
        "nodeType": "ExpressionStatement",
        "messageId": "floatingVoid",
        "endLine": 677,
        "endColumn": 10,
        "suggestions": [
          {
            "messageId": "floatingFixVoid",
            "fix": { "range": [19932, 19932], "text": "void " },
            "desc": "Add void operator to ignore."
          },
          {
            "messageId": "floatingFixAwait",
            "fix": { "range": [19932, 19932], "text": "await " },
            "desc": "Add await operator."
          }
        ]
      }
    ],
    "suppressedMessages": [],
    "errorCount": 0,
    "fatalErrorCount": 0,
    "warningCount": 16,
    "fixableErrorCount": 0,
    "fixableWarningCount": 0,
    "source": "/**\n * PR Insights Settings Page\n *\n * Allows users to configure:\n * - Source project (for cross-project access)\n * - Pipeline definition ID\n *\n * Settings are user-scoped (not project-scoped) for privacy.\n *\n * Project selection uses graceful degradation:\n * - Shows dropdown when vso.project scope allows listing projects\n * - Falls back to text input when listing isn't available\n */\n\nimport { getErrorMessage, type VSSProject } from \"./types\";\n\n// Settings keys (must match dashboard.js)\nconst SETTINGS_KEY_PROJECT = \"pr-insights-source-project\";\nconst SETTINGS_KEY_PIPELINE = \"pr-insights-pipeline-id\";\n\n// State\nlet dataService: IExtensionDataService | null = null;\nlet projectDropdownAvailable = false;\nlet projectList: VSSProject[] = [];\n\n/**\n * Initialize Azure DevOps Extension SDK.\n */\nasync function initializeAdoSdk(): Promise<void> {\n  return new Promise((resolve, reject) => {\n    const timeout = setTimeout(() => {\n      reject(new Error(\"Azure DevOps SDK initialization timed out\"));\n    }, 10000);\n\n    VSS.init({\n      explicitNotifyLoaded: true,\n      usePlatformScripts: true,\n      usePlatformStyles: true,\n    });\n\n    VSS.ready(() => {\n      clearTimeout(timeout);\n      VSS.notifyLoadSucceeded();\n      resolve();\n    });\n  });\n}\n\n/**\n * Initialize the settings page.\n */\nasync function init(): Promise<void> {\n  try {\n    await initializeAdoSdk();\n\n    // Get extension data service\n    dataService = await VSS.getService(VSS.ServiceIds.ExtensionData);\n\n    // Set current project as placeholder\n    const webContext = VSS.getWebContext();\n    const projectInput = document.getElementById(\n      \"project-id\",\n    ) as HTMLInputElement | null;\n    if (projectInput && webContext?.project?.name) {\n      projectInput.placeholder = `Current: ${webContext.project.name}`;\n    }\n\n    // Try to load project dropdown\n    await tryLoadProjectDropdown();\n\n    // Load saved settings\n    await loadSettings();\n\n    // Update status display\n    await updateStatus();\n\n    // Set up event listeners\n    setupEventListeners();\n  } catch (error: unknown) {\n    console.error(\"Settings initialization failed:\", error);\n    showStatus(\"Failed to initialize settings: \" + getErrorMessage(error), \"error\");\n  }\n}\n\n/**\n * Try to load project dropdown. Degrades gracefully to text input.\n */\nasync function tryLoadProjectDropdown(): Promise<void> {\n  const dropdown = document.getElementById(\n    \"project-select\",\n  ) as HTMLSelectElement;\n  const textInput = document.getElementById(\"project-id\") as HTMLInputElement;\n\n  try {\n    // Get projects using Core REST client\n    const projects = await getOrganizationProjects();\n\n    if (projects && projects.length > 0) {\n      projectList = projects;\n      projectDropdownAvailable = true;\n\n      // Populate dropdown\n      dropdown.innerHTML = '<option value=\"\">Current project (auto)</option>';\n      for (const project of projects.sort((a: any, b: any) =>\n        a.name.localeCompare(b.name),\n      )) {\n        const option = document.createElement(\"option\");\n        option.value = project.id;\n        option.textContent = `${project.name} (${project.id.substring(0, 8)}...)`;\n        dropdown.appendChild(option);\n      }\n\n      // Show dropdown, hide text input\n      dropdown.style.display = \"block\";\n      textInput.style.display = \"none\";\n\n      console.log(`Loaded ${projects.length} projects for dropdown`);\n    } else {\n      throw new Error(\"No projects returned\");\n    }\n  } catch (error: unknown) {\n    console.log(\n      \"Project dropdown unavailable, using text input:\",\n      getErrorMessage(error),\n    );\n    projectDropdownAvailable = false;\n\n    // Show text input, hide dropdown\n    dropdown.style.display = \"none\";\n    textInput.style.display = \"block\";\n  }\n}\n\n/**\n * Get list of projects in the organization.\n * Requires vso.project scope.\n */\nasync function getOrganizationProjects(): Promise<any[]> {\n  return new Promise((resolve, reject) => {\n    VSS.require([\"TFS/Core/RestClient\"], (CoreRestClient: any) => {\n      try {\n        const client = CoreRestClient.getClient();\n        client\n          .getProjects()\n          .then((projects: any[]) => {\n            resolve(projects || []);\n          })\n          .catch((error: any) => {\n            reject(error);\n          });\n      } catch (error) {\n        reject(error);\n      }\n    });\n  });\n}\n\n/**\n * Load saved settings into form.\n */\nasync function loadSettings(): Promise<void> {\n  if (!dataService) return;\n\n  try {\n    const savedProjectId = await dataService.getValue<string>(\n      SETTINGS_KEY_PROJECT,\n      { scopeType: \"User\" },\n    );\n    const savedPipelineId = await dataService.getValue<number>(\n      SETTINGS_KEY_PIPELINE,\n      { scopeType: \"User\" },\n    );\n\n    // Set project\n    if (savedProjectId) {\n      if (projectDropdownAvailable) {\n        const dropdown = document.getElementById(\n          \"project-select\",\n        ) as HTMLSelectElement;\n        if (dropdown) dropdown.value = savedProjectId;\n      } else {\n        const textInput = document.getElementById(\n          \"project-id\",\n        ) as HTMLInputElement;\n        if (textInput) textInput.value = savedProjectId;\n      }\n    }\n\n    // Set pipeline ID\n    const pipelineInput = document.getElementById(\n      \"pipeline-id\",\n    ) as HTMLInputElement;\n    if (pipelineInput && savedPipelineId) {\n      pipelineInput.value = savedPipelineId.toString();\n    }\n  } catch (error) {\n    console.log(\"No saved settings found:\", error);\n  }\n}\n\n/**\n * Get the selected project ID from either dropdown or text input.\n */\nfunction getSelectedProjectId(): string | null {\n  if (projectDropdownAvailable) {\n    const dropdown = document.getElementById(\n      \"project-select\",\n    ) as HTMLSelectElement;\n    return dropdown.value || null;\n  } else {\n    const textInput = document.getElementById(\"project-id\") as HTMLInputElement;\n    const value = textInput.value.trim();\n    return value || null;\n  }\n}\n\n/**\n * Save settings from form.\n */\nasync function saveSettings(): Promise<void> {\n  if (!dataService) return;\n\n  const projectId = getSelectedProjectId();\n  const pipelineInput = document.getElementById(\n    \"pipeline-id\",\n  ) as HTMLInputElement | null;\n  const pipelineValue = pipelineInput?.value?.trim();\n\n  try {\n    // Save project ID\n    await dataService.setValue(SETTINGS_KEY_PROJECT, projectId, {\n      scopeType: \"User\",\n    });\n\n    // Save pipeline ID\n    if (pipelineValue) {\n      const pipelineId = parseInt(pipelineValue, 10);\n      if (isNaN(pipelineId) || pipelineId <= 0) {\n        showStatus(\"Pipeline ID must be a positive integer\", \"error\");\n        return;\n      }\n      await dataService.setValue(SETTINGS_KEY_PIPELINE, pipelineId, {\n        scopeType: \"User\",\n      });\n    } else {\n      await dataService.setValue(SETTINGS_KEY_PIPELINE, null, {\n        scopeType: \"User\",\n      });\n    }\n\n    showStatus(\"Settings saved successfully\", \"success\");\n\n    // Update status display\n    await updateStatus();\n  } catch (error: unknown) {\n    console.error(\"Failed to save settings:\", error);\n    showStatus(\"Failed to save settings: \" + getErrorMessage(error), \"error\");\n  }\n}\n\n/**\n * Clear settings.\n */\nasync function clearSettings(): Promise<void> {\n  if (!dataService) return;\n\n  // Clear form\n  if (projectDropdownAvailable) {\n    const dropdown = document.getElementById(\n      \"project-select\",\n    ) as HTMLSelectElement;\n    if (dropdown) dropdown.value = \"\";\n  } else {\n    const textInput = document.getElementById(\"project-id\") as HTMLInputElement;\n    if (textInput) textInput.value = \"\";\n  }\n  const pipelineInput = document.getElementById(\n    \"pipeline-id\",\n  ) as HTMLInputElement;\n  if (pipelineInput) pipelineInput.value = \"\";\n\n  try {\n    await dataService.setValue(SETTINGS_KEY_PROJECT, null, {\n      scopeType: \"User\",\n    });\n    await dataService.setValue(SETTINGS_KEY_PIPELINE, null, {\n      scopeType: \"User\",\n    });\n    showStatus(\n      \"Settings cleared - using current project with auto-discovery\",\n      \"success\",\n    );\n    await updateStatus();\n  } catch (error: unknown) {\n    console.error(\"Failed to clear settings:\", error);\n    showStatus(\"Failed to clear settings: \" + getErrorMessage(error), \"error\");\n  }\n}\n\n/**\n * Update the status display with current configuration.\n */\nasync function updateStatus(): Promise<void> {\n  if (!dataService) return;\n\n  const statusDisplay = document.getElementById(\"status-display\");\n  if (!statusDisplay) return;\n\n  try {\n    const savedProjectId = await dataService.getValue<string>(\n      SETTINGS_KEY_PROJECT,\n      { scopeType: \"User\" },\n    );\n    const savedPipelineId = await dataService.getValue<number>(\n      SETTINGS_KEY_PIPELINE,\n      { scopeType: \"User\" },\n    );\n    const webContext = VSS.getWebContext();\n    const currentProjectName = webContext?.project?.name || \"Unknown\";\n    const currentProjectId = webContext?.project?.id;\n\n    let html = \"\";\n\n    // Current context\n    html += `<p><strong>Current Project:</strong> ${escapeHtml(currentProjectName)}</p>`;\n\n    // Source project configuration\n    if (savedProjectId) {\n      const projectName = getProjectNameById(savedProjectId);\n      html += `<p><strong>Source Project:</strong> ${escapeHtml(projectName)} <code>${savedProjectId.substring(0, 8)}...</code></p>`;\n    } else {\n      html += `<p><strong>Source Project:</strong> <em>Same as current</em></p>`;\n    }\n\n    // Pipeline configuration with validation\n    if (savedPipelineId) {\n      html += `<p><strong>Pipeline Definition ID:</strong> ${savedPipelineId}`;\n\n      // Validate the saved pipeline\n      const targetProjectId = savedProjectId || currentProjectId;\n      if (targetProjectId) {\n        const validation = await validatePipeline(\n          savedPipelineId,\n          targetProjectId,\n        );\n\n        if (validation.valid) {\n          html += ` <span class=\"status-valid\">Γ£ô Valid</span>`;\n          html += `</p>`;\n          html += `<p class=\"status-hint\">Pipeline: \"${escapeHtml(validation.name || \"\")}\" (Build #${validation.buildId})</p>`;\n        } else {\n          html += ` <span class=\"status-invalid\">ΓÜá∩╕Å Invalid</span>`;\n          html += `</p>`;\n          html += `<p class=\"status-warning\">ΓÜá∩╕Å ${escapeHtml(validation.error || \"\")}</p>`;\n          html += `<p class=\"status-hint\">The dashboard will automatically clear this setting and re-discover pipelines. Consider clearing manually to configure a different pipeline.</p>`;\n        }\n      } else {\n        html += `</p><p class=\"status-warning\">ΓÜá∩╕Å No project ID available for validation</p>`;\n      }\n    } else {\n      html += `<p><strong>Mode:</strong> Auto-discovery</p>`;\n      html += `<p class=\"status-hint\">The dashboard will automatically find pipelines with an \"aggregates\" artifact.</p>`;\n    }\n\n    // Dropdown availability\n    if (projectDropdownAvailable) {\n      html += `<p class=\"status-hint\">Γ£ô Project dropdown available (${projectList.length} projects)</p>`;\n    } else {\n      html += `<p class=\"status-hint\">Project dropdown not available - using text input</p>`;\n    }\n\n    statusDisplay.innerHTML = html;\n  } catch (error: unknown) {\n    statusDisplay.innerHTML = `<p class=\"status-error\">Failed to load status: ${escapeHtml(getErrorMessage(error))}</p>`;\n  }\n}\n\n/**\n * Get project name by ID from the cached list.\n */\nfunction getProjectNameById(projectId: string): string {\n  const project = projectList.find((p) => p.id === projectId);\n  return project?.name || projectId;\n}\n\n/**\n * Validate if a pipeline exists and has successful builds with aggregates artifact.\n * Returns validation result with details.\n */\nasync function validatePipeline(\n  pipelineId: number,\n  projectId: string,\n): Promise<{\n  valid: boolean;\n  name?: string;\n  buildId?: number;\n  error?: string;\n}> {\n  return new Promise((resolve) => {\n    VSS.require([\"TFS/Build/RestClient\"], (BuildRestClient: any) => {\n      try {\n        const client = BuildRestClient.getClient();\n\n        // Check if pipeline definition exists\n        client\n          .getDefinitions(\n            projectId,\n            null,\n            null,\n            null,\n            2, // queryOrder: definitionNameAscending\n            null,\n            null,\n            null,\n            [pipelineId],\n          )\n          .then((definitions: any[]) => {\n            if (!definitions || definitions.length === 0) {\n              resolve({\n                valid: false,\n                error: \"Pipeline definition not found (may have been deleted)\",\n              });\n              return;\n            }\n\n            const pipelineName = definitions[0].name;\n\n            // Check for successful/partially-succeeded builds\n            // resultFilter: 6 = Succeeded(2) | PartiallySucceeded(4)\n            client\n              .getBuilds(\n                projectId,\n                [pipelineId],\n                null,\n                null,\n                null,\n                null,\n                null,\n                null,\n                2,\n                6,\n                null,\n                null,\n                1,\n              )\n              .then((builds: any[]) => {\n                if (!builds || builds.length === 0) {\n                  resolve({\n                    valid: false,\n                    name: pipelineName,\n                    error: \"No successful builds found\",\n                  });\n                  return;\n                }\n\n                resolve({\n                  valid: true,\n                  name: pipelineName,\n                  buildId: builds[0].id,\n                });\n              })\n              .catch((e: unknown) => {\n                resolve({\n                  valid: false,\n                  error: `Build check failed: ${getErrorMessage(e)}`,\n                });\n              });\n          })\n          .catch((e: unknown) => {\n            resolve({\n              valid: false,\n              error: `Definition fetch failed: ${getErrorMessage(e)}`,\n            });\n          });\n      } catch (e: unknown) {\n        resolve({ valid: false, error: `Validation error: ${getErrorMessage(e)}` });\n      }\n    });\n  });\n}\n\n/**\n * Discover pipelines with aggregates artifact in the current project.\n */\nasync function discoverPipelines(): Promise<\n  Array<{ id: number; name: string; buildId: number }>\n> {\n  return new Promise((resolve) => {\n    VSS.require([\"TFS/Build/RestClient\"], (BuildRestClient: any) => {\n      try {\n        const client = BuildRestClient.getClient();\n        const webContext = VSS.getWebContext();\n        const projectId = webContext.project?.id;\n        if (!projectId) {\n          resolve([]);\n          return;\n        }\n        const matches: any[] = [];\n\n        // Get pipeline definitions (limit for performance)\n        client\n          .getDefinitions(projectId, null, null, null, 2, 50)\n          .then(async (definitions: any[]) => {\n            for (const def of definitions) {\n              // Get latest successful/partially-succeeded build\n              try {\n                const builds = await client.getBuilds(\n                  projectId,\n                  [def.id],\n                  null,\n                  null,\n                  null,\n                  null,\n                  null,\n                  null,\n                  2,\n                  6,\n                  null,\n                  null,\n                  1,\n                );\n\n                if (!builds || builds.length === 0) continue;\n\n                const latestBuild = builds[0];\n\n                // Check for aggregates artifact\n                const artifacts = await client.getArtifacts(\n                  projectId,\n                  latestBuild.id,\n                );\n                if (!artifacts.some((a: any) => a.name === \"aggregates\"))\n                  continue;\n\n                matches.push({\n                  id: def.id,\n                  name: def.name,\n                  buildId: latestBuild.id,\n                });\n              } catch (e) {\n                // Skip pipelines we can't access\n                console.debug(`Skipping pipeline ${def.name}:`, e);\n              }\n            }\n            resolve(matches);\n          })\n          .catch((e: unknown) => {\n            console.error(\"Discovery: definitions fetch failed:\", e);\n            resolve([]);\n          });\n      } catch (e) {\n        console.error(\"Discovery error:\", e);\n        resolve([]);\n      }\n    });\n  });\n}\n\n/**\n * Run auto-discovery and show results to user.\n */\nasync function runDiscovery(): Promise<void> {\n  const statusDisplay = document.getElementById(\"status-display\");\n  if (!statusDisplay) return;\n\n  const originalContent = statusDisplay.innerHTML;\n  statusDisplay.innerHTML =\n    \"<p>≡ƒöì Discovering pipelines with aggregates artifact...</p>\";\n\n  try {\n    const matches = await discoverPipelines();\n\n    if (matches.length === 0) {\n      statusDisplay.innerHTML = `\n                <p class=\"status-warning\">ΓÜá∩╕Å No PR Insights pipelines found in the current project.</p>\n                <p class=\"status-hint\">Create a pipeline using pr-insights-pipeline.yml and run it at least once.</p>\n            `;\n      showStatus(\"No pipelines found with aggregates artifact\", \"warning\");\n      return;\n    }\n\n    let html = `<p><strong>Found ${matches.length} pipeline(s):</strong></p><ul class=\"discovered-pipelines\">`;\n    for (const match of matches) {\n      html += `<li>\n                <strong>${escapeHtml(match.name)}</strong> (ID: ${match.id})\n                <button class=\"btn btn-small\" id=\"select-pipeline-${match.id}\">Use This</button>\n            </li>`;\n    }\n    html += \"</ul>\";\n    html +=\n      '<p class=\"status-hint\">Click \"Use This\" to configure, or clear settings for auto-discovery.</p>';\n\n    statusDisplay.innerHTML = html;\n\n    // Add event listeners for discovered pipelines\n    for (const match of matches) {\n      document\n        .getElementById(`select-pipeline-${match.id}`)\n        ?.addEventListener(\"click\", () => {\n          const pipelineInput = document.getElementById(\n            \"pipeline-id\",\n          ) as HTMLInputElement;\n          if (pipelineInput) pipelineInput.value = match.id.toString();\n          showStatus(\n            `Pipeline ${match.id} selected - click Save to confirm`,\n            \"info\",\n          );\n        });\n    }\n\n    showStatus(`Found ${matches.length} pipeline(s)`, \"success\");\n  } catch (error: unknown) {\n    statusDisplay.innerHTML = originalContent;\n    showStatus(\"Discovery failed: \" + getErrorMessage(error), \"error\");\n  }\n}\n\n/**\n * Show status message.\n */\nfunction showStatus(message: string, type = \"info\"): void {\n  const statusEl = document.getElementById(\"status-message\");\n  if (!statusEl) return;\n\n  statusEl.textContent = message;\n  statusEl.className = `status-message status-${type}`;\n\n  // Clear after delay\n  setTimeout(() => {\n    statusEl.textContent = \"\";\n    statusEl.className = \"status-message\";\n  }, 5000);\n}\n\n/**\n * Escape HTML to prevent XSS.\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement(\"div\");\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n/**\n * Set up event listeners.\n */\nfunction setupEventListeners(): void {\n  document.getElementById(\"save-btn\")?.addEventListener(\"click\", saveSettings);\n  document\n    .getElementById(\"clear-btn\")\n    ?.addEventListener(\"click\", clearSettings);\n  document\n    .getElementById(\"discover-btn\")\n    ?.addEventListener(\"click\", runDiscovery);\n\n  // Enter key saves\n  document\n    .getElementById(\"pipeline-id\")\n    ?.addEventListener(\"keypress\", (e: KeyboardEvent) => {\n      if (e.key === \"Enter\") {\n        saveSettings();\n      }\n    });\n  document\n    .getElementById(\"project-id\")\n    ?.addEventListener(\"keypress\", (e: KeyboardEvent) => {\n      if (e.key === \"Enter\") {\n        saveSettings();\n      }\n    });\n}\n\n// Initialize on load\nif (document.readyState === \"loading\") {\n  document.addEventListener(\"DOMContentLoaded\", init);\n} else {\n  init();\n}\n\n// Global exposure for potential inline handlers (though we use addEventListener now)\nwindow.selectDiscoveredPipeline = (pipelineId: number) => {\n  const pipelineInput = document.getElementById(\n    \"pipeline-id\",\n  ) as HTMLInputElement;\n  if (pipelineInput) pipelineInput.value = pipelineId.toString();\n  showStatus(`Pipeline ${pipelineId} selected - click Save to confirm`, \"info\");\n};\n",
    "usedDeprecatedRules": []
  }
]
