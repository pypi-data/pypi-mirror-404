version: 1
# SECURITY: trusted_only controls whether AI review runs on untrusted PRs
# When true: Only reviews PRs from trusted contributors (repo members)
# When false: Reviews all PRs including from forks (current setting for open source)
# Risk: Malicious PR content could potentially influence AI review output
trusted_only: false

triggers:
  on: [pull_request]
  branches: [main]

# Static analysis only - no API keys required
passes:
  - name: static
    agents: [semgrep, reviewdog] # Both free!
    enabled: true
    required: true # Fail the check if semgrep finds issues

  # Cloud AI review (requires OPENAI_API_KEY or ANTHROPIC_API_KEY)
  - name: cloud-ai
    agents: [opencode, pr_agent]
    enabled: true

# AI review - if running sidecar
# - name: local-ai
#   agents: [local_llm]
#   enabled: true
#   required: false # Skip if Ollama unavailable

# Or: cloud: claude-sonnet-4-20250514, local_llm: deepseek-coder:6.7b, llama3.2:3b, codellama:7b
models:
  default: claude-sonnet-4-20250514

limits:
  max_files: 150
  max_diff_lines: 100000
  max_tokens_per_pr: 700000
  max_usd_per_pr: 50.00
  monthly_budget_usd: 500

reporting:
  github:
    mode: checks_and_comments # Both check annotations and PR comments
    max_inline_comments: 20 # Limit comment spam
    summary: true # Post summary comment
  # ado:
  #   mode: threads_and_status
  #   max_inline_comments: 50
  #   summary: true
  #   thread_status: active

gating:
  enabled: false # Set to true to block merging on errors
  fail_on_severity: error # Only block on errors, not warnings
