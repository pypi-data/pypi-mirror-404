import{d as D,D as b,e as u,u as e,A as j,E as t,h as R,J as We,K as Ze,H as a,ad as xe,f as $,b1 as Ve,b3 as Be,b4 as Xe,w as oe,G as Ye,r as I,I as z,c as G,o as be,a as Se,$ as _,a1 as o,b as O,aq as Ue,an as Fe,F as Y,M as ee,N as Ce,O as K,b5 as ea,_ as $e,j as ne,a_ as he,aK as Ie,aV as aa,aW as ge,aX as ye,aF as ta,aP as sa,aG as la,P as oa,aZ as na}from"./lucide-xmSP9hQT.js";import{i as T,a as ze,q as Pe,r as De,Y as Te,Z as Oe,n as re,p as Ne}from"./vuetify-GaNxHxlC.js";import{_ as ra,a as ua,b as da}from"./AvatarImage.vue_vue_type_script_setup_true_lang-Dn2hTcnY.js";import{_ as ia}from"./index-BEkdVDm7.js";import{_ as N}from"./index-DQNN_TJ6.js";import{_ as se}from"./Card.vue_vue_type_script_setup_true_lang-DNnR6slc.js";import{_ as ca}from"./CardContent.vue_vue_type_script_setup_true_lang-DUGPIRRj.js";import{_ as ma,a as pa,b as fa,d as le,c as _a}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-D8spmdIu.js";import{a as ie,b as ce,c as me,d as H,_ as pe,e as va,f as ha,g as ga}from"./index-DdFPnL48.js";import{u as ke,i as ya,g as je,_ as E,a as L,b as Z,h as W,e as fe,j as ba,c as $a,t as ka,d as wa}from"./profile-DoCPoQ1v.js";import{v as q,A as Ca,x as we}from"./vueuse-CVzU65UW.js";import{s as xa,u as _e,t as Va,v as Ba,w as Sa,x as Ua,p as Q,y as Fa,z as Ia,A as za,B as Pa,E as Da,F as Ta,G as Oa,H as Na,L as ja,I as Ea,P as La,J as Ee,K as Ra,M as Ma,N as Ga,O as Aa,Q as qa,g as Le,R as Ka,U as Ja,V as Ha,W as Qa}from"./reka-ui-jpwHxpje.js";import{c as M}from"./utils-CDN07tui.js";import{d as J,Z as Re,_ as Me,s as ue,O as Wa}from"./index-tCThBqvp.js";import{_ as Za,a as Xa,b as Ya}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-tIHjrLI9.js";import{u as X}from"./vue-i18n-CJw2bq39.js";import"./index-B_jtOnfb.js";import"./qrcode-Be0W47IT.js";import"./marked-C0Rlrcoy.js";import"./color-BTziYnFN.js";import"./vue-router-DmMABOGf.js";/* empty css            */import"./swiper-3t6jdvul.js";const et=D({__name:"PopoverAnchor",props:{reference:{},asChild:{type:Boolean},as:{}},setup(d){const m=d;return(r,l)=>(u(),b(e(xa),j({"data-slot":"popover-anchor"},m),{default:t(()=>[R(r.$slots,"default")]),_:3},16))}}),Ge=D({__name:"Select",props:{open:{type:Boolean},defaultOpen:{type:Boolean},defaultValue:{},modelValue:{},by:{type:[String,Function]},dir:{},multiple:{type:Boolean},autocomplete:{},disabled:{type:Boolean},name:{},required:{type:Boolean}},emits:["update:modelValue","update:open"],setup(d,{emit:m}){const c=_e(d,m);return(f,h)=>(u(),b(e(Va),j({"data-slot":"select"},e(c)),{default:t(p=>[R(f.$slots,"default",We(Ze(p)))]),_:3},16))}}),Ae=D({inheritAttrs:!1,__name:"SelectContent",props:{forceMount:{type:Boolean},position:{default:"popper"},bodyLock:{type:Boolean},side:{},sideOffset:{},sideFlip:{type:Boolean},align:{},alignOffset:{},alignFlip:{type:Boolean},avoidCollisions:{type:Boolean},collisionBoundary:{},collisionPadding:{},arrowPadding:{},sticky:{},hideWhenDetached:{type:Boolean},positionStrategy:{},updatePositionStrategy:{},disableUpdateOnLayoutShift:{type:Boolean},prioritizePosition:{type:Boolean},reference:{},asChild:{type:Boolean},as:{},disableOutsidePointerEvents:{type:Boolean},class:{default:void 0}},emits:["closeAutoFocus","escapeKeyDown","pointerDownOutside"],setup(d,{emit:m}){const r=d,l=m,c=q(r,"class"),f=_e(c,l);return(h,p)=>(u(),b(e(Ba),null,{default:t(()=>[a(e(Sa),j({"data-slot":"select-content"},{...h.$attrs,...e(f)},{class:e(M)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative !z-[10000] max-h-(--reka-select-content-available-height) min-w-[8rem] overflow-x-hidden overflow-y-auto rounded-md border shadow-md",d.position==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r.class)}),{default:t(()=>[a(e(st)),a(e(Ua),{class:xe(e(M)("p-1",d.position==="popper"&&"h-[var(--reka-select-trigger-height)] w-full min-w-[var(--reka-select-trigger-width)] scroll-my-1"))},{default:t(()=>[R(h.$slots,"default")]),_:3},8,["class"]),a(e(tt))]),_:3},16,["class"])]),_:3}))}}),at={class:"absolute right-2 flex size-3.5 items-center justify-center"},qe=D({__name:"SelectItem",props:{value:{},disabled:{type:Boolean},textValue:{},asChild:{type:Boolean},as:{},class:{}},setup(d){const m=d,r=q(m,"class"),l=Q(r);return(c,f)=>(u(),b(e(Fa),j({"data-slot":"select-item"},e(l),{class:e(M)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",m.class)}),{default:t(()=>[$("span",at,[a(e(Ia),null,{default:t(()=>[R(c.$slots,"indicator-icon",{},()=>[a(e(Ve),{class:"size-4"})])]),_:3})]),a(e(za),null,{default:t(()=>[R(c.$slots,"default")]),_:3})]),_:3},16,["class"]))}}),tt=D({__name:"SelectScrollDownButton",props:{asChild:{type:Boolean},as:{},class:{}},setup(d){const m=d,r=q(m,"class"),l=Q(r);return(c,f)=>(u(),b(e(Pa),j({"data-slot":"select-scroll-down-button"},e(l),{class:e(M)("flex cursor-default items-center justify-center py-1",m.class)}),{default:t(()=>[R(c.$slots,"default",{},()=>[a(e(Be),{class:"size-4"})])]),_:3},16,["class"]))}}),st=D({__name:"SelectScrollUpButton",props:{asChild:{type:Boolean},as:{},class:{}},setup(d){const m=d,r=q(m,"class"),l=Q(r);return(c,f)=>(u(),b(e(Da),j({"data-slot":"select-scroll-up-button"},e(l),{class:e(M)("flex cursor-default items-center justify-center py-1",m.class)}),{default:t(()=>[R(c.$slots,"default",{},()=>[a(e(Xe),{class:"size-4"})])]),_:3},16,["class"]))}}),Ke=D({__name:"SelectTrigger",props:{disabled:{type:Boolean},reference:{},asChild:{type:Boolean},as:{},class:{default:void 0},size:{default:"default"}},setup(d){const m=d,r=q(m,"class","size"),l=Q(r);return(c,f)=>(u(),b(e(Ta),j({"data-slot":"select-trigger","data-size":d.size},e(l),{class:e(M)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",m.class)}),{default:t(()=>[R(c.$slots,"default"),a(e(Oa),{"as-child":""},{default:t(()=>[a(e(Be),{class:"size-4 opacity-50"})]),_:1})]),_:3},16,["data-size","class"]))}}),Je=D({__name:"SelectValue",props:{placeholder:{},asChild:{type:Boolean},as:{}},setup(d){const m=d;return(r,l)=>(u(),b(e(Na),j({"data-slot":"select-value"},m),{default:t(()=>[R(r.$slots,"default")]),_:3},16))}}),lt=D({__name:"Command",props:{modelValue:{default:""},defaultValue:{},multiple:{type:Boolean},orientation:{},dir:{},disabled:{type:Boolean},selectionBehavior:{},highlightOnHover:{type:Boolean},by:{},asChild:{type:Boolean},as:{},name:{},required:{type:Boolean},class:{default:void 0}},emits:["update:modelValue","highlight","entryFocus","leave"],setup(d,{emit:m}){const r=d,l=m,c=q(r,"class"),f=_e(c,l),h=I(new Map),p=I(new Map),{contains:w}=Ea({sensitivity:"base"}),k=Ye({search:"",filtered:{count:0,items:new Map,groups:new Set}});function V(){if(!k.search){k.filtered.count=h.value.size;return}k.filtered.groups=new Set;let B=0;for(const[S,C]of h.value){const g=w(C,k.search);k.filtered.items.set(S,g?1:0),g&&B++}for(const[S,C]of p.value)for(const g of C)if(k.filtered.items.get(g)>0){k.filtered.groups.add(S);break}k.filtered.count=B}return oe(()=>k.search,()=>{V()}),mt({allItems:h,allGroups:p,filterState:k}),(B,S)=>(u(),b(e(ja),j({"data-slot":"command"},e(f),{class:e(M)("bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",r.class)}),{default:t(()=>[R(B.$slots,"default")]),_:3},16,["class"]))}}),ot=D({__name:"CommandEmpty",props:{asChild:{type:Boolean},as:{},class:{}},setup(d){const m=d,r=q(m,"class"),{filterState:l}=ve(),c=G(()=>!!l.search&&l.filtered.count===0);return(f,h)=>c.value?(u(),b(e(La),j({key:0,"data-slot":"command-empty"},e(r),{class:e(M)("py-6 text-center text-sm",m.class)}),{default:t(()=>[R(f.$slots,"default")]),_:3},16,["class"])):z("",!0)}}),nt=D({__name:"CommandGroup",props:{asChild:{type:Boolean},as:{},class:{},heading:{}},setup(d){const m=d,r=q(m,"class"),{allGroups:l,filterState:c}=ve(),f=Ee(),h=G(()=>c.search?c.filtered.groups.has(f):!0);return ft({id:f}),be(()=>{l.value.has(f)||l.value.set(f,new Set)}),Se(()=>{l.value.delete(f)}),(p,w)=>(u(),b(e(Ra),j(e(r),{id:e(f),"data-slot":"command-group",class:e(M)("text-foreground overflow-hidden p-1",m.class),hidden:h.value?void 0:!0}),{default:t(()=>[d.heading?(u(),b(e(Ma),{key:0,"data-slot":"command-group-heading",class:"px-2 py-1.5 text-xs font-medium text-muted-foreground"},{default:t(()=>[_(o(d.heading),1)]),_:1})):z("",!0),R(p.$slots,"default")]),_:3},16,["id","class","hidden"]))}}),rt={"data-slot":"command-input-wrapper",class:"flex h-9 items-center gap-2 border-b px-3"},ut=D({inheritAttrs:!1,__name:"CommandInput",props:{modelValue:{},autoFocus:{type:Boolean},disabled:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(d){const m=d,r=q(m,"class"),l=Q(r),{filterState:c}=ve();return(f,h)=>(u(),O("div",rt,[a(e(Ue),{class:"size-4 shrink-0 opacity-50"}),a(e(Ga),j({...e(l),...f.$attrs},{modelValue:e(c).search,"onUpdate:modelValue":h[0]||(h[0]=p=>e(c).search=p),"data-slot":"command-input","auto-focus":"",class:e(M)("placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50",m.class)}),null,16,["modelValue","class"])]))}}),dt=D({__name:"CommandItem",props:{value:{},disabled:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},emits:["select"],setup(d,{emit:m}){const r=d,l=m,c=q(r,"class"),f=_e(c,l),h=Ee(),{filterState:p,allItems:w,allGroups:k}=ve(),V=pt(),B=G(()=>{if(p.search){const g=p.filtered.items.get(h);return g===void 0?!0:g>0}else return!0}),S=I(),C=Ca(S);return be(()=>{if(!(C.value instanceof HTMLElement))return;w.value.set(h,C.value.textContent??r.value?.toString()??"");const g=V?.id;g&&(k.value.has(g)?k.value.get(g)?.add(h):k.value.set(g,new Set([h])))}),Se(()=>{w.value.delete(h)}),(g,F)=>B.value?(u(),b(e(Aa),j({key:0},e(f),{id:e(h),ref_key:"itemRef",ref:S,"data-slot":"command-item",class:e(M)("data-[highlighted]:bg-accent data-[highlighted]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",r.class),onSelect:F[0]||(F[0]=()=>{e(p).search=""})}),{default:t(()=>[R(g.$slots,"default")]),_:3},16,["id","class"])):z("",!0)}}),it={role:"presentation"},ct=D({__name:"CommandList",props:{asChild:{type:Boolean},as:{},class:{}},setup(d){const m=d,r=q(m,"class"),l=Q(r);return(c,f)=>(u(),b(e(qa),j({"data-slot":"command-list"},e(l),{class:e(M)("max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto",m.class)}),{default:t(()=>[$("div",it,[R(c.$slots,"default")])]),_:3},16,["class"]))}}),[ve,mt]=Le("Command"),[pt,ft]=Le("CommandGroup"),_t=D({__name:"TagsInputInput",props:{placeholder:{},autoFocus:{type:Boolean},maxLength:{},asChild:{type:Boolean},as:{},class:{}},setup(d){const m=d,r=q(m,"class"),l=Q(r);return(c,f)=>(u(),b(e(Ka),j(e(l),{class:e(M)("text-sm min-h-5 focus:outline-none flex-1 bg-transparent px-1",m.class)}),null,16,["class"]))}}),vt=D({__name:"TagsInputItem",props:{value:{},disabled:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(d){const m=d,r=q(m,"class"),l=Q(r);return(c,f)=>(u(),b(e(Ja),j(e(l),{class:e(M)("flex h-5 items-center rounded-md bg-secondary data-[state=active]:ring-ring data-[state=active]:ring-2 data-[state=active]:ring-offset-2 ring-offset-background",m.class)}),{default:t(()=>[R(c.$slots,"default")]),_:3},16,["class"]))}}),ht=D({__name:"TagsInputItemDelete",props:{asChild:{type:Boolean},as:{},class:{}},setup(d){const m=d,r=q(m,"class"),l=Q(r);return(c,f)=>(u(),b(e(Ha),j(e(l),{class:e(M)("flex rounded bg-transparent mr-1",m.class)}),{default:t(()=>[R(c.$slots,"default",{},()=>[a(e(Fe),{class:"w-4 h-4"})])]),_:3},16,["class"]))}}),de=D({__name:"MultiSelect",props:{modelValue:{},options:{},placeholder:{}},emits:["update:modelValue"],setup(d,{emit:m}){const{t:r}=X(),l=d,c=m,f=I(!1),h=G({get:()=>l.modelValue||[],set:V=>{c("update:modelValue",V)}}),p=V=>h.value.includes(V),w=V=>{const B=h.value,S=B.includes(V)?B.filter(C=>C!==V):[...B,V];h.value=S},k=V=>{const B=String(V);return l.options.find(C=>C.value===B)?.label||B};return(V,B)=>(u(),b(e(Za),{open:f.value,"onUpdate:open":B[5]||(B[5]=S=>f.value=S)},{default:t(()=>[a(e(et),{class:"inline-flex w-full"},{default:t(()=>[a(e(Qa),{modelValue:h.value,"onUpdate:modelValue":B[3]||(B[3]=S=>h.value=S),delimiter:"",class:"flex gap-2 items-center flex-wrap rounded-md border border-input bg-background px-3 py-2 text-sm shadow-xs transition-[color,box-shadow] outline-none focus-within:border-ring focus-within:ring-ring/50 focus-within:ring-[3px] min-h-[2.5rem] w-full"},{default:t(({modelValue:S})=>[(u(!0),O(Y,null,ee(S,C=>(u(),b(e(vt),{key:String(C),value:C,class:"flex items-center justify-center gap-1.5 text-sm bg-primary text-primary-foreground rounded px-2 py-0.5"},{default:t(()=>[$("span",null,o(k(String(C))),1),a(e(ht),null,{default:t(()=>[a(e(Fe),{size:12})]),_:1})]),_:2},1032,["value"]))),128)),a(e(_t),{placeholder:d.placeholder,class:"flex-1 min-w-[120px]",onKeydown:[B[0]||(B[0]=Ce(K(()=>{},["prevent"]),["enter"])),B[1]||(B[1]=Ce(C=>f.value=!0,["down"]))]},null,8,["placeholder"]),a(e(Xa),{"as-child":""},{default:t(()=>[a(e(N),{size:"icon-sm",variant:"ghost",class:"ml-auto shrink-0",onClick:B[2]||(B[2]=K(()=>{},["prevent"]))},{default:t(()=>[a(e(ea),{size:16,class:"opacity-50"})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(e(Ya),{class:"w-[var(--radix-popover-anchor-width)] p-0",align:"start","side-offset":4,"collision-padding":16,onOpenAutoFocus:B[4]||(B[4]=K(()=>{},["prevent"]))},{default:t(()=>[a(e(lt),null,{default:t(()=>[a(e(ut),{placeholder:V.$t("search")},null,8,["placeholder"]),a(e(ct),{class:"max-h-[250px] overflow-y-auto"},{default:t(()=>[a(e(ot),null,{default:t(()=>[_(o(V.$t("no_content")),1)]),_:1}),a(e(nt),null,{default:t(()=>[(u(!0),O(Y,null,ee(l.options,S=>(u(),b(e(dt),{key:S.value,value:S.value,onSelect:C=>{w(S.value)}},{default:t(()=>[_(o(S.label)+" ",1),a(e(Ve),{class:xe(e(M)("ml-auto",p(S.value)?"opacity-100":"opacity-0"))},null,8,["class"])]),_:2},1032,["value","onSelect"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}}),gt=D({__name:"CreateUserDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","created"],setup(d,{emit:m}){const{t:r}=X(),l=d,c=m,f=we(l,"modelValue",c),h=I(!1),p=I(null),w=async()=>{if(await ne(),!p.value)return;const v=p.value.querySelector("[aria-invalid='true'], [data-invalid='true']");v&&(v.scrollIntoView({behavior:"smooth",block:"center"}),v.focus())},k=async()=>{await C.handleSubmit(),await ne(),p.value&&p.value.querySelector("[aria-invalid='true'], [data-invalid='true']")&&await w()},V=G(()=>[{label:r("auth.admin_role"),value:"admin"},{label:r("auth.user_role"),value:"user"}]),B=G(()=>Object.values(J.players).map(v=>({label:v.name,value:v.player_id})).sort((v,A)=>v.label.localeCompare(A.label))),S=G(()=>Object.values(J.providers).filter(v=>v.type===Re.MUSIC).map(v=>({label:v.name,value:v.instance_id})).sort((v,A)=>v.label.localeCompare(A.label))),C=ke({defaultValues:{username:"",displayName:"",password:"",confirmPassword:"",role:"user",playerFilter:[],providerFilter:[]},validators:{onSubmit:ya(r)},onSubmit:async({value:v})=>{h.value=!0;try{await J.createUser(v.username,v.password,v.role,v.displayName||void 0,v.playerFilter.length>0?v.playerFilter:void 0,v.providerFilter.length>0?v.providerFilter:void 0)?(T.success(r("auth.user_created")),C.reset(),c("created"),c("update:modelValue",!1)):T.error(r("auth.user_create_failed"))}catch{T.error(r("auth.user_create_failed"))}finally{h.value=!1}}}),g=v=>v.state.meta.errors.length>0,F=()=>{C.reset(),c("update:modelValue",!1)};return oe(()=>l.modelValue,v=>{v||C.reset()}),(v,A)=>(u(),b(e(pe),{open:e(f),"onUpdate:open":A[0]||(A[0]=s=>$e(f)?f.value=s:null)},{default:t(()=>[a(e(ie),{class:"max-h-[70vh] flex flex-col p-0"},{default:t(()=>[a(e(ce),{class:"px-6 pt-6 pb-4"},{default:t(()=>[a(e(me),null,{default:t(()=>[_(o(v.$t("auth.create_user")),1)]),_:1})]),_:1}),$("div",{ref_key:"scrollContainer",ref:p,class:"flex-1 overflow-y-auto px-6"},[$("form",{id:"form-create-user",onSubmit:K(k,["prevent"])},[a(e(je),null,{default:t(()=>[a(e(C).Field,{name:"username"},{default:t(({field:s})=>[a(e(E),{"data-invalid":g(s)},{default:t(()=>[a(e(L),{for:s.name},{default:t(()=>[_(o(v.$t("auth.username")),1)]),_:1},8,["for"]),a(e(H),{id:s.name,name:s.name,"model-value":s.state.value,"aria-invalid":g(s),autofocus:"",autocomplete:"username",onBlur:s.handleBlur,onInput:i=>{s.handleChange(i.target.value)}},null,8,["id","name","model-value","aria-invalid","onBlur","onInput"]),g(s)?(u(),b(e(Z),{key:0,errors:s.state.meta.errors},null,8,["errors"])):z("",!0)]),_:2},1032,["data-invalid"])]),_:1}),a(e(C).Field,{name:"displayName"},{default:t(({field:s})=>[a(e(E),null,{default:t(()=>[a(e(L),{for:s.name},{default:t(()=>[_(o(v.$t("auth.display_name")),1)]),_:1},8,["for"]),a(e(H),{id:s.name,name:s.name,"model-value":s.state.value,autocomplete:"name",onBlur:s.handleBlur,onInput:i=>{s.handleChange(i.target.value)}},null,8,["id","name","model-value","onBlur","onInput"]),a(e(W),null,{default:t(()=>[_(o(v.$t("optional")),1)]),_:1})]),_:2},1024)]),_:1}),a(e(C).Field,{name:"password"},{default:t(({field:s})=>[a(e(E),{"data-invalid":g(s)},{default:t(()=>[a(e(L),{for:s.name},{default:t(()=>[_(o(v.$t("auth.password")),1)]),_:1},8,["for"]),a(e(H),{id:s.name,name:s.name,type:"password","model-value":s.state.value,"aria-invalid":g(s),autocomplete:"new-password",onBlur:s.handleBlur,onInput:i=>{s.handleChange(i.target.value)}},null,8,["id","name","model-value","aria-invalid","onBlur","onInput"]),g(s)?(u(),b(e(Z),{key:0,errors:s.state.meta.errors},null,8,["errors"])):z("",!0)]),_:2},1032,["data-invalid"])]),_:1}),a(e(C).Field,{name:"confirmPassword"},{default:t(({field:s})=>[a(e(E),{"data-invalid":g(s)},{default:t(()=>[a(e(L),{for:s.name},{default:t(()=>[_(o(v.$t("auth.confirm_password")),1)]),_:1},8,["for"]),a(e(H),{id:s.name,name:s.name,type:"password","model-value":s.state.value,"aria-invalid":g(s),autocomplete:"new-password",onBlur:s.handleBlur,onInput:i=>{s.handleChange(i.target.value)}},null,8,["id","name","model-value","aria-invalid","onBlur","onInput"]),g(s)?(u(),b(e(Z),{key:0,errors:s.state.meta.errors},null,8,["errors"])):z("",!0)]),_:2},1032,["data-invalid"])]),_:1}),a(e(C).Field,{name:"role"},{default:t(({field:s})=>[a(e(E),null,{default:t(()=>[a(e(L),{for:s.name},{default:t(()=>[_(o(v.$t("auth.role")),1)]),_:1},8,["for"]),a(e(Ge),{"model-value":s.state.value,"onUpdate:modelValue":i=>s.handleChange(i)},{default:t(()=>[a(e(Ke),{id:s.name,class:"w-full"},{default:t(()=>[a(e(Je),{placeholder:v.$t("auth.role")},null,8,["placeholder"])]),_:1},8,["id"]),a(e(Ae),null,{default:t(()=>[(u(!0),O(Y,null,ee(V.value,i=>(u(),b(e(qe),{key:i.value,value:i.value},{default:t(()=>[_(o(i.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:2},1032,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:1}),a(e(C).Field,{name:"playerFilter"},{default:t(({field:s})=>[a(e(E),null,{default:t(()=>[a(e(L),null,{default:t(()=>[_(o(v.$t("auth.player_filter")),1)]),_:1}),a(de,{"model-value":s.state.value,options:B.value,placeholder:v.$t("auth.select_players"),"onUpdate:modelValue":s.handleChange},null,8,["model-value","options","placeholder","onUpdate:modelValue"]),a(e(W),null,{default:t(()=>[_(o(v.$t("auth.player_filter_hint")),1)]),_:1})]),_:2},1024)]),_:1}),a(e(C).Field,{name:"providerFilter"},{default:t(({field:s})=>[a(e(E),null,{default:t(()=>[a(e(L),null,{default:t(()=>[_(o(v.$t("auth.provider_filter")),1)]),_:1}),a(de,{"model-value":s.state.value,options:S.value,placeholder:v.$t("auth.select_providers"),"onUpdate:modelValue":s.handleChange},null,8,["model-value","options","placeholder","onUpdate:modelValue"]),a(e(W),null,{default:t(()=>[_(o(v.$t("auth.provider_filter_hint")),1)]),_:1})]),_:2},1024)]),_:1})]),_:1})],32)],512),a(e(fe),{class:"px-6 pb-6 pt-4 border-t shrink-0"},{default:t(()=>[a(e(N),{variant:"outline",onClick:F},{default:t(()=>[_(o(v.$t("cancel")),1)]),_:1}),a(e(N),{type:"submit",form:"form-create-user",disabled:h.value,loading:h.value},{default:t(()=>[_(o(v.$t("create")),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["open"]))}}),yt={class:"text-body-1 mb-4"},bt={key:0,class:"user-name-box"},$t=D({__name:"DeleteUserDialog",props:{modelValue:{type:Boolean},user:{}},emits:["update:modelValue","deleted"],setup(d,{emit:m}){const{t:r}=X(),l=d,c=m,f=I(!1),h=async()=>{if(l.user){f.value=!0;try{await J.deleteUser(l.user.user_id)?(T.success(r("auth.user_deleted")),c("deleted"),c("update:modelValue",!1)):T.error(r("auth.user_delete_failed"))}catch{T.error(r("auth.user_delete_failed"))}finally{f.value=!1}}};return(p,w)=>(u(),b(Ne,{"model-value":d.modelValue,"max-width":"480","onUpdate:modelValue":w[1]||(w[1]=k=>c("update:modelValue",k))},{default:t(()=>[a(ze,null,{default:t(()=>[a(Pe,{class:"text-h6 pl-6 pb-0"},{default:t(()=>[_(o(p.$t("auth.delete_user")),1)]),_:1}),a(De,{class:"px-6 pb-2"},{default:t(()=>[$("p",yt,o(p.$t("auth.confirm_delete_user")),1),d.user?(u(),O("div",bt,o(d.user.display_name||d.user.username),1)):z("",!0)]),_:1}),a(Te,{class:"pa-6 pt-4"},{default:t(()=>[a(Oe),a(re,{variant:"text",onClick:w[0]||(w[0]=k=>c("update:modelValue",!1))},{default:t(()=>[_(o(p.$t("cancel")),1)]),_:1}),a(re,{color:"error",variant:"flat",loading:f.value,onClick:h},{default:t(()=>[_(o(p.$t("auth.delete_user")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),kt=Me($t,[["__scopeId","data-v-8cbf5f8f"]]),wt={class:"text-body-1 mb-4"},Ct={key:0,class:"user-name-box"},xt=D({__name:"DisableUserDialog",props:{modelValue:{type:Boolean},user:{}},emits:["update:modelValue","disabled"],setup(d,{emit:m}){const{t:r}=X(),l=d,c=m,f=I(!1),h=async()=>{if(l.user){f.value=!0;try{await J.disableUser(l.user.user_id)?(T.success(r("auth.user_disabled")),c("disabled"),c("update:modelValue",!1)):T.error(r("auth.user_disable_failed"))}catch{T.error(r("auth.user_disable_failed"))}finally{f.value=!1}}};return(p,w)=>(u(),b(Ne,{"model-value":d.modelValue,"max-width":"480","onUpdate:modelValue":w[1]||(w[1]=k=>c("update:modelValue",k))},{default:t(()=>[a(ze,null,{default:t(()=>[a(Pe,{class:"text-h6 pl-6 pb-0"},{default:t(()=>[_(o(p.$t("auth.disable_user")),1)]),_:1}),a(De,{class:"px-6 pb-2"},{default:t(()=>[$("p",wt,o(p.$t("auth.confirm_disable_user")),1),d.user?(u(),O("div",Ct,o(d.user.display_name||d.user.username),1)):z("",!0)]),_:1}),a(Te,{class:"pa-6 pt-4"},{default:t(()=>[a(Oe),a(re,{variant:"text",onClick:w[0]||(w[0]=k=>c("update:modelValue",!1))},{default:t(()=>[_(o(p.$t("cancel")),1)]),_:1}),a(re,{color:"error",variant:"flat",loading:f.value,onClick:h},{default:t(()=>[_(o(p.$t("auth.disable_user")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),Vt=Me(xt,[["__scopeId","data-v-9638370d"]]),Bt=D({__name:"EditUserDialog",props:{modelValue:{type:Boolean},user:{}},emits:["update:modelValue","updated"],setup(d,{emit:m}){const{t:r}=X(),l=d,c=m,f=we(l,"modelValue",c),h=I(!1),p=I(null),w=async()=>{if(await ne(),!p.value)return;const s=p.value.querySelector("[aria-invalid='true'], [data-invalid='true']");s&&(s.scrollIntoView({behavior:"smooth",block:"center"}),s.focus())},k=async()=>{await g.handleSubmit(),await ne(),p.value&&p.value.querySelector("[aria-invalid='true'], [data-invalid='true']")&&await w()},V=G(()=>[{label:r("auth.admin_role"),value:"admin"},{label:r("auth.user_role"),value:"user"}]),B=G(()=>Object.values(J.players).map(s=>({label:s.name,value:s.player_id})).sort((s,i)=>s.label.localeCompare(i.label))),S=G(()=>Object.values(J.providers).filter(s=>s.type===Re.MUSIC).map(s=>({label:s.name,value:s.instance_id})).sort((s,i)=>s.label.localeCompare(i.label))),C=G(()=>!l.user||!ue.currentUser?!1:l.user.user_id===ue.currentUser.user_id),g=ke({defaultValues:{username:l.user?.username||"",displayName:l.user?.display_name||"",avatarUrl:l.user?.avatar_url||"",role:l.user?.role||"user",password:"",confirmPassword:"",playerFilter:l.user?.player_filter||[],providerFilter:l.user?.provider_filter||[]},validators:{onSubmit:ba(r)},onSubmit:async({value:s})=>{if(l.user){h.value=!0;try{const i={};s.username!==l.user.username&&(i.username=s.username),s.displayName!==(l.user.display_name||"")&&(i.displayName=s.displayName),s.avatarUrl!==(l.user.avatar_url||"")&&(i.avatarUrl=s.avatarUrl),s.role!==l.user.role&&!C.value&&(i.role=s.role),s.password&&(i.password=s.password);const n=l.user.player_filter||[];JSON.stringify([...s.playerFilter].sort())!==JSON.stringify([...n].sort())&&(i.player_filter=s.playerFilter);const y=l.user.provider_filter||[];JSON.stringify([...s.providerFilter].sort())!==JSON.stringify([...y].sort())&&(i.provider_filter=s.providerFilter),await J.updateUser(l.user.user_id,i),T.success(r("auth.user_updated")),c("updated"),c("update:modelValue",!1)}catch{T.error(r("auth.user_update_failed"))}finally{h.value=!1}}}}),F=s=>s.state.meta.errors.length>0,v=()=>{l.user&&(g.setFieldValue("username",l.user.username),g.setFieldValue("displayName",l.user.display_name||""),g.setFieldValue("avatarUrl",l.user.avatar_url||""),g.setFieldValue("role",l.user.role),g.setFieldValue("password",""),g.setFieldValue("confirmPassword",""),g.setFieldValue("playerFilter",l.user.player_filter||[]),g.setFieldValue("providerFilter",l.user.provider_filter||[]))},A=()=>{v(),c("update:modelValue",!1)};return oe(()=>l.user,v,{immediate:!0}),oe(()=>l.modelValue,s=>{s&&v()}),(s,i)=>(u(),b(e(pe),{open:e(f),"onUpdate:open":i[0]||(i[0]=n=>$e(f)?f.value=n:null)},{default:t(()=>[a(e(ie),{class:"sm:max-w-[500px] max-h-[90vh] flex flex-col p-0"},{default:t(()=>[a(e(ce),{class:"px-6 pt-6 pb-4"},{default:t(()=>[a(e(me),null,{default:t(()=>[_(o(s.$t("auth.edit_user")),1)]),_:1})]),_:1}),$("div",{ref_key:"scrollContainer",ref:p,class:"flex-1 overflow-y-auto px-6"},[$("form",{id:"form-edit-user",onSubmit:K(k,["prevent"])},[a(e(je),null,{default:t(()=>[a(e(g).Field,{name:"username"},{default:t(({field:n})=>[a(e(E),{"data-invalid":F(n)},{default:t(()=>[a(e(L),{for:n.name},{default:t(()=>[_(o(s.$t("auth.username")),1)]),_:1},8,["for"]),a(e(H),{id:n.name,name:n.name,"model-value":n.state.value,"aria-invalid":F(n),autocomplete:"username",onBlur:n.handleBlur,onInput:y=>{n.handleChange(y.target.value)}},null,8,["id","name","model-value","aria-invalid","onBlur","onInput"]),F(n)?(u(),b(e(Z),{key:0,errors:n.state.meta.errors},null,8,["errors"])):z("",!0)]),_:2},1032,["data-invalid"])]),_:1}),a(e(g).Field,{name:"displayName"},{default:t(({field:n})=>[a(e(E),null,{default:t(()=>[a(e(L),{for:n.name},{default:t(()=>[_(o(s.$t("auth.display_name")),1)]),_:1},8,["for"]),a(e(H),{id:n.name,name:n.name,"model-value":n.state.value,autocomplete:"name",onBlur:n.handleBlur,onInput:y=>{n.handleChange(y.target.value)}},null,8,["id","name","model-value","onBlur","onInput"]),a(e(W),null,{default:t(()=>[_(o(s.$t("optional")),1)]),_:1})]),_:2},1024)]),_:1}),a(e(g).Field,{name:"avatarUrl"},{default:t(({field:n})=>[a(e(E),{"data-invalid":F(n)},{default:t(()=>[a(e(L),{for:n.name},{default:t(()=>[_(o(s.$t("auth.avatar_url")),1)]),_:1},8,["for"]),a(e(H),{id:n.name,name:n.name,"model-value":n.state.value,"aria-invalid":F(n),onBlur:n.handleBlur,onInput:y=>{n.handleChange(y.target.value)}},null,8,["id","name","model-value","aria-invalid","onBlur","onInput"]),a(e(W),null,{default:t(()=>[_(o(s.$t("auth.avatar_url_hint")),1)]),_:1}),F(n)?(u(),b(e(Z),{key:0,errors:n.state.meta.errors},null,8,["errors"])):z("",!0)]),_:2},1032,["data-invalid"])]),_:1}),a(e(g).Field,{name:"role"},{default:t(({field:n})=>[a(e(E),null,{default:t(()=>[a(e(L),{for:n.name},{default:t(()=>[_(o(s.$t("auth.role")),1)]),_:1},8,["for"]),a(e(Ge),{"model-value":n.state.value,disabled:C.value,"onUpdate:modelValue":y=>n.handleChange(y)},{default:t(()=>[a(e(Ke),{id:n.name,class:"w-full"},{default:t(()=>[a(e(Je),{placeholder:s.$t("auth.role")},null,8,["placeholder"])]),_:1},8,["id"]),a(e(Ae),null,{default:t(()=>[(u(!0),O(Y,null,ee(V.value,y=>(u(),b(e(qe),{key:y.value,value:y.value},{default:t(()=>[_(o(y.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:2},1032,["model-value","disabled","onUpdate:modelValue"])]),_:2},1024)]),_:1}),a(e(g).Field,{name:"password"},{default:t(({field:n})=>[a(e(E),{"data-invalid":F(n)},{default:t(()=>[a(e(L),{for:n.name},{default:t(()=>[_(o(s.$t("auth.new_password")),1)]),_:1},8,["for"]),a(e(H),{id:n.name,name:n.name,type:"password","model-value":n.state.value,"aria-invalid":F(n),autocomplete:"new-password",onBlur:n.handleBlur,onInput:y=>{n.handleChange(y.target.value)}},null,8,["id","name","model-value","aria-invalid","onBlur","onInput"]),a(e(W),null,{default:t(()=>[_(o(s.$t("auth.password_optional_hint")),1)]),_:1}),F(n)?(u(),b(e(Z),{key:0,errors:n.state.meta.errors},null,8,["errors"])):z("",!0)]),_:2},1032,["data-invalid"])]),_:1}),e(g).state.values.password?(u(),b(e(g).Field,{key:0,name:"confirmPassword"},{default:t(({field:n})=>[a(e(E),{"data-invalid":F(n)},{default:t(()=>[a(e(L),{for:n.name},{default:t(()=>[_(o(s.$t("auth.confirm_password")),1)]),_:1},8,["for"]),a(e(H),{id:n.name,name:n.name,type:"password","model-value":n.state.value,"aria-invalid":F(n),autocomplete:"new-password",onBlur:n.handleBlur,onInput:y=>{n.handleChange(y.target.value)}},null,8,["id","name","model-value","aria-invalid","onBlur","onInput"]),F(n)?(u(),b(e(Z),{key:0,errors:n.state.meta.errors},null,8,["errors"])):z("",!0)]),_:2},1032,["data-invalid"])]),_:1})):z("",!0),a(e(g).Field,{name:"playerFilter"},{default:t(({field:n})=>[a(e(E),null,{default:t(()=>[a(e(L),null,{default:t(()=>[_(o(s.$t("auth.player_filter")),1)]),_:1}),a(de,{"model-value":n.state.value,options:B.value,placeholder:s.$t("auth.select_players"),"onUpdate:modelValue":n.handleChange},null,8,["model-value","options","placeholder","onUpdate:modelValue"]),a(e(W),null,{default:t(()=>[_(o(s.$t("auth.player_filter_hint")),1)]),_:1})]),_:2},1024)]),_:1}),a(e(g).Field,{name:"providerFilter"},{default:t(({field:n})=>[a(e(E),null,{default:t(()=>[a(e(L),null,{default:t(()=>[_(o(s.$t("auth.provider_filter")),1)]),_:1}),a(de,{"model-value":n.state.value,options:S.value,placeholder:s.$t("auth.select_providers"),"onUpdate:modelValue":n.handleChange},null,8,["model-value","options","placeholder","onUpdate:modelValue"]),a(e(W),null,{default:t(()=>[_(o(s.$t("auth.provider_filter_hint")),1)]),_:1})]),_:2},1024)]),_:1})]),_:1})],32)],512),a(e(fe),{class:"px-6 pb-6 pt-4 border-t shrink-0"},{default:t(()=>[a(e(N),{variant:"outline",onClick:A},{default:t(()=>[_(o(s.$t("cancel")),1)]),_:1}),a(e(N),{type:"submit",form:"form-edit-user",disabled:h.value,loading:h.value},{default:t(()=>[_(o(s.$t("edit")),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["open"]))}}),St={class:"space-y-6"},Ut={class:"text-base font-semibold mb-2 mt-4"},Ft={class:"text-sm text-muted-foreground mb-4"},It={key:0,class:"flex flex-col items-center justify-center py-12 border-2 border-dashed rounded-lg"},zt={class:"size-16 rounded-full bg-blue-900/20 flex items-center justify-center mb-3"},Pt={class:"text-sm text-muted-foreground"},Dt={key:1,class:"space-y-2"},Tt={class:"flex items-center gap-4"},Ot={class:"size-10 rounded-full bg-blue-900/20 flex items-center justify-center shrink-0"},Nt={class:"flex-1 min-w-0"},jt={class:"font-medium text-sm truncate"},Et={class:"text-xs text-muted-foreground flex items-center gap-2 flex-wrap"},Lt={key:0,class:"text-muted-foreground"},Rt={key:1},Mt={class:"flex items-start justify-between gap-4 mb-4"},Gt={class:"flex-1"},At={class:"text-base font-semibold mb-2"},qt={class:"text-sm text-muted-foreground"},Kt={class:"flex justify-end gap-2 mt-4"},Jt={class:"text-sm text-muted-foreground"},Ht={key:2,class:"flex flex-col items-center justify-center py-12 border-2 border-dashed rounded-lg"},Qt={class:"size-16 rounded-full bg-purple-900/20 flex items-center justify-center mb-3"},Wt={class:"text-sm text-muted-foreground"},Zt={key:3,class:"space-y-2"},Xt={class:"flex items-center gap-4"},Yt={class:"size-10 rounded-full bg-purple-900/20 flex items-center justify-center shrink-0"},es={class:"flex-1 min-w-0"},as={class:"font-medium text-sm truncate"},ts={class:"text-xs text-muted-foreground flex items-center gap-2 flex-wrap"},ss={key:0,class:"text-muted-foreground"},ls={key:1},os=D({__name:"ManageTokensDialog",props:{modelValue:{type:Boolean},user:{},tokens:{}},emits:["update:modelValue","revoke","token-created"],setup(d,{emit:m}){const{t:r}=X(),l=d,c=m,f=we(l,"modelValue",c),h=I(!1),p=I(!1),w=I(""),k=I(""),V=G(()=>l.tokens.filter(i=>!i.is_long_lived)),B=G(()=>l.tokens.filter(i=>i.is_long_lived)),S=i=>new Date(i).toLocaleString(),C=ke({defaultValues:{tokenName:""},validators:{onSubmit:$a(r)},onSubmit:async()=>{}}),g=i=>i.state.meta.errors.length>0,F=G(()=>{const i=w.value||"";return i.trim().length>0&&i.length<=100&&!p.value}),v=async()=>{if(!(!l.user||!F.value)){p.value=!0;try{const i=await J.createToken(w.value,l.user.user_id);i?(k.value=i,w.value="",h.value=!1,C.reset(),c("token-created"),T.success(r("auth.token_created"))):T.error(r("auth.token_create_failed"))}catch(i){T.error(i.message||r("auth.token_create_failed"))}finally{p.value=!1}}},A=async()=>{k.value&&(await Wa(k.value),T.success(r("auth.token_copied")))},s=()=>{k.value="",w.value="",h.value=!1,C.reset()};return(i,n)=>(u(),b(e(pe),{open:e(f),"onUpdate:open":n[4]||(n[4]=y=>$e(f)?f.value=y:null)},{default:t(()=>[a(e(ie),{class:"sm:max-w-[900px] max-h-[90vh] overflow-y-auto"},{default:t(()=>[a(e(ce),null,{default:t(()=>[a(e(me),null,{default:t(()=>[_(o(i.$t("auth.tokens"))+" - "+o(d.user?.display_name||d.user?.username),1)]),_:1})]),_:1}),$("div",St,[$("div",null,[$("h3",Ut,o(i.$t("auth.active_sessions")),1),$("p",Ft,o(i.$t("auth.active_sessions_description")),1),V.value.length===0?(u(),O("div",It,[$("div",zt,[a(e(he),{size:32,class:"text-blue-500"})]),$("p",Pt,o(i.$t("auth.no_active_sessions")),1)])):(u(),O("div",Dt,[(u(!0),O(Y,null,ee(V.value,y=>(u(),b(e(se),{key:y.token_id,class:"p-4"},{default:t(()=>[$("div",Tt,[$("div",Ot,[a(e(he),{size:20,class:"text-blue-500"})]),$("div",Nt,[$("div",jt,o(y.name),1),$("div",Et,[$("span",null,o(i.$t("created"))+": "+o(S(y.created_at)),1),y.last_used_at?(u(),O("span",Lt," • ")):z("",!0),y.last_used_at?(u(),O("span",Rt,o(i.$t("last_used"))+": "+o(S(y.last_used_at)),1)):z("",!0)])]),a(e(N),{variant:"ghost",size:"icon",class:"text-destructive hover:text-destructive",onClick:K(ae=>c("revoke",y),["stop"])},{default:t(()=>[a(e(ye),{size:16})]),_:1},8,["onClick"])])]),_:2},1024))),128))]))]),$("div",null,[$("div",Mt,[$("div",Gt,[$("h3",At,o(i.$t("auth.long_lived_tokens")),1),$("p",qt,o(i.$t("auth.long_lived_tokens_description")),1)]),h.value?(u(),b(e(N),{key:1,variant:"outline",size:"sm",onClick:n[1]||(n[1]=y=>h.value=!1)},{default:t(()=>[_(o(i.$t("cancel")),1)]),_:1})):(u(),b(e(N),{key:0,size:"sm",onClick:n[0]||(n[0]=y=>h.value=!0)},{default:t(()=>[a(e(Ie),{size:16}),_(" "+o(i.$t("auth.create_token")),1)]),_:1}))]),h.value?(u(),b(e(se),{key:0,class:"p-4 mb-4 border-primary/20"},{default:t(()=>[$("form",{id:"form-create-token",onSubmit:K(v,["prevent"])},[a(e(C).Field,{name:"tokenName",validators:{onChange:e(ka)(e(r))}},{default:t(({field:y})=>[a(e(E),{"data-invalid":g(y)},{default:t(()=>[a(e(L),{for:y.name},{default:t(()=>[_(o(i.$t("auth.token_name")),1)]),_:1},8,["for"]),a(e(H),{id:y.name,name:y.name,"model-value":w.value,"aria-invalid":g(y),placeholder:i.$t("auth.token_name_hint"),autofocus:"",autocomplete:"off",onBlur:y.handleBlur,onInput:ae=>{w.value=ae.target.value,y.handleChange(ae.target.value)}},null,8,["id","name","model-value","aria-invalid","placeholder","onBlur","onInput"]),g(y)?(u(),b(e(Z),{key:0,errors:y.state.meta.errors},null,8,["errors"])):z("",!0)]),_:2},1032,["data-invalid"])]),_:1},8,["validators"]),$("div",Kt,[a(e(N),{variant:"outline",onClick:n[2]||(n[2]=y=>h.value=!1)},{default:t(()=>[_(o(i.$t("cancel")),1)]),_:1}),a(e(N),{type:"submit",disabled:!F.value,loading:p.value},{default:t(()=>[_(o(i.$t("create")),1)]),_:1},8,["disabled","loading"])])],32)]),_:1})):z("",!0),k.value?(u(),b(e(se),{key:1,class:"p-4 mb-4 bg-destructive/10 border-destructive/20"},{default:t(()=>[$("p",Jt,o(i.$t("auth.copy_new_token_hint")),1),a(e(va),null,{default:t(()=>[a(e(ha),{"model-value":k.value,readonly:"",class:"font-mono text-sm"},null,8,["model-value"]),a(e(ga),{align:"inline-end"},{default:t(()=>[a(e(wa),{size:"icon-sm",variant:"ghost",onClick:A},{default:t(()=>[a(e(aa),{size:16})]),_:1})]),_:1})]),_:1}),a(e(N),{variant:"outline",class:"mt-4 w-full",onClick:s},{default:t(()=>[_(o(i.$t("close")),1)]),_:1})]),_:1})):z("",!0),B.value.length===0?(u(),O("div",Ht,[$("div",Qt,[a(e(ge),{size:32,class:"text-purple-500"})]),$("p",Wt,o(i.$t("auth.no_long_lived_tokens")),1)])):(u(),O("div",Zt,[(u(!0),O(Y,null,ee(B.value,y=>(u(),b(e(se),{key:y.token_id,class:"p-4"},{default:t(()=>[$("div",Xt,[$("div",Yt,[a(e(ge),{size:20,class:"text-purple-500"})]),$("div",es,[$("div",as,o(y.name),1),$("div",ts,[$("span",null,o(i.$t("created"))+": "+o(S(y.created_at)),1),y.last_used_at?(u(),O("span",ss," • ")):z("",!0),y.last_used_at?(u(),O("span",ls,o(i.$t("last_used"))+": "+o(S(y.last_used_at)),1)):z("",!0)])]),a(e(N),{variant:"ghost",size:"icon",class:"text-destructive hover:text-destructive",onClick:K(ae=>c("revoke",y),["stop"])},{default:t(()=>[a(e(ye),{size:16})]),_:1},8,["onClick"])])]),_:2},1024))),128))]))])]),a(e(fe),null,{default:t(()=>[a(e(N),{variant:"outline",onClick:n[3]||(n[3]=y=>c("update:modelValue",!1))},{default:t(()=>[_(o(i.$t("close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}}),ns={class:"py-4"},rs={class:"text-sm text-muted-foreground mb-4"},us={key:0,class:"rounded-md bg-destructive/10 p-4"},ds={class:"font-medium"},is=D({__name:"RevokeTokenDialog",props:{modelValue:{type:Boolean},token:{}},emits:["update:modelValue","revoked"],setup(d,{emit:m}){const{t:r}=X(),l=d,c=m,f=I(!1),h=async()=>{if(!l.token)return;f.value=!0;const p=!l.token.is_long_lived;try{await J.revokeToken(l.token.token_id)?(T.success(r(p?"auth.session_revoked":"auth.token_revoked")),c("revoked"),c("update:modelValue",!1)):T.error(r(p?"auth.session_revoke_failed":"auth.token_revoke_failed"))}catch{T.error(r(p?"auth.session_revoke_failed":"auth.token_revoke_failed"))}finally{f.value=!1}};return(p,w)=>(u(),b(e(pe),{open:d.modelValue,"onUpdate:open":w[1]||(w[1]=k=>c("update:modelValue",k))},{default:t(()=>[a(e(ie),{class:"sm:max-w-md"},{default:t(()=>[a(e(ce),null,{default:t(()=>[a(e(me),null,{default:t(()=>[_(o(d.token?.is_long_lived?p.$t("auth.revoke_token"):p.$t("auth.revoke_session")),1)]),_:1})]),_:1}),$("div",ns,[$("p",rs,o(d.token?.is_long_lived?p.$t("auth.revoke_token_confirm"):p.$t("auth.revoke_session_confirm")),1),d.token?(u(),O("div",us,[$("p",ds,o(d.token.name),1)])):z("",!0)]),a(e(fe),null,{default:t(()=>[a(e(N),{variant:"outline",onClick:w[0]||(w[0]=k=>c("update:modelValue",!1))},{default:t(()=>[_(o(p.$t("cancel")),1)]),_:1}),a(e(N),{variant:"destructive",loading:f.value,onClick:h},{default:t(()=>[_(o(p.$t("auth.revoke")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["open"]))}}),cs={class:"space-y-6 p-6"},ms={class:"flex items-center justify-between gap-4 flex-wrap"},ps={class:"relative flex-1 min-w-[200px] max-w-[400px]"},fs={key:0,class:"flex flex-col items-center justify-center py-16 text-center"},_s={class:"text-muted-foreground"},vs={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},hs={class:"flex items-center gap-4"},gs={class:"flex-1 min-w-0"},ys={class:"flex items-start justify-between gap-2"},bs={class:"flex-1 min-w-0"},$s={class:"font-semibold text-sm truncate"},ks={class:"text-xs text-muted-foreground truncate"},Ks=D({__name:"UserManagement",setup(d){const{t:m}=X(),r=I([]),l=I(""),c=I(!1),f=I(!1),h=I(!1),p=I(!1),w=I(!1),k=I(!1),V=I(null),B=I([]),S=I(null),C=G(()=>{if(!l.value)return r.value;const U=l.value.toLowerCase();return r.value.filter(P=>{const x=(P.display_name||P.username).toLowerCase(),te=P.username.toLowerCase();return x.includes(U)||te.includes(U)})}),g=U=>!U||!ue.currentUser?!1:U.user_id===ue.currentUser.user_id,F=async()=>{try{r.value=await J.getAllUsers()}catch{T.error(m("auth.users_load_failed"))}},v=U=>{V.value=U,f.value=!0},A=U=>{V.value=U,h.value=!0},s=U=>{V.value=U,p.value=!0},i=async U=>{V.value=U,await n(U.user_id),w.value=!0},n=async U=>{try{B.value=await J.getUserTokens(U)}catch{T.error(m("auth.tokens_load_failed"))}},y=async()=>{V.value&&await n(V.value.user_id)},ae=U=>{S.value=U,k.value=!0},He=async()=>{V.value&&await n(V.value.user_id),S.value=null},Qe=async U=>{try{await J.enableUser(U.user_id)?(await F(),T.success(m("auth.user_enabled"))):T.error(m("auth.user_enable_failed"))}catch{T.error(m("auth.user_enable_failed"))}};return be(()=>{F()}),(U,P)=>(u(),O("div",cs,[$("div",ms,[$("div",ps,[a(e(H),{modelValue:l.value,"onUpdate:modelValue":P[0]||(P[0]=x=>l.value=x),placeholder:U.$t("search"),class:"w-full"},{prepend:t(()=>[a(e(Ue),{size:16,class:"text-muted-foreground"})]),_:1},8,["modelValue","placeholder"])]),a(e(N),{onClick:P[1]||(P[1]=x=>c.value=!0)},{default:t(()=>[a(e(Ie),{size:16}),_(" "+o(U.$t("auth.create_user")),1)]),_:1})]),C.value.length===0?(u(),O("div",fs,[$("p",_s,o(U.$t("no_content")),1)])):(u(),O("div",vs,[(u(!0),O(Y,null,ee(C.value,x=>(u(),b(e(se),{key:x.user_id,class:"cursor-pointer hover:bg-accent/50 transition-colors",onClick:te=>v(x)},{default:t(()=>[a(e(ca),{class:"px-4 py-0"},{default:t(()=>[$("div",hs,[a(e(ra),{class:"size-12 shrink-0"},{default:t(()=>[x.avatar_url?(u(),b(e(ua),{key:0,src:x.avatar_url},null,8,["src"])):z("",!0),a(e(da),{class:"bg-muted"},{default:t(()=>[a(e(ta),{size:24,class:"text-foreground"})]),_:1})]),_:2},1024),$("div",gs,[$("div",ys,[$("div",bs,[$("h3",$s,o(x.display_name||x.username),1),$("p",ks,o(x.username)+" • "+o(U.$t(`auth.${x.role}_role`)),1)]),a(e(ma),null,{default:t(()=>[a(e(pa),{"as-child":""},{default:t(()=>[a(e(N),{variant:"ghost",size:"icon",class:"size-8 shrink-0",onClick:P[2]||(P[2]=K(()=>{},["stop"]))},{default:t(()=>[a(e(sa),{size:16})]),_:1})]),_:1}),a(e(fa),{align:"end"},{default:t(()=>[a(e(le),{onClick:K(te=>v(x),["stop"])},{default:t(()=>[a(e(la),{size:16}),_(" "+o(U.$t("auth.edit_user")),1)]),_:1},8,["onClick"]),a(e(le),{onClick:K(te=>i(x),["stop"])},{default:t(()=>[a(e(ge),{size:16}),_(" "+o(U.$t("auth.manage_tokens")),1)]),_:1},8,["onClick"]),g(x)?z("",!0):(u(),b(e(le),{key:0,onClick:K(te=>x.enabled?A(x):Qe(x),["stop"])},{default:t(()=>[(u(),b(oa(x.enabled?e(na):e(he)),{size:16})),_(" "+o(x.enabled?U.$t("auth.disable_user"):U.$t("auth.enable_user")),1)]),_:2},1032,["onClick"])),g(x)?z("",!0):(u(),b(e(_a),{key:1})),g(x)?z("",!0):(u(),b(e(le),{key:2,class:"text-destructive focus:text-destructive",onClick:K(te=>s(x),["stop"])},{default:t(()=>[a(e(ye),{size:16}),_(" "+o(U.$t("auth.delete_user")),1)]),_:1},8,["onClick"]))]),_:2},1024)]),_:2},1024)]),x.enabled?z("",!0):(u(),b(e(ia),{key:0,variant:"destructive",class:"mt-2"},{default:t(()=>[_(o(U.$t("auth.disabled")),1)]),_:1}))])])]),_:2},1024)]),_:2},1032,["onClick"]))),128))])),a(gt,{modelValue:c.value,"onUpdate:modelValue":P[3]||(P[3]=x=>c.value=x),onCreated:F},null,8,["modelValue"]),a(Bt,{modelValue:f.value,"onUpdate:modelValue":P[4]||(P[4]=x=>f.value=x),user:V.value,onUpdated:F},null,8,["modelValue","user"]),a(Vt,{modelValue:h.value,"onUpdate:modelValue":P[5]||(P[5]=x=>h.value=x),user:V.value,onDisabled:F},null,8,["modelValue","user"]),a(kt,{modelValue:p.value,"onUpdate:modelValue":P[6]||(P[6]=x=>p.value=x),user:V.value,onDeleted:F},null,8,["modelValue","user"]),a(os,{modelValue:w.value,"onUpdate:modelValue":P[7]||(P[7]=x=>w.value=x),user:V.value,tokens:B.value,onRevoke:ae,onTokenCreated:y},null,8,["modelValue","user","tokens"]),a(is,{modelValue:k.value,"onUpdate:modelValue":P[8]||(P[8]=x=>k.value=x),token:S.value,onRevoked:He},null,8,["modelValue","token"])]))}});export{Ks as default};
