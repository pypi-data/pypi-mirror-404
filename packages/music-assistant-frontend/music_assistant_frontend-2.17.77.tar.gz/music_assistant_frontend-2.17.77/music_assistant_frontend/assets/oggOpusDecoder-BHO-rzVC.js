import{g as P}from"./qrcode-Be0W47IT.js";function v(c,p){for(var n=0;n<p.length;n++){const t=p[n];if(typeof t!="string"&&!Array.isArray(t)){for(const e in t)if(e!=="default"&&!(e in c)){const r=Object.getOwnPropertyDescriptor(t,e);r&&Object.defineProperty(c,e,r.get?r:{enumerable:!0,get:()=>t[e]})}}}return Object.freeze(Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}))}var l={exports:{}},g;function B(){return g||(g=1,(function(c,p){var n=function(t,e){if(!e)throw new Error("Module with exports required to initialize a decoder instance");this.isReady=e.isReady,this.isReady||(e.onready=function(){this.isReady=!0,this.onready&&this.onready()}),this.config=Object.assign({decoderSampleRate:48e3,outputBufferSampleRate:48e3,resampleQuality:3},t),this.rawOpus=typeof this.config.rawOpus=="boolean"?this.config.rawOpus:/^audio\/opus\b/i.test(this.config.mimeType),this._opus_decoder_create=e._opus_decoder_create,this._opus_decoder_destroy=e._opus_decoder_destroy,this._opus_decoder_ctl=e._opus_decoder_ctl,this._speex_resampler_process_interleaved_float=e._speex_resampler_process_interleaved_float,this._speex_resampler_init=e._speex_resampler_init,this._speex_resampler_destroy=e._speex_resampler_destroy,this._opus_decode_float=e._opus_decode_float,this._free=e._free,this._malloc=e._malloc,this.HEAPU8=e.HEAPU8,this.HEAP32=e.HEAP32,this.HEAPF32=e.HEAPF32,this.decodedBuffers=[],this.completed=!1,this.config.onInit&&(this.oninit=this.config.onInit),this.config.onComplete&&(this.oncomplete=this.config.onComplete),this.config.numberOfChannels>0&&(this.numberOfChannels=this.config.numberOfChannels,this.init())};n.prototype.decode=function(t,e,r){e=e||this.handleDecoded;var i=new DataView(t.buffer);this.getPageBoundaries(i).map(function(s){var o=i.getUint8(s+5,!0),f=i.getUint32(s+18,!0);if(o&2&&(this.numberOfChannels=i.getUint8(s+37,!0),this.init()),f>1){for(var u=i.getUint8(s+26,!0),h=s+27+u,a=0;a<u;a++){var d=i.getUint8(s+27+a,!0);if(this.decoderBuffer.set(t.subarray(h,h+=d),this.decoderBufferIndex),this.decoderBufferIndex+=d,d<255){var _=this._opus_decode_float(this.decoder,this.decoderBufferPointer,this.decoderBufferIndex,this.decoderOutputPointer,this.decoderOutputMaxLength,0),m=Math.ceil(_*this.config.outputBufferSampleRate/this.config.decoderSampleRate);this.HEAP32[this.decoderOutputLengthPointer>>2]=_,this.HEAP32[this.resampleOutputLengthPointer>>2]=m,this._speex_resampler_process_interleaved_float(this.resampler,this.decoderOutputPointer,this.decoderOutputLengthPointer,this.resampleOutputBufferPointer,this.resampleOutputLengthPointer),e.call(this,this.HEAPF32.subarray(this.resampleOutputBufferPointer>>2,(this.resampleOutputBufferPointer>>2)+m*this.numberOfChannels),r),this.decoderBufferIndex=0}}o&4&&(this.completed=!0,this.oncomplete&&this.oncomplete(r))}},this)},n.prototype.decodeRaw=function(t,e,r){e=e||this.handleDecoded;var i=t.length*t.BYTES_PER_ELEMENT;if(i!==0){var s=0;if(typeof this.numberOfChannels>"u"){var o=this.decodeHeader(t,this.config.readTags);if(this.init(),o>0){if(o>=i)return;s+=o}}for(;s<i;){var f=Math.min(i-s,this.decoderBufferMaxLength);this.decoderBuffer.set(t.subarray(s,s+=f),this.decoderBufferIndex),this.decoderBufferIndex+=f;var u=this._opus_decode_float(this.decoder,this.decoderBufferPointer,t.length,this.decoderOutputPointer,this.decoderOutputMaxLength,0),h;if(this.resampler){var a=Math.ceil(u*this.config.outputBufferSampleRate/this.config.decoderSampleRate);this.HEAP32[this.decoderOutputLengthPointer>>2]=u,this.HEAP32[this.resampleOutputLengthPointer>>2]=a,this._speex_resampler_process_interleaved_float(this.resampler,this.decoderOutputPointer,this.decoderOutputLengthPointer,this.resampleOutputBufferPointer,this.resampleOutputLengthPointer),h=this.HEAPF32.subarray(this.resampleOutputBufferPointer>>2,(this.resampleOutputBufferPointer>>2)+a*this.numberOfChannels)}else h=this.HEAPF32.subarray(this.decoderOutputPointer>>2,(this.decoderOutputPointer>>2)+u*this.numberOfChannels);e.call(this,h,r),this.decoderBufferIndex=0}this.oncomplete&&this.oncomplete(r)}},n.prototype.handleDecoded=function(t){this.decodedBuffers.push(t)},n.prototype.decodeHeader=function(t,e){var r=!1,i=new DataView(t.buffer);if(r=r||i.getUint32(0,!0)!==1937076303,r=r||i.getUint32(4,!0)!==1684104520,r=r||i.getUint8(8)!==1,r)return!1;if(this.numberOfChannels=i.getUint8(9),r=r||!isFinite(this.numberOfChannels)||this.numberOfChannels<0||this.numberOfChannels>2,r)return this.numberOfChannels=void 0,!1;var s=i.getUint32(12,!0);if(r=r||!isFinite(s)||s<0||!this.config,r)return!1;this.config.decoderSampleRate=s;var o=19,f=i.getUint8(18);if(f>0){var u=i.getUint8(19);o+=2+u*8}var h=t.length*t.BYTES_PER_ELEMENT;if(h>o)for(var a;(a=this.decodeTags(t,o,e))&&(o+=a,!(o>=h)););return o},n.prototype.decodeTags=function(t,e,r){e=e||0;var i=!1,s=r?{vendor:null,userComments:[]}:null,o=new DataView(t.buffer,e);if(i=i||o.getUint32(0,!0)!==1937076303,i=i||o.getUint32(4,!0)!==1936154964,i)return!1;var f=o.getUint32(8,!0);s&&(s.vendor=new Uint8Array(o,12,f));var u=o.getUint32(12+f,!0),h=16+f;if(u>0)for(var a,d=0;d<u;++d)a=o.getUint32(h,!0),s&&s.userComments.push(new Uint8Array(o,h+4,a)),h+=4+a;return s&&(this.tags?this.tags.push(s):this.tags=[s]),h},n.prototype.getPageBoundaries=function(t){for(var e=[],r=0;r<t.byteLength-32;r++)t.getUint32(r,!0)==1399285583&&e.push(r);return e},n.prototype.getPitch=function(){return this.getOpusControl(4033)},n.prototype.getOpusControl=function(t){var e=this._malloc(4);this._opus_decoder_ctl(this.decoder,t,e);var r=this.HEAP32[e>>2];return this._free(e),r},n.prototype.init=function(){this.initCodec(),this.initResampler(),this.oninit&&this.oninit()},n.prototype.initCodec=function(){this.destroyDecoder();var t=this._malloc(4);this.decoder=this._opus_decoder_create(this.config.decoderSampleRate,this.numberOfChannels,t),this._free(t),this.decoderBufferMaxLength=4e3,this.decoderBufferPointer=this._malloc(this.decoderBufferMaxLength),this.decoderBuffer=this.HEAPU8.subarray(this.decoderBufferPointer,this.decoderBufferPointer+this.decoderBufferMaxLength),this.decoderBufferIndex=0,this.decoderOutputLengthPointer=this._malloc(4),this.decoderOutputMaxLength=this.config.decoderSampleRate*this.numberOfChannels*120/1e3,this.decoderOutputPointer=this._malloc(this.decoderOutputMaxLength*4)},n.prototype.initResampler=function(){if(this.destroyResampler(),this.config.decoderSampleRate===this.config.outputBufferSampleRate){this.resampler=null;return}var t=this._malloc(4);this.resampler=this._speex_resampler_init(this.numberOfChannels,this.config.decoderSampleRate,this.config.outputBufferSampleRate,this.config.resampleQuality,t),this._free(t),this.resampleOutputLengthPointer=this._malloc(4),this.resampleOutputMaxLength=Math.ceil(this.decoderOutputMaxLength*this.config.outputBufferSampleRate/this.config.decoderSampleRate),this.resampleOutputBufferPointer=this._malloc(this.resampleOutputMaxLength*4)},n.prototype.destroyDecoder=function(){this.decoder&&(this._opus_decoder_destroy(this.decoder),this._free(this.decoderBufferPointer),this._free(this.decoderOutputLengthPointer),this._free(this.decoderOutputPointer))},n.prototype.destroyResampler=function(){this.resampler&&(this._speex_resampler_destroy(this.resampler),this._free(this.resampleOutputLengthPointer),this._free(this.resampleOutputBufferPointer))},n.prototype.destroy=function(){this.destroyDecoder(),this.decoderBuffer=null,this.destroyResampler(),this.decodedBuffers=null},p.OggOpusDecoder=n})(l,l.exports)),l.exports}var O=B();const y=P(O),b=v({__proto__:null,default:y},[O]);export{b as o};
