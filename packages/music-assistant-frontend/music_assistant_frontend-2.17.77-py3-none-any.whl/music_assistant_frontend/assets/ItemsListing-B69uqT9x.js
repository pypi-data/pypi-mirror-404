import{C as ot}from"./Container-jslOpOlM.js";import{c as nt}from"./utils-CDN07tui.js";import{d as X,b,e as l,ad as R,u as m,H as v,f as D,D as d,A as ke,O as U,E as u,I as f,c as Q,$ as g,a1 as y,aR as ut,g as rt,n as ct,m as mt,r as F,a0 as ye,w as q,o as dt,j as Pe,h as ft,F as G,M as _}from"./lucide-xmSP9hQT.js";import{_ as te,d as se,j as ee,M as T,k as vt,S as oe,T as yt,B as ht,U as Oe,H as xe,J as Re,V as we,W as Me,X as N,s as w,Y as bt,e as $e,E as Z,D as he,i as pt,C as ae,P as Y,Z as kt}from"./index-tCThBqvp.js";import{T as wt}from"./Toolbar-BiXTdBsZ.js";import{u as gt}from"./userPreferences-Crk2VjHn.js";import{u as At}from"./vue-router-DmMABOGf.js";import{M as Ve}from"./Button-CA4MzAsM.js";import{L as It}from"./ListItem-C1_07nLV.js";import{_ as be}from"./NowPlayingBadge.vue_vue_type_style_index_0_lang-B7dDGePA.js";import{b as Ee,M as Ye}from"./MediaItemThumb-U9Re77C7.js";import{_ as Ue}from"./ProviderIcon.vue_vue_type_style_index_0_lang-B2vlszLW.js";import{C as Bt,$ as pe,d as x,n as ne,a1 as Ne,a2 as M,R as Ke,U as St,a as Tt,L as Ct,W as Ft,X as J,c as Pt,Y as $t,Z as Lt,e as Dt,m as Ot,j as ie,H as xt,I as Rt,s as Le,a3 as Mt,k as le}from"./vuetify-GaNxHxlC.js";import{u as ze}from"./vue-i18n-CJw2bq39.js";import{P as Vt}from"./PanelviewItemCompact-DRLNd_E_.js";const K=X({__name:"Skeleton",props:{class:{}},setup(e){const i=e;return(A,k)=>(l(),b("div",{"data-slot":"skeleton",class:R(m(nt)("animate-pulse rounded-md bg-accent",i.class))},null,2))}}),Et={class:"listview-item-skeleton"},Yt={class:"skeleton-content"},Ut=X({__name:"ListViewSkeleton",setup(e){return(i,A)=>(l(),b("div",Et,[v(m(K),{class:"skeleton-thumbnail"}),D("div",Yt,[v(m(K),{class:"skeleton-title"}),v(m(K),{class:"skeleton-subtitle"})]),v(m(K),{class:"skeleton-duration"})]))}}),Nt=te(Ut,[["__scopeId","data-v-b8be0a9f"]]),Kt={class:"panelview-item-skeleton"},zt={class:"skeleton-info"},Ht={class:"skeleton-actions"},Xt=X({__name:"PanelViewSkeleton",setup(e){return(i,A)=>(l(),b("div",Kt,[v(m(K),{class:"skeleton-image"}),D("div",zt,[v(m(K),{class:"skeleton-title"}),v(m(K),{class:"skeleton-artist"})]),D("div",Ht,[v(m(K),{class:"skeleton-icon"})])]))}}),De=te(Xt,[["__scopeId","data-v-fbebf64d"]]),He=X({__name:"FavoriteButton",props:{item:{}},setup(e){const i=e;return(A,k)=>(l(),d(Ve,ke(i,{variant:"icon",icon:e.item?.favorite?"mdi-heart":"mdi-heart-outline",title:A.$t("tooltip.favorite"),onClick:[k[0]||(k[0]=z=>m(se).toggleFavorite(e.item)),k[1]||(k[1]=U(()=>{},["prevent"])),k[2]||(k[2]=U(()=>{},["stop"]))]}),null,16,["icon","title"]))}}),jt={key:0,class:"media-thumb listitem-media-thumb"},Wt={key:1,class:"media-thumb listitem-media-thumb"},qt={key:0},Gt={key:0},Zt={key:0,class:"ma-line-clamp-1"},Jt={key:1},Qt={key:0},_t={key:1},ea={key:2},ta={key:3},aa={key:4},ia={key:5},la={key:6},sa={key:7},oa={key:5},na={key:6},ua={class:"text-caption",style:{"padding-right":"10px","padding-left":"10px"}},ra=X({__name:"ListviewItem",props:{item:{},showTrackNumber:{type:Boolean,default:!0},showDiscNumber:{type:Boolean,default:!0},showPosition:{type:Boolean,default:!0},showProvider:{type:Boolean,default:!0},showAlbum:{type:Boolean,default:!0},showMenu:{type:Boolean,default:!0},showFavorite:{type:Boolean,default:!1},showDuration:{type:Boolean,default:!0},isSelected:{type:Boolean},isDisabled:{type:Boolean,default:!1},isAvailable:{type:Boolean,default:!0},isPlaying:{type:Boolean},showCheckboxes:{type:Boolean,default:!1},showDetails:{type:Boolean},showPlayButton:{type:Boolean,default:void 0},parentItem:{default:void 0}},emits:["select"],setup(e,{emit:i}){const{t:A}=ze(),k=e,z=Q(()=>{if(!("provider_mappings"in k.item))return"";for(const p of k.item.provider_mappings)if(p.audio_format&&p.audio_format.content_type!=null&&[N.DSF,N.FLAC,N.AIFF,N.WAV].includes(p.audio_format.content_type)&&(p.audio_format.sample_rate>48e3||p.audio_format.bit_depth>16))return`${p.audio_format.sample_rate/1e3}kHz ${p.audio_format.bit_depth} bits`;return""}),C=i,s=function(p){const c=p;we(k.item,c.clientX,c.clientY,k.parentItem)},I=function(p){if(k.showCheckboxes)return;const c=p;Me(k.item,c.clientX,c.clientY,k.parentItem)},h=function(p){k.showCheckboxes||Re(k.item,p.clientX,p.clientY,k.parentItem)};return(p,c)=>(l(),d(It,{link:"","show-menu-btn":e.showMenu,class:R({unavailable:!e.isAvailable}),onClick:U(I,["stop"]),onMenu:U(s,["stop"])},{prepend:u(()=>[e.showCheckboxes?(l(),b("div",jt,[v(Ke,{"model-value":e.isSelected,onClick:c[0]||(c[0]=U(()=>{},["stop"])),"onUpdate:modelValue":c[1]||(c[1]=S=>{S!=null&&C("select",e.item,S)})},null,8,["model-value"])])):(l(),b("div",Wt,[v(Ye,{size:"50",item:e.isAvailable?e.item:void 0},null,8,["item"])]))]),title:u(()=>[e.item.media_type==m(T).FOLDER?(l(),b("span",qt,[D("span",null,y(m(Oe)(e.item,m(A))),1)])):(l(),b("span",{key:1,class:R({"is-playing":e.isPlaying})},[g(y(e.item.name)+" ",1),"version"in e.item&&e.item.version?(l(),b("span",Gt,"("+y(e.item.version)+")",1)):f("",!0)],2)),e.item&&e.item.metadata?(l(),d(m(pe),{key:2,location:"bottom"},{activator:u(({props:S})=>[m(xe)(e.item.metadata.explicit||!1)?(l(),d(x,ke({key:0},S,{icon:"mdi-alpha-e-box",width:"35"}),null,16)):f("",!0)]),default:u(()=>[D("span",null,y(p.$t("tooltip.explicit")),1)]),_:1})):f("",!0)]),subtitle:u(()=>[e.item.media_type==m(T).TRACK&&"provider_mappings"in e.item?(l(),b("div",Zt,[v(Ne,null,{default:u(()=>["artists"in e.item?(l(),d(M,{key:0},{default:u(()=>[g(y(m(oe)(e.item.artists,2)),1)]),_:1})):f("",!0),e.showAlbum&&"album"in e.item&&e.item.album?(l(),d(M,{key:1},{default:u(()=>[g(" • "+y(e.item.album.name),1)]),_:1})):f("",!0),e.showDiscNumber&&"disc_number"in e.item&&e.item.disc_number?(l(),d(M,{key:2},{default:u(()=>[v(x,{style:{"margin-left":"5px"},icon:"md:album"}),g(" "+y(e.item.disc_number),1)]),_:1})):f("",!0),e.showTrackNumber&&"track_number"in e.item&&e.item.track_number?(l(),d(M,{key:3},{default:u(()=>[v(x,{style:{"margin-left":"5px"},icon:"mdi-music-circle-outline"}),g(" "+y(e.item.track_number),1)]),_:1})):e.showPosition&&"position"in e.item&&e.item.position?(l(),d(M,{key:4},{default:u(()=>[v(x,{style:{"margin-left":"5px"},icon:"mdi-music-circle-outline"}),g(" "+y(e.item.position),1)]),_:1})):f("",!0)]),_:1})])):e.item.media_type==m(T).ALBUM&&"year"in e.item?(l(),b("div",Jt,[e.item.album_type!=m(yt).UNKNOWN?(l(),b("span",Qt,y(p.$t("album_type."+e.item.album_type))+" • ",1)):f("",!0),D("span",null,y(m(oe)(e.item.artists)),1),e.item.year?(l(),b("span",_t," • "+y(e.item.year),1)):f("",!0)])):"artists"in e.item&&e.item.artists?(l(),b("div",ea,y(m(oe)(e.item.artists)),1)):"owner"in e.item&&e.item.owner?(l(),b("div",ta,y(e.item.owner),1)):"authors"in e.item&&e.item.authors?(l(),b("div",aa,y(e.item.authors.join(" / ")),1)):"publisher"in e.item&&e.item.publisher?(l(),b("div",ia,y(e.item.publisher),1)):"metadata"in e.item&&e.item.metadata?.description&&[m(T).RADIO,m(T).PLAYLIST,m(T).FOLDER].includes(e.item.media_type)?(l(),b("div",la,y(m(ht)(e.item.metadata.description,150)),1)):"media_type"in e.item&&!e.item.provider_mappings?(l(),b("div",sa,y(p.$t(e.item.media_type)),1)):f("",!0)]),append:u(()=>[e.isPlaying?(l(),d(be,{key:0,"show-badge":m(ee)("bp7")},null,8,["show-badge"])):f("",!0),z.value?(l(),d(Bt,{key:1,src:m(Ee),width:"30",class:R(p.$vuetify.theme.current.dark?"hiresicondark":"hiresicon")},{default:u(()=>[v(m(pe),{activator:"parent",location:"bottom"},{default:u(()=>[g(y(z.value),1)]),_:1})]),_:1},8,["src","class"])):f("",!0),m(ee)("bp2")&&e.showProvider?(l(),d(Ue,{key:2,domain:e.item.media_type==m(T).PLAYLIST?e.item.provider_mappings[0].provider_domain:e.item.provider,size:24},null,8,["domain"])):f("",!0),"fully_played"in e.item&&e.item.fully_played?(l(),d(x,{key:3,title:p.$t("item_fully_played")},{default:u(()=>[...c[2]||(c[2]=[g("mdi-check",-1)])]),_:1},8,["title"])):"resume_position_ms"in e.item&&e.item.resume_position_ms?(l(),d(x,{key:4,title:p.$t("item_in_progress")},{default:u(()=>[...c[3]||(c[3]=[g("mdi-clock-fast",-1)])]),_:1},8,["title"])):f("",!0),m(ee)("bp3")&&"favorite"in e.item&&e.showFavorite&&!p.$vuetify.display.mobile?(l(),b("div",oa,[v(He,{item:e.item},null,8,["item"])])):f("",!0),e.showDuration&&"duration"in e.item&&e.item.duration&&m(ee)("bp0")?(l(),b("div",na,[D("div",null,[D("span",ua,y(m(vt)(e.item.duration)),1)])])):f("",!0),e.item.is_playable&&(e.showPlayButton??!p.$vuetify.display.mobile)?(l(),d(ne,{key:7,icon:"",variant:"text",size:"small",onClick:U(h,["stop"])},{default:u(()=>[v(x,{size:"24"},{default:u(()=>[...c[4]||(c[4]=[g("mdi-play-circle-outline",-1)])]),_:1})]),_:1})):f("",!0)]),_:1},8,["show-menu-btn","class"]))}}),ca=te(ra,[["__scopeId","data-v-4ca4d718"]]),ma={class:"thumb-container"},da={key:0,class:"provider-icon-overlay"},fa={key:0},va=["src"],ya={key:0},ha=X({__name:"PanelviewItem",props:{item:{},size:{default:200},isSelected:{type:Boolean},showCheckboxes:{type:Boolean,default:!1},showMediaType:{type:Boolean,default:!1},showActions:{type:Boolean,default:!1},showTrackNumber:{type:Boolean,default:!1},isAvailable:{type:Boolean,default:!0},isPlaying:{type:Boolean},parentItem:{default:void 0}},emits:["select"],setup(e,{emit:i}){const A=e,k=Q(()=>{for(const h of A.item.provider_mappings)if(h.audio_format&&h.audio_format.content_type!=null&&[N.DSF,N.FLAC,N.AIFF,N.WAV].includes(h.audio_format.content_type)&&(h.audio_format.sample_rate>48e3||h.audio_format.bit_depth>16))return`${h.audio_format.sample_rate/1e3}kHz ${h.audio_format.bit_depth} bits`;return""}),z=i,C=function(h){if(A.showCheckboxes)return;const p="clientX"in h?h.clientX:h.touches[0].clientX,c="clientY"in h?h.clientY:h.touches[0].clientY;we(A.item,p,c,A.parentItem)},s=function(h){if(A.showCheckboxes){z("select",A.item,!A.isSelected);return}Me(A.item,h.clientX,h.clientY,A.parentItem)},I=function(h){A.showCheckboxes||Re(A.item,h.clientX,h.clientY,A.parentItem)};return(h,p)=>{const c=ut("hold");return l(),d(St,null,{default:u(({isHovering:S,props:B})=>[rt((l(),d(Tt,ke(B,{tile:"",hover:"",class:["panel-item",{unavailable:!e.isAvailable}],onClick:s,onContextmenu:U(C,["right","prevent"])}),{default:u(()=>[e.showCheckboxes?(l(),d(Ct,{key:0,"model-value":e.showCheckboxes,contained:"",scrim:e.isSelected?h.$vuetify.theme.current.dark?"rgba(0,0,0,.75)":"rgba(255,255,255,.75)":"#ffffff00"},{default:u(()=>[v(Ke,{class:"panel-item-checkbox",ripple:!1,"model-value":e.isSelected},null,8,["model-value"])]),_:1},8,["model-value","scrim"])):f("",!0),D("div",ma,[v(Ye,{item:e.isAvailable?e.item:void 0,style:{height:"auto"}},null,8,["item"]),e.item.media_type===m(T).PLAYLIST&&"provider_mappings"in e.item?(l(),b("div",da,[v(Ue,{domain:e.item.provider_mappings[0].provider_domain,size:20},null,8,["domain"])])):f("",!0)]),v(Pt,{variant:"text",slim:"",tile:"",density:"compact",class:"panel-item-details"},{default:u(()=>[v(Ft,null,{default:u(()=>[e.item.media_type==m(T).FOLDER?(l(),b("span",fa,[D("span",null,y(m(Oe)(e.item,h.$t)),1)])):(l(),b("span",{key:1,class:R({"is-playing":e.isPlaying})},y(e.item.name),3)),"version"in e.item&&e.item.version?(l(),b("span",{key:2,class:R({"is-playing":e.isPlaying})}," - "+y(e.item.version),3)):f("",!0)]),_:1}),"artists"in e.item&&e.item.artists?(l(),d(J,{key:0,class:"ma-line-clamp-1"},{default:u(()=>[g(y(m(oe)(e.item.artists,1)),1)]),_:1})):f("",!0),"authors"in e.item&&e.item.authors?(l(),d(J,{key:1,class:"ma-line-clamp-1"},{default:u(()=>[g(y(e.item.authors.join(" / ")),1)]),_:1})):"publisher"in e.item&&e.item.publisher?(l(),d(J,{key:2,class:"ma-line-clamp-1"},{default:u(()=>[g(y(e.item.publisher),1)]),_:1})):"owner"in e.item&&e.item.owner?(l(),d(J,{key:3,class:"ma-line-clamp-1"},{default:u(()=>[g(y(e.item.owner),1)]),_:1})):e.showMediaType?(l(),d(J,{key:4,class:"ma-line-clamp-1"},{default:u(()=>[g(y(h.$t(e.item.media_type)),1)]),_:1})):(l(),d(J,{key:5,class:"ma-line-clamp-1"}))]),_:1}),e.isPlaying&&!e.showActions?(l(),d(be,{key:1,"icon-style":"position: absolute; right: 5px; bottom: 5px","show-badge":!1})):f("",!0),(S||m(w).isTouchscreen)&&e.isAvailable&&e.item.is_playable?(l(),d(ne,{key:2,icon:"mdi-play",color:"primary",fab:"",style:ct(`position: absolute; right: 15px; bottom: ${e.showActions?90:35}px; opacity: 0.8`),onClick:U(I,["stop"])},null,8,["style"])):f("",!0),e.showActions?(l(),d($t,{key:3,class:"panel-item-actions"},{default:u(()=>[v(Ne,{style:{padding:"0"}},{default:u(()=>[m(xe)(e.item.metadata.explicit||!1)?(l(),d(M,{key:0},{default:u(()=>[v(x,{size:"30",icon:"mdi-alpha-e-box"})]),_:1})):f("",!0),k.value?(l(),d(M,{key:1},{default:u(()=>[v(x,{class:R(h.$vuetify.theme.current.dark?"hiresicon":"hiresiconinverted")},{default:u(()=>[D("img",{src:m(Ee),width:"30"},null,8,va),v(pe,{activator:"parent",location:"bottom"},{default:u(()=>[g(y(k.value),1)]),_:1})]),_:1},8,["class"])]),_:1})):f("",!0),e.showTrackNumber&&"track_number"in e.item&&e.item.track_number?(l(),d(M,{key:2},{default:u(()=>[v(x,{size:"small",icon:"mdi-music-circle-outline"}),e.item.disc_number?(l(),b("span",ya,y(e.item.disc_number)+"/",1)):f("",!0),g(y(e.item.track_number),1)]),_:1})):"position"in e.item&&e.item.position?(l(),d(M,{key:3},{default:u(()=>[v(x,{size:"small",icon:"mdi-music-circle-outline"}),g(" "+y(e.item.position),1)]),_:1})):f("",!0),m(ee)("bp3")?(l(),d(M,{key:4},{default:u(()=>[v(He,{item:e.item},null,8,["item"])]),_:1})):f("",!0)]),_:1}),e.isPlaying?(l(),d(be,{key:0,"show-badge":!1})):f("",!0),v(Lt),S||h.$vuetify.display.mobile?(l(),d(Ve,{key:1,variant:"list",icon:"mdi-dots-vertical",style:{"padding-right":"0","margin-right":"-5px"},onClick:U(C,["stop"])})):f("",!0)]),_:2},1024)):f("",!0)]),_:2},1040,["class"])),[[c,C]])]),_:1})}}}),ba=te(ha,[["__scopeId","data-v-545bcab0"]]),pa={key:0},ka={key:0},wa={key:2},ga=X({__name:"ItemsListing",props:{itemtype:{},sortKeys:{default:()=>["name","sort_name"]},showTrackNumber:{type:Boolean,default:!0},showProvider:{type:Boolean,default:Object.keys(se.providers).length>1},showAlbum:{type:Boolean,default:!0},showFavoritesOnlyFilter:{type:Boolean,default:!0},showDuration:{type:Boolean,default:!0},parentItem:{default:void 0},showAlbumArtistsOnlyFilter:{type:Boolean},showSearchButton:{type:Boolean,default:void 0},showRefreshButton:{type:Boolean,default:void 0},showSelectButton:{type:Boolean,default:void 0},showAlbumTypeFilter:{type:Boolean,default:void 0},showProviderFilter:{type:Boolean,default:void 0},updateAvailable:{type:Boolean},title:{default:void 0},hideOnEmpty:{type:Boolean,default:!1},showLibraryOnlyFilter:{type:Boolean,default:!1},allowCollapse:{type:Boolean,default:!1},allowKeyHooks:{type:Boolean,default:!1},extraMenuItems:{default:void 0},loadPagedData:{type:Function,default:void 0},loadItems:{type:Function,default:void 0},limit:{default:50},total:{default:void 0},infiniteScroll:{type:Boolean,default:!0},path:{default:void 0},icon:{default:void 0},restoreState:{type:Boolean,default:!1},onTitleClick:{type:Function,default:void 0},refreshOnParentUpdate:{type:Boolean,default:!1}},setup(e){const i=e,A=At(),{t:k}=ze(),{getItemsListingPreferences:z,setItemsListingPreference:C}=gt(),s=F({offset:0,limit:50,sortBy:"name",search:"",libraryOnly:!1}),I=F("list"),h=F(!1),p=F(!1),c=F([]),S=F([]),B=F(!1),$=F([]),j=F(!1),O=F(!1),H=F(!0),V=F(!1),W=F(!1),ue=F(!1),ge=function(){s.value.search="",h.value=!1},re=function(){Pe(()=>{document.getElementById("searchInput")?.focus()})},Xe=function(){h.value?ge():(h.value=!0,re())},ce=function(){if(i.onTitleClick){i.onTitleClick();return}H.value=!H.value,C(i.path||i.itemtype,i.itemtype,"expand",H.value)},me=function(t){I.value=t,C(i.path||i.itemtype,i.itemtype,"viewMode",t)},je=function(){s.value.favoritesOnly=!s.value.favoritesOnly,C(i.path||i.itemtype,i.itemtype,"favoriteFilter",s.value.favoritesOnly),P(void 0,void 0,!0)},We=function(){s.value.libraryOnly=!s.value.libraryOnly,C(i.path||i.itemtype,i.itemtype,"libraryFilter",s.value.libraryOnly),P(!0,void 0,!0)},qe=function(){s.value.albumArtistsFilter=!s.value.albumArtistsFilter,C(i.path||i.itemtype,i.itemtype,"albumArtistsFilter",s.value.albumArtistsFilter),P(void 0,void 0,!0)},de=function(t){return $.value.includes(t)},fe=function(t,o){if(w.activePlayer?.playback_state!=pt.PLAYING)return!1;const a=w.curQueueItem?.media_item;if(!a)return!1;switch(o){case"tracks":return t.item_id===a.item_id;case"albums":return!("album"in a)||!a.album?!1:t.item_id===a.album.item_id;case"artists":return!("artists"in a)||!a.artists?!1:Array.isArray(a.artists)&&a.artists.some(n=>n&&n.item_id===t.item_id);case"radios":return t.item_id===a.item_id;case"podcasts":return!("podcast"in a)||!a.podcast?!1:t.item_id===a.podcast.item_id;case"podcastepisodes":return t.item_id===a.item_id;default:return!1}},ve=function(t,o){if(o)$.value.includes(t)||$.value.push(t);else for(let a=0;a<$.value.length;a++)$.value[a]===t&&$.value.splice(a,1)},Ge=function(){O.value&&($.value=[]),O.value=!O.value},Ze=function(){P(!0,!0)},Je=function(){s.value.search="",h.value=!1,P(void 0,void 0,!0)},Qe=function(t){t!==void 0&&(s.value.sortBy=t),C(i.path||i.itemtype,i.itemtype,"sortBy",s.value.sortBy),P(void 0,void 0,!0)},_e=function(t){s.value.albumType?.includes(t)?s.value.albumType=s.value.albumType?.filter(o=>o!==t):(s.value.albumType=s.value.albumType||[],s.value.albumType.push(t)),C(i.path||i.itemtype,i.itemtype,"albumType",s.value.albumType),P(void 0,void 0,!0)},et=function(t){s.value.provider?.includes(t)?s.value.provider=s.value.provider?.filter(o=>o!==t):(s.value.provider=s.value.provider||[],s.value.provider.push(t)),s.value.provider.length===0&&(s.value.provider=void 0),C(i.path||i.itemtype,i.itemtype,"providerFilter",s.value.provider),P(!0,void 0,!0)},tt=function(){w.globalSearchTerm=s.value.search,i.itemtype=="artists"?w.globalSearchType=T.ARTIST:i.itemtype=="albums"?w.globalSearchType=T.ALBUM:i.itemtype=="tracks"?w.globalSearchType=T.TRACK:i.itemtype=="playlists"?w.globalSearchType=T.PLAYLIST:i.itemtype=="audiobooks"?w.globalSearchType=T.AUDIOBOOK:i.itemtype=="podcasts"?w.globalSearchType=T.PODCAST:i.itemtype=="radios"&&(w.globalSearchType=T.RADIO),A.push({name:"search"})},Ae=async function({done:t}){if(V.value){t("empty");return}await P(void 0,void 0,void 0,s.value.offset+i.limit),t("ok")},at=async function(){for(;!V.value;)await Ae({done:function(){}})},Ie=Q(()=>{var t=!1;return s.value.search&&s.value.search.length!==0&&(t=!0),t}),Be=Q(()=>h.value&&H.value),Se=Q(()=>{const o={artists:Y.LIBRARY_ARTISTS,albums:Y.LIBRARY_ALBUMS,tracks:Y.LIBRARY_TRACKS,artisttracks:[Y.ARTIST_TOPTRACKS,Y.LIBRARY_TRACKS],playlists:Y.LIBRARY_PLAYLISTS,radios:Y.LIBRARY_RADIOS,podcasts:Y.LIBRARY_PODCASTS,audiobooks:Y.LIBRARY_AUDIOBOOKS}[i.itemtype];return Object.values(se.providers).filter(a=>a.type!==kt.MUSIC||w.currentUser&&w.currentUser.provider_filter.length&&!w.currentUser.provider_filter.includes(a.instance_id)?!1:o?(Array.isArray(o)?o:[o]).some(r=>a.supported_features.includes(r)):!0).map(a=>({label:a.name,value:a.instance_id})).sort((a,n)=>a.label.localeCompare(n.label))});mt(()=>{Be.value||(p.value=!1)});const it=Q(()=>{if(i.allowCollapse===!0&&!H.value)return[{label:"tooltip.collapse_expand",icon:"mdi-chevron-down",action:ce,overflowAllowed:!1}];const t=[];return i.showSelectButton!==!1&&(O.value&&t.push({label:"tooltip.select_all",icon:"mdi-select-all",action:Fe,overflowAllowed:!0}),t.push({label:"tooltip.select_items",icon:O.value?"mdi-checkbox-multiple-outline":"mdi-checkbox-multiple-blank-outline",action:Ge,active:O.value,overflowAllowed:!0})),i.showLibraryOnlyFilter===!0&&t.push({label:"tooltip.filter_library",icon:"mdi-bookshelf",action:We,active:s.value.libraryOnly,overflowAllowed:!0}),i.showFavoritesOnlyFilter===!0&&t.push({label:"tooltip.filter_favorites",icon:s.value.favoritesOnly?"mdi-heart":"mdi-heart-outline",action:je,active:s.value.favoritesOnly,overflowAllowed:!0}),i.showAlbumArtistsOnlyFilter===!0&&t.push({label:"tooltip.album_artist_filter",icon:s.value.albumArtistsFilter?"mdi-account-music":"mdi-account-music-outline",action:qe,active:s.value.albumArtistsFilter,overflowAllowed:!0}),i.showAlbumTypeFilter&&t.push({label:"tooltip.album_type",icon:"mdi-album",disabled:B.value,active:s.value.albumType&&s.value.albumType.length>0,closeOnContentClick:!1,overflowAllowed:!0,subItems:["album","single","ep","compilation","live","soundtrack","unknown"].map(o=>({label:`album_type.${o}`,selected:s.value.albumType?.includes(o),action:()=>{_e(o)}}))}),i.showProviderFilter&&Se.value.length>1&&t.push({label:"tooltip.filter_provider",icon:"mdi-package-variant",disabled:B.value,active:s.value.provider&&s.value.provider.length>0,closeOnContentClick:!1,overflowAllowed:!0,subItems:Se.value.map(o=>({label:o.label,selected:s.value.provider?.includes(o.value),action:()=>{et(o.value)}}))}),(i.showRefreshButton!==!1||j.value&&!i.refreshOnParentUpdate)&&t.push({label:j.value?"tooltip.refresh_new_content":"tooltip.refresh",icon:"mdi-refresh",action:Ze,active:j.value,disabled:B.value}),i.sortKeys?.length&&t.push({label:"tooltip.sort_options",icon:"mdi-sort",disabled:i.sortKeys.length<=1||B.value,overflowAllowed:!0,subItems:i.sortKeys.map(o=>({label:`sort.${o}`,selected:s.value.sortBy==o,action:()=>{Qe(o)}}))}),i.showSearchButton!==!1&&t.push({label:Ie.value?"tooltip.search_filter_active":"tooltip.search",icon:"mdi-magnify",action:Xe,active:Ie.value,disabled:B.value,overflowAllowed:!1}),t.push({label:"tooltip.toggle_view_mode",icon:I.value=="list"?"mdi-view-list":"mdi-grid",overflowAllowed:!0,subItems:[{label:"view.list",icon:"mdi-view-list",selected:I.value=="list",action:()=>{me("list")}},{label:"view.panel",icon:"mdi-grid",selected:I.value=="panel",action:()=>{me("panel")}},{label:"view.panel_compact",icon:"mdi-grid",selected:I.value=="panel_compact",action:()=>{me("panel_compact")}}]}),i.extraMenuItems?.length&&t.push(...i.extraMenuItems),i.allowCollapse===!0&&t.push({label:"tooltip.collapse_expand",icon:"mdi-chevron-up",action:ce}),t}),P=async function(t=!1,o=!1,a=!1,n=0){if(B.value)return;B.value=!0,a&&i.loadPagedData!=null&&(t=!0),(t||o)&&(n=0,V.value&&(ue.value=!0),V.value=!1,W.value=!1,j.value=!1);const r=["artists","albums","tracks","playlists","audiobooks","podcasts","radios"];if((t||!W.value)&&r.includes(i.itemtype)&&await new Promise(E=>setTimeout(E,1e3)),s.value.offset=n,s.value.limit=i.limit,s.value.refresh=o,i.loadPagedData!=null){const E=await i.loadPagedData(s.value);s.value.offset?c.value.push(...E):c.value=E,Math.abs(E.length-i.limit)>10&&(V.value=!0)}else if(i.loadItems!=null){(!W.value||o)&&(S.value=await i.loadItems(s.value),W.value=!0);const E=st(S.value,s.value);s.value.offset?c.value.push(...E):c.value=E,V.value=E.length<i.limit}s.value.refresh=!1,B.value=!1,ue.value=!1},Te=z(i.path||i.itemtype,i.itemtype),lt=async function(){const t=Te.value;t.viewMode?I.value=t.viewMode:i.itemtype=="artists"||i.itemtype=="albums"?I.value="panel":I.value="list",t.sortBy&&i.sortKeys.includes(t.sortBy)?s.value.sortBy=t.sortBy:s.value.sortBy=i.sortKeys[0],i.showFavoritesOnlyFilter!==!1&&t.favoriteFilter&&(s.value.favoritesOnly=t.favoriteFilter),i.showLibraryOnlyFilter!==!1&&t.libraryFilter&&(s.value.libraryOnly=t.libraryFilter),i.showAlbumArtistsOnlyFilter!==!1&&t.albumArtistsFilter!==void 0&&(s.value.albumArtistsFilter=t.albumArtistsFilter),i.allowCollapse!==!1&&t.expand!==void 0&&(H.value=t.expand),i.showAlbumTypeFilter===!0&&t.albumType&&(s.value.albumType=t.albumType),i.showProviderFilter===!0&&t.providerFilter&&(s.value.provider=t.providerFilter),i.restoreState&&t.search&&(s.value.search=t.search)},Ce=function(t){w.dialogActive||B.value||(t.key==="Escape"&&ge(),!p.value&&(t.key==="a"&&(t.ctrlKey||t.metaKey)?(t.preventDefault(),Fe()):!p.value&&t.key=="Backspace"?re():!p.value&&t.key.length==1&&(h.value=!0,re())))};i.allowKeyHooks&&(document.addEventListener("keydown",Ce),ye(()=>{document.removeEventListener("keydown",Ce)})),i.restoreState&&ye(()=>{const t=i.path||i.itemtype,o=document.querySelector("#cont");w.prevState={path:t,scrollPos:o?.scrollTop||0,pagedItems:c.value,allItems:S.value,allItemsReceived:V.value,initialDataReceived:W.value,params:s.value}}),q(()=>s.value.search,t=>{t&&(h.value=!0),P(void 0,void 0,!0),i.restoreState&&C(i.path||i.itemtype,i.itemtype,"search",s.value.search)}),q(()=>i.path,t=>{B.value!=!0&&(c.value=[],S.value=[],P(!0))}),q(()=>i.parentItem,()=>{B.value!=!0&&(console.log("parent item changed",i.refreshOnParentUpdate),i.refreshOnParentUpdate?P(!0):(S.value=[],j.value=!0))},{deep:!0}),q(()=>i.limit,t=>{s.value.limit=t}),q(()=>i.updateAvailable,t=>{B.value||(j.value=t)},{immediate:!0}),q(Te,()=>lt(),{immediate:!0}),dt(async()=>{const t=i.path||i.itemtype;i.restoreState&&w.prevState?.path==t?(s.value=w.prevState.params,c.value=w.prevState.pagedItems,S.value=w.prevState.allItems,V.value=w.prevState.allItemsReceived,W.value=w.prevState.initialDataReceived,Pe(()=>{const a=document.getElementById("cont");a&&bt(a,w.prevState.scrollPos,50)}),B.value=!1):P(!0),$e.on("clearSelection",()=>{$.value=[],O.value=!1});const o=se.subscribe_multi([Z.MEDIA_ITEM_UPDATED,Z.MEDIA_ITEM_DELETED,Z.MEDIA_ITEM_PLAYED],a=>{if(a.event==Z.MEDIA_ITEM_DELETED)c.value=c.value.filter(n=>n.uri!=a.object_id);else if(a.event==Z.MEDIA_ITEM_UPDATED){const n=c.value.findIndex(r=>r.uri==a.object_id);n>=0&&(c.value[n]=a.data)}else if(a.event==Z.MEDIA_ITEM_PLAYED){const n=c.value.findIndex(r=>r.uri==a.object_id);n>=0&&("fully_played"in c.value[n]&&(c.value[n].fully_played=a.data.fully_played),"resume_position_ms"in c.value[n]&&(c.value[n].resume_position_ms=a.data.seconds_played*1e3))}});ye(()=>{$e.off("clearSelection"),o()})});const L=function(t,o=!1){return t?"translation_key"in t&&t.translation_key&&t.name?k(t.translation_key,[t.name]):"translation_key"in t&&t.translation_key?k(t.translation_key):o&&"sort_name"in t&&t.sort_name?t.sort_name:t.name:""},st=function(t,o){let a=[];if(o.search){const n=o.search.toLowerCase();for(const r of t)(r.name.toLowerCase().includes(n)||"album"in r&&r.album?.name.toLowerCase().includes(n)||"artists"in r&&r.artists&&r.artists.length&&r.artists[0].name.toLowerCase().includes(n))&&a.push(r)}else a=[...t];return o.sortBy=="name"&&a.sort((n,r)=>L(n).localeCompare(L(r),void 0,{numeric:!0})),o.sortBy=="sort_name"&&a.sort((n,r)=>L(n,!0).localeCompare(L(r,!0),void 0,{numeric:!0})),o.sortBy=="name_desc"&&a.sort((n,r)=>L(r).localeCompare(L(n),void 0,{numeric:!0})),o.sortBy=="sort_name_desc"&&a.sort((n,r)=>L(r,!0).localeCompare(L(n,!0),void 0,{numeric:!0})),o.sortBy=="album"&&a.sort((n,r)=>L(n.album).localeCompare(L(r.album),void 0,{numeric:!0})),o.sortBy=="artist"&&a.sort((n,r)=>L(n.artists[0]).localeCompare(L(r.artists[0]))),o.sortBy=="track_number"&&(a.sort((n,r)=>(n.track_number||0)-(r.track_number||0)),a.sort((n,r)=>(n.disc_number||0)-(r.disc_number||0))),o.sortBy=="position"&&a.sort((n,r)=>(n.position||0)-(r.position||0)),o.sortBy=="position_desc"&&a.sort((n,r)=>(r.position||0)-(n.position||0)),o.sortBy=="year"&&a.sort((n,r)=>(n.year||0)-(r.year||0)),o.sortBy=="year_desc"&&a.sort((n,r)=>(r.year||0)-(n.year||0)),o.sortBy=="recent"&&a.sort((n,r)=>(r.timestamp_added||0)-(n.timestamp_added||0)),o.sortBy=="duration"&&a.sort((n,r)=>(n.duration||0)-(r.duration||0)),o.sortBy=="duration_desc"&&a.sort((n,r)=>(r.duration||0)-(n.duration||0)),o.sortBy=="provider"&&a.sort((n,r)=>n.provider.localeCompare(r.provider)),o.favoritesOnly&&(a=a.filter(n=>n.favorite)),o.albumType&&o.albumType.length>0&&(a=a.filter(n=>o.albumType?.includes(n.album_type))),a.slice(o.offset,o.offset+o.limit)},Fe=async function(){let t=!0;(i.total||S.value.length)>250&&(t=await new Promise(a=>{confirm(k("select_all_confirmation"))?a(!0):a(!1)})),t&&(await at(),$.value=c.value,O.value=!0)};return(t,o)=>e.hideOnEmpty&&c.value.length==0?f("",!0):(l(),b("section",pa,[v(wt,{icon:e.icon,title:e.title,count:s.value.search?c.value.length:e.total||S.value.length,color:"transparent","menu-items":it.value,onTitleClicked:ce},{title:u(()=>[ft(t.$slots,"title",{},()=>[g(y(e.title),1)],!0)]),_:3},8,["icon","title","count","menu-items"]),v(Dt),Be.value?(l(),d(Ot,{key:0,id:"searchInput",modelValue:s.value.search,"onUpdate:modelValue":o[0]||(o[0]=a=>s.value.search=a),clearable:"","prepend-inner-icon":"mdi-magnify",label:t.$t("search"),"hide-details":"",variant:"filled",style:{width:"auto","margin-top":"10px"},onFocus:o[1]||(o[1]=a=>p.value=!0),onBlur:o[2]||(o[2]=a=>p.value=!1),"onClick:clear":Je},null,8,["modelValue","label"])):f("",!0),H.value?(l(),d(ot,{key:1,variant:I.value=="list"?"default":"panel",style:{overflow:"hidden"}},{default:u(()=>[B.value&&c.value.length===0?(l(),b(G,{key:0},[I.value==="list"?(l(),b("div",ka,[(l(),b(G,null,_(8,a=>v(Nt,{key:"skeleton-list-"+a})),64))])):I.value==="panel"?(l(),d(ie,{key:1},{default:u(()=>[(l(),b(G,null,_(12,a=>v(le,{key:"skeleton-panel-"+a,cols:"12",class:R(`col-${m(ae)(t.$vuetify.display.width)}`)},{default:u(()=>[v(De)]),_:1},8,["class"])),64))]),_:1})):I.value==="panel_compact"?(l(),d(ie,{key:2},{default:u(()=>[(l(),b(G,null,_(12,a=>v(le,{key:"skeleton-compact-"+a,cols:"12",class:R(`col-${m(ae)(t.$vuetify.display.width)}`)},{default:u(()=>[v(De)]),_:1},8,["class"])),64))]),_:1})):f("",!0)],64)):f("",!0),!ue.value&&!(c.value.length==0&&V.value)&&!(B.value&&c.value.length===0)?(l(),d(xt,{key:1,onLoad:Ae,mode:e.infiniteScroll?"intersect":"manual","load-more-text":t.$t("load_more_items"),"empty-text":"",style:{overflow:"hidden"}},{default:u(()=>[I.value=="panel"?(l(),d(ie,{key:0},{default:u(()=>[(l(!0),b(G,null,_(c.value,a=>(l(),d(le,{key:a.uri,cols:"12",class:R(`col-${m(ae)(t.$vuetify.display.width)}`)},{default:u(()=>[v(ba,{item:a,"is-selected":de(a),"show-checkboxes":O.value,"show-actions":["tracks","albums","albumtracks"].includes(e.itemtype),"show-track-number":e.showTrackNumber,"is-available":m(he)(a),"is-playing":fe(a,e.itemtype),"parent-item":e.parentItem,onSelect:ve},null,8,["item","is-selected","show-checkboxes","show-actions","show-track-number","is-available","is-playing","parent-item"])]),_:2},1032,["class"]))),128))]),_:1})):f("",!0),I.value=="panel_compact"?(l(),d(ie,{key:1},{default:u(()=>[(l(!0),b(G,null,_(c.value,a=>(l(),d(le,{key:a.uri,cols:"12",class:R(`col-${m(ae)(t.$vuetify.display.width)}`)},{default:u(()=>[v(Vt,{item:a,"is-selected":de(a),"show-checkboxes":O.value,"is-available":m(he)(a),"is-playing":fe(a,e.itemtype),"parent-item":e.parentItem,onSelect:ve},null,8,["item","is-selected","show-checkboxes","is-available","is-playing","parent-item"])]),_:2},1032,["class"]))),128))]),_:1})):f("",!0),I.value=="list"?(l(),d(Rt,{key:2,"item-height":70,height:"100%",items:c.value,style:{height:"100%",overflow:"hidden"}},{default:u(({item:a})=>[v(ca,{item:a,"show-track-number":e.showTrackNumber,"show-disc-number":e.showTrackNumber,"show-duration":e.showDuration,"show-favorite":e.showFavoritesOnlyFilter,"show-menu":a.is_playable,"show-provider":e.showProvider,"show-album":e.showAlbum,"show-checkboxes":O.value,"is-selected":de(a),"is-available":m(he)(a),"is-playing":fe(a,e.itemtype),"show-details":e.itemtype.includes("versions"),"parent-item":e.parentItem,onSelect:ve},null,8,["item","show-track-number","show-disc-number","show-duration","show-favorite","show-menu","show-provider","show-album","show-checkboxes","is-selected","is-available","is-playing","show-details","parent-item"])]),_:1},8,["items"])):f("",!0)]),_:1},8,["mode","load-more-text"])):f("",!0),!B.value&&c.value.length==0?(l(),b("div",wa,[!B.value&&c.value.length==0&&(s.value.search||s.value.favoritesOnly)?(l(),d(Le,{key:0,title:t.$t("no_content_filter")},{default:u(()=>[s.value.search?(l(),d(ne,{key:0,style:{"margin-top":"15px"},onClick:tt},{default:u(()=>[g(y(t.$t("try_global_search")),1)]),_:1})):f("",!0)]),_:1},8,["title"])):!B.value&&c.value.length==0?(l(),d(Le,{key:1},{default:u(()=>[g(y(t.$t("no_content")),1)]),_:1})):f("",!0)])):f("",!0),v(Mt,{"model-value":$.value.length>1,timeout:-1,style:{"margin-bottom":"120px"}},{actions:u(()=>[v(ne,{color:"primary",variant:"text",onClick:o[3]||(o[3]=a=>m(we)($.value,a.clientX,a.clientY,e.parentItem))},{default:u(()=>[g(y(t.$t("actions")),1)]),_:1})]),default:u(()=>[D("span",null,y(t.$t("items_selected",[$.value.length])),1)]),_:1},8,["model-value"])]),_:1},8,["variant"])):f("",!0)]))}}),Va=te(ga,[["__scopeId","data-v-3e43b898"]]);export{Va as I};
