import{d as ve,D as L,e as f,E as t,H as l,b as de,ad as ue,$ as v,a1 as P,F as fe,M as Ae,O as Be,aS as Ge,aT as Fe,f as Z,c as K,r as U,w as ae,m as je,o as Le,I as H,u as y,j as Ve,a0 as Qe,A as Ke}from"./lucide-xmSP9hQT.js";import{u as Ye}from"./vue-router-DmMABOGf.js";import{e as Xe,_ as Ue,$ as T,ab as k,ac as A,a2 as le,d as te,E as we,o as Ze}from"./index-tCThBqvp.js";import{u as Ce,ab as Je,ac as ie,n as R,r as ee,d as j,a as J,z as el,m as xe,h as Ne,a8 as ge,S as ll,o as ke,j as We,k as $e,a5 as tl,a6 as Se,Z as Pe,A as al,ad as Ee,V as nl,b as sl,W as Oe,c as Me,B as Re,s as rl,q as De,Y as He,p as Ie}from"./vuetify-GaNxHxlC.js";import{u as ul}from"./vue-i18n-CJw2bq39.js";import"./qrcode-Be0W47IT.js";import"./marked-C0Rlrcoy.js";import"./color-BTziYnFN.js";import"./vueuse-CVzU65UW.js";/* empty css            */import"./swiper-3t6jdvul.js";const ol=ve({__name:"DSPPipeline",props:{dsp:{},selected:{}},emits:["onSelect","onAddFilter","onMoveFilter","onDeleteFilter"],setup(Q,{emit:q}){const C=Ce(),$=Q,u=q,I=_=>$.selected===_?"primary":"secondary",m=_=>_==="input"||_==="output"?!1:!$.dsp.filters[_].enabled,x=_=>$.selected===_?"primary":C.global.current.value.dark?"grey-darken-3":"grey-lighten-3",N=_=>({"filter-selected":$.selected===_}),W=_=>{u("onSelect",_)},o=(_,w)=>{u("onMoveFilter",{index:_,direction:w})},b=_=>{u("onDeleteFilter",_)},M=function(_,w){const F=[{label:"settings.dsp.move_up",labelArgs:[],action:()=>{o(w,"up")},disabled:w===0,icon:"mdi-arrow-up"},{label:"settings.dsp.move_down",labelArgs:[],action:()=>{o(w,"down")},disabled:w===$.dsp.filters.length-1,icon:"mdi-arrow-down"},{label:"settings.dsp.delete_filter",labelArgs:[],action:()=>{b(w)},icon:"mdi-delete"}];Xe.emit("contextmenu",{items:F,posX:_.clientX,posY:_.clientY})};return(_,w)=>(f(),L(Je,{density:"compact",side:"end"},{default:t(()=>[l(ie,{"dot-color":I("input"),size:"x-small",onClick:w[0]||(w[0]=F=>W("input"))},{default:t(()=>[l(R,{flat:"",rounded:"pill",color:x("input"),class:ue([N("input"),"dsp-pipeline-card"])},{default:t(()=>[l(ee,{class:"px-3 py-1"},{default:t(()=>[v(P(_.$t("settings.dsp.input")),1)]),_:1})]),_:1},8,["color","class"])]),_:1},8,["dot-color"]),l(ie,{"hide-dot":!0,size:"x-small"}),(f(!0),de(fe,null,Ae(Q.dsp.filters,(F,E)=>(f(),L(ie,{key:E,"dot-color":I(E),size:"x-small","hide-dot":m(E),onClick:oe=>W(E),onContextmenu:Be(oe=>M(oe,E),["prevent"])},{default:t(()=>[l(R,{flat:"",rounded:"pill",color:x(E),class:ue([N(E),"dsp-pipeline-card"])},{default:t(()=>[l(ee,{class:"px-3 py-1"},{default:t(()=>[v(P(_.$t(`settings.dsp.types.${F.type}`)),1)]),_:2},1024)]),_:2},1032,["color","class"])]),_:2},1032,["dot-color","hide-dot","onClick","onContextmenu"]))),128)),l(ie,{"dot-color":"secondary",size:"x-small","hide-dot":!0},{default:t(()=>[l(R,{outlined:"",rounded:"pill",class:"dsp-pipeline-card add-filter-btn",elevation:0,onClick:w[1]||(w[1]=F=>u("onAddFilter"))},{default:t(()=>[l(ee,{class:"py-1 d-flex align-center"},{default:t(()=>[l(j,{size:"small",class:"mr-1"},{default:t(()=>[...w[3]||(w[3]=[v("mdi-plus",-1)])]),_:1}),v(" "+P(_.$t("settings.dsp.filter.add")),1)]),_:1})]),_:1})]),_:1}),l(ie,{"hide-dot":!0,size:"x-small"}),l(ie,{"dot-color":I("output"),size:"x-small",onClick:w[2]||(w[2]=F=>W("output"))},{default:t(()=>[l(R,{flat:"",rounded:"pill",color:x("output"),class:ue([N("output"),"dsp-pipeline-card"])},{default:t(()=>[l(ee,{class:"px-3 py-1"},{default:t(()=>[v(P(_.$t("settings.dsp.output")),1)]),_:1})]),_:1},8,["color","class"])]),_:1},8,["dot-color"])]),_:1}))}}),il=Ue(ol,[["__scopeId","data-v-0e0b8e42"]]),dl={style:{"min-width":"100px"},class:"v-label pl-2"},pl={style:{"min-width":"40px"},class:"pl-2"},Y=ve({__name:"DSPSlider",props:Ge({type:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(Q){const q=Q,C=Fe(Q,"modelValue"),$=U(!1),u=K(()=>q.type==="gain"?{min:-15,max:15,step:.1,label:T("settings.dsp.parameter.gain"),unit:"dB",is_log:!1}:q.type==="q"?{min:.1,max:20,step:.1,label:T("settings.dsp.parameter.q_factor"),unit:"",is_log:!1}:q.type==="frequency"?{min:20,max:2e4,step:1,label:T("settings.dsp.parameter.frequency"),unit:"Hz",is_log:!0}:q.type),I=K({get:()=>$.value?C.value.toString():C.value>1e3?C.value.toFixed(0):C.value>100?C.value.toFixed(1):C.value.toFixed(2),set:o=>{C.value=Number(o)}}),m=K({get:()=>u.value.is_log?Math.log10(C.value):C.value,set:o=>{u.value.is_log?C.value=Math.pow(10,o):C.value=o}}),x=K(()=>u.value.is_log?Math.log10(u.value.max):u.value.max),N=K(()=>u.value.is_log?Math.log10(u.value.min):u.value.min),W=K(()=>u.value.is_log?Math.log10(u.value.step):u.value.step);return(o,b)=>(f(),L(J,{flat:"",color:"transparent"},{default:t(()=>[l(ee,{class:"d-flex align-center gap-4"},{default:t(()=>[Z("span",dl,P(u.value.label),1),l(el,{modelValue:m.value,"onUpdate:modelValue":b[0]||(b[0]=M=>m.value=M),min:N.value,max:x.value,step:W.value,"hide-details":"",class:"flex-grow-1 pr-4",density:"compact",color:"primary"},null,8,["modelValue","min","max","step"]),l(xe,{modelValue:I.value,"onUpdate:modelValue":b[1]||(b[1]=M=>I.value=M),type:"number","hide-details":"",density:"compact",style:{"max-width":"100px"},onFocus:b[2]||(b[2]=M=>$.value=!0),onBlur:b[3]||(b[3]=M=>$.value=!1)},null,8,["modelValue"]),Z("span",pl,P(u.value.unit),1)]),_:1})]),_:1}))}}),ml={class:"d-flex flex-wrap justify-end align-center ga-2 pr-2"},fl={class:"d-flex align-center pl-1"},vl=ve({__name:"DSPParametricEQ",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(Q){const q={PK:k.PEAK,PEQ:k.PEAK,HP:k.HIGH_PASS,HPQ:k.HIGH_PASS,LP:k.LOW_PASS,LPQ:k.LOW_PASS,LS:k.LOW_SHELF,HS:k.HIGH_SHELF,NO:k.NOTCH},C={[k.PEAK]:"PK",[k.HIGH_PASS]:"HP",[k.LOW_PASS]:"LP",[k.LOW_SHELF]:"LS",[k.HIGH_SHELF]:"HS",[k.NOTCH]:"NO"},$=Object.entries(A).map(([a,e])=>({title:T(`settings.dsp.channels.${a}`),value:e})),u=a=>{const e=a.split(`
`),s=[];let V=!1,S={},h=A.ALL;for(const i of e)if(i.startsWith("Channel:")){const p=i.match(/Channel:\s*(.+)/);if(p&&p[1]){const g=p[1].trim().toUpperCase();g==="ALL"||g==="1 2"||g==="L R"?h=A.ALL:g==="L"||g==="1"||g==="FL"?(h=A.FL,V=!0):(g==="R"||g==="2"||g==="FR")&&(h=A.FR,V=!0)}S[h]||(S[h]=0)}else if(i.startsWith("Filter")){const p=i.match(/Filter(?:\s+\d+)?:\s+(ON|OFF)\s+(\w+)\s+(?:Fc\s+)?(\d+\.?\d*)\s*(?:Hz)?\s+(?:Gain\s+)?(-?\d+\.?\d*)\s+dB\s+(?:(?:Q\s+)?(\d+\.?\d*)|(?:BW\s+Oct\s+)(\d+\.?\d*))/);if(p){const[g,z,X,Te,he,be,G]=p;X!=="None"&&s.push({frequency:parseFloat(Te),gain:parseFloat(he),q:parseFloat(be),type:q[X]||k.PEAK,enabled:z==="ON",channel:h})}}else if(i.startsWith("Preamp")){const p=i.match(/Preamp:\s*(-?\d+\.?\d*)\s+dB/);p&&(S[h]=parseFloat(p[1]))}let c;V?c=o.value.bands.filter(i=>!s.some(p=>p.channel===i.channel||p.channel===A.ALL||i.channel===A.ALL)):O.value!==A.ALL?(c=o.value.bands.filter(i=>i.channel!==A.ALL&&i.channel!==O.value),S.ALL&&(S[O.value]=S.ALL,S.ALL=0),s.forEach(i=>{i.channel=O.value})):(c=[],o.value.per_channel_preamp={}),o.value.bands=[...c,...s],Object.keys(S).length>0?(S.ALL&&(o.value.preamp=S.ALL),Object.entries(S).forEach(([i,p])=>{i!==A.ALL&&(o.value.per_channel_preamp[i]=p)})):(o.value.preamp=0,o.value.per_channel_preamp={}),Ve(()=>{B.value=-1})},I=a=>{const e=a.target;if(e.files&&e.files[0]){const s=e.files[0],V=new FileReader;V.onload=S=>{S.target?.result&&u(S.target.result)},V.readAsText(s)}},m=U(null),x=()=>{m.value?.click()},N=()=>{let a="";if(a+=`Preamp: ${pe.value.toFixed(2)} dB
`,ne.value){const S=Object.values(A);for(const h of S){if(h===A.ALL)continue;const c=$.find(p=>p.value===h)?.title||h;a+=`
# ${c}
`,a+=`Channel: ${h===A.FL?"L":"R"}
`,o.value.per_channel_preamp[h]!==void 0&&(a+=`Preamp: ${o.value.per_channel_preamp[h].toFixed(2)} dB
`);let i=1;o.value.bands.forEach(p=>{if(p.channel===h||p.channel===A.ALL){const g=C[p.type];a+=`Filter ${i++}: ${p.enabled?"ON":"OFF"} ${g} Fc ${p.frequency.toFixed(1)} Hz Gain ${p.gain.toFixed(2)} dB Q ${p.q.toFixed(3)}
`}})}}else o.value.bands.forEach((S,h)=>{const c=C[S.type];a+=`Filter ${h+1}: ${S.enabled?"ON":"OFF"} ${c} Fc ${S.frequency.toFixed(1)} Hz Gain ${S.gain.toFixed(2)} dB Q ${S.q.toFixed(3)}
`});const e=new Blob([a],{type:"text/plain"}),s=URL.createObjectURL(e),V=document.createElement("a");V.href=s,V.download=`music_assistant_eq_settings_${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(V),V.click(),document.body.removeChild(V),URL.revokeObjectURL(s)},W=Ce(),o=Fe(Q,"modelValue"),b=U(null),M=U(null),_=Object.values(k).map(a=>({title:T(`settings.dsp.parametric_eq.filter_types.${a}`),value:a})),w=a=>![k.HIGH_PASS,k.LOW_PASS,k.NOTCH].includes(a),F=U({width:0,height:0,min_gain:-20,max_gain:20,min_freq:20,max_freq:2e4,padding_lr:40,padding_tb:20}),E=()=>{if(!b.value||!M.value)return;const a=W.global.current.value.dark,e=b.value.getContext("2d");if(!e)return;b.value.width=M.value.clientWidth*2,b.value.height=M.value.clientHeight*2,F.value.width=b.value.width/2,F.value.height=b.value.height/2,e.scale(2,2),e.clearRect(0,0,b.value.width,b.value.height),me(e,F.value);const s=e.canvas.width/2;e.canvas.height/2;const V=(h,c,i)=>{let p=`hsla(${c*360/o.value.bands.length}, 60%, ${a?70:50}%, 0.5)`;i.beginPath(),c===B.value?(i.lineWidth=5,p=`hsla(${c*360/o.value.bands.length}, 70%, ${a?70:60}%, 1)`):i.lineWidth=2,i.strokeStyle=p;const g=new Float32Array(s);for(let G=0;G<s;G++)g[G]=r(G,F.value);const z=new Float32Array(s),X=new Float32Array(s);oe(ye,h).getFrequencyResponse(g,z,X);for(let G=F.value.padding_lr;G<s-F.value.padding_lr;G++){const ze=20*Math.log10(z[G]),qe=d(ze,F.value);G===F.value.padding_lr?i.moveTo(G,qe):i.lineTo(G,qe)}i.stroke();const he=n(h.frequency,F.value),be=d(h.gain,F.value);return i.beginPath(),i.fillStyle=p,i.arc(he,be,6,0,2*Math.PI),i.fill(),{frequencies:g,magResponse:z}},S=(h,c)=>{c.lineWidth=3,a?c.strokeStyle="#fff":c.strokeStyle="#000",c.beginPath();for(let i=F.value.padding_lr;i<s-F.value.padding_lr;i++){const p=d(h[i],F.value);i===F.value.padding_lr?c.moveTo(i,p):c.lineTo(i,p)}c.stroke()};if(O.value===A.ALL&&ne.value){const h=Object.values(A).filter(i=>i!==A.ALL),c={};h.forEach(i=>{c[i]=new Float32Array(s).fill((o.value.preamp??0)+(o.value.per_channel_preamp[i]??0))}),o.value.bands.forEach((i,p)=>{if(i.enabled){const{magResponse:g}=V(i,p,e);if(i.channel===A.ALL)h.forEach(z=>{for(let X=0;X<s;X++)c[z][X]+=20*Math.log10(g[X])});else for(let z=0;z<s;z++)c[i.channel][z]+=20*Math.log10(g[z])}}),h.forEach(i=>{S(c[i],e)})}else{const h=new Float32Array(s).fill((o.value.preamp??0)+(o.value.per_channel_preamp[O.value]??0));o.value.bands.forEach((c,i)=>{if(c.enabled&&c.channel===O.value||c.channel===A.ALL){const{magResponse:p}=V(c,i,e);for(let g=0;g<s;g++)h[g]+=20*Math.log10(p[g])}}),S(h,e)}},oe=(a,e)=>{const s=a.createBiquadFilter();switch(e.type){case k.HIGH_PASS:s.type="highpass";break;case k.LOW_PASS:s.type="lowpass";break;case k.HIGH_SHELF:s.type="highshelf";break;case k.LOW_SHELF:s.type="lowshelf";break;case k.NOTCH:s.type="notch";break;case k.PEAK:s.type="peaking";break}return s.frequency.value=e.frequency,s.Q.value=e.q,s.gain.value=e.gain,s},ye=new AudioContext,ne=K(()=>o.value.bands.some(a=>a.channel!==A.ALL)||Object.keys(o.value.per_channel_preamp).length>0&&Object.values(o.value.per_channel_preamp).some(a=>a!==0)),se=U(!1),B=U(-1),O=U(A.ALL),D=K(()=>o.value.bands[B.value]),pe=K({get:()=>o.value.preamp??0,set:a=>{o.value.preamp=a}}),ce=K({get:()=>o.value.per_channel_preamp[O.value]??0,set:a=>{O.value!==A.ALL&&(o.value.per_channel_preamp[O.value]=a)}}),re=a=>{o.value.bands.splice(a,1),B.value>=o.value.bands.length&&Ve(()=>{B.value=o.value.bands.length-1})},_e=()=>{const a=o.value.bands.length;o.value.bands.push({frequency:1e3,q:1,gain:0,type:k.PEAK,enabled:!0,channel:O.value}),Ve(()=>{B.value=a})};ae(()=>o.value.preamp,E),ae(()=>o.value.per_channel_preamp,E,{deep:!0}),ae(()=>(B.value,o.value.bands),()=>{B.value>=o.value.bands.length&&(B.value=o.value.bands.length-1),E()},{deep:!0}),ae(()=>O.value,E),ae(()=>W.global.current.value.dark,E),je(()=>{ne.value&&(se.value=!0)}),Le(()=>{E(),window.addEventListener("resize",E)});const n=(a,e)=>{const s=Math.log2(a/e.min_freq),V=Math.log2(e.max_freq/e.min_freq);return s/V*(e.width-e.padding_lr*2)+e.padding_lr},r=(a,e)=>{const s=Math.log2(e.max_freq/e.min_freq),V=e.min_freq*Math.pow(2,(a-e.padding_lr)/(e.width-e.padding_lr*2)*s);return Math.min(Math.max(V,e.min_freq),e.max_freq)},d=(a,e)=>e.height/2-a*(e.height-2*e.padding_tb)/(2*Math.max(Math.abs(e.min_gain),Math.abs(e.max_gain))),me=(a,e)=>{const s=a.canvas.width/2,V=a.canvas.height/2;W.global.current.value.dark?(a.fillStyle="#eee",a.strokeStyle="#eee"):(a.fillStyle="#222",a.strokeStyle="#666"),a.lineWidth=1,[20,50,100,200,500,1e3,2e3,5e3,1e4,2e4].forEach(p=>{const g=n(p,e);a.beginPath(),a.moveTo(g,e.padding_tb),a.lineTo(g,V-e.padding_tb),a.stroke(),a.font="10px Arial",a.textAlign="center",a.fillText(p>=1e3?`${p/1e3}k`:p.toString(),g,V-5)});const c=e.max_gain-e.min_gain,i=Math.ceil(c/(e.height/30));for(let p=e.min_gain;p<=e.max_gain;p+=i){const g=d(p,e);a.beginPath(),a.moveTo(e.padding_lr,g),a.lineTo(s-e.padding_lr,g),a.stroke(),a.font="10px Arial",a.textAlign="right",a.fillText(`${p}dB`,e.padding_lr-3,g+3)}};return Le(()=>{const a=new ResizeObserver(()=>{E()});return M.value&&a.observe(M.value),()=>{a.disconnect()}}),(a,e)=>(f(),L(Ne,{class:"pa-2"},{default:t(()=>[Z("div",ml,[se.value?(f(),L(ge,{key:1,modelValue:O.value,"onUpdate:modelValue":e[1]||(e[1]=s=>O.value=s),class:"pa-2",items:y($),label:y(T)("settings.dsp.parametric_eq.edited_channel"),variant:"outlined",density:"comfortable",style:{"min-width":"250px"},"hide-details":""},null,8,["modelValue","items","label"])):(f(),L(R,{key:0,variant:"outlined",onClick:e[0]||(e[0]=()=>{se.value=!0})},{default:t(()=>[l(j,{start:""},{default:t(()=>[...e[12]||(e[12]=[v("mdi-speaker-multiple",-1)])]),_:1}),v(" "+P(y(T)("settings.dsp.parametric_eq.show_multichannel_controls")),1)]),_:1})),l(R,{variant:"outlined",onClick:x},{default:t(()=>[l(j,{start:""},{default:t(()=>[...e[13]||(e[13]=[v("mdi-file-import",-1)])]),_:1}),v(" "+P(y(T)("settings.dsp.parametric_eq.import_apo")),1)]),_:1}),l(R,{variant:"outlined",onClick:N},{default:t(()=>[l(j,{start:""},{default:t(()=>[...e[14]||(e[14]=[v("mdi-file-export",-1)])]),_:1}),v(" "+P(y(T)("settings.dsp.parametric_eq.export_apo")),1)]),_:1}),Z("input",{ref_key:"fileInputRef",ref:m,type:"file",accept:".txt",class:"d-none",onChange:I},null,544)]),l(J,{elevation:"0",color:"transparent"},{default:t(()=>[Z("div",{ref_key:"graphContainer",ref:M,class:"graph-container"},[Z("canvas",{ref_key:"canvas",ref:b,class:"frequency-graph"},null,512)],512)]),_:1}),l(J,{elevation:"0",color:"transparent",class:"border-t border-b rounded-0"},{default:t(()=>[l(ee,{class:"pa-0"},{default:t(()=>[l(ll,{modelValue:B.value,"onUpdate:modelValue":e[2]||(e[2]=s=>B.value=s),class:"mb-0 pa-2",mandatory:"","selected-class":"primary"},{default:t(()=>[(f(),L(ke,{key:-1,value:-1,filter:"",variant:"elevated"},{default:t(()=>[v(P(y(T)("settings.dsp.parametric_eq.preamp",{index:100})),1)]),_:1})),(f(!0),de(fe,null,Ae(o.value.bands,(s,V)=>(f(),L(ke,{key:V,value:V,class:ue({"opacity-50":!s.enabled}),filter:"",variant:"elevated"},{default:t(()=>[v(P(s.channel===y(A).ALL?y(T)("settings.dsp.parametric_eq.band",{index:V+1}):y(T)("settings.dsp.parametric_eq.band_channel",{index:V+1,channel:y(T)(`settings.dsp.channels_compact.${s.channel}`)})),1)]),_:2},1032,["value","class"]))),128)),l(ke,{variant:"outlined",onClick:_e},{default:t(()=>[l(j,{icon:"mdi-plus",start:""}),v(" "+P(O.value===y(A).ALL?y(T)("settings.dsp.parametric_eq.add_band"):y(T)("settings.dsp.parametric_eq.add_band_channel",{channel:y(T)(`settings.dsp.channels.${O.value}`)})),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),B.value===-1?(f(),L(J,{key:0,elevation:"0",color:"transparent"},{default:t(()=>[l(ee,null,{default:t(()=>[l(We,{dense:""},{default:t(()=>[l($e,{cols:"12"},{default:t(()=>[l(Y,{modelValue:pe.value,"onUpdate:modelValue":e[3]||(e[3]=s=>pe.value=s),type:"gain"},null,8,["modelValue"]),O.value!==y(A).ALL?(f(),L(Y,{key:0,modelValue:ce.value,"onUpdate:modelValue":e[4]||(e[4]=s=>ce.value=s),type:{min:-15,max:15,step:.1,label:y(T)("settings.dsp.parametric_eq.per_channel_preamp",{channel:y(T)(`settings.dsp.channels.${O.value}`)}),unit:"dB",is_log:!1}},null,8,["modelValue","type"])):H("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):H("",!0),D.value?(f(),de(fe,{key:1},[l(tl,null,{default:t(()=>[Z("div",fl,[l(Se,{modelValue:D.value.enabled,"onUpdate:modelValue":e[5]||(e[5]=s=>D.value.enabled=s),label:y(T)("settings.dsp.parametric_eq.enable_band"),density:"comfortable","hide-details":"",color:"primary"},null,8,["modelValue","label"]),l(Pe),l(R,{color:"error",variant:"tonal",onClick:e[6]||(e[6]=s=>re(B.value))},{default:t(()=>[l(j,null,{default:t(()=>[...e[15]||(e[15]=[v("mdi-delete",-1)])]),_:1}),v(" "+P(y(T)("settings.dsp.parametric_eq.delete_band")),1)]),_:1})])]),_:1}),l(ge,{modelValue:D.value.type,"onUpdate:modelValue":e[7]||(e[7]=s=>D.value.type=s),items:y(_),label:y(T)("settings.dsp.parametric_eq.filter_type"),variant:"outlined",density:"comfortable",class:"pa-4","hide-details":""},null,8,["modelValue","items","label"]),l(Y,{modelValue:D.value.frequency,"onUpdate:modelValue":e[8]||(e[8]=s=>D.value.frequency=s),type:"frequency"},null,8,["modelValue"]),w(D.value.type)?(f(),L(Y,{key:0,modelValue:D.value.gain,"onUpdate:modelValue":e[9]||(e[9]=s=>D.value.gain=s),type:"gain"},null,8,["modelValue"])):H("",!0),l(Y,{modelValue:D.value.q,"onUpdate:modelValue":e[10]||(e[10]=s=>D.value.q=s),type:"q"},null,8,["modelValue"]),se.value?(f(),L(ge,{key:1,modelValue:D.value.channel,"onUpdate:modelValue":e[11]||(e[11]=s=>D.value.channel=s),items:y($),label:y(T)("settings.dsp.parametric_eq.channel"),variant:"outlined",density:"comfortable",class:"pa-4","hide-details":""},null,8,["modelValue","items","label"])):H("",!0)],64)):H("",!0)]),_:1}))}}),cl=Ue(vl,[["__scopeId","data-v-ac29d681"]]),gl=ve({__name:"DSPToneControl",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(Q){const q=Fe(Q,"modelValue");return(C,$)=>(f(),de(fe,null,[l(Y,{modelValue:q.value.bass_level,"onUpdate:modelValue":$[0]||($[0]=u=>q.value.bass_level=u),type:{min:-10,max:10,step:.1,label:C.$t("settings.dsp.tone_control.bass_level"),unit:"dB",is_log:!1}},null,8,["modelValue","type"]),l(Y,{modelValue:q.value.mid_level,"onUpdate:modelValue":$[1]||($[1]=u=>q.value.mid_level=u),type:{min:-10,max:10,step:.1,label:C.$t("settings.dsp.tone_control.mid_level"),unit:"dB",is_log:!1}},null,8,["modelValue","type"]),l(Y,{modelValue:q.value.treble_level,"onUpdate:modelValue":$[2]||($[2]=u=>q.value.treble_level=u),type:{min:-10,max:10,step:.1,label:C.$t("settings.dsp.tone_control.treble_level"),unit:"dB",is_log:!1}},null,8,["modelValue","type"])],64))}}),yl={key:0},_l={class:"d-none d-md-inline"},hl={class:"d-none d-md-inline"},ql=ve({__name:"EditPlayerDsp",props:{playerId:{}},setup(Q){const{t:q}=ul();Ye();const C=Ce(),$=Q,u=U(),I=U([]),m=U(null),x=U(!1),N=U(!1),W=U(le.PARAMETRIC_EQ),o=U(""),{mobile:b}=al();let M=!1,_;const w=Object.values(le).map(n=>({value:n,title:q(`settings.dsp.types.${n}`)})),F=()=>C.global.current.value.dark?"bg-grey-darken-3":"bg-grey-lighten-3",E=n=>{m.value=n},oe=n=>q(n==="input"?"settings.dsp.input":n==="output"?"settings.dsp.output":`settings.dsp.types.${u.value?.filters[n].type}`),ye=()=>{if(!u.value)return;let n;switch(W.value){case le.PARAMETRIC_EQ:n={preamp:0,per_channel_preamp:{},enabled:!0,type:le.PARAMETRIC_EQ,bands:[]};break;case le.TONE_CONTROL:n={enabled:!0,type:le.TONE_CONTROL,bass_level:0,mid_level:0,treble_level:0};break;default:return}u.value.filters.push(n),x.value=!1,E(u.value.filters.length-1)},ne=(n,r)=>{if(!u.value)return;const d=r==="up"?n-1:n+1;if(d<0||d>=u.value.filters.length)return;const[me]=u.value.filters.splice(n,1);u.value.filters.splice(d,0,me),m.value===n?m.value=d:m.value===d&&(m.value=n)},se=n=>{m.value===n&&(m.value="input"),u.value?.filters.splice(n,1)},B=async n=>{!n||!n.config||(m.value="input",u.value=n.config)},O=async()=>{if(!u.value||!o.value.trim())return;const n={name:o.value.trim(),config:u.value};try{await te.saveDSPPreset(n),o.value="",N.value=!1}catch(r){console.error("Failed to save DSP preset:",r)}},D=async n=>{!n||!confirm(q("settings.dsp.presets.remove_confirm"))||(await te.removeDSPPreset(n),I.value=I.value.filter(r=>r.preset_id!==n))};ae(b,n=>{!n&&m.value===null&&E("input")},{immediate:!0});const pe=K(()=>Ze(te.players[$.playerId],27));ae(()=>$.playerId,async n=>{_&&_(),M=!0,n&&(u.value=await te.getDSPConfig(n)),_=te.subscribe(we.PLAYER_DSP_CONFIG_UPDATED,r=>{M=!0,u.value=r.data},$.playerId)},{immediate:!0});const ce=te.subscribe(we.DSP_PRESETS_UPDATED,n=>{I.value=n.data});Le(async()=>{I.value=await te.getDSPPresets()}),Qe(()=>{_&&_(),ce()});let re=null;const _e=n=>{re&&clearTimeout(re),re=setTimeout(async()=>{$.playerId&&await te.saveDSPConfig($.playerId,n)},2e3)};return ae(u,(n,r)=>{if(M){re&&clearTimeout(re),M=!1;return}r!==null&&n&&_e(n)},{deep:!0}),(n,r)=>u.value?(f(),de("section",yl,[l(Re,{color:"transparent",class:"border-b pr-4"},{default:t(()=>[l(Se,{modelValue:u.value.enabled,"onUpdate:modelValue":r[0]||(r[0]=d=>u.value.enabled=d),"hide-details":"",color:"primary",class:"pl-4"},null,8,["modelValue"]),l(Ee,null,{default:t(()=>[v(P(n.$t("settings.dsp.configure_on",{name:pe.value})),1)]),_:1}),l(nl,{"offset-y":"",transition:"slide-y-transition"},{activator:t(({props:d})=>[l(R,Ke(d,{class:["mr-4",F()]}),{default:t(()=>[l(j,{class:"p-0 ms-md-n1 me-md-2"},{default:t(()=>[...r[19]||(r[19]=[v(" mdi-tray-arrow-down ",-1)])]),_:1}),Z("span",_l,P(n.$t("settings.dsp.presets.load")),1)]),_:1},16,["class"])]),default:t(()=>[l(sl,null,{default:t(()=>[I.value.length===0?(f(),L(Me,{key:0},{default:t(()=>[l(Oe,null,{default:t(()=>[v(P(n.$t("settings.dsp.presets.empty_warning")),1)]),_:1})]),_:1})):(f(!0),de(fe,{key:1},Ae(I.value,d=>(f(),L(Me,{key:d.preset_id,onClick:me=>B(d)},{append:t(()=>[l(R,{icon:"mdi-delete",variant:"text",density:"compact",onClick:Be(me=>D(d.preset_id),["stop"])},null,8,["onClick"])]),default:t(()=>[l(Oe,null,{default:t(()=>[v(P(d.name),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),l(R,{class:ue(F()),onClick:r[1]||(r[1]=d=>N.value=!0)},{default:t(()=>[l(j,{class:"p-0 ms-md-n1 me-md-2"},{default:t(()=>[...r[20]||(r[20]=[v(" mdi-content-save ",-1)])]),_:1}),Z("span",hl,P(n.$t("settings.dsp.presets.save")),1)]),_:1},8,["class"])]),_:1}),l(Ne,{class:"pa-4"},{default:t(()=>[u.value.enabled?H("",!0):(f(),L(rl,{key:0,type:"info",class:"mt-4",color:"transparent"},{default:t(()=>[v(P(n.$t("settings.dsp.disabled_message")),1)]),_:1})),l(We,{class:ue([{"justify-center":y(b)},"flex-nowrap"])},{default:t(()=>[!y(b)||m.value===null?(f(),L($e,{key:0,class:ue(["flex-grow-0 flex-shrink-0",{"border-e pr-4":!y(b)}]),"align-self":"start"},{default:t(()=>[l(il,{dsp:u.value,selected:m.value,onOnSelect:E,onOnAddFilter:r[2]||(r[2]=d=>x.value=!0),onOnMoveFilter:r[3]||(r[3]=d=>ne(d.index,d.direction)),onOnDeleteFilter:se},null,8,["dsp","selected"])]),_:1},8,["class"])):H("",!0),m.value!=null?(f(),L($e,{key:1,style:{"min-width":"0"}},{default:t(()=>[l(Re,{density:"compact",color:n.$vuetify.theme.current.dark?"surface":"surface-light",class:"border-b"},{default:t(()=>[y(b)?(f(),L(R,{key:0,class:"hidden-xs-only",icon:"",onClick:r[4]||(r[4]=d=>m.value=null)},{default:t(()=>[l(j,null,{default:t(()=>[...r[21]||(r[21]=[v("mdi-arrow-left",-1)])]),_:1})]),_:1})):H("",!0),l(Ee,null,{default:t(()=>[v(P(oe(m.value)),1)]),_:1}),typeof m.value=="number"&&!y(b)&&m.value>0?(f(),L(R,{key:1,icon:"",onClick:r[5]||(r[5]=d=>ne(m.value,"up"))},{default:t(()=>[l(j,null,{default:t(()=>[...r[22]||(r[22]=[v("mdi-arrow-up",-1)])]),_:1})]),_:1})):H("",!0),typeof m.value=="number"&&!y(b)&&m.value<u.value.filters.length-1?(f(),L(R,{key:2,icon:"",onClick:r[6]||(r[6]=d=>ne(m.value,"down"))},{default:t(()=>[l(j,null,{default:t(()=>[...r[23]||(r[23]=[v("mdi-arrow-down",-1)])]),_:1})]),_:1})):H("",!0),typeof m.value=="number"?(f(),L(Se,{key:3,modelValue:u.value.filters[m.value].enabled,"onUpdate:modelValue":r[7]||(r[7]=d=>u.value.filters[m.value].enabled=d),"hide-details":"",color:"primary",class:"mr-4"},null,8,["modelValue"])):H("",!0),typeof m.value=="number"?(f(),L(R,{key:4,icon:"",onClick:r[8]||(r[8]=d=>se(m.value))},{default:t(()=>[l(j,null,{default:t(()=>[...r[24]||(r[24]=[v("mdi-delete",-1)])]),_:1})]),_:1})):H("",!0)]),_:1},8,["color"]),m.value==="input"?(f(),L(J,{key:0,flat:"",color:n.$vuetify.theme.current.dark?"surface":"surface-light"},{default:t(()=>[l(Y,{modelValue:u.value.input_gain,"onUpdate:modelValue":r[9]||(r[9]=d=>u.value.input_gain=d),type:"gain"},null,8,["modelValue"])]),_:1},8,["color"])):m.value==="output"?(f(),L(J,{key:1,flat:"",color:n.$vuetify.theme.current.dark?"surface":"surface-light"},{default:t(()=>[l(Y,{modelValue:u.value.output_gain,"onUpdate:modelValue":r[10]||(r[10]=d=>u.value.output_gain=d),type:"gain"},null,8,["modelValue"])]),_:1},8,["color"])):(f(),L(J,{key:2,flat:"",color:n.$vuetify.theme.current.dark?"surface":"surface-light"},{default:t(()=>[u.value.filters[m.value].type===y(le).PARAMETRIC_EQ?(f(),L(cl,{key:0,modelValue:u.value.filters[m.value],"onUpdate:modelValue":r[11]||(r[11]=d=>u.value.filters[m.value]=d)},null,8,["modelValue"])):H("",!0),u.value.filters[m.value].type===y(le).TONE_CONTROL?(f(),L(gl,{key:1,modelValue:u.value.filters[m.value],"onUpdate:modelValue":r[12]||(r[12]=d=>u.value.filters[m.value]=d)},null,8,["modelValue"])):H("",!0)]),_:1},8,["color"]))]),_:1})):H("",!0)]),_:1},8,["class"])]),_:1}),l(Ie,{modelValue:N.value,"onUpdate:modelValue":r[15]||(r[15]=d=>N.value=d),"max-width":"300"},{default:t(()=>[l(J,null,{default:t(()=>[l(De,null,{default:t(()=>[v(P(n.$t("settings.dsp.presets.save")),1)]),_:1}),l(ee,null,{default:t(()=>[l(xe,{modelValue:o.value,"onUpdate:modelValue":r[13]||(r[13]=d=>o.value=d),label:n.$t("settings.dsp.presets.name"),placeholder:n.$t("settings.dsp.presets.name_placeholder"),variant:"outlined"},null,8,["modelValue","label","placeholder"])]),_:1}),l(He,null,{default:t(()=>[l(Pe),l(R,{onClick:r[14]||(r[14]=d=>N.value=!1)},{default:t(()=>[v(P(n.$t("cancel")),1)]),_:1}),l(R,{color:"primary",disabled:!o.value.trim(),onClick:O},{default:t(()=>[v(P(n.$t("settings.dsp.presets.save")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Ie,{modelValue:x.value,"onUpdate:modelValue":r[18]||(r[18]=d=>x.value=d),"max-width":"300"},{default:t(()=>[l(J,null,{default:t(()=>[l(De,null,{default:t(()=>[v(P(n.$t("settings.dsp.filter.add")),1)]),_:1}),l(ee,null,{default:t(()=>[l(ge,{modelValue:W.value,"onUpdate:modelValue":r[16]||(r[16]=d=>W.value=d),items:y(w),label:n.$t("settings.dsp.filter.type")},null,8,["modelValue","items","label"])]),_:1}),l(He,null,{default:t(()=>[l(Pe),l(R,{onClick:r[17]||(r[17]=d=>x.value=!1)},{default:t(()=>[v(P(n.$t("cancel")),1)]),_:1}),l(R,{color:"primary",onClick:ye},{default:t(()=>[v(P(n.$t("settings.dsp.filter.add")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])):H("",!0)}});export{ql as default};
