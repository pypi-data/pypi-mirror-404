[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[project]
name = "splunk-as"
version = "1.1.5"
description = "Shared library for Splunk Assistant Skills - HTTP client, configuration management, error handling, and utilities for Splunk REST API automation"
readme = "README.md"
license = "MIT"
requires-python = ">=3.9"
authors = [
    { name = "Jason Krueger", email = "grandcamel@gmail.com" }
]
keywords = [
    "splunk",
    "api",
    "rest",
    "automation",
    "claude",
    "assistant",
    "skills",
]
classifiers = [
    "Development Status :: 4 - Beta",
    "Intended Audience :: Developers",
    "License :: OSI Approved :: MIT License",
    "Operating System :: OS Independent",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Topic :: Software Development :: Libraries :: Python Modules",
    "Topic :: System :: Systems Administration",
]
dependencies = [
    "requests>=2.28.0",
    "click>=8.0",
    "assistant-skills-lib>=1.0.0",
]

[project.scripts]
splunk-as = "splunk_as.cli.main:cli"

[project.optional-dependencies]
dev = [
    "pytest>=7.0.0",
    "pytest-cov>=4.0.0",
    "black>=23.0.0",
    "isort>=5.12.0,<6.0.0",
    "mypy>=1.0.0",
    "types-requests>=2.28.0",
]

[project.urls]
Homepage = "https://github.com/grandcamel/splunk-as"
Repository = "https://github.com/grandcamel/splunk-as"
Issues = "https://github.com/grandcamel/splunk-as/issues"
Changelog = "https://github.com/grandcamel/splunk-as/blob/main/CHANGELOG.md"

[tool.hatch.build.targets.sdist]
include = [
    "/src",
]

[tool.hatch.build.targets.wheel]
packages = ["src/splunk_as"]

[tool.pytest.ini_options]
testpaths = ["tests"]
pythonpath = ["src"]
python_files = ["test_*.py"]
python_functions = ["test_*"]
addopts = "-v --tb=short"
markers = [
    # Core markers
    "unit: Unit tests (fast, no external calls)",
    "integration: Integration tests (may require credentials)",
    "slow: Slow running tests",
    "live: Tests requiring live Splunk credentials",
    "destructive: Tests that modify or delete data",
    "e2e: End-to-end tests requiring Claude Code CLI",
    # Search skill markers
    "search: Search operation tests",
    "oneshot: Oneshot search tests",
    "blocking: Blocking search tests",
    "async_search: Async/normal search tests",
    "export: Search export tests (CSV, JSON, XML)",
    "spl: SPL query construction tests",
    # Job skill markers
    "job: Search job management tests",
    "job_lifecycle: Job creation/cancellation tests",
    "job_results: Job results retrieval tests",
    "job_events: Job events retrieval tests",
    "job_timeline: Job timeline tests",
    # Metadata skill markers
    "metadata: Metadata discovery tests",
    "indexes: Index metadata tests",
    "sourcetypes: Sourcetype metadata tests",
    "fields: Field metadata tests",
    "apps: Application metadata tests",
    # Lookup skill markers
    "lookup: Lookup table tests",
    "kvstore: KV Store collection tests",
    "lookup_upload: Lookup file upload tests",
    "lookup_transform: Lookup transform tests",
    # SavedSearch/Alert skill markers
    "savedsearch: Saved search tests",
    "alert: Alert action tests",
    "scheduled: Scheduled search tests",
    "trigger: Alert trigger tests",
    # Admin skill markers
    "admin: Administrative operation tests",
    "users: User management tests",
    "roles: Role management tests",
    "capabilities: Capability tests",
    "config: Configuration tests",
    "server: Server info tests",
    # Security skill markers
    "security: Security-related tests",
    "tokens: Token management tests",
    "audit: Audit log tests",
    # Metrics skill markers
    "metrics: Metrics catalog tests",
    "mstats: mstats command tests",
    # Environment markers
    "cloud_only: Splunk Cloud only tests",
    "enterprise_only: Splunk Enterprise only tests",
    "docker_required: Tests requiring Docker container",
    "external_required: Tests requiring external Splunk instance",
    # Mock markers
    "mock: Tests using mock client",
    "mock_search: Mock search tests",
    "mock_job: Mock job tests",
]

[tool.black]
line-length = 88
target-version = ["py39", "py310", "py311", "py312"]

[tool.isort]
profile = "black"
line_length = 88

[tool.mypy]
python_version = "3.9"
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true

[tool.bandit]
exclude_dirs = ["tests", "venv", ".venv"]
skips = ["B101"]  # Skip assert warnings (used in tests)
