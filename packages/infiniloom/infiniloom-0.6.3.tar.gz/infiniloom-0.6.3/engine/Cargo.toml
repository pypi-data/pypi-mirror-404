[package]
name = "infiniloom-engine"
version = "0.6.3"
edition = "2021"
rust-version = "1.91"
description = "High-performance repository context engine for LLMs - AST parsing, token counting, and secret detection"
license = "MIT"
repository = "https://github.com/Topos-Labs/infiniloom"
keywords = ["llm", "ai", "code", "ast", "tree-sitter"]
categories = ["development-tools", "parsing", "text-processing"]
readme = "README.md"

[lib]
name = "infiniloom_engine"
crate-type = ["cdylib", "rlib"]

[dependencies]
# Serialization
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
serde_yaml = "0.9"

# Error handling
thiserror = "1.0"
anyhow = "1.0"

# Builder pattern
typed-builder = "0.20"

# Async runtime
tokio = { version = "1.35", features = ["full"], optional = true }
async-trait = { version = "0.1", optional = true }

# Graph algorithms (PageRank)
petgraph = "0.6"

# Parallel processing
rayon = "1.8"
crossbeam-channel = "0.5"

# Structured logging
tracing = "0.1"
tracing-subscriber = { version = "0.3", features = ["env-filter"] }

# Regex for pattern matching
regex = "1.10"

# Glob pattern matching
glob = "0.3"

# Gitignore-aware file walking
ignore = "0.4"

# Unicode handling
unicode-segmentation = "1.10"
unicode-normalization = "0.1"

# Tree-sitter for AST parsing (21 languages)
# Using tree-sitter 0.25 with compatible grammar versions
tree-sitter = "0.25"
tree-sitter-python = "0.23"
tree-sitter-javascript = "0.23"
tree-sitter-typescript = "0.23"
tree-sitter-rust = "0.23"
tree-sitter-go = "0.23"
tree-sitter-java = "0.23"
tree-sitter-c = "0.23"
tree-sitter-cpp = "0.23"
tree-sitter-c-sharp = "0.23"
tree-sitter-ruby = "0.23"
tree-sitter-bash = "0.23"
tree-sitter-php = "0.24"
tree-sitter-kotlin-ng = "1.1"
tree-sitter-swift = "0.6"
tree-sitter-scala = "0.23"
tree-sitter-haskell = "0.23"
tree-sitter-elixir = "0.3"
tree-sitter-clojure = "0.1"
tree-sitter-ocaml = "0.24"
tree-sitter-lua = "0.2"
tree-sitter-r = "1"

# Accurate token counting
tiktoken-rs = "0.5"

# Memory-mapped I/O
memmap2 = "0.9"

# File watching for incremental mode
notify = { version = "6.1", optional = true }

# Git operations - Note: actual implementation uses git CLI via std::process::Command
# gix and git2 crates are not used; keeping this comment for documentation

# Fast hashing for content addressing
blake3 = "1.5"

# Configuration
toml = "0.8"
figment = { version = "0.10", features = ["yaml", "toml", "json", "env"] }

# URL parsing for remote repos
url = "2.5"

# Binary serialization for cache
bincode = "1.3"
once_cell = "1.21.3"

# Thread-safe concurrent hashmap for caching
dashmap = "6.1"

# Temp directory with RAII cleanup
tempfile = "3.10"

# Optional: Local embeddings
# Note: candle 0.9+ is required for compatibility with rand 0.9
[dependencies.candle-core]
version = "0.9"
optional = true

[dependencies.candle-transformers]
version = "0.9"
optional = true

[features]
default = []

# Async runtime support (placeholder - not yet implemented)
# When implemented, will enable async file scanning and parallel processing
async = ["tokio", "async-trait"]

# Neural embeddings for semantic code analysis
# Currently uses character-frequency based similarity (see semantic.rs)
# Future: Will enable transformer-based embeddings via candle
embeddings = ["candle-core", "candle-transformers"]

# File watching for incremental indexing
# Enables `infiniloom pack --watch` for automatic regeneration on file changes
# Also provides FileWatcher in engine for library users
watch = ["notify"]

# Note: "git" feature removed - git operations use CLI via std::process::Command

# Enable all optional features
full = ["async", "embeddings", "watch"]

[dev-dependencies]
criterion = "0.5"
tempfile = "3.10"
proptest = "1.4"
walkdir = "2.4"
rayon = "1.8"

[[bench]]
name = "comparison"
harness = false

[lints]
workspace = true
