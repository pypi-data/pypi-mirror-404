<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/apple-touch-icon.png" />
    <link rel="manifest" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        const scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          // Guard against race condition where iframe isn't ready
          if (!obj.contentWindow?.document?.documentElement) {
            return;
          }
          const element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          const hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          const newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((_entries) => {
          setHeight();
        });
        // Only observe if iframe content is ready
        if (obj.contentWindow?.document?.body) {
          resizeObserver.observe(obj.contentWindow.document.body);
        }
      }
    </script>
    <marimo-filename hidden>numerical_relativity_stencils.py</marimo-filename>
    <!-- TODO(Trevor): Legacy, required by VS Code plugin. Remove when plugin is updated (see marimo/server/_templates/template.py) -->
    <marimo-version data-version="{{ version }}" hidden></marimo-version>
    <marimo-user-config data-config="{{ user_config }}" hidden></marimo-user-config>
    <marimo-server-token data-token="{{ server_token }}" hidden></marimo-server-token>
    <!-- /TODO -->
    <title>numerical relativity stencils</title>
    <script type="module" crossorigin crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/index-Cq_ZnpmP.js"></script>
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/preload-helper-BW0IMuFq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/hotkeys-uKX61F1_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/defaultLocale-BLUna9fQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/precisionRound-Cl9k9ZmS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/defaultLocale-DzliDDTm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/vega-loader.browser-C8wT63Va.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/_Uint8Array-BGESiCQL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/tooltip-CrRUCOBw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/clsx-D0MtrJOx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/cn-C1rgT0yh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/chunk-LvLJmgfZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/react-BGmjiNul.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/compiler-runtime-DeeZ7FnK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/jsx-runtime-DN_bIXfG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/badge-DAnNhy3O.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/useEventListener-COkmyg1v.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/button-B8cGZzP5.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/react-dom-C9fstfnp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/Combination-D1TsGrBC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/menu-items-9PZrU2e0.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/dist-CBrDuocE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/createLucideIcon-CW2xpJ57.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/check-CrAQug3q.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/select-D9lTzMzP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/tooltip-CvjcEpZC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/use-toast-Bzf3rpev.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/_getTag-BWqNuuwU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/_baseIsEqual-Cz9Tt_-E.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/useEvent-DlWF5OMa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/invariant-C6yE60hi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/_baseFor-Duhs3RiJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/merge-BBX6ug-N.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/zod-Cg4WLWh2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/utils-pfqq9IdB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/constants-Bkp4R3bQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/Deferred-DzyBMRsy.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/config-D6nhy4FA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/uuid-ClFZlR7U.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/DeferredRequestRegistry-B3BENoUa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/requests-C0HaHO6a.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/isSymbol-BGkTcW3U.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/toString-DlRqgfqz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/_hasUnicode-zBEpxwYe.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/useLifecycle-CmDXEyIC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/useNonce-EAuSVK-5.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/useTheme-CNj0G_ol.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/once-CTiSlR1m.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/capabilities-BmAOeMOK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/createReducer-DDa-hVe3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/dist-CAcX026F.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/dist-DKNOF5xd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/dist-CI6_zMIl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/dist-BVf1IY4_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/dist-Cq_4nPfh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/dist-CVj-_Iiz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/dist-HGZzCB0y.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/dist-RKnr9SNh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/dist-BuhT82Xx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/stex-0ac7Aukl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/toDate-5JckKRQn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/cjs-Bj40p_Np.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/_arrayReduce-bZBYsK-u.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/type-BdyvjzTI.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/_baseProperty-DuoFhI7N.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/now-6sUe0ZdD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/debounce-BbFlGgjv.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/toInteger-CDcO32Gx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/database-zap-CaVvnK_o.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/main-CwSdzVhm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/cells-CpvLRFsM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/ErrorBoundary-C7JBxSzd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/kbd-Czc5z_04.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/useInstallPackage-RldLPyJs.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/alert-dialog-jcHA5geR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/dialog-CF5DtF1E.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/useDebounce-em3gna-v.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/numbers-C9_R_vlY.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/SSRProvider-DD7JA3RM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/context-DHfVoQfl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/useNumberFormatter-FoXhpyAb.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/usePress-DTwIUo40.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/input-B80Yt1uu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/ImperativeModal-DVhvP4lH.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/cell-link-Dz1jd8Ir.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/multi-map-CQd4MZr5.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/alert-BEdExd6A.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/chevron-right-CqEd11Di.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/dropdown-menu-BP4_BZLr.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/links-DNmjkr65.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/datasource-Bm5VLYk2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/state-CJMywDNY.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/MarimoErrorOutput-By2cOynM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/copy-DRhpWiOq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/copy-gBVL4NN-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/copy-icon-jWsqdLn1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/spinner-C1czjtp7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/es-Biy2OCfF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/focus-DmVMvj8M.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/LazyAnyLanguageCodeMirror-Cp2punaU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/katex-AwOI3EvM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/marked.esm-CHnOtnr3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/chunk-OGVTOU66-CjNLT2C3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/markdown-renderer-ueIadUZx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/dist-Dg7UO_Vw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/command-CiJW14cR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/popover-DtnzNVk-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/useRunCells-Cm_P3BT1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/mode-wovPGH9p.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/purify.es-N-2faAGj.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/RenderHTML-B8p715zK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/table--_20dwBZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/tabs-Ctk4D03n.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/useAsyncData-BJJJOr9W.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/useIframeCapabilities-CU-WWxnz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/error-banner-DvT0IGDZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/formats-B9CrBoaO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/en-US-DhMN8sxe.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/isValid-DhzaK-Y1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/dates-CdsE1R40.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/download-CcAOzx6T.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/maps-s2pQkyf5.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/extends-B9D0JO9U.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/emotion-is-prop-valid.esm-lG8j6oqk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/useDateFormatter-DsANziQR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/range-sshwVRcP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/capitalize-DQeWKRGx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/table-BLx7B_us.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/JsonOutput-aB5dKsM0.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/file-BnFXtaZZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/play-BJDBXApx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/chat-components-ZPMBgudd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/isEmpty-DIxUV1UR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/circle-check-big-OIMTUpe6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/chat-display-Bru4OSNG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/ai-model-dropdown-BmUQTAgw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/renderShortcut-eU5Hsfml.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/useDeleteCell-DMZ3UAH-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/icons-D4lB4En9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/process-output-BbPyu6EM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/blob-Dg_vNTSs.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/objectWithoutPropertiesLoose-CboCOq4o.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/esm-B3JckBtM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/add-cell-with-ai-DIVGdu6r.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/chart-no-axes-column-D42sFB6d.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/square-function-DxXFdbn8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/spec-qp_XZeSS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/column-preview-DtmhBN9V.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/switch-D8i8UxCP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/toggle-G1t0cQyf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/globals-h0vQaXwS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/share-CXQVxivL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/memoize-DN0TMY36.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/get-CyLJYAfP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/_baseSet-6FYvpjrm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/react-resizable-panels.browser.esm-BqxQegSf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/utilities.esm-DvUjESxl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/floating-outline-DBJNk57_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/useAddCell-Cc3-yOhX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/eye-off-D9zAYqG9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/plus-CHesBJpY.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/readonly-python-code-CoXhoNRa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/file-video-camera-CZUg-nFA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/types-DJ8nLAfz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/label-CNZLffHW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/textarea-DfnWQ2d8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/refresh-ccw-DbW1_PHb.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/trash-2-C-lF7BNB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/form-BlH9lWzg.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/field-Clr_fqUr.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/useBoolean-B_S7yTZz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/useDeepCompareMemoize-gzLRYatP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/types-B42u_5hF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/prop-types-C638SUfx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/es-FiXEquL2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/VisuallyHidden-B9t3FhTP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/hasIn-DydgU7lx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/_baseFlatten-CLPh0yMf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/flatten-Buk63LQO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/pick-DeQioq0G.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/code-xml-MBUyxNtK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/download-DobaYJPt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/house-CncUa_LL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/refresh-cw-Din9uFKE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/settings-MTlHVxz3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/square-leQTJTJJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/triangle-alert-CbD0f2J6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/bundle.esm-B0Sy2M4C.js">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/cells-jmgGt1lS.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/markdown-renderer-DdDKmWlR.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/JsonOutput-B7vuddcd.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.4/dist/assets/index-DDc_1b-N.css">
  
<script data-marimo="true">
    window.__MARIMO_STATIC__ = {};
    window.__MARIMO_STATIC__.files = {};
</script>
</head>
  <body>
    <div id="root"></div>
    <!-- This is a portal for the data editor to render in -->
    <div id="portal" data-testid="glide-portal" style="position: fixed; left: 0; top: 0; z-index: 9999"></div>
    <script data-marimo="true">
      window.__MARIMO_MOUNT_CONFIG__ = {
            "filename": "numerical_relativity_stencils.py",
            "mode": "read",
            "version": "0.19.4",
            "serverToken": "static",
            "config": {"ai": {"custom_providers": {}, "models": {"custom_models": [], "displayed_models": []}}, "completion": {"activate_on_typing": true, "copilot": false, "signature_hint_on_typing": false}, "diagnostics": {"sql_linter": true}, "display": {"cell_output": "below", "code_editor_font_size": 14, "dataframes": "rich", "default_table_max_columns": 50, "default_table_page_size": 10, "default_width": "medium", "reference_highlighting": true, "theme": "light"}, "formatting": {"line_length": 79}, "keymap": {"overrides": {}, "preset": "default"}, "language_servers": {"pylsp": {"enable_flake8": false, "enable_mypy": true, "enable_pydocstyle": false, "enable_pyflakes": false, "enable_pylint": false, "enable_ruff": true, "enabled": false}}, "mcp": {"mcpServers": {}, "presets": []}, "package_management": {"manager": "uv"}, "runtime": {"auto_instantiate": false, "auto_reload": "off", "default_sql_output": "auto", "on_cell_change": "autorun", "output_max_bytes": 8000000, "reactive_tests": true, "std_stream_max_bytes": 1000000, "watcher_on_save": "lazy"}, "save": {"autosave": "after_delay", "autosave_delay": 1000, "format_on_save": false}, "server": {"browser": "default", "follow_symlink": false}, "snippets": {"custom_paths": [], "include_default_snippets": true}},
            "configOverrides": {},
            "appConfig": {"sql_output": "auto", "width": "compact"},
            "view": {"showAppCode": true},
            "notebook": {"cells": [{"code": "import marimo as mo\nfrom symderive import (\n    Symbol, symbols, Function, Rational, R,\n    D, Simplify, Expand,\n    Exp, Sin, Cos, Sqrt, Pi,\n    TeXForm, Pipe,\n)\nfrom symderive.calculus import VariationalDerivative, EulerLagrangeEquation\nfrom symderive.discretization import Discretize, ToStencil, StencilCodeGen\nfrom symderive.diffgeo import Metric, minkowski_metric", "code_hash": "095a172ae9c2d40f9c08a35643153f2e", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Hbol", "name": "_"}, {"code": "mo.md(r\"\"\"\n# From Lagrangians to Numerical Stencils\n\nThis notebook demonstrates the complete pipeline from theoretical physics to\nnumerical simulation code, based on the scalar field dynamics in\n[arXiv:1608.04408](https://arxiv.org/abs/1608.04408).\n\n## The Physics\n\nSingle-field inflation uses a scalar field with canonical kinetic term:\n\n$$\\mathcal{L}_\\phi = -\\frac{1}{2}g^{\\mu\\nu}\\partial_\\mu \\phi \\partial_\\nu\\phi - V(\\phi)$$\n\nThe Klein-Gordon equation governing the field dynamics is:\n\n$$\\partial_t^2 \\phi - \\gamma^{ij}\\partial_i\\partial_j\\phi + \\frac{dV}{d\\phi} = 0$$\n\nWe will derive this equation using variational calculus, then convert it to\nfinite difference form suitable for numerical simulation.\n\"\"\")", "code_hash": "aa894c51804a86d54d28ea1eb9ec8f64", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "MJUe", "name": "_"}, {"code": "mo.md(r\"\"\"\n## 1. Deriving the Klein-Gordon Equation\n\nStarting from the scalar field Lagrangian density in flat spacetime:\n\n$$\\mathcal{L} = \\frac{1}{2}(\\partial_t\\phi)^2 - \\frac{1}{2}(\\partial_x\\phi)^2 - V(\\phi)$$\n\nThe Euler-Lagrange equation gives us the equation of motion.\n\"\"\")", "code_hash": "ef619372213def2193ad8b4f3091e656", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "vblA", "name": "_"}, {"code": "# Define coordinates and field\nx, t = symbols('x t')\nphi = Function('phi')(x, t)\nm = Symbol('m', positive=True)  # mass parameter\n\n# Klein-Gordon Lagrangian: L = (1/2)(d_t phi)^2 - (1/2)(d_x phi)^2 - (1/2)m^2 phi^2\nL_KG = R(1, 2) * D(phi, t)**2 - R(1, 2) * D(phi, x)**2 - R(1, 2) * m**2 * phi**2\n\n# Derive the equation of motion\neom_KG = VariationalDerivative(L_KG, phi, [x, t])\n\nmo.md(f\"\"\"\n**Klein-Gordon Lagrangian:**\n\n$\\\\mathcal{{L}} = {L_KG}$\n\n**Equation of Motion** ($\\\\delta\\\\mathcal{{L}}/\\\\delta\\\\phi = 0$):\n\n${Simplify(eom_KG)} = 0$\n\nThis is the Klein-Gordon equation: $\\\\partial_t^2\\\\phi - \\\\partial_x^2\\\\phi + m^2\\\\phi = 0$\n\"\"\")", "code_hash": "dc3cb2aa9e0bc22a30db730bef4c5b1d", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "bkHC", "name": "_"}, {"code": "mo.md(r\"\"\"\n## 2. The Wave Equation (Massless Limit)\n\nSetting $m = 0$ gives the wave equation, which appears in the gradient energy\ndominated regime of inflation simulations.\n\"\"\")", "code_hash": "2ad9148c2c704baf2783bde751eb7528", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "lEQa", "name": "_"}, {"code": "# Wave equation (massless Klein-Gordon)\nx_w, t_w = symbols('x t')\nphi_w = Function('phi')(x_w, t_w)\n\nL_wave = R(1, 2) * D(phi_w, t_w)**2 - R(1, 2) * D(phi_w, x_w)**2\n\neom_wave = VariationalDerivative(L_wave, phi_w, [x_w, t_w])\n\nmo.md(f\"\"\"\n**Wave Equation Lagrangian:**\n\n$\\\\mathcal{{L}} = {L_wave}$\n\n**Equation of Motion:**\n\n${Simplify(eom_wave)} = 0$\n\nThis gives: $\\\\partial_t^2\\\\phi = \\\\partial_x^2\\\\phi$ (the wave equation)\n\"\"\")", "code_hash": "4974274fcaa72bf7448df279a1076dea", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "PKri", "name": "_"}, {"code": "mo.md(r\"\"\"\n## 3. Converting to Finite Differences\n\nFor numerical simulation, we need to discretize the spatial derivatives.\nThe `Discretize` function converts symbolic derivatives to finite difference\napproximations using Taylor series matching.\n\n### Central Difference Stencils\n\nFor a 3-point central difference:\n- First derivative: $\\frac{\\partial f}{\\partial x} \\approx \\frac{f(x+h) - f(x-h)}{2h}$\n- Second derivative: $\\frac{\\partial^2 f}{\\partial x^2} \\approx \\frac{f(x+h) - 2f(x) + f(x-h)}{h^2}$\n\"\"\")", "code_hash": "d2b078888c346c406b4ffc0e3d542833", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "Xref", "name": "_"}, {"code": "# Discretization example\nx_d = Symbol('x')\nh = Symbol('h')  # grid spacing\nf = Function('f')(x_d)\n\n# Second derivative\nd2f_dx2 = D(f, (x_d, 2))\n\n# Central difference discretization\nstencil_3pt = Discretize(d2f_dx2, {x_d: ([x_d - h, x_d, x_d + h], h)})\n\nmo.md(f\"\"\"\n**Second Derivative Discretization (3-point central):**\n\nSymbolic: $\\\\frac{{\\\\partial^2 f}}{{\\\\partial x^2}}$\n\nDiscretized: ${Simplify(stencil_3pt)}$\n\nThis is the standard 3-point stencil: $\\\\frac{{f_{{i+1}} - 2f_i + f_{{i-1}}}}{{h^2}}$\n\"\"\")", "code_hash": "c945b0fe700ad5df110da478490f731e", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "SFPL", "name": "_"}, {"code": "mo.md(r\"\"\"\n## 4. Discretizing the Wave Equation\n\nNow let's discretize the full wave equation for numerical simulation.\n\"\"\")", "code_hash": "7ae68c0dce193c396363187e61ecc484", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "BYtC", "name": "_"}, {"code": "# Full wave equation discretization\nx_full, t_full = symbols('x t')\nhx, ht = symbols('h_x h_t')  # spatial and temporal grid spacing\nu = Function('u')(x_full, t_full)\n\n# Wave equation: d^2u/dt^2 - d^2u/dx^2 = 0\nwave_eq = D(u, (t_full, 2)) - D(u, (x_full, 2))\n\n# Discretize both derivatives\nstep_map = {\n    x_full: ([x_full - hx, x_full, x_full + hx], hx),\n    t_full: ([t_full - ht, t_full, t_full + ht], ht),\n}\nwave_discrete = Discretize(wave_eq, step_map)\n\nmo.md(f\"\"\"\n**Wave Equation:**\n\n$\\\\frac{{\\\\partial^2 u}}{{\\\\partial t^2}} - \\\\frac{{\\\\partial^2 u}}{{\\\\partial x^2}} = 0$\n\n**Discretized Form:**\n\n${Simplify(wave_discrete)} = 0$\n\nRearranging for time-stepping: $u(x, t+h_t) = 2u(x,t) - u(x, t-h_t) + \\\\frac{{h_t^2}}{{h_x^2}}[u(x+h_x,t) - 2u(x,t) + u(x-h_x,t)]$\n\"\"\")", "code_hash": "0aceb9bc459f0706db94d4e70fb03fa7", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "RGSE", "name": "_"}, {"code": "mo.md(r\"\"\"\n## 5. Higher-Order Stencils\n\nFor better accuracy, we can use wider stencils. The `ToStencil` function\nautomatically generates symmetric stencil points.\n\"\"\")", "code_hash": "e99f053a0c14bb1aa9f048aa1c0a5a89", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "Kclp", "name": "_"}, {"code": "# Higher-order stencils\nx_ho = Symbol('x')\nh_ho = Symbol('h')\nf_ho = Function('f')(x_ho)\n\n# Compare 3-point and 5-point stencils for first derivative\ndf_dx = D(f_ho, x_ho)\n\nstencil_3 = ToStencil(df_dx, {x_ho: h_ho}, width=3)\nstencil_5 = ToStencil(df_dx, {x_ho: h_ho}, width=5)\n\nmo.md(f\"\"\"\n**First Derivative Stencils:**\n\n3-point: ${Simplify(stencil_3)}$\n\n5-point: ${Simplify(stencil_5)}$\n\nThe 5-point stencil provides 4th-order accuracy vs 2nd-order for 3-point.\n\"\"\")", "code_hash": "4c59ba741f267912115f04af0d8893c5", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "emfo", "name": "_"}, {"code": "mo.md(r\"\"\"\n## 6. Code Generation\n\nThe `StencilCodeGen` function converts discretized expressions to code\nin multiple programming languages - useful for generating numerical\nrelativity simulation code.\n\"\"\")", "code_hash": "1eee4a892de39e1599bc7731c39f2d9a", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "Hstk", "name": "_"}, {"code": "# Code generation example\nx_cg = Symbol('x')\nh_cg = Symbol('h')\nphi_cg = Function('phi')(x_cg)\n\n# Second derivative stencil\nd2phi = D(phi_cg, (x_cg, 2))\nstencil_cg = Discretize(d2phi, {x_cg: ([x_cg - h_cg, x_cg, x_cg + h_cg], h_cg)})\n\n# Generate code in different languages\npython_code = StencilCodeGen(stencil_cg, language='python',\n                              array_name='phi', index_var='i', spacing_name='dx')\nc_code = StencilCodeGen(stencil_cg, language='c',\n                        array_name='phi', index_var='i', spacing_name='dx')\nfortran_code = StencilCodeGen(stencil_cg, language='fortran',\n                               array_name='phi', index_var='i', spacing_name='dx')\nlatex_code = StencilCodeGen(stencil_cg, language='latex')\n\nmo.md(f\"\"\"\n**Code Generation for** $\\\\partial^2\\\\phi/\\\\partial x^2$:\n\n**Python:**\n```python\nd2phi_dx2 = {python_code}\n```\n\n**C:**\n```c\ndouble d2phi_dx2 = {c_code};\n```\n\n**Fortran:**\n```fortran\nd2phi_dx2 = {fortran_code}\n```\n\n**LaTeX:**\n${latex_code}$\n\"\"\")", "code_hash": "9c56b5c105d4c512813dccfb85c643de", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "nWHF", "name": "_"}, {"code": "mo.md(r\"\"\"\n## 7. Complete Pipeline: Lagrangian to Simulation Code\n\nUsing symderive's `Pipe` API, we can chain the entire workflow.\n\"\"\")", "code_hash": "f04a8ce08b83eeaf0aec7af93a1b0d69", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "iLit", "name": "_"}, {"code": "# Complete pipeline example\nx_pipe, t_pipe = symbols('x t')\nh_pipe = Symbol('h')\npsi = Function('psi')(x_pipe, t_pipe)\n\n# Lagrangian for massless scalar field (1D)\nL_pipe = R(1, 2) * D(psi, t_pipe)**2 - R(1, 2) * D(psi, x_pipe)**2\n\n# Pipeline: Lagrangian -\u003E EoM -\u003E Discretize spatial part\neom_spatial = (\n    Pipe(L_pipe)\n    .then(VariationalDerivative, psi, [x_pipe, t_pipe])\n    .then(Discretize, {x_pipe: ([x_pipe - h_pipe, x_pipe, x_pipe + h_pipe], h_pipe)})\n    .value\n)\n\n# Generate simulation code\nsim_code = StencilCodeGen(eom_spatial, language='python',\n                           array_name='psi', index_var='i', spacing_name='dx')\n\nmo.md(f\"\"\"\n**Complete Pipeline:**\n\n1. Start with Lagrangian: $\\\\mathcal{{L}} = {L_pipe}$\n\n2. Derive equation of motion via variational derivative\n\n3. Discretize spatial derivatives\n\n4. Generate Python code:\n\n```python\n# Equation of motion (set to zero and solve for time evolution)\neom = {sim_code}\n```\n\nThis can be directly used in a time-stepping numerical scheme!\n\"\"\")", "code_hash": "6b04fb332e5e43163bf8e38f4424faaf", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ZHCJ", "name": "_"}, {"code": "mo.md(r\"\"\"\n## 8. Application: Initial Conditions from arXiv:1608.04408\n\nThe paper uses inhomogeneous initial conditions for the scalar field:\n\n$$\\phi(t=0, \\mathbf{x}) = \\phi_0 + \\frac{\\Delta\\phi}{N}\\sum_{n=1}^{N}\\left(\\cos\\frac{2\\pi nx}{L} + \\cos\\frac{2\\pi ny}{L} + \\cos\\frac{2\\pi nz}{L}\\right)$$\n\nWith initial velocity:\n$$\\frac{\\partial\\phi(t=0, \\mathbf{x})}{\\partial t} = 0$$\n\nThe gradient energy density is:\n$$\\rho_{\\mathrm{grad}} = \\frac{1}{2}\\gamma^{ij}\\partial_i\\phi\\partial_j\\phi$$\n\nLet's compute the discretized gradient energy.\n\"\"\")", "code_hash": "f161e6631f8b9ba308ecca45463b0ec5", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "ROlb", "name": "_"}, {"code": "# Gradient energy density discretization\nx_grad = Symbol('x')\nh_grad = Symbol('h')\nphi_grad = Function('phi')(x_grad)\n\n# Gradient energy: (1/2)(d phi/dx)^2\nrho_grad = R(1, 2) * D(phi_grad, x_grad)**2\n\n# Discretize\nrho_grad_discrete = Discretize(rho_grad, {x_grad: ([x_grad - h_grad, x_grad, x_grad + h_grad], h_grad)})\n\nmo.md(f\"\"\"\n**Gradient Energy Density (1D):**\n\nContinuous: $\\\\rho_{{\\\\mathrm{{grad}}}} = \\\\frac{{1}}{{2}}\\\\left(\\\\frac{{\\\\partial\\\\phi}}{{\\\\partial x}}\\\\right)^2$\n\nDiscretized: $\\\\rho_{{\\\\mathrm{{grad}}}} = {Simplify(rho_grad_discrete)}$\n\nThis uses the central difference approximation for the first derivative.\n\"\"\")", "code_hash": "1f0faaa9ee43c5a2c107bab824b5a9b8", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "qnkX", "name": "_"}, {"code": "mo.md(r\"\"\"\n## 9. Multi-Dimensional Stencils: The 3D Laplacian\n\nNumerical relativity simulations operate in 3D. The spatial Laplacian\nappears in the Hamiltonian constraint and evolution equations:\n\n$$\\nabla^2 \\phi = \\frac{\\partial^2\\phi}{\\partial x^2} + \\frac{\\partial^2\\phi}{\\partial y^2} + \\frac{\\partial^2\\phi}{\\partial z^2}$$\n\nEach term uses the standard second derivative stencil.\n\"\"\")", "code_hash": "8f8200457fd623a24f15a0490023bbb1", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "TqIu", "name": "_"}, {"code": "# 3D Laplacian\nx_3d, y_3d, z_3d = symbols('x y z')\nhx_3d, hy_3d, hz_3d = symbols('h_x h_y h_z')\nphi_3d = Function('phi')(x_3d, y_3d, z_3d)\n\n# Laplacian in 3D\nlaplacian_3d = D(phi_3d, (x_3d, 2)) + D(phi_3d, (y_3d, 2)) + D(phi_3d, (z_3d, 2))\n\n# Discretize with uniform spacing h\nh_uniform = symbols('h')\nstep_map_3d = {\n    x_3d: ([x_3d - h_uniform, x_3d, x_3d + h_uniform], h_uniform),\n    y_3d: ([y_3d - h_uniform, y_3d, y_3d + h_uniform], h_uniform),\n    z_3d: ([z_3d - h_uniform, z_3d, z_3d + h_uniform], h_uniform),\n}\nlaplacian_discrete = Discretize(laplacian_3d, step_map_3d)\n\n# Generate C code for the stencil\nc_laplacian = StencilCodeGen(\n    Discretize(D(phi_3d, (x_3d, 2)), {x_3d: ([x_3d - h_uniform, x_3d, x_3d + h_uniform], h_uniform)}),\n    language='c', array_name='phi', index_var='i', spacing_name='dx'\n)\n\nmo.md(f\"\"\"\n**3D Laplacian Stencil:**\n\nContinuous: $\\\\nabla^2\\\\phi = {laplacian_3d}$\n\nDiscretized (uniform grid $h$): ${Simplify(laplacian_discrete)}$\n\nThis is the classic 7-point stencil used in numerical relativity codes.\n\n**C code for one dimension** (repeat for j, k indices):\n```c\nd2phi_dx2 = {c_laplacian};\n```\n\"\"\")", "code_hash": "aae85e082d2c119e54469b0c5a7223b0", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Vxnm", "name": "_"}, {"code": "mo.md(r\"\"\"\n## 10. Stencil Accuracy: 2nd vs 4th vs 6th Order\n\nHigher-order stencils use more points but converge faster.\nThe truncation error scales as $O(h^n)$ where $n$ is the accuracy order.\n\n| Order | Points | Error Scaling | Use Case |\n|-------|--------|---------------|----------|\n| 2nd   | 3      | $O(h^2)$      | Simple problems, quick tests |\n| 4th   | 5      | $O(h^4)$      | Production simulations |\n| 6th   | 7      | $O(h^6)$      | High-precision work |\n| 8th   | 9      | $O(h^8)$      | Spectral-like accuracy |\n\"\"\")", "code_hash": "893b2f4924439dd4bedc976a3ab1fd5f", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "DnEU", "name": "_"}, {"code": "# Compare stencil orders for second derivative\nx_ord = Symbol('x')\nh_ord = Symbol('h')\nf_ord = Function('f')(x_ord)\n\nd2f = D(f_ord, (x_ord, 2))\n\nstencil_2nd = ToStencil(d2f, {x_ord: h_ord}, width=3)\nstencil_4th = ToStencil(d2f, {x_ord: h_ord}, width=5)\nstencil_6th = ToStencil(d2f, {x_ord: h_ord}, width=7)\n\nmo.md(f\"\"\"\n**Second Derivative Stencils by Order:**\n\n**2nd order (3-point):**\n${Simplify(stencil_2nd)}$\n\n**4th order (5-point):**\n${Simplify(stencil_4th)}$\n\n**6th order (7-point):**\n${Simplify(stencil_6th)}$\n\nNote how higher-order stencils have smaller coefficients on the outer points,\nreducing numerical dispersion.\n\"\"\")", "code_hash": "0df0ae3e0ac254c908f44291f50c6b44", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ulZA", "name": "_"}, {"code": "mo.md(r\"\"\"\n## 11. Mixed Derivatives and Cross Terms\n\nThe BSSN formulation of general relativity includes mixed partial derivatives\nlike $\\partial_x\\partial_y\\phi$. These require 2D stencils.\n\"\"\")", "code_hash": "b9202a698bfc2353395ba8dbb6d62f75", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "ecfG", "name": "_"}, {"code": "# Mixed derivative\nx_mix, y_mix = symbols('x y')\nh_mix = symbols('h')\nphi_mix = Function('phi')(x_mix, y_mix)\n\n# Mixed partial derivative\nd2_dxdy = D(D(phi_mix, x_mix), y_mix)\n\n# 9-point stencil for mixed derivative\nstep_map_mix = {\n    x_mix: ([x_mix - h_mix, x_mix, x_mix + h_mix], h_mix),\n    y_mix: ([y_mix - h_mix, y_mix, y_mix + h_mix], h_mix),\n}\nmixed_stencil = Discretize(d2_dxdy, step_map_mix)\n\nmo.md(f\"\"\"\n**Mixed Partial Derivative:**\n\nContinuous: $\\\\frac{{\\\\partial^2\\\\phi}}{{\\\\partial x\\\\partial y}}$\n\nDiscretized: ${Simplify(mixed_stencil)}$\n\nThis is the standard 4-corner stencil:\n```\n(-1)-----(0)-----(+1)\n  |       |       |\n(+1)    (0,0)   (+1)\n  |       |       |\n(-1)-----(0)-----(+1)\n```\nOnly the four corners contribute (with alternating signs).\n\"\"\")", "code_hash": "f9fdc8d21f038a3ddf9c106f078660ba", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Pvdt", "name": "_"}, {"code": "mo.md(r\"\"\"\n## 12. The ADM Evolution Equations\n\nIn numerical relativity, the ADM (Arnowitt-Deser-Misner) formalism evolves\nthe 3-metric $\\gamma_{ij}$ and extrinsic curvature $K_{ij}$:\n\n$$\\partial_t \\gamma_{ij} = -2\\alpha K_{ij} + \\mathcal{L}_\\beta \\gamma_{ij}$$\n\n$$\\partial_t K_{ij} = -D_i D_j \\alpha + \\alpha(R_{ij} + K K_{ij} - 2K_{ik}K^k{}_j) + \\mathcal{L}_\\beta K_{ij}$$\n\nThe spatial Ricci tensor $R_{ij}$ contains second derivatives of the metric,\nwhich we discretize using the stencils developed above.\n\"\"\")", "code_hash": "7c5d5b2187819a5544c20cabbaa48887", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "ZBYS", "name": "_"}, {"code": "# Simplified ADM-like term: second derivative of metric component\nx_adm, y_adm = symbols('x y')\nh_adm = symbols('h')\ngamma_xx = Function('gamma_xx')(x_adm, y_adm)\n\n# Part of the Ricci tensor: d^2(gamma_xx)/dx^2\nricci_term = D(gamma_xx, (x_adm, 2))\n\n# Discretize\nstep_adm = {x_adm: ([x_adm - h_adm, x_adm, x_adm + h_adm], h_adm)}\nricci_discrete = Discretize(ricci_term, step_adm)\n\n# Generate code\nricci_code = StencilCodeGen(ricci_discrete, language='c',\n                             array_name='gamma_xx', index_var='i', spacing_name='dx')\n\nmo.md(f\"\"\"\n**Ricci Tensor Component (simplified):**\n\nOne term in $R_{{xx}}$ involves: $\\\\frac{{\\\\partial^2 \\\\gamma_{{xx}}}}{{\\\\partial x^2}}$\n\nDiscretized: ${Simplify(ricci_discrete)}$\n\n**C code:**\n```c\ndouble d2gamma_dx2 = {ricci_code};\n```\n\nThe full Ricci tensor has many such terms for each metric component.\nDerive automates the error-prone process of deriving and coding each stencil.\n\"\"\")", "code_hash": "0424f95fef236e9f30588b57a0e64afb", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "aLJB", "name": "_"}, {"code": "mo.md(r\"\"\"\n## 13. Using the Metric Class for Tensor Calculus\n\nsymderive's `diffgeo` module provides a `Metric` class for full tensor calculus.\nThis computes Christoffel symbols, Riemann tensor, and Ricci tensor automatically.\n\nFor numerical relativity, these tensors contain the derivatives we need to discretize.\n\"\"\")", "code_hash": "16445858bfe2047f4f97e3972f5afcb0", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "nHfw", "name": "_"}, {"code": "# Define a general 2D metric (simplified example)\nx_m, y_m = symbols('x y', real=True)\n\n# Metric components as symbols (would be functions in full NR)\ng_xx = Symbol('g_xx', positive=True)\ng_yy = Symbol('g_yy', positive=True)\n\n# Create a diagonal metric: ds^2 = g_xx dx^2 + g_yy dy^2\n# Metric(coords, components)\nmetric_2d = Metric(\n    [x_m, y_m],\n    [[g_xx, 0],\n     [0, g_yy]]\n)\n\n# Christoffel symbols contain first derivatives of the metric\nchristoffels = metric_2d.christoffel_second_kind()\n\n# Example: Gamma^x_xx = (1/2) g^xx * d(g_xx)/dx\nGamma_x_xx = Simplify(christoffels[0, 0, 0])\n\n(metric_2d.g, Gamma_x_xx)", "code_hash": "0bbfce999b0c429681324c7697755c3e", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "xXTn", "name": "_"}, {"code": "# Now discretize a Christoffel-like term\n# Gamma^i_jk involves d(g_jk)/dx^i, so we discretize metric derivatives\nx_chr, y_chr = symbols('x y')\nh_chr = symbols('h')\n\n# Metric component as a function of position\ng_xx_func = Function('g_xx')(x_chr, y_chr)\n\n# The derivative that appears in Christoffel symbols\ndg_dx = D(g_xx_func, x_chr)\n\n# Discretize using central difference\nstep_chr = {x_chr: ([x_chr - h_chr, x_chr, x_chr + h_chr], h_chr)}\ndg_discrete = Discretize(dg_dx, step_chr)\n\n# Code for Christoffel computation\nchr_code = StencilCodeGen(dg_discrete, language='c',\n                           array_name='g_xx', index_var='i', spacing_name='dx')\n\nmo.md(f\"\"\"\n**Discretizing Christoffel Symbol Terms:**\n\nChristoffel symbols involve metric derivatives like $\\\\partial_x g_{{xx}}$\n\nDiscretized: ${Simplify(dg_discrete)}$\n\n**C code:**\n```c\n// dg_xx/dx for Christoffel computation\ndouble dg_dx = {chr_code};\n\n// Then Gamma^x_xx = 0.5 * g_xx_inv * dg_dx\ndouble Gamma_x_xx = 0.5 * g_xx_inv * dg_dx;\n```\n\nThe full BSSN evolution uses these discretized Christoffels throughout.\n\"\"\")", "code_hash": "19d6ca2ccbd0c1603163c8f190dece02", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "AjVT", "name": "_"}, {"code": "mo.md(r\"\"\"\n## 14. Kreiss-Oliger Dissipation\n\nNumerical simulations often add artificial dissipation to control\nhigh-frequency noise. The Kreiss-Oliger operator for 4th order schemes:\n\n$$\\epsilon (-1)^{r+1} h^{2r-1} D_+^r D_-^r \\phi$$\n\nwhere $D_+$ and $D_-$ are forward/backward difference operators.\nFor $r=2$ this gives a 5-point dissipation stencil.\n\"\"\")", "code_hash": "d468de59abae8f483dd99464987d5c71", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "pHFh", "name": "_"}, {"code": "# Kreiss-Oliger dissipation (4th derivative for 4th order scheme)\nx_ko = Symbol('x')\nh_ko = Symbol('h')\neps = Symbol('epsilon')\nphi_ko = Function('phi')(x_ko)\n\n# Fourth derivative (appears in Kreiss-Oliger for 4th order methods)\nd4_phi = D(phi_ko, (x_ko, 4))\n\n# Discretize with 5-point stencil\nko_stencil = ToStencil(d4_phi, {x_ko: h_ko}, width=5)\n\nmo.md(f\"\"\"\n**Kreiss-Oliger Dissipation Term:**\n\nFourth derivative: $\\\\frac{{\\\\partial^4\\\\phi}}{{\\\\partial x^4}}$\n\nDiscretized: ${Simplify(ko_stencil)}$\n\nApplied as: $\\\\phi \\\\leftarrow \\\\phi - \\\\epsilon \\\\cdot h^3 \\\\cdot (\\\\text{{stencil}})$\n\nThe coefficient $\\\\epsilon \\\\sim 0.1$ controls dissipation strength.\n\"\"\")", "code_hash": "51695d4ceeae108f7e2f1101e5887e36", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "NCOB", "name": "_"}, {"code": "mo.md(r\"\"\"\n## Summary\n\nThis notebook demonstrated the complete pipeline from theoretical physics\nto production-ready numerical simulation code:\n\n**Physics to Code Pipeline:**\n1. **Variational Calculus**: Derive equations of motion from Lagrangians\n2. **Discretization**: Convert PDEs to finite difference stencils\n3. **Multi-dimensional**: Handle 3D Laplacians, mixed derivatives\n4. **Code Generation**: Output C, Fortran, or Python for direct use\n\n**Numerical Relativity Applications:**\n- 3D Laplacian (7-point stencil) for constraint equations\n- Mixed derivatives for BSSN formulation\n- ADM evolution equations with Ricci tensor terms\n- Metric class for Christoffel symbols and curvature tensors\n- Kreiss-Oliger dissipation for numerical stability\n\n**Accuracy Control:**\n- 2nd order (3-point) to 8th order (9-point) stencils\n- Error scaling from $O(h^2)$ to $O(h^8)$\n\nThis workflow is directly applicable to numerical relativity codes like\nGRChombo (used in arXiv:1608.04408) for simulating inflation with\ninhomogeneous initial conditions.\n\n### Key Functions:\n- `VariationalDerivative(L, field, coords)` - Euler-Lagrange equations\n- `Discretize(expr, step_map)` - Finite difference conversion\n- `ToStencil(expr, spacing, width)` - Auto-generate stencil points\n- `StencilCodeGen(expr, language)` - C/Fortran/Python code generation\n- `Metric(components, coords)` - Tensor calculus with auto Christoffels\n- `Pipe(expr).then(...)` - Composable API for chaining operations\n\"\"\")", "code_hash": "ee21d46b53a81bded8a1252e30d39c99", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "aqbW", "name": "_"}], "metadata": {"marimo_version": "0.19.4"}, "version": "1"},
            "session": {"cells": [{"code_hash": "095a172ae9c2d40f9c08a35643153f2e", "console": [], "id": "Hbol", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "aa894c51804a86d54d28ea1eb9ec8f64", "console": [], "id": "MJUe", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch1 id=\"from-lagrangians-to-numerical-stencils\"\u003EFrom Lagrangians to Numerical Stencils\u003C/h1\u003E\n\u003Cspan class=\"paragraph\"\u003EThis notebook demonstrates the complete pipeline from theoretical physics to\nnumerical simulation code, based on the scalar field dynamics in\n\u003Ca href=\"https://arxiv.org/abs/1608.04408\" rel=\"noopener noreferrer\" target=\"_blank\"\u003EarXiv:1608.04408\u003C/a\u003E.\u003C/span\u003E\n\u003Ch2 id=\"the-physics\"\u003EThe Physics\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003ESingle-field inflation uses a scalar field with canonical kinetic term:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\mathcal{L}_\\phi = -\\frac{1}{2}g^{\\mu\\nu}\\partial_\\mu \\phi \\partial_\\nu\\phi - V(\\phi)||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EThe Klein-Gordon equation governing the field dynamics is:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\partial_t^2 \\phi - \\gamma^{ij}\\partial_i\\partial_j\\phi + \\frac{dV}{d\\phi} = 0||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EWe will derive this equation using variational calculus, then convert it to\nfinite difference form suitable for numerical simulation.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "ef619372213def2193ad8b4f3091e656", "console": [], "id": "vblA", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"1-deriving-the-klein-gordon-equation\"\u003E1. Deriving the Klein-Gordon Equation\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EStarting from the scalar field Lagrangian density in flat spacetime:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\mathcal{L} = \\frac{1}{2}(\\partial_t\\phi)^2 - \\frac{1}{2}(\\partial_x\\phi)^2 - V(\\phi)||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EThe Euler-Lagrange equation gives us the equation of motion.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "dc3cb2aa9e0bc22a30db730bef4c5b1d", "console": [], "id": "bkHC", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EKlein-Gordon Lagrangian:\u003C/strong\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathcal{L} = -m**2*phi(x, t)**2/2 + Derivative(phi(x, t), t)**2/2 - Derivative(phi(x, t), x)**2/2||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EEquation of Motion\u003C/strong\u003E (\u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\delta\\mathcal{L}/\\delta\\phi = 0||)\u003C/marimo-tex\u003E):\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||(-m**2*phi(x, t) - Derivative(phi(x, t), (t, 2)) + Derivative(phi(x, t), (x, 2)) = 0||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThis is the Klein-Gordon equation: \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\partial_t^2\\phi - \\partial_x^2\\phi + m^2\\phi = 0||)\u003C/marimo-tex\u003E\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "2ad9148c2c704baf2783bde751eb7528", "console": [], "id": "lEQa", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"2-the-wave-equation-massless-limit\"\u003E2. The Wave Equation (Massless Limit)\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003ESetting \u003Cmarimo-tex class=\"arithmatex\"\u003E||(m = 0||)\u003C/marimo-tex\u003E gives the wave equation, which appears in the gradient energy\ndominated regime of inflation simulations.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "4974274fcaa72bf7448df279a1076dea", "console": [], "id": "PKri", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EWave Equation Lagrangian:\u003C/strong\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathcal{L} = Derivative(phi(x, t), t)**2/2 - Derivative(phi(x, t), x)**2/2||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EEquation of Motion:\u003C/strong\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||(-Derivative(phi(x, t), (t, 2)) + Derivative(phi(x, t), (x, 2)) = 0||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThis gives: \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\partial_t^2\\phi = \\partial_x^2\\phi||)\u003C/marimo-tex\u003E (the wave equation)\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "d2b078888c346c406b4ffc0e3d542833", "console": [], "id": "Xref", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"3-converting-to-finite-differences\"\u003E3. Converting to Finite Differences\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EFor numerical simulation, we need to discretize the spatial derivatives.\nThe \u003Ccode\u003EDiscretize\u003C/code\u003E function converts symbolic derivatives to finite difference\napproximations using Taylor series matching.\u003C/span\u003E\n\u003Ch3 id=\"central-difference-stencils\"\u003ECentral Difference Stencils\u003C/h3\u003E\n\u003Cspan class=\"paragraph\"\u003EFor a 3-point central difference:\u003C/span\u003E\n\u003Cul\u003E\n\u003Cli\u003EFirst derivative: \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\frac{\\partial f}{\\partial x} \\approx \\frac{f(x+h) - f(x-h)}{2h}||)\u003C/marimo-tex\u003E\u003C/li\u003E\n\u003Cli\u003ESecond derivative: \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\frac{\\partial^2 f}{\\partial x^2} \\approx \\frac{f(x+h) - 2f(x) + f(x-h)}{h^2}||)\u003C/marimo-tex\u003E\u003C/li\u003E\n\u003C/ul\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "c945b0fe700ad5df110da478490f731e", "console": [], "id": "SFPL", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003ESecond Derivative Discretization (3-point central):\u003C/strong\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003ESymbolic: \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\frac{\\partial^2 f}{\\partial x^2}||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EDiscretized: \u003Cmarimo-tex class=\"arithmatex\"\u003E||((-2*f(x) + f(-h + x) + f(h + x))/h**2||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThis is the standard 3-point stencil: \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\frac{f_{i+1} - 2f_i + f_{i-1}}{h^2}||)\u003C/marimo-tex\u003E\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "7ae68c0dce193c396363187e61ecc484", "console": [], "id": "BYtC", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"4-discretizing-the-wave-equation\"\u003E4. Discretizing the Wave Equation\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003ENow let's discretize the full wave equation for numerical simulation.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "0aceb9bc459f0706db94d4e70fb03fa7", "console": [], "id": "RGSE", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EWave Equation:\u003C/strong\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\frac{\\partial^2 u}{\\partial t^2} - \\frac{\\partial^2 u}{\\partial x^2} = 0||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EDiscretized Form:\u003C/strong\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||((h_t**2*(2*u(x, t) - u(-h_x + x, t) - u(h_x + x, t)) + h_x**2*(-2*u(x, t) + u(x, -h_t + t) + u(x, h_t + t)))/(h_t**2*h_x**2) = 0||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003ERearranging for time-stepping: \u003Cmarimo-tex class=\"arithmatex\"\u003E||(u(x, t+h_t) = 2u(x,t) - u(x, t-h_t) + \\frac{h_t^2}{h_x^2}[u(x+h_x,t) - 2u(x,t) + u(x-h_x,t)]||)\u003C/marimo-tex\u003E\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "e99f053a0c14bb1aa9f048aa1c0a5a89", "console": [], "id": "Kclp", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"5-higher-order-stencils\"\u003E5. Higher-Order Stencils\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EFor better accuracy, we can use wider stencils. The \u003Ccode\u003EToStencil\u003C/code\u003E function\nautomatically generates symmetric stencil points.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "4c59ba741f267912115f04af0d8893c5", "console": [], "id": "emfo", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EFirst Derivative Stencils:\u003C/strong\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E3-point: \u003Cmarimo-tex class=\"arithmatex\"\u003E||((-f(-h + x) + f(h + x))/(2*h)||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E5-point: \u003Cmarimo-tex class=\"arithmatex\"\u003E||((f(-2*h + x) - 8*f(-h + x) + 8*f(h + x) - f(2*h + x))/(12*h)||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe 5-point stencil provides 4th-order accuracy vs 2nd-order for 3-point.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "1eee4a892de39e1599bc7731c39f2d9a", "console": [], "id": "Hstk", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"6-code-generation\"\u003E6. Code Generation\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EThe \u003Ccode\u003EStencilCodeGen\u003C/code\u003E function converts discretized expressions to code\nin multiple programming languages - useful for generating numerical\nrelativity simulation code.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "9c56b5c105d4c512813dccfb85c643de", "console": [], "id": "nWHF", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003ECode Generation for\u003C/strong\u003E \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\partial^2\\phi/\\partial x^2||)\u003C/marimo-tex\u003E:\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EPython:\u003C/strong\u003E\n\u003Cdiv class=\"language-python codehilite\"\u003E\u003Cpre\u003E\u003Cspan\u003E\u003C/span\u003E\u003Ccode\u003E\u003Cspan class=\"n\"\u003Ed2phi_dx2\u003C/span\u003E \u003Cspan class=\"o\"\u003E=\u003C/span\u003E \u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"mi\"\u003E2\u003C/span\u003E\u003Cspan class=\"o\"\u003E*\u003C/span\u003E\u003Cspan class=\"n\"\u003Epdxi\u003C/span\u003E\u003Cspan class=\"p\"\u003E[\u003C/span\u003E\u003Cspan class=\"n\"\u003Ei\u003C/span\u003E\u003Cspan class=\"p\"\u003E]\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"o\"\u003E**\u003C/span\u003E\u003Cspan class=\"mi\"\u003E2\u003C/span\u003E \u003Cspan class=\"o\"\u003E+\u003C/span\u003E \u003Cspan class=\"n\"\u003Epdxi\u003C/span\u003E\u003Cspan class=\"p\"\u003E[\u003C/span\u003E\u003Cspan class=\"n\"\u003Ei\u003C/span\u003E \u003Cspan class=\"o\"\u003E+\u003C/span\u003E \u003Cspan class=\"mi\"\u003E1\u003C/span\u003E\u003Cspan class=\"p\"\u003E]\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"o\"\u003E**\u003C/span\u003E\u003Cspan class=\"mi\"\u003E2\u003C/span\u003E \u003Cspan class=\"o\"\u003E+\u003C/span\u003E \u003Cspan class=\"n\"\u003Epdxi\u003C/span\u003E\u003Cspan class=\"p\"\u003E[\u003C/span\u003E\u003Cspan class=\"n\"\u003Ei\u003C/span\u003E \u003Cspan class=\"o\"\u003E-\u003C/span\u003E \u003Cspan class=\"mi\"\u003E1\u003C/span\u003E\u003Cspan class=\"p\"\u003E]\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"o\"\u003E**\u003C/span\u003E\u003Cspan class=\"mi\"\u003E2\u003C/span\u003E\n\u003C/code\u003E\u003C/pre\u003E\u003C/div\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EC:\u003C/strong\u003E\n\u003Cdiv class=\"language-c codehilite\"\u003E\u003Cpre\u003E\u003Cspan\u003E\u003C/span\u003E\u003Ccode\u003E\u003Cspan class=\"kt\"\u003Edouble\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Ed2phi_dx2\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E=\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"mi\"\u003E-2\u003C/span\u003E\u003Cspan class=\"o\"\u003E*\u003C/span\u003E\u003Cspan class=\"n\"\u003Epdxi\u003C/span\u003E\u003Cspan class=\"p\"\u003E[\u003C/span\u003E\u003Cspan class=\"n\"\u003Ei\u003C/span\u003E\u003Cspan class=\"p\"\u003E]\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"o\"\u003E**\u003C/span\u003E\u003Cspan class=\"mi\"\u003E2\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Epdxi\u003C/span\u003E\u003Cspan class=\"p\"\u003E[\u003C/span\u003E\u003Cspan class=\"n\"\u003Ei\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"mi\"\u003E1\u003C/span\u003E\u003Cspan class=\"p\"\u003E]\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"o\"\u003E**\u003C/span\u003E\u003Cspan class=\"mi\"\u003E2\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Epdxi\u003C/span\u003E\u003Cspan class=\"p\"\u003E[\u003C/span\u003E\u003Cspan class=\"n\"\u003Ei\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"mi\"\u003E1\u003C/span\u003E\u003Cspan class=\"p\"\u003E]\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"o\"\u003E**\u003C/span\u003E\u003Cspan class=\"mi\"\u003E2\u003C/span\u003E\u003Cspan class=\"p\"\u003E;\u003C/span\u003E\n\u003C/code\u003E\u003C/pre\u003E\u003C/div\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EFortran:\u003C/strong\u003E\n\u003Cdiv class=\"language-fortran codehilite\"\u003E\u003Cpre\u003E\u003Cspan\u003E\u003C/span\u003E\u003Ccode\u003E\u003Cspan class=\"n\"\u003Ed2phi_dx2\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E=\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"mi\"\u003E2\u003C/span\u003E\u003Cspan class=\"o\"\u003E*\u003C/span\u003E\u003Cspan class=\"n\"\u003Epdxi\u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Ei\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"o\"\u003E**\u003C/span\u003E\u003Cspan class=\"mi\"\u003E2\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Epdxi\u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Ei\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"mi\"\u003E1\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"o\"\u003E**\u003C/span\u003E\u003Cspan class=\"mi\"\u003E2\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Epdxi\u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Ei\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"mi\"\u003E1\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"o\"\u003E**\u003C/span\u003E\u003Cspan class=\"mi\"\u003E2\u003C/span\u003E\n\u003C/code\u003E\u003C/pre\u003E\u003C/div\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003ELaTeX:\u003C/strong\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||(- \\frac{2 \\phi{\\left(x \\right)}}{h^{2}} + \\frac{\\phi{\\left(- h + x \\right)}}{h^{2}} + \\frac{\\phi{\\left(h + x \\right)}}{h^{2}}||)\u003C/marimo-tex\u003E\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "f04a8ce08b83eeaf0aec7af93a1b0d69", "console": [], "id": "iLit", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"7-complete-pipeline-lagrangian-to-simulation-code\"\u003E7. Complete Pipeline: Lagrangian to Simulation Code\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EUsing symderive's \u003Ccode\u003EPipe\u003C/code\u003E API, we can chain the entire workflow.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "6b04fb332e5e43163bf8e38f4424faaf", "console": [], "id": "ZHCJ", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EComplete Pipeline:\u003C/strong\u003E\u003C/span\u003E\n\u003Col\u003E\n\u003Cli\u003EStart with Lagrangian: \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathcal{L} = Derivative(psi(x, t), t)**2/2 - Derivative(psi(x, t), x)**2/2||)\u003C/marimo-tex\u003E\u003C/li\u003E\n\u003Cli\u003EDerive equation of motion via variational derivative\u003C/li\u003E\n\u003Cli\u003EDiscretize spatial derivatives\u003C/li\u003E\n\u003Cli\u003EGenerate Python code:\u003C/li\u003E\n\u003C/ol\u003E\n\u003Cdiv class=\"language-python codehilite\"\u003E\u003Cpre\u003E\u003Cspan\u003E\u003C/span\u003E\u003Ccode\u003E\u003Cspan class=\"c1\"\u003E# Equation of motion (set to zero and solve for time evolution)\u003C/span\u003E\n\u003Cspan class=\"n\"\u003Eeom\u003C/span\u003E \u003Cspan class=\"o\"\u003E=\u003C/span\u003E \u003Cspan class=\"n\"\u003Epsi\u003C/span\u003E\u003Cspan class=\"p\"\u003E[\u003C/span\u003E\u003Cspan class=\"n\"\u003Ei\u003C/span\u003E \u003Cspan class=\"o\"\u003E+\u003C/span\u003E \u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E \u003Cspan class=\"o\"\u003E-\u003C/span\u003E \u003Cspan class=\"n\"\u003Et\u003C/span\u003E \u003Cspan class=\"o\"\u003E+\u003C/span\u003E \u003Cspan class=\"n\"\u003Ex\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"p\"\u003E]\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"o\"\u003E**\u003C/span\u003E\u003Cspan class=\"mi\"\u003E2\u003C/span\u003E \u003Cspan class=\"o\"\u003E+\u003C/span\u003E \u003Cspan class=\"n\"\u003Epsi\u003C/span\u003E\u003Cspan class=\"p\"\u003E[\u003C/span\u003E\u003Cspan class=\"n\"\u003Ei\u003C/span\u003E \u003Cspan class=\"o\"\u003E+\u003C/span\u003E \u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E \u003Cspan class=\"o\"\u003E-\u003C/span\u003E \u003Cspan class=\"n\"\u003Et\u003C/span\u003E \u003Cspan class=\"o\"\u003E+\u003C/span\u003E \u003Cspan class=\"n\"\u003Ex\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"p\"\u003E]\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"o\"\u003E**\u003C/span\u003E\u003Cspan class=\"mi\"\u003E2\u003C/span\u003E \u003Cspan class=\"o\"\u003E-\u003C/span\u003E \u003Cspan class=\"mi\"\u003E2\u003C/span\u003E\u003Cspan class=\"o\"\u003E*\u003C/span\u003E\u003Cspan class=\"n\"\u003Epsi\u003C/span\u003E\u003Cspan class=\"p\"\u003E[\u003C/span\u003E\u003Cspan class=\"n\"\u003Ei\u003C/span\u003E \u003Cspan class=\"o\"\u003E+\u003C/span\u003E \u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"n\"\u003Et\u003C/span\u003E \u003Cspan class=\"o\"\u003E+\u003C/span\u003E \u003Cspan class=\"n\"\u003Ex\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"p\"\u003E]\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"o\"\u003E**\u003C/span\u003E\u003Cspan class=\"mi\"\u003E2\u003C/span\u003E \u003Cspan class=\"o\"\u003E-\u003C/span\u003E \u003Cspan class=\"n\"\u003EDerivative\u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Epsi\u003C/span\u003E\u003Cspan class=\"p\"\u003E[\u003C/span\u003E\u003Cspan class=\"n\"\u003Ei\u003C/span\u003E \u003Cspan class=\"o\"\u003E+\u003C/span\u003E \u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"n\"\u003Et\u003C/span\u003E \u003Cspan class=\"o\"\u003E+\u003C/span\u003E \u003Cspan class=\"n\"\u003Ex\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"p\"\u003E],\u003C/span\u003E \u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Et\u003C/span\u003E\u003Cspan class=\"p\"\u003E,\u003C/span\u003E \u003Cspan class=\"mi\"\u003E2\u003C/span\u003E\u003Cspan class=\"p\"\u003E))\u003C/span\u003E\n\u003C/code\u003E\u003C/pre\u003E\u003C/div\u003E\n\u003Cspan class=\"paragraph\"\u003EThis can be directly used in a time-stepping numerical scheme!\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "f161e6631f8b9ba308ecca45463b0ec5", "console": [], "id": "ROlb", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"8-application-initial-conditions-from-arxiv160804408\"\u003E8. Application: Initial Conditions from arXiv:1608.04408\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EThe paper uses inhomogeneous initial conditions for the scalar field:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\phi(t=0, \\mathbf{x}) = \\phi_0 + \\frac{\\Delta\\phi}{N}\\sum_{n=1}^{N}\\left(\\cos\\frac{2\\pi nx}{L} + \\cos\\frac{2\\pi ny}{L} + \\cos\\frac{2\\pi nz}{L}\\right)||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EWith initial velocity:\n$\u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\frac{\\partial\\phi(t=0, \\mathbf{x})}{\\partial t} = 0||)\u003C/marimo-tex\u003E$\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe gradient energy density is:\n$\u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\rho_{\\mathrm{grad}} = \\frac{1}{2}\\gamma^{ij}\\partial_i\\phi\\partial_j\\phi||)\u003C/marimo-tex\u003E$\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003ELet's compute the discretized gradient energy.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "1f0faaa9ee43c5a2c107bab824b5a9b8", "console": [], "id": "qnkX", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EGradient Energy Density (1D):\u003C/strong\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EContinuous: \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\rho_{\\mathrm{grad}} = \\frac{1}{2}\\left(\\frac{\\partial\\phi}{\\partial x}\\right)^2||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EDiscretized: \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\rho_{\\mathrm{grad}} = (phi(-h + x) - phi(h + x))**2/(8*h**2)||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThis uses the central difference approximation for the first derivative.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "8f8200457fd623a24f15a0490023bbb1", "console": [], "id": "TqIu", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"9-multi-dimensional-stencils-the-3d-laplacian\"\u003E9. Multi-Dimensional Stencils: The 3D Laplacian\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003ENumerical relativity simulations operate in 3D. The spatial Laplacian\nappears in the Hamiltonian constraint and evolution equations:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\nabla^2 \\phi = \\frac{\\partial^2\\phi}{\\partial x^2} + \\frac{\\partial^2\\phi}{\\partial y^2} + \\frac{\\partial^2\\phi}{\\partial z^2}||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EEach term uses the standard second derivative stencil.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "aae85e082d2c119e54469b0c5a7223b0", "console": [], "id": "Vxnm", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003E3D Laplacian Stencil:\u003C/strong\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EContinuous: \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\nabla^2\\phi = Derivative(phi(x, y, z), (x, 2)) + Derivative(phi(x, y, z), (y, 2)) + Derivative(phi(x, y, z), (z, 2))||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EDiscretized (uniform grid \u003Cmarimo-tex class=\"arithmatex\"\u003E||(h||)\u003C/marimo-tex\u003E): \u003Cmarimo-tex class=\"arithmatex\"\u003E||((-6*phi(x, y, z) + phi(x, y, -h + z) + phi(x, y, h + z) + phi(x, -h + y, z) + phi(x, h + y, z) + phi(-h + x, y, z) + phi(h + x, y, z))/h**2||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThis is the classic 7-point stencil used in numerical relativity codes.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EC code for one dimension\u003C/strong\u003E (repeat for j, k indices):\n\u003Cdiv class=\"language-c codehilite\"\u003E\u003Cpre\u003E\u003Cspan\u003E\u003C/span\u003E\u003Ccode\u003E\u003Cspan class=\"n\"\u003Ed2phi_dx2\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E=\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"mi\"\u003E-2\u003C/span\u003E\u003Cspan class=\"o\"\u003E*\u003C/span\u003E\u003Cspan class=\"n\"\u003Epdxi\u003C/span\u003E\u003Cspan class=\"p\"\u003E[\u003C/span\u003E\u003Cspan class=\"n\"\u003Ei\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Ex\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Ez\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"p\"\u003E]\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"o\"\u003E**\u003C/span\u003E\u003Cspan class=\"mi\"\u003E2\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Epdxi\u003C/span\u003E\u003Cspan class=\"p\"\u003E[\u003C/span\u003E\u003Cspan class=\"n\"\u003Ei\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Ex\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Ez\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"p\"\u003E]\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"o\"\u003E**\u003C/span\u003E\u003Cspan class=\"mi\"\u003E2\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Epdxi\u003C/span\u003E\u003Cspan class=\"p\"\u003E[\u003C/span\u003E\u003Cspan class=\"n\"\u003Ei\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Ex\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Ez\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"p\"\u003E]\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"o\"\u003E**\u003C/span\u003E\u003Cspan class=\"mi\"\u003E2\u003C/span\u003E\u003Cspan class=\"p\"\u003E;\u003C/span\u003E\n\u003C/code\u003E\u003C/pre\u003E\u003C/div\u003E\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "893b2f4924439dd4bedc976a3ab1fd5f", "console": [], "id": "DnEU", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"10-stencil-accuracy-2nd-vs-4th-vs-6th-order\"\u003E10. Stencil Accuracy: 2nd vs 4th vs 6th Order\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EHigher-order stencils use more points but converge faster.\nThe truncation error scales as \u003Cmarimo-tex class=\"arithmatex\"\u003E||(O(h^n)||)\u003C/marimo-tex\u003E where \u003Cmarimo-tex class=\"arithmatex\"\u003E||(n||)\u003C/marimo-tex\u003E is the accuracy order.\u003C/span\u003E\n\u003Ctable\u003E\n\u003Cthead\u003E\n\u003Ctr\u003E\n\u003Cth\u003EOrder\u003C/th\u003E\n\u003Cth\u003EPoints\u003C/th\u003E\n\u003Cth\u003EError Scaling\u003C/th\u003E\n\u003Cth\u003EUse Case\u003C/th\u003E\n\u003C/tr\u003E\n\u003C/thead\u003E\n\u003Ctbody\u003E\n\u003Ctr\u003E\n\u003Ctd\u003E2nd\u003C/td\u003E\n\u003Ctd\u003E3\u003C/td\u003E\n\u003Ctd\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||(O(h^2)||)\u003C/marimo-tex\u003E\u003C/td\u003E\n\u003Ctd\u003ESimple problems, quick tests\u003C/td\u003E\n\u003C/tr\u003E\n\u003Ctr\u003E\n\u003Ctd\u003E4th\u003C/td\u003E\n\u003Ctd\u003E5\u003C/td\u003E\n\u003Ctd\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||(O(h^4)||)\u003C/marimo-tex\u003E\u003C/td\u003E\n\u003Ctd\u003EProduction simulations\u003C/td\u003E\n\u003C/tr\u003E\n\u003Ctr\u003E\n\u003Ctd\u003E6th\u003C/td\u003E\n\u003Ctd\u003E7\u003C/td\u003E\n\u003Ctd\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||(O(h^6)||)\u003C/marimo-tex\u003E\u003C/td\u003E\n\u003Ctd\u003EHigh-precision work\u003C/td\u003E\n\u003C/tr\u003E\n\u003Ctr\u003E\n\u003Ctd\u003E8th\u003C/td\u003E\n\u003Ctd\u003E9\u003C/td\u003E\n\u003Ctd\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||(O(h^8)||)\u003C/marimo-tex\u003E\u003C/td\u003E\n\u003Ctd\u003ESpectral-like accuracy\u003C/td\u003E\n\u003C/tr\u003E\n\u003C/tbody\u003E\n\u003C/table\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "0df0ae3e0ac254c908f44291f50c6b44", "console": [], "id": "ulZA", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003ESecond Derivative Stencils by Order:\u003C/strong\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003E2nd order (3-point):\u003C/strong\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||((-2*f(x) + f(-h + x) + f(h + x))/h**2||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003E4th order (5-point):\u003C/strong\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||((-30*f(x) - f(-2*h + x) + 16*f(-h + x) + 16*f(h + x) - f(2*h + x))/(12*h**2)||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003E6th order (7-point):\u003C/strong\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||((-490*f(x) + 2*f(-3*h + x) - 27*f(-2*h + x) + 270*f(-h + x) + 270*f(h + x) - 27*f(2*h + x) + 2*f(3*h + x))/(180*h**2)||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003ENote how higher-order stencils have smaller coefficients on the outer points,\nreducing numerical dispersion.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "b9202a698bfc2353395ba8dbb6d62f75", "console": [], "id": "ecfG", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"11-mixed-derivatives-and-cross-terms\"\u003E11. Mixed Derivatives and Cross Terms\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EThe BSSN formulation of general relativity includes mixed partial derivatives\nlike \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\partial_x\\partial_y\\phi||)\u003C/marimo-tex\u003E. These require 2D stencils.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "f9fdc8d21f038a3ddf9c106f078660ba", "console": [], "id": "Pvdt", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EMixed Partial Derivative:\u003C/strong\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EContinuous: \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\frac{\\partial^2\\phi}{\\partial x\\partial y}||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EDiscretized: \u003Cmarimo-tex class=\"arithmatex\"\u003E||((phi(-h + x, -h + x) - phi(-h + x, h + x) - phi(h + x, -h + x) + phi(h + x, h + x))/(4*h**2)||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThis is the standard 4-corner stencil:\n\u003Cdiv class=\"language-text codehilite\"\u003E\u003Cpre\u003E\u003Cspan\u003E\u003C/span\u003E\u003Ccode\u003E(-1)-----(0)-----(+1)\n  |       |       |\n(+1)    (0,0)   (+1)\n  |       |       |\n(-1)-----(0)-----(+1)\n\u003C/code\u003E\u003C/pre\u003E\u003C/div\u003E\nOnly the four corners contribute (with alternating signs).\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "7c5d5b2187819a5544c20cabbaa48887", "console": [], "id": "ZBYS", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"12-the-adm-evolution-equations\"\u003E12. The ADM Evolution Equations\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EIn numerical relativity, the ADM (Arnowitt-Deser-Misner) formalism evolves\nthe 3-metric \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\gamma_{ij}||)\u003C/marimo-tex\u003E and extrinsic curvature \u003Cmarimo-tex class=\"arithmatex\"\u003E||(K_{ij}||)\u003C/marimo-tex\u003E:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\partial_t \\gamma_{ij} = -2\\alpha K_{ij} + \\mathcal{L}_\\beta \\gamma_{ij}||]\u003C/marimo-tex\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\partial_t K_{ij} = -D_i D_j \\alpha + \\alpha(R_{ij} + K K_{ij} - 2K_{ik}K^k{}_j) + \\mathcal{L}_\\beta K_{ij}||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EThe spatial Ricci tensor \u003Cmarimo-tex class=\"arithmatex\"\u003E||(R_{ij}||)\u003C/marimo-tex\u003E contains second derivatives of the metric,\nwhich we discretize using the stencils developed above.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "0424f95fef236e9f30588b57a0e64afb", "console": [], "id": "aLJB", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003ERicci Tensor Component (simplified):\u003C/strong\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EOne term in \u003Cmarimo-tex class=\"arithmatex\"\u003E||(R_{xx}||)\u003C/marimo-tex\u003E involves: \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\frac{\\partial^2 \\gamma_{xx}}{\\partial x^2}||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EDiscretized: \u003Cmarimo-tex class=\"arithmatex\"\u003E||((-2*gamma_xx(x, y) + gamma_xx(-h + x, y) + gamma_xx(h + x, y))/h**2||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EC code:\u003C/strong\u003E\n\u003Cdiv class=\"language-c codehilite\"\u003E\u003Cpre\u003E\u003Cspan\u003E\u003C/span\u003E\u003Ccode\u003E\u003Cspan class=\"kt\"\u003Edouble\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Ed2gamma_dx2\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E=\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"mi\"\u003E-2\u003C/span\u003E\u003Cspan class=\"o\"\u003E*\u003C/span\u003E\u003Cspan class=\"n\"\u003Egamma_xx\u003C/span\u003E\u003Cspan class=\"p\"\u003E[\u003C/span\u003E\u003Cspan class=\"n\"\u003Ei\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Ex\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Ey\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"p\"\u003E]\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"o\"\u003E**\u003C/span\u003E\u003Cspan class=\"mi\"\u003E2\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Egamma_xx\u003C/span\u003E\u003Cspan class=\"p\"\u003E[\u003C/span\u003E\u003Cspan class=\"n\"\u003Ei\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Ex\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Ey\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"p\"\u003E]\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"o\"\u003E**\u003C/span\u003E\u003Cspan class=\"mi\"\u003E2\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Egamma_xx\u003C/span\u003E\u003Cspan class=\"p\"\u003E[\u003C/span\u003E\u003Cspan class=\"n\"\u003Ei\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Ex\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Ey\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"p\"\u003E]\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"o\"\u003E**\u003C/span\u003E\u003Cspan class=\"mi\"\u003E2\u003C/span\u003E\u003Cspan class=\"p\"\u003E;\u003C/span\u003E\n\u003C/code\u003E\u003C/pre\u003E\u003C/div\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe full Ricci tensor has many such terms for each metric component.\nDerive automates the error-prone process of deriving and coding each stencil.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "16445858bfe2047f4f97e3972f5afcb0", "console": [], "id": "nHfw", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"13-using-the-metric-class-for-tensor-calculus\"\u003E13. Using the Metric Class for Tensor Calculus\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003Esymderive's \u003Ccode\u003Ediffgeo\u003C/code\u003E module provides a \u003Ccode\u003EMetric\u003C/code\u003E class for full tensor calculus.\nThis computes Christoffel symbols, Riemann tensor, and Ricci tensor automatically.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EFor numerical relativity, these tensors contain the derivatives we need to discretize.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "0bbfce999b0c429681324c7697755c3e", "console": [], "id": "xXTn", "outputs": [{"data": {"application/json": "[\"text/html:\u003Cspan class=\\\"markdown prose dark:prose-invert contents\\\"\u003E\u003Cmarimo-tex class=\\\"arithmatex\\\"\u003E||[\\\\left[\\\\begin{matrix}g_{xx} \u0026amp; 0\\\\\\\\0 \u0026amp; g_{yy}\\\\end{matrix}\\\\right]||]\u003C/marimo-tex\u003E\u003C/span\u003E\", \"text/html:\u003Cspan class=\\\"markdown prose dark:prose-invert contents\\\"\u003E\u003Cmarimo-tex class=\\\"arithmatex\\\"\u003E||[0||]\u003C/marimo-tex\u003E\u003C/span\u003E\"]"}, "type": "data"}]}, {"code_hash": "19d6ca2ccbd0c1603163c8f190dece02", "console": [], "id": "AjVT", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EDiscretizing Christoffel Symbol Terms:\u003C/strong\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EChristoffel symbols involve metric derivatives like \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\partial_x g_{xx}||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EDiscretized: \u003Cmarimo-tex class=\"arithmatex\"\u003E||((-g_xx(-h + x, y) + g_xx(h + x, y))/(2*h)||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EC code:\u003C/strong\u003E\n\u003Cdiv class=\"language-c codehilite\"\u003E\u003Cpre\u003E\u003Cspan\u003E\u003C/span\u003E\u003Ccode\u003E\u003Cspan class=\"c1\"\u003E// dg_xx/dx for Christoffel computation\u003C/span\u003E\n\u003Cspan class=\"kt\"\u003Edouble\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Edg_dx\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E=\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"n\"\u003Eg_xx\u003C/span\u003E\u003Cspan class=\"p\"\u003E[\u003C/span\u003E\u003Cspan class=\"n\"\u003Ei\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Ex\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Ey\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"p\"\u003E]\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"mi\"\u003E2\u003C/span\u003E\u003Cspan class=\"o\"\u003E*\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Eg_xx\u003C/span\u003E\u003Cspan class=\"p\"\u003E[\u003C/span\u003E\u003Cspan class=\"n\"\u003Ei\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E+\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Ex\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Ey\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"p\"\u003E]\u003C/span\u003E\u003Cspan class=\"o\"\u003E/\u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"mi\"\u003E2\u003C/span\u003E\u003Cspan class=\"o\"\u003E*\u003C/span\u003E\u003Cspan class=\"n\"\u003Edx\u003C/span\u003E\u003Cspan class=\"p\"\u003E);\u003C/span\u003E\n\n\u003Cspan class=\"c1\"\u003E// Then Gamma^x_xx = 0.5 * g_xx_inv * dg_dx\u003C/span\u003E\n\u003Cspan class=\"kt\"\u003Edouble\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003EGamma_x_xx\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E=\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"mf\"\u003E0.5\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E*\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Eg_xx_inv\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E*\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Edg_dx\u003C/span\u003E\u003Cspan class=\"p\"\u003E;\u003C/span\u003E\n\u003C/code\u003E\u003C/pre\u003E\u003C/div\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe full BSSN evolution uses these discretized Christoffels throughout.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "d468de59abae8f483dd99464987d5c71", "console": [], "id": "pHFh", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"14-kreiss-oliger-dissipation\"\u003E14. Kreiss-Oliger Dissipation\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003ENumerical simulations often add artificial dissipation to control\nhigh-frequency noise. The Kreiss-Oliger operator for 4th order schemes:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\epsilon (-1)^{r+1} h^{2r-1} D_+^r D_-^r \\phi||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Ewhere \u003Cmarimo-tex class=\"arithmatex\"\u003E||(D_+||)\u003C/marimo-tex\u003E and \u003Cmarimo-tex class=\"arithmatex\"\u003E||(D_-||)\u003C/marimo-tex\u003E are forward/backward difference operators.\nFor \u003Cmarimo-tex class=\"arithmatex\"\u003E||(r=2||)\u003C/marimo-tex\u003E this gives a 5-point dissipation stencil.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "51695d4ceeae108f7e2f1101e5887e36", "console": [], "id": "NCOB", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EKreiss-Oliger Dissipation Term:\u003C/strong\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EFourth derivative: \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\frac{\\partial^4\\phi}{\\partial x^4}||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EDiscretized: \u003Cmarimo-tex class=\"arithmatex\"\u003E||((6*phi(x) + phi(-2*h + x) - 4*phi(-h + x) - 4*phi(h + x) + phi(2*h + x))/h**4||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EApplied as: \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\phi \\leftarrow \\phi - \\epsilon \\cdot h^3 \\cdot (\\text{stencil})||)\u003C/marimo-tex\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe coefficient \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\epsilon \\sim 0.1||)\u003C/marimo-tex\u003E controls dissipation strength.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "ee21d46b53a81bded8a1252e30d39c99", "console": [], "id": "aqbW", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"summary\"\u003ESummary\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EThis notebook demonstrated the complete pipeline from theoretical physics\nto production-ready numerical simulation code:\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EPhysics to Code Pipeline:\u003C/strong\u003E\u003C/span\u003E\n\u003Col\u003E\n\u003Cli\u003E\u003Cstrong\u003EVariational Calculus\u003C/strong\u003E: Derive equations of motion from Lagrangians\u003C/li\u003E\n\u003Cli\u003E\u003Cstrong\u003EDiscretization\u003C/strong\u003E: Convert PDEs to finite difference stencils\u003C/li\u003E\n\u003Cli\u003E\u003Cstrong\u003EMulti-dimensional\u003C/strong\u003E: Handle 3D Laplacians, mixed derivatives\u003C/li\u003E\n\u003Cli\u003E\u003Cstrong\u003ECode Generation\u003C/strong\u003E: Output C, Fortran, or Python for direct use\u003C/li\u003E\n\u003C/ol\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003ENumerical Relativity Applications:\u003C/strong\u003E\u003C/span\u003E\n\u003Cul\u003E\n\u003Cli\u003E3D Laplacian (7-point stencil) for constraint equations\u003C/li\u003E\n\u003Cli\u003EMixed derivatives for BSSN formulation\u003C/li\u003E\n\u003Cli\u003EADM evolution equations with Ricci tensor terms\u003C/li\u003E\n\u003Cli\u003EMetric class for Christoffel symbols and curvature tensors\u003C/li\u003E\n\u003Cli\u003EKreiss-Oliger dissipation for numerical stability\u003C/li\u003E\n\u003C/ul\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EAccuracy Control:\u003C/strong\u003E\u003C/span\u003E\n\u003Cul\u003E\n\u003Cli\u003E2nd order (3-point) to 8th order (9-point) stencils\u003C/li\u003E\n\u003Cli\u003EError scaling from \u003Cmarimo-tex class=\"arithmatex\"\u003E||(O(h^2)||)\u003C/marimo-tex\u003E to \u003Cmarimo-tex class=\"arithmatex\"\u003E||(O(h^8)||)\u003C/marimo-tex\u003E\u003C/li\u003E\n\u003C/ul\u003E\n\u003Cspan class=\"paragraph\"\u003EThis workflow is directly applicable to numerical relativity codes like\nGRChombo (used in arXiv:1608.04408) for simulating inflation with\ninhomogeneous initial conditions.\u003C/span\u003E\n\u003Ch3 id=\"key-functions\"\u003EKey Functions:\u003C/h3\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Ccode\u003EVariationalDerivative(L, field, coords)\u003C/code\u003E - Euler-Lagrange equations\u003C/li\u003E\n\u003Cli\u003E\u003Ccode\u003EDiscretize(expr, step_map)\u003C/code\u003E - Finite difference conversion\u003C/li\u003E\n\u003Cli\u003E\u003Ccode\u003EToStencil(expr, spacing, width)\u003C/code\u003E - Auto-generate stencil points\u003C/li\u003E\n\u003Cli\u003E\u003Ccode\u003EStencilCodeGen(expr, language)\u003C/code\u003E - C/Fortran/Python code generation\u003C/li\u003E\n\u003Cli\u003E\u003Ccode\u003EMetric(components, coords)\u003C/code\u003E - Tensor calculus with auto Christoffels\u003C/li\u003E\n\u003Cli\u003E\u003Ccode\u003EPipe(expr).then(...)\u003C/code\u003E - Composable API for chaining operations\u003C/li\u003E\n\u003C/ul\u003E\u003C/span\u003E"}, "type": "data"}]}], "metadata": {"marimo_version": "0.19.4"}, "version": "1"},
            "runtimeConfig": null,
        };
    </script>
  
<marimo-code hidden="">
    %22%22%22Variational%20Derivatives%20to%20Numerical%20Stencils%3A%20Inflation%20Simulations%0A%0ABased%20on%20arXiv%3A1608.04408%20-%20%22Robustness%20of%20Inflation%20to%20Inhomogeneous%20Initial%20Conditions%22%0Aby%20Clough%2C%20Lim%2C%20DiNunno%2C%20Fischler%2C%20Flauger%2C%20and%20Paban.%0A%0AThis%20notebook%20demonstrates%20how%20to%3A%0A1.%20Derive%20equations%20of%20motion%20from%20Lagrangians%20using%20variational%20calculus%0A2.%20Convert%20symbolic%20PDEs%20to%20finite%20difference%20stencils%0A3.%20Generate%20code%20for%20numerical%20simulations%20in%20multiple%20languages%0A%22%22%22%0A%0Aimport%20marimo%0A%0A__generated_with%20%3D%20%220.19.4%22%0Aapp%20%3D%20marimo.App()%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20import%20marimo%20as%20mo%0A%20%20%20%20from%20derive%20import%20(%0A%20%20%20%20%20%20%20%20Symbol%2C%20symbols%2C%20Function%2C%20Rational%2C%20R%2C%0A%20%20%20%20%20%20%20%20D%2C%20Simplify%2C%20Expand%2C%0A%20%20%20%20%20%20%20%20Exp%2C%20Sin%2C%20Cos%2C%20Sqrt%2C%20Pi%2C%0A%20%20%20%20%20%20%20%20TeXForm%2C%20Pipe%2C%0A%20%20%20%20)%0A%20%20%20%20from%20derive.calculus%20import%20VariationalDerivative%2C%20EulerLagrangeEquation%0A%20%20%20%20from%20derive.discretization%20import%20Discretize%2C%20ToStencil%2C%20StencilCodeGen%0A%20%20%20%20from%20derive.diffgeo%20import%20Metric%2C%20minkowski_metric%0A%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20D%2C%0A%20%20%20%20%20%20%20%20Discretize%2C%0A%20%20%20%20%20%20%20%20Function%2C%0A%20%20%20%20%20%20%20%20Metric%2C%0A%20%20%20%20%20%20%20%20Pipe%2C%0A%20%20%20%20%20%20%20%20R%2C%0A%20%20%20%20%20%20%20%20Simplify%2C%0A%20%20%20%20%20%20%20%20StencilCodeGen%2C%0A%20%20%20%20%20%20%20%20Symbol%2C%0A%20%20%20%20%20%20%20%20ToStencil%2C%0A%20%20%20%20%20%20%20%20VariationalDerivative%2C%0A%20%20%20%20%20%20%20%20mo%2C%0A%20%20%20%20%20%20%20%20symbols%2C%0A%20%20%20%20)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%20From%20Lagrangians%20to%20Numerical%20Stencils%0A%0A%20%20%20%20This%20notebook%20demonstrates%20the%20complete%20pipeline%20from%20theoretical%20physics%20to%0A%20%20%20%20numerical%20simulation%20code%2C%20based%20on%20the%20scalar%20field%20dynamics%20in%0A%20%20%20%20%5BarXiv%3A1608.04408%5D(https%3A%2F%2Farxiv.org%2Fabs%2F1608.04408).%0A%0A%20%20%20%20%23%23%20The%20Physics%0A%0A%20%20%20%20Single-field%20inflation%20uses%20a%20scalar%20field%20with%20canonical%20kinetic%20term%3A%0A%0A%20%20%20%20%24%24%5Cmathcal%7BL%7D_%5Cphi%20%3D%20-%5Cfrac%7B1%7D%7B2%7Dg%5E%7B%5Cmu%5Cnu%7D%5Cpartial_%5Cmu%20%5Cphi%20%5Cpartial_%5Cnu%5Cphi%20-%20V(%5Cphi)%24%24%0A%0A%20%20%20%20The%20Klein-Gordon%20equation%20governing%20the%20field%20dynamics%20is%3A%0A%0A%20%20%20%20%24%24%5Cpartial_t%5E2%20%5Cphi%20-%20%5Cgamma%5E%7Bij%7D%5Cpartial_i%5Cpartial_j%5Cphi%20%2B%20%5Cfrac%7BdV%7D%7Bd%5Cphi%7D%20%3D%200%24%24%0A%0A%20%20%20%20We%20will%20derive%20this%20equation%20using%20variational%20calculus%2C%20then%20convert%20it%20to%0A%20%20%20%20finite%20difference%20form%20suitable%20for%20numerical%20simulation.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%201.%20Deriving%20the%20Klein-Gordon%20Equation%0A%0A%20%20%20%20Starting%20from%20the%20scalar%20field%20Lagrangian%20density%20in%20flat%20spacetime%3A%0A%0A%20%20%20%20%24%24%5Cmathcal%7BL%7D%20%3D%20%5Cfrac%7B1%7D%7B2%7D(%5Cpartial_t%5Cphi)%5E2%20-%20%5Cfrac%7B1%7D%7B2%7D(%5Cpartial_x%5Cphi)%5E2%20-%20V(%5Cphi)%24%24%0A%0A%20%20%20%20The%20Euler-Lagrange%20equation%20gives%20us%20the%20equation%20of%20motion.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(D%2C%20Function%2C%20R%2C%20Simplify%2C%20Symbol%2C%20VariationalDerivative%2C%20mo%2C%20symbols)%3A%0A%20%20%20%20%23%20Define%20coordinates%20and%20field%0A%20%20%20%20x%2C%20t%20%3D%20symbols('x%20t')%0A%20%20%20%20phi%20%3D%20Function('phi')(x%2C%20t)%0A%20%20%20%20m%20%3D%20Symbol('m'%2C%20positive%3DTrue)%20%20%23%20mass%20parameter%0A%0A%20%20%20%20%23%20Klein-Gordon%20Lagrangian%3A%20L%20%3D%20(1%2F2)(d_t%20phi)%5E2%20-%20(1%2F2)(d_x%20phi)%5E2%20-%20(1%2F2)m%5E2%20phi%5E2%0A%20%20%20%20L_KG%20%3D%20R(1%2C%202)%20*%20D(phi%2C%20t)**2%20-%20R(1%2C%202)%20*%20D(phi%2C%20x)**2%20-%20R(1%2C%202)%20*%20m**2%20*%20phi**2%0A%0A%20%20%20%20%23%20Derive%20the%20equation%20of%20motion%0A%20%20%20%20eom_KG%20%3D%20VariationalDerivative(L_KG%2C%20phi%2C%20%5Bx%2C%20t%5D)%0A%0A%20%20%20%20mo.md(f%22%22%22%0A%20%20%20%20**Klein-Gordon%20Lagrangian%3A**%0A%0A%20%20%20%20%24%5C%5Cmathcal%7B%7BL%7D%7D%20%3D%20%7BL_KG%7D%24%0A%0A%20%20%20%20**Equation%20of%20Motion**%20(%24%5C%5Cdelta%5C%5Cmathcal%7B%7BL%7D%7D%2F%5C%5Cdelta%5C%5Cphi%20%3D%200%24)%3A%0A%0A%20%20%20%20%24%7BSimplify(eom_KG)%7D%20%3D%200%24%0A%0A%20%20%20%20This%20is%20the%20Klein-Gordon%20equation%3A%20%24%5C%5Cpartial_t%5E2%5C%5Cphi%20-%20%5C%5Cpartial_x%5E2%5C%5Cphi%20%2B%20m%5E2%5C%5Cphi%20%3D%200%24%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%202.%20The%20Wave%20Equation%20(Massless%20Limit)%0A%0A%20%20%20%20Setting%20%24m%20%3D%200%24%20gives%20the%20wave%20equation%2C%20which%20appears%20in%20the%20gradient%20energy%0A%20%20%20%20dominated%20regime%20of%20inflation%20simulations.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(D%2C%20Function%2C%20R%2C%20Simplify%2C%20VariationalDerivative%2C%20mo%2C%20symbols)%3A%0A%20%20%20%20%23%20Wave%20equation%20(massless%20Klein-Gordon)%0A%20%20%20%20x_w%2C%20t_w%20%3D%20symbols('x%20t')%0A%20%20%20%20phi_w%20%3D%20Function('phi')(x_w%2C%20t_w)%0A%0A%20%20%20%20L_wave%20%3D%20R(1%2C%202)%20*%20D(phi_w%2C%20t_w)**2%20-%20R(1%2C%202)%20*%20D(phi_w%2C%20x_w)**2%0A%0A%20%20%20%20eom_wave%20%3D%20VariationalDerivative(L_wave%2C%20phi_w%2C%20%5Bx_w%2C%20t_w%5D)%0A%0A%20%20%20%20mo.md(f%22%22%22%0A%20%20%20%20**Wave%20Equation%20Lagrangian%3A**%0A%0A%20%20%20%20%24%5C%5Cmathcal%7B%7BL%7D%7D%20%3D%20%7BL_wave%7D%24%0A%0A%20%20%20%20**Equation%20of%20Motion%3A**%0A%0A%20%20%20%20%24%7BSimplify(eom_wave)%7D%20%3D%200%24%0A%0A%20%20%20%20This%20gives%3A%20%24%5C%5Cpartial_t%5E2%5C%5Cphi%20%3D%20%5C%5Cpartial_x%5E2%5C%5Cphi%24%20(the%20wave%20equation)%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%203.%20Converting%20to%20Finite%20Differences%0A%0A%20%20%20%20For%20numerical%20simulation%2C%20we%20need%20to%20discretize%20the%20spatial%20derivatives.%0A%20%20%20%20The%20%60Discretize%60%20function%20converts%20symbolic%20derivatives%20to%20finite%20difference%0A%20%20%20%20approximations%20using%20Taylor%20series%20matching.%0A%0A%20%20%20%20%23%23%23%20Central%20Difference%20Stencils%0A%0A%20%20%20%20For%20a%203-point%20central%20difference%3A%0A%20%20%20%20-%20First%20derivative%3A%20%24%5Cfrac%7B%5Cpartial%20f%7D%7B%5Cpartial%20x%7D%20%5Capprox%20%5Cfrac%7Bf(x%2Bh)%20-%20f(x-h)%7D%7B2h%7D%24%0A%20%20%20%20-%20Second%20derivative%3A%20%24%5Cfrac%7B%5Cpartial%5E2%20f%7D%7B%5Cpartial%20x%5E2%7D%20%5Capprox%20%5Cfrac%7Bf(x%2Bh)%20-%202f(x)%20%2B%20f(x-h)%7D%7Bh%5E2%7D%24%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(D%2C%20Discretize%2C%20Function%2C%20Simplify%2C%20Symbol%2C%20mo)%3A%0A%20%20%20%20%23%20Discretization%20example%0A%20%20%20%20x_d%20%3D%20Symbol('x')%0A%20%20%20%20h%20%3D%20Symbol('h')%20%20%23%20grid%20spacing%0A%20%20%20%20f%20%3D%20Function('f')(x_d)%0A%0A%20%20%20%20%23%20Second%20derivative%0A%20%20%20%20d2f_dx2%20%3D%20D(f%2C%20(x_d%2C%202))%0A%0A%20%20%20%20%23%20Central%20difference%20discretization%0A%20%20%20%20stencil_3pt%20%3D%20Discretize(d2f_dx2%2C%20%7Bx_d%3A%20(%5Bx_d%20-%20h%2C%20x_d%2C%20x_d%20%2B%20h%5D%2C%20h)%7D)%0A%0A%20%20%20%20mo.md(f%22%22%22%0A%20%20%20%20**Second%20Derivative%20Discretization%20(3-point%20central)%3A**%0A%0A%20%20%20%20Symbolic%3A%20%24%5C%5Cfrac%7B%7B%5C%5Cpartial%5E2%20f%7D%7D%7B%7B%5C%5Cpartial%20x%5E2%7D%7D%24%0A%0A%20%20%20%20Discretized%3A%20%24%7BSimplify(stencil_3pt)%7D%24%0A%0A%20%20%20%20This%20is%20the%20standard%203-point%20stencil%3A%20%24%5C%5Cfrac%7B%7Bf_%7B%7Bi%2B1%7D%7D%20-%202f_i%20%2B%20f_%7B%7Bi-1%7D%7D%7D%7D%7B%7Bh%5E2%7D%7D%24%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%204.%20Discretizing%20the%20Wave%20Equation%0A%0A%20%20%20%20Now%20let's%20discretize%20the%20full%20wave%20equation%20for%20numerical%20simulation.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(D%2C%20Discretize%2C%20Function%2C%20Simplify%2C%20mo%2C%20symbols)%3A%0A%20%20%20%20%23%20Full%20wave%20equation%20discretization%0A%20%20%20%20x_full%2C%20t_full%20%3D%20symbols('x%20t')%0A%20%20%20%20hx%2C%20ht%20%3D%20symbols('h_x%20h_t')%20%20%23%20spatial%20and%20temporal%20grid%20spacing%0A%20%20%20%20u%20%3D%20Function('u')(x_full%2C%20t_full)%0A%0A%20%20%20%20%23%20Wave%20equation%3A%20d%5E2u%2Fdt%5E2%20-%20d%5E2u%2Fdx%5E2%20%3D%200%0A%20%20%20%20wave_eq%20%3D%20D(u%2C%20(t_full%2C%202))%20-%20D(u%2C%20(x_full%2C%202))%0A%0A%20%20%20%20%23%20Discretize%20both%20derivatives%0A%20%20%20%20step_map%20%3D%20%7B%0A%20%20%20%20%20%20%20%20x_full%3A%20(%5Bx_full%20-%20hx%2C%20x_full%2C%20x_full%20%2B%20hx%5D%2C%20hx)%2C%0A%20%20%20%20%20%20%20%20t_full%3A%20(%5Bt_full%20-%20ht%2C%20t_full%2C%20t_full%20%2B%20ht%5D%2C%20ht)%2C%0A%20%20%20%20%7D%0A%20%20%20%20wave_discrete%20%3D%20Discretize(wave_eq%2C%20step_map)%0A%0A%20%20%20%20mo.md(f%22%22%22%0A%20%20%20%20**Wave%20Equation%3A**%0A%0A%20%20%20%20%24%5C%5Cfrac%7B%7B%5C%5Cpartial%5E2%20u%7D%7D%7B%7B%5C%5Cpartial%20t%5E2%7D%7D%20-%20%5C%5Cfrac%7B%7B%5C%5Cpartial%5E2%20u%7D%7D%7B%7B%5C%5Cpartial%20x%5E2%7D%7D%20%3D%200%24%0A%0A%20%20%20%20**Discretized%20Form%3A**%0A%0A%20%20%20%20%24%7BSimplify(wave_discrete)%7D%20%3D%200%24%0A%0A%20%20%20%20Rearranging%20for%20time-stepping%3A%20%24u(x%2C%20t%2Bh_t)%20%3D%202u(x%2Ct)%20-%20u(x%2C%20t-h_t)%20%2B%20%5C%5Cfrac%7B%7Bh_t%5E2%7D%7D%7B%7Bh_x%5E2%7D%7D%5Bu(x%2Bh_x%2Ct)%20-%202u(x%2Ct)%20%2B%20u(x-h_x%2Ct)%5D%24%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%205.%20Higher-Order%20Stencils%0A%0A%20%20%20%20For%20better%20accuracy%2C%20we%20can%20use%20wider%20stencils.%20The%20%60ToStencil%60%20function%0A%20%20%20%20automatically%20generates%20symmetric%20stencil%20points.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(D%2C%20Function%2C%20Simplify%2C%20Symbol%2C%20ToStencil%2C%20mo)%3A%0A%20%20%20%20%23%20Higher-order%20stencils%0A%20%20%20%20x_ho%20%3D%20Symbol('x')%0A%20%20%20%20h_ho%20%3D%20Symbol('h')%0A%20%20%20%20f_ho%20%3D%20Function('f')(x_ho)%0A%0A%20%20%20%20%23%20Compare%203-point%20and%205-point%20stencils%20for%20first%20derivative%0A%20%20%20%20df_dx%20%3D%20D(f_ho%2C%20x_ho)%0A%0A%20%20%20%20stencil_3%20%3D%20ToStencil(df_dx%2C%20%7Bx_ho%3A%20h_ho%7D%2C%20width%3D3)%0A%20%20%20%20stencil_5%20%3D%20ToStencil(df_dx%2C%20%7Bx_ho%3A%20h_ho%7D%2C%20width%3D5)%0A%0A%20%20%20%20mo.md(f%22%22%22%0A%20%20%20%20**First%20Derivative%20Stencils%3A**%0A%0A%20%20%20%203-point%3A%20%24%7BSimplify(stencil_3)%7D%24%0A%0A%20%20%20%205-point%3A%20%24%7BSimplify(stencil_5)%7D%24%0A%0A%20%20%20%20The%205-point%20stencil%20provides%204th-order%20accuracy%20vs%202nd-order%20for%203-point.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%206.%20Code%20Generation%0A%0A%20%20%20%20The%20%60StencilCodeGen%60%20function%20converts%20discretized%20expressions%20to%20code%0A%20%20%20%20in%20multiple%20programming%20languages%20-%20useful%20for%20generating%20numerical%0A%20%20%20%20relativity%20simulation%20code.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(D%2C%20Discretize%2C%20Function%2C%20StencilCodeGen%2C%20Symbol%2C%20mo)%3A%0A%20%20%20%20%23%20Code%20generation%20example%0A%20%20%20%20x_cg%20%3D%20Symbol('x')%0A%20%20%20%20h_cg%20%3D%20Symbol('h')%0A%20%20%20%20phi_cg%20%3D%20Function('phi')(x_cg)%0A%0A%20%20%20%20%23%20Second%20derivative%20stencil%0A%20%20%20%20d2phi%20%3D%20D(phi_cg%2C%20(x_cg%2C%202))%0A%20%20%20%20stencil_cg%20%3D%20Discretize(d2phi%2C%20%7Bx_cg%3A%20(%5Bx_cg%20-%20h_cg%2C%20x_cg%2C%20x_cg%20%2B%20h_cg%5D%2C%20h_cg)%7D)%0A%0A%20%20%20%20%23%20Generate%20code%20in%20different%20languages%0A%20%20%20%20python_code%20%3D%20StencilCodeGen(stencil_cg%2C%20language%3D'python'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20array_name%3D'phi'%2C%20index_var%3D'i'%2C%20spacing_name%3D'dx')%0A%20%20%20%20c_code%20%3D%20StencilCodeGen(stencil_cg%2C%20language%3D'c'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20array_name%3D'phi'%2C%20index_var%3D'i'%2C%20spacing_name%3D'dx')%0A%20%20%20%20fortran_code%20%3D%20StencilCodeGen(stencil_cg%2C%20language%3D'fortran'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20array_name%3D'phi'%2C%20index_var%3D'i'%2C%20spacing_name%3D'dx')%0A%20%20%20%20latex_code%20%3D%20StencilCodeGen(stencil_cg%2C%20language%3D'latex')%0A%0A%20%20%20%20mo.md(f%22%22%22%0A%20%20%20%20**Code%20Generation%20for**%20%24%5C%5Cpartial%5E2%5C%5Cphi%2F%5C%5Cpartial%20x%5E2%24%3A%0A%0A%20%20%20%20**Python%3A**%0A%20%20%20%20%60%60%60python%0A%20%20%20%20d2phi_dx2%20%3D%20%7Bpython_code%7D%0A%20%20%20%20%60%60%60%0A%0A%20%20%20%20**C%3A**%0A%20%20%20%20%60%60%60c%0A%20%20%20%20double%20d2phi_dx2%20%3D%20%7Bc_code%7D%3B%0A%20%20%20%20%60%60%60%0A%0A%20%20%20%20**Fortran%3A**%0A%20%20%20%20%60%60%60fortran%0A%20%20%20%20d2phi_dx2%20%3D%20%7Bfortran_code%7D%0A%20%20%20%20%60%60%60%0A%0A%20%20%20%20**LaTeX%3A**%0A%20%20%20%20%24%7Blatex_code%7D%24%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%207.%20Complete%20Pipeline%3A%20Lagrangian%20to%20Simulation%20Code%0A%0A%20%20%20%20Using%20symderive's%20%60Pipe%60%20API%2C%20we%20can%20chain%20the%20entire%20workflow.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20D%2C%0A%20%20%20%20Discretize%2C%0A%20%20%20%20Function%2C%0A%20%20%20%20Pipe%2C%0A%20%20%20%20R%2C%0A%20%20%20%20StencilCodeGen%2C%0A%20%20%20%20Symbol%2C%0A%20%20%20%20VariationalDerivative%2C%0A%20%20%20%20mo%2C%0A%20%20%20%20symbols%2C%0A)%3A%0A%20%20%20%20%23%20Complete%20pipeline%20example%0A%20%20%20%20x_pipe%2C%20t_pipe%20%3D%20symbols('x%20t')%0A%20%20%20%20h_pipe%20%3D%20Symbol('h')%0A%20%20%20%20psi%20%3D%20Function('psi')(x_pipe%2C%20t_pipe)%0A%0A%20%20%20%20%23%20Lagrangian%20for%20massless%20scalar%20field%20(1D)%0A%20%20%20%20L_pipe%20%3D%20R(1%2C%202)%20*%20D(psi%2C%20t_pipe)**2%20-%20R(1%2C%202)%20*%20D(psi%2C%20x_pipe)**2%0A%0A%20%20%20%20%23%20Pipeline%3A%20Lagrangian%20-%3E%20EoM%20-%3E%20Discretize%20spatial%20part%0A%20%20%20%20eom_spatial%20%3D%20(%0A%20%20%20%20%20%20%20%20Pipe(L_pipe)%0A%20%20%20%20%20%20%20%20.then(VariationalDerivative%2C%20psi%2C%20%5Bx_pipe%2C%20t_pipe%5D)%0A%20%20%20%20%20%20%20%20.then(Discretize%2C%20%7Bx_pipe%3A%20(%5Bx_pipe%20-%20h_pipe%2C%20x_pipe%2C%20x_pipe%20%2B%20h_pipe%5D%2C%20h_pipe)%7D)%0A%20%20%20%20%20%20%20%20.value%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20Generate%20simulation%20code%0A%20%20%20%20sim_code%20%3D%20StencilCodeGen(eom_spatial%2C%20language%3D'python'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20array_name%3D'psi'%2C%20index_var%3D'i'%2C%20spacing_name%3D'dx')%0A%0A%20%20%20%20mo.md(f%22%22%22%0A%20%20%20%20**Complete%20Pipeline%3A**%0A%0A%20%20%20%201.%20Start%20with%20Lagrangian%3A%20%24%5C%5Cmathcal%7B%7BL%7D%7D%20%3D%20%7BL_pipe%7D%24%0A%0A%20%20%20%202.%20Derive%20equation%20of%20motion%20via%20variational%20derivative%0A%0A%20%20%20%203.%20Discretize%20spatial%20derivatives%0A%0A%20%20%20%204.%20Generate%20Python%20code%3A%0A%0A%20%20%20%20%60%60%60python%0A%20%20%20%20%23%20Equation%20of%20motion%20(set%20to%20zero%20and%20solve%20for%20time%20evolution)%0A%20%20%20%20eom%20%3D%20%7Bsim_code%7D%0A%20%20%20%20%60%60%60%0A%0A%20%20%20%20This%20can%20be%20directly%20used%20in%20a%20time-stepping%20numerical%20scheme!%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%208.%20Application%3A%20Initial%20Conditions%20from%20arXiv%3A1608.04408%0A%0A%20%20%20%20The%20paper%20uses%20inhomogeneous%20initial%20conditions%20for%20the%20scalar%20field%3A%0A%0A%20%20%20%20%24%24%5Cphi(t%3D0%2C%20%5Cmathbf%7Bx%7D)%20%3D%20%5Cphi_0%20%2B%20%5Cfrac%7B%5CDelta%5Cphi%7D%7BN%7D%5Csum_%7Bn%3D1%7D%5E%7BN%7D%5Cleft(%5Ccos%5Cfrac%7B2%5Cpi%20nx%7D%7BL%7D%20%2B%20%5Ccos%5Cfrac%7B2%5Cpi%20ny%7D%7BL%7D%20%2B%20%5Ccos%5Cfrac%7B2%5Cpi%20nz%7D%7BL%7D%5Cright)%24%24%0A%0A%20%20%20%20With%20initial%20velocity%3A%0A%20%20%20%20%24%24%5Cfrac%7B%5Cpartial%5Cphi(t%3D0%2C%20%5Cmathbf%7Bx%7D)%7D%7B%5Cpartial%20t%7D%20%3D%200%24%24%0A%0A%20%20%20%20The%20gradient%20energy%20density%20is%3A%0A%20%20%20%20%24%24%5Crho_%7B%5Cmathrm%7Bgrad%7D%7D%20%3D%20%5Cfrac%7B1%7D%7B2%7D%5Cgamma%5E%7Bij%7D%5Cpartial_i%5Cphi%5Cpartial_j%5Cphi%24%24%0A%0A%20%20%20%20Let's%20compute%20the%20discretized%20gradient%20energy.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(D%2C%20Discretize%2C%20Function%2C%20R%2C%20Simplify%2C%20Symbol%2C%20mo)%3A%0A%20%20%20%20%23%20Gradient%20energy%20density%20discretization%0A%20%20%20%20x_grad%20%3D%20Symbol('x')%0A%20%20%20%20h_grad%20%3D%20Symbol('h')%0A%20%20%20%20phi_grad%20%3D%20Function('phi')(x_grad)%0A%0A%20%20%20%20%23%20Gradient%20energy%3A%20(1%2F2)(d%20phi%2Fdx)%5E2%0A%20%20%20%20rho_grad%20%3D%20R(1%2C%202)%20*%20D(phi_grad%2C%20x_grad)**2%0A%0A%20%20%20%20%23%20Discretize%0A%20%20%20%20rho_grad_discrete%20%3D%20Discretize(rho_grad%2C%20%7Bx_grad%3A%20(%5Bx_grad%20-%20h_grad%2C%20x_grad%2C%20x_grad%20%2B%20h_grad%5D%2C%20h_grad)%7D)%0A%0A%20%20%20%20mo.md(f%22%22%22%0A%20%20%20%20**Gradient%20Energy%20Density%20(1D)%3A**%0A%0A%20%20%20%20Continuous%3A%20%24%5C%5Crho_%7B%7B%5C%5Cmathrm%7B%7Bgrad%7D%7D%7D%7D%20%3D%20%5C%5Cfrac%7B%7B1%7D%7D%7B%7B2%7D%7D%5C%5Cleft(%5C%5Cfrac%7B%7B%5C%5Cpartial%5C%5Cphi%7D%7D%7B%7B%5C%5Cpartial%20x%7D%7D%5C%5Cright)%5E2%24%0A%0A%20%20%20%20Discretized%3A%20%24%5C%5Crho_%7B%7B%5C%5Cmathrm%7B%7Bgrad%7D%7D%7D%7D%20%3D%20%7BSimplify(rho_grad_discrete)%7D%24%0A%0A%20%20%20%20This%20uses%20the%20central%20difference%20approximation%20for%20the%20first%20derivative.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%209.%20Multi-Dimensional%20Stencils%3A%20The%203D%20Laplacian%0A%0A%20%20%20%20Numerical%20relativity%20simulations%20operate%20in%203D.%20The%20spatial%20Laplacian%0A%20%20%20%20appears%20in%20the%20Hamiltonian%20constraint%20and%20evolution%20equations%3A%0A%0A%20%20%20%20%24%24%5Cnabla%5E2%20%5Cphi%20%3D%20%5Cfrac%7B%5Cpartial%5E2%5Cphi%7D%7B%5Cpartial%20x%5E2%7D%20%2B%20%5Cfrac%7B%5Cpartial%5E2%5Cphi%7D%7B%5Cpartial%20y%5E2%7D%20%2B%20%5Cfrac%7B%5Cpartial%5E2%5Cphi%7D%7B%5Cpartial%20z%5E2%7D%24%24%0A%0A%20%20%20%20Each%20term%20uses%20the%20standard%20second%20derivative%20stencil.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(D%2C%20Discretize%2C%20Function%2C%20Simplify%2C%20StencilCodeGen%2C%20mo%2C%20symbols)%3A%0A%20%20%20%20%23%203D%20Laplacian%0A%20%20%20%20x_3d%2C%20y_3d%2C%20z_3d%20%3D%20symbols('x%20y%20z')%0A%20%20%20%20hx_3d%2C%20hy_3d%2C%20hz_3d%20%3D%20symbols('h_x%20h_y%20h_z')%0A%20%20%20%20phi_3d%20%3D%20Function('phi')(x_3d%2C%20y_3d%2C%20z_3d)%0A%0A%20%20%20%20%23%20Laplacian%20in%203D%0A%20%20%20%20laplacian_3d%20%3D%20D(phi_3d%2C%20(x_3d%2C%202))%20%2B%20D(phi_3d%2C%20(y_3d%2C%202))%20%2B%20D(phi_3d%2C%20(z_3d%2C%202))%0A%0A%20%20%20%20%23%20Discretize%20with%20uniform%20spacing%20h%0A%20%20%20%20h_uniform%20%3D%20symbols('h')%0A%20%20%20%20step_map_3d%20%3D%20%7B%0A%20%20%20%20%20%20%20%20x_3d%3A%20(%5Bx_3d%20-%20h_uniform%2C%20x_3d%2C%20x_3d%20%2B%20h_uniform%5D%2C%20h_uniform)%2C%0A%20%20%20%20%20%20%20%20y_3d%3A%20(%5By_3d%20-%20h_uniform%2C%20y_3d%2C%20y_3d%20%2B%20h_uniform%5D%2C%20h_uniform)%2C%0A%20%20%20%20%20%20%20%20z_3d%3A%20(%5Bz_3d%20-%20h_uniform%2C%20z_3d%2C%20z_3d%20%2B%20h_uniform%5D%2C%20h_uniform)%2C%0A%20%20%20%20%7D%0A%20%20%20%20laplacian_discrete%20%3D%20Discretize(laplacian_3d%2C%20step_map_3d)%0A%0A%20%20%20%20%23%20Generate%20C%20code%20for%20the%20stencil%0A%20%20%20%20c_laplacian%20%3D%20StencilCodeGen(%0A%20%20%20%20%20%20%20%20Discretize(D(phi_3d%2C%20(x_3d%2C%202))%2C%20%7Bx_3d%3A%20(%5Bx_3d%20-%20h_uniform%2C%20x_3d%2C%20x_3d%20%2B%20h_uniform%5D%2C%20h_uniform)%7D)%2C%0A%20%20%20%20%20%20%20%20language%3D'c'%2C%20array_name%3D'phi'%2C%20index_var%3D'i'%2C%20spacing_name%3D'dx'%0A%20%20%20%20)%0A%0A%20%20%20%20mo.md(f%22%22%22%0A%20%20%20%20**3D%20Laplacian%20Stencil%3A**%0A%0A%20%20%20%20Continuous%3A%20%24%5C%5Cnabla%5E2%5C%5Cphi%20%3D%20%7Blaplacian_3d%7D%24%0A%0A%20%20%20%20Discretized%20(uniform%20grid%20%24h%24)%3A%20%24%7BSimplify(laplacian_discrete)%7D%24%0A%0A%20%20%20%20This%20is%20the%20classic%207-point%20stencil%20used%20in%20numerical%20relativity%20codes.%0A%0A%20%20%20%20**C%20code%20for%20one%20dimension**%20(repeat%20for%20j%2C%20k%20indices)%3A%0A%20%20%20%20%60%60%60c%0A%20%20%20%20d2phi_dx2%20%3D%20%7Bc_laplacian%7D%3B%0A%20%20%20%20%60%60%60%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%2010.%20Stencil%20Accuracy%3A%202nd%20vs%204th%20vs%206th%20Order%0A%0A%20%20%20%20Higher-order%20stencils%20use%20more%20points%20but%20converge%20faster.%0A%20%20%20%20The%20truncation%20error%20scales%20as%20%24O(h%5En)%24%20where%20%24n%24%20is%20the%20accuracy%20order.%0A%0A%20%20%20%20%7C%20Order%20%7C%20Points%20%7C%20Error%20Scaling%20%7C%20Use%20Case%20%7C%0A%20%20%20%20%7C-------%7C--------%7C---------------%7C----------%7C%0A%20%20%20%20%7C%202nd%20%20%20%7C%203%20%20%20%20%20%20%7C%20%24O(h%5E2)%24%20%20%20%20%20%20%7C%20Simple%20problems%2C%20quick%20tests%20%7C%0A%20%20%20%20%7C%204th%20%20%20%7C%205%20%20%20%20%20%20%7C%20%24O(h%5E4)%24%20%20%20%20%20%20%7C%20Production%20simulations%20%7C%0A%20%20%20%20%7C%206th%20%20%20%7C%207%20%20%20%20%20%20%7C%20%24O(h%5E6)%24%20%20%20%20%20%20%7C%20High-precision%20work%20%7C%0A%20%20%20%20%7C%208th%20%20%20%7C%209%20%20%20%20%20%20%7C%20%24O(h%5E8)%24%20%20%20%20%20%20%7C%20Spectral-like%20accuracy%20%7C%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(D%2C%20Function%2C%20Simplify%2C%20Symbol%2C%20ToStencil%2C%20mo)%3A%0A%20%20%20%20%23%20Compare%20stencil%20orders%20for%20second%20derivative%0A%20%20%20%20x_ord%20%3D%20Symbol('x')%0A%20%20%20%20h_ord%20%3D%20Symbol('h')%0A%20%20%20%20f_ord%20%3D%20Function('f')(x_ord)%0A%0A%20%20%20%20d2f%20%3D%20D(f_ord%2C%20(x_ord%2C%202))%0A%0A%20%20%20%20stencil_2nd%20%3D%20ToStencil(d2f%2C%20%7Bx_ord%3A%20h_ord%7D%2C%20width%3D3)%0A%20%20%20%20stencil_4th%20%3D%20ToStencil(d2f%2C%20%7Bx_ord%3A%20h_ord%7D%2C%20width%3D5)%0A%20%20%20%20stencil_6th%20%3D%20ToStencil(d2f%2C%20%7Bx_ord%3A%20h_ord%7D%2C%20width%3D7)%0A%0A%20%20%20%20mo.md(f%22%22%22%0A%20%20%20%20**Second%20Derivative%20Stencils%20by%20Order%3A**%0A%0A%20%20%20%20**2nd%20order%20(3-point)%3A**%0A%20%20%20%20%24%7BSimplify(stencil_2nd)%7D%24%0A%0A%20%20%20%20**4th%20order%20(5-point)%3A**%0A%20%20%20%20%24%7BSimplify(stencil_4th)%7D%24%0A%0A%20%20%20%20**6th%20order%20(7-point)%3A**%0A%20%20%20%20%24%7BSimplify(stencil_6th)%7D%24%0A%0A%20%20%20%20Note%20how%20higher-order%20stencils%20have%20smaller%20coefficients%20on%20the%20outer%20points%2C%0A%20%20%20%20reducing%20numerical%20dispersion.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%2011.%20Mixed%20Derivatives%20and%20Cross%20Terms%0A%0A%20%20%20%20The%20BSSN%20formulation%20of%20general%20relativity%20includes%20mixed%20partial%20derivatives%0A%20%20%20%20like%20%24%5Cpartial_x%5Cpartial_y%5Cphi%24.%20These%20require%202D%20stencils.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(D%2C%20Discretize%2C%20Function%2C%20Simplify%2C%20mo%2C%20symbols)%3A%0A%20%20%20%20%23%20Mixed%20derivative%0A%20%20%20%20x_mix%2C%20y_mix%20%3D%20symbols('x%20y')%0A%20%20%20%20h_mix%20%3D%20symbols('h')%0A%20%20%20%20phi_mix%20%3D%20Function('phi')(x_mix%2C%20y_mix)%0A%0A%20%20%20%20%23%20Mixed%20partial%20derivative%0A%20%20%20%20d2_dxdy%20%3D%20D(D(phi_mix%2C%20x_mix)%2C%20y_mix)%0A%0A%20%20%20%20%23%209-point%20stencil%20for%20mixed%20derivative%0A%20%20%20%20step_map_mix%20%3D%20%7B%0A%20%20%20%20%20%20%20%20x_mix%3A%20(%5Bx_mix%20-%20h_mix%2C%20x_mix%2C%20x_mix%20%2B%20h_mix%5D%2C%20h_mix)%2C%0A%20%20%20%20%20%20%20%20y_mix%3A%20(%5By_mix%20-%20h_mix%2C%20y_mix%2C%20y_mix%20%2B%20h_mix%5D%2C%20h_mix)%2C%0A%20%20%20%20%7D%0A%20%20%20%20mixed_stencil%20%3D%20Discretize(d2_dxdy%2C%20step_map_mix)%0A%0A%20%20%20%20mo.md(f%22%22%22%0A%20%20%20%20**Mixed%20Partial%20Derivative%3A**%0A%0A%20%20%20%20Continuous%3A%20%24%5C%5Cfrac%7B%7B%5C%5Cpartial%5E2%5C%5Cphi%7D%7D%7B%7B%5C%5Cpartial%20x%5C%5Cpartial%20y%7D%7D%24%0A%0A%20%20%20%20Discretized%3A%20%24%7BSimplify(mixed_stencil)%7D%24%0A%0A%20%20%20%20This%20is%20the%20standard%204-corner%20stencil%3A%0A%20%20%20%20%60%60%60%0A%20%20%20%20(-1)-----(0)-----(%2B1)%0A%20%20%20%20%20%20%7C%20%20%20%20%20%20%20%7C%20%20%20%20%20%20%20%7C%0A%20%20%20%20(%2B1)%20%20%20%20(0%2C0)%20%20%20(%2B1)%0A%20%20%20%20%20%20%7C%20%20%20%20%20%20%20%7C%20%20%20%20%20%20%20%7C%0A%20%20%20%20(-1)-----(0)-----(%2B1)%0A%20%20%20%20%60%60%60%0A%20%20%20%20Only%20the%20four%20corners%20contribute%20(with%20alternating%20signs).%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%2012.%20The%20ADM%20Evolution%20Equations%0A%0A%20%20%20%20In%20numerical%20relativity%2C%20the%20ADM%20(Arnowitt-Deser-Misner)%20formalism%20evolves%0A%20%20%20%20the%203-metric%20%24%5Cgamma_%7Bij%7D%24%20and%20extrinsic%20curvature%20%24K_%7Bij%7D%24%3A%0A%0A%20%20%20%20%24%24%5Cpartial_t%20%5Cgamma_%7Bij%7D%20%3D%20-2%5Calpha%20K_%7Bij%7D%20%2B%20%5Cmathcal%7BL%7D_%5Cbeta%20%5Cgamma_%7Bij%7D%24%24%0A%0A%20%20%20%20%24%24%5Cpartial_t%20K_%7Bij%7D%20%3D%20-D_i%20D_j%20%5Calpha%20%2B%20%5Calpha(R_%7Bij%7D%20%2B%20K%20K_%7Bij%7D%20-%202K_%7Bik%7DK%5Ek%7B%7D_j)%20%2B%20%5Cmathcal%7BL%7D_%5Cbeta%20K_%7Bij%7D%24%24%0A%0A%20%20%20%20The%20spatial%20Ricci%20tensor%20%24R_%7Bij%7D%24%20contains%20second%20derivatives%20of%20the%20metric%2C%0A%20%20%20%20which%20we%20discretize%20using%20the%20stencils%20developed%20above.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(D%2C%20Discretize%2C%20Function%2C%20Simplify%2C%20StencilCodeGen%2C%20mo%2C%20symbols)%3A%0A%20%20%20%20%23%20Simplified%20ADM-like%20term%3A%20second%20derivative%20of%20metric%20component%0A%20%20%20%20x_adm%2C%20y_adm%20%3D%20symbols('x%20y')%0A%20%20%20%20h_adm%20%3D%20symbols('h')%0A%20%20%20%20gamma_xx%20%3D%20Function('gamma_xx')(x_adm%2C%20y_adm)%0A%0A%20%20%20%20%23%20Part%20of%20the%20Ricci%20tensor%3A%20d%5E2(gamma_xx)%2Fdx%5E2%0A%20%20%20%20ricci_term%20%3D%20D(gamma_xx%2C%20(x_adm%2C%202))%0A%0A%20%20%20%20%23%20Discretize%0A%20%20%20%20step_adm%20%3D%20%7Bx_adm%3A%20(%5Bx_adm%20-%20h_adm%2C%20x_adm%2C%20x_adm%20%2B%20h_adm%5D%2C%20h_adm)%7D%0A%20%20%20%20ricci_discrete%20%3D%20Discretize(ricci_term%2C%20step_adm)%0A%0A%20%20%20%20%23%20Generate%20code%0A%20%20%20%20ricci_code%20%3D%20StencilCodeGen(ricci_discrete%2C%20language%3D'c'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20array_name%3D'gamma_xx'%2C%20index_var%3D'i'%2C%20spacing_name%3D'dx')%0A%0A%20%20%20%20mo.md(f%22%22%22%0A%20%20%20%20**Ricci%20Tensor%20Component%20(simplified)%3A**%0A%0A%20%20%20%20One%20term%20in%20%24R_%7B%7Bxx%7D%7D%24%20involves%3A%20%24%5C%5Cfrac%7B%7B%5C%5Cpartial%5E2%20%5C%5Cgamma_%7B%7Bxx%7D%7D%7D%7D%7B%7B%5C%5Cpartial%20x%5E2%7D%7D%24%0A%0A%20%20%20%20Discretized%3A%20%24%7BSimplify(ricci_discrete)%7D%24%0A%0A%20%20%20%20**C%20code%3A**%0A%20%20%20%20%60%60%60c%0A%20%20%20%20double%20d2gamma_dx2%20%3D%20%7Bricci_code%7D%3B%0A%20%20%20%20%60%60%60%0A%0A%20%20%20%20The%20full%20Ricci%20tensor%20has%20many%20such%20terms%20for%20each%20metric%20component.%0A%20%20%20%20Derive%20automates%20the%20error-prone%20process%20of%20deriving%20and%20coding%20each%20stencil.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%2013.%20Using%20the%20Metric%20Class%20for%20Tensor%20Calculus%0A%0A%20%20%20%20symderive's%20%60diffgeo%60%20module%20provides%20a%20%60Metric%60%20class%20for%20full%20tensor%20calculus.%0A%20%20%20%20This%20computes%20Christoffel%20symbols%2C%20Riemann%20tensor%2C%20and%20Ricci%20tensor%20automatically.%0A%0A%20%20%20%20For%20numerical%20relativity%2C%20these%20tensors%20contain%20the%20derivatives%20we%20need%20to%20discretize.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(Metric%2C%20Simplify%2C%20Symbol%2C%20symbols)%3A%0A%20%20%20%20%23%20Define%20a%20general%202D%20metric%20(simplified%20example)%0A%20%20%20%20x_m%2C%20y_m%20%3D%20symbols('x%20y'%2C%20real%3DTrue)%0A%0A%20%20%20%20%23%20Metric%20components%20as%20symbols%20(would%20be%20functions%20in%20full%20NR)%0A%20%20%20%20g_xx%20%3D%20Symbol('g_xx'%2C%20positive%3DTrue)%0A%20%20%20%20g_yy%20%3D%20Symbol('g_yy'%2C%20positive%3DTrue)%0A%0A%20%20%20%20%23%20Create%20a%20diagonal%20metric%3A%20ds%5E2%20%3D%20g_xx%20dx%5E2%20%2B%20g_yy%20dy%5E2%0A%20%20%20%20%23%20Metric(coords%2C%20components)%0A%20%20%20%20metric_2d%20%3D%20Metric(%0A%20%20%20%20%20%20%20%20%5Bx_m%2C%20y_m%5D%2C%0A%20%20%20%20%20%20%20%20%5B%5Bg_xx%2C%200%5D%2C%0A%20%20%20%20%20%20%20%20%20%5B0%2C%20g_yy%5D%5D%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20Christoffel%20symbols%20contain%20first%20derivatives%20of%20the%20metric%0A%20%20%20%20christoffels%20%3D%20metric_2d.christoffel_second_kind()%0A%0A%20%20%20%20%23%20Example%3A%20Gamma%5Ex_xx%20%3D%20(1%2F2)%20g%5Exx%20*%20d(g_xx)%2Fdx%0A%20%20%20%20Gamma_x_xx%20%3D%20Simplify(christoffels%5B0%2C%200%2C%200%5D)%0A%0A%20%20%20%20(metric_2d.g%2C%20Gamma_x_xx)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(D%2C%20Discretize%2C%20Function%2C%20Simplify%2C%20StencilCodeGen%2C%20mo%2C%20symbols)%3A%0A%20%20%20%20%23%20Now%20discretize%20a%20Christoffel-like%20term%0A%20%20%20%20%23%20Gamma%5Ei_jk%20involves%20d(g_jk)%2Fdx%5Ei%2C%20so%20we%20discretize%20metric%20derivatives%0A%20%20%20%20x_chr%2C%20y_chr%20%3D%20symbols('x%20y')%0A%20%20%20%20h_chr%20%3D%20symbols('h')%0A%0A%20%20%20%20%23%20Metric%20component%20as%20a%20function%20of%20position%0A%20%20%20%20g_xx_func%20%3D%20Function('g_xx')(x_chr%2C%20y_chr)%0A%0A%20%20%20%20%23%20The%20derivative%20that%20appears%20in%20Christoffel%20symbols%0A%20%20%20%20dg_dx%20%3D%20D(g_xx_func%2C%20x_chr)%0A%0A%20%20%20%20%23%20Discretize%20using%20central%20difference%0A%20%20%20%20step_chr%20%3D%20%7Bx_chr%3A%20(%5Bx_chr%20-%20h_chr%2C%20x_chr%2C%20x_chr%20%2B%20h_chr%5D%2C%20h_chr)%7D%0A%20%20%20%20dg_discrete%20%3D%20Discretize(dg_dx%2C%20step_chr)%0A%0A%20%20%20%20%23%20Code%20for%20Christoffel%20computation%0A%20%20%20%20chr_code%20%3D%20StencilCodeGen(dg_discrete%2C%20language%3D'c'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20array_name%3D'g_xx'%2C%20index_var%3D'i'%2C%20spacing_name%3D'dx')%0A%0A%20%20%20%20mo.md(f%22%22%22%0A%20%20%20%20**Discretizing%20Christoffel%20Symbol%20Terms%3A**%0A%0A%20%20%20%20Christoffel%20symbols%20involve%20metric%20derivatives%20like%20%24%5C%5Cpartial_x%20g_%7B%7Bxx%7D%7D%24%0A%0A%20%20%20%20Discretized%3A%20%24%7BSimplify(dg_discrete)%7D%24%0A%0A%20%20%20%20**C%20code%3A**%0A%20%20%20%20%60%60%60c%0A%20%20%20%20%2F%2F%20dg_xx%2Fdx%20for%20Christoffel%20computation%0A%20%20%20%20double%20dg_dx%20%3D%20%7Bchr_code%7D%3B%0A%0A%20%20%20%20%2F%2F%20Then%20Gamma%5Ex_xx%20%3D%200.5%20*%20g_xx_inv%20*%20dg_dx%0A%20%20%20%20double%20Gamma_x_xx%20%3D%200.5%20*%20g_xx_inv%20*%20dg_dx%3B%0A%20%20%20%20%60%60%60%0A%0A%20%20%20%20The%20full%20BSSN%20evolution%20uses%20these%20discretized%20Christoffels%20throughout.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%2014.%20Kreiss-Oliger%20Dissipation%0A%0A%20%20%20%20Numerical%20simulations%20often%20add%20artificial%20dissipation%20to%20control%0A%20%20%20%20high-frequency%20noise.%20The%20Kreiss-Oliger%20operator%20for%204th%20order%20schemes%3A%0A%0A%20%20%20%20%24%24%5Cepsilon%20(-1)%5E%7Br%2B1%7D%20h%5E%7B2r-1%7D%20D_%2B%5Er%20D_-%5Er%20%5Cphi%24%24%0A%0A%20%20%20%20where%20%24D_%2B%24%20and%20%24D_-%24%20are%20forward%2Fbackward%20difference%20operators.%0A%20%20%20%20For%20%24r%3D2%24%20this%20gives%20a%205-point%20dissipation%20stencil.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(D%2C%20Function%2C%20Simplify%2C%20Symbol%2C%20ToStencil%2C%20mo)%3A%0A%20%20%20%20%23%20Kreiss-Oliger%20dissipation%20(4th%20derivative%20for%204th%20order%20scheme)%0A%20%20%20%20x_ko%20%3D%20Symbol('x')%0A%20%20%20%20h_ko%20%3D%20Symbol('h')%0A%20%20%20%20eps%20%3D%20Symbol('epsilon')%0A%20%20%20%20phi_ko%20%3D%20Function('phi')(x_ko)%0A%0A%20%20%20%20%23%20Fourth%20derivative%20(appears%20in%20Kreiss-Oliger%20for%204th%20order%20methods)%0A%20%20%20%20d4_phi%20%3D%20D(phi_ko%2C%20(x_ko%2C%204))%0A%0A%20%20%20%20%23%20Discretize%20with%205-point%20stencil%0A%20%20%20%20ko_stencil%20%3D%20ToStencil(d4_phi%2C%20%7Bx_ko%3A%20h_ko%7D%2C%20width%3D5)%0A%0A%20%20%20%20mo.md(f%22%22%22%0A%20%20%20%20**Kreiss-Oliger%20Dissipation%20Term%3A**%0A%0A%20%20%20%20Fourth%20derivative%3A%20%24%5C%5Cfrac%7B%7B%5C%5Cpartial%5E4%5C%5Cphi%7D%7D%7B%7B%5C%5Cpartial%20x%5E4%7D%7D%24%0A%0A%20%20%20%20Discretized%3A%20%24%7BSimplify(ko_stencil)%7D%24%0A%0A%20%20%20%20Applied%20as%3A%20%24%5C%5Cphi%20%5C%5Cleftarrow%20%5C%5Cphi%20-%20%5C%5Cepsilon%20%5C%5Ccdot%20h%5E3%20%5C%5Ccdot%20(%5C%5Ctext%7B%7Bstencil%7D%7D)%24%0A%0A%20%20%20%20The%20coefficient%20%24%5C%5Cepsilon%20%5C%5Csim%200.1%24%20controls%20dissipation%20strength.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Summary%0A%0A%20%20%20%20This%20notebook%20demonstrated%20the%20complete%20pipeline%20from%20theoretical%20physics%0A%20%20%20%20to%20production-ready%20numerical%20simulation%20code%3A%0A%0A%20%20%20%20**Physics%20to%20Code%20Pipeline%3A**%0A%20%20%20%201.%20**Variational%20Calculus**%3A%20Derive%20equations%20of%20motion%20from%20Lagrangians%0A%20%20%20%202.%20**Discretization**%3A%20Convert%20PDEs%20to%20finite%20difference%20stencils%0A%20%20%20%203.%20**Multi-dimensional**%3A%20Handle%203D%20Laplacians%2C%20mixed%20derivatives%0A%20%20%20%204.%20**Code%20Generation**%3A%20Output%20C%2C%20Fortran%2C%20or%20Python%20for%20direct%20use%0A%0A%20%20%20%20**Numerical%20Relativity%20Applications%3A**%0A%20%20%20%20-%203D%20Laplacian%20(7-point%20stencil)%20for%20constraint%20equations%0A%20%20%20%20-%20Mixed%20derivatives%20for%20BSSN%20formulation%0A%20%20%20%20-%20ADM%20evolution%20equations%20with%20Ricci%20tensor%20terms%0A%20%20%20%20-%20Metric%20class%20for%20Christoffel%20symbols%20and%20curvature%20tensors%0A%20%20%20%20-%20Kreiss-Oliger%20dissipation%20for%20numerical%20stability%0A%0A%20%20%20%20**Accuracy%20Control%3A**%0A%20%20%20%20-%202nd%20order%20(3-point)%20to%208th%20order%20(9-point)%20stencils%0A%20%20%20%20-%20Error%20scaling%20from%20%24O(h%5E2)%24%20to%20%24O(h%5E8)%24%0A%0A%20%20%20%20This%20workflow%20is%20directly%20applicable%20to%20numerical%20relativity%20codes%20like%0A%20%20%20%20GRChombo%20(used%20in%20arXiv%3A1608.04408)%20for%20simulating%20inflation%20with%0A%20%20%20%20inhomogeneous%20initial%20conditions.%0A%0A%20%20%20%20%23%23%23%20Key%20Functions%3A%0A%20%20%20%20-%20%60VariationalDerivative(L%2C%20field%2C%20coords)%60%20-%20Euler-Lagrange%20equations%0A%20%20%20%20-%20%60Discretize(expr%2C%20step_map)%60%20-%20Finite%20difference%20conversion%0A%20%20%20%20-%20%60ToStencil(expr%2C%20spacing%2C%20width)%60%20-%20Auto-generate%20stencil%20points%0A%20%20%20%20-%20%60StencilCodeGen(expr%2C%20language)%60%20-%20C%2FFortran%2FPython%20code%20generation%0A%20%20%20%20-%20%60Metric(components%2C%20coords)%60%20-%20Tensor%20calculus%20with%20auto%20Christoffels%0A%20%20%20%20-%20%60Pipe(expr).then(...)%60%20-%20Composable%20API%20for%20chaining%20operations%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A
</marimo-code>

<marimo-code-hash hidden="">e603859ade21b58956ff4d13ffbe30d8</marimo-code-hash>
</body>
</html>
