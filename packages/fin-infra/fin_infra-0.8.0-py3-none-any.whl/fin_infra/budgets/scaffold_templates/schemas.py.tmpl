from __future__ import annotations
"""Pydantic schemas for budget API and validation.

This module defines the Pydantic models for budget CRUD operations,
following svc-infra's Base/Read/Create/Update pattern.

Generated by: fin-infra scaffold budgets
"""
from typing import Optional, Any, Dict
from datetime import datetime
from pydantic import BaseModel, Field, ConfigDict
from uuid import UUID


class Timestamped(BaseModel):
    """Mixin for created_at/updated_at timestamps."""
    model_config = ConfigDict(from_attributes=True)
    created_at: datetime
    updated_at: datetime


class ${Entity}Base(BaseModel):
    """Base ${entity} schema with core fields.
    
    Attributes:
        user_id: User identifier
        name: Budget name (e.g., "November 2025", "Q4 Marketing")
        type: Budget type (personal, household, business, project, custom)
        period: Budget period (weekly, biweekly, monthly, quarterly, yearly)
        categories: Mapping of category names to budgeted amounts
        start_date: Budget period start date
        end_date: Budget period end date
        rollover_enabled: Whether unused budget carries over (default: False)
        extra: Additional metadata (extensible)
    """
    model_config = ConfigDict(from_attributes=True, populate_by_name=True)
    
    user_id: Optional[str] = Field(None, description="User identifier", min_length=1, max_length=64)
    name: str = Field(..., description="Budget name", min_length=1, max_length=128)
    type: str = Field(..., description="Budget type (personal, household, business, project, custom)")
    period: str = Field(..., description="Budget period (weekly, biweekly, monthly, quarterly, yearly)")
    categories: Dict[str, float] = Field(
        default_factory=dict,
        description="Category name to budgeted amount mapping"
    )
    start_date: datetime = Field(..., description="Budget period start date")
    end_date: datetime = Field(..., description="Budget period end date")
    rollover_enabled: bool = Field(default=False, description="Whether unused budget carries over")
${tenant_field}    extra: Dict[str, Any] = Field(default_factory=dict, description="Additional metadata")


class ${Entity}Read(${Entity}Base, Timestamped):
    """Read schema with ID and timestamps.
    
    Used for GET /budgets/{id} responses.
    """
    id: UUID = Field(..., description="Budget unique identifier")


class ${Entity}Create(BaseModel):
    """Create schema for POST /budgets.
    
    Omits id and timestamps (generated by database).
    """
    model_config = ConfigDict(from_attributes=True)
    
    user_id: Optional[str] = Field(None, description="User identifier", min_length=1, max_length=64)
    name: str = Field(..., description="Budget name", min_length=1, max_length=128)
    type: str = Field(..., description="Budget type")
    period: str = Field(..., description="Budget period")
    categories: Dict[str, float] = Field(
        default_factory=dict,
        description="Category name to budgeted amount mapping"
    )
    start_date: datetime = Field(..., description="Budget period start date")
    end_date: datetime = Field(..., description="Budget period end date")
    rollover_enabled: bool = Field(default=False, description="Whether unused budget carries over")
${tenant_field_create}    extra: Dict[str, Any] = Field(default_factory=dict, description="Additional metadata")


class ${Entity}Update(BaseModel):
    """Update schema for PATCH /budgets/{id}.
    
    All fields optional (partial updates supported).
    """
    model_config = ConfigDict(from_attributes=True)
    
    user_id: Optional[str] = Field(None, description="User identifier", min_length=1, max_length=64)
    name: Optional[str] = Field(None, description="Budget name", min_length=1, max_length=128)
    type: Optional[str] = Field(None, description="Budget type")
    period: Optional[str] = Field(None, description="Budget period")
    categories: Optional[Dict[str, float]] = Field(None, description="Category allocations")
    start_date: Optional[datetime] = Field(None, description="Budget period start date")
    end_date: Optional[datetime] = Field(None, description="Budget period end date")
    rollover_enabled: Optional[bool] = Field(None, description="Rollover setting")
${tenant_field_update}    extra: Optional[Dict[str, Any]] = Field(None, description="Additional metadata")


# Example usage with FastAPI
"""
from fastapi import APIRouter, Depends
from svc_infra.api.fastapi.dual.protected import user_router
from svc_infra.db.sql.repository import SqlRepository
from .budget import Budget as BudgetModel, create_budget_service
from .budget_schemas import BudgetRead, BudgetCreate, BudgetUpdate

router = user_router(prefix="/budgets", tags=["Budgets"])

@router.post("/", response_model=BudgetRead)
async def create_budget(
    budget: BudgetCreate,
    repo: SqlRepository = Depends(get_repo),
):
    service = create_budget_service(repo)
    result = await service.create(budget.model_dump())
    return BudgetRead.model_validate(result)

@router.get("/{budget_id}", response_model=BudgetRead)
async def get_budget(
    budget_id: UUID,
    repo: SqlRepository = Depends(get_repo),
):
    result = await repo.get(budget_id)
    return BudgetRead.model_validate(result)

@router.patch("/{budget_id}", response_model=BudgetRead)
async def update_budget(
    budget_id: UUID,
    updates: BudgetUpdate,
    repo: SqlRepository = Depends(get_repo),
):
    service = create_budget_service(repo)
    result = await service.update(budget_id, updates.model_dump(exclude_unset=True))
    return BudgetRead.model_validate(result)
"""
