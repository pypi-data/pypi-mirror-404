# Visualization V2.0 - Visual Reference

**ASCII Diagrams and Layout Examples**

---

## Table of Contents

1. [User Flow Diagrams](#user-flow-diagrams)
2. [Layout Examples](#layout-examples)
3. [State Machine](#state-machine)
4. [Data Structures](#data-structures)
5. [Interaction Patterns](#interaction-patterns)

---

## User Flow Diagrams

### Flow 1: Navigate from Root to Function

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: Initial View (List)                                    â”‚
â”‚                                                                 â”‚
â”‚  Root Directories (Vertical List)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚  ğŸ“ src         â”‚ â† User clicks here                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚  ğŸ“ tests       â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚  ğŸ“ docs        â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚                                                                 â”‚
â”‚  Breadcrumb: [ğŸ  Root]                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Click "src"
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Directory Expanded (Horizontal Fan)                    â”‚
â”‚                                                                 â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                 â”Œâ”€â”€â”€â”€â”‚  ğŸ“ core    â”‚                           â”‚
â”‚                 â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                 â”‚                                               â”‚
â”‚                 â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                 â”œâ”€â”€â”€â”€â”‚  ğŸ“ cli     â”‚                           â”‚
â”‚                 â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                 â”‚                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚  ğŸ“ src        â”œâ”€â”€â”‚  ğŸ“ utils   â”‚                          â”‚
â”‚  â”‚      +         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜                                            â”‚
â”‚                 â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                 â”œâ”€â”€â”€â”€â”‚ ğŸ“„ main.py  â”‚ â† User clicks here        â”‚
â”‚                 â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                 â”‚                                               â”‚
â”‚                 â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                 â””â”€â”€â”€â”€â”‚ ğŸ“„ config.pyâ”‚                           â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                 â”‚
â”‚  Breadcrumb: [ğŸ  Root / src]                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Click "main.py"
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: File Expanded (AST Chunks + Call Edges)                â”‚
â”‚                                                                 â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚      â”Œâ”€â”€â”€â”‚ main()   â”‚                                          â”‚
â”‚      â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚      â”‚        â”‚                                                 â”‚
â”‚      â”‚        â”‚ calls (blue edge with arrow)                   â”‚
â”‚      â”‚        â–¼                                                 â”‚
â”‚      â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚      â”œâ”€â”€â”€â”‚ setup()  â”‚                                          â”‚
â”‚      â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚      â”‚        â”‚                                                 â”‚
â”‚      â”‚        â”‚ calls                                           â”‚
â”‚      â”‚        â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚  â”‚ ğŸ“„ main.py   â”œâ”€â”€â”€â”‚ Config   â”‚ â† Class                      â”‚
â”‚  â”‚      +       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚                                     â”‚
â”‚      â”‚                   â”‚ calls                                â”‚
â”‚      â”‚                   â–¼                                      â”‚
â”‚      â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ load()   â”‚                               â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                 â”‚
â”‚  Breadcrumb: [ğŸ  Root / src / main.py]                         â”‚
â”‚                                                                 â”‚
â”‚  Content Pane (right side): Shows code for selected chunk      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Flow 2: Sibling Directory Switch

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STATE: Directory "src" Expanded                                 â”‚
â”‚                                                                 â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚       â”Œâ”€â”€â”€â”‚ core   â”‚                                            â”‚
â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚   â”Œâ”€â”€â”€â”´â”€â”€â”                                                      â”‚
â”‚   â”‚ src  â”œâ”€â”€â”€â”¬â”€â”€â”€â”€â”                                            â”‚
â”‚   â”‚  +   â”‚   â”‚cli â”‚                                            â”‚
â”‚   â””â”€â”€â”€â”¬â”€â”€â”˜   â””â”€â”€â”€â”€â”˜                                            â”‚
â”‚       â”‚                                                          â”‚
â”‚       â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚           â”‚ main.py â”‚                                           â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚                                                                 â”‚
â”‚  User clicks sibling "tests" directory                         â”‚
â”‚                                 â†“                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ Close "src", Open "tests"
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STATE: Directory "tests" Expanded (src collapsed)               â”‚
â”‚                                                                 â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚      â”Œâ”€â”€â”€â”‚ unit/      â”‚                                         â”‚
â”‚      â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚  â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚  â”‚ tests   â”œâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚  â”‚   +     â”‚   â”‚integration/â”‚                                  â”‚
â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚      â”‚                                                           â”‚
â”‚      â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚          â”‚ test_main.py     â”‚                                  â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                                                                 â”‚
â”‚  NOTE: "src" children are now hidden                           â”‚
â”‚  Only ONE sibling path visible at a time                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Layout Examples

### Example 1: Small Project (Root List)

```
Project Root: my-app/

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚    List View (Alphabetically Sorted)                           â”‚
â”‚                                                                 â”‚
â”‚    x=100                                                        â”‚
â”‚    â†“                                                            â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â† y=150 (first dir)                   â”‚
â”‚    â”‚  ğŸ“ docs        â”‚ +                                       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â† y=200 (spacing=50px)                â”‚
â”‚    â”‚  ğŸ“ src         â”‚ +                                       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â† y=250                                â”‚
â”‚    â”‚  ğŸ“ tests       â”‚ +                                       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â† y=300 (first file after dirs)       â”‚
â”‚    â”‚  ğŸ“„ README.md   â”‚                                         â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â† y=350                                â”‚
â”‚    â”‚  ğŸ“„ setup.py    â”‚                                         â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                                                                 â”‚
â”‚  Spacing: 50px between nodes                                   â”‚
â”‚  Sorting: Directories first, then files (alphabetical)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Example 2: Directory Expanded (Horizontal Fan)

```
Directory: src/ (5 children)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚  Fan Layout (180Â° horizontal arc)                              â”‚
â”‚                                                                 â”‚
â”‚                          child[0] (leftmost)                   â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”‚ cli/   â”‚                             â”‚
â”‚                     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                     â”‚                                            â”‚
â”‚              angle=180Â°  child[1]                               â”‚
â”‚                     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚                     â”œâ”€â”€â”€â”€â”‚ core/  â”‚                             â”‚
â”‚                     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                     â”‚                                            â”‚
â”‚           radius=200px   child[2] (center, angle=90Â°)          â”‚
â”‚                     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”  â”‚ utils/ â”‚                            â”‚
â”‚  â”‚   src/             â”œâ”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚  â”‚    +               â”‚                                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜  child[3]                              â”‚
â”‚                     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚                     â”œâ”€â”€â”€â”€â”‚main.py â”‚                             â”‚
â”‚                     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                     â”‚                                            â”‚
â”‚              angle=0Â°    child[4] (rightmost)                   â”‚
â”‚                     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚                     â””â”€â”€â”€â”€â”‚config.py                             â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                                                 â”‚
â”‚  Radius: adaptive (200-400px based on child count)             â”‚
â”‚  Arc: 180Â° (horizontal left-to-right)                          â”‚
â”‚  Spacing: Even distribution across arc                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Angle Calculation**:
- child[0]: angle = 180Â° (Ï€ radians) â†’ leftmost
- child[1]: angle = 135Â° (3Ï€/4 radians)
- child[2]: angle = 90Â° (Ï€/2 radians) â†’ top center
- child[3]: angle = 45Â° (Ï€/4 radians)
- child[4]: angle = 0Â° â†’ rightmost

**Position Formula**:
```
x = parent.x + radius * cos(angle)
y = parent.y + radius * sin(angle)
```

---

### Example 3: File Expanded (AST Chunks)

```
File: main.py (Python file with 7 AST chunks)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚  AST Fan + Function Call Edges                                 â”‚
â”‚                                                                 â”‚
â”‚              [import]                                           â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚          â”Œâ”€â”€â”€â”‚logging â”‚ (import chunk)                         â”‚
â”‚          â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚          â”‚                                                       â”‚
â”‚          â”‚   [function]                                         â”‚
â”‚          â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚          â”œâ”€â”€â”€â”‚ main() â”‚                                         â”‚
â”‚          â”‚   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                         â”‚
â”‚          â”‚       â”‚                                               â”‚
â”‚          â”‚       â”‚ calls (blue edge)                            â”‚
â”‚          â”‚       â–¼                                               â”‚
â”‚          â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”â”‚ setup()â”‚                                        â”‚
â”‚  â”‚ main.py  â”œâ”´â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                        â”‚
â”‚  â”‚    +     â”‚    â”‚                                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜    â”‚ calls                                        â”‚
â”‚          â”‚       â–¼                                               â”‚
â”‚          â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚          â”‚   â”‚Config  â”‚ [class]                                â”‚
â”‚          â”‚   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                         â”‚
â”‚          â”‚       â”‚                                               â”‚
â”‚          â”‚       â”‚ contains (containment edge - NOT shown)     â”‚
â”‚          â”‚       â–¼                                               â”‚
â”‚          â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚          â”œâ”€â”€â”€â”‚__init__â”‚ [method]                                â”‚
â”‚          â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚          â”‚                                                       â”‚
â”‚          â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚          â””â”€â”€â”€â”‚ load() â”‚ [method]                                â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                                                                 â”‚
â”‚  EDGE FILTERING:                                                â”‚
â”‚  âœ… Show: type='caller' (function calls)                       â”‚
â”‚  âŒ Hide: type='semantic', 'imports', 'containment'            â”‚
â”‚                                                                 â”‚
â”‚  Only edges where:                                              â”‚
â”‚   - source.file_path == target.file_path == 'main.py'         â”‚
â”‚   - link.type == 'caller'                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Edge Types in AST View**:
| Type | Show? | Reason |
|------|-------|--------|
| `caller` | âœ… Yes | Explicit function calls (actionable) |
| `semantic` | âŒ No | Implicit similarity (noise) |
| `imports` | âŒ No | File-level dependency (not AST-level) |
| `containment` | âŒ No | Implied by layout (class contains methods) |

---

## State Machine

### Visualization State Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         STATE MACHINE                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  INITIAL                                      â”‚
     â”‚  â€¢ layoutMode = 'list'                        â”‚
     â”‚  â€¢ visibleNodes = {root_dirs, root_files}     â”‚
     â”‚  â€¢ expansionPath = []                         â”‚
     â”‚  â€¢ activeSiblings = {}                        â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ event: Click directory D1
                  â”‚ action: expandNode(D1)
                  â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  DIR_EXPANDED                                 â”‚
     â”‚  â€¢ layoutMode = 'fan'                         â”‚
     â”‚  â€¢ visibleNodes += {D1.children}              â”‚
     â”‚  â€¢ expansionPath = [D1]                       â”‚
     â”‚  â€¢ activeSiblings[0] = D1                     â”‚
     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚
          â”‚ Click sibling D2 â”‚ Click file F1 in D1
          â”‚                  â”‚
          â–¼                  â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ SIBLING    â”‚     â”‚ FILE_EXPANDED        â”‚
     â”‚ SWITCHED   â”‚     â”‚ â€¢ expansionPath =    â”‚
     â”‚            â”‚     â”‚   [D1, F1]           â”‚
     â”‚ â€¢ Close D1 â”‚     â”‚ â€¢ visibleNodes +=    â”‚
     â”‚ â€¢ Open D2  â”‚     â”‚   {F1.ast_chunks}    â”‚
     â”‚ â€¢ Return toâ”‚     â”‚ â€¢ Show caller edges  â”‚
     â”‚   DIR_EXP  â”‚     â”‚   within F1          â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Click collapse on D1
                                â”‚ action: collapseNode(D1)
                                â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  COLLAPSED             â”‚
                    â”‚  â€¢ Remove F1 from path â”‚
                    â”‚  â€¢ Hide F1.ast_chunks  â”‚
                    â”‚  â€¢ Return to DIR_EXP   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ Click collapse on D1
                             â”‚ OR Press Home key
                             â–¼
                        Back to INITIAL state

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  State Invariants (must always be true):                       â”‚
â”‚                                                                 â”‚
â”‚  1. visibleNodes âŠ‡ expansionPath                               â”‚
â”‚     (All nodes in path must be visible)                        â”‚
â”‚                                                                 â”‚
â”‚  2. expansionPath.length â‰¤ max_depth                           â”‚
â”‚     (Finite depth, no infinite recursion)                      â”‚
â”‚                                                                 â”‚
â”‚  3. âˆ€ depth: activeSiblings[depth] âˆˆ visibleNodes              â”‚
â”‚     (Active sibling must be visible)                           â”‚
â”‚                                                                 â”‚
â”‚  4. layoutMode âˆˆ {'list', 'fan'}                               â”‚
â”‚     (Only two valid layout modes)                              â”‚
â”‚                                                                 â”‚
â”‚  5. If layoutMode == 'list' â†’ expansionPath == []              â”‚
â”‚     (List mode means nothing expanded)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Structures

### 1. Node Structure (Unchanged)

```javascript
{
  id: "func_abc123",               // Unique identifier
  name: "calculate_total",         // Display name
  type: "function",                // 'directory' | 'file' | 'function' | 'class' | 'method'
  file_path: "src/utils/math.py", // Absolute path
  start_line: 42,                  // Start line in file
  end_line: 58,                    // End line in file
  complexity: 5.2,                 // Cyclomatic complexity
  depth: 3,                        // Distance from root
  parent_id: "file_xyz789",        // Parent node ID (or null)
  content: "def calculate_total():\n    ...",  // Source code
  docstring: "Calculate the total sum...",     // Documentation
  language: "python",              // Programming language
  callers: [                       // External callers (if applicable)
    {
      file: "src/main.py",
      chunk_id: "func_def456",
      name: "main",
      type: "function"
    }
  ],
  x: 450.5,                        // D3 position (updated by layout)
  y: 320.8                         // D3 position (updated by layout)
}
```

### 2. Link Structure (Unchanged)

```javascript
{
  source: "func_abc123",  // Source node ID (or Node object after D3 processing)
  target: "func_def456",  // Target node ID (or Node object)
  type: "caller",         // 'caller' | 'semantic' | 'imports' | 'containment' | 'dir_hierarchy'
  is_cycle: false,        // True if part of circular dependency
  similarity: 0.85        // For semantic links only (0.0-1.0)
}
```

### 3. NEW: NodeState Structure

```javascript
{
  id: "dir_src",          // Node ID (matches Node.id)
  isExpanded: true,       // Has this node been expanded?
  isInFan: false,         // Is this node currently in a fan layout?
  layoutOverride: {       // Fixed position for list/fan layout
    x: 100,
    y: 200,
    fixed: true           // Don't apply force simulation
  },
  depth: 1,               // Distance from root
  parentId: "root",       // Parent node ID
  childrenIds: [          // Direct children IDs
    "file_main",
    "dir_cli",
    "dir_core"
  ]
}
```

### 4. NEW: Expansion Path

```javascript
expansionPath = [
  "dir_src",      // Root-level directory
  "dir_cli",      // Subdirectory of src
  "file_main.py"  // File in cli directory
]

// Represents: Root â†’ src/ â†’ cli/ â†’ main.py
// Each element is a node ID
// Length indicates current depth
```

### 5. NEW: Active Siblings Map

```javascript
activeSiblings = new Map([
  [0, "dir_src"],    // At depth 0, "src" is expanded
  [1, "dir_cli"],    // At depth 1, "cli" is expanded
  [2, "file_main"]   // At depth 2, "main.py" is expanded
])

// Key: depth level (0, 1, 2, ...)
// Value: node ID of currently expanded sibling at that depth
// Used for sibling exclusivity (only one sibling expanded per depth)
```

---

## Interaction Patterns

### Pattern 1: Directory Expansion

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER ACTION: Click directory node                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: Check for active sibling at same depth                â”‚
â”‚                                                                 â”‚
â”‚  if (activeSiblings.has(node.depth)) {                         â”‚
â”‚    const siblingId = activeSiblings.get(node.depth);           â”‚
â”‚    if (siblingId !== node.id) {                                â”‚
â”‚      collapseNode(siblingId);  // Close sibling first          â”‚
â”‚    }                                                            â”‚
â”‚  }                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: Mark node as expanded                                 â”‚
â”‚                                                                 â”‚
â”‚  nodeStateManager.setExpanded(node.id, true);                  â”‚
â”‚  expansionPath.push(node.id);                                  â”‚
â”‚  activeSiblings.set(node.depth, node.id);                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: Find and show children                                â”‚
â”‚                                                                 â”‚
â”‚  const children = allLinks                                     â”‚
â”‚    .filter(l => l.source === node.id &&                        â”‚
â”‚                 l.type === 'dir_containment')                  â”‚
â”‚    .map(l => l.target);                                        â”‚
â”‚                                                                 â”‚
â”‚  children.forEach(child => {                                   â”‚
â”‚    visibleNodes.add(child.id);                                 â”‚
â”‚    nodeStateManager.setInFan(child.id, true);                  â”‚
â”‚  });                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: Calculate fan layout                                  â”‚
â”‚                                                                 â”‚
â”‚  const positions = calculateFanLayout(                         â”‚
â”‚    node,                                                       â”‚
â”‚    children,                                                   â”‚
â”‚    containerWidth,                                             â”‚
â”‚    containerHeight                                             â”‚
â”‚  );                                                            â”‚
â”‚                                                                 â”‚
â”‚  positions.forEach((pos, childId) => {                         â”‚
â”‚    layoutPositions.set(childId, pos);                          â”‚
â”‚  });                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 5: Render with animation                                 â”‚
â”‚                                                                 â”‚
â”‚  layoutMode = 'fan';                                           â”‚
â”‚  renderGraphWithTransition(750ms);                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Pattern 2: Breadcrumb Navigation

```
Expansion Path: [dir_src, dir_cli, file_main.py]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BREADCRUMB DISPLAY                                             â”‚
â”‚                                                                 â”‚
â”‚  [ğŸ  Root] / [src] / [cli] / [main.py]                         â”‚
â”‚      â†‘         â†‘      â†‘         â†‘                              â”‚
â”‚   onclick  onclick onclick  (current - not clickable)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER ACTION: Click "cli" in breadcrumb                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: Find position in path                                 â”‚
â”‚                                                                 â”‚
â”‚  const clickedIndex = expansionPath.indexOf('dir_cli');        â”‚
â”‚  // clickedIndex = 1                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: Collapse all descendants                              â”‚
â”‚                                                                 â”‚
â”‚  const toCollapse = expansionPath.slice(clickedIndex + 1);     â”‚
â”‚  // toCollapse = ['file_main.py']                              â”‚
â”‚                                                                 â”‚
â”‚  toCollapse.forEach(nodeId => {                                â”‚
â”‚    collapseNode(nodeId);                                       â”‚
â”‚  });                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RESULT: Navigated to cli/ level                               â”‚
â”‚                                                                 â”‚
â”‚  Expansion Path: [dir_src, dir_cli]                            â”‚
â”‚  Breadcrumb: [ğŸ  Root] / [src] / [cli]                         â”‚
â”‚                                                                 â”‚
â”‚  Visible: src/, cli/ directory, and cli/'s children            â”‚
â”‚  Hidden: main.py and its AST chunks                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Pattern 3: Keyboard Shortcuts

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  KEYBOARD NAVIGATION                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  [Escape]        Close content pane + collapse current node    â”‚
â”‚                                                                 â”‚
â”‚  [Backspace]     Navigate up one level in expansion path       â”‚
â”‚                                                                 â”‚
â”‚  [Home]          Reset to root list view                       â”‚
â”‚                                                                 â”‚
â”‚  [Alt + â†]       Navigate back in view history                 â”‚
â”‚                                                                 â”‚
â”‚  [Alt + â†’]       Navigate forward in view history              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Example: Press Backspace

Current State:
  expansionPath = [dir_src, dir_cli, file_main]
  Breadcrumb: Root / src / cli / main.py

After Backspace:
  expansionPath = [dir_src, dir_cli]
  Breadcrumb: Root / src / cli
  Effect: Collapses file_main and its AST chunks
```

---

## Implementation Cheat Sheet

### Quick Reference: Key Functions

| Function | Purpose | Time Complexity |
|----------|---------|-----------------|
| `calculateListLayout()` | Position root nodes vertically | O(n log n) (sorting) |
| `calculateFanLayout()` | Position children in horizontal arc | O(n) |
| `expandNode()` | Show children in fan layout | O(n) where n=children |
| `collapseNode()` | Hide all descendants recursively | O(n) where n=descendants |
| `renderGraphWithTransition()` | Main render with animation | O(n + m) nodes + links |
| `getFilteredLinksForCurrentView()` | Filter edges by type and visibility | O(m) where m=links |
| `animateLayoutTransition()` | Smooth position transitions | O(n) |
| `detectAndResolveCollisions()` | Fix overlapping nodes | O(n log n) with spatial grid |

### Quick Reference: State Variables

| Variable | Type | Purpose |
|----------|------|---------|
| `allNodes` | Array<Node> | All nodes in graph (unchanged) |
| `allLinks` | Array<Link> | All edges in graph (unchanged) |
| `expansionPath` | Array<string> | Stack of expanded node IDs |
| `visibleNodes` | Set<string> | Currently visible node IDs |
| `nodeStates` | Map<string, NodeState> | Per-node expansion state |
| `layoutMode` | 'list' \| 'fan' | Current layout algorithm |
| `layoutPositions` | Map<string, {x, y}> | Fixed positions for nodes |
| `activeSiblings` | Map<number, string> | Expanded sibling at each depth |
| `highlightedNode` | Node \| null | Currently selected node |

---

**END OF VISUAL REFERENCE**

For detailed implementation, see: `VISUALIZATION_ARCHITECTURE_V2.md`
