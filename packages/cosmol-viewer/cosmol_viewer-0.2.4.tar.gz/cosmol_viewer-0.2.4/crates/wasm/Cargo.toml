[package]
name = "cosmol_viewer_wasm"
version.workspace = true
edition.workspace = true
description.workspace = true
publish = false

[dependencies]
cosmol_viewer_core.workspace = true
serde_json.workspace = true
serde.workspace = true
base64.workspace = true
thiserror.workspace = true
image.workspace = true
flate2.workspace = true

postcard = { version = "1.1.3", features = ["alloc"] }

eframe = { workspace = true, optional = true }
pyo3 = { workspace = true, optional = true }

uuid = { version = "1.19.0", features = ["v4"], optional = true }
log = { version = "0.4.28", optional = true }
wasm-bindgen-futures = { version = "0.4.58", optional = true }
web-sys = { version = "0.3.85", features = ["HtmlCanvasElement", "console","Window"], optional = true }
wasm-bindgen = { version = "0.2.108", optional = true }
gloo-timers = { version = "0.3.0", features = ["futures-core", "futures"], optional = true }

[features]
default = ["wasm"]

wasm = [
    "eframe",
    "wasm-bindgen-futures",
    "web-sys",
    "wasm-bindgen",
    "gloo-timers",
    "log",
]

js_bridge = [
    "pyo3",
    "uuid",
]

[lib]
crate-type = ["rlib", "cdylib"]

[package.metadata.wasm-pack.profile.dev]
wasm-opt = ['-O']

[package.metadata.wasm-pack.profile.dev.wasm-bindgen]
debug-js-glue = true
demangle-name-section = true
dwarf-debug-info = true

[package.metadata.wasm-pack.profile.release]
wasm-opt = [
  "-O4",
  "--enable-simd",
  "--enable-bulk-memory",
  "--enable-mutable-globals",
 "--enable-nontrapping-float-to-int",
  "--zero-filled-memory",
  "--strip-producers",
  "--vacuum",
]

[package.metadata.wasm-pack.profile.release.wasm-bindgen]
debug-js-glue = true
demangle-name-section = false
dwarf-debug-info = false
split-linked-modules = false
