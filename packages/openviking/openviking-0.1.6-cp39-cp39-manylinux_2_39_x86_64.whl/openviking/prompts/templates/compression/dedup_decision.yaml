metadata:
  id: "compression.dedup_decision"
  name: "Memory Deduplication Decision"
  description: "Decide whether new memory should CREATE/UPDATE/MERGE/SKIP"
  version: "1.1.0"
  language: "en"
  category: "compression"

variables:
  - name: "candidate_content"
    type: "string"
    description: "Candidate memory content (L2)"
    required: true
  - name: "candidate_abstract"
    type: "string"
    description: "Candidate memory abstract (L0)"
    required: true
  - name: "candidate_overview"
    type: "string"
    description: "Candidate memory overview (L1)"
    required: true
  - name: "existing_memories"
    type: "string"
    description: "List of existing similar memories"
    required: true

template: |
  Determine how to handle this candidate memory.

  **Candidate Memory**:
  Abstract: {{ candidate_abstract }}
  Overview: {{ candidate_overview }}
  Content: {{ candidate_content }}

  **Existing Similar Memories**:
  {{ existing_memories }}

  Please decide the operation type:
  - CREATE: This is a completely new memory, should be created
  - UPDATE: Candidate memory is a supplement/update to existing memory, should update the most relevant one
  - MERGE: Candidate memory is related to multiple existing memories, should be merged
  - SKIP: Candidate memory duplicates existing memories, no need to save

  Return JSON format:
  {
    "decision": "create|update|merge|skip",
    "reason": "Decision reason",
    "merged_content": "If UPDATE or MERGE, provide merged L2 content"
  }

  Notes:
  - If candidate memory provides new information, choose UPDATE or MERGE
  - If candidate memory is completely duplicate, choose SKIP
  - If candidate memory is a new topic, choose CREATE
  - merged_content is only needed for UPDATE/MERGE, and should be complete L2 content

llm_config:
  temperature: 0.0
