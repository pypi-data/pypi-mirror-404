{{/*
Secret for database credentials
Only created if not using an existing secret
*/}}
{{- if and (not .Values.database.existingSecret) (not .Values.database.passwordSecret) }}
{{/*
WARNING: This secret template is provided for development/testing only.
In production, you should:
1. Use database.existingSecret to reference a pre-created secret
2. Use database.passwordSecret to reference a secret containing the password
3. Use external secret management (Vault, AWS Secrets Manager, etc.)
*/}}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "confiture.fullname" . }}-db
  labels:
    {{- include "confiture.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-weight": "-10"
    "helm.sh/resource-policy": keep
type: Opaque
stringData:
  # IMPORTANT: Replace this placeholder with actual credentials
  # This is only for development/testing purposes
  DATABASE_URL: "postgresql://postgres:CHANGE_ME@{{ .Values.database.host }}:{{ .Values.database.port }}/{{ .Values.database.name }}?sslmode={{ .Values.database.sslMode }}"
{{- end }}
