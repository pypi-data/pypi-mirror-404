---
repos:
  # AI Linter for validating skills and agents
  - repo: local
    hooks:
      - id: ai-linter-local
        name: AI Linter (Local)
        entry: python src/aiLinter.py --skills .
        language: python
        types: [markdown]
        files: ^(.*/)?(SKILL|AGENTS)\.md$
        require_serial: true
        pass_filenames: false
        additional_dependencies:
          - "tiktoken>=0.5.0"
          - "PyYAML>=6.0"
          - "pyparsing>=3.0.0"
      - id: test
        name: test
        entry: make test
        language: system
        pass_filenames: false
        always_run: true
        stages: [pre-commit]

  # Python code formatting with Black
  - repo: https://github.com/psf/black
    rev: 26.1.0
    hooks:
      - id: black
        language_version: python3
        args: [--line-length=120]

  # Python import sorting with isort
  - repo: https://github.com/pycqa/isort
    rev: 7.0.0
    hooks:
      - id: isort
        args: ["--profile", "black"]

  # Python linting with flake8
  - repo: https://github.com/pycqa/flake8
    rev: 7.3.0
    hooks:
      - id: flake8
        args:
          - --max-line-length=120
          - --extend-ignore=E203,W503

  # Python security linting with bandit
  - repo: https://github.com/pycqa/bandit
    rev: 1.9.3
    hooks:
      - id: bandit
        args: [--skip, "B101"]
        exclude: ^tests/

  # YAML linting
  - repo: https://github.com/adrienverge/yamllint
    rev: v1.38.0
    hooks:
      - id: yamllint
        args: [-d, "{extends: default, rules: {line-length: {max: 120}}}"]

  # Markdown formatting and linting
  - repo: https://github.com/executablebooks/mdformat
    # Do this before other tools "fixing" the line endings
    rev: 0.7.22
    hooks:
      - id: mdformat
        name: Format Markdown
        entry: mdformat  # Executable to run, with fixed options
        language: python
        types: [markdown]
        args: [--wrap, "120", --number]
        additional_dependencies:
          - mdformat-front-matters
          - mdformat-shfmt
          - mdformat-tables
          - mdformat-config
          - mdformat-web
          - mdformat-gfm
        exclude: |
          (?x)(
            ^\.github/prompts/|
            AGENTS\.md|
            SKILL\.md
          )

  - repo: https://github.com/jsh9/markdown-heading-numbering
    rev: 0.1.0
    hooks:
      - id: markdown-heading-numbering
        args:
          - --start-from-level=2
          - --initial-numbering=1
        exclude: |
          (?x)(
            ^\.github/prompts/|
            ^doc/ai/|
            AGENTS\.md|
            SKILL\.md
          )

  - repo: https://github.com/jsh9/markdown-toc-creator
    rev: 0.1.3
    hooks:
      - id: markdown-toc-creator
        args:
          - --proactive=False
          - --style=github
          - --quiet
          - --add-toc-title=False
          - --add-horizontal-rules=False

  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.47.0
    hooks:
      - id: markdownlint
        args:
          - --disable=MD041
          - --fix
        exclude: |
          (?x)(
            ^\.github/prompts/|
            ^doc/ai/
          )

  - repo: https://github.com/rhysd/actionlint
    rev: v1.7.10
    hooks:
      - id: actionlint
        stages: [pre-commit, manual]

  - repo: https://github.com/fchastanet/jumanjihouse-pre-commit-hooks
    rev: 3.0.2
    hooks:
      # Check both committed and uncommitted files for git conflict
      # markers and whitespace errors according to core.whitespace
      # and conflict-marker-size configuration in a git repo.
      - id: git-check
        # x modifier: extended. Spaces and text after a # in the pattern are ignored
        exclude: |
          (?x)(
            /testsData/
          )

  - repo: https://github.com/fchastanet/bash-tools-framework
    rev: 6.2.4
    hooks:
      - id: plantuml
        args: [--same-dir, -f, png, --limit-size, "8290"]


  # Check for merge conflict markers
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: check-merge-conflict
      - id: check-yaml
      - id: check-toml
      - id: check-json
        # x modifier: extended. Spaces and text after a # in the pattern are ignored
        exclude: |
          (?x)(
            ^.vscode\/.*\.json$
          )
      - id: end-of-file-fixer
      - id: trailing-whitespace
      - id: check-added-large-files
      - id: forbid-new-submodules
      - id: mixed-line-ending
        args: [--fix=lf]

  # Python type checking with mypy
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.19.1
    hooks:
      - id: mypy
        additional_dependencies: [types-PyYAML]
        exclude: ^(tests|docs)/

ci:
  autofix_commit_msg: |
    [pre-commit.ci] auto fixes from pre-commit.com hooks

    for more information, see https://pre-commit.ci
  autofix_prs: true
  autoupdate_branch: 'pre-commit-ci/autoupdate'
  autoupdate_commit_msg: '[pre-commit.ci] pre-commit autoupdate'
  autoupdate_schedule: weekly
  skip: [black, isort, flake8, mypy, ai-linter-local, test]
  submodules: false
