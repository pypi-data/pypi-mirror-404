[project]
name = "cligram"
description = "cli based telegram client"
authors = [
    {name = "Alireza Poodineh",email = "itsaeliux@gmail.com"}
]
license-files = ["LICENSE.md"]
readme = "README.md"
requires-python = "<4.0,>=3.11"
dependencies = [
    "telethon (>=1.41.2,<2.0.0)",
    "python-socks[asyncio] (>=2.7.2,<3.0.0)",
    "typer (>=0.20.0,<0.21.0)",
    "pysocks (>=1.7.1,<2.0.0)",
    "rich (>=14.2.0,<15.0.0)",
    "aiofiles (>=25.1.0,<26.0.0)",
    "cryptography (>=46.0.3,<47.0.0)",
    "python-dotenv (>=1.2.1,<2.0.0)",
    "questionary (>=2.1.1,<3.0.0)",
]
keywords = ["telegram", "cli", "bot", "automation", "messaging"]
classifiers = [
    "Development Status :: 3 - Alpha",
    "Intended Audience :: Developers",
    "Programming Language :: Python :: 3.13",
    "Programming Language :: Python :: 3 :: Only",
    "Topic :: Communications :: Chat",
    "Topic :: Internet",
    "Typing :: Typed",
]
dynamic = []
version = "0.4.0"

[project.scripts]
cligram = "cligram.cli:main"

[project.urls]
Homepage = "https://github.com/Aeliux/cligram"
Repository = "https://github.com/Aeliux/cligram"
Issues = "https://github.com/Aeliux/cligram/issues"
documentation = "https://cligram.readthedocs.io"

[project.optional-dependencies]
# Performance optimization extras
speedups = [
    "cryptg>=0.5.0,<0.6.0",
    "aiohttp>=3.8.5,<4.0.0",
    "ujson>=5.8.0,<6.0.0",
    "pillow>=10.0.0,<11.0.0",
    "hachoir>=3.3.0,<4.0.0",
]

[dependency-groups]
dev = [
    "mypy (>=1.18.2,<2.0.0)",
    "black (>=25.9.0,<26.0.0)",
    "pytest (>=8.4.2,<9.0.0)",
    "isort (>=7.0.0,<8.0.0)",
    "pip-audit (>=2.9.0,<3.0.0)",
    "bandit (>=1.8.6,<2.0.0)",
    "ruff (>=0.14.3,<0.15.0)",
    "pre-commit (>=4.3.0,<5.0.0)",
    "pytest-asyncio (>=1.2.0,<2.0.0)",
    "pytest-cov (>=7.0.0,<8.0.0)",
    "types-aiofiles (>=25.1.0.20251011,<26.0.0.0)",
    #"pydocstyle (>=6.3.0,<7.0.0)",
    #"interrogate (>=1.7.0,<2.0.0)",
]
docs = [
    "sphinx (>=8.2.3,<9.0.0)",
    "sphinx-rtd-theme (>=3.0.2,<4.0.0)",
    "sphinx-autodoc-typehints (>=3.5.2,<4.0.0)",
    "myst-parser (>=4.0.1,<5.0.0)",
    "sphinx-autobuild (>=2025.8.25,<2026.0.0)",
]


[tool.poetry]
include = [
    { path = "src/cligram/**/*.so", format = "wheel" },
    { path = "src/cligram/**/*.pyd", format = "wheel" },
    { path = "src/cligram/**/*.c", format = "sdist" },
    { path = "src/cligram/**/*.h", format = "sdist" },
    { path = "src/cligram/**/*.h", format = "wheel" },
]
exclude = [
    "src/cligram/**/*.c"
]

[tool.poetry.build]
script = "cligram_build.py"


[tool.poetry.requires-plugins]
poetry-dynamic-versioning = { version = ">=1.0.0,<2.0.0", extras = ["plugin"] }


[tool.poetry-dynamic-versioning]
enable = false
vcs = "git"
metadata = false
style = "pep440"
strict = true
ignore-untracked = true

[tool.poetry-dynamic-versioning.substitution]
files = ["*.py", "*/__init__.py", "*/__version__.py", "*/_version.py"]
patterns = [
    '''(^__version__\s*(?::.*?)?=\s*['"])[^'"]*(['"])''',
    { value = '''(^__version_tuple__\s*(?::.*?)?=\s*\()[^)]*(\))''', mode = "tuple" },
]
folders = [
  { path = "src/cligram" }
]

[tool.poetry-dynamic-versioning.files."src/cligram/_gen_version.py"]
persistent-substitution = true
initial-content = """
  # These version placeholders will be replaced later during build.
  __version__ = "0.0.0"
  __version_tuple__ = (0, 0, 0)
"""

[build-system]
requires = [
    "poetry-core>=1.0.0",
    "poetry-dynamic-versioning>=1.0.0,<2.0.0",
    "setuptools>=65.0.0",
]
build-backend = "poetry_dynamic_versioning.backend"

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]
addopts = [
    "--verbose",
    "--tb=short",
    "--disable-warnings",
    "--strict-markers",
]
markers = [
    "asyncio: marks tests as async",
    "slow: marks tests as slow",
    "integration: marks tests as integration tests",
]


[tool.coverage.run]
source = ["src/cligram"]
omit = [
    "*/tests/*",
    "*/__pycache__/*",
    "*/site-packages/*",
    "src/cligram/__version__.py",     # nothing testable here
    "src/cligram/cli.py",             # cli entrypoint
    "src/cligram/app.py",             # application entrypoint
    "src/cligram/logger.py",          # logger setup, used by cli
    "src/cligram/scanner.py",         # scanner tool, not part of main flow, also app dependant
    "src/cligram/tasks/*",            # tasks can't be tested easily
    "src/cligram/commands/*",         # cli commands
]

[tool.coverage.report]
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "raise AssertionError",
    "raise NotImplementedError",
    "if __name__ == .__main__.:",
    "if TYPE_CHECKING:",
    "@abstractmethod",
]

[tool.black]
line-length = 88

[tool.isort]
profile = "black"

[tool.ruff]
line-length = 88

# [tool.ruff.lint]
# select = [
#     "E",   # pycodestyle errors
#     "W",   # pycodestyle warnings
#     "F",   # pyflakes
#     "D",   # pydocstyle (docstring conventions)
# ]

# [tool.ruff.lint.pydocstyle]
# convention = "google"  # or "numpy", "pep257"

# [tool.ruff.lint.per-file-ignores]
# "tests/*" = ["D"]
# "scripts/*" = ["D"]

[tool.mypy]
files = ["src"]
exclude = "src/cligram/utils/device.py"
ignore_missing_imports = true
check_untyped_defs = true

[tool.pydocstyle]
convention = "google"  # or "numpy", "pep257"
# add-ignore = ["D100", "D104"]  # Ignore missing docstrings in __init__.py
match = "(?!test_).*\\.py"  # Don't check test files
match-dir = "^(?!tests).*"  # Don't check tests directory

[tool.interrogate]
ignore-init-method = true
ignore-init-module = false
ignore-magic = false
ignore-semiprivate = false
ignore-private = false
ignore-property-decorators = false
ignore-module = false
ignore-nested-functions = false
ignore-nested-classes = false
ignore-setters = false
fail-under = 80  # Fail if coverage is below 80%
exclude = ["setup.py", "docs", "build", "tests"]
ignore-regex = ["^get$", "^mock_.*", ".*BaseClass.*"]
verbose = 0
quiet = false
whitelist-regex = []
color = true
