# JsonReader

–£–º–Ω—ã–π —á–∏—Ç–∞—Ç–µ–ª—å –∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä JSON-—Ñ–∞–π–ª–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ —á—Ç–µ–Ω–∏—è –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –º–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JSON-—Ñ–∞–π–ª–∞–º–∏ –ª—é–±–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **üîç –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ JSON –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π
- **üìä –ú–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** ‚Äî —Ä–∞–∑–º–µ—Ä, —Ö–µ—à, –¥–∞—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è/–∏–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫
- **‚ö° –î–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã** ‚Äî –æ–±—ã—á–Ω—ã–π (–¥–æ ~50 –ú–ë) –∏ –ø–æ—Ç–æ–∫–æ–≤—ã–π (–¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤)
- **üîÑ –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** ‚Äî –¥–∞–Ω–Ω—ã–µ —á–∏—Ç–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏
- **üìù –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã –∑–∞–ø–∏—Å–∏** ‚Äî —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Pydantic, Path –∏ —Å–ª–æ–∂–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä
- **üîí –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å** ‚Äî –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —á–∞—Å—Ç–∏—á–Ω–æ–π –∑–∞–ø–∏—Å–∏ –ø—Ä–∏ —Å–±–æ—è—Ö

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from json_reader import JsonReader

# –°–æ–∑–¥–∞–Ω–∏–µ —á–∏—Ç–∞—Ç–µ–ª—è
reader = JsonReader("data.json")

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏
if reader.is_valid:
    print(f"–§–∞–π–ª –≤–∞–ª–∏–¥–µ–Ω, —Ä–∞–∑–º–µ—Ä: {reader.size_mb} –ú–ë")
    
    # –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    data = reader.data
    print(f"–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö: {reader.data_type}")
    print(f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤: {reader.length}")
else:
    print(f"–û—à–∏–±–∫–∞: {reader.validation_error}")

# –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ
print(reader.info())
```

### –ü–æ—Ç–æ–∫–æ–≤—ã–π —Ä–µ–∂–∏–º –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

```python
# –î–ª—è —Ñ–∞–π–ª–æ–≤ –±–æ–ª—å—à–µ 50 –ú–ë
reader = JsonReader("large_data.json", use_stream=True)

if reader.is_valid:
    # –ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –ø–∞–º—è—Ç—å
    for item in reader.iter_items():
        process_item(item)
```

### –ó–∞–ø–∏—Å—å JSON-—Ñ–∞–π–ª–æ–≤

```python
data = {"users": [{"id": 1, "name": "Alice"}, {"id": 2, "name": "Bob"}]}

# –ö—Ä–∞—Å–∏–≤–∞—è –∑–∞–ø–∏—Å—å —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
JsonReader.write_pretty(data, "output.json")

# –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å
JsonReader.write_compact(data, "compact_output.json")

# –ö–∞—Å—Ç–æ–º–Ω–∞—è –∑–∞–ø–∏—Å—å
JsonReader.write(data, "custom.json", indent=4, ensure_ascii=True)
```

## API Reference

### –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä

#### `JsonReader(file_path: Union[str, Path], use_stream: bool = False)`

–°–æ–∑–¥–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä —á–∏—Ç–∞—Ç–µ–ª—è JSON-—Ñ–∞–π–ª–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `file_path` ‚Äî –ø—É—Ç—å –∫ JSON-—Ñ–∞–π–ª—É
- `use_stream` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫–æ–≤—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é (–¥–ª—è —Ñ–∞–π–ª–æ–≤ >50 –ú–ë)

**–ò—Å–∫–ª—é—á–µ–Ω–∏—è:**
- `ValueError` ‚Äî –µ—Å–ª–∏ `use_stream=True`, –Ω–æ `ijson` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- `FileNotFoundError` ‚Äî –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

### –°–≤–æ–π—Å—Ç–≤–∞ —Ñ–∞–π–ª–∞

#### `path: Path`
–ü–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É.

#### `name: str`
–ò–º—è —Ñ–∞–π–ª–∞ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º.

#### `stem: str`
–ò–º—è —Ñ–∞–π–ª–∞ –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.

#### `size_bytes: int`
–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –≤ –±–∞–π—Ç–∞—Ö.

#### `size_mb: float`
–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –≤ –º–µ–≥–∞–±–∞–π—Ç–∞—Ö.

#### `created_at: Optional[datetime]`
–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–∞.

#### `modified_at: Optional[datetime]`
–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è.

#### `sha256: str`
SHA-256 —Ö–µ—à —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞.

### –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –¥–∞–Ω–Ω—ã–µ

#### `is_valid: bool`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å JSON-—Ñ–∞–π–ª–∞.

#### `validation_error: Optional[str]`
–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏.

#### `data: Any`
–õ–µ–Ω–∏–≤–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ JSON.

**–ò—Å–∫–ª—é—á–µ–Ω–∏—è:**
- `ValueError` ‚Äî –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON
- `OSError` ‚Äî –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞

#### `data_type: Optional[str]`
–¢–∏–ø –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ ('dict', 'list', 'str' –∏ —Ç.–¥.).

#### `length: Optional[int]`
–î–ª–∏–Ω–∞ –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ (–¥–ª—è list/dict/str).

### –ú–µ—Ç–æ–¥—ã

#### `validate_structure(required_keys: Optional[List[str]] = None) -> bool`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–ª—é—á–µ–π –≤ JSON-–æ–±—ä–µ–∫—Ç–µ.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `required_keys` ‚Äî —Å–ø–∏—Å–æ–∫ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–ª—é—á–µ–π

**–ò—Å–∫–ª—é—á–µ–Ω–∏—è:**
- `ValueError` ‚Äî –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ–≤–∞–ª–∏–¥–µ–Ω –∏–ª–∏ –∫–æ—Ä–µ–Ω—å –Ω–µ –æ–±—ä–µ–∫—Ç

```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
if reader.validate_structure(["users", "metadata"]):
    print("–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º")
```

#### `iter_items(prefix: str = '') -> Generator[Any, None, None]`
–ü–æ—Ç–æ–∫–æ–≤–æ–µ —á—Ç–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (—Ç—Ä–µ–±—É–µ—Ç `use_stream=True`).

```python
# –î–ª—è –º–∞—Å—Å–∏–≤–æ–≤
for item in reader.iter_items():
    print(item)

# –î–ª—è –æ–±—ä–µ–∫—Ç–æ–≤
for key, value in reader.iter_items():
    print(f"{key}: {value}")
```

#### `info() -> Dict[str, Any]`
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—É—é –º–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ.

```python
info = reader.info()
print(f"""
Path: {info['path']}
Valid: {info['valid']}
Type: {info['type']}
Size: {info['size_mb']} MB
SHA256: {info['sha256']}
""")
```

### –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã –∑–∞–ø–∏—Å–∏

#### `JsonReader.write(data, file_path, indent=2, ensure_ascii=False, create_parents=True, atomic=True)`
–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –∑–∞–ø–∏—Å–∏ JSON —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å–ª–æ–∂–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä.

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:**
- Pydantic –º–æ–¥–µ–ª–∏ (v1/v2)
- –û–±—ä–µ–∫—Ç—ã Path
- –°–ª–æ–≤–∞—Ä–∏ —Å int-–∫–ª—é—á–∞–º–∏
- –ú–Ω–æ–∂–µ—Å—Ç–≤–∞ (set)

#### `JsonReader.write_pretty(data, file_path)`
–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏.

#### `JsonReader.write_compact(data, file_path)`
–ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å –±–µ–∑ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ñ–∞–π–ª–∞

```python
reader1 = JsonReader("config.json")
original_hash = reader1.sha256

# –ü–æ—Å–ª–µ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π...
reader2 = JsonReader("config.json")
if reader2.sha256 != original_hash:
    print("–§–∞–π–ª –±—ã–ª –∏–∑–º–µ–Ω–µ–Ω!")
```

### –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ JSON-—Ñ–∞–π–ª–æ–≤

```python
from pathlib import Path

json_files = Path("data/").glob("*.json")

for file_path in json_files:
    reader = JsonReader(file_path)
    if reader.is_valid and reader.data_type == "list":
        print(f"{file_path.name}: {reader.length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤")
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

```python
def validate_config(file_path: str) -> bool:
    reader = JsonReader(file_path)
    
    if not reader.is_valid:
        print(f"Invalid JSON: {reader.validation_error}")
        return False
    
    try:
        return reader.validate_structure(["version", "settings", "users"])
    except ValueError as e:
        print(f"Structure error: {e}")
        return False
```

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã

### –†–µ–∂–∏–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏

- **–û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º** (`use_stream=False`) ‚Äî –ø–æ–ª–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤ –ø–∞–º—è—Ç—å, –±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
- **–ü–æ—Ç–æ–∫–æ–≤—ã–π —Ä–µ–∂–∏–º** (`use_stream=True`) ‚Äî –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ | –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–µ–∂–∏–º | –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è |
|--------------|---------------------|------------|
| –î–æ 50 –ú–ë | –û–±—ã—á–Ω—ã–π | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ |
| 50+ –ú–ë | –ü–æ—Ç–æ–∫–æ–≤—ã–π | `pip install ijson` |

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–í—Å–µ –º–µ—Ç–æ–¥—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç:
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã
- –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON
- –ü—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π
- –û—à–∏–±–∫–∏ –¥–æ—Å—Ç—É–ø–∞
