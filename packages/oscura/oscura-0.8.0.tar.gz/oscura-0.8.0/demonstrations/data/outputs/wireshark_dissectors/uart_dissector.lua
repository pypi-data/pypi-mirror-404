-- UART Protocol Dissector
-- Auto-generated by Oscura

-- Declare protocol
local uart_proto = Proto("uart", "UART Protocol")

-- Protocol fields
local pf_timestamp = ProtoField.double("uart.timestamp", "Timestamp", base.DEC)
local pf_data = ProtoField.bytes("uart.data", "Data")
local pf_length = ProtoField.uint16("uart.length", "Length", base.DEC)

-- Protocol annotations
local pf_baud_rate = ProtoField.string("uart.baud_rate", "Baud Rate")
local pf_bits = ProtoField.string("uart.bits", "Bits")
local pf_parity = ProtoField.string("uart.parity", "Parity")

-- Register fields
uart_proto.fields = {
    pf_timestamp,
    pf_data,
    pf_length,
    pf_baud_rate,
    pf_bits,
    pf_parity,
}

-- Dissector function
function {protocol_name.lower()}_proto.dissector(buffer, pinfo, tree)
    pinfo.cols.protocol = "UART"

    local subtree = tree:add({protocol_name.lower()}_proto, buffer())

    -- Add fields to tree
    local length = buffer:len()
    subtree:add(pf_length, length)

    if length > 0 then
        subtree:add(pf_data, buffer())
    end

    return length
end

-- Register dissector
local udp_table = DissectorTable.get("udp.port")
udp_table:add(12345, {protocol_name.lower()}_proto)

print("UART dissector loaded")
