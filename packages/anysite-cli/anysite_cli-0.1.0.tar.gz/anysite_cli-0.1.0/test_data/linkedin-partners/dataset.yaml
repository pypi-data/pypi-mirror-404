name: linkedin-partners
description: "Multi-level LinkedIn dataset: companies → employees → profiles → posts → comments"

sources:
  # Level 1: Company details from aliases file
  - id: companies
    endpoint: /api/linkedin/company
    from_file: company_aliases.txt
    input_key: company
    parallel: 3
    on_error: skip

  # Level 2: Up to 5 employees per company
  # Extract urn.value from company records, build URN string for API
  - id: employees
    endpoint: /api/linkedin/company/employees
    dependency:
      from_source: companies
      field: urn.value
    input_key: companies
    input_template:
      companies:
        - type: company
          value: "{value}"
      count: 5
    parallel: 3
    on_error: skip

  # Level 3: Full profile for each employee
  # Extract user URL, pass last segment as user identifier
  - id: profiles
    endpoint: /api/linkedin/user
    dependency:
      from_source: employees
      field: url
      dedupe: true
    input_key: user
    params:
      with_experience: true
      with_education: true
    parallel: 3
    on_error: skip

  # Level 4: Up to 5 posts per employee (needs user URN string)
  - id: posts
    endpoint: /api/linkedin/user/posts
    dependency:
      from_source: profiles
      field: urn.value
      dedupe: true
    input_key: urn
    input_template:
      urn: "urn:li:fsd_profile:{value}"
      count: 5
    parallel: 3
    on_error: skip

  # Level 5: Up to 10 comments per post
  - id: comments
    endpoint: /api/linkedin/post/comments
    dependency:
      from_source: posts
      field: urn.value
      dedupe: true
    input_key: urn
    input_template:
      urn: "urn:li:activity:{value}"
      count: 10
    parallel: 3
    on_error: skip

storage:
  format: parquet
  path: ./data/linkedin-partners/
  partition_by:
    - source_id
    - collected_date
