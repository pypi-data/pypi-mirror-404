# GitHub Actions å·¥ä½œåŸç†è¯¦è§£

## ğŸ” test.yml å·¥ä½œåŸç†

### 1. è§¦å‘æœºåˆ¶

```yaml
on:
  push:
    branches: [main]  # æ¨é€åˆ° main åˆ†æ”¯æ—¶è§¦å‘
  pull_request:
    branches: [main]  # PR åˆ° main åˆ†æ”¯æ—¶è§¦å‘
```

**å·¥ä½œæµç¨‹**:
1. ä½ æ‰§è¡Œ `git push origin main`
2. GitHub æ£€æµ‹åˆ° push äº‹ä»¶
3. GitHub æ£€æŸ¥ä»“åº“ä¸­çš„ `.github/workflows/*.yml` æ–‡ä»¶
4. æ‰¾åˆ°åŒ¹é…çš„å·¥ä½œæµï¼ˆ`on.push.branches: [main]`ï¼‰
5. è‡ªåŠ¨å¯åŠ¨å·¥ä½œæµæ‰§è¡Œ

### 2. è¿è¡Œç¯å¢ƒ

```yaml
runs-on: ubuntu-latest
```

**GitHub æä¾›çš„å…è´¹è™šæ‹Ÿæœº**:
- **æ“ä½œç³»ç»Ÿ**: Ubuntu æœ€æ–°ç‰ˆï¼ˆç›®å‰æ˜¯ Ubuntu 22.04ï¼‰
- **è™šæ‹Ÿç¯å¢ƒ**: å…¨æ–°çš„ VMï¼Œæ¯æ¬¡è¿è¡Œéƒ½æ˜¯å¹²å‡€çš„
- **é…ç½®**: 2-core CPU, 7GB RAM, 14GB SSD
- **æ—¶é•¿é™åˆ¶**: å•ä¸ª job æœ€å¤š 6 å°æ—¶
- **ä½ç½®**: GitHub çš„äº‘ç«¯æœåŠ¡å™¨ï¼ˆAzureï¼‰

### 3. æµ‹è¯•çŸ©é˜µ

```yaml
strategy:
  matrix:
    python-version: ['3.9', '3.10', '3.11', '3.12', '3.13']
  fail-fast: false
```

**å¹¶è¡Œæ‰§è¡Œ**:
- GitHub ä¼šåˆ›å»º **5 ä¸ªç‹¬ç«‹çš„è™šæ‹Ÿæœº**
- æ¯ä¸ª VM è¿è¡Œä¸€ä¸ª Python ç‰ˆæœ¬
- **å¹¶è¡Œè¿è¡Œ**ï¼Œä¸æ˜¯ä¸²è¡Œ
- `fail-fast: false` è¡¨ç¤ºä¸€ä¸ªå¤±è´¥ä¸å½±å“å…¶ä»–çš„ç»§ç»­

**ç¤ºæ„å›¾**:
```
GitHub æ£€æµ‹åˆ° push
    â†“
å¯åŠ¨ 5 ä¸ªå¹¶è¡Œä»»åŠ¡
    â”œâ”€ VM1: Python 3.9  â”€â”
    â”œâ”€ VM2: Python 3.10 â”€â”¤
    â”œâ”€ VM3: Python 3.11 â”€â”¼â”€ åŒæ—¶è¿è¡Œ
    â”œâ”€ VM4: Python 3.12 â”€â”¤
    â””â”€ VM5: Python 3.13 â”€â”˜
         â†“
    æ‰€æœ‰ä»»åŠ¡å®Œæˆ
         â†“
    æ˜¾ç¤ºç»“æœï¼ˆâœ… æˆ– âŒï¼‰
```

### 4. æ‰§è¡Œæ­¥éª¤è¯¦è§£

#### Step 1: æ£€å‡ºä»£ç 
```yaml
- name: æ£€å‡ºä»£ç 
  uses: actions/checkout@v4
```
- **ä½œç”¨**: å°†ä½ çš„ä»“åº“ä»£ç å…‹éš†åˆ°è™šæ‹Ÿæœº
- **åŸç†**: ç±»ä¼¼ `git clone`
- **ç‰ˆæœ¬**: `@v4` æ˜¯ action çš„ç‰ˆæœ¬

#### Step 2: è®¾ç½® Python
```yaml
- name: è®¾ç½® Python ${{ matrix.python-version }} ç¯å¢ƒ
  uses: actions/setup-python@v5
  with:
    python-version: ${{ matrix.python-version }}
    cache: 'pip'
```
- **ä½œç”¨**: å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„ Python
- **cache: 'pip'**: è‡ªåŠ¨ç¼“å­˜ pip ä¸‹è½½çš„åŒ…ï¼Œä¸‹æ¬¡è¿è¡Œæ›´å¿«
- **`${{ matrix.python-version }}`**: å˜é‡æ›¿æ¢ï¼Œæ ¹æ®çŸ©é˜µå€¼åŠ¨æ€è®¾ç½®

#### Step 3-4: æ˜¾ç¤ºç‰ˆæœ¬å’Œå‡çº§ pip
```yaml
- name: æ˜¾ç¤º Python ç‰ˆæœ¬
  run: |
    python --version
    pip --version

- name: å‡çº§ pip
  run: |
    python -m pip install --upgrade pip
```
- **`run:`**: æ‰§è¡Œ shell å‘½ä»¤
- **`|`**: YAML å¤šè¡Œå­—ç¬¦ä¸²

#### Step 5: å®‰è£…ä¾èµ–
```yaml
- name: å®‰è£…é¡¹ç›®å’Œå¼€å‘ä¾èµ–
  run: |
    pip install -e '.[dev]'
```
- **åŸç†**: 
  1. è¯»å– `pyproject.toml`
  2. å®‰è£…é¡¹ç›®æœ¬èº«ï¼ˆ`-e` å¼€å‘æ¨¡å¼ï¼‰
  3. å®‰è£… `[project.optional-dependencies]` ä¸‹çš„ `dev` ä¾èµ–
  4. åŒ…æ‹¬ `pytest` å’Œ `pytest-cov`

#### Step 6: è¿è¡Œæµ‹è¯•
```yaml
- name: è¿è¡Œå•å…ƒæµ‹è¯•
  run: |
    pytest tests/ -v --cov=src/debug_helpers --cov-report=term-missing --cov-report=xml
```
- **pytest tests/**: è¿è¡Œæµ‹è¯•
- **--cov=src/debug_helpers**: ç”Ÿæˆè¦†ç›–ç‡
- **--cov-report=xml**: ç”Ÿæˆ XML æ ¼å¼æŠ¥å‘Šï¼ˆç»™ Codecov ç”¨ï¼‰

#### Step 7: ä¸Šä¼ è¦†ç›–ç‡ï¼ˆå¯é€‰ï¼‰
```yaml
- name: ä¸Šä¼ è¦†ç›–ç‡æŠ¥å‘Šåˆ° Codecov
  if: success() && matrix.python-version == '3.11'
  uses: codecov/codecov-action@v4
```
- **`if:`**: æ¡ä»¶æ‰§è¡Œ
- **`success()`**: å‰é¢æ­¥éª¤éƒ½æˆåŠŸ
- **åªåœ¨ Python 3.11 ä¸Šä¼ **: é¿å…é‡å¤ä¸Šä¼ 

---

## âš™ï¸ éœ€è¦åœ¨ GitHub ä¸Šè®¾ç½®ä»€ä¹ˆï¼Ÿ

### å¿…éœ€è®¾ç½®ï¼ˆé›¶é…ç½®ï¼‰

âœ… **æ— éœ€ä»»ä½•è®¾ç½®ï¼**

åªéœ€è¦ï¼š
1. å°† `.github/workflows/test.yml` æ¨é€åˆ°ä»“åº“
2. GitHub ä¼šè‡ªåŠ¨è¯†åˆ«å¹¶å¯ç”¨

### å¯é€‰è®¾ç½®

#### 1. æŸ¥çœ‹å·¥ä½œæµçŠ¶æ€

åœ¨ä»“åº“é¡µé¢ï¼š
- ç‚¹å‡» **"Actions"** æ ‡ç­¾
- å¯ä»¥çœ‹åˆ°æ‰€æœ‰å·¥ä½œæµçš„è¿è¡Œå†å²
- ç‚¹å‡»æŸæ¬¡è¿è¡Œå¯ä»¥æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

#### 2. é…ç½® Codecovï¼ˆå¯é€‰ï¼‰

å¦‚æœè¦ä½¿ç”¨è¦†ç›–ç‡æŠ¥å‘Šï¼š

1. è®¿é—® https://codecov.io/
2. ç”¨ GitHub è´¦å·ç™»å½•
3. æ·»åŠ ä½ çš„ä»“åº“
4. è·å– `CODECOV_TOKEN`
5. åœ¨ GitHub ä»“åº“æ·»åŠ  Secret:
   - Settings â†’ Secrets and variables â†’ Actions
   - New repository secret
   - Name: `CODECOV_TOKEN`
   - Value: ç²˜è´´ token

**å¦‚æœä¸è®¾ç½®**: è¦†ç›–ç‡æ­¥éª¤ä¼šè¢«è·³è¿‡ï¼Œæµ‹è¯•ä»ç„¶æ­£å¸¸è¿è¡Œ

#### 3. ä¿æŠ¤åˆ†æ”¯ï¼ˆæ¨èï¼‰

Settings â†’ Branches â†’ Add branch protection rule:
- Branch name pattern: `main`
- âœ… Require status checks to pass before merging
- âœ… Require branches to be up to date before merging
- é€‰æ‹©: `test` (Python Unit Tests)

**æ•ˆæœ**: PR å¿…é¡»é€šè¿‡æµ‹è¯•æ‰èƒ½åˆå¹¶

---

## ğŸ’° èµ„æºå’Œè´¹ç”¨

### å…è´¹é¢åº¦ï¼ˆPublic ä»“åº“ï¼‰

| é¡¹ç›® | é¢åº¦ |
|------|------|
| **è¿è¡Œæ—¶é•¿** | â™¾ï¸ **æ— é™åˆ¶** |
| **å¹¶å‘ä»»åŠ¡** | 20 ä¸ª |
| **å­˜å‚¨ç©ºé—´** | 500 MB |
| **æˆæœ¬** | å®Œå…¨å…è´¹ |

### å…è´¹é¢åº¦ï¼ˆPrivate ä»“åº“ï¼‰

| é¡¹ç›® | å…è´¹é¢åº¦ | è¶…å‡ºåä»·æ ¼ |
|------|----------|-----------|
| **è¿è¡Œæ—¶é•¿** | 2,000 åˆ†é’Ÿ/æœˆ | $0.008/åˆ†é’Ÿ |
| **å¹¶å‘ä»»åŠ¡** | 20 ä¸ª | - |
| **å­˜å‚¨ç©ºé—´** | 500 MB | $0.25/GB/æœˆ |

### æœ¬é¡¹ç›®çš„èµ„æºæ¶ˆè€—

ä»¥ **test.yml** ä¸ºä¾‹ï¼š

```
å•æ¬¡è¿è¡Œ:
  - 5 ä¸ª Python ç‰ˆæœ¬å¹¶è¡Œ
  - æ¯ä¸ªç‰ˆæœ¬çº¦ 2-3 åˆ†é’Ÿ
  - å¹¶è¡Œè¿è¡Œï¼Œå®é™…è€—æ—¶: ~3 åˆ†é’Ÿ
  - è®¡è´¹æ—¶é•¿: 5 Ã— 3 = 15 åˆ†é’Ÿ

æ¯æœˆæ¨é€ 20 æ¬¡:
  - æ€»è€—æ—¶: 20 Ã— 15 = 300 åˆ†é’Ÿ
  - Public ä»“åº“: å…è´¹
  - Private ä»“åº“: 300/2000ï¼Œä»åœ¨å…è´¹é¢åº¦å†…
```

### GitHub Actions è¿è¡Œå™¨

**GitHub æ‰˜ç®¡çš„è¿è¡Œå™¨ï¼ˆRunnersï¼‰**:

| ç±»å‹ | é…ç½® | ä½ç½® |
|------|------|------|
| `ubuntu-latest` | 2-core, 7GB RAM | Azure äº‘ç«¯ |
| `ubuntu-22.04` | 2-core, 7GB RAM | Azure äº‘ç«¯ |
| `windows-latest` | 2-core, 7GB RAM | Azure äº‘ç«¯ |
| `macos-latest` | 3-core, 14GB RAM | Azure äº‘ç«¯ |

**è‡ªæ‰˜ç®¡è¿è¡Œå™¨**ï¼ˆå¯é€‰ï¼‰:
- ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå·±çš„æœåŠ¡å™¨
- ä½†å¯¹äºç®€å•é¡¹ç›®ï¼ŒGitHub æ‰˜ç®¡çš„å®Œå…¨å¤Ÿç”¨

---

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹å›¾

```
å¼€å‘è€…æ“ä½œ
    |
    | git push origin main
    â†“
GitHub æœåŠ¡å™¨æ£€æµ‹åˆ° push äº‹ä»¶
    |
    | è¯»å– .github/workflows/test.yml
    â†“
GitHub Actions è°ƒåº¦å™¨
    |
    | åˆ†é… 5 ä¸ªè™šæ‹Ÿæœºï¼ˆå¹¶è¡Œï¼‰
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VM1 (Python 3.9)                       â”‚
â”‚  â”œâ”€ æ£€å‡ºä»£ç                              â”‚
â”‚  â”œâ”€ å®‰è£… Python 3.9                     â”‚
â”‚  â”œâ”€ å®‰è£…ä¾èµ–                             â”‚
â”‚  â”œâ”€ è¿è¡Œæµ‹è¯•                             â”‚
â”‚  â””â”€ âœ… æˆåŠŸ / âŒ å¤±è´¥                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VM2 (Python 3.10)                      â”‚
â”‚  ... åŒæ ·çš„æ­¥éª¤ ...                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VM3 (Python 3.11)                      â”‚
â”‚  ... åŒæ ·çš„æ­¥éª¤ ...                      â”‚
â”‚  â””â”€ é¢å¤–ï¼šä¸Šä¼ è¦†ç›–ç‡åˆ° Codecov           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VM4 (Python 3.12)                      â”‚
â”‚  ... åŒæ ·çš„æ­¥éª¤ ...                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VM5 (Python 3.13)                      â”‚
â”‚  ... åŒæ ·çš„æ­¥éª¤ ...                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    |
    | æ‰€æœ‰ä»»åŠ¡å®Œæˆ
    â†“
GitHub æ±‡æ€»ç»“æœ
    |
    â”œâ”€ å‘é€é‚®ä»¶é€šçŸ¥ï¼ˆå¦‚æœå¤±è´¥ï¼‰
    â”œâ”€ åœ¨ PR ä¸­æ˜¾ç¤ºçŠ¶æ€
    â””â”€ Actions é¡µé¢æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—
```

---

## ğŸ“Š å®é™…è¿è¡Œç¤ºä¾‹

### æˆåŠŸçš„è¿è¡Œ

```
âœ… Python Unit Tests #42
   Triggered by: push to main
   Duration: 3m 24s
   
   Jobs:
   âœ… test (3.9)   - 2m 45s
   âœ… test (3.10)  - 2m 52s
   âœ… test (3.11)  - 3m 08s
   âœ… test (3.12)  - 2m 58s
   âœ… test (3.13)  - 3m 02s
```

### å¤±è´¥çš„è¿è¡Œ

```
âŒ Python Unit Tests #43
   Triggered by: push to main
   Duration: 2m 15s
   
   Jobs:
   âœ… test (3.9)   - 2m 10s
   âŒ test (3.10)  - 1m 45s  â† å¤±è´¥
   âœ… test (3.11)  - 2m 05s
   âœ… test (3.12)  - 1m 58s
   âœ… test (3.13)  - 2m 00s
   
   Error in test (3.10):
   > FAILED tests/test_example.py::test_add - AssertionError
```

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **å®Œå…¨è‡ªåŠ¨åŒ–**: æ¨é€ä»£ç å³å¯ï¼Œæ— éœ€æ‰‹åŠ¨è§¦å‘
2. **é›¶é…ç½®**: åªéœ€æ·»åŠ  YAML æ–‡ä»¶ï¼ŒGitHub è‡ªåŠ¨è¯†åˆ«
3. **å…è´¹ä½¿ç”¨**: Public ä»“åº“å®Œå…¨å…è´¹
4. **ç‹¬ç«‹ç¯å¢ƒ**: æ¯æ¬¡è¿è¡Œéƒ½æ˜¯å…¨æ–°çš„ VM
5. **å¹¶è¡Œæ‰§è¡Œ**: å¤šä¸ª Python ç‰ˆæœ¬åŒæ—¶æµ‹è¯•
6. **äº‘ç«¯èµ„æº**: ä½¿ç”¨ GitHub/Azure çš„æœåŠ¡å™¨

### ä½ éœ€è¦åšçš„

âœ… **å¿…éœ€**:
1. åˆ›å»º `.github/workflows/test.yml` æ–‡ä»¶
2. æ¨é€åˆ° GitHub

âŒ **ä¸éœ€è¦**:
1. âŒ ä¸éœ€è¦è‡ªå·±çš„æœåŠ¡å™¨
2. âŒ ä¸éœ€è¦é¢å¤–çš„é…ç½®
3. âŒ ä¸éœ€è¦æ”¯ä»˜è´¹ç”¨ï¼ˆPublic ä»“åº“ï¼‰
4. âŒ ä¸éœ€è¦å®‰è£…ä»»ä½•è½¯ä»¶

å°±è¿™ä¹ˆç®€å•ï¼ğŸ‰

---

## ğŸ“š å»¶ä¼¸é˜…è¯»

- [GitHub Actions å®˜æ–¹æ–‡æ¡£](https://docs.github.com/en/actions)
- [å·¥ä½œæµè¯­æ³•](https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions)
- [GitHub Actions è®¡è´¹](https://docs.github.com/en/billing/managing-billing-for-github-actions/about-billing-for-github-actions)
