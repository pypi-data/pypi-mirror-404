test_case_id: "proxy_remote_crash_no_response_001"
description: "Tests that proxy detects when remote agent crashes without sending final task response"
tags: ["all", "proxy"]
skip_intermediate_events: false

gateway_input:
  target_agent_name: "TestAgent_Proxied"
  user_identity: "proxy_tester@example.com"
  parts:
    - type: "text"
      text: "This will cause remote agent to crash"
  external_context:
    a2a_session_id: "session_proxy_crash_001"

# Downstream agent sends working status but then crashes (no final task)
downstream_a2a_agent_responses:
  - id: "task-from-downstream"
    contextId: "session_proxy_crash_001"
    kind: "task"
    status:
      state: "working"
      message:
        role: "agent"
        messageId: "msg-1"
        kind: "message"
        parts:
          - kind: "text"
            text: "Processing your request..."
  # Stream ends here - no final task sent (simulates crash)

# Gateway should receive an error response
expected_gateway_output:
  - type: "error"
    error_code: -32603
    error_message_contains: "disconnected without completing the task"
