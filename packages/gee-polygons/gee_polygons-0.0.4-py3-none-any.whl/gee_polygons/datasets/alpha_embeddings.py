"""Alpha Earth Embeddings: 64-dimensional semantic representations of satellite imagery."""

# AUTOGENERATED! DO NOT EDIT! File to edit: ../../nbs/13_datasets_alpha_embeddings.ipynb.

# %% auto #0
__all__ = ['EMBEDDING_BANDS', 'ALPHA_EMBEDDINGS', 'EMBEDDING_VIS_DEFAULT', 'EMBEDDING_VIS_ALT1', 'EMBEDDING_VIS_ALT2',
           'get_embedding_image']

# %% ../../nbs/13_datasets_alpha_embeddings.ipynb #cell-3
import ee
from typing import Literal, Optional
from ..layers import ContinuousLayer

# %% ../../nbs/13_datasets_alpha_embeddings.ipynb #cell-5
# All 64 embedding bands
EMBEDDING_BANDS = [f'A{i:02d}' for i in range(64)]  # A00, A01, ..., A63

# The ContinuousLayer for extraction
ALPHA_EMBEDDINGS = ContinuousLayer(
    collection_id='GOOGLE/SATELLITE_EMBEDDING/V1/ANNUAL',
    bands=EMBEDDING_BANDS,
    scale=10
)

# %% ../../nbs/13_datasets_alpha_embeddings.ipynb #cell-6
# Visualization presets (select 3 bands for RGB)
# These combinations can reveal different spatial patterns
EMBEDDING_VIS_DEFAULT = {'min': -0.3, 'max': 0.3, 'bands': ['A01', 'A16', 'A09']}
EMBEDDING_VIS_ALT1 = {'min': -0.3, 'max': 0.3, 'bands': ['A00', 'A32', 'A63']}
EMBEDDING_VIS_ALT2 = {'min': -0.3, 'max': 0.3, 'bands': ['A05', 'A25', 'A45']}

# %% ../../nbs/13_datasets_alpha_embeddings.ipynb #cell-7
def get_embedding_image(
    geometry: ee.Geometry,
    year: int,
    bands: list[str] = None
) -> ee.Image:
    """Get Alpha Earth Embedding image for a specific year.
    
    The collection stores annual images, so this filters to the requested
    year and mosaics any tiles covering the geometry.
    
    Args:
        geometry: Region of interest
        year: Year to retrieve (2017 onwards)
        bands: Specific bands to select (default: all 64)
        
    Returns:
        ee.Image with embedding bands
        
    Example:
        img = get_embedding_image(site.geometry, 2023)
        img = get_embedding_image(site.geometry, 2023, bands=['A01', 'A16', 'A09'])
    """
    if bands is None:
        bands = EMBEDDING_BANDS
    
    start_date = ee.Date.fromYMD(year, 1, 1)
    end_date = start_date.advance(1, 'year')
    
    collection = (
        ee.ImageCollection('GOOGLE/SATELLITE_EMBEDDING/V1/ANNUAL')
        .filterDate(start_date, end_date)
        .filterBounds(geometry)
        .select(bands)
    )
    
    return collection.mosaic()
