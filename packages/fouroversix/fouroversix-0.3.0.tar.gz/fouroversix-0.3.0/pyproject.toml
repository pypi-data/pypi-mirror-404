[build-system]
requires = [
    "ninja~=1.13.0",
    "packaging~=25.0",
    "psutil~=7.1.3",
    "setuptools>=77.0.3",
    "wheel~=0.45.1",
]
build-backend = "setuptools.build_meta"

[project]
name = "fouroversix"
dynamic = ["version"]
authors = [
    { name="Jack Cook", email="cookj@mit.edu" },
    { name="Junxian Guo", email="junxian@mit.edu" },
]
description = "More Accurate FP4 Quantization with Adaptive Block Scaling"
readme = "README.md"
requires-python = ">=3.10"
license = "MIT"
license-files = ["LICENSE.md"]
dependencies = [
    "torch~=2.9.1",
]

[project.optional-dependencies]
docs = [
    "mkdocs~=1.6.1",
    "mkdocs-material~=9.7.1",
    "mkdocstrings[python]~=1.0.1",
]
tests = [
    "lm_eval[hf]~=0.4.10",
    "modal~=1.3.1",
    "pytest~=8.1.1",
    "ruff~=0.14.14",
    "SQLAlchemy~=2.0.46",
]

[tool.pytest.ini_options]
testpaths = ["tests"]

[tool.ruff]
line-length = 88
indent-width = 4
exclude = ["build", "dist", "env", ".venv", "third_party", "scripts/ptq/tasks"]

[tool.ruff.format]
quote-style = "double"
indent-style = "space"

[tool.ruff.lint]
ignore = [
    # Various dumb rules related to docstrings
    "D100",
    "D103",  # TODO: Remove this one
    "D104",
    "D107",
    "D202",
    "D203",
    "D205",
    "D212",

    "A001", "A002",  # Allow variables to be named `input`
    "FIX002",  # Allow TODO comments
    "FIX004",  # Allow hacks
    "N812",  # Allow importing torch.nn.functional as F
    "PLC0415",  # Allow imports that aren't at the top of the file
    "PLR0913",  # Allow functions with more than 5 arguments
    "RET506",  # Allow elif after raise
    "S603",  # Allow untrusted inputs to be passed to subprocesses
    "S607",  # Allow commands to be run by subprocess without providing a full path
    "TD003",  # Don't require issue links on TODO comments
]
select = [
    "ALL",
]

[tool.ruff.lint.extend-per-file-ignores]
"setup.py" = [
    "T201",  # Allow print statements in setup.py
]
"scripts/**/*.py" = [
    "T201",  # Allow print statements in CLI tools
    "TID252",  # Allow relative imports from parent modules
]
"src/fouroversix/ops.py" = [
    "I001",  # Allow unsorted imports, because torch needs to be imported before fouroversix._C
]
"src/fouroversix/quantize/triton_kernel.py" = [
    "ANN001",  # Allow missing annotations in Triton kernels
    "N803",  # Allow uppercase arguments to Triton kernels
    "N806",  # Allow uppercase variables in Triton kernels
]
"src/fouroversix/quantize/reference.py" = [
    "S101",  # Allow assert statements in reference implementation
]
"tests/**/test_*.py" = [
    "S101",  # Allow assert statements in tests
    "T201",  # Allow print statements in tests
]

[tool.ruff.lint.isort]
known-third-party = ["fouroversix"]
