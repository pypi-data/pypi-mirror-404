var w=EventTarget,L="https://embed.foxglove.dev/",v="foxglove.default-layout";function y(){let t,e;return{promise:new Promise((s,n)=>{t=s,e=n}),resolve:t,reject:e}}var d=class extends w{#e;#o;#l;#r=!1;#n;#t={dataSource:void 0,selectLayout:void 0,extension:[]};#a;#s=!1;constructor(e){super();let{parent:a,src:s,orgSlug:n,initialDataSource:i,initialLayout:o,initialLayoutParams:r,initialExtensions:u,colorScheme:h="auto",embeddedViewer:l}=e;this.#l=n,this.#n=y();let c=s??L;try{this.#o=new URL(c)}catch{throw new Error(`[FoxgloveViewer] Invalid server URL: ${c}`)}l!=null&&this.#o.searchParams.set("embeddedViewer",l),window.addEventListener("message",this.#d),i&&this.setDataSource(i),o!=null&&r==null&&this.setLayoutData(o),r!=null&&this.selectLayout(r),u&&this.installExtensions(u),this.#e=document.createElement("iframe"),this.#e.src=this.#o.href,this.#e.title="Foxglove",this.#e.allow="cross-origin-isolated",this.#e.style.width="100%",this.#e.style.height="100%",this.#e.style.border="none",this.setColorScheme(h),a.appendChild(this.#e)}setDataSource(e){this.#u({type:"set-data-source",payload:e})}selectLayout(e){this.#u({type:"select-layout",payload:e})}async getLayout(){return this.#a||(this.#a=y(),await this.#n.promise,this.#i({type:"get-layout"})),await this.#a.promise}setLayoutData(e){this.selectLayout({storageKey:v,opaqueLayout:e,force:!0})}installExtensions(e){this.#u({type:"install-extension",payload:e})}isReady(){return this.#r}destroy(){this.#s=!0,this.#e.remove(),window.removeEventListener("message",this.#d)}isDestroyed(){return this.#s}setColorScheme(e){this.#e.style.colorScheme=e==="auto"?"normal":e}#u(e){switch(e.type){case"install-extension":this.#t.extension.push(e);break;case"set-data-source":this.#t.dataSource=e;break;case"select-layout":this.#t.selectLayout=e;break}this.#r&&this.#i(e)}#i(e){if(this.#s){console.warn("[FoxgloveViewer] Unable to post command. Frame has been destroyed.");return}m(this.#e.contentWindow,"Invariant: iframe should be loaded."),this.#e.contentWindow.postMessage(e,this.#o.origin)}#d=e=>{let a=new URL(e.origin);if(!(e.source!==this.#e.contentWindow||a.origin!==this.#o.origin)){if(this.#s){console.warn("[FoxgloveViewer] Unable to handle message. Frame has been destroyed.");return}switch(e.data.type){case"foxglove-origin-request":this.#i({type:"origin-ack"});break;case"foxglove-handshake-request":this.#r=!0,this.#n.resolve(),this.#i({type:"handshake-ack",payload:{orgSlug:this.#l,initialDataSource:this.#t.dataSource?.payload,initialLayoutParams:this.#t.selectLayout?.payload,initialExtensions:this.#t.extension.flatMap(s=>s.payload)}});break;case"foxglove-handshake-complete":this.dispatchEvent(new Event("ready"));break;case"foxglove-error":this.dispatchEvent(new CustomEvent("error",{detail:e.data.payload}));break;case"foxglove-layout-data":this.#a?(this.#a.resolve(e.data.payload),this.#a=void 0):console.warn("[FoxgloveViewer] Received layout but getLayout was not called.");break;default:console.warn("[FoxgloveViewer] Unhandled message type:",e.data);break}}}};function m(t,e="no additional info provided"){if(!t)throw new Error("Assertion Error: "+e)}var f="foxglove-notebook-default-layout";function p(t){return{storageKey:f,force:!0,layout:t?JSON.parse(t):void 0}}function g(t){return{storageKey:f,force:!0,opaqueLayout:t}}function x({model:t,el:e}){let a=document.createElement("div"),s=t.get("_layout"),n=t.get("_opaque_layout"),i=new d({parent:a,embeddedViewer:"Python",src:t.get("src"),orgSlug:void 0,initialLayoutParams:n!=null?g(n):p(s)});i.addEventListener("ready",()=>{t.send({type:"ready"})}),t.on("msg:custom",(o,r)=>{if(o.type==="update-data"){let u=r.map((h,l)=>new File([h.buffer],`data-${l}.mcap`));i.setDataSource({type:"file",file:u})}}),a.style.width=t.get("width")==="full"?"100%":`${t.get("width")}px`,a.style.height=`${t.get("height")}px`,t.on("change:width",()=>{a.style.width=t.get("width")==="full"?"100%":`${t.get("width")}px`}),t.on("change:height",()=>{a.style.height=`${t.get("height")}px`}),t.on("change:_layout",()=>{let o=t.get("_layout"),r=p(o);i.selectLayout(r)}),t.on("change:_opaque_layout",()=>{let o=t.get("_opaque_layout");i.selectLayout(g(o))}),e.appendChild(a)}var k={render:x};export{k as default};
