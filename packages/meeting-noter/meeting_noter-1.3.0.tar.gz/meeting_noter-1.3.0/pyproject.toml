[build-system]
requires = ["setuptools>=61.0", "wheel"]
build-backend = "setuptools.build_meta"

[project]
name = "meeting-noter"
version = "1.3.0"
description = "Offline meeting transcription for macOS with automatic meeting detection"
readme = "README.md"
license = {text = "MIT"}
requires-python = ">=3.9"
authors = [
    {name = "Victor"}
]
keywords = ["meeting", "transcription", "whisper", "offline", "speech-to-text", "audio"]
classifiers = [
    "Development Status :: 3 - Alpha",
    "Environment :: Console",
    "Intended Audience :: End Users/Desktop",
    "License :: OSI Approved :: MIT License",
    "Operating System :: MacOS",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Programming Language :: Python :: 3.13",
    "Topic :: Multimedia :: Sound/Audio :: Speech",
]

dependencies = [
    "click>=8.0",
    "sounddevice>=0.4.6",
    "numpy>=1.24",
    "faster-whisper>=1.0.0",
    "imageio-ffmpeg>=0.4.9",  # Bundles ffmpeg binary for MP3 encoding
    "pyobjc-framework-Cocoa>=9.0; sys_platform == 'darwin'",
    "pyobjc-framework-Quartz>=9.0; sys_platform == 'darwin'",
    "pyobjc-framework-ScreenCaptureKit>=9.0; sys_platform == 'darwin'",
    "pyobjc-framework-AVFoundation>=9.0; sys_platform == 'darwin'",
    "pyobjc-framework-CoreMedia>=9.0; sys_platform == 'darwin'",
    "pyobjc-framework-libdispatch>=9.0; sys_platform == 'darwin'",
]

[project.optional-dependencies]
offline = [
    "meeting-noter-models>=0.1.0",
]
dev = [
    "pytest>=7.0",
    "pytest-cov",
    "pytest-mock",
    "black",
    "ruff",
    "mypy",
]

[project.scripts]
meeting-noter = "meeting_noter.cli:cli"
mn = "meeting_noter.cli:cli"

[project.urls]
Homepage = "https://github.com/tech4vision/meeting-noter"
Repository = "https://github.com/tech4vision/meeting-noter"
Issues = "https://github.com/tech4vision/meeting-noter/issues"

[tool.setuptools.packages.find]
where = ["src"]

[tool.setuptools.package-data]
meeting_noter = ["resources/*.png", "resources/*.icns"]

[tool.black]
line-length = 100
target-version = ["py39", "py310", "py311", "py312"]

[tool.ruff]
line-length = 100
select = ["E", "F", "I", "N", "W"]

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py"]
python_functions = ["test_*"]
addopts = [
    "--cov=meeting_noter",
    "--cov-report=term-missing",
    "--cov-report=html",
    "-v",
]
filterwarnings = [
    "ignore::DeprecationWarning",
]

[tool.coverage.run]
source = ["src/meeting_noter"]
branch = true
omit = [
    "*/__main__.py",
    "*/audio/system_audio.py",  # ScreenCaptureKit-based, requires macOS runtime
]

[tool.coverage.report]
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "raise NotImplementedError",
    "if TYPE_CHECKING:",
    "if __name__ == .__main__.:",
    # Exclude macOS-specific framework code that can't be unit tested
    "import ScreenCaptureKit",
    "import CoreMedia",
    "import AppKit",
    "from AppKit import",
    "from EventKit import",
    "from Foundation import NSObject",
    "from libdispatch import",
    "from dispatch import",
    "class StreamOutput",
    "def stream_didOutputSampleBuffer_ofType_",
    "def stream_didStopWithError_",
    "except ImportError:",
    # Exclude daemon fork code (requires OS process fork)
    "def daemonize",
    "os.fork()",
    "os.setsid()",
    "os.chdir",
    "os.dup2",
    "sys.exit(0)",
    "sys.exit(1)",
]
