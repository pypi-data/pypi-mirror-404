# Copyright (c) IBM Corporation
# SPDX-License-Identifier: MIT

import typing
from typing import Annotated

import pydantic

import orchestrator.modules
from orchestrator.core.operation.resource import (
    OperationExitStateEnum,
    OperationResource,
    OperationResourceEventEnum,
    OperationResourceStatus,
)


class OperationException(Exception):

    def __init__(
        self,
        message: str,
        operation: OperationResource,
        *args: typing.Any,  # noqa: ANN401
    ) -> None:
        self.operation = operation
        super().__init__(message, operation, *args)


class OperationOutput(pydantic.BaseModel):
    metadata: Annotated[
        dict,
        pydantic.Field(
            default_factory=dict,
            description="Metadata about the operation. "
            "Should be added to the metadata of the OperationResource",
        ),
    ]
    resources: Annotated[
        list[orchestrator.core.resources.ADOResource],
        pydantic.Field(
            default_factory=list,
            description="Array of ADO resources generated by the operation",
        ),
    ]
    other: Annotated[
        list[typing.Any],
        pydantic.Field(default_factory=list, description="Any non-resource objects"),
    ]
    operation: Annotated[
        OperationResource,
        pydantic.Field(
            description="Optional:The operation resource that created this output"
        ),
    ] = None
    exitStatus: Annotated[
        OperationResourceStatus,
        pydantic.Field(
            description="Exit status of the operation. Default to success if not applied"
        ),
    ] = OperationResourceStatus(
        message="This is a default status",
        exit_state=OperationExitStateEnum.SUCCESS,
        event=OperationResourceEventEnum.FINISHED,
    )
