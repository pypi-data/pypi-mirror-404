Metadata-Version: 2.4
Name: servai-model
Version: 0.1.0
Summary: Whisper ë° ECAPA-TDNN ê¸°ë°˜ì˜ ì‹¤ì°¨ í™”ì ì‹ë³„ ë° ë…¸ì´ì¦ˆ ë³´ì • ë¼ì´ë¸ŒëŸ¬ë¦¬
Author-email: ServAI-Hub <contact@servai-hub.io>
License: MIT
Project-URL: Homepage, https://github.com/ServAI-Hub/servai-model
Project-URL: Bug Tracker, https://github.com/ServAI-Hub/servai-model/issues
Keywords: speaker-verification,speaker-diarization,stt,whisper,ecapa-tdnn,noise-compensation
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.11
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Topic :: Scientific/Engineering :: Artificial Intelligence
Classifier: Topic :: Multimedia :: Sound/Audio :: Analysis
Requires-Python: <3.12,>=3.11
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: fastapi>=0.100.0
Requires-Dist: librosa>=0.11.0
Requires-Dist: ngrok>=1.4.0
Requires-Dist: noisereduce>=3.0.3
Requires-Dist: numpy<2,>=1.26
Requires-Dist: psutil>=7.1.3
Requires-Dist: pyngrok>=7.4.1
Requires-Dist: python-multipart>=0.0.20
Requires-Dist: requests>=2.32.5
Requires-Dist: scipy>=1.16.3
Requires-Dist: setuptools>=80.9.0
Requires-Dist: soundfile>=0.13.1
Requires-Dist: speechbrain>=1.0.0
Requires-Dist: torch==2.3.1
Requires-Dist: torchaudio==2.3.1
Requires-Dist: huggingface-hub<0.20
Requires-Dist: uvicorn>=0.38.0
Requires-Dist: webrtcvad>=2.0.10
Requires-Dist: whisper-mps>=0.0.10
Requires-Dist: openai-whisper>=20250625
Dynamic: license-file

# ServAI Model API

![Python](https://img.shields.io/badge/Python-3.11-blue?style=flat-square&logo=python)
![FastAPI](https://img.shields.io/badge/FastAPI-0.95%2B-009688?style=flat-square&logo=fastapi)
![Torch](https://img.shields.io/badge/PyTorch-MPS%20Accelerated-EE4C2C?style=flat-square&logo=pytorch)

**ServAI Model API**ëŠ” **í™”ì ì¸ì‹(Speaker Verification)** ë° **ìŒì„± ì¸ì‹(STT, Speech-to-Text)** ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ê³ ì„±ëŠ¥ AI ì„œë²„ ì• í”Œë¦¬ì¼€ì´ì…˜.

ì‚¬ìš©ìì˜ ìŒì„±ì„ ë¶„ì„í•˜ì—¬ ë“±ë¡ëœ í™”ì(Target Speaker)ì¸ì§€ ì‹ë³„í•˜ê³ , Apple Siliconì— ìµœì í™”ëœ **Whisper (MPS ê°€ì†)** ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ ë¹ ë¥¸ ì†ë„ë¡œ ìŒì„±ì„ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜.

---

## ì£¼ìš” ê¸°ëŠ¥ (Key Features)

**1. í™”ì ì‹ë³„ (Speaker Verification)**
* ì…ë ¥ëœ ìŒì„±ì´ `audio_source`ì— ë“±ë¡ëœ ê¸°ì¤€ í™”ìì™€ ë™ì¼í•œì§€ íŒë³„
* í™”ì ì„ë² ë”© ì¶”ì¶œ ë° **ì½”ì‚¬ì¸ ìœ ì‚¬ë„(Cosine Similarity)** ê¸°ë°˜ ì ìˆ˜ ê³„ì‚°

**2. í™”ì ë¶„ë¦¬ (Speaker Diarization)**
* ë‹¤ìê°„ ëŒ€í™” ì˜¤ë””ì˜¤ì—ì„œ ê° í™”ìì˜ ë°œí™” êµ¬ê°„ì„ ìë™ìœ¼ë¡œ ë¶„ë¦¬
* **Spectral Clustering** ì•Œê³ ë¦¬ì¦˜ì„ í™œìš©í•œ í™”ì ìˆ˜ ì¶”ì • ë° í´ëŸ¬ìŠ¤í„°ë§

**3. ì´ˆê³ ì† ìŒì„± ì¸ì‹ (MPS Accelerated STT)**
* **Whisper** ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ ë†’ì€ ì •í™•ë„ì˜ ìŒì„±-í…ìŠ¤íŠ¸ ë³€í™˜ ìˆ˜í–‰
* **Apple Silicon (M1/M2/M3)** ì¹©ì˜ **MPS (Metal Performance Shaders)** ê°€ì†ì„ í™œìš©í•˜ì—¬ CPU ëŒ€ë¹„ ë¹„ì•½ì ì¸ ì†ë„ í–¥ìƒ
* í™”ì ë¶„ë¦¬ëœ ì„¸ê·¸ë¨¼íŠ¸ë³„ ê°œë³„ STT ì²˜ë¦¬

**4. API ì„œë²„ & í„°ë„ë§**
* **FastAPI** ê¸°ë°˜ì˜ ë¹„ë™ê¸° ì²˜ë¦¬ë¡œ ë†’ì€ ë™ì‹œì„± ë³´ì¥
* `ngrok`ì´ ë‚´ì¥ë˜ì–´ ìˆì–´ ë¡œì»¬ ì„œë²„ë¥¼ ì™¸ë¶€ì—ì„œ ì¦‰ì‹œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥

---
---

## ğŸ”§ ëª¨ë¸ ì„¤ì • (Configuration)

ì´ í”„ë¡œì íŠ¸ëŠ” `src/core/config.py` íŒŒì¼ í•˜ë‚˜ë¡œ **í™”ì ì¸ì‹ ëª¨ë¸**ê³¼ **Whisper STT ëª¨ë¸**ì˜ ë™ì‘ì„ ì œì–´í•©ë‹ˆë‹¤.

### 1. í™”ì ì¸ì‹ ëª¨ë¸ ë³€ê²½ (Speaker Verification)
ì‚¬ìš© ëª©ì ì— ë”°ë¼ **SpeechBrain ì˜¤ë¦¬ì§€ë„ ëª¨ë¸(Base)**ê³¼ **íŒŒì¸íŠœë‹ëœ ëª¨ë¸(Tuned)**ì„ ì†ì‰½ê²Œ ì „í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- **ì„¤ì • íŒŒì¼**: `src/core/config.py`
- **ì‚¬ìš© ë°©ë²•**: `ACTIVE_MODEL_KEY` ê°’ì„ ë³€ê²½í•˜ë©´ ì¦‰ì‹œ ì ìš©ë©ë‹ˆë‹¤.

| ëª¨ë¸ í‚¤(Key) | ì„¤ëª… | ì„ê³„ê°’(Threshold) | íŠ¹ì§• |
| :--- | :--- | :--- | :--- |
| `spkrec-ecapa-voxceleb` | SpeechBrain ê¸°ë³¸ ëª¨ë¸ | 0.40 | ì¼ë°˜ì ì¸ ë²”ìš© í™”ì ì¸ì‹ |
| `FT_voxceleb_0104` | íŒŒì¸íŠœë‹ ëª¨ë¸ (v1) | 0.50 | í•œêµ­ì–´í™˜ê²½ ì»¤ìŠ¤í…€ íŒŒì¸íŠœë‹ ì§„í–‰ |

```python
# [src/core/config.py]
# ì‚¬ìš©í•  ëª¨ë¸ì˜ í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
ACTIVE_MODEL_KEY = "spkrec-ecapa-voxceleb"  # ë˜ëŠ” "FT_voxceleb_0104"
```

### 2. Whisper ëª¨ë¸ ë³€ê²½ (STT)
ì„œë²„ ì‚¬ì–‘ì´ë‚˜ ìš”êµ¬ë˜ëŠ” ì •í™•ë„ì— ë”°ë¼ Whisper ëª¨ë¸ í¬ê¸°ë¥¼ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```python
# [src/core/config.py]
# ì˜µì…˜: 'tiny', 'base', 'small', 'medium', 'large', 'large-v3'
WHISPER_MODEL_NAME = "large"
```

### 3. ì‚¬ìš©ì ì •ì˜ ëª¨ë¸ ì¶”ê°€
ìƒˆë¡œìš´ ëª¨ë¸ì„ ì¶”ê°€í•˜ë ¤ë©´ `MODEL_REGISTRY`ì— ì„¤ì •ì„ ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤.
- `repo_id`: Hugging Face ì €ì¥ì†Œ ID
- `similarity_threshold`: í•´ë‹¹ ëª¨ë¸ì— ìµœì í™”ëœ ìœ ì‚¬ë„ íŒë‹¨ ê¸°ì¤€ê°’
- `custom`: ì»¤ìŠ¤í…€ íŒŒì´ì¬ íŒŒì¼(`custom_model.py` ë“±) í•„ìš” ì—¬ë¶€

---

## ì„¤ì¹˜ ë° ì‹¤í–‰ (Installation & Usage)

ì´ í”„ë¡œì íŠ¸ëŠ” **macOS (Apple Silicon)** í™˜ê²½ì— ìµœì í™”ë¨.

### 1. ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­ (Prerequisites)
ì˜¤ë””ì˜¤ ì²˜ë¦¬ë¥¼ ìœ„í•´ `ffmpeg` ì„¤ì¹˜ í•„ìš”.
```bash
brew install ffmpeg
```

### 2. ê°€ìƒí™˜ê²½ ì„¤ì • ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ (uv ì‚¬ìš©)
Python 3.11 í™˜ê²½ ê¶Œì¥. `uv` íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ì¡´ì„± ì„¤ì¹˜.

```bash
# ê°€ìƒí™˜ê²½ ìƒì„± ë° í™œì„±í™”
uv venv .venv --python 3.11
source .venv/bin/activate

# ì˜ì¡´ì„± ì¶”ê°€ ë° ì„¤ì¹˜
uv add fastapi uvicorn numpy scipy librosa torch torchaudio scikit-learn whisper-mps pyngrok soundfile mlx webrtcvad speechbrain
```
*(ê¸°ì¡´ `pyproject.toml`ì´ ìˆë‹¤ë©´ `uv sync`ë¡œ í•œë²ˆì— ì„¤ì¹˜ ê°€ëŠ¥)*

### 3. í”„ë¡œì íŠ¸ êµ¬ì¡° (Project Structure)
```
ServAI-Model
â”œâ”€â”€ src/                        # ì†ŒìŠ¤ ì½”ë“œ ê·¸ë£¹
â”‚   â”œâ”€â”€ main.py                 # ë©”ì¸ ì‹¤í–‰ íŒŒì¼ (Entry Point)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ core/                   # í•µì‹¬ ë¡œì§ ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ vad.py              # ìŒì„± í™œë™ ê°ì§€ (VAD)
â”‚   â”‚   â”œâ”€â”€ speaker_analysis.py # í™”ì ë¶„ë¦¬ ë° ì‹ë³„ ë¡œì§
â”‚   â”‚   â”œâ”€â”€ embedding.py        # í™”ì ì„ë² ë”© ì¶”ì¶œ (ECAPA-TDNN)
â”‚   â”‚   â”œâ”€â”€ similarity.py       # ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê³„ì‚°
â”‚   â”‚   â””â”€â”€ noise.py            # ë…¸ì´ì¦ˆ ì œê±° ìœ í‹¸ë¦¬í‹°
â”‚   â””â”€â”€ utils/                  # ê³µí†µ ìœ í‹¸ë¦¬í‹°
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ logger.py           # ë¡œê¹… ì„¤ì •
â”‚       â””â”€â”€ utils.py            # ì˜¤ë””ì˜¤ ë¡œë”© ë° ì „ì²˜ë¦¬ í—¬í¼
â”œâ”€â”€ resources/                  # ë¦¬ì†ŒìŠ¤ ê·¸ë£¹
â”‚   â”œâ”€â”€ audio_source/           # ê¸°ì¤€ í™”ì ì˜¤ë””ì˜¤ íŒŒì¼ (.wav)
â”‚   â””â”€â”€ models/
â”‚       â””â”€â”€ ecapa_model/        # í™”ì ì¸ì‹ ëª¨ë¸ íŒŒì¼ë“¤
â””â”€â”€ pyproject.toml              # ì˜ì¡´ì„± ë° í”„ë¡œì íŠ¸ ì„¤ì •
```

### 4. ê¸°ì¤€ í™”ì ë“±ë¡ (Setup Reference Voice)
í™”ì ì‹ë³„ì„ ìœ„í•´ ê¸°ì¤€ì´ ë˜ëŠ” ëª©ì†Œë¦¬ íŒŒì¼ ì¤€ë¹„ í•„ìš”.

1. í”„ë¡œì íŠ¸ ë£¨íŠ¸ì˜ `resources/audio_source/` ë””ë ‰í† ë¦¬ í™•ì¸ (ì—†ìœ¼ë©´ ìƒì„±)
2. ê¸°ì¤€ í™”ìì˜ ê¹¨ë—í•œ ìŒì„± íŒŒì¼(.wav ê¶Œì¥)ì„ í•´ë‹¹ í´ë”ì— ì €ì¥
3. API ì‹¤í–‰ ì‹œ ì´ í´ë”ì˜ ì˜¤ë””ì˜¤ë¥¼ ë¡œë“œí•˜ì—¬ ì„ë² ë”© ìƒì„±

### 5. ì„œë²„ ì‹¤í–‰
```bash
# ëª¨ë“ˆ ëª¨ë“œë¡œ ì‹¤í–‰ (ê¶Œì¥)
python -m servai_model.main

# ë˜ëŠ” uvicorn ì§ì ‘ ì‹¤í–‰ (src ëª¨ë“ˆ ê²½ë¡œ ì£¼ì˜)
# PYTHONPATH=. uvicorn src.main:app --reload --host 0.0.0.0 --port 8000
```
ì„œë²„ê°€ ì‹œì‘ë˜ë©´ ë¡œê·¸ì— ì¶œë ¥ë˜ëŠ” ngrok URL ë˜ëŠ” `http://localhost:8000/docs` ë¡œ ì ‘ì†í•˜ì—¬ API ë¬¸ì„œ í™•ì¸ ê°€ëŠ¥.

## API ëª…ì„¸ (API Specification)

### 1. í™”ì ê²€ì¦ ë° STT (`POST /verify`)
ì—…ë¡œë“œëœ ì˜¤ë””ì˜¤ íŒŒì¼ì„ ë¶„ì„í•˜ì—¬ í™”ì ë¶„ë¦¬ -> ì‹ë³„ -> STT ê³¼ì • ìˆ˜í–‰.

* **URL**: `/verify`
* **Method**: `POST`
* **Content-Type**: `multipart/form-data`

**Request Example (cURL):**
```bash
curl -X 'POST' \
  'https://endmost-ryder-streamlined.ngrok-free.dev/verify' \
  -H 'accept: application/json' \
  -H 'Content-Type: multipart/form-data' \
  -F 'audio_stream=@/path/to/your/audio.wav'
```
*(ì°¸ê³ : `<your-ngrok-url>` ë¶€ë¶„ì€ ì„œë²„ ì‹¤í–‰ ì‹œ ì¶œë ¥ë˜ëŠ” ngrok ì£¼ì†Œë¡œ ë³€ê²½í•˜ì—¬ ì‚¬ìš©)*

**Response Example:**
```json
[
  {
    "text": "ì•ˆë…•í•˜ì„¸ìš”, ì´ë²ˆ í”„ë¡œì íŠ¸ ì¼ì • ì²´í¬ ë¶€íƒë“œë¦½ë‹ˆë‹¤.",
    "similarity_score": 0.852,
    "start": 0.0,
    "end": 3.5
  },
  {
    "text": "ë„¤, í™•ì¸í–ˆìŠµë‹ˆë‹¤. ê¸ˆìš”ì¼ê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.",
    "similarity_score": 0.124,
    "start": 3.8,
    "end": 6.2
  }
]
```
> **Note**: `similarity_score`ê°€ ë†’ì„ìˆ˜ë¡(1.0ì— ê·¼ì ‘) ë“±ë¡ëœ í™”ìì¼ í™•ë¥ ì´ ë†’ìŒ.

### 2. í…ŒìŠ¤íŠ¸ (`POST /test`)
ì„œë²„ ì—°ê²° ìƒíƒœ í™•ì¸ì„ ìœ„í•œ ëª©ì—…(Mock) ì—”ë“œí¬ì¸íŠ¸. (ëª¨ë¸ ì¶”ë¡  X)

**Response Example:**
```json
[
    {
        "text": "ì´ë²ˆ í”„ë¡œì íŠ¸ ë§ˆê° ì–¸ì œì˜€ì§€? ë‚˜ ê¸ˆìš”ì¼ë¡œ ì•Œê³  ìˆëŠ”ë°",
        "similarity_score": 0.612
    },
    {
        "text": "ì•„ë‹ˆì•¼ ë‹¤ìŒ ì£¼ ìˆ˜ìš”ì¼ê¹Œì§€ì•¼ ì•„ì§ ì‹œê°„ ì¢€ ìˆì–´",
        "similarity_score": 0.154
    },
    {
        "text": "ì•„ ì§„ì§œ? ë‹¤í–‰ì´ë‹¤ ê·¸ëŸ¼ ìš°ë¦¬ ë‹¤ìŒì£¼ ê¸ˆìš”ì¼ì— íšŒì‹í•˜ëŠ” ê±° ì–´ë•Œ?",
        "similarity_score": 0.589
    },
    {
        "text": "ì˜¤ ì¢‹ì€ë°? ê°•ë‚¨ì—­ ì‚¼ê²¹ì‚´ì§‘ ê°€ì 6ì‹œì¯¤?",
        "similarity_score": 0.121
    },
    {
        "text": "ê·¸ë˜ ì¢‹ì•„ ì•ˆ ê·¸ë˜ë„ ê³ ê¸° ë¨¹ê³  ì‹¶ì—ˆëŠ”ë°",
        "similarity_score": 0.605
    },
    {
        "text": "ë‹¤ìŒì£¼ ê¸ˆìš”ì¼ ì˜¤í›„ 6ì‹œì— ê°•ë‚¨ì—­ íšŒì‹ ì¼ì • ë“±ë¡í•´ì¤˜",
        "similarity_score": 0.642
    }
]
```
